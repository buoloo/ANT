(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5750],{35099:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=ue(83280),y=ue(59153),Fe=ue(4322),K=ue(24770),Me=ue(89182),ve=function(se,Be){var dt={};for(var rt in se)Object.prototype.hasOwnProperty.call(se,rt)&&Be.indexOf(rt)<0&&(dt[rt]=se[rt]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,rt=Object.getOwnPropertySymbols(se);Et<rt.length;Et++)Be.indexOf(rt[Et])<0&&Object.prototype.propertyIsEnumerable.call(se,rt[Et])&&(dt[rt[Et]]=se[rt[Et]]);return dt},at=(0,Re.forwardRef)(function(se,Be){var dt=se.chartRef,rt=se.style,Et=rt===void 0?{height:"inherit"}:rt,Vt=se.className,Ut=se.loading,lr=se.loadingTemplate,Qt=se.errorTemplate,It=ve(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Lt=(0,y.Z)(ge.aC,It),fr=Lt.chart,ie=Lt.container;return(0,Re.useEffect)(function(){(0,Fe.J)(dt,fr.current)},[fr.current]),(0,Re.useImperativeHandle)(Be,function(){return{getChart:function(){return fr.current}}}),Re.createElement(K.Z,{errorTemplate:Qt},Ut&&Re.createElement(Me.Z,{loadingTemplate:lr,theme:se.theme}),Re.createElement("div",{className:Vt,style:Et,ref:ie}))});Ee.Z=at},65337:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=ue(83280),y=ue(59153),Fe=ue(4322),K=ue(24770),Me=ue(89182),ve=function(se,Be){var dt={};for(var rt in se)Object.prototype.hasOwnProperty.call(se,rt)&&Be.indexOf(rt)<0&&(dt[rt]=se[rt]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,rt=Object.getOwnPropertySymbols(se);Et<rt.length;Et++)Be.indexOf(rt[Et])<0&&Object.prototype.propertyIsEnumerable.call(se,rt[Et])&&(dt[rt[Et]]=se[rt[Et]]);return dt},at=(0,Re.forwardRef)(function(se,Be){var dt=se.chartRef,rt=se.style,Et=rt===void 0?{height:"inherit"}:rt,Vt=se.className,Ut=se.loading,lr=se.loadingTemplate,Qt=se.errorTemplate,It=ve(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Lt=(0,y.Z)(ge.Kj,It),fr=Lt.chart,ie=Lt.container;return(0,Re.useEffect)(function(){(0,Fe.J)(dt,fr.current)},[fr.current]),(0,Re.useImperativeHandle)(Be,function(){return{getChart:function(){return fr.current}}}),Re.createElement(K.Z,{errorTemplate:Qt},Ut&&Re.createElement(Me.Z,{loadingTemplate:lr,theme:se.theme}),Re.createElement("div",{className:Vt,style:Et,ref:ie}))});Ee.Z=at},11231:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=ue(83280),y=ue(59153),Fe=ue(4322),K=ue(24770),Me=ue(89182),ve=function(se,Be){var dt={};for(var rt in se)Object.prototype.hasOwnProperty.call(se,rt)&&Be.indexOf(rt)<0&&(dt[rt]=se[rt]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,rt=Object.getOwnPropertySymbols(se);Et<rt.length;Et++)Be.indexOf(rt[Et])<0&&Object.prototype.propertyIsEnumerable.call(se,rt[Et])&&(dt[rt[Et]]=se[rt[Et]]);return dt},at=(0,Re.forwardRef)(function(se,Be){var dt=se.chartRef,rt=se.style,Et=rt===void 0?{height:"inherit"}:rt,Vt=se.className,Ut=se.loading,lr=se.loadingTemplate,Qt=se.errorTemplate,It=ve(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Lt=(0,y.Z)(ge.TZ,It),fr=Lt.chart,ie=Lt.container;return(0,Re.useEffect)(function(){(0,Fe.J)(dt,fr.current)},[fr.current]),(0,Re.useImperativeHandle)(Be,function(){return{getChart:function(){return fr.current}}}),Re.createElement(K.Z,{errorTemplate:Qt},Ut&&Re.createElement(Me.Z,{loadingTemplate:lr,theme:se.theme}),Re.createElement("div",{className:Vt,style:Et,ref:ie}))});Ee.Z=at},64926:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=ue(83280),y=ue(59153),Fe=ue(4322),K=ue(24770),Me=ue(89182),ve=function(se,Be){var dt={};for(var rt in se)Object.prototype.hasOwnProperty.call(se,rt)&&Be.indexOf(rt)<0&&(dt[rt]=se[rt]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,rt=Object.getOwnPropertySymbols(se);Et<rt.length;Et++)Be.indexOf(rt[Et])<0&&Object.prototype.propertyIsEnumerable.call(se,rt[Et])&&(dt[rt[Et]]=se[rt[Et]]);return dt},at=(0,Re.forwardRef)(function(se,Be){var dt=se.chartRef,rt=se.style,Et=rt===void 0?{height:"inherit"}:rt,Vt=se.className,Ut=se.loading,lr=se.loadingTemplate,Qt=se.errorTemplate,It=ve(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Lt=(0,y.Z)(ge.m,It),fr=Lt.chart,ie=Lt.container;return(0,Re.useEffect)(function(){(0,Fe.J)(dt,fr.current)},[fr.current]),(0,Re.useImperativeHandle)(Be,function(){return{getChart:function(){return fr.current}}}),Re.createElement(K.Z,{errorTemplate:Qt},Ut&&Re.createElement(Me.Z,{loadingTemplate:lr,theme:se.theme}),Re.createElement("div",{className:Vt,style:Et,ref:ie}))});Ee.Z=at},81138:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=ue(83280),y=ue(59153),Fe=ue(4322),K=ue(24770),Me=ue(89182),ve=function(se,Be){var dt={};for(var rt in se)Object.prototype.hasOwnProperty.call(se,rt)&&Be.indexOf(rt)<0&&(dt[rt]=se[rt]);if(se!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,rt=Object.getOwnPropertySymbols(se);Et<rt.length;Et++)Be.indexOf(rt[Et])<0&&Object.prototype.propertyIsEnumerable.call(se,rt[Et])&&(dt[rt[Et]]=se[rt[Et]]);return dt},at=(0,Re.forwardRef)(function(se,Be){var dt=se.chartRef,rt=se.style,Et=rt===void 0?{height:"inherit"}:rt,Vt=se.className,Ut=se.loading,lr=se.loadingTemplate,Qt=se.errorTemplate,It=ve(se,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Lt=(0,y.Z)(ge.kB,It),fr=Lt.chart,ie=Lt.container;return(0,Re.useEffect)(function(){(0,Fe.J)(dt,fr.current)},[fr.current]),(0,Re.useImperativeHandle)(Be,function(){return{getChart:function(){return fr.current}}}),Re.createElement(K.Z,{errorTemplate:Qt},Ut&&Re.createElement(Me.Z,{loadingTemplate:lr,theme:se.theme}),Re.createElement("div",{className:Vt,style:Et,ref:ie}))});Ee.Z=at},64335:function(wn,Ee,ue){"use strict";var Re=ue(67294),ge=(0,Re.createContext)({});Ee.Z=ge},21349:function(wn,Ee,ue){"use strict";var Re=ue(84305),ge=ue(75901),y=ue(85893),Fe=ue(94184),K=ue.n(Fe),Me=ue(67294),ve=ue(64335),at=ue(53645),se=ue.n(at),Be=function(rt){var Et=(0,Me.useContext)(ve.Z),Vt=rt.children,Ut=rt.contentWidth,lr=rt.className,Qt=rt.style,It=(0,Me.useContext)(ge.ZP.ConfigContext),Lt=It.getPrefixCls,fr=rt.prefixCls||Lt("pro"),ie=Ut||Et.contentWidth,yr="".concat(fr,"-grid-content");return(0,y.jsx)("div",{className:K()(yr,lr,{wide:ie==="Fixed"}),style:Qt,children:(0,y.jsx)("div",{className:"".concat(fr,"-grid-content-children"),children:Vt})})};Ee.Z=Be},59159:function(wn,Ee,ue){"use strict";ue.d(Ee,{zP:function(){return Uk},JE:function(){return KP},ns:function(){return zk}});var Re={};ue.r(Re),ue.d(Re,{add:function(){return l0},adjoint:function(){return ld},clone:function(){return od},copy:function(){return sd},create:function(){return Xc},determinant:function(){return up},equals:function(){return Zh},exactEquals:function(){return cp},frob:function(){return fv},fromQuat:function(){return Fd},fromQuat2:function(){return lp},fromRotation:function(){return iv},fromRotationTranslation:function(){return s0},fromRotationTranslationScale:function(){return Cc},fromRotationTranslationScaleOrigin:function(){return ov},fromScaling:function(){return hd},fromTranslation:function(){return nv},fromValues:function(){return Op},fromXRotation:function(){return pd},fromYRotation:function(){return Es},fromZRotation:function(){return Gf},frustum:function(){return sv},getRotation:function(){return Uh},getScaling:function(){return av},getTranslation:function(){return Dv},identity:function(){return Dp},invert:function(){return jf},lookAt:function(){return Rl},mul:function(){return fp},multiply:function(){return Ol},multiplyScalar:function(){return qc},multiplyScalarAndAdd:function(){return c0},ortho:function(){return lv},orthoNO:function(){return Fp},orthoZO:function(){return cv},perspective:function(){return uv},perspectiveFromFieldOfView:function(){return Nd},perspectiveNO:function(){return Bd},perspectiveZO:function(){return u0},rotate:function(){return cd},rotateX:function(){return zh},rotateY:function(){return Dd},rotateZ:function(){return fd},scale:function(){return _h},set:function(){return Rp},str:function(){return Sc},sub:function(){return dd},subtract:function(){return Yc},targetTo:function(){return Fv},translate:function(){return Ql},transpose:function(){return ud}});var ge=ue(67294),y=(0,ge.createContext)({});function Fe(){return(0,ge.useContext)(y)}var K={},Me={},ve=function(a){return Me[a]},at=function(a,t){Me[a]=t},se=function(a){return K[a]},Be=function(a,t){K[a]=t},dt={},rt={},Et=34,Vt=10,Ut=13;function lr(e){return new Function("d","return {"+e.map(function(a,t){return JSON.stringify(a)+": d["+t+'] || ""'}).join(",")+"}")}function Qt(e,a){var t=lr(e);return function(n,r){return a(t(n),r,e)}}function It(e){var a=Object.create(null),t=[];return e.forEach(function(n){for(var r in n)r in a||t.push(a[r]=r)}),t}function Lt(e,a){var t=e+"",n=t.length;return n<a?new Array(a-n+1).join(0)+t:t}function fr(e){return e<0?"-"+Lt(-e,6):e>9999?"+"+Lt(e,6):Lt(e,4)}function ie(e){var a=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":fr(e.getUTCFullYear(),4)+"-"+Lt(e.getUTCMonth()+1,2)+"-"+Lt(e.getUTCDate(),2)+(r?"T"+Lt(a,2)+":"+Lt(t,2)+":"+Lt(n,2)+"."+Lt(r,3)+"Z":n?"T"+Lt(a,2)+":"+Lt(t,2)+":"+Lt(n,2)+"Z":t||a?"T"+Lt(a,2)+":"+Lt(t,2)+"Z":"")}function yr(e){var a=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(A,P){var L,B,Z=r(A,function(j,J){if(L)return L(j,J-1);B=j,L=P?Qt(j,P):lr(j)});return Z.columns=B||[],Z}function r(A,P){var L=[],B=A.length,Z=0,j=0,J,fe=B<=0,Ce=!1;A.charCodeAt(B-1)===Vt&&--B,A.charCodeAt(B-1)===Ut&&--B;function Ve(){if(fe)return rt;if(Ce)return Ce=!1,dt;var st,Bt=Z,Xt;if(A.charCodeAt(Bt)===Et){for(;Z++<B&&A.charCodeAt(Z)!==Et||A.charCodeAt(++Z)===Et;);return(st=Z)>=B?fe=!0:(Xt=A.charCodeAt(Z++))===Vt?Ce=!0:Xt===Ut&&(Ce=!0,A.charCodeAt(Z)===Vt&&++Z),A.slice(Bt+1,st-1).replace(/""/g,'"')}for(;Z<B;){if((Xt=A.charCodeAt(st=Z++))===Vt)Ce=!0;else if(Xt===Ut)Ce=!0,A.charCodeAt(Z)===Vt&&++Z;else if(Xt!==t)continue;return A.slice(Bt,st)}return fe=!0,A.slice(Bt,B)}for(;(J=Ve())!==rt;){for(var tt=[];J!==dt&&J!==rt;)tt.push(J),J=Ve();P&&(tt=P(tt,j++))==null||L.push(tt)}return L}function o(A,P){return A.map(function(L){return P.map(function(B){return b(L[B])}).join(e)})}function u(A,P){return P==null&&(P=It(A)),[P.map(b).join(e)].concat(o(A,P)).join(`
`)}function h(A,P){return P==null&&(P=It(A)),o(A,P).join(`
`)}function d(A){return A.map(m).join(`
`)}function m(A){return A.map(b).join(e)}function b(A){return A==null?"":A instanceof Date?ie(A):a.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:n,parseRows:r,format:u,formatBody:h,formatRows:d,formatRow:m,formatValue:b}}var Dt=yr(","),xt=Dt.parse,Jt=Dt.parseRows,je=Dt.format,Sr=Dt.formatBody,tn=Dt.formatRows,re=Dt.formatRow,Se=Dt.formatValue,V=ue(85061),Q=ue(28991),Le=ue(38163),ht=ue.n(Le),wt=63710088e-1,er={centimeters:wt*100,centimetres:wt*100,degrees:wt/111325,feet:wt*3.28084,inches:wt*39.37,kilometers:wt/1e3,kilometres:wt/1e3,meters:wt,metres:wt,miles:wt/1609.344,millimeters:wt*1e3,millimetres:wt*1e3,nauticalmiles:wt/1852,radians:1,yards:wt*1.0936},Tt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/wt,yards:1.0936133},vr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ln(e,a,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=a||{},n.geometry=e,n}function sn(e,a,t){switch(t===void 0&&(t={}),e){case"Point":return Mi(a).geometry;case"LineString":return ra(a).geometry;case"Polygon":return en(a).geometry;case"MultiPoint":return $i(a).geometry;case"MultiLineString":return fi(a).geometry;case"MultiPolygon":return hi(a).geometry;default:throw new Error(e+" is invalid")}}function Mi(e,a,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!sr(e[0])||!sr(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return ln(n,a,t)}function vi(e,a,t){return t===void 0&&(t={}),ya(e.map(function(n){return Mi(n,a)}),t)}function en(e,a,t){t===void 0&&(t={});for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var h={type:"Polygon",coordinates:e};return ln(h,a,t)}function Oa(e,a,t){return t===void 0&&(t={}),ya(e.map(function(n){return en(n,a)}),t)}function ra(e,a,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return ln(n,a,t)}function Vi(e,a,t){return t===void 0&&(t={}),ya(e.map(function(n){return ra(n,a)}),t)}function ya(e,a){a===void 0&&(a={});var t={type:"FeatureCollection"};return a.id&&(t.id=a.id),a.bbox&&(t.bbox=a.bbox),t.features=e,t}function fi(e,a,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return ln(n,a,t)}function $i(e,a,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return ln(n,a,t)}function hi(e,a,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return ln(n,a,t)}function yi(e,a,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return ln(n,a,t)}function ss(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,a||0);return Math.round(e*t)/t}function yo(e,a){a===void 0&&(a="kilometers");var t=er[a];if(!t)throw new Error(a+" units is invalid");return e*t}function qa(e,a){a===void 0&&(a="kilometers");var t=er[a];if(!t)throw new Error(a+" units is invalid");return e/t}function Ft(e,a){return he(qa(e,a))}function be(e){var a=e%360;return a<0&&(a+=360),a}function he(e){var a=e%(2*Math.PI);return a*180/Math.PI}function Ie(e){var a=e%360;return a*Math.PI/180}function G(e,a,t){if(a===void 0&&(a="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return yo(qa(e,a),t)}function lt(e,a,t){if(a===void 0&&(a="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=vr[a];if(!n)throw new Error("invalid original units");var r=vr[t];if(!r)throw new Error("invalid final units");return e/n*r}function sr(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Jr(e){return!!e&&e.constructor===Object}function nt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!sr(a))throw new Error("bbox must only contain numbers")})}function Gt(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ar(e,a,t){if(e!==null)for(var n,r,o,u,h,d,m,b=0,A=0,P,L=e.type,B=L==="FeatureCollection",Z=L==="Feature",j=B?e.features.length:1,J=0;J<j;J++){m=B?e.features[J].geometry:Z?e.geometry:e,P=m?m.type==="GeometryCollection":!1,h=P?m.geometries.length:1;for(var fe=0;fe<h;fe++){var Ce=0,Ve=0;if(u=P?m.geometries[fe]:m,u!==null){d=u.coordinates;var tt=u.type;switch(b=t&&(tt==="Polygon"||tt==="MultiPolygon")?1:0,tt){case null:break;case"Point":if(a(d,A,J,Ce,Ve)===!1)return!1;A++,Ce++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(a(d[n],A,J,Ce,Ve)===!1)return!1;A++,tt==="MultiPoint"&&Ce++}tt==="LineString"&&Ce++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(r=0;r<d[n].length-b;r++){if(a(d[n][r],A,J,Ce,Ve)===!1)return!1;A++}tt==="MultiLineString"&&Ce++,tt==="Polygon"&&Ve++}tt==="Polygon"&&Ce++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(Ve=0,r=0;r<d[n].length;r++){for(o=0;o<d[n][r].length-b;o++){if(a(d[n][r][o],A,J,Ce,Ve)===!1)return!1;A++}Ve++}Ce++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Ar(u.geometries[n],a,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Tr(e,a,t,n){var r=t;return Ar(e,function(o,u,h,d,m){u===0&&t===void 0?r=o:r=a(r,o,u,h,d,m)},n),r}function Rr(e,a){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&a(e.features[t].properties,t)!==!1;t++);break;case"Feature":a(e.properties,0);break}}function mn(e,a,t){var n=t;return Rr(e,function(r,o){o===0&&t===void 0?n=r:n=a(n,r,o)}),n}function mi(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&a(e.features[t],t)!==!1;t++);}function ai(e,a,t){var n=t;return mi(e,function(r,o){o===0&&t===void 0?n=r:n=a(n,r,o)}),n}function Tn(e){var a=[];return Ar(e,function(t){a.push(t)}),a}function Ri(e,a){var t,n,r,o,u,h,d,m,b,A,P=0,L=e.type==="FeatureCollection",B=e.type==="Feature",Z=L?e.features.length:1;for(t=0;t<Z;t++){for(h=L?e.features[t].geometry:B?e.geometry:e,m=L?e.features[t].properties:B?e.properties:{},b=L?e.features[t].bbox:B?e.bbox:void 0,A=L?e.features[t].id:B?e.id:void 0,d=h?h.type==="GeometryCollection":!1,u=d?h.geometries.length:1,r=0;r<u;r++){if(o=d?h.geometries[r]:h,o===null){if(a(null,P,m,b,A)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,P,m,b,A)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(a(o.geometries[n],P,m,b,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function zi(e,a,t){var n=t;return Ri(e,function(r,o,u,h,d){o===0&&t===void 0?n=r:n=a(n,r,o,u,h,d)}),n}function ka(e,a){Ri(e,function(t,n,r,o,u){var h=t===null?null:t.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return a(ln(t,r,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(h){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var m=0;m<t.coordinates.length;m++){var b=t.coordinates[m],A={type:d,coordinates:b};if(a(ln(A,r),n,m)===!1)return!1}})}function ia(e,a,t){var n=t;return ka(e,function(r,o,u){o===0&&u===0&&t===void 0?n=r:n=a(n,r,o,u)}),n}function io(e,a){ka(e,function(t,n,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var h,d=0,m=0,b=0;if(Ar(t,function(A,P,L,B,Z){if(h===void 0||n>d||B>m||Z>b){h=A,d=n,m=B,b=Z,o=0;return}var j=lineString([h,A],t.properties);if(a(j,n,r,Z,o)===!1)return!1;o++,h=A})===!1)return!1}}})}function Ci(e,a,t){var n=t,r=!1;return io(e,function(o,u,h,d,m){r===!1&&t===void 0?n=o:n=a(n,o,u,h,d,m),r=!0}),n}function pa(e,a){if(!e)throw new Error("geojson is required");ka(e,function(t,n,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(a(t,n,r,0,0)===!1)return!1;break;case"Polygon":for(var h=0;h<u.length;h++)if(a(lineString(u[h],t.properties),n,r,h)===!1)return!1;break}}})}function ee(e,a,t){var n=t;return pa(e,function(r,o,u,h){o===0&&t===void 0?n=r:n=a(n,r,o,u,h)}),n}function ce(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,n=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":u=u||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var d=h.coordinates;switch(h.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),lineString([d[o],d[o+1]],u,a);case"Polygon":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o-1),lineString([d[r][o],d[r][o+1]],u,a);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),lineString([d[n][o],d[n][o+1]],u,a);case"MultiPolygon":return n<0&&(n=d.length+n),r<0&&(r=d[n].length+r),o<0&&(o=d[n][r].length-o-1),lineString([d[n][r][o],d[n][r][o+1]],u,a)}throw new Error("geojson is invalid")}function xe(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,n=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":u=u||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var d=h.coordinates;switch(h.type){case"Point":return point(d,u,a);case"MultiPoint":return n<0&&(n=d.length+n),point(d[n],u,a);case"LineString":return o<0&&(o=d.length+o),point(d[o],u,a);case"Polygon":return r<0&&(r=d.length+r),o<0&&(o=d[r].length+o),point(d[r][o],u,a);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),point(d[n][o],u,a);case"MultiPolygon":return n<0&&(n=d.length+n),r<0&&(r=d[n].length+r),o<0&&(o=d[n][r].length-o),point(d[n][r][o],u,a)}throw new Error("geojson is invalid")}function Oe(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function qe(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ct(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return ct(e[0]);throw new Error("coordinates must only contain numbers")}function St(e,a,t){if(!a||!t)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.type)}function ke(e,a,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.geometry.type)}function it(e,a,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,r=e.features;n<r.length;n++){var o=r[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+o.geometry.type)}}function Yt(e){return e.type==="Feature"?e.geometry:e}function jr(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function or(e,a){var t=a.x,n=a.y,r=a.x1,o=a.y1,u=a.coordinates,h=a.geometry,d=[];if(!Array.isArray(e))return{dataArray:[]};for(var m=function(L){var B=e[L];if(h){var Z=(0,Q.Z)({},B[h]),j=ht()(Z,!0);return ka(j,function(Xt){var cr=qe(Xt),Ir=(0,Q.Z)((0,Q.Z)({},B),{},{_id:L,coordinates:cr});d.push(Ir)}),"continue"}var J=[];if(u){var fe="Polygon";Array.isArray(u[0])||(fe="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(fe="LineString");var Ce={type:fe,coordinates:(0,V.Z)(B[u])},Ve=ht()(Ce,!0);J=Ve.coordinates}else if(t&&n&&r&&o){var tt=[parseFloat(B[t]),parseFloat(B[n])],st=[parseFloat(B[r]),parseFloat(B[o])];J=[tt,st]}else t&&n&&(J=[parseFloat(B[t]),parseFloat(B[n])]);var Bt=(0,Q.Z)((0,Q.Z)({},B),{},{_id:L,coordinates:J});d.push(Bt)},b=0;b<e.length;b++)var A=m(b);return{dataArray:d}}function mr(e,a){var t=xt(e);return or(t,a)}function Hr(e){for(var a=e.toString(),t=5381,n=a.length;n;)t=t*33^a.charCodeAt(--n);return t>>>0}function si(e,a){return a===void 0?null:a==="id"&&e.id?e.id:e[a]?e[a]:e.properties&&e.properties[a]?Hr(e.properties[a]+"")%1000019:null}function Mn(e,a){var t=[],n={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),ht()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(ka(e,function(r,o){var u=si(r,a==null?void 0:a.featureId);u===null&&(u=o);var h=u,d=qe(r),m=(0,Q.Z)((0,Q.Z)({},r.properties),{},{coordinates:d,_id:h});t.push(m)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function ar(e){var a=131,t=137,n=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)n>r&&(n=Math.floor(n/t)),n=n*a+e.charCodeAt(o);return n}function Yn(e){e=e.toString();for(var a=5381,t=e.length;t;)a=a*33^e.charCodeAt(--t);return a>>>0}var Pr=ue(28481),gn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ea(e){this.message=e}ea.prototype=new Error,ea.prototype.name="InvalidCharacterError";function Vn(e){var a=String(e).replace(/=+$/,"");if(a.length%4==1)throw new ea("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,r,o,u=0;o=a.charAt(u++);~o&&(r=n%4?r*64+o:o,n++%4)?t+=String.fromCharCode(255&r>>(-2*n&6)):0)o=gn.indexOf(o);return t}function na(e){e=String(e);for(var a,t,n,r,o="",u=0,h=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|n<<8|r,o+=gn.charAt(a>>18&63)+gn.charAt(a>>12&63)+gn.charAt(a>>6&63)+gn.charAt(a&63)}return h?o.slice(0,h-3)+"===".substring(h):o}var Ht=ue(6610),Rt=ue(5991),da=function(){function e(a,t){(0,Ht.Z)(this,e),this.buffers=a,this.type=t}return(0,Rt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,r){throw new Error("not implemented")}}]),e}(),aa,Di=function(){return aa||(aa=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof ue.g!="undefined"?ue.g:{})};aa=Di();var Ii;typeof window=="undefined"?Ii={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ii=window;var _o=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Na=_o?my.getSystemInfoSync().pixelRatio:Ii.devicePixelRatio,Or=ue(10379),Dr=ue(46070),Mt=ue(77608),us=(0,Rt.Z)(function e(a,t){(0,Ht.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),At=ue(63349);function ao(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=yu(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function yu(e,a){if(!!e){if(typeof e=="string")return Jo(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jo(e,a)}}function Jo(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Bi=new WeakMap,gl=function(){function e(){(0,Ht.Z)(this,e),Bi.set(this,{})}return(0,Rt.Z)(e,[{key:"addEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bi.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(n),Bi.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bi.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var h=u.length;h--;h>0)if(u[h]===n){u.splice(h,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=Bi.get(this)[t.type];if(n){var r=ao(n),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(h){r.e(h)}finally{r.f()}}}}]),e}();function Ra(e){var a=Lo();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Do=function(e){(0,Or.Z)(t,e);var a=Ra(t);function t(){var n;return(0,Ht.Z)(this,t),n=a.call(this),n.childNodes=[],n}return(0,Rt.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(gl);function Ea(e){var a=Ps();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ks=function(e){(0,Or.Z)(t,e);var a=Ea(t);function t(){var n;return(0,Ht.Z)(this,t),n=a.call(this),n.className="",n.children=[],n}return(0,Rt.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(Do),Jl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fo,ds,ja,Fo;if(Jl){var vs=my.getSystemInfoSync();fo=vs.screenWidth,ds=vs.screenHeight,ja=vs.windowWidth,Fo=vs.windowHeight}else{var Bo=Ii.innerWidth,Ju=Ii.innerHeight;fo=Bo,ds=Ju,ja=Bo,Fo=Ju}var ju={width:fo,height:ds,availWidth:ja,availHeight:Fo,availLeft:0,availTop:0},jo=ju.availWidth,ye=ju.availHeight,Ze={style:[]};function Ct(e,a){if(!("parentNode"in e)){var t;a===0?t=function(){return null}:a===1?t=function(){return Ze}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;a===0?n=function(){return null}:a===1?n=function(){return Ze}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function hr(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:jo+"px",height:ye+"px",margin:"0px",padding:"0px"})}function En(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=jo,e.clientHeight=ye),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function ri(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=jo,e.offsetHeight=ye)}function _a(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=jo,e.scrollHeight=ye)}function Go(e){var a=function(){return!0};e.classList=[],e.classList.add=a,e.classList.remove=a,e.classList.contains=a,e.classList.toggle=a}function Da(e){var a=No();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function No(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function So(){}var oo=function(e){(0,Or.Z)(t,e);var a=Da(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,Ht.Z)(this,t),n=a.call(this),n.className="",n.children=[],n.focus=So,n.blur=So,n.insertBefore=So,n.appendChild=So,n.removeChild=So,n.remove=So,n.innerHTML="",n.tagName=r.toUpperCase(),Ct((0,At.Z)(n),o),hr((0,At.Z)(n)),Go((0,At.Z)(n)),En((0,At.Z)(n)),ri((0,At.Z)(n)),_a((0,At.Z)(n)),n}return(0,Rt.Z)(t)}(ks);function Ls(e){var a=Qs();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uu=function(e){(0,Or.Z)(t,e);var a=Ls(t);function t(n){return(0,Ht.Z)(this,t),a.call(this,n)}return(0,Rt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(oo);function _u(e){var a=Gu();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Gu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xu=function(e){(0,Or.Z)(t,e);var a=_u(t);function t(){return(0,Ht.Z)(this,t),a.call(this,"video")}return(0,Rt.Z)(t)}(uu),Oo={},fa={};function Cs(e,a){Oo=e,Oo.id=a,"tagName"in Oo||(Oo.tagName="CANVAS"),Oo.type="canvas",Mixin.parentNode(Oo),Mixin.style(Oo),Mixin.classList(Oo),Mixin.clientRegion(Oo),Mixin.offsetRegion(Oo),Oo.focus=function(){},Oo.blur=function(){}}function Ch(e,a){var t=1024,n=1024;fa={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:a,type:"canvas"},"tagName"in fa||(fa.tagName="CANVAS"),Mixin.parentNode(fa),Mixin.style(fa),Mixin.classList(fa),Mixin.clientRegion(fa),Mixin.offsetRegion(fa),fa.getContext=function(r){if(r==="2d")return e},fa.focus=function(){},fa.blur=function(){}}function el(){return Oo}function mf(){return fa}var qf=(0,Rt.Z)(function e(){(0,Ht.Z)(this,e);var a=el(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Ct(t),Go(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),yl={href:"",protocol:"",host:""};function wc(e){var a=_l();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function _l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gf=function(e){(0,Or.Z)(t,e);var a=wc(t);function t(){return(0,Ht.Z)(this,t),a.call(this,"body",0)}return(0,Rt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(oo),E=function(e){(0,Or.Z)(t,e);var a=wc(t);function t(){return(0,Ht.Z)(this,t),a.call(this,"html",0)}return(0,Rt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(oo),k={},H={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:yl,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new qf:a==="video"?new xu:new oo(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,n){k[a]||(k[a]=[]),k[a].push(t)},removeEventListener:function(a,t){var n=k[a];if(n&&n.length>0){for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}}},dispatchEvent:function(a){var t=a.type,n=k[t];if(n)for(var r=0;r<n.length;r++)n[r](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new us(a)}};H.documentElement=new E,H.head=new oo("head"),H.body=new gf;var F=Object,le=ue(90484),Ue=function(){function e(){(0,Ht.Z)(this,e);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,le.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Rt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),yt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ot,Nt,Br;if(yt){var Xr=my.getSystemInfoSync();Ot=Xr.system,Nt=Xr.platform,Br=Xr.language}else{var Jn={versions:function(){var e=Ii.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ii.navigator.browserLanguage||Ii.navigator.language).toLowerCase()};Jn.versions.android?Nt="android":Jn.versions.trident?Nt="IE":Jn.versions.presto?Nt="Opera":Jn.versions.webKit?Nt="webKit":Jn.versions.gecko?Nt="Firefox":Jn.versions.mobile?Nt="mobile":Jn.versions.ios?Nt="ios":Jn.versions.iPhone?Nt="iPhone":Jn.versions.iPad?Nt="ipad":Jn.versions.webApp?Nt="webApp":Jn.versions.weixin?Nt="weixin":Jn.versions.qq&&(Nt="qq"),Ot=Ii.navigator.userAgent,Br=Jn.language}var Ki=Ot.toLowerCase().indexOf("android")!==-1,ji=Ki?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ha="Mozilla/5.0 (".concat(ji,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Br),Ka={platform:Nt,language:Br,appVersion:"5.0 (".concat(ji,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ha},xo={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){}},Ta=0,Hs=0;function Bl(e){var a=Date.now(),t=Math.max(Ta+23,a);return Hs=setTimeout(function(){e(Ta=t)},t-a),Hs}function Kc(e){var a=el();return a.requestAnimationFrame?a.requestAnimationFrame(e):Bl(e)}function Qc(e){var a=el();return a.cancelAnimationFrame?a.cancelAnimationFrame(e):clearTimeout(e)}var Tc=function(){function e(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Ht.Z)(this,e),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,Rt.Z)(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],r=t.type,o=Mc(n),u="data:".concat(r,";base64, ");return u+o}}]),e}();function Mc(e){for(var a="",t=new Uint8Array(e),n=t.byteLength,r=0;r<n;r++)a+=String.fromCharCode(t[r]);return na(a)}var Pu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Nl={};function xl(e){var a=Ho();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Ho(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sh=new Map,Ah=new Map,bu=new Map,Xh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function zl(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,a)}function tl(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,zl.call(this,"readystatechange",a)}var Ul=function(e){(0,Or.Z)(t,e);var a=xl(t);function t(){var n;return(0,Ht.Z)(this,t),n=a.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Sh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Rt.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=bu.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=Ah.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return Ah.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=Sh.get("requestHeader");u[r]=o,Sh.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};h.target=h.target||u,o.call(u,h)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(gl);Ul.UNSEND=0,Ul.OPENED=1,Ul.HEADERS_RECEIVED=2,Ul.LOADING=3,Ul.DONE=4;function bl(e){var a=lo();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rl=function(e){(0,Or.Z)(t,e);var a=bl(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=el(),r.currentTarget=el(),r}return(0,Rt.Z)(t)}(us);function $f(e){var a=e||{},t=a.x,n=t===void 0?0:t,r=a.y,o=r===void 0?0:r,u=a.clientX,h=u===void 0?0:u,d=a.clientY,m=d===void 0?0:d;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=h,e.y=m)}function Hu(e){return function(a){var t=new rl(e);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(n){return $f(n)}),t.touches.forEach(function(n){return $f(n)}),t.targetTouches.forEach(function(n){return $f(n)}),H.dispatchEvent(t)}}function yp(e){return function(a){a.type=e,H.dispatchEvent(a)}}var Qd=Hu("touchstart"),jp=Hu("touchmove"),wh=Hu("touchend"),yf=yp("mapCameaParams");function _f(e){var a=Ic();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xf=function(e){(0,Or.Z)(t,e);var a=_f(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.target=el(),r.currentTarget=el(),r}return(0,Rt.Z)(t)}(us),ec=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],bf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],tc="touch";function lu(e,a,t){for(var n=new xf(e),r=0;r<ec.length;r++){var o=ec[r];n[o]=a[o]||bf[r]}return n.type=e,n.target=el(),n.currentTarget=el(),n.buttons=Kf(e),n.which=n.buttons,n.pointerId=(a.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(a.radiusX||.5)*2,n.height=(a.radiusY||.5)*2,n.pressure=a.force||.5,n.isPrimary=Yh(a),n.pointerType=tc,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function Kf(e){var a=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(a=1),a}var rc=null;function Yh(e){return rc===e.identifier}function Pc(e){rc===null&&(rc=e.identifier)}function nc(e){rc===e.identifier&&(rc=null)}function nl(e){return function(a){for(var t=a.changedTouches,n=0;n<t.length;n++){var r=t[n];n===0&&e==="pointerdown"?Pc(r):(e==="pointerup"||e==="pointercancel")&&nc(r);var o=lu(e,r,a);H.dispatchEvent(o)}}}var Ef=nl("pointerdown"),kc=nl("pointermove"),_p=nl("pointerup");function Cf(e){var a=ic();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function ic(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qh=function(e){(0,Or.Z)(t,e);var a=Cf(t);function t(n){return(0,Ht.Z)(this,t),a.call(this,n)}return(0,Rt.Z)(t)}(us);function Sf(e){return function(a){a.type=e,H.dispatchEvent(a)}}var Af=Sf("mousedown"),Gp=Sf("mousemove"),Hp=Sf("mouseup"),Th=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Jc=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Eu=Th||Jc,ef={atob:Vn,btoa:na,devicePixelRatio:Na,Blob:da,document:H,Element:ks,Event:us,EventTarget:gl,HTMLCanvasElement:F,HTMLElement:oo,HTMLMediaElement:uu,HTMLVideoElement:xu,Image:qf,ImageData:Ue,navigator:Ka,Node:Do,requestAnimationFrame:Kc,cancelAnimationFrame:Qc,screen:ju,XMLHttpRequest:Ul,performance:xo,URL:Tc,WebGLRenderingContext:Pu,WebGL2RenderingContext:Nl,addEventListener:function(a,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};H.addEventListener(a,t,n)},removeEventListener:function(a,t,n){H.removeEventListener(a,t)},dispatchEvent:function(a){H.dispatchEvent(a)},innerWidth:ju.availWidth,innerHeight:ju.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ui=Eu?ef:Ii,wf=Eu?Ul:Ii.XMLHttpRequest,Tf=Eu?yl:Ii.location;function El(e){var a=e;return typeof e=="string"&&(a=Ui.document.getElementById(e)),a}function Aa(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function bo(e){return Aa(e).split(/\s+/)}function cu(e){var a,t,n=Ui==null||(a=Ui.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}function Mo(e,a,t){var n=Ui.document.createElement(e);return n.className=a||"",t&&t.appendChild(n),n}function ku(e){var a=e.parentNode;a&&a.removeChild(e)}function Zl(e,a){if(e.classList!==void 0)for(var t=bo(a),n=0,r=t.length;n<r;n++)e.classList.add(t[n]);else if(!Wp(e,a)){var o=Mf(e);Qf(e,(o?o+" ":"")+a)}}function fu(e,a){e.classList!==void 0?e.classList.remove(a):Qf(e,Aa((" "+Mf(e)+" ").replace(" "+a+" "," ")))}function Wp(e,a){if(e.classList!==void 0)return e.classList.contains(a);var t=Mf(e);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function Qf(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Mf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Vl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ms=cu(["transform","WebkitTransform"]);function il(e,a){e.style[ms]=a}function Jf(){if(typeof Event=="function")Ui.dispatchEvent(new Event("resize"));else{var e=Ui.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ui,0),Ui.dispatchEvent(e)}}function Wo(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function ni(){var e,a=Ui.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(e=a.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(r){var o=r.split("="),u=(0,Pr.Z)(o,2),h=u[0],d=u[1];return h==="initial-scale"});return n?n.split("=")[1]*1:1}var va=ni()<1?1:Ui.devicePixelRatio;function Lc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a*1}function If(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a*1}function Lu(e){if(e.length===0)return 0;for(var a=e[0]*1,t=1;t<e.length;t++)a+=e[t]*1;return a}function Ou(e){if(e.length===0)throw new Error("mean requires at least one data point");return Lu(e)/e.length}function Oc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],t=NaN,n=0,r=1,o=1;o<e.length+1;o++)e[o]!==a?(r>n&&(n=r,t=a),r=1,a=e[o]):r++;return t*1}var In={min:If,max:Lc,mean:Ou,sum:Lu,mode:Oc};function Rc(e,a){return e.map(function(t){return t[a]})}function Mh(e,a){return In[e](a)}var xa=ue(92137),ho=ue(14665);function hu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Ih=ue(51814);function al(e,a,t){return(0,Ih.Z)()?al=Reflect.construct.bind():al=function(r,o,u){var h=[null];h.push.apply(h,o);var d=Function.bind.apply(r,h),m=new d;return u&&(0,ho.Z)(m,u.prototype),m},al.apply(null,arguments)}function Js(e){var a=typeof Map=="function"?new Map:void 0;return Js=function(n){if(n===null||!hu(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(n))return a.get(n);a.set(n,r)}function r(){return al(n,arguments,(0,Mt.Z)(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,ho.Z)(r,n)},Js(e)}var jl=ue(87757),di=ue.n(jl);function eh(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function xp(){return typeof importScripts=="function"}var bp=xp()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function ol(e){var a=Ws();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ua=function(e){(0,Or.Z)(t,e);var a=ol(t);function t(n,r,o,u){var h;return(0,Ht.Z)(this,t),h=a.call(this,"AJAXError: ".concat(r," (").concat(n,"): ").concat(o)),h.status=n,h.statusText=r,h.url=o,h.body=u,h}return(0,Rt.Z)(t)}(Js(Error));function Cl(e,a){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(n){return n.ok?(e.type==="arrayBuffer"?n.arrayBuffer():e.type==="json"?n.json():n.text()).then(function(r){a(null,r,n.headers.get("Cache-Control"),n.headers.get("Expires"))}).catch(function(r){a(new Error(r.message))}):n.blob().then(function(r){return a(new ua(n.status,n.statusText,e.url,r))})}).catch(function(n){a(new Error(n.message))})}function pu(e,a){var t=new wf;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var n in e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var r=t.response;if(e.type==="json")try{r=JSON.parse(t.response)}catch(u){return a(u)}a(null,r,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new ua(t.status,t.statusText,e.url,o))}},t.send(e.body),t}function Ss(e,a){return pu(e,a)}var Pf=function(a,t){return Ss(_objectSpread(_objectSpread({},a),{},{type:"json"}),t)},Gl=function(a,t){return Ss((0,Q.Z)((0,Q.Z)({},a),{},{type:"arrayBuffer"}),t)},sl=function(a,t){return Ss(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function du(e){var a=$window.document.createElement("a");return a.href=e,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var ul="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function _i(e,a){var t=new Ui.Image,n=Ui.URL||Ui.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=ul})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(r):ul}function pi(e,a){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){a(null,n)}).catch(function(n){a(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var kf=function(a,t){return Gl(a,function(n,r){if(n)t(n);else if(r){var o=typeof createImageBitmap=="function";o?pi(r,t):_i(r,t)}})},Os=function(){var e=(0,xa.Z)(di().mark(function a(t,n,r){var o,u,h,d,m,b;return di().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,r(t);case 3:o=P.sent,u=o.rasterData,h=o.width,d=o.height,m=0,b=8e3,n(null,{data:u,width:h,height:d,min:m,max:b}),P.next=15;break;case 12:P.prev=12,P.t0=P.catch(0),n(null,new Error(""+P.t0));case 15:case"end":return P.stop()}},a,null,[[0,12]])}));return function(t,n,r){return e.apply(this,arguments)}}(),ll=function(a,t,n){return Gl(a,function(r,o){r?t(r):o&&Os(o,t,n)})};function Yo(e){return typeof e=="number"}var Ru=2*Math.PI*6378137/2;function Ph(e){var a=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;th(a,n)}),a}function th(e,a){return Array.isArray(a[0])?a.forEach(function(t){th(e,t)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Qa(e,a){return po(e,a)}function po(e,a){return Array.isArray(e[0])?e.map(function(t){return po(t,a)}):a(e)}function rh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Rs(e,a);var n=e[0],r=e[1],o=n*Ru/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*Ru/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function nh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],r=t/Ru*180,o=n/Ru*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(r=Number(r.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[r,o,e[2]]:[r,o]}function Sl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Al(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Rs(e,a){if(a===!1)return e;var t=Sl(e[0]),n=Al(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ao(e){var a=85.0511287798,t=Math.max(Math.min(a,e[1]),-a),n=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var h=.5/Math.PI,d=.5,m=-.5/Math.PI;return r=.5,o=n*(h*o+d),u=n*(m*u+r),[Math.floor(o),Math.floor(u)]}function ac(e){var a=.5/Math.PI,t=.5,n=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),h=u[0],d=u[1];h=(h/o-t)/a,d=(d/o-r)/n,d=(Math.atan(Math.pow(Math.E,d))-Math.PI/4)*2,r=Math.PI/180;var m=d/r,b=h/r;return[b,m]}function $h(e,a){var t=85.0511287798,n=Math.PI/180,r=6378137;return a=Math.max(Math.min(t,a),-t),e*=n,a*=n,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*r,a*r]}function tf(e,a){var t=Math.PI/180,n=6378137,r=e/n/t,o=2*(Math.atan(Math.exp(a/n))-Math.PI/4)/t;return[r,o]}function ih(e,a,t){var n=Ie(a[1]-e[1]),r=Ie(a[0]-e[0]),o=Ie(e[1]),u=Ie(a[1]),h=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return yo(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),t="meters")}function Kh(e){var a=Math.PI/180,t=85.0511287798,n=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*a),u=n*e[0]*a,h=n*Math.log((1+o)/(1-o))/2;return[u,h]}function cl(e,a){var t=Math.abs(e[1][1]-e[0][1])*a,n=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function oc(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function rf(e){return[[e[0],e[1]],[e[2],e[3]]]}function sc(e){var a=Hl(e,[0,0]);return[e[0]/a,e[1]/a]}function Hl(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function kh(e,a){return e[0]*a[0]+e[1]*a[1]}function uc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function wl(e,a){return Math.acos(kh(e,a)/(uc(e)*uc(a)))*180/Math.PI}function Lf(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function Lh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,r=[],o=0;o<e.length-1;o++){var u=e[o],h=e[o+1],d=Hl(u,h);n+=d;var m=[u[0]-h[0],u[1]-h[1]],b=Lf(t,m);if(o>0){var A=r[o-1].rotation;A-b>360-A+b&&(b=b+360)}r.push({start:u,end:h,dis:d,rotation:b,duration:0})}return r.map(function(P){P.duration=a*(P.dis/n)}),r}}function Wu(e){if(Yo(e[0]))return e;if(Yo(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Yo(e[0][0][0])){var a=e,t=0,n=0,r=0;return a.forEach(function(o){o.forEach(function(u){t+=u[0],n+=u[1],r++})}),[t/r,n/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function nf(e){for(var a=e[0],t=e[1],n=e[0],r=e[1],o=0,u=0,h=0,d=0;d<e.length;d+=2){var m=e[d],b=e[d+1];m&&b&&(a=Math.max(m,a),t=Math.max(b,t),n=Math.min(m,n),r=Math.min(b,r),o+=m,u+=b,h++)}return{center:[o/h,u/h],radius:Math.sqrt(Math.pow(a-n,2)+Math.pow(t-r,2))/2}}var c=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Ht.Z)(this,e),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,Rt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(r){return r===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function p(e,a){e.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var f=null,g=ue(2650);function S(e){return typeof e=="string"?!!g.ZP(e):!1}function I(e){var a=g.ZP(e),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function O(e){var a=e&&e[0],t=e&&e[1],n=e&&e[2],r=a+t*256+n*65536-1;return r}function z(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function q(e){var a=Ui.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;var n=null;if(e.weights){var r=0;e.weights.map(function(P,L){var B=e.colors[L]||"rgba(0, 0, 0, 0)",Z=r+P;t.fillStyle=B,t.fillRect(r*256,0,Z*256,1),r=Z})}else{for(var o=t.createLinearGradient(0,0,256,1),u=e.positions[0],h=e.positions[e.positions.length-1],d=0;d<e.colors.length;++d){var m=(e.positions[d]-u)/(h-u);o.addColorStop(m,e.colors[d])}t.fillStyle=o,t.fillRect(0,0,256,1)}if(Eu)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var b=t.createImageData(256,1),A=0;A<b.data.length;A+=4)b.data[A+0]=n[A+0],b.data[A+1]=n[A+1],b.data[A+2]=n[A+2],b.data[A+3]=n[A+3];return a=null,t=null,b}var oe;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(oe||(oe={}));var Te={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pe(e,a,t){var n=e.classList;for(var r in Te)Te.hasOwnProperty(r)&&n.remove("l7-".concat(t,"-anchor-").concat(r));n.add("l7-".concat(t,"-anchor-").concat(a))}function _e(e,a){return{enable:e,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}function Je(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var $e={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},mt=$e.self||$e.window||{},Ye=$e.window||$e.self||{},gt=$e.self||$e.window||{},Pt=$e.document||{},qt=typeof importScripts=="function",_r=typeof window!="undefined"&&typeof window.orientation!="undefined",ir=function(){function e(a,t){var n=this;this.name=a,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){n.resolve=r,n.reject=o})}return e.prototype.postMessage=function(a,t){this.workerThread.postMessage({source:"Main thread",type:a,payload:t})},e.prototype.done=function(a){Je(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){Je(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),Mr=ir,Wr=new Map;function Cn(e){Je(e.source&&!e.url||!e.source&&e.url);var a=Wr.get(e.source||e.url);return a||(e.url&&(a=yn(e.url),Wr.set(e.url,a)),e.source&&(a=Hn(e.source),Wr.set(e.source,a))),Je(a),a}function yn(e){if(!e.startsWith("http"))return e;var a=xi(e);return Hn(a)}function Hn(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function xi(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Si(e,a,t){a===void 0&&(a=!0);var n=t||new Set;if(e){if(bi(e))n.add(e);else if(bi(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var r in e)Si(e[r],a,n)}}return t===void 0?Array.from(n):[]}function bi(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Ca=function(){},qn=function(){function e(a){this.terminated=!1,this.loadableURL="";var t=a.name,n=a.source,r=a.url;Je(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Ca,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Ca,this.onError=Ca,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,t){t=t||Si(a),this.worker.postMessage(a,t)},e.prototype.getErrorFromErrorEvent=function(a){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",a.message&&(t+=a.message+" in "),a.lineno&&(t+=":"+a.lineno+":"+a.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=Cn({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?a.onMessage(n.data):a.onError(new Error("No data received"))},t.onerror=function(n){a.onError(a.getErrorFromErrorEvent(n)),a.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+a.name+", message error: "+n)},t},e}(),Hi=qn,Qi=function(){return Qi=Object.assign||function(e){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Qi.apply(this,arguments)},Wi=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function d(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,d)}m((n=n.apply(e,a||[])).next())})},Oi=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return d([m,b])}}function d(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},oa=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=Qi(Qi({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,t,n){return t===void 0&&(t=function(r,o,u){return r.done(u)}),n===void 0&&(n=function(r,o){return r.error(o)}),Wi(this,void 0,void 0,function(){var r,o=this;return Oi(this,function(u){switch(u.label){case 0:return r=new Promise(function(h){return o.jobQueue.push({name:a,onMessage:t,onError:n,onStart:h}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Wi(this,void 0,void 0,function(){var a,t,n;return Oi(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:a}),n=new Mr(t.name,a),a.onMessage=function(o){return t.onMessage(n,o.type,o.payload)},a.onError=function(o){return t.onError(n,o)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Hi({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return _r?this.maxMobileConcurrency:this.maxConcurrency},e}(),Zi=oa,wi=function(){return wi=Object.assign||function(e){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},wi.apply(this,arguments)},ls=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,t=a&&e[a],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},Xo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Ds=function(){function e(a){this.workerPools=new Map,this.props=wi({},Xo),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Hi.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,t;try{for(var n=ls(this.workerPools.values()),r=n.next();!r.done;r=n.next()){var o=r.value;o.destroy()}}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var t,n;this.props=wi(wi({},this.props),a);try{for(var r=ls(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(h){t={error:h}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(a){var t=a.name,n=a.source,r=a.url,o=this.workerPools.get(t);return o||(o=new Zi({name:t,source:n,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),cs=Ds,co=new Map,es=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(t){if(!!Fs(t)){var n=t.data,r=n.type,o=n.payload;a(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var t=co.get(a);t||(t=function(n){if(!!Fs(n)){var r=n.data,o=r.type,u=r.payload;a(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(a){var t=co.get(a);co.delete(a),self.removeEventListener("message",t)},e.postMessage=function(a,t){if(self){var n={source:"Worker thread",type:a,payload:t},r=Si(t);self.postMessage(n,r)}},e}(),ts=es;function Fs(e){var a=e.type,t=e.data;return a==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function lc(e){return JSON.parse(eu(e))}function eu(e){var a=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(a.has(n))try{return JSON.parse(JSON.stringify(n))}catch(r){return}a.add(n)}return n})}function Xu(e){return""+e.name}function Cu(e,a){a===void 0&&(a={});var t=a[e.id]||{},n=e.name+".worker.js",r=t.workerUrl;return a._workerType==="test"&&(r=e.module+"/dist/"+n),r||(r="https://unpkg.com/"+e.module+"/dist/"+n),assert(r),r}var Of=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function d(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,d)}m((n=n.apply(e,a||[])).next())})},cc=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return d([m,b])}}function d(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};function Wl(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function Tl(e,a,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Of(this,void 0,void 0,function(){var r,o,u,h,d,m,b,A;return cc(this,function(P){switch(P.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),h=u.getWorkerPool({name:r,url:o}),d=t.jobName||e.name,[4,h.startJob(d,Rf.bind(null,n))];case 1:return m=P.sent(),b=removeNontransferableOptions(t),m.postMessage("process",{input:a,options:b}),[4,m.result];case 2:return A=P.sent(),[2,A.result]}})})}function Rf(e,a,t,n){return Of(this,void 0,void 0,function(){var r,o,u,h,d,m,b;return cc(this,function(A){switch(A.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(n),[3,9];case 2:return a.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,h=n.options,A.label=4;case 4:return A.trys.push([4,6,,7]),e.process?[4,e.process(u,h)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return d=A.sent(),a.postMessage("done",{id:o,result:d}),[3,7];case 6:return m=A.sent(),b=m instanceof Error?m.message:"unknown error",a.postMessage("error",{id:o,error:b}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),A.label=9;case 9:return[2]}})})}var fl=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();a instanceof Error?t.reject(a):t.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,r){a._settlers.push({resolve:n,reject:r})})},e}(),fc=fl,Xl=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function d(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,d)}m((n=n.apply(e,a||[])).next())})},fs=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return d([m,b])}}function d(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Ml=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],t;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(u){return new Promise(function(h,d){u=e[o](u),r(h,d,u.done,u.value)})}}function r(o,u,h,d){Promise.resolve(d).then(function(m){o({value:m,done:h})},u)}},Dc=0,Bs,za;function Du(e,a){var t=this;if(typeof self!="undefined"){var n={process:Xs};ts.onmessage=function(r,o){return Xl(t,void 0,void 0,function(){var u,h,d,m,b,A,P,L,B,Z,j;return fs(this,function(J){switch(J.label){case 0:switch(J.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return h=J.sent(),ts.postMessage("done",{result:h}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");Bs=new fc,za=o.options||{},d=a(Bs,za,n),J.label=4;case 4:J.trys.push([4,9,10,15]),m=Ml(d),J.label=5;case 5:return[4,m.next()];case 6:if(b=J.sent(),!!b.done)return[3,8];A=b.value,ts.postMessage("output-batch",{result:A}),J.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return P=J.sent(),Z={error:P},[3,15];case 10:return J.trys.push([10,,13,14]),b&&!b.done&&(j=m.return)?[4,j.call(m)]:[3,12];case 11:J.sent(),J.label=12;case 12:return[3,14];case 13:if(Z)throw Z.error;return[7];case 14:return[7];case 15:return ts.postMessage("done",{}),[3,18];case 16:return Bs.push(o.input),[3,18];case 17:return Bs.close(),[3,18];case 18:return[3,20];case 19:return L=J.sent(),B=L instanceof Error?L.message:"",ts.postMessage("error",{error:B}),[3,20];case 20:return[2]}})})}}}function Xs(e,a){return a===void 0&&(a={}),new Promise(function(t,n){var r=Dc++,o=function(h,d){if(d.id===r)switch(h){case"done":ts.removeEventListener(o),t(d.result);break;case"error":ts.removeEventListener(o),n(d.error);break;default:}};ts.addEventListener(o);var u={id:r,input:e,options:a};ts.postMessage("process",u)})}var hc=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function d(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,d)}m((n=n.apply(e,a||[])).next())})},ah=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return d([m,b])}}function d(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Df={};function Ep(e,a,t){return a===void 0&&(a=null),t===void 0&&(t={}),hc(this,void 0,void 0,function(){return ah(this,function(n){switch(n.label){case 0:return a&&(e=Yu(e,a,t)),Df[e]=Df[e]||Fc(e),[4,Df[e]];case 1:return[2,n.sent()]}})})}function Yu(e,a,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Fc(e){return hc(this,void 0,void 0,function(){var a,t,n;return ah(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=r.sent(),[4,a.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return n=r.sent(),[2,Su(n,e)]}})})}function Su(e,a){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=a;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Ff="0.0.3",oh={id:"null",name:"null",module:"web-worker-helper",options:{}},Yl=ue(75174),Ns=ue.n(Yl);function Bf(e,a){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function Il(e,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Oh(e,a){var t=e.filter;return t?[1]:[0]}function tu(e,a,t,n){return[a]}var sh=ue(9187),Fu=ue.n(sh),ae=ue(96156),cn=ue(31437),uh=cn.Ue(),kv=cn.Ue(),Io=cn.Ue(),hl=cn.Ue(),lh=cn.Ue();function Xp(e,a,t,n,r){cn.IH(e,t,n),cn.Fv(e,e),a=cn.al(-e[1],e[0]);var o=cn.al(-t[1],t[0]);return[r/cn.AK(a,o),a]}function zs(e,a){return cn.t8(e,-a[1],a[0])}function Au(e,a,t){return cn.lu(e,a,t),cn.Fv(e,e),e}function Cd(e,a){return e[0]===a[0]&&e[1]===a[1]}function Jd(e){for(var a=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(t,1),t++):a.set(n,n)}return e}var Sd=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ht.Z)(this,e),(0,ae.Z)(this,"lastFlip",-1),(0,ae.Z)(this,"miter",cn.al(0,0)),(0,ae.Z)(this,"started",!1),(0,ae.Z)(this,"dash",!1),(0,ae.Z)(this,"totalDistance",0),(0,ae.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Rt.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var d,m,b,A=t[h-1];A.push((d=n[h-1][2])!==null&&d!==void 0?d:0);var P=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,V.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,j=h<n.length-1?n[h+1]:null,J=this.segment_gaode2(r,u,A,L,Z,P,B,j);u+=J}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var d,m,b,A=t[h-1];A.push((d=n[h-1][2])!==null&&d!==void 0?d:0);var P=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,V.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,j=h<n.length-1?n[h+1]:null,J=this.simpleSegment(r,u,A,L,Z,P,B,j);u+=J}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],d=t[u],m=u<t.length-1?t[u+1]:null,b=this.segment(n,o,h,d,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],d=t[u],m=u<t.length-1?t[u+1]:null,b=this.simpleSegment(n,o,h,d,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,r,o,u,h,d,m){var b=0,A=t.indices,P=t.positions,L=t.normals,B=this.cap==="square",Z=this.join==="bevel",j=Ao([d[0],d[1]]),J=Ao([h[0],h[1]]);Au(Io,o,r);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(j,J),this.totalDistance+=fe),this.normal||(this.normal=cn.Ue(),zs(this.normal,Io)),!this.started)if(this.started=!0,B){var Ce=cn.Ue(),Ve=cn.Ue();cn.IH(Ce,this.normal,Io),cn.IH(Ve,this.normal,Io),L.push(Ve[0],Ve[1],0),L.push(Ce[0],Ce[1],0),P.push(r[0],r[1],r[2]|0,this.totalDistance-fe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),P.push(r[0],r[1],r[2]|0,this.totalDistance-fe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,L,r,this.normal,this.thickness,this.totalDistance-fe);if(A.push(n+0,n+1,n+2),u){Cd(o,u)&&cn.IH(u,o,cn.Fv(u,cn.$X(u,o,r))),Au(hl,u,o);var Bt=Xp(lh,cn.Ue(),Io,hl,this.thickness),Xt=(0,Pr.Z)(Bt,2),cr=Xt[0],Ir=Xt[1],wr=cn.AK(lh,this.normal)<0?-1:1,Qr=Z;if(!Qr&&this.join==="miter"){var Fn=cr;Fn>this.miterLimit&&(Qr=!0)}Qr?(L.push(this.normal[0],this.normal[1],0),L.push(Ir[0],Ir[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,V.Z)(this.lastFlip!==-wr?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),zs(uh,hl),cn.JG(this.normal,uh),L.push(this.normal[0],this.normal[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(P,L,o,Ir,cr,this.totalDistance),A.push.apply(A,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wr=-1,cn.JG(this.normal,Ir),b+=2),this.lastFlip=wr}else{if(zs(this.normal,Io),B){var tt=cn.Ue(),st=cn.Ue();cn.lu(st,Io,this.normal),cn.IH(tt,Io,this.normal),L.push(st[0],st[1],0),L.push(tt[0],tt[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,L,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"simpleSegment",value:function(t,n,r,o,u){var h=0,d=t.indices,m=t.positions,b=t.normals,A=Ao([o[0],o[1]]),P=Ao([r[0],r[1]]);Au(Io,A,P);var L=0;if(this.dash&&(L=this.lineSegmentDistance(A,P),this.totalDistance+=L),this.normal||(this.normal=cn.Ue(),zs(this.normal,Io)),this.started||(this.started=!0,this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-L)),d.push(n+0,n+1,n+2),!u)zs(this.normal,Io),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2;else{var B=Ao([u[0],u[1]]);Cd(A,B)&&cn.IH(B,A,cn.Fv(B,cn.$X(B,A,P))),Au(hl,B,A);var Z=Xp(lh,cn.Ue(),Io,hl,this.thickness),j=(0,Pr.Z)(Z,2),J=j[0],fe=j[1],Ce=cn.AK(lh,this.normal)<0?-1:1;this.extrusions(m,b,o,fe,J,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ce=-1,cn.JG(this.normal,fe),h+=2,this.lastFlip=Ce}return h}},{key:"segment",value:function(t,n,r,o,u){var h=0,d=t.indices,m=t.positions,b=t.normals,A=this.cap==="square",P=this.join==="bevel",L=Ao([o[0],o[1]]),B=Ao([r[0],r[1]]);Au(Io,L,B);var Z=0;if(this.dash&&(Z=this.lineSegmentDistance(L,B),this.totalDistance+=Z),this.normal||(this.normal=cn.Ue(),zs(this.normal,Io)),!this.started)if(this.started=!0,A){var j=cn.Ue(),J=cn.Ue();cn.IH(j,this.normal,Io),cn.IH(J,this.normal,Io),b.push(J[0],J[1],0),b.push(j[0],j[1],0),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-Z);if(d.push(n+0,n+1,n+2),u){var Ve=Ao([u[0],u[1]]);Cd(L,Ve)&&cn.IH(Ve,L,cn.Fv(Ve,cn.$X(Ve,L,B))),Au(hl,Ve,L);var tt=Xp(lh,cn.Ue(),Io,hl,this.thickness),st=(0,Pr.Z)(tt,2),Bt=st[0],Xt=st[1],cr=cn.AK(lh,this.normal)<0?-1:1,Ir=P;if(!Ir&&this.join==="miter"){var wr=Bt;wr>this.miterLimit&&(Ir=!0)}Ir?(b.push(this.normal[0],this.normal[1],0),b.push(Xt[0],Xt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,d.push.apply(d,(0,V.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),d.push(n+2,n+3,n+4),zs(uh,hl),cn.JG(this.normal,uh),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(m,b,o,Xt,Bt,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,cn.JG(this.normal,Xt),h+=2),this.lastFlip=cr}else{if(zs(this.normal,Io),A){var fe=cn.Ue(),Ce=cn.Ue();cn.lu(Ce,Io,this.normal),cn.IH(fe,Io,this.normal),b.push(Ce[0],Ce[1],0),b.push(fe[0],fe[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2}return h}},{key:"extrusions",value:function(t,n,r,o,u,h){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,h,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,h,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}();function Rh(e){var a=e.coordinates,t=e.originCoordinates,n=e.version,r=new Sd({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var h=0;h<o.length;h++){var d=o[h],m=u[h];r.extrude_gaode2(d,m)}}else{var b=a;b[0]&&!Array.isArray(b[0][0])&&(b=[a]),b.forEach(function(P){r.extrude(P)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function pc(e){var a=Wu(e.coordinates);return{vertices:[].concat((0,V.Z)(a),(0,V.Z)(a),(0,V.Z)(a),(0,V.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function ch(e){var a=e.coordinates,t=Fu().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(n,o,r),vertices:n,size:r}}var Nf=function(){var e=(0,xa.Z)(di().mark(function a(t){var n,r,o,u,h,d,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,h={a_Color:Bf,a_Position:Il,filter:Oh,a_vertexId:tu,a_PickingColor:function(Z,j){var J=Z.id;return o?z(J):[0,0,0]},a_DistanceAndIndex:function(Z,j,J,fe,Ce,Ve){return Ve===void 0?[J[3],10]:[J[3],Ve]},a_Total_Distance:function(Z,j,J,fe){return[J[5]]},a_Size:function(Z,j,J,fe){var Ce=Z.size,Ve=Ce===void 0?1:Ce;return Array.isArray(Ve)?[Ve[0],Ve[1]]:[Ve,0]},a_Normal:function(Z,j,J,fe,Ce){return Ce},a_Miter:function(Z,j,J,fe){return[J[4]]},a_iconMapUV:function(Z,j,J,fe){var Ce=Z.texture,Ve=u[Ce]||{x:0,y:0},tt=Ve.x,st=Ve.y;return[tt,st]}},d={sizePerElement:0,elements:[]},m=0,b=[],A=3,r.forEach(function(B,Z){var j=Rh(B),J=j.indices,fe=j.vertices,Ce=j.normals,Ve=j.size,tt=j.indexes;J.forEach(function(cr){b.push(cr+m)}),A=Ve;var st=fe.length/Ve;d.sizePerElement=A,d.elements.push({featureIdx:Z,vertices:fe,normals:Ce,offset:m}),m+=st;for(var Bt=function(Ir){var wr=(Ce==null?void 0:Ce.slice(Ir*3,Ir*3+3))||[],Qr=fe.slice(Ir*Ve,Ir*Ve+Ve),Fn=0;tt&&tt[Ir]!==void 0&&(Fn=tt[Ir]),n.forEach(function(ci,Ba){if(ci&&h[ci.name]){var Ya;(Ya=ci.buffer.data).push.apply(Ya,(0,V.Z)(h[ci.name](B,Z,Qr,Ir,wr,Fn)))}})},Xt=0;Xt<st;Xt++)Bt(Xt)}),L.abrupt("return",{descriptors:n,featureLayout:d,indices:b});case 8:case"end":return L.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),hs=function(){var e=(0,xa.Z)(di().mark(function a(t){var n,r,o,u,h,d,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,h={a_Color:Bf,a_Position:Il,filter:Oh,a_vertexId:tu,a_PickingColor:function(Z,j){var J=Z.id;return o?z(J):[0,0,0]},a_Shape:function(Z,j,J,fe){var Ce=Z.shape,Ve=Ce===void 0?2:Ce,tt=u.indexOf(Ve);return[tt]},a_Extrude:function(Z,j,J,fe){var Ce=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ve=fe%4*3;return[Ce[Ve],Ce[Ve+1],Ce[Ve+2]]},a_Size:function(Z,j,J,fe){var Ce=Z.size,Ve=Ce===void 0?5:Ce;return Array.isArray(Ve)?[Ve[0]]:[Ve]}},d={sizePerElement:0,elements:[]},m=0,b=[],A=3,r.forEach(function(B,Z){var j=pc(B),J=j.indices,fe=j.vertices,Ce=j.normals,Ve=j.size,tt=j.indexes;J.forEach(function(cr){b.push(cr+m)}),A=Ve;var st=fe.length/Ve;d.sizePerElement=A,d.elements.push({featureIdx:Z,vertices:fe,normals:Ce,offset:m}),m+=st;for(var Bt=function(Ir){var wr=(Ce==null?void 0:Ce.slice(Ir*3,Ir*3+3))||[],Qr=fe.slice(Ir*Ve,Ir*Ve+Ve),Fn=0;tt&&tt[Ir]!==void 0&&(Fn=tt[Ir]),n.forEach(function(ci,Ba){if(ci&&h[ci.name]){var Ya;(Ya=ci.buffer.data).push.apply(Ya,(0,V.Z)(h[ci.name](B,Z,Qr,Ir,wr,Fn)))}})},Xt=0;Xt<st;Xt++)Bt(Xt)}),L.abrupt("return",{descriptors:n,featureLayout:d,indices:b});case 8:case"end":return L.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Cp=function(){var e=(0,xa.Z)(di().mark(function a(t){var n,r,o,u,h,d,m,b;return di().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:Bf,a_Position:Il,filter:Oh,a_vertexId:tu,a_PickingColor:function(B,Z){var j=B.id;return o?z(j):[0,0,0]}},h={sizePerElement:0,elements:[]},d=0,m=[],b=3,r.forEach(function(L,B){var Z=ch(L),j=Z.indices,J=Z.vertices,fe=Z.normals,Ce=Z.size,Ve=Z.indexes;j.forEach(function(Xt){m.push(Xt+d)}),b=Ce;var tt=J.length/Ce;h.sizePerElement=b,h.elements.push({featureIdx:B,vertices:J,normals:fe,offset:d}),d+=tt;for(var st=function(cr){var Ir=(fe==null?void 0:fe.slice(cr*3,cr*3+3))||[],wr=J.slice(cr*Ce,cr*Ce+Ce),Qr=0;Ve&&Ve[cr]!==void 0&&(Qr=Ve[cr]),n.forEach(function(Fn,ci){if(Fn&&u[Fn.name]){var Ba;(Ba=Fn.buffer.data).push.apply(Ba,(0,V.Z)(u[Fn.name](L,B,wr,cr,Ir,Qr)))}})},Bt=0;Bt<tt;Bt++)st(Bt)}),P.abrupt("return",{descriptors:n,featureLayout:h,indices:m});case 8:case"end":return P.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Yp={pointFill:hs,line:Nf,polygonFill:Cp},Xi=(0,Q.Z)({},Yp);function qp(e){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,xa.Z)(di().mark(function e(a){var t,n;return di().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.workerType,n=a.data,!Xi[t]){o.next=3;break}return o.abrupt("return",Xi[t](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Dh.apply(this,arguments)}Du(qp);var Bc=new Map;function Sp(e,a){Bc.set(e,a)}function Pl(e){var a=Bc.get(e);return a}var af="l7-worker",of=3,$p=!0;function fh(e){Sp(af,e)}function dc(){var e=Pl(af);if(!e)throw new Error("get worker failed by workerName: ".concat(af,"."));return e}function Ap(e,a){return Qh.apply(this,arguments)}function Qh(){return Qh=(0,xa.Z)(di().mark(function e(a,t){var n,r,o,u,h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=dc(),r=cs.getWorkerFarm({maxConcurrency:of,reuseWorkers:$p}),o=r.getWorkerPool({name:af,source:n}),m.next=5,o.startJob(af,function(b,A,P){return b.done(P)});case 5:return u=m.sent,u.postMessage("process",{input:{workerType:a,data:t}}),m.next=9,u.result;case 9:return h=m.sent,m.abrupt("return",h.result);case 11:case"end":return m.stop()}},e)})),Qh.apply(this,arguments)}fh(Ns());var vc={BACK:1029,FRONT:1028};function sf(e){switch(e){case"GAODE1.x":return vc.BACK;case"GAODE2.x":return vc.BACK;case"MAPBOX":return vc.FRONT;case"SIMPLE":return vc.FRONT;case"GLOBEL":return vc.BACK;case"L7MAP":return vc.FRONT;default:return vc.FRONT}}function kl(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function hh(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=a.x,n=a.y,r=a.z;if(Array.isArray(e)){var o=Math.abs(t+n)%e.length;e=e[o]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,r.toString()).replace(/\{-y\}/g,(Math.pow(2,r)-n-1).toString())}var uf;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(uf||(uf={}));var Bu;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Bu||(Bu={}));function ph(e,a){a===void 0&&(a={});var t=Number(e[0]),n=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,n],h=[t,o],d=[r,o],m=[r,n];return en([[u,m,d,h,u]],a.properties,{bbox:e,id:a.id})}var wp=0,Nc=1,lf=2;function Ad(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function zf(e){e.forEach(function(a){a.properties.state=wp}),e.forEach(function(a){a.isCurrent&&!mc(a)&&ql(a)}),e.forEach(function(a){a.isVisible=Boolean(a.properties.state&lf)})}function wd(e){e.forEach(function(t){t.properties.state=wp}),e.forEach(function(t){t.isCurrent&&mc(t)});var a=e.slice().sort(function(t,n){return t.z-n.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&lf),t.children.length&&(t.isVisible||t.properties.state&Nc)?t.children.forEach(function(n){n.properties.state=Nc}):t.isCurrent&&ql(t)})}function mc(e){for(;e;){if(e.isLoaded)return e.properties.state|=lf,!0;e=e.parent}return!1}function ql(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=lf:ql(a)})}var Us,Uf=256,zc=[-Infinity,-Infinity,Infinity,Infinity],Fh=.2,Uc=5,Tp=(Us={},(0,ae.Z)(Us,uf.Realtime,Ad),(0,ae.Z)(Us,uf.Overlap,zf),(0,ae.Z)(Us,uf.Replace,wd),Us),Lv=function(){};function gc(e,a,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,r]}function dh(e,a,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}var vh=function(a,t,n){var r=dh(a,t,n),o=(0,Pr.Z)(r,2),u=o[0],h=o[1],d=dh(a+1,t+1,n),m=(0,Pr.Z)(d,2),b=m[0],A=m[1];return[u,A,b,h]};function Zf(e){var a=e.zoom,t=e.latLonBounds,n=e.maxZoom,r=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,h=e.zoomOffset,d=h===void 0?0:h,m=e.extent,b=m===void 0?zc:m,A=Math.ceil(a)+d;if(Number.isFinite(u)&&A<u)return[];Number.isFinite(r)&&A>r&&(A=r);for(var P=(0,Pr.Z)(t,4),L=P[0],B=P[1],Z=P[2],j=P[3],J=[Math.max(L,b[0]),Math.max(B,b[1]),Math.min(Z,b[2]),Math.min(j,b[3])],fe=[],Ce=gc(J[0],J[1],A),Ve=(0,Pr.Z)(Ce,2),tt=Ve[0],st=Ve[1],Bt=gc(J[2],J[3],A),Xt=(0,Pr.Z)(Bt,2),cr=Xt[0],Ir=Xt[1],wr=tt;wr<=cr;wr++)for(var Qr=Ir;Qr<=st;Qr++)fe.push({x:wr,y:Qr,z:A});var Fn=(cr+tt)/2,ci=(st+Ir)/2,Ba=function(Is,Iu){return Math.abs(Is-Fn)+Math.abs(Iu-ci)};return fe.sort(function(Ya,Is){return Ba(Ya.x,Ya.y)-Ba(Is.x,Is.y)}),fe}var Td=function(a,t,n){var r=Math.pow(2,n),o=r-1,u=r,h=a,d=t;return h<0?h=h+u:h>o&&(h=h%u),{warpX:h,warpY:d}},Kp=function(){function e(a){(0,Ht.Z)(this,e),(0,ae.Z)(this,"tileSize",256),(0,ae.Z)(this,"isVisible",!1),(0,ae.Z)(this,"isCurrent",!1),(0,ae.Z)(this,"isVisibleChange",!1),(0,ae.Z)(this,"parentLayerIDList",[]),(0,ae.Z)(this,"layerIDList",[]),(0,ae.Z)(this,"parent",null),(0,ae.Z)(this,"children",[]),(0,ae.Z)(this,"data",null),(0,ae.Z)(this,"properties",{}),(0,ae.Z)(this,"loadDataId",0);var t=a.x,n=a.y,r=a.z,o=a.tileSize;this.x=t,this.y=n,this.z=r,this.tileSize=o}return(0,Rt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===Bu.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Bu.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Bu.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Bu.Cancelled}},{key:"isDone",get:function(){return[Bu.Loaded,Bu.Cancelled,Bu.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return vh(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Pr.Z)(this.bounds,4),n=t[0],r=t[1],o=t[2],u=t[3],h=[(o-n)/2,(u-r)/2],d=ph(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:h,meta:`
      `.concat(this.key,`
      `)}});return d}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var a=(0,xa.Z)(di().mark(function n(r){var o,u,h,d,m,b,A,P,L,B,Z,j,J,fe,Ce,Ve;return di().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:return o=r.getData,u=r.onLoad,h=r.onError,this.loadDataId++,d=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Bu.Loading,m=null,st.prev=7,A=this.x,P=this.y,L=this.z,B=this.bounds,Z=this.tileSize,j=Td(A,P,L),J=j.warpX,fe=j.warpY,Ce=this.abortController.signal,Ve={x:J,y:fe,z:L,bounds:B,tileSize:Z,signal:Ce},st.next=14,o(Ve,this);case 14:m=st.sent,st.next=20;break;case 17:st.prev=17,st.t0=st.catch(7),b=st.t0;case 20:if(d===this.loadDataId){st.next=22;break}return st.abrupt("return");case 22:if(!(this.isCancelled&&!m)){st.next=24;break}return st.abrupt("return");case 24:if(!(b||!m)){st.next=28;break}return this.loadStatus=Bu.Failure,h(b,this),st.abrupt("return");case 28:this.loadStatus=Bu.Loaded,this.data=m,u(this);case 31:case"end":return st.stop()}},n,this,[[7,17]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Bu.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),qu=ue(26729),Mp=ue.n(qu),so=function(a,t){var n=rf(a),r=cl(n,t),o=360*3-180,u=85.0511287798065,h=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return h},Zc=function(a,t){var n=rf(a),r=rf(t),o=oc(n,r);return o};function Ja(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zs(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Zs(e,a){if(!!e){if(typeof e=="string")return Qp(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qp(e,a)}}function Qp(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Jp(e){var a=ev();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tv=function(e){(0,Or.Z)(t,e);var a=Jp(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this),(0,ae.Z)((0,At.Z)(r),"currentTiles",[]),(0,ae.Z)((0,At.Z)(r),"cacheTiles",new Map),(0,ae.Z)((0,At.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,ae.Z)((0,At.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,ae.Z)((0,At.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:zc,getTileData:Lv,updateStrategy:uf.Replace},r.updateOptions(n),r}return(0,Rt.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,Q.Z)((0,Q.Z)((0,Q.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,h=Math.ceil(r);if(!(this.lastViewStates&&this.lastViewStates.zoom===h&&Zc(this.lastViewStates.latLonBoundsBuffer,o))){var d=so(o,Fh);this.lastViewStates={zoom:h,latLonBounds:o,latLonBoundsBuffer:d};var m=!1,b=this.getTileIndices(h,d);this.currentTiles=b.map(function(A){var P=A.x,L=A.y,B=A.z,Z=u.getTile(P,L,B);if(Z){var j,J,fe=((j=Z)===null||j===void 0?void 0:j.isFailure)||((J=Z)===null||J===void 0?void 0:J.isCancelled);return fe&&Z.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),Z}return Z=u.createTile(P,L,B),m=!0,Z}),m&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=Ja(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,Pr.Z)(o.value,2),h=u[0],d=u[1];this.currentTiles.includes(d)||(this.cacheTiles.delete(h),this.onTileUnload(d)),this.onTileUnload(d),d.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(m){r.e(m)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=Ja(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var h=u.value;h.isLoading&&!h.isCurrent&&!h.isVisible&&r.push(h)}}catch(m){o.e(m)}finally{o.f()}for(;r.length>0;){var d=r.shift();d.abortLoad()}}},{key:"destroy",value:function(){var r=Ja(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(h){r.e(h)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=Ja(this.cacheTiles.values()),h;try{for(u.s();!(h=u.n()).done;){var d=h.value;o.set(d.key,d.isVisible),d.isCurrent=!1,d.isVisible=!1}}catch(B){u.e(B)}finally{u.f()}var m=Ja(this.currentTiles),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.isCurrent=!0,A.isVisible=!0}}catch(B){m.e(B)}finally{m.f()}var P=Array.from(this.cacheTiles.values());typeof r=="function"?r(P):Tp[r](P);var L=!1;Array.from(this.cacheTiles.values()).forEach(function(B){B.isVisible!==o.get(B.key)?(B.isVisibleChange=!0,L=!0):B.isVisibleChange=!1}),L&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,h=u.tileSize,d=u.extent,m=u.zoomOffset,b=Math.floor(this.options.maxZoom),A=Math.ceil(this.options.minZoom),P=Zf({maxZoom:b,minZoom:A,zoomOffset:m,tileSize:h,zoom:r,latLonBounds:o,extent:d});return P}},{key:"getTileId",value:function(r,o,u){var h="".concat(r,",").concat(o,",").concat(u);return h}},{key:"getTile",value:function(r,o,u){var h=this.getTileId(r,o,u),d=this.cacheTiles.get(h);return d}},{key:"createTile",value:function(r,o,u){var h=this.getTileId(r,o,u),d=new Kp({x:r,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(h,d),d.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),d}},{key:"resizeCacheTiles",value:function(){var r=Uc*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=Ja(this.cacheTiles),h;try{for(u.s();!(h=u.n()).done;){var d=(0,Pr.Z)(h.value,2),m=d[0],b=d[1];if(!b.isVisible&&!this.currentTiles.includes(b)&&(this.cacheTiles.delete(m),this.onTileUnload(b)),this.cacheTiles.size<=r)break}}catch(A){u.e(A)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var r=Ja(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(A){r.e(A)}finally{r.f()}var h=Ja(this.cacheTiles.values()),d;try{for(h.s();!(d=h.n()).done;){var m=d.value,b=this.getNearestAncestor(m.x,m.y,m.z);m.parent=b,b!=null&&b.children&&b.children.push(m)}}catch(A){h.e(A)}finally{h.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var h=this.getTile(r,o,u);if(h)return h}return null}}]),t}(Mp()),Ip;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ip||(Ip={}));function Md(e,a,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,h=t;return u&&(h=Math.round(t*(o-1))/(o-1)),n?Id(e,a,h,n,r):Id(e,a,h,.314,r)}function Pp(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function Ov(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function Jh(e,a,t){var n=[a[0]-e[0],a[1]-e[1]],r=Ov(n,[0,0]),o=Math.atan2(n[1],n[0]),u=r/2/Math.cos(t),h=o+t,d=[u*Math.cos(h)+e[0],u*Math.sin(h)+e[1]];return d}function Id(e,a,t,n,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(a[0],a[1]),h=Jh(o,u,n),d=[o[0],h[0],u[0]],m=[o[1],h[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Pp(d,t),Pp(m,t))),[0])}else{var b=Jh(e,a,n),A=[e[0],b[0],a[0]],P=[e[1],b[1],a[1]];return[Pp(A,t),Pp(P,t),0]}}function Rv(e,a,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,h=t;return u&&(h=Math.round(t*29)/29),Vc(e,a,h,r)}function mh(e,a){var t=[a[0]-e[0],a[1]-e[1]],n=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=n/2/Math.cos(o),h=r+o,d=[u*Math.cos(h)+e[0],u*Math.sin(h)+e[1]];return d}function Eo(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function ed(e,a){var t=[e[0]-a[0],e[1]-a[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=n[1]*n[1]+Math.cos(e[1])*Math.cos(a[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function Vc(e,a,t,n){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(n==="GAODE2.x"){var u=mh(r,o),h=[r[0],u[0],o[0]],d=[r[1],u[1],o[1]];return[Eo(h,t),Eo(d,t),0]}else{var m=ed(r,o);if(Math.abs(m-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var b=Math.sin((1-t)*m)/Math.sin(m),A=Math.sin(t*m)/Math.sin(m),P=[Math.sin(r[0]),Math.sin(r[1])],L=[Math.cos(r[0]),Math.cos(r[1])],B=[Math.sin(o[0]),Math.sin(o[1])],Z=[Math.cos(o[0]),Math.cos(o[1])],j=b*L[1]*L[0]+A*Z[1]*Z[0],J=b*L[1]*P[0]+A*Z[1]*B[0],fe=b*P[1]+A*B[1];return[radiansToDegrees(Math.atan2(J,j)),radiansToDegrees(Math.atan2(fe,Math.sqrt(j*j+J*J)))]}}function ep(e,a){for(var t=0,n=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],h=td(o,u),d=t;t+=h,n.push({p1:o,p2:u,totalDistance:t,distance:h,lastTotalDistance:d})}for(var m=t*a,b,A,P=0;P<n.length;P++){var L=n[P].totalDistance;if(L>m){var B=n[P].p1,Z=n[P].p2,j=(m-n[P].lastTotalDistance)/n[P].distance,J=Pd(Z,B,j);b=J[0],A=J[1];break}}return{_lng:b,_lat:A,_height:0}}function Pd(e,a,t){return[e[0]*t+a[0]*(1-t),e[1]*t+a[1]*(1-t)]}function td(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function W(e,a){var t=a.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(r){var o=r._id;return o===t})),n.map(function(r){var o=ut(r,a);return _objectSpread(_objectSpread({},r),o)})}function De(e,a){return new Promise(function(t,n){e.inited?t(W(e,a)):e.once("sourceUpdate",function(){t(W(e,a))})})}function ut(e,a){var t=a.offset,n=a.shape,r=a.thetaOffset,o=a.mapVersion,u=a.segmentNumber,h=u===void 0?30:u,d=a.autoFit,m=d===void 0?!0:d,b=e.coordinates;if(n==="line")return pathLineAtOffset(b,t);var A=b[0],P=b[1],L;typeof r=="string"?L=e[r]||0:L=r;var B;switch(n){case"arc":B=arcLineAtOffset;break;case"greatcircle":B=greatCircleLineAtOffset;break;default:B=arcLineAtOffset}var Z=B(A,P,t,L,o,h,m),j=_slicedToArray(Z,3),J=j[0],fe=j[1],Ce=j[2];return{_lng:J,_lat:fe,_height:Ce}}function dr(e,a){var t=a.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||eh(e)?u([e]):zr(e,function(h){u(h)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function zr(e,a){var t=e,n=[];if(typeof t=="string")kf({url:t},function(u,h){h&&(n.push(h),a(n))});else{var r=t.length,o=0;t.forEach(function(u){kf({url:u},function(h,d){o++,d&&n.push(d),o===r&&a(n)})})}return dr}var pr=ue(38929),Lr=ue(3614),Gr=ue.n(Lr),qr={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},nn=512;function dn(e,a,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}function vn(e){for(var a=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function kn(e){var a=e.length;if(a<=1)return[e];for(var t=[],n,r,o=0;o<a;o++){var u=vn(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var an=["Unknown","Point","LineString","Polygon"];function hn(e,a){var t=a.extent,n=a.loadGeometry(),r=a.type,o=a.properties,u=a.id,h=t*Math.pow(2,e),d=an[r],m,b;function A(B){for(var Z=0;Z<B.length;Z++){var j=B[Z];B[Z]=[j.x/h*nn,j.y/h*nn]}}switch(r){case 1:var P=[];for(m=0;m<n.length;m++)P[m]=n[m][0];n=P,A(n);break;case 2:for(m=0;m<n.length;m++)A(n[m]);break;case 3:for(n=kn(n),m=0;m<n.length;m++)for(b=0;b<n[m].length;b++)A(n[m][b]);break}n.length===1?n=n[0]:d="Multi"+d;var L={type:"Feature",geometry:{type:d,coordinates:n},properties:o,id:u,tileOrigin:[0,0],coord:""};return L}var Zt=function(){var e=(0,xa.Z)(di().mark(function a(t,n,r,o){var u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return u=hh(t,n),d.abrupt("return",new Promise(function(m){var b=Gl({url:u},function(A,P){if(A||!P)m({layers:{}});else{for(var L=new pr.VectorTile(new(Gr())(P)),B=dn(n.x,n.y,n.z),Z=n.z,j=0,J=Object.keys(L.layers);j<J.length;j++){for(var fe=J[j],Ce=[],Ve=L.layers[fe],tt=0;tt<L.layers[fe].length;tt++){var st=L.layers[fe].feature(tt),Bt=void 0;o==="lnglat"?Bt=st.toGeoJSON(n.x,n.y,n.z):(Bt=hn(Z,st),Ve.l7TileOrigin=B,Ve.l7TileCoord=o),Ce.push(Bt)}Ve.features=Ce}m(L)}});r.xhrCancel=function(){return b.abort()}}));case 2:case"end":return d.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function Cr(e,a){var t=(a==null?void 0:a.coord)||"lnglat",n=function(u,h){return Zt(e,u,h,t)},r=(0,Q.Z)((0,Q.Z)((0,Q.Z)({},qr),a),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function rn(e,a,t,n){for(var r=n,o=t-a>>1,u=t-a,h,d=e[a],m=e[a+1],b=e[t],A=e[t+1],P=a+3;P<t;P+=3){var L=On(e[P],e[P+1],d,m,b,A);if(L>r)h=P,r=L;else if(L===r){var B=Math.abs(P-o);B<u&&(h=P,u=B)}}r>n&&(h-a>3&&rn(e,a,h,n),e[h+2]=r,t-h>3&&rn(e,h,t,n))}function On(e,a,t,n,r,o){var u=r-t,h=o-n;if(u!==0||h!==0){var d=((e-t)*u+(a-n)*h)/(u*u+h*h);d>1?(t=r,n=o):d>0&&(t+=u*d,n+=h*d)}return u=e-t,h=a-n,u*u+h*h}function Ur(e,a,t,n){var r={id:typeof e=="undefined"?null:e,type:a,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return _n(r),r}function _n(e){var a=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")Nn(e,a);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<a.length;n++)Nn(e,a[n]);else if(t==="MultiPolygon")for(n=0;n<a.length;n++)for(var r=0;r<a[n].length;r++)Nn(e,a[n][r])}function Nn(e,a){for(var t=0;t<a.length;t+=3)e.minX=Math.min(e.minX,a[t]),e.minY=Math.min(e.minY,a[t+1]),e.maxX=Math.max(e.maxX,a[t]),e.maxY=Math.max(e.maxY,a[t+1])}function Ti(e,a){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)kr(t,e.features[n],a,n);else e.type==="Feature"?kr(t,e,a):kr(t,{geometry:e},a);return t}function kr(e,a,t,n){if(!!a.geometry){var r=a.geometry.coordinates,o=a.geometry.type,u=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),h=[],d=a.id;if(t.promoteId?d=a.properties[t.promoteId]:t.generateId&&(d=n||0),o==="Point")Fr(r,h);else if(o==="MultiPoint")for(var m=0;m<r.length;m++)Fr(r[m],h);else if(o==="LineString")oi(r,h,u,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(m=0;m<r.length;m++)h=[],oi(r[m],h,u,!1),e.push(Ur(d,"LineString",h,a.properties));return}else Rn(r,h,u,!1);else if(o==="Polygon")Rn(r,h,u,!0);else if(o==="MultiPolygon")for(m=0;m<r.length;m++){var b=[];Rn(r[m],b,u,!0),h.push(b)}else if(o==="GeometryCollection"){for(m=0;m<a.geometry.geometries.length;m++)kr(e,{id:d,geometry:a.geometry.geometries[m],properties:a.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Ur(d,o,h,a.properties))}}function Fr(e,a){a.push(on(e[0])),a.push(zn(e[1])),a.push(0)}function oi(e,a,t,n){for(var r,o,u=0,h=0;h<e.length;h++){var d=on(e[h][0]),m=zn(e[h][1]);a.push(d),a.push(m),a.push(0),h>0&&(n?u+=(r*m-d*o)/2:u+=Math.sqrt(Math.pow(d-r,2)+Math.pow(m-o,2))),r=d,o=m}var b=a.length-3;a[2]=1,rn(a,0,b,t),a[b+2]=1,a.size=Math.abs(u),a.start=0,a.end=a.size}function Rn(e,a,t,n){for(var r=0;r<e.length;r++){var o=[];oi(e[r],o,t,n),a.push(o)}}function on(e){return e/360+.5}function zn(e){var a=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return t<0?0:t>1?1:t}function Pn(e,a,t,n,r,o,u,h){if(t/=a,n/=a,o>=t&&u<n)return e;if(u<t||o>=n)return null;for(var d=[],m=0;m<e.length;m++){var b=e[m],A=b.geometry,P=b.type,L=r===0?b.minX:b.minY,B=r===0?b.maxX:b.maxY;if(L>=t&&B<n){d.push(b);continue}else if(B<t||L>=n)continue;var Z=[];if(P==="Point"||P==="MultiPoint")la(A,Z,t,n,r);else if(P==="LineString")Gi(A,Z,t,n,r,!1,h.lineMetrics);else if(P==="MultiLineString")Bn(A,Z,t,n,r,!1);else if(P==="Polygon")Bn(A,Z,t,n,r,!0);else if(P==="MultiPolygon")for(var j=0;j<A.length;j++){var J=[];Bn(A[j],J,t,n,r,!0),J.length&&Z.push(J)}if(Z.length){if(h.lineMetrics&&P==="LineString"){for(j=0;j<Z.length;j++)d.push(Ur(b.id,P,Z[j],b.tags));continue}(P==="LineString"||P==="MultiLineString")&&(Z.length===1?(P="LineString",Z=Z[0]):P="MultiLineString"),(P==="Point"||P==="MultiPoint")&&(P=Z.length===3?"Point":"MultiPoint"),d.push(Ur(b.id,P,Z,b.tags))}}return d.length?d:null}function la(e,a,t,n,r){for(var o=0;o<e.length;o+=3){var u=e[o+r];u>=t&&u<=n&&(a.push(e[o]),a.push(e[o+1]),a.push(e[o+2]))}}function Gi(e,a,t,n,r,o,u){for(var h=Dn(e),d=r===0?ta:Ma,m=e.start,b,A,P=0;P<e.length-3;P+=3){var L=e[P],B=e[P+1],Z=e[P+2],j=e[P+3],J=e[P+4],fe=r===0?L:B,Ce=r===0?j:J,Ve=!1;u&&(b=Math.sqrt(Math.pow(L-j,2)+Math.pow(B-J,2))),fe<t?Ce>t&&(A=d(h,L,B,j,J,t),u&&(h.start=m+b*A)):fe>n?Ce<n&&(A=d(h,L,B,j,J,n),u&&(h.start=m+b*A)):Li(h,L,B,Z),Ce<t&&fe>=t&&(A=d(h,L,B,j,J,t),Ve=!0),Ce>n&&fe<=n&&(A=d(h,L,B,j,J,n),Ve=!0),!o&&Ve&&(u&&(h.end=m+b*A),a.push(h),h=Dn(e)),u&&(m+=b)}var tt=e.length-3;L=e[tt],B=e[tt+1],Z=e[tt+2],fe=r===0?L:B,fe>=t&&fe<=n&&Li(h,L,B,Z),tt=h.length-3,o&&tt>=3&&(h[tt]!==h[0]||h[tt+1]!==h[1])&&Li(h,h[0],h[1],h[2]),h.length&&a.push(h)}function Dn(e){var a=[];return a.size=e.size,a.start=e.start,a.end=e.end,a}function Bn(e,a,t,n,r,o){for(var u=0;u<e.length;u++)Gi(e[u],a,t,n,r,o,!1)}function Li(e,a,t,n){e.push(a),e.push(t),e.push(n)}function ta(e,a,t,n,r,o){var u=(o-a)/(n-a);return e.push(o),e.push(t+(r-t)*u),e.push(1),u}function Ma(e,a,t,n,r,o){var u=(o-t)/(r-t);return e.push(a+(n-a)*u),e.push(o),e.push(1),u}function qo(e,a){var t=a.buffer/a.extent,n=e,r=Pn(e,1,-1-t,t,0,-1,2,a),o=Pn(e,1,1-t,2+t,0,-1,2,a);return(r||o)&&(n=Pn(e,1,-t,1+t,0,-1,2,a)||[],r&&(n=$o(r,1).concat(n)),o&&(n=n.concat($o(o,-1)))),n}function $o(e,a){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Sa(r.geometry,a);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var h=0;h<r.geometry.length;h++)u.push(Sa(r.geometry[h],a))}else if(o==="MultiPolygon")for(u=[],h=0;h<r.geometry.length;h++){for(var d=[],m=0;m<r.geometry[h].length;m++)d.push(Sa(r.geometry[h][m],a));u.push(d)}t.push(Ur(r.id,o,u,r.tags))}return t}function Sa(e,a){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+a,e[n+1],e[n+2]);return t}function Ys(e,a){if(e.transformed)return e;var t=1<<e.z,n=e.x,r=e.y,o,u,h;for(o=0;o<e.features.length;o++){var d=e.features[o],m=d.geometry,b=d.type;if(d.geometry=[],b===1)for(u=0;u<m.length;u+=2)d.geometry.push(wo(m[u],m[u+1],a,t,n,r));else for(u=0;u<m.length;u++){var A=[];for(h=0;h<m[u].length;h+=2)A.push(wo(m[u][h],m[u][h+1],a,t,n,r));d.geometry.push(A)}}return e.transformed=!0,e}function wo(e,a,t,n,r,o){return[Math.round(t*(e*n-r)),Math.round(t*(a*n-o))]}function Vs(e,a,t,n,r){for(var o=a===r.maxZoom?0:r.tolerance/((1<<a)*r.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:a,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},h=0;h<e.length;h++){u.numFeatures++,gs(u,e[h],o,r);var d=e[h].minX,m=e[h].minY,b=e[h].maxX,A=e[h].maxY;d<u.minX&&(u.minX=d),m<u.minY&&(u.minY=m),b>u.maxX&&(u.maxX=b),A>u.maxY&&(u.maxY=A)}return u}function gs(e,a,t,n){var r=a.geometry,o=a.type,u=[];if(o==="Point"||o==="MultiPoint")for(var h=0;h<r.length;h+=3)u.push(r[h]),u.push(r[h+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")As(u,r,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(h=0;h<r.length;h++)As(u,r[h],e,t,o==="Polygon",h===0);else if(o==="MultiPolygon")for(var d=0;d<r.length;d++){var m=r[d];for(h=0;h<m.length;h++)As(u,m[h],e,t,!0,h===0)}if(u.length){var b=a.tags||null;if(o==="LineString"&&n.lineMetrics){b={};for(var A in a.tags)b[A]=a.tags[A];b.mapbox_clip_start=r.start/r.size,b.mapbox_clip_end=r.end/r.size}var P={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:b};a.id!==null&&(P.id=a.id),e.features.push(P)}}function As(e,a,t,n,r,o){var u=n*n;if(n>0&&a.size<(r?u:n)){t.numPoints+=a.length/3;return}for(var h=[],d=0;d<a.length;d+=3)(n===0||a[d+2]>u)&&(t.numSimplified++,h.push(a[d]),h.push(a[d+1])),t.numPoints++;r&&js(h,o),e.push(h)}function js(e,a){for(var t=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)t+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(t>0===a)for(n=0,r=e.length;n<r/2;n+=2){var u=e[n],h=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=u,e[r-1-n]=h}}function vu(e,a){return new zo(e,a)}function zo(e,a){a=this.options=ws(Object.create(this.options),a);var t=a.debug;if(t&&console.time("preprocess data"),a.maxZoom<0||a.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(a.promoteId&&a.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Ti(e,a);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",a.indexMaxZoom,a.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=qo(n,a),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}zo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zo.prototype.splitTile=function(e,a,t,n,r,o,u){for(var h=[e,a,t,n],d=this.options,m=d.debug;h.length;){n=h.pop(),t=h.pop(),a=h.pop(),e=h.pop();var b=1<<a,A=sa(a,t,n),P=this.tiles[A];if(!P&&(m>1&&console.time("creation"),P=this.tiles[A]=Vs(e,a,t,n,d),this.tileCoords.push({z:a,x:t,y:n}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",a,t,n,P.numFeatures,P.numPoints,P.numSimplified),console.timeEnd("creation"));var L="z"+a;this.stats[L]=(this.stats[L]||0)+1,this.total++}if(P.source=e,r){if(a===d.maxZoom||a===r)continue;var B=1<<r-a;if(t!==Math.floor(o/B)||n!==Math.floor(u/B))continue}else if(a===d.indexMaxZoom||P.numPoints<=d.indexMaxPoints)continue;if(P.source=null,e.length!==0){m>1&&console.time("clipping");var Z=.5*d.buffer/d.extent,j=.5-Z,J=.5+Z,fe=1+Z,Ce,Ve,tt,st,Bt,Xt;Ce=Ve=tt=st=null,Bt=Pn(e,b,t-Z,t+J,0,P.minX,P.maxX,d),Xt=Pn(e,b,t+j,t+fe,0,P.minX,P.maxX,d),e=null,Bt&&(Ce=Pn(Bt,b,n-Z,n+J,1,P.minY,P.maxY,d),Ve=Pn(Bt,b,n+j,n+fe,1,P.minY,P.maxY,d),Bt=null),Xt&&(tt=Pn(Xt,b,n-Z,n+J,1,P.minY,P.maxY,d),st=Pn(Xt,b,n+j,n+fe,1,P.minY,P.maxY,d),Xt=null),m>1&&console.timeEnd("clipping"),h.push(Ce||[],a+1,t*2,n*2),h.push(Ve||[],a+1,t*2,n*2+1),h.push(tt||[],a+1,t*2+1,n*2),h.push(st||[],a+1,t*2+1,n*2+1)}}},zo.prototype.getTile=function(e,a,t){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;a=(a%u+u)%u;var h=sa(e,a,t);if(this.tiles[h])return Ys(this.tiles[h],r);o>1&&console.log("drilling down to z%d-%d-%d",e,a,t);for(var d=e,m=a,b=t,A;!A&&d>0;)d--,m=Math.floor(m/2),b=Math.floor(b/2),A=this.tiles[sa(d,m,b)];return!A||!A.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",d,m,b),o>1&&console.time("drilling down"),this.splitTile(A.source,d,m,b,e,a,t),o>1&&console.timeEnd("drilling down"),this.tiles[h]?Ys(this.tiles[h],r):null)};function sa(e,a,t){return((1<<e)*t+a)*32+e}function ws(e,a){for(var t in a)e[t]=a[t];return e}var Za={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function ru(e){for(var a=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function Yi(e){var a=e.length;if(a<=1)return[e];for(var t=[],n,r,o=0;o<a;o++){var u=ru(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var Ia=["Unknown","Point","LineString","Polygon"];function eo(e,a,t,n,r){var o=r.geometry,u=r.type,h=r.tags,d=r.id,m=e*Math.pow(2,n),b=e*a,A=e*t,P=Ia[u],L,B;function Z(fe){for(var Ce=0;Ce<fe.length;Ce++){var Ve=fe[Ce];if(Ve[3])break;var tt=180-(Ve[1]+A)*360/m,st=(Ve[0]+b)*360/m-180,Bt=360/Math.PI*Math.atan(Math.exp(tt*Math.PI/180))-90;fe[Ce]=[st,Bt,0,1]}}switch(u){case 1:var j=[];for(L=0;L<o.length;L++)j[L]=o[L][0];o=j,Z(o);break;case 2:for(L=0;L<o.length;L++)Z(o[L]);break;case 3:for(o=Yi(o),L=0;L<o.length;L++)for(B=0;B<o[L].length;B++)Z(o[L][B]);break}o.length===1?o=o[0]:P="Multi"+P;var J={type:"Feature",geometry:{type:P,coordinates:o},properties:h,id:d,tileOrigin:[0,0],coord:""};return J}var ys=function(){var e=(0,xa.Z)(di().mark(function a(t,n,r,o){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",new Promise(function(d){var m=n.getTile(t.z,t.x,t.y),b=[];m.features.map(function(P){var L=eo(o,r.x,r.y,r.z,P);b.push(L)});var A={layers:{geojsonvt:{features:b}}};d(A)}));case 1:case"end":return h.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function cf(e){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"||(e.geojsonvtOptions.maxZoom&&(a.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(a.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(a.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(a.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(a.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(a.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(a.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(a.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(a.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(a.debug=e.geojsonvtOptions.debug)),a}function Ke(e,a){var t=cf(a),n=t.extent||4096,r=vu(e,t),o=function(d,m){return ys(m,r,d,n)},u=(0,Q.Z)((0,Q.Z)((0,Q.Z)({},Za),a),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function gr(e,a){var t=a.extent,n=a.width,r=a.height,o=a.min,u=a.max,h={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:r,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return h}var $t;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})($t||($t={}));var ei=function(){var e=(0,xa.Z)(di().mark(function a(t,n,r,o){var u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return u=hh(t,n),d.abrupt("return",new Promise(function(m,b){var A=ll({url:u},function(P,L){P?b(P):L&&m(L)},o);r.xhrCancel=function(){return A.abort()}}));case 2:case"end":return d.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),Pa=function(){var e=(0,xa.Z)(di().mark(function a(t,n,r){var o;return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=hh(t,n),h.abrupt("return",new Promise(function(d,m){var b=kf({url:o},function(A,P){A?m(A):P&&d(P)});r.xhrCancel=function(){return b.abort()}}));case 2:case"end":return h.stop()}},a)}));return function(t,n,r){return e.apply(this,arguments)}}(),Ge=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},we={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function vt(e,a){var t=(a==null?void 0:a.dataType)||$t.IMAGE,n=function(u,h){return t===$t.IMAGE?Pa(e,u,h):ei(e,u,h,(a==null?void 0:a.format)||Ge)},r=(0,Q.Z)((0,Q.Z)((0,Q.Z)({},we),a),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var Wt={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},ur=function(){var e=(0,xa.Z)(di().mark(function a(t){return di().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o){var u=(0,Pr.Z)(t.bounds,4),h=u[0],d=u[1],m=u[2],b=u[3],A={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(h+m)/2,textLat:(d+b)/2},geometry:{type:"LineString",coordinates:[[m,b],[m,d],[h,d],[h,d]]}}]}}};o(A)}));case 1:case"end":return r.stop()}},a)}));return function(t){return e.apply(this,arguments)}}();function bt(e,a){var t=function(o){return ur(o)},n=(0,Q.Z)((0,Q.Z)((0,Q.Z)({},Wt),a),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var ot=ue(34155);function kt(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function d(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,d)}m((n=n.apply(e,a||[])).next())})}function Ne(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return d([m,b])}}function d(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function pt(e,a){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(h){u={error:h}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return o}function We(e,a,t){if(t||arguments.length===2)for(var n=0,r=a.length,o;n<r;n++)(o||!(n in a))&&(o||(o=Array.prototype.slice.call(a,0,n)),o[n]=a[n]);return e.concat(o||Array.prototype.slice.call(a))}function jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kt={exports:{}},Vr={exports:{}},An={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=a.default})(An,An.exports);var un={},Gn={exports:{}},xn={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var o=n.pop();return t.call(this,n,o)}},e.exports=a.default})(xn,xn.exports);var $n={};Object.defineProperty($n,"__esModule",{value:!0}),$n.fallback=Qn,$n.wrap=Ni;var Wn=$n.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,Kn=$n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,ui=$n.hasNextTick=typeof ot=="object"&&typeof ot.nextTick=="function";function Qn(e){setTimeout(e,0)}function Ni(e){return function(a){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return a.apply(void 0,t)})}}var Ua;Wn?Ua=queueMicrotask:Kn?Ua=setImmediate:ui?Ua=ot.nextTick:Ua=Qn,$n.default=Ni(Ua),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=d;var t=xn.exports,n=h(t),r=$n,o=h(r),u=un;function h(A){return A&&A.__esModule?A:{default:A}}function d(A){return(0,u.isAsync)(A)?function(){for(var P=[],L=arguments.length;L--;)P[L]=arguments[L];var B=P.pop(),Z=A.apply(this,P);return m(Z,B)}:(0,n.default)(function(P,L){var B;try{B=A.apply(this,P)}catch(Z){return L(Z)}if(B&&typeof B.then=="function")return m(B,L);L(null,B)})}function m(A,P){return A.then(function(L){b(P,null,L)},function(L){b(P,L&&L.message?L:new Error(L))})}function b(A,P,L){try{A(P,L)}catch(B){(0,o.default)(function(Z){throw Z},B)}}e.exports=a.default}(Gn,Gn.exports),Object.defineProperty(un,"__esModule",{value:!0}),un.isAsyncIterable=un.isAsyncGenerator=un.isAsync=void 0;var qs=Gn.exports,Po=$a(qs);function $a(e){return e&&e.__esModule?e:{default:e}}function jc(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Nu(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function yc(e){return typeof e[Symbol.asyncIterator]=="function"}function $l(e){if(typeof e!="function")throw new Error("expected a function");return jc(e)?(0,Po.default)(e):e}un.default=$l,un.isAsync=jc,un.isAsyncGenerator=Nu,un.isAsyncIterable=yc;var _c={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n,r){if(r===void 0&&(r=n.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,h=[],d=arguments.length;d--;)h[d]=arguments[d];return typeof h[r-1]=="function"?n.apply(this,h):new Promise(function(m,b){h[r-1]=function(A){for(var P=[],L=arguments.length-1;L-- >0;)P[L]=arguments[L+1];if(A)return b(A);m(P.length>1?P:P[0])},n.apply(u,h)})}return o}e.exports=a.default})(_c,_c.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=An.exports,n=d(t),r=un,o=d(r),u=_c.exports,h=d(u);function d(m){return m&&m.__esModule?m:{default:m}}a.default=(0,h.default)(function(m,b,A){var P=(0,n.default)(b)?[]:{};m(b,function(L,B,Z){(0,o.default)(L)(function(j){for(var J,fe=[],Ce=arguments.length-1;Ce-- >0;)fe[Ce]=arguments[Ce+1];fe.length<2&&(J=fe,fe=J[0]),P[B]=fe,Z(j)})},function(L){return A(L,P)})},3),e.exports=a.default}(Vr,Vr.exports);var pl={exports:{}},Gc={exports:{}},gh={exports:{}},tp={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var h=n;n=null,h.apply(this,o)}}return Object.assign(r,n),r}e.exports=a.default})(tp,tp.exports);var Ts={exports:{}},Gs={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=a.default})(Gs,Gs.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var t=An.exports,n=u(t),r=Gs.exports,o=u(r);function u(A){return A&&A.__esModule?A:{default:A}}function h(A){var P=-1,L=A.length;return function(){return++P<L?{value:A[P],key:P}:null}}function d(A){var P=-1;return function(){var B=A.next();return B.done?null:(P++,{value:B.value,key:P})}}function m(A){var P=A?Object.keys(A):[],L=-1,B=P.length;return function Z(){var j=P[++L];return j==="__proto__"?Z():L<B?{value:A[j],key:j}:null}}function b(A){if((0,n.default)(A))return h(A);var P=(0,o.default)(A);return P?d(P):m(A)}e.exports=a.default}(Ts,Ts.exports);var xc={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,r)}}e.exports=a.default})(xc,xc.exports);var rp={exports:{}},yh={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t={};a.default=t,e.exports=a.default})(yh,yh.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=yh.exports,n=r(t);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,h,d,m){var b=!1,A=!1,P=!1,L=0,B=0;function Z(){L>=h||P||b||(P=!0,u.next().then(function(fe){var Ce=fe.value,Ve=fe.done;if(!(A||b)){if(P=!1,Ve){b=!0,L<=0&&m(null);return}L++,d(Ce,B,j),B++,Z()}}).catch(J))}function j(fe,Ce){if(L-=1,!A){if(fe)return J(fe);if(fe===!1){b=!0,A=!0;return}if(Ce===n.default||b&&L<=0)return b=!0,m(null);Z()}}function J(fe){A||(P=!1,b=!0,m(fe))}Z()}e.exports=a.default}(rp,rp.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=tp.exports,n=L(t),r=Ts.exports,o=L(r),u=xc.exports,h=L(u),d=un,m=rp.exports,b=L(m),A=yh.exports,P=L(A);function L(B){return B&&B.__esModule?B:{default:B}}a.default=function(B){return function(Z,j,J){if(J=(0,n.default)(J),B<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Z)return J(null);if((0,d.isAsyncGenerator)(Z))return(0,b.default)(Z,B,j,J);if((0,d.isAsyncIterable)(Z))return(0,b.default)(Z[Symbol.asyncIterator](),B,j,J);var fe=(0,o.default)(Z),Ce=!1,Ve=!1,tt=0,st=!1;function Bt(cr,Ir){if(!Ve)if(tt-=1,cr)Ce=!0,J(cr);else if(cr===!1)Ce=!0,Ve=!0;else{if(Ir===P.default||Ce&&tt<=0)return Ce=!0,J(null);st||Xt()}}function Xt(){for(st=!0;tt<B&&!Ce;){var cr=fe();if(cr===null){Ce=!0,tt<=0&&J(null);return}tt+=1,j(cr.value,cr.key,(0,h.default)(Bt))}st=!1}Xt()}},e.exports=a.default}(gh,gh.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=gh.exports,n=d(t),r=un,o=d(r),u=_c.exports,h=d(u);function d(b){return b&&b.__esModule?b:{default:b}}function m(b,A,P,L){return(0,n.default)(A)(b,(0,o.default)(P),L)}a.default=(0,h.default)(m,4),e.exports=a.default}(Gc,Gc.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=Gc.exports,n=u(t),r=_c.exports,o=u(r);function u(d){return d&&d.__esModule?d:{default:d}}function h(d,m,b){return(0,n.default)(d,1,m,b)}a.default=(0,o.default)(h,3),e.exports=a.default}(pl,pl.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=h;var t=Vr.exports,n=u(t),r=pl.exports,o=u(r);function u(d){return d&&d.__esModule?d:{default:d}}function h(d,m){return(0,n.default)(o.default,d,m)}e.exports=a.default}(Kt,Kt.exports);var kd=jt(Kt.exports),Kl=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],n=0;n<arguments.length;n++)t[n]=a[n];return this.args=t,kd(this.tasks)},e.prototype.tap=function(a,t){var n=this;this.tasks.push(function(r){t.apply(void 0,We([],pt(n.args),!1)),r(null,a)})},e}(),Vf={exports:{}},rv={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=An.exports,n=j(t),r=yh.exports,o=j(r),u=Gc.exports,h=j(u),d=tp.exports,m=j(d),b=xc.exports,A=j(b),P=un,L=j(P),B=_c.exports,Z=j(B);function j(Ve){return Ve&&Ve.__esModule?Ve:{default:Ve}}function J(Ve,tt,st){st=(0,m.default)(st);var Bt=0,Xt=0,cr=Ve.length,Ir=!1;cr===0&&st(null);function wr(Qr,Fn){Qr===!1&&(Ir=!0),Ir!==!0&&(Qr?st(Qr):(++Xt===cr||Fn===o.default)&&st(null))}for(;Bt<cr;Bt++)tt(Ve[Bt],Bt,(0,A.default)(wr))}function fe(Ve,tt,st){return(0,h.default)(Ve,Infinity,tt,st)}function Ce(Ve,tt,st){var Bt=(0,n.default)(Ve)?J:fe;return Bt(Ve,(0,L.default)(tt),st)}a.default=(0,Z.default)(Ce,3),e.exports=a.default})(rv,rv.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=h;var t=rv.exports,n=u(t),r=Vr.exports,o=u(r);function u(d){return d&&d.__esModule?d:{default:d}}function h(d,m){return(0,o.default)(n.default,d,m)}e.exports=a.default}(Vf,Vf.exports);var o0=jt(Vf.exports),j0=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return o0(this.tasks)},e.prototype.tapPromise=function(a,t){var n=this;this.tasks.push(function(r){return kt(n,void 0,void 0,function(){return Ne(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),$s={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=tp.exports,n=b(t),r=xc.exports,o=b(r),u=un,h=b(u),d=_c.exports,m=b(d);function b(P){return P&&P.__esModule?P:{default:P}}function A(P,L){if(L=(0,n.default)(L),!Array.isArray(P))return L(new Error("First argument to waterfall must be an array of functions"));if(!P.length)return L();var B=0;function Z(J){var fe=(0,h.default)(P[B++]);fe.apply(void 0,J.concat([(0,o.default)(j)]))}function j(J){for(var fe=[],Ce=arguments.length-1;Ce-- >0;)fe[Ce]=arguments[Ce+1];if(J!==!1){if(J||B===P.length)return L.apply(void 0,[J].concat(fe));Z(fe)}}Z([])}a.default=(0,m.default)(A),e.exports=a.default})($s,$s.exports);var np=jt($s.exports),Ld=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return np(this.tasks)},e.prototype.tap=function(a,t){this.tasks.length===0?this.tasks.push(function(n){var r=t();n(r?null:!1,r)}):this.tasks.push(function(n,r){var o=t();r(o?null:!1,a)})},e}(),i=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return kd(this.tasks)},e.prototype.tap=function(a,t){this.tasks.push(function(n){var r=t();n(r,a)})},e}(),s=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],n=0;n<arguments.length;n++)t[n]=a[n];return this.args=t,kd(this.tasks)},e.prototype.tapPromise=function(a,t){var n=this;this.tasks.push(function(r){return kt(n,void 0,void 0,function(){return Ne(this,function(o){switch(o.label){case 0:return[4,t.apply(void 0,We([],pt(this.args),!1))];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),l=ue(96486),v=ue(69848),x=ue.n(v);function C(e,a){var t=a.radius,n=t===void 0?40:t,r=a.maxZoom,o=r===void 0?18:r,u=a.minZoom,h=u===void 0?0:u,d=a.zoom,m=d===void 0?2:d;if(e.pointIndex){var b=e.pointIndex.getClusters(e.extent,Math.floor(m));return e.dataArray=T(b),e}var A=new(x())({radius:n,minZoom:h,maxZoom:o}),P={type:"FeatureCollection",features:[]};return P.features=e.dataArray.map(function(L){return{type:"Feature",geometry:{type:"Point",coordinates:L.coordinates},properties:(0,Q.Z)({},L)}}),A.load(P.features),A}function T(e){return e.map(function(a,t){return(0,Q.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function R(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a}function U(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a}function X(e){if(e.length===0)return 0;for(var a=e[0],t=0,n,r=1;r<e.length;r++)n=a+e[r]*1,Math.abs(a)>=Math.abs(e[r])?t+=a-n+e[r]:t+=e[r]-n+a,a=n;return a+t*1}function $(e){if(e.length===0)throw new Error("mean requires at least one data point");return X(e)/e.length}var ne={min:U,max:R,mean:$,sum:X};function me(e,a){return e.map(function(t){return t[a]*1})}function Ae(e){var a=Qe();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function et(e,a){if(Array.isArray(a))return a}var _t=function(e){(0,Or.Z)(t,e);var a=Ae(t);function t(n,r){var o;return(0,Ht.Z)(this,t),o=a.call(this),(0,ae.Z)((0,At.Z)(o),"inited",!1),(0,ae.Z)((0,At.Z)(o),"hooks",{init:new Kl}),(0,ae.Z)((0,At.Z)(o),"parser",{type:"geojson"}),(0,ae.Z)((0,At.Z)(o),"transforms",[]),(0,ae.Z)((0,At.Z)(o),"cluster",!1),(0,ae.Z)((0,At.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,ae.Z)((0,At.Z)(o),"invalidExtent",!1),(0,ae.Z)((0,At.Z)(o),"dataArrayChanged",!1),(0,ae.Z)((0,At.Z)(o),"cfg",{}),o.originData=n,o.initCfg(r),o.init(),o}return(0,Rt.Z)(t,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,h=u.method,d=h===void 0?"sum":h,m=u.field,b=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,b.forEach(function(A){A.id||(A.properties.point_count=1)}),(m||(0,l.isFunction)(d))&&(b=b.map(function(A){var P=A.id;if(P){var L=o.clusterIndex.getLeaves(P,Infinity),B=L.map(function(J){return J.properties}),Z;if((0,l.isString)(d)&&m){var j=me(B,m);Z=ne[d](j)}(0,l.isFunction)(d)&&(Z=d(B)),A.properties.stat=Z}else A.properties.point_count=1;return A})),this.data=ve("geojson")({type:"FeatureCollection",features:b}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser.type,u=o===void 0?"geojson":o;if(u==="geojson"&&!this.cluster){var h=r<this.originData.features.length?this.originData.features[r]:"null",d=(0,l.cloneDeep)(h);if(d!=null&&d.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var m=this.data.dataArray.find(function(b){return b._id===r});d.properties=m}return d}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,Q.Z)((0,Q.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(h){return h[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"handleData",value:function(){var r=this;return new Promise(function(o,u){try{r.excuteParser(),r.initCluster(),r.executeTrans(),o({})}catch(h){u(h)}})}},{key:"initCfg",value:function(r){this.cfg=(0,l.mergeWith)(this.cfg,r,et);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Q.Z)((0,Q.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var r=this;this.inited=!1,this.handleData().then(function(){r.inited=!0,r.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=ve(o);this.data=u(this.originData,r),this.extent=Ph(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new tv((0,Q.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var h=u.type,d=se(h)(r.data,u);Object.assign(r.data,d)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=C(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=cl(rf(this.extent),r)),o[0].concat(o[1])}}]),t}(qu.EventEmitter);function ft(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function zt(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tr(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function tr(e,a){if(!!e){if(typeof e=="string")return xr(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xr(e,a)}}function xr(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var br=6378e3;function Zr(e,a){var t=e.dataArray,n=a.size,r=n===void 0?10:n,o=r/(2*Math.PI*br)*(256<<20)/2,u=pn(t,r),h=u.gridHash,d=u.gridOffset,m=Pi(h,d,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:m}}function pn(e,a){var t=Infinity,n=-Infinity,r,o=zt(e),u;try{for(o.s();!(u=o.n()).done;){var h=u.value;r=h.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,n=r>n?r:n)}}catch(Ce){o.e(Ce)}finally{o.f()}var d=(t+n)/2,m=Un(a,d);if(m.xOffset<=0||m.yOffset<=0)return{gridHash:{},gridOffset:m};var b={},A=zt(e),P;try{for(A.s();!(P=A.n()).done;){var L=P.value,B=L.coordinates[1],Z=L.coordinates[0];if(Number.isFinite(B)&&Number.isFinite(Z)){var j=Math.floor((B+90)/m.yOffset),J=Math.floor((Z+180)/m.xOffset),fe="".concat(j,"-").concat(J);b[fe]=b[fe]||{count:0,points:[]},b[fe].count+=1,b[fe].points.push(L)}}}catch(Ce){A.e(Ce)}finally{A.f()}return{gridHash:b,gridOffset:m}}function Un(e,a){var t=Ai(e),n=ti(a,e);return{yOffset:t,xOffset:n}}function Ai(e){return e/br*(180/Math.PI)}function ti(e,a){return a/br*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Pi(e,a,t){return Object.keys(e).reduce(function(n,r,o){var u=r.split("-"),h=parseInt(u[0],10),d=parseInt(u[1],10),m={};if(t.field&&t.method){var b=Rc(e[r].points,t.field);m[t.method]=In[t.method](b)}return Object.assign(m,{_id:o,coordinates:Ao([-180+a.xOffset*(d+.5),-90+a.yOffset*(h+.5)]),rawData:e[r].points,count:e[r].count}),n.push(m),n},[])}var Xn=Math.PI/3,ma=[0,Xn,2*Xn,3*Xn,4*Xn,5*Xn];function qi(e){return e[0]}function gi(e){return e[1]}function La(){var e=0,a=0,t=1,n=1,r=qi,o=gi,u,h,d;function m(A){var P={},L=[],B,Z=A.length;for(B=0;B<Z;++B)if(!(isNaN(J=+r.call(null,j=A[B],B,A))||isNaN(fe=+o.call(null,j,B,A)))){var j,J,fe,Ce=Math.round(fe=fe/d),Ve=Math.round(J=J/h-(Ce&1)/2),tt=fe-Ce;if(Math.abs(tt)*3>1){var st=J-Ve,Bt=Ve+(J<Ve?-1:1)/2,Xt=Ce+(fe<Ce?-1:1),cr=J-Bt,Ir=fe-Xt;st*st+tt*tt>cr*cr+Ir*Ir&&(Ve=Bt+(Ce&1?1:-1)/2,Ce=Xt)}var wr=Ve+"-"+Ce,Qr=P[wr];Qr?Qr.push(j):(L.push(Qr=P[wr]=[j]),Qr.x=(Ve+(Ce&1)/2)*h,Qr.y=Ce*d)}return L}function b(A){var P=0,L=0;return ma.map(function(B){var Z=Math.sin(B)*A,j=-Math.cos(B)*A,J=Z-P,fe=j-L;return P=Z,L=j,[J,fe]})}return m.hexagon=function(A){return"m"+b(A==null?u:+A).join("l")+"z"},m.centers=function(){for(var A=[],P=Math.round(a/d),L=Math.round(e/h),B=P*d;B<n+u;B+=d,++P)for(var Z=L*h+(P&1)*h/2;Z<t+h/2;Z+=h)A.push([Z,B]);return A},m.mesh=function(){var A=b(u).slice(0,4).join("l");return m.centers().map(function(P){return"M"+P+"m"+A}).join("")},m.x=function(A){return arguments.length?(r=A,m):r},m.y=function(A){return arguments.length?(o=A,m):o},m.radius=function(A){return arguments.length?(u=+A,h=u*2*Math.sin(Xn),d=u*1.5,m):u},m.size=function(A){return arguments.length?(e=a=0,t=+A[0],n=+A[1],m):[t-e,n-a]},m.extent=function(A){return arguments.length?(e=+A[0][0],a=+A[0][1],t=+A[1][0],n=+A[1][1],m):[[e,a],[t,n]]},m.radius(1)}var ca=6378e3;function Va(e,a){var t=e.dataArray,n=a.size,r=n===void 0?10:n,o=a.method,u=o===void 0?"sum":o,h=r/(2*Math.PI*ca)*(256<<20)/2,d=t.map(function(P){var L=Ao(P.coordinates),B=(0,Pr.Z)(L,2),Z=B[0],j=B[1];return(0,Q.Z)((0,Q.Z)({},P),{},{coordinates:[Z,j]})}),m=La().radius(h).x(function(P){return P.coordinates[0]}).y(function(P){return P.coordinates[1]}),b=m(d),A={dataArray:b.map(function(P,L){var B;if(a.field&&u){var Z=Rc(P,a.field);P[u]=In[u](Z)}return B={},(0,ae.Z)(B,a.method,P[u]),(0,ae.Z)(B,"count",P.length),(0,ae.Z)(B,"rawData",P),(0,ae.Z)(B,"coordinates",[P.x,P.y]),(0,ae.Z)(B,"_id",L),B}),radius:h,xOffset:h,yOffset:h,type:"hexagon"};return A}function ki(e,a){var t=a.sourceField,n=a.targetField,r=a.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var h=u[n];return(0,Q.Z)((0,Q.Z)({},u),o[h])}),e}function to(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}at("rasterTile",vt),at("mvt",Cr),at("geojsonvt",Ke),at("testTile",bt),at("geojson",Mn),at("image",dr),at("csv",mr),at("json",or),at("raster",gr),Be("cluster",C),Be("filter",ft),Be("join",ki),Be("map",to),Be("grid",Zr),Be("hexagon",Va);var To=_t,_s=ue(28660),$r=ue(86700),Uo=ue(84879),rr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},nu=ue(31745),iu=ue.n(nu);function zu(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=xs(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function xs(e,a){if(!!e){if(typeof e=="string")return wu(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wu(e,a)}}function wu(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Ko=30;function au(e){var a=e.characterSet,t=e.getFontWidth,n=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,h=u===void 0?{}:u,d=e.xOffset,m=d===void 0?0:d,b=e.yOffset,A=b===void 0?0:b,P=0,L=m;Array.from(a).forEach(function(Z,j){if(!h[Z]){var J=t(Z,j);L+Ko>o&&(L=0,P++),h[Z]={x:L,y:A+P*Ko,width:Ko,height:Ko,advance:J},L+=Ko}});var B=n+r*2;return{mapping:h,xOffset:L,yOffset:A+P*B,canvasHeight:vo(A+(P+1)*B)}}function Fa(e,a,t){var n=0,r=0,o=0,u=[],h={},d=zu(e),m;try{for(d.s();!(m=d.n()).done;){var b=m.value;if(!h[b.id]){var A=b.size;n+A+a>t&&(Co(h,u,r),n=0,r=o+r+a,o=0,u=[]),u.push({icon:b,xOffset:n}),n=n+A+a,o=Math.max(o,A)}}}catch(L){d.e(L)}finally{d.f()}u.length>0&&Co(h,u,r);var P=vo(o+r+a);return{mapping:h,canvasHeight:P}}function Co(e,a,t){var n=zu(a),r;try{for(n.s();!(r=n.n()).done;){var o=r.value,u=o.icon,h=o.xOffset;e[u.id]=(0,Q.Z)((0,Q.Z)({},u),{},{x:h,y:t,image:u.image,width:u.width,height:u.height})}}catch(d){n.e(d)}finally{n.f()}}function vo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Ga,$u;function mu(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zo(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Zo(e,a){if(!!e){if(typeof e=="string")return Ms(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ms(e,a)}}function Ms(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Tu=id(),Ha="sans-serif",Ll="normal",bc=24,dl=3,bs=.25,Hc=8,Wc=1024,rd=1,ip=1,nd=3,ap=null;function id(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function op(e,a,t,n){e.font="".concat(n," ").concat(t,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function sp(e,a){for(var t=0;t<e.length;t++)a.data[4*t+3]=e[t]}var kp=(Ga=(0,$r.b2)(),Ga($u=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"fontAtlas",void 0),(0,ae.Z)(this,"iconFontMap",void 0),(0,ae.Z)(this,"iconFontGlyphs",{}),(0,ae.Z)(this,"fontOptions",void 0),(0,ae.Z)(this,"key",void 0),(0,ae.Z)(this,"cache",new c(nd))}return(0,Rt.Z)(e,[{key:"scale",get:function(){return ip}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ha,fontWeight:Ll,characterSet:Tu,fontSize:bc,buffer:dl,sdf:!0,cutoff:bs,radius:Hc,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var n=this;t.forEach(function(r){n.iconFontGlyphs[r.name]=r.unicode})}},{key:"addIconFont",value:function(t,n){this.iconFontMap.set(t,n)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Q.Z)((0,Q.Z)({},this.fontOptions),t),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(!(r&&n.length===0)){var o=this.generateFontAtlas(this.key,n,r);this.fontAtlas=o,this.cache.set(this.key,o)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,n,r){var o=this.fontOptions,u=o.fontFamily,h=o.fontWeight,d=o.fontSize,m=o.buffer,b=o.sdf,A=o.radius,P=o.cutoff,L=o.iconfont,B=r&&r.data;B||(B=Ui.document.createElement("canvas"),B.width=Wc);var Z=B.getContext("2d");op(Z,u,d,h);var j=au((0,Q.Z)({getFontWidth:function(Is){return Z.measureText(Is).width},fontHeight:d*ip,buffer:m,characterSet:n,maxCanvasWidth:Wc},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),J=j.mapping,fe=j.canvasHeight,Ce=j.xOffset,Ve=j.yOffset,tt=Z.getImageData(0,0,B.width,B.height);if(B.height=fe,Z.putImageData(tt,0,0),op(Z,u,d,h),b){var st=new(iu())(d,m,A,P,u,h),Bt=Z.getImageData(0,0,st.size,st.size),Xt=mu(n),cr;try{for(Xt.s();!(cr=Xt.n()).done;){var Ir=cr.value;if(L){var wr=String.fromCharCode(parseInt(Ir.replace("&#x","").replace(";",""),16)),Qr=st.draw(wr);sp(Qr,Bt)}else sp(st.draw(Ir),Bt);Z.putImageData(Bt,J[Ir].x,J[Ir].y)}}catch(Ya){Xt.e(Ya)}finally{Xt.f()}}else{var Fn=mu(n),ci;try{for(Fn.s();!(ci=Fn.n()).done;){var Ba=ci.value;Z.fillText(Ba,J[Ba].x,J[Ba].y+d*rd)}}catch(Ya){Fn.e(Ya)}finally{Fn.f()}}return{xOffset:Ce,yOffset:Ve,mapping:J,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){return"key";var t,n,r,o,u,h,d,m}},{key:"getNewChars",value:function(t,n){var r=this.cache.get(t);if(!r)return n;var o=[],u=r.mapping,h=new Set(Object.keys(u)),d=new Set(n);return d.forEach(function(m){h.has(m)||o.push(m)}),o}}]),e}())||$u),Bh,ad;function ff(e){var a=Od();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Od(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lp=3,Nh=1024,Ec=64,Rd=(Bh=(0,$r.b2)(),Bh(ad=function(e){(0,Or.Z)(t,e);var a=ff(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"canvasHeight",128),(0,ae.Z)((0,At.Z)(n),"texture",void 0),(0,ae.Z)((0,At.Z)(n),"canvas",void 0),(0,ae.Z)((0,At.Z)(n),"iconData",void 0),(0,ae.Z)((0,At.Z)(n),"iconMap",void 0),(0,ae.Z)((0,At.Z)(n),"ctx",void 0),(0,ae.Z)((0,At.Z)(n),"loadingImageCount",0),n}return(0,Rt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ui.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(r,o){var u=this,h=new Image;if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Ec}),this.updateIconMap(),this.loadImage(o).then(function(d){h=d;var m=u.iconData.find(function(b){return b.id===r});m&&(m.image=h,m.width=h.width,m.height=h.height),u.update()})}},{key:"addImageMini",value:function(r,o,u){var h=this,d=u.getSceneConfig().canvas,m=d.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Ec}),this.updateIconMap(),this.loadImageMini(o,d).then(function(b){m=b;var A=h.iconData.find(function(P){return P.id===r});A&&(A.image=m,A.width=m.width,A.height=m.height),h.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var h=new Image;h.crossOrigin="anonymous",h.onload=function(){o(h)},h.onerror=function(){u(new Error("Could not load image at "+r))},h.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=Nh,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],h=u.x,d=u.y,m=u.image,b=u.width,A=b===void 0?64:b,P=u.height,L=P===void 0?64:P,B=Math.max(A,L),Z=B/Ec,j=L/Z,J=A/Z;m&&r.ctx.drawImage(m,h+(Ec-J)/2,d+(Ec-j)/2,J,j)})}},{key:"updateIconMap",value:function(){var r=Fa(this.iconData,Lp,Nh),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,h){var d=o.createImage();d.crossOrigin="anonymous",d.onload=function(){u(d)},d.onerror=function(){h(new Error("Could not load image at "+r))},d.src=r})}}]),t}(qu.EventEmitter))||ad),mo=ue(49685);function Xc(){var e=new mo.WT(16);return mo.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function od(e){var a=new mo.WT(16);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function sd(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function Op(e,a,t,n,r,o,u,h,d,m,b,A,P,L,B,Z){var j=new mo.WT(16);return j[0]=e,j[1]=a,j[2]=t,j[3]=n,j[4]=r,j[5]=o,j[6]=u,j[7]=h,j[8]=d,j[9]=m,j[10]=b,j[11]=A,j[12]=P,j[13]=L,j[14]=B,j[15]=Z,j}function Rp(e,a,t,n,r,o,u,h,d,m,b,A,P,L,B,Z,j){return e[0]=a,e[1]=t,e[2]=n,e[3]=r,e[4]=o,e[5]=u,e[6]=h,e[7]=d,e[8]=m,e[9]=b,e[10]=A,e[11]=P,e[12]=L,e[13]=B,e[14]=Z,e[15]=j,e}function Dp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ud(e,a){if(e===a){var t=a[1],n=a[2],r=a[3],o=a[6],u=a[7],h=a[11];e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=t,e[6]=a[9],e[7]=a[13],e[8]=n,e[9]=o,e[11]=a[14],e[12]=r,e[13]=u,e[14]=h}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e}function jf(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=a[4],h=a[5],d=a[6],m=a[7],b=a[8],A=a[9],P=a[10],L=a[11],B=a[12],Z=a[13],j=a[14],J=a[15],fe=t*h-n*u,Ce=t*d-r*u,Ve=t*m-o*u,tt=n*d-r*h,st=n*m-o*h,Bt=r*m-o*d,Xt=b*Z-A*B,cr=b*j-P*B,Ir=b*J-L*B,wr=A*j-P*Z,Qr=A*J-L*Z,Fn=P*J-L*j,ci=fe*Fn-Ce*Qr+Ve*wr+tt*Ir-st*cr+Bt*Xt;return ci?(ci=1/ci,e[0]=(h*Fn-d*Qr+m*wr)*ci,e[1]=(r*Qr-n*Fn-o*wr)*ci,e[2]=(Z*Bt-j*st+J*tt)*ci,e[3]=(P*st-A*Bt-L*tt)*ci,e[4]=(d*Ir-u*Fn-m*cr)*ci,e[5]=(t*Fn-r*Ir+o*cr)*ci,e[6]=(j*Ve-B*Bt-J*Ce)*ci,e[7]=(b*Bt-P*Ve+L*Ce)*ci,e[8]=(u*Qr-h*Ir+m*Xt)*ci,e[9]=(n*Ir-t*Qr-o*Xt)*ci,e[10]=(B*st-Z*Ve+J*fe)*ci,e[11]=(A*Ve-b*st-L*fe)*ci,e[12]=(h*cr-u*wr-d*Xt)*ci,e[13]=(t*wr-n*cr+r*Xt)*ci,e[14]=(Z*Ce-B*tt-j*fe)*ci,e[15]=(b*tt-A*Ce+P*fe)*ci,e):null}function ld(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=a[4],h=a[5],d=a[6],m=a[7],b=a[8],A=a[9],P=a[10],L=a[11],B=a[12],Z=a[13],j=a[14],J=a[15];return e[0]=h*(P*J-L*j)-A*(d*J-m*j)+Z*(d*L-m*P),e[1]=-(n*(P*J-L*j)-A*(r*J-o*j)+Z*(r*L-o*P)),e[2]=n*(d*J-m*j)-h*(r*J-o*j)+Z*(r*m-o*d),e[3]=-(n*(d*L-m*P)-h*(r*L-o*P)+A*(r*m-o*d)),e[4]=-(u*(P*J-L*j)-b*(d*J-m*j)+B*(d*L-m*P)),e[5]=t*(P*J-L*j)-b*(r*J-o*j)+B*(r*L-o*P),e[6]=-(t*(d*J-m*j)-u*(r*J-o*j)+B*(r*m-o*d)),e[7]=t*(d*L-m*P)-u*(r*L-o*P)+b*(r*m-o*d),e[8]=u*(A*J-L*Z)-b*(h*J-m*Z)+B*(h*L-m*A),e[9]=-(t*(A*J-L*Z)-b*(n*J-o*Z)+B*(n*L-o*A)),e[10]=t*(h*J-m*Z)-u*(n*J-o*Z)+B*(n*m-o*h),e[11]=-(t*(h*L-m*A)-u*(n*L-o*A)+b*(n*m-o*h)),e[12]=-(u*(A*j-P*Z)-b*(h*j-d*Z)+B*(h*P-d*A)),e[13]=t*(A*j-P*Z)-b*(n*j-r*Z)+B*(n*P-r*A),e[14]=-(t*(h*j-d*Z)-u*(n*j-r*Z)+B*(n*d-r*h)),e[15]=t*(h*P-d*A)-u*(n*P-r*A)+b*(n*d-r*h),e}function up(e){var a=e[0],t=e[1],n=e[2],r=e[3],o=e[4],u=e[5],h=e[6],d=e[7],m=e[8],b=e[9],A=e[10],P=e[11],L=e[12],B=e[13],Z=e[14],j=e[15],J=a*u-t*o,fe=a*h-n*o,Ce=a*d-r*o,Ve=t*h-n*u,tt=t*d-r*u,st=n*d-r*h,Bt=m*B-b*L,Xt=m*Z-A*L,cr=m*j-P*L,Ir=b*Z-A*B,wr=b*j-P*B,Qr=A*j-P*Z;return J*Qr-fe*wr+Ce*Ir+Ve*cr-tt*Xt+st*Bt}function Ol(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3],h=a[4],d=a[5],m=a[6],b=a[7],A=a[8],P=a[9],L=a[10],B=a[11],Z=a[12],j=a[13],J=a[14],fe=a[15],Ce=t[0],Ve=t[1],tt=t[2],st=t[3];return e[0]=Ce*n+Ve*h+tt*A+st*Z,e[1]=Ce*r+Ve*d+tt*P+st*j,e[2]=Ce*o+Ve*m+tt*L+st*J,e[3]=Ce*u+Ve*b+tt*B+st*fe,Ce=t[4],Ve=t[5],tt=t[6],st=t[7],e[4]=Ce*n+Ve*h+tt*A+st*Z,e[5]=Ce*r+Ve*d+tt*P+st*j,e[6]=Ce*o+Ve*m+tt*L+st*J,e[7]=Ce*u+Ve*b+tt*B+st*fe,Ce=t[8],Ve=t[9],tt=t[10],st=t[11],e[8]=Ce*n+Ve*h+tt*A+st*Z,e[9]=Ce*r+Ve*d+tt*P+st*j,e[10]=Ce*o+Ve*m+tt*L+st*J,e[11]=Ce*u+Ve*b+tt*B+st*fe,Ce=t[12],Ve=t[13],tt=t[14],st=t[15],e[12]=Ce*n+Ve*h+tt*A+st*Z,e[13]=Ce*r+Ve*d+tt*P+st*j,e[14]=Ce*o+Ve*m+tt*L+st*J,e[15]=Ce*u+Ve*b+tt*B+st*fe,e}function Ql(e,a,t){var n=t[0],r=t[1],o=t[2],u,h,d,m,b,A,P,L,B,Z,j,J;return a===e?(e[12]=a[0]*n+a[4]*r+a[8]*o+a[12],e[13]=a[1]*n+a[5]*r+a[9]*o+a[13],e[14]=a[2]*n+a[6]*r+a[10]*o+a[14],e[15]=a[3]*n+a[7]*r+a[11]*o+a[15]):(u=a[0],h=a[1],d=a[2],m=a[3],b=a[4],A=a[5],P=a[6],L=a[7],B=a[8],Z=a[9],j=a[10],J=a[11],e[0]=u,e[1]=h,e[2]=d,e[3]=m,e[4]=b,e[5]=A,e[6]=P,e[7]=L,e[8]=B,e[9]=Z,e[10]=j,e[11]=J,e[12]=u*n+b*r+B*o+a[12],e[13]=h*n+A*r+Z*o+a[13],e[14]=d*n+P*r+j*o+a[14],e[15]=m*n+L*r+J*o+a[15]),e}function _h(e,a,t){var n=t[0],r=t[1],o=t[2];return e[0]=a[0]*n,e[1]=a[1]*n,e[2]=a[2]*n,e[3]=a[3]*n,e[4]=a[4]*r,e[5]=a[5]*r,e[6]=a[6]*r,e[7]=a[7]*r,e[8]=a[8]*o,e[9]=a[9]*o,e[10]=a[10]*o,e[11]=a[11]*o,e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function cd(e,a,t,n){var r=n[0],o=n[1],u=n[2],h=Math.hypot(r,o,u),d,m,b,A,P,L,B,Z,j,J,fe,Ce,Ve,tt,st,Bt,Xt,cr,Ir,wr,Qr,Fn,ci,Ba;return h<mo.Ib?null:(h=1/h,r*=h,o*=h,u*=h,d=Math.sin(t),m=Math.cos(t),b=1-m,A=a[0],P=a[1],L=a[2],B=a[3],Z=a[4],j=a[5],J=a[6],fe=a[7],Ce=a[8],Ve=a[9],tt=a[10],st=a[11],Bt=r*r*b+m,Xt=o*r*b+u*d,cr=u*r*b-o*d,Ir=r*o*b-u*d,wr=o*o*b+m,Qr=u*o*b+r*d,Fn=r*u*b+o*d,ci=o*u*b-r*d,Ba=u*u*b+m,e[0]=A*Bt+Z*Xt+Ce*cr,e[1]=P*Bt+j*Xt+Ve*cr,e[2]=L*Bt+J*Xt+tt*cr,e[3]=B*Bt+fe*Xt+st*cr,e[4]=A*Ir+Z*wr+Ce*Qr,e[5]=P*Ir+j*wr+Ve*Qr,e[6]=L*Ir+J*wr+tt*Qr,e[7]=B*Ir+fe*wr+st*Qr,e[8]=A*Fn+Z*ci+Ce*Ba,e[9]=P*Fn+j*ci+Ve*Ba,e[10]=L*Fn+J*ci+tt*Ba,e[11]=B*Fn+fe*ci+st*Ba,a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e)}function zh(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[4],u=a[5],h=a[6],d=a[7],m=a[8],b=a[9],A=a[10],P=a[11];return a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[4]=o*r+m*n,e[5]=u*r+b*n,e[6]=h*r+A*n,e[7]=d*r+P*n,e[8]=m*r-o*n,e[9]=b*r-u*n,e[10]=A*r-h*n,e[11]=P*r-d*n,e}function Dd(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],h=a[2],d=a[3],m=a[8],b=a[9],A=a[10],P=a[11];return a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r-m*n,e[1]=u*r-b*n,e[2]=h*r-A*n,e[3]=d*r-P*n,e[8]=o*n+m*r,e[9]=u*n+b*r,e[10]=h*n+A*r,e[11]=d*n+P*r,e}function fd(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],h=a[2],d=a[3],m=a[4],b=a[5],A=a[6],P=a[7];return a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r+m*n,e[1]=u*r+b*n,e[2]=h*r+A*n,e[3]=d*r+P*n,e[4]=m*r-o*n,e[5]=b*r-u*n,e[6]=A*r-h*n,e[7]=P*r-d*n,e}function nv(e,a){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e}function hd(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iv(e,a,t){var n=t[0],r=t[1],o=t[2],u=Math.hypot(n,r,o),h,d,m;return u<mo.Ib?null:(u=1/u,n*=u,r*=u,o*=u,h=Math.sin(a),d=Math.cos(a),m=1-d,e[0]=n*n*m+d,e[1]=r*n*m+o*h,e[2]=o*n*m-r*h,e[3]=0,e[4]=n*r*m-o*h,e[5]=r*r*m+d,e[6]=o*r*m+n*h,e[7]=0,e[8]=n*o*m+r*h,e[9]=r*o*m-n*h,e[10]=o*o*m+d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function pd(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Es(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gf(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function s0(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3],h=n+n,d=r+r,m=o+o,b=n*h,A=n*d,P=n*m,L=r*d,B=r*m,Z=o*m,j=u*h,J=u*d,fe=u*m;return e[0]=1-(L+Z),e[1]=A+fe,e[2]=P-J,e[3]=0,e[4]=A-fe,e[5]=1-(b+Z),e[6]=B+j,e[7]=0,e[8]=P+J,e[9]=B-j,e[10]=1-(b+L),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function lp(e,a){var t=new mo.WT(3),n=-a[0],r=-a[1],o=-a[2],u=a[3],h=a[4],d=a[5],m=a[6],b=a[7],A=n*n+r*r+o*o+u*u;return A>0?(t[0]=(h*u+b*n+d*o-m*r)*2/A,t[1]=(d*u+b*r+m*n-h*o)*2/A,t[2]=(m*u+b*o+h*r-d*n)*2/A):(t[0]=(h*u+b*n+d*o-m*r)*2,t[1]=(d*u+b*r+m*n-h*o)*2,t[2]=(m*u+b*o+h*r-d*n)*2),s0(e,a,t),e}function Dv(e,a){return e[0]=a[12],e[1]=a[13],e[2]=a[14],e}function av(e,a){var t=a[0],n=a[1],r=a[2],o=a[4],u=a[5],h=a[6],d=a[8],m=a[9],b=a[10];return e[0]=Math.hypot(t,n,r),e[1]=Math.hypot(o,u,h),e[2]=Math.hypot(d,m,b),e}function Uh(e,a){var t=new mo.WT(3);av(t,a);var n=1/t[0],r=1/t[1],o=1/t[2],u=a[0]*n,h=a[1]*r,d=a[2]*o,m=a[4]*n,b=a[5]*r,A=a[6]*o,P=a[8]*n,L=a[9]*r,B=a[10]*o,Z=u+b+B,j=0;return Z>0?(j=Math.sqrt(Z+1)*2,e[3]=.25*j,e[0]=(A-L)/j,e[1]=(P-d)/j,e[2]=(h-m)/j):u>b&&u>B?(j=Math.sqrt(1+u-b-B)*2,e[3]=(A-L)/j,e[0]=.25*j,e[1]=(h+m)/j,e[2]=(P+d)/j):b>B?(j=Math.sqrt(1+b-u-B)*2,e[3]=(P-d)/j,e[0]=(h+m)/j,e[1]=.25*j,e[2]=(A+L)/j):(j=Math.sqrt(1+B-u-b)*2,e[3]=(h-m)/j,e[0]=(P+d)/j,e[1]=(A+L)/j,e[2]=.25*j),e}function Cc(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=a[3],d=r+r,m=o+o,b=u+u,A=r*d,P=r*m,L=r*b,B=o*m,Z=o*b,j=u*b,J=h*d,fe=h*m,Ce=h*b,Ve=n[0],tt=n[1],st=n[2];return e[0]=(1-(B+j))*Ve,e[1]=(P+Ce)*Ve,e[2]=(L-fe)*Ve,e[3]=0,e[4]=(P-Ce)*tt,e[5]=(1-(A+j))*tt,e[6]=(Z+J)*tt,e[7]=0,e[8]=(L+fe)*st,e[9]=(Z-J)*st,e[10]=(1-(A+B))*st,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ov(e,a,t,n,r){var o=a[0],u=a[1],h=a[2],d=a[3],m=o+o,b=u+u,A=h+h,P=o*m,L=o*b,B=o*A,Z=u*b,j=u*A,J=h*A,fe=d*m,Ce=d*b,Ve=d*A,tt=n[0],st=n[1],Bt=n[2],Xt=r[0],cr=r[1],Ir=r[2],wr=(1-(Z+J))*tt,Qr=(L+Ve)*tt,Fn=(B-Ce)*tt,ci=(L-Ve)*st,Ba=(1-(P+J))*st,Ya=(j+fe)*st,Is=(B+Ce)*Bt,Iu=(j-fe)*Bt,gu=(1-(P+Z))*Bt;return e[0]=wr,e[1]=Qr,e[2]=Fn,e[3]=0,e[4]=ci,e[5]=Ba,e[6]=Ya,e[7]=0,e[8]=Is,e[9]=Iu,e[10]=gu,e[11]=0,e[12]=t[0]+Xt-(wr*Xt+ci*cr+Is*Ir),e[13]=t[1]+cr-(Qr*Xt+Ba*cr+Iu*Ir),e[14]=t[2]+Ir-(Fn*Xt+Ya*cr+gu*Ir),e[15]=1,e}function Fd(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=t+t,h=n+n,d=r+r,m=t*u,b=n*u,A=n*h,P=r*u,L=r*h,B=r*d,Z=o*u,j=o*h,J=o*d;return e[0]=1-A-B,e[1]=b+J,e[2]=P-j,e[3]=0,e[4]=b-J,e[5]=1-m-B,e[6]=L+Z,e[7]=0,e[8]=P+j,e[9]=L-Z,e[10]=1-m-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sv(e,a,t,n,r,o,u){var h=1/(t-a),d=1/(r-n),m=1/(o-u);return e[0]=o*2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*d,e[6]=0,e[7]=0,e[8]=(t+a)*h,e[9]=(r+n)*d,e[10]=(u+o)*m,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*m,e[15]=0,e}function Bd(e,a,t,n,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=(r+n)*u,e[14]=2*r*n*u):(e[10]=-1,e[14]=-2*n),e}var uv=Bd;function u0(e,a,t,n,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=r*u,e[14]=r*n*u):(e[10]=-1,e[14]=-n),e}function Nd(e,a,t,n){var r=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),u=Math.tan(a.leftDegrees*Math.PI/180),h=Math.tan(a.rightDegrees*Math.PI/180),d=2/(u+h),m=2/(r+o);return e[0]=d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=m,e[6]=0,e[7]=0,e[8]=-((u-h)*d*.5),e[9]=(r-o)*m*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function Fp(e,a,t,n,r,o,u){var h=1/(a-t),d=1/(n-r),m=1/(o-u);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*m,e[11]=0,e[12]=(a+t)*h,e[13]=(r+n)*d,e[14]=(u+o)*m,e[15]=1,e}var lv=Fp;function cv(e,a,t,n,r,o,u){var h=1/(a-t),d=1/(n-r),m=1/(o-u);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=m,e[11]=0,e[12]=(a+t)*h,e[13]=(r+n)*d,e[14]=o*m,e[15]=1,e}function Rl(e,a,t,n){var r,o,u,h,d,m,b,A,P,L,B=a[0],Z=a[1],j=a[2],J=n[0],fe=n[1],Ce=n[2],Ve=t[0],tt=t[1],st=t[2];return Math.abs(B-Ve)<mo.Ib&&Math.abs(Z-tt)<mo.Ib&&Math.abs(j-st)<mo.Ib?Dp(e):(b=B-Ve,A=Z-tt,P=j-st,L=1/Math.hypot(b,A,P),b*=L,A*=L,P*=L,r=fe*P-Ce*A,o=Ce*b-J*P,u=J*A-fe*b,L=Math.hypot(r,o,u),L?(L=1/L,r*=L,o*=L,u*=L):(r=0,o=0,u=0),h=A*u-P*o,d=P*r-b*u,m=b*o-A*r,L=Math.hypot(h,d,m),L?(L=1/L,h*=L,d*=L,m*=L):(h=0,d=0,m=0),e[0]=r,e[1]=h,e[2]=b,e[3]=0,e[4]=o,e[5]=d,e[6]=A,e[7]=0,e[8]=u,e[9]=m,e[10]=P,e[11]=0,e[12]=-(r*B+o*Z+u*j),e[13]=-(h*B+d*Z+m*j),e[14]=-(b*B+A*Z+P*j),e[15]=1,e)}function Fv(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=n[0],d=n[1],m=n[2],b=r-t[0],A=o-t[1],P=u-t[2],L=b*b+A*A+P*P;L>0&&(L=1/Math.sqrt(L),b*=L,A*=L,P*=L);var B=d*P-m*A,Z=m*b-h*P,j=h*A-d*b;return L=B*B+Z*Z+j*j,L>0&&(L=1/Math.sqrt(L),B*=L,Z*=L,j*=L),e[0]=B,e[1]=Z,e[2]=j,e[3]=0,e[4]=A*j-P*Z,e[5]=P*B-b*j,e[6]=b*Z-A*B,e[7]=0,e[8]=b,e[9]=A,e[10]=P,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function Sc(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function fv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function l0(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e[4]=a[4]+t[4],e[5]=a[5]+t[5],e[6]=a[6]+t[6],e[7]=a[7]+t[7],e[8]=a[8]+t[8],e[9]=a[9]+t[9],e[10]=a[10]+t[10],e[11]=a[11]+t[11],e[12]=a[12]+t[12],e[13]=a[13]+t[13],e[14]=a[14]+t[14],e[15]=a[15]+t[15],e}function Yc(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e[4]=a[4]-t[4],e[5]=a[5]-t[5],e[6]=a[6]-t[6],e[7]=a[7]-t[7],e[8]=a[8]-t[8],e[9]=a[9]-t[9],e[10]=a[10]-t[10],e[11]=a[11]-t[11],e[12]=a[12]-t[12],e[13]=a[13]-t[13],e[14]=a[14]-t[14],e[15]=a[15]-t[15],e}function qc(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e[4]=a[4]*t,e[5]=a[5]*t,e[6]=a[6]*t,e[7]=a[7]*t,e[8]=a[8]*t,e[9]=a[9]*t,e[10]=a[10]*t,e[11]=a[11]*t,e[12]=a[12]*t,e[13]=a[13]*t,e[14]=a[14]*t,e[15]=a[15]*t,e}function c0(e,a,t,n){return e[0]=a[0]+t[0]*n,e[1]=a[1]+t[1]*n,e[2]=a[2]+t[2]*n,e[3]=a[3]+t[3]*n,e[4]=a[4]+t[4]*n,e[5]=a[5]+t[5]*n,e[6]=a[6]+t[6]*n,e[7]=a[7]+t[7]*n,e[8]=a[8]+t[8]*n,e[9]=a[9]+t[9]*n,e[10]=a[10]+t[10]*n,e[11]=a[11]+t[11]*n,e[12]=a[12]+t[12]*n,e[13]=a[13]+t[13]*n,e[14]=a[14]+t[14]*n,e[15]=a[15]+t[15]*n,e}function cp(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]}function Zh(e,a){var t=e[0],n=e[1],r=e[2],o=e[3],u=e[4],h=e[5],d=e[6],m=e[7],b=e[8],A=e[9],P=e[10],L=e[11],B=e[12],Z=e[13],j=e[14],J=e[15],fe=a[0],Ce=a[1],Ve=a[2],tt=a[3],st=a[4],Bt=a[5],Xt=a[6],cr=a[7],Ir=a[8],wr=a[9],Qr=a[10],Fn=a[11],ci=a[12],Ba=a[13],Ya=a[14],Is=a[15];return Math.abs(t-fe)<=mo.Ib*Math.max(1,Math.abs(t),Math.abs(fe))&&Math.abs(n-Ce)<=mo.Ib*Math.max(1,Math.abs(n),Math.abs(Ce))&&Math.abs(r-Ve)<=mo.Ib*Math.max(1,Math.abs(r),Math.abs(Ve))&&Math.abs(o-tt)<=mo.Ib*Math.max(1,Math.abs(o),Math.abs(tt))&&Math.abs(u-st)<=mo.Ib*Math.max(1,Math.abs(u),Math.abs(st))&&Math.abs(h-Bt)<=mo.Ib*Math.max(1,Math.abs(h),Math.abs(Bt))&&Math.abs(d-Xt)<=mo.Ib*Math.max(1,Math.abs(d),Math.abs(Xt))&&Math.abs(m-cr)<=mo.Ib*Math.max(1,Math.abs(m),Math.abs(cr))&&Math.abs(b-Ir)<=mo.Ib*Math.max(1,Math.abs(b),Math.abs(Ir))&&Math.abs(A-wr)<=mo.Ib*Math.max(1,Math.abs(A),Math.abs(wr))&&Math.abs(P-Qr)<=mo.Ib*Math.max(1,Math.abs(P),Math.abs(Qr))&&Math.abs(L-Fn)<=mo.Ib*Math.max(1,Math.abs(L),Math.abs(Fn))&&Math.abs(B-ci)<=mo.Ib*Math.max(1,Math.abs(B),Math.abs(ci))&&Math.abs(Z-Ba)<=mo.Ib*Math.max(1,Math.abs(Z),Math.abs(Ba))&&Math.abs(j-Ya)<=mo.Ib*Math.max(1,Math.abs(j),Math.abs(Ya))&&Math.abs(J-Is)<=mo.Ib*Math.max(1,Math.abs(J),Math.abs(Is))}var fp=Ol,dd=Yc,Bp,Bv,f0=(Bp=(0,$r.b2)(),Bp(Bv=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"viewport",void 0),(0,ae.Z)(this,"overridedViewProjectionMatrix",void 0),(0,ae.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,ae.Z)(this,"jitteredProjectionMatrix",void 0),(0,ae.Z)(this,"viewMatrixInverse",void 0),(0,ae.Z)(this,"cameraPosition",void 0)}return(0,Rt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Xc(),jf(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Pr.Z)(t,2),r=n[0],o=n[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var r=nv(Xc(),[t,n,0]);this.jitteredProjectionMatrix=Ol(Xc(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ol(Xc(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Bv),zd,hv;function Nv(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hf(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function hf(e,a){if(!!e){if(typeof e=="string")return xh(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xh(e,a)}}function xh(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var h0=(zd=(0,$r.b2)(),zd(hv=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"container",void 0),(0,ae.Z)(this,"controlCorners",void 0),(0,ae.Z)(this,"controlContainer",void 0),(0,ae.Z)(this,"scene",void 0),(0,ae.Z)(this,"mapsService",void 0),(0,ae.Z)(this,"controls",[]),(0,ae.Z)(this,"unAddControls",[])}return(0,Rt.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(rr.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var r=n.get(rr.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Nv(this.controls),n;try{for(t.s();!(n=t.n()).done;){var r=n.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",r=this.controlContainer=Mo("div",n+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],h=u.map(function(d){return n+d}).join(" ");t[u.join("")]=Mo("div",h,r)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&ku(this.controlCorners[t]);this.controlContainer&&ku(this.controlContainer)}}]),e}())||hv),Ud,vd,p0=(Ud=(0,$r.b2)(),Ud(vd=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"container",void 0),(0,ae.Z)(this,"scene",void 0),(0,ae.Z)(this,"mapsService",void 0),(0,ae.Z)(this,"markers",[]),(0,ae.Z)(this,"markerLayers",[]),(0,ae.Z)(this,"unAddMarkers",[]),(0,ae.Z)(this,"unAddMarkerLayers",[])}return(0,Rt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(rr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||vd),pv,Zd,dv=(pv=(0,$r.b2)(),pv(Zd=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"scene",void 0),(0,ae.Z)(this,"popup",void 0),(0,ae.Z)(this,"mapsService",void 0),(0,ae.Z)(this,"unAddPopup",void 0)}return(0,Rt.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(rr.IMapService)}}]),e}())||Zd),Vd={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},vv=Vd,hp,zv,Np={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},d0={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},pp=(hp=(0,$r.b2)(),hp(zv=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"sceneConfigCache",{}),(0,ae.Z)(this,"layerConfigCache",{})}return(0,Rt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return vv[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,Q.Z)((0,Q.Z)({},Np),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,r){this.layerConfigCache[n]=(0,Q.Z)({},(0,l.merge)({},this.sceneConfigCache[t],d0,r))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||zv);function ga(e,a,t,n){!t||Object.defineProperty(e,a,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function wa(e,a,t,n,r){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,h){return h(e,a,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,a,o),o=null),o}function v0(){var e=new mo.WT(4);return mo.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Tm(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function G0(e,a,t,n){var r=new mo.WT(4);return r[0]=e,r[1]=a,r[2]=t,r[3]=n,r}function Mm(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function Im(e,a,t,n,r){return e[0]=a,e[1]=t,e[2]=n,e[3]=r,e}function Pm(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e}function Hf(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e}function Uv(e,a,t){return e[0]=a[0]*t[0],e[1]=a[1]*t[1],e[2]=a[2]*t[2],e[3]=a[3]*t[3],e}function md(e,a,t){return e[0]=a[0]/t[0],e[1]=a[1]/t[1],e[2]=a[2]/t[2],e[3]=a[3]/t[3],e}function mv(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e[3]=Math.ceil(a[3]),e}function Ks(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e[3]=Math.floor(a[3]),e}function H0(e,a,t){return e[0]=Math.min(a[0],t[0]),e[1]=Math.min(a[1],t[1]),e[2]=Math.min(a[2],t[2]),e[3]=Math.min(a[3],t[3]),e}function kg(e,a,t){return e[0]=Math.max(a[0],t[0]),e[1]=Math.max(a[1],t[1]),e[2]=Math.max(a[2],t[2]),e[3]=Math.max(a[3],t[3]),e}function W0(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e[3]=Math.round(a[3]),e}function m0(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e}function g0(e,a,t,n){return e[0]=a[0]+t[0]*n,e[1]=a[1]+t[1]*n,e[2]=a[2]+t[2]*n,e[3]=a[3]+t[3]*n,e}function Lg(e,a){var t=a[0]-e[0],n=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return Math.hypot(t,n,r,o)}function Og(e,a){var t=a[0]-e[0],n=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return t*t+n*n+r*r+o*o}function y0(e){var a=e[0],t=e[1],n=e[2],r=e[3];return Math.hypot(a,t,n,r)}function km(e){var a=e[0],t=e[1],n=e[2],r=e[3];return a*a+t*t+n*n+r*r}function Lm(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e[3]=-a[3],e}function Rg(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e[3]=1/a[3],e}function Dg(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=t*t+n*n+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=n*u,e[2]=r*u,e[3]=o*u,e}function X0(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3]}function Vy(e,a,t,n){var r=t[0]*n[1]-t[1]*n[0],o=t[0]*n[2]-t[2]*n[0],u=t[0]*n[3]-t[3]*n[0],h=t[1]*n[2]-t[2]*n[1],d=t[1]*n[3]-t[3]*n[1],m=t[2]*n[3]-t[3]*n[2],b=a[0],A=a[1],P=a[2],L=a[3];return e[0]=A*m-P*d+L*h,e[1]=-(b*m)+P*u-L*o,e[2]=b*d-A*u+L*r,e[3]=-(b*h)+A*o-P*r,e}function jy(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=a[3];return e[0]=r+n*(t[0]-r),e[1]=o+n*(t[1]-o),e[2]=u+n*(t[2]-u),e[3]=h+n*(t[3]-h),e}function Om(e,a){a=a||1;var t,n,r,o,u,h;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=t*t+n*n;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,h=r*r+o*o;while(h>=1);var d=Math.sqrt((1-u)/h);return e[0]=a*t,e[1]=a*n,e[2]=a*r*d,e[3]=a*o*d,e}function Y0(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3];return e[0]=t[0]*n+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*n+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*n+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*n+t[7]*r+t[11]*o+t[15]*u,e}function Gy(e,a,t){var n=a[0],r=a[1],o=a[2],u=t[0],h=t[1],d=t[2],m=t[3],b=m*n+h*o-d*r,A=m*r+d*n-u*o,P=m*o+u*r-h*n,L=-u*n-h*r-d*o;return e[0]=b*m+L*-u+A*-d-P*-h,e[1]=A*m+L*-h+P*-u-b*-d,e[2]=P*m+L*-d+b*-h-A*-u,e[3]=a[3],e}function Hy(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Wy(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Xy(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function jd(e,a){var t=e[0],n=e[1],r=e[2],o=e[3],u=a[0],h=a[1],d=a[2],m=a[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(n-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))}var Rm=null,Yy=null,qy=null,q0=null,$y=null,Ky=null,$0=null,Zv=function(){var e=v0();return function(a,t,n,r,o,u){var h,d;for(t||(t=4),n||(n=0),r?d=Math.min(r*t+n,a.length):d=a.length,h=n;h<d;h+=t)e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],e[3]=a[h+3],o(e,e,u),a[h]=e[0],a[h+1]=e[1],a[h+2]=e[2],a[h+3]=e[3];return a}}(),_0=Math.PI/180,K0=512,Dm=4003e4;function Fm(e){var a=e.latitude,t=a===void 0?0:a,n=e.zoom,r=n===void 0?0:n,o=e.scale,u=e.highPrecision,h=u===void 0?!1:u,d=e.flipY,m=d===void 0?!1:d;o=o!==void 0?o:Math.pow(2,r);var b={},A=K0*o,P=Math.cos(t*_0),L=A/360,B=L/P,Z=A/Dm/P;if(b.pixelsPerMeter=[Z,-Z,Z],b.metersPerPixel=[1/Z,-1/Z,1/Z],b.pixelsPerDegree=[L,-B,Z],b.degreesPerPixel=[1/L,-1/B,1/Z],h){var j=_0*Math.tan(t*_0)/P,J=L*j/2,fe=A/Dm*j,Ce=fe/B*Z;b.pixelsPerDegree2=[0,-J,fe],b.pixelsPerMeter2=[Ce,0,Ce],m&&(b.pixelsPerDegree2[1]=-b.pixelsPerDegree2[1],b.pixelsPerMeter2[1]=-b.pixelsPerMeter2[1])}return m&&(b.pixelsPerMeter[1]=-b.pixelsPerMeter[1],b.metersPerPixel[1]=-b.metersPerPixel[1],b.pixelsPerDegree[1]=-b.pixelsPerDegree[1],b.degreesPerPixel[1]=-b.degreesPerPixel[1]),b}var zp;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(zp||(zp={}));var gd={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},x0,Q0,gv,yd,Gd,J0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Bm=(x0=(0,$r.b2)(),Q0=(0,$r.f3)(rr.ICameraService),x0(gv=(yd=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"needRefresh",!0),ga(this,"cameraService",Gd,this),(0,ae.Z)(this,"coordinateSystem",void 0),(0,ae.Z)(this,"viewportCenter",void 0),(0,ae.Z)(this,"viewportCenterProjection",void 0),(0,ae.Z)(this,"pixelsPerDegree",void 0),(0,ae.Z)(this,"pixelsPerDegree2",void 0),(0,ae.Z)(this,"pixelsPerMeter",void 0)}return(0,Rt.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=Fm({latitude:o[1],zoom:n}),h=u.pixelsPerMeter,d=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=h,this.pixelsPerDegree=d,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===zp.LNGLAT||this.coordinateSystem===zp.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===zp.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===zp.P20_OFFSET&&this.calculateLnglatOffset(o,n,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,r,o){var u=Fm({latitude:t[1],zoom:n,scale:r,flipY:o,highPrecision:!0}),h=u.pixelsPerMeter,d=u.pixelsPerDegree,m=u.pixelsPerDegree2,b=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),P=Ol([],A,b),L=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Y0([],[L[0],L[1],0,1],P),b=this.cameraService.getViewMatrixUncentered()||b,P=Ol([],A,b),P=Ol([],P,J0),this.cameraService.setViewProjectionMatrix(P),this.pixelsPerMeter=h,this.pixelsPerDegree=d,this.pixelsPerDegree2=m}}]),e}(),Gd=wa(yd.prototype,"cameraService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||gv),Fg=ue(20396),Hd=ue.n(Fg),ou;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ou||(ou={}));var em,Nm,zm,b0,Um;function Zm(e){var a=Bg();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Bg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ng={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},tm=(em=(0,$r.b2)(),Nm=(0,$r.f3)(rr.IMapService),em(zm=(b0=function(e){(0,Or.Z)(t,e);var a=Zm(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"indragging",!1),ga((0,At.Z)(n),"mapService",Um,(0,At.Z)(n)),(0,ae.Z)((0,At.Z)(n),"hammertime",void 0),(0,ae.Z)((0,At.Z)(n),"lastClickTime",0),(0,ae.Z)((0,At.Z)(n),"lastClickXY",[-1,-1]),(0,ae.Z)((0,At.Z)(n),"clickTimer",void 0),(0,ae.Z)((0,At.Z)(n),"$containter",void 0),(0,ae.Z)((0,At.Z)(n),"onDrag",function(h){var d=n.interactionEvent(h);d.type=Ng[d.type],d.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(ou.Drag,d)}),(0,ae.Z)((0,At.Z)(n),"onHammer",function(h){h.srcEvent.stopPropagation();var d=n.interactionEvent(h);n.emit(ou.Hover,d)}),(0,ae.Z)((0,At.Z)(n),"onTouch",function(h){var d=h.touches[0];n.onHover({x:d.pageX,y:d.pageY,type:"touch"})}),(0,ae.Z)((0,At.Z)(n),"onHover",function(h){var d=h.clientX,m=h.clientY,b=d,A=m,P=h.type,L=n.mapService.getMapContainer();if(L)if(Eu)b=b-L.left-0,A=A-L.top-0;else{var B=L.getBoundingClientRect(),Z=B.top,j=B.left;b=b-j-L.clientLeft,A=A-Z-L.clientTop}var J=n.mapService.containerToLngLat([b,A]);if(P==="click"){if(!Eu&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(b,A,J);return}if(P==="touch"){n.isDoubleTap(b,A,J);return}P!=="click"&&P!=="dblclick"&&n.emit(ou.Hover,{x:b,y:A,lngLat:J,type:P,target:h})}),n}return(0,Rt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ou.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(ou.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(ou.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(ou.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Eu)Ui.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(Hd()).Manager(r);o.add(new(Hd()).Tap({event:"dblclick",taps:2})),o.add(new(Hd()).Tap({event:"click"})),o.add(new(Hd()).Pan({threshold:0,pointers:0})),o.add(new(Hd()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Eu)Ui.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,h,d;u==="touch"?(d=Math.floor(r.pointers[0].clientY),h=Math.floor(r.pointers[0].clientX)):(d=Math.floor(r.srcEvent.y),h=Math.floor(r.srcEvent.x));var m=this.mapService.getMapContainer();if(m){var b=m.getBoundingClientRect(),A=b.top,P=b.left;h-=P,d-=A}var L=this.mapService.containerToLngLat([h,d]);return{x:h,y:d,lngLat:L,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var h=this,d=new Date().getTime(),m="click";d-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),m="dblclick",this.emit(ou.Hover,{x:r,y:o,lngLat:u,type:m})):(this.lastClickTime=d,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){m="click",h.emit(ou.Hover,{x:r,y:o,lngLat:u,type:m})},400))}}]),t}(Mp()),Um=wa(b0.prototype,"mapService",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b0))||zm),Ku=0;function rm(e){if(Eu)return null;var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Ku++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function Vv(e){var a,t,n=!0;return e==null||(a=e.target)===null||a===void 0||(t=a.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var Y;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Y||(Y={}));var jv,yv,Gv,Vm,E0,Hv,Uu,pf,Wd,C0,Up,Xd,S0,zg=(jv=(0,$r.b2)(),yv=(0,$r.f3)(rr.IMapService),Gv=(0,$r.f3)(rr.IRendererService),Vm=(0,$r.f3)(rr.IGlobalConfigService),E0=(0,$r.f3)(rr.IInteractionService),Hv=(0,$r.f3)(rr.ILayerService),jv(Uu=(pf=function(){function e(){var a=this;(0,Ht.Z)(this,e),(0,ae.Z)(this,"pickedColors",void 0),(0,ae.Z)(this,"pickedTileLayers",[]),ga(this,"mapService",Wd,this),ga(this,"rendererService",C0,this),ga(this,"configService",Up,this),ga(this,"interactionService",Xd,this),ga(this,"layerService",S0,this),(0,ae.Z)(this,"pickingFBO",void 0),(0,ae.Z)(this,"width",0),(0,ae.Z)(this,"height",0),(0,ae.Z)(this,"alreadyInPicking",!1),(0,ae.Z)(this,"pickBufferScale",1),(0,ae.Z)(this,"pickedLayers",[]),(0,ae.Z)(this,"pickFromPickingFBO",function(t,n){var r=n.x,o=n.y,u=n.lngLat,h=n.type,d=n.target,m=!1,b=a.rendererService,A=b.readPixels,P=b.getContainer,L=a.getContainerSize(P()),B=L.width,Z=L.height;B*=va,Z*=va;var j=t.getLayerConfig(),J=j.enableHighlight,fe=j.enableSelect,Ce=r*va,Ve=o*va;if(Ce>B-1*va||Ce<0||Ve>Z-1*va||Ve<0)return!1;var tt=A({x:Math.floor(Ce/a.pickBufferScale),y:Math.floor((Z-(o+1)*va)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=tt,tt[0]!==0||tt[1]!==0||tt[2]!==0){var st=O(tt),Bt=t.getSource().getFeatureById(st);st!==t.getCurrentPickId()&&h==="mousemove"&&(h="mouseenter");var Xt={x:r,y:o,type:h,lngLat:u,featureId:st,feature:Bt,target:d};Bt&&(m=!0,t.setCurrentPickId(st),a.pickedLayers=[t],a.triggerHoverOnLayer(t,Xt))}else{var cr={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&h==="mousemove"?"mouseout":"un"+h,featureId:null,target:d,feature:null};a.triggerHoverOnLayer(t,(0,Q.Z)((0,Q.Z)({},cr),{},{type:"unpick"})),a.triggerHoverOnLayer(t,cr),t.setCurrentPickId(null),a.pickedLayers=[]}if(J&&a.highlightPickedFeature(t,tt),fe&&h==="click"&&(tt==null?void 0:tt.toString())!==[0,0,0,0].toString()){var Ir=O(tt);t.getCurrentSelectedId()===null||Ir!==t.getCurrentSelectedId()?(a.selectFeature(t,tt),t.setCurrentSelectedId(Ir)):(a.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||a.layerService.getLayers().filter(function(wr){return wr.tileLayer}).map(function(wr){wr.tileLayer.clearPickState()})}return m})}return(0,Rt.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,h=this.getContainerSize(u()),d=h.width,m=h.height;d*=va,m*=va,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(d/this.pickBufferScale),height:Math.round(m/this.pickBufferScale),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(ou.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,xa.Z)(di().mark(function n(r,o,u){var h=this,d,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:d=this.rendererService,m=d.useFramebuffer,b=d.clear,A=d.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){b({framebuffer:h.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var B=h.pickBox(r,o);u(B)});case 3:case"end":return L.stop()}},n,this)}));function t(n,r,o){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var r=this,o=n.map(function(Ir){var wr=Ir<0?0:Ir;return Math.floor(wr*va/r.pickBufferScale)}),u=(0,Pr.Z)(o,4),h=u[0],d=u[1],m=u[2],b=u[3],A=this.rendererService,P=A.readPixels,L=A.getContainer,B=this.getContainerSize(L()),Z=B.width,j=B.height;if(Z*=va,j*=va,h>(Z-1)*va/this.pickBufferScale||m<0||d>(j-1)*va/this.pickBufferScale||b<0)return[];for(var J=Math.min(Z/this.pickBufferScale,m)-h,fe=Math.min(j/this.pickBufferScale,b)-d,Ce=P({x:h,y:Math.floor(j/this.pickBufferScale-(b+1)),width:J,height:fe,data:new Uint8Array(J*fe*4),framebuffer:this.pickingFBO}),Ve=[],tt={},st=0;st<Ce.length/4;st=st+1){var Bt=Ce.slice(st*4,st*4+4),Xt=O(Bt);if(Xt!==-1&&!tt[Xt]){var cr=t.getSource().getFeatureById(Xt);Ve.push((0,Q.Z)((0,Q.Z)({},cr),{},{pickedFeatureIdx:Xt})),tt[Xt]=!0}}return Ve}},{key:"handleCursor",value:function(t,n){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,h=r.cursorEnabled;if(h){var d=this.mapService.version,m=d==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),b=m==null?void 0:m.style.getPropertyValue("cursor");n==="unmousemove"&&b!==""?m==null||m.style.setProperty("cursor",""):n==="mousemove"&&(m==null||m.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/va,height:t.height/va}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,xa.Z)(di().mark(function n(r){return di().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),r=n.width,o=n.height;r*=va,o*=va,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,xa.Z)(di().mark(function n(r){var o=this,u,h,d,m,b;return di().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:u=this.rendererService,h=u.getViewportSize,d=u.useFramebuffer,m=u.clear,b=u.getContainer,this.resizePickingFBO(),d(this.pickingFBO,function(){var L=o.layerService.getRenderList();L.filter(function(B){return B.needPick(r.type)}).reverse().some(function(B){if(m({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedLayers.filter(function(j){return!j.isVector}).map(function(j){o.selectFeature(j,new Uint8Array([0,0,0,0]))}),o.pickedTileLayers.map(function(j){var J;return(J=j.tileLayer)===null||J===void 0?void 0:J.clearPick(r.type)}),B.tileLayer)return B.tileLayer.pickLayers(r);B.hooks.beforePickingEncode.call(),B.masks.length>0&&B.masks.map(function(j){j.hooks.beforeRenderData.call(),j.hooks.beforeRender.call(),j.render(),j.hooks.afterRender.call()}),B.renderModels(!0),B.hooks.afterPickingEncode.call();var Z=o.pickFromPickingFBO(B,r);return o.layerService.pickedLayerId=Z?+B.id:-1,Z&&!B.getLayerConfig().enablePropagation})});case 3:case"end":return P.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Vv(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(t,n){var r=(0,Pr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeHighlight.call([o,u,h])}},{key:"selectFeature",value:function(t,n){var r=(0,Pr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeSelect.call([o,u,h])}}]),e}(),Wd=wa(pf.prototype,"mapService",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0=wa(pf.prototype,"rendererService",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Up=wa(pf.prototype,"configService",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=wa(pf.prototype,"interactionService",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S0=wa(pf.prototype,"layerService",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pf))||Uu),Ug=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Ht.Z)(this,e),(0,ae.Z)(this,"autoStart",void 0),(0,ae.Z)(this,"startTime",0),(0,ae.Z)(this,"oldTime",0),(0,ae.Z)(this,"running",!1),(0,ae.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,Rt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),jm,Gm,Hm,nm,im,_v,am,_,w;function M(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=D(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function D(e,a){if(!!e){if(typeof e=="string")return N(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return N(e,a)}}function N(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var te=(jm=(0,$r.b2)(),Gm=(0,$r.f3)(rr.IRendererService),Hm=(0,$r.f3)(rr.IMapService),nm=(0,$r.f3)(rr.IGlobalConfigService),jm(im=(_v=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"pickedLayerId",-1),(0,ae.Z)(this,"clock",new Ug),(0,ae.Z)(this,"alreadyInRendering",!1),(0,ae.Z)(this,"layers",[]),(0,ae.Z)(this,"layerList",[]),(0,ae.Z)(this,"layerRenderID",void 0),(0,ae.Z)(this,"sceneInited",!1),(0,ae.Z)(this,"animateInstanceCount",0),(0,ae.Z)(this,"shaderPicking",!0),(0,ae.Z)(this,"enableRender",!0),ga(this,"renderService",am,this),ga(this,"mapService",_,this),ga(this,"configService",w,this)}return(0,Rt.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(n){return n.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(n){return n.name===t})}},{key:"cleanRemove",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1),n&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,n){if(n){var r=n.layerChildren.indexOf(t);r>-1&&n.layerChildren.splice(r,1)}else{var o=this.layers.indexOf(t);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var a=(0,xa.Z)(di().mark(function n(){var r,o,u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){d.next=2;break}return d.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),r=M(this.layerList),d.prev=5,r.s();case 7:if((o=r.n()).done){d.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(m){m.hooks.beforeRenderData.call(),m.hooks.beforeRender.call(),m.render(),m.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){d.next=17;break}return d.next=15,u.renderMultiPass();case 15:d.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:d.next=7;break;case 21:d.next=26;break;case 23:d.prev=23,d.t0=d.catch(5),r.e(d.t0);case 26:return d.prev=26,r.f(),d.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return d.stop()}},n,this,[[5,23,26,29]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,r){return n.zIndex-r.zIndex}).forEach(function(n){t.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=I(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ui.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ui.cancelAnimationFrame(this.layerRenderID)}}]),e}(),am=wa(_v.prototype,"renderService",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=wa(_v.prototype,"mapService",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=wa(_v.prototype,"configService",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v))||im),pe=ue(81253),de=function(){function e(a){var t=this;(0,Ht.Z)(this,e),(0,ae.Z)(this,"name",void 0),(0,ae.Z)(this,"type",void 0),(0,ae.Z)(this,"scale",void 0),(0,ae.Z)(this,"descriptor",void 0),(0,ae.Z)(this,"featureBufferLayout",[]),(0,ae.Z)(this,"needRescale",!1),(0,ae.Z)(this,"needRemapping",!1),(0,ae.Z)(this,"needRegenerateVertices",!1),(0,ae.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,ae.Z)(this,"vertexAttribute",void 0),(0,ae.Z)(this,"defaultCallback",function(n){if(n.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return n.map(function(o,u){var h,d=(h=t.scale)===null||h===void 0?void 0:h.scalers[u].func,m=d(o);return m})}),this.setProps(a)}return(0,Rt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,V.Z)(t));if(!(0,l.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),ze=["modelType"],Xe=["buffer","update","name"],He=["buffer","update","name"],nr=["buffer","update","name"],Er,Nr,Yr,Ln,Sn,Zn;function bn(e){return new Promise(function(a){return setTimeout(a,e)})}var ii=(Er={},(0,ae.Z)(Er,Y.FLOAT,4),(0,ae.Z)(Er,Y.UNSIGNED_BYTE,1),(0,ae.Z)(Er,Y.UNSIGNED_SHORT,2),Er),Ei=(Nr=(0,$r.b2)(),Yr=(0,$r.f3)(rr.IRendererService),Nr(Ln=(Sn=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"attributesAndIndices",void 0),ga(this,"rendererService",Zn,this),(0,ae.Z)(this,"attributes",[]),(0,ae.Z)(this,"triangulation",void 0),(0,ae.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Rt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new de(t),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(t,n,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,Q.Z)((0,Q.Z)({},n),{},{name:t})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,r=this.getLayerStyleAttribute(t),o=r==null||(n=r.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=this.attributes.find(function(Ve){return Ve.name===t});if(u&&u.descriptor){var h=u.descriptor,d=h.update,m=h.buffer,b=h.size,A=b===void 0?0:b,P=ii[m.type||Y.FLOAT];if(d){var L=this.featureLayout,B=L.elements,Z=L.sizePerElement,j=B.slice(r,o);if(!j.length)return;var J=j[0].offset,fe=J*A*P,Ce=j.map(function(Ve,tt){for(var st=Ve.featureIdx,Bt=Ve.vertices,Xt=Ve.normals,cr=Bt.length/Z,Ir=[],wr=0;wr<cr;wr++){var Qr=Xt?Xt.slice(wr*3,wr*3+3):[];Ir.push.apply(Ir,(0,V.Z)(d(n[st],st,Bt.slice(wr*Z,wr*Z+Z),tt,Qr)))}return Ir}).reduce(function(Ve,tt){return Ve.push.apply(Ve,(0,V.Z)(tt)),Ve},[]);u.vertexAttribute.updateBuffer({data:Ce,offset:fe})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(B){return B.resetDescriptor(),B.descriptor}).filter(function(B){return B}),h=r.modelType,d=(0,pe.Z)(r,ze),m=this.rendererService,b=m.createAttribute,A=m.createBuffer,P=m.createElements,L={};return new Promise(function(B,Z){Ap(h,(0,Q.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:n},d)).then(function(j){j.descriptors.forEach(function(fe,Ce){if(fe){var Ve=fe.buffer,tt=fe.update,st=fe.name,Bt=(0,pe.Z)(fe,Xe),Xt=b((0,Q.Z)({buffer:A(Ve)},Bt));L[fe.name||""]=Xt,o.attributes[Ce].vertexAttribute=Xt}}),o.featureLayout=j.featureLayout;var J=P({data:j.indices,type:Y.UNSIGNED_INT,count:j.indices.length});o.attributesAndIndices={attributes:L,elements:J,count:null},B(o.attributesAndIndices)}).catch(function(j){console.warn(j),Z(j)})})}},{key:"createAttributesAndIndices",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(Ce){return Ce.resetDescriptor(),Ce.descriptor}),h=0,d=0,m=[],b=[],A=[],P=3;t.forEach(function(Ce,Ve){var tt=o.triangulation(Ce,r),st=tt.indices,Bt=tt.vertices,Xt=tt.normals,cr=tt.size,Ir=tt.indexes,wr=tt.count;typeof wr=="number"&&(d+=wr),st.forEach(function(Ba){b.push(Ba+h)}),P=cr;var Qr=Bt.length/cr;o.featureLayout.sizePerElement=P,o.featureLayout.elements.push({featureIdx:Ve,vertices:Bt,normals:Xt,offset:h}),h+=Qr;for(var Fn=function(Ya){var Is=(Xt==null?void 0:Xt.slice(Ya*3,Ya*3+3))||[],Iu=Bt.slice(Ya*cr,Ya*cr+cr),gu=0;Ir&&Ir[Ya]!==void 0&&(gu=Ir[Ya]),u.forEach(function(vf,Mv){if(vf&&vf.update){var Iv;(Iv=vf.buffer.data).push.apply(Iv,(0,V.Z)(vf.update(Ce,Ve,Iu,Ya,Is,gu)))}})},ci=0;ci<Qr;ci++)Fn(ci)});var L=this.rendererService,B=L.createAttribute,Z=L.createBuffer,j=L.createElements,J={};u.forEach(function(Ce,Ve){if(Ce){var tt=Ce.buffer,st=Ce.update,Bt=Ce.name,Xt=(0,pe.Z)(Ce,He),cr=B((0,Q.Z)({buffer:Z(tt)},Xt));J[Ce.name||""]=cr,o.attributes[Ve].vertexAttribute=cr}});var fe=j({data:b,type:Y.UNSIGNED_INT,count:b.length});return this.attributesAndIndices={attributes:J,elements:fe,count:d},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(L){return L.resetDescriptor(),L.descriptor}),u=0,h=[],d=3;t.forEach(function(L,B){var Z=r.triangulation(L),j=Z.indices,J=Z.vertices,fe=Z.normals,Ce=Z.size,Ve=Z.indexes;j.forEach(function(Xt){h.push(Xt+u)}),d=Ce;var tt=J.length/Ce;r.featureLayout.sizePerElement=d,r.featureLayout.elements.push({featureIdx:B,vertices:J,normals:fe,offset:u}),u+=tt;for(var st=function(cr){var Ir=(fe==null?void 0:fe.slice(cr*3,cr*3+3))||[],wr=J.slice(cr*Ce,cr*Ce+Ce),Qr=0;Ve&&Ve[cr]!==void 0&&(Qr=Ve[cr]),o.forEach(function(Fn,ci){if(Fn&&Fn.update){var Ba;(Ba=Fn.buffer.data).push.apply(Ba,(0,V.Z)(Fn.update(L,B,wr,cr,Ir,Qr)))}})},Bt=0;Bt<tt;Bt++)st(Bt)});var m=this.rendererService,b=m.createAttribute,A=m.createBuffer,P={};return o.forEach(function(L,B){if(L){var Z=L.buffer,j=L.update,J=L.name,fe=(0,pe.Z)(L,nr),Ce=b((0,Q.Z)({buffer:A(Z)},fe));P[L.name||""]=Ce,r.attributes[B].vertexAttribute=Ce}}),{attributes:P}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),Zn=wa(Sn.prototype,"rendererService",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sn))||Ln),go=ue(67709),uo=ue.n(go),Xa,ro,no,Kr,fn,Fi,Wa,ba,Qu,vl,rs,ml,ps,bh,dp,Zu,ns,Vo,Mu,Dl,Wf,Zp,om,Wv,A0,Qy,Jy,e_,t_,r_,n_,i_,a_;function AE(e){var a=wE();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TE=(Xa=(0,$r.b2)(),ro=(0,$r.f3)(rr.SceneID),no=(0,$r.f3)(rr.IIconService),Kr=(0,$r.f3)(rr.IFontService),fn=(0,$r.f3)(rr.IControlService),Fi=(0,$r.f3)(rr.IGlobalConfigService),Wa=(0,$r.f3)(rr.IMapService),ba=(0,$r.f3)(rr.ICoordinateSystemService),Qu=(0,$r.f3)(rr.IRendererService),vl=(0,$r.f3)(rr.ILayerService),rs=(0,$r.f3)(rr.ICameraService),ml=(0,$r.f3)(rr.IInteractionService),ps=(0,$r.f3)(rr.IPickingService),bh=(0,$r.f3)(rr.IShaderModuleService),dp=(0,$r.f3)(rr.IMarkerService),Zu=(0,$r.f3)(rr.IPopupService),Xa(ns=(Vo=function(e){(0,Or.Z)(t,e);var a=AE(t);function t(){var n;return(0,Ht.Z)(this,t),n=a.call(this),(0,ae.Z)((0,At.Z)(n),"destroyed",!1),(0,ae.Z)((0,At.Z)(n),"loaded",!1),(0,ae.Z)((0,At.Z)(n),"loadFont",!1),(0,ae.Z)((0,At.Z)(n),"fontFamily",""),ga((0,At.Z)(n),"id",Mu,(0,At.Z)(n)),ga((0,At.Z)(n),"iconService",Dl,(0,At.Z)(n)),ga((0,At.Z)(n),"fontService",Wf,(0,At.Z)(n)),ga((0,At.Z)(n),"controlService",Zp,(0,At.Z)(n)),ga((0,At.Z)(n),"configService",om,(0,At.Z)(n)),ga((0,At.Z)(n),"map",Wv,(0,At.Z)(n)),ga((0,At.Z)(n),"coordinateSystemService",A0,(0,At.Z)(n)),ga((0,At.Z)(n),"rendererService",Qy,(0,At.Z)(n)),ga((0,At.Z)(n),"layerService",Jy,(0,At.Z)(n)),ga((0,At.Z)(n),"cameraService",e_,(0,At.Z)(n)),ga((0,At.Z)(n),"interactionService",t_,(0,At.Z)(n)),ga((0,At.Z)(n),"pickingService",r_,(0,At.Z)(n)),ga((0,At.Z)(n),"shaderModuleService",n_,(0,At.Z)(n)),ga((0,At.Z)(n),"markerService",i_,(0,At.Z)(n)),ga((0,At.Z)(n),"popupService",a_,(0,At.Z)(n)),(0,ae.Z)((0,At.Z)(n),"inited",!1),(0,ae.Z)((0,At.Z)(n),"initPromise",void 0),(0,ae.Z)((0,At.Z)(n),"rendering",!1),(0,ae.Z)((0,At.Z)(n),"$container",void 0),(0,ae.Z)((0,At.Z)(n),"canvas",void 0),(0,ae.Z)((0,At.Z)(n),"markerContainer",void 0),(0,ae.Z)((0,At.Z)(n),"hooks",void 0),(0,ae.Z)((0,At.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Jf(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,ae.Z)((0,At.Z)(n),"handleMapCameraChanged",function(r){n.cameraService.update(r),n.render()}),n.hooks={init:new j0},n}return(0,Rt.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,xa.Z)(di().mark(function u(){return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),o.map.version!=="GAODE2.x"&&m()}),o.map.version!=="GAODE2.x"?o.map.init():m()});case 2:if(!(o.map.version==="GAODE2.x"&&o.map.initViewPort)){d.next=6;break}return d.next=5,o.map.init();case 5:o.map.initViewPort();case 6:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(ou.Drag,o.addSceneEvent.bind(o));case 13:case"end":return d.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,xa.Z)(di().mark(function u(){var h,d;return di().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(h=rm(o.configService.getSceneConfig(o.id).id||""),o.$container=h,!h){b.next=12;break}return o.canvas=Mo("canvas","",h),o.setCanvas(),b.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.initContainer(),uo()(o.$container,o.handleWindowResized),Ui.matchMedia&&((d=Ui.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||d===void 0||d.addListener(o.handleWindowResized)),b.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return b.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,xa.Z)(di().mark(function u(){return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),o.map.version!=="GAODE2.x"&&m()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(ou.Drag,o.addSceneEvent.bind(o));case 5:case"end":return d.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,xa.Z)(di().mark(function u(){var h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(h=r.canvas,o.$container=h||null,!o.$container){m.next=7;break}return m.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:m.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return m.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var n=(0,xa.Z)(di().mark(function o(){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.rendering||this.destroyed)){h.next=2;break}return h.abrupt("return");case 2:if(this.rendering=!0,this.inited){h.next=23;break}return h.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){h.next=18;break}return h.prev=8,h.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:h.next=18;break;case 13:h.prev=13,h.t0=h.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(h.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return h.stop()}},o,this,[[8,13]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontFamily=r;var u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(u),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(r){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var h=r==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return h}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=Mo("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var d;(d=r.$container)===null||d===void 0||d.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,go.unbind)(this.$container,this.handleWindowResized),Ui.matchMedia){var h;(h=Ui.matchMedia("screen and (min-resolution: 2dppx)"))===null||h===void 0||h.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var r,o,u=va,h=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,d=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m&&(m.width=h*u,m.height=d*u),this.rendererService.viewport({x:0,y:0,width:u*h,height:u*d})}},{key:"setCanvas",value:function(){var r,o,u=va,h=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,d=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m.width=h*u,m.height=d*u,m.style.width="100%",m.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(qu.EventEmitter),Mu=wa(Vo.prototype,"id",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=wa(Vo.prototype,"iconService",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wf=wa(Vo.prototype,"fontService",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zp=wa(Vo.prototype,"controlService",[fn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=wa(Vo.prototype,"configService",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=wa(Vo.prototype,"map",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0=wa(Vo.prototype,"coordinateSystemService",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=wa(Vo.prototype,"rendererService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=wa(Vo.prototype,"layerService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=wa(Vo.prototype,"cameraService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=wa(Vo.prototype,"interactionService",[ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=wa(Vo.prototype,"pickingService",[ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n_=wa(Vo.prototype,"shaderModuleService",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=wa(Vo.prototype,"markerService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=wa(Vo.prototype,"popupService",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vo))||ns);function ME(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var IE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function o_(e){var a={};return e=e.replace(IE,function(t,n,r){var o=r.split(":"),u=o[0].trim(),h="";switch(o.length>1&&(h=o[1].trim()),n){case"bool":h=h==="true";break;case"float":case"int":h=Number(h);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":h?h=h.replace("[","").replace("]","").split(",").reduce(function(d,m){return d.push(Number(m.trim())),d},[]):h=new Array(ME(n)).fill(0);break;default:}return a[u]=h,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:a}}var s_,u_,l_="#define PI 3.14159265359",PE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,kE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,LE=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,OE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,RE=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,DE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,FE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,BE=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,NE=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,zE=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,UE=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,ZE=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,VE=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,jE=/precision\s+(high|low|medium)p\s+float/,GE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,HE=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,WE=(s_=(0,$r.b2)(),s_(u_=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"moduleCache",{}),(0,ae.Z)(this,"rawContentCache",{})}return(0,Rt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:l_,fs:l_}),this.registerModule("decode",{vs:PE,fs:""}),this.registerModule("projection",{vs:FE,fs:""}),this.registerModule("project",{vs:DE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:BE}),this.registerModule("lighting",{vs:LE,fs:""}),this.registerModule("light",{vs:kE,fs:""}),this.registerModule("picking",{vs:RE,fs:OE}),this.registerModule("styleMapping",{vs:NE,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:VE,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:zE,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:UE,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:ZE,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var r=n.vs,o=n.fs,u=n.uniforms,h=o_(r),d=h.content,m=h.uniforms,b=o_(o),A=b.content,P=b.uniforms;this.rawContentCache[t]={fs:A,uniforms:(0,Q.Z)((0,Q.Z)((0,Q.Z)({},m),P),u),vs:d}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),h=u.content,d=u.includeList,m=this.processModule(o,[],"fs"),b=m.content,A=m.includeList,P=b,L=(0,l.uniq)(d.concat(A).concat(t)).reduce(function(B,Z){return(0,Q.Z)((0,Q.Z)({},B),n.rawContentCache[Z].uniforms)},{});return jE.test(b)||(P=GE+b),this.moduleCache[t]={fs:P.trim(),uniforms:L,vs:h.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,r){var o=this,u=t.replace(HE,function(h,d){var m=d.split(" "),b=m[0].replace(/"/g,"");if(n.indexOf(b)>-1)return"";var A=o.rawContentCache[b][r];n.push(b);var P=o.processModule(A,n,r),L=P.content;return L});return{content:u,includeList:n}}}]),e}())||u_),Wm=ue(66213),xv;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(xv||(xv={}));var c_,f_,Xm=(c_=(0,$r.b2)(),c_(f_=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"shaderModuleService",void 0),(0,ae.Z)(this,"rendererService",void 0),(0,ae.Z)(this,"cameraService",void 0),(0,ae.Z)(this,"mapService",void 0),(0,ae.Z)(this,"interactionService",void 0),(0,ae.Z)(this,"layerService",void 0),(0,ae.Z)(this,"config",void 0)}return(0,Rt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return xv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(rr.IRendererService),this.cameraService=t.getContainer().get(rr.ICameraService),this.mapService=t.getContainer().get(rr.IMapService),this.interactionService=t.getContainer().get(rr.IInteractionService),this.layerService=t.getContainer().get(rr.ILayerService),this.shaderModuleService=t.getContainer().get(rr.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||f_),h_,p_;function XE(e){var a=YE();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function YE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qE=(h_=(0,$r.b2)(),h_(p_=function(e){(0,Or.Z)(t,e);var a=XE(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){(0,Wm.Z)((0,Mt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Xm))||p_),d_,v_,m_,Zg,g_;function $E(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=KE(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function KE(e,a){if(!!e){if(typeof e=="string")return y_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return y_(e,a)}}function y_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var QE=(d_=(0,$r.b2)(),v_=(0,$r.f3)(rr.IPostProcessor),d_(m_=(Zg=function(){function e(){(0,Ht.Z)(this,e),(0,ae.Z)(this,"passes",[]),ga(this,"postProcessor",g_,this),(0,ae.Z)(this,"layer",void 0),(0,ae.Z)(this,"renderFlag",void 0),(0,ae.Z)(this,"width",0),(0,ae.Z)(this,"height",0)}return(0,Rt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,xa.Z)(di().mark(function n(){var r,o,u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:r=$E(this.passes),d.prev=1,r.s();case 3:if((o=r.n()).done){d.next=9;break}return u=o.value,d.next=7,u.render(this.layer);case 7:d.next=3;break;case 9:d.next=14;break;case 11:d.prev=11,d.t0=d.catch(1),r.e(d.t0);case 14:return d.prev=14,r.f(),d.finish(14);case 17:return d.next=19,this.postProcessor.render(this.layer);case 19:case"end":return d.stop()}},n,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===xv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,r){t.init(this.layer,n),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),g_=wa(Zg.prototype,"postProcessor",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg))||m_),__,x_;function JE(e){var a=eC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=(__=(0,$r.b2)(),__(x_=function(e){(0,Or.Z)(t,e);var a=JE(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"pickingFBO",void 0),(0,ae.Z)((0,At.Z)(n),"layer",void 0),(0,ae.Z)((0,At.Z)(n),"width",0),(0,ae.Z)((0,At.Z)(n),"height",0),(0,ae.Z)((0,At.Z)(n),"alreadyInRendering",!1),(0,ae.Z)((0,At.Z)(n),"pickFromPickingFBO",function(h){var d=h.x,m=h.y,b=h.lngLat,A=h.type;if(!(!n.layer.isVisible()||!n.layer.needPick(A))){var P=n.rendererService,L=P.getViewportSize,B=P.readPixels,Z=P.useFramebuffer,j=L(),J=j.width,fe=j.height,Ce=n.layer.getLayerConfig(),Ve=Ce.enableHighlight,tt=Ce.enableSelect,st=d*va,Bt=m*va;if(!(st>J||st<0||Bt>fe||Bt<0)){var Xt;Z(n.pickingFBO,function(){var cr;if(Xt=B({x:Math.round(st),y:Math.round(fe-(m+1)*va),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Xt[0]!==0||Xt[1]!==0||Xt[2]!==0){var Ir=O(Xt),wr=n.layer.getSource().getFeatureById(Ir),Qr={x:d,y:m,type:A,lngLat:b,featureId:Ir,feature:wr};wr&&(n.layer.setCurrentPickId(Ir),n.triggerHoverOnLayer(Qr))}else{var Fn={x:d,y:m,lngLat:b,type:n.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,Q.Z)((0,Q.Z)({},Fn),{},{type:"unpick"})),n.triggerHoverOnLayer(Fn),n.layer.setCurrentPickId(null)}Ve&&n.highlightPickedFeature(Xt),tt&&A==="click"&&((cr=Xt)===null||cr===void 0?void 0:cr.toString())!==[0,0,0,0].toString()&&n.selectFeature(Xt)})}}}),n}return(0,Rt.Z)(t,[{key:"getType",value:function(){return xv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){(0,Wm.Z)((0,Mt.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,h=u.createTexture2D,d=u.createFramebuffer,m=u.getViewportSize,b=m(),A=b.width,P=b.height;this.pickingFBO=d({color:h({width:A,height:P,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(ou.Hover,this.pickFromPickingFBO),this.interactionService.on(ou.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ou.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,h=u.getViewportSize,d=u.useFramebuffer,m=u.clear,b=h(),A=b.width,P=b.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==P)&&(this.pickingFBO.resize({width:A,height:P}),this.width=A,this.height=P),d(this.pickingFBO,function(){m({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var L=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(L),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,Pr.Z)(r,3),u=o[0],h=o[1],d=o[2];this.layer.hooks.beforeHighlight.call([u,h,d]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,Pr.Z)(r,3),u=o[0],h=o[1],d=o[2];this.layer.hooks.beforeSelect.call([u,h,d]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=z(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=z(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(Xm))||x_),b_,E_,C_,Vg,S_,rC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yd=(b_=(0,$r.b2)(),E_=(0,$r.f3)(rr.IShaderModuleService),b_(C_=(Vg=function(){function e(){(0,Ht.Z)(this,e),ga(this,"shaderModuleService",S_,this),(0,ae.Z)(this,"rendererService",void 0),(0,ae.Z)(this,"config",void 0),(0,ae.Z)(this,"quad",rC),(0,ae.Z)(this,"enabled",!0),(0,ae.Z)(this,"renderToScreen",!1),(0,ae.Z)(this,"model",void 0),(0,ae.Z)(this,"name",void 0),(0,ae.Z)(this,"optionsToUpdate",{})}return(0,Rt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return xv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(rr.IRendererService),this.shaderModuleService=t.getContainer().get(rr.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,h=r.createModel,d=this.setupShaders(),m=d.vs,b=d.fs,A=d.uniforms;this.model=h({vs:m,fs:b,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,Q.Z)((0,Q.Z)({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,h=u.useFramebuffer,d=u.getViewportSize,m=u.clear,b=d(),A=b.width,P=b.height;h(this.renderToScreen?null:o.getWriteFBO(),function(){m({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var L=(0,Q.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[A,P]},r.convertOptionsToUniforms(r.optionsToUpdate));n&&(L.u_BloomFinal=1,L.u_Texture2=n),r.model.draw({uniforms:L})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,Q.Z)((0,Q.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(r){(0,l.isNil)(t[r])||(n["u_".concat((0,l.upperFirst)((0,l.camelCase)(r)))]=t[r])}),n}}]),e}(),S_=wa(Vg.prototype,"shaderModuleService",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vg))||C_),A_,w_;function nC(e){var a=iC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,oC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sC=(A_=(0,$r.b2)(),A_(w_=function(e){(0,Or.Z)(t,e);var a=nC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:oC,fs:aC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,l.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,l.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,l.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(Yd))||w_),T_,M_;function uC(e){var a=lC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,fC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hC=(T_=(0,$r.b2)(),T_(M_=function(e){(0,Or.Z)(t,e);var a=uC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:fC,fs:cC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,l.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(Yd))||M_),I_,P_;function pC(e){var a=dC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,mC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gC=(I_=(0,$r.b2)(),I_(P_=function(e){(0,Or.Z)(t,e);var a=pC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:mC,fs:vC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,l.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(Yd))||P_),k_,L_;function yC(e){var a=_C();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,bC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,EC=(k_=(0,$r.b2)(),k_(L_=function(e){(0,Or.Z)(t,e);var a=yC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:bC,fs:xC});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}(Yd))||L_),O_,R_;function CC(e){var a=SC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,wC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TC=(O_=(0,$r.b2)(),O_(R_=function(e){(0,Or.Z)(t,e);var a=CC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:wC,fs:AC}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Yd))||R_),D_,F_;function MC(e){var a=IC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,kC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,LC=(D_=(0,$r.b2)(),D_(F_=function(e){(0,Or.Z)(t,e);var a=MC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:kC,fs:PC});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}(Yd))||F_),B_,N_;function OC(e){var a=RC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,FC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BC=(B_=(0,$r.b2)(),B_(N_=function(e){(0,Or.Z)(t,e);var a=OC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:FC,fs:DC});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,h=r.uniforms,d=this.rendererService.getViewportSize(),m=d.width,b=d.height;return{vs:o,fs:u,uniforms:(0,Q.Z)((0,Q.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}(Yd))||N_),z_,U_;function NC(e){var a=zC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function zC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,ZC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,VC=(z_=(0,$r.b2)(),z_(U_=function(e){(0,Or.Z)(t,e);var a=NC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:ZC,fs:UC}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Yd))||U_),Z_,V_;function jC(e){var a=GC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function GC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,WC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,XC=(Z_=(0,$r.b2)(),Z_(V_=function(e){(0,Or.Z)(t,e);var a=jC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:HC,fs:WC}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Yd))||V_),j_,G_,H_,W_,w0,X_,YC=(j_=(0,$r.b2)(),G_=(0,$r.f3)(rr.IRendererService),H_=(0,$r.zY)(),j_(W_=(w0=function(){function e(){(0,Ht.Z)(this,e),ga(this,"rendererService",X_,this),(0,ae.Z)(this,"passes",[]),(0,ae.Z)(this,"readFBO",void 0),(0,ae.Z)(this,"writeFBO",void 0)}return(0,Rt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,r=t.createTexture2D,o=n(),u=o.width,h=o.height;return r({x:0,y:0,width:u,height:h,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(r,o){n(t.readFBO,(0,xa.Z)(di().mark(function u(){return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return d.stop()}},u)})))})}},{key:"renderBloomPass",value:function(){var a=(0,xa.Z)(di().mark(function n(r,o){var u,h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.getReadFBOTex();case 2:u=m.sent,h=0;case 4:if(!(h<4)){m.next=11;break}return m.next=7,o.render(r,u);case 7:this.swap(),h++,m.next=4;break;case 11:case"end":return m.stop()}},n,this)}));function t(n,r){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,xa.Z)(di().mark(function n(r){var o,u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:o=0;case 1:if(!(o<this.passes.length)){d.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){d.next=9;break}return d.next=7,this.renderBloomPass(r,u);case 7:d.next=12;break;case 9:return d.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,d.next=1;break;case 15:case"end":return d.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,r){t.init(n,r),this.passes.push(t)}},{key:"insert",value:function(t,n,r,o){t.init(r,o),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),X_=wa(w0.prototype,"rendererService",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa(w0.prototype,"init",[H_],Object.getOwnPropertyDescriptor(w0.prototype,"init"),w0.prototype),w0))||W_),Y_,q_;function qC(e){var a=$C();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KC=(Y_=(0,$r.b2)(),Y_(q_=function(e){(0,Or.Z)(t,e);var a=qC(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getType",value:function(){return xv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){(0,Wm.Z)((0,Mt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,h=o.clear,d=r.multiPassRenderer.getPostProcessor().getReadFBO();u(d,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:d}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(m){m.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Xm))||q_),$_,K_,Q_,jg,J_;function QC(e){var a=JC();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eS=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,e1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,tS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function t1(e,a){for(var t=0,n=1/a,r=e;r>0;)t=t+n*(r%a),r=Math.floor(r/a),n=n/a;return t}var rS=1,nS=($_=(0,$r.b2)(),K_=(0,$r.f3)(rr.IShaderModuleService),$_(Q_=(jg=function(e){(0,Or.Z)(t,e);var a=QC(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),ga((0,At.Z)(n),"shaderModuleService",J_,(0,At.Z)(n)),(0,ae.Z)((0,At.Z)(n),"haltonSequence",[]),(0,ae.Z)((0,At.Z)(n),"accumulatingId",0),(0,ae.Z)((0,At.Z)(n),"frame",0),(0,ae.Z)((0,At.Z)(n),"timer",void 0),(0,ae.Z)((0,At.Z)(n),"sampleRenderTarget",void 0),(0,ae.Z)((0,At.Z)(n),"prevRenderTarget",void 0),(0,ae.Z)((0,At.Z)(n),"outputRenderTarget",void 0),(0,ae.Z)((0,At.Z)(n),"copyRenderTarget",void 0),(0,ae.Z)((0,At.Z)(n),"blendModel",void 0),(0,ae.Z)((0,At.Z)(n),"outputModel",void 0),(0,ae.Z)((0,At.Z)(n),"copyModel",void 0),n}return(0,Rt.Z)(t,[{key:"getType",value:function(){return xv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){(0,Wm.Z)((0,Mt.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,h=u.createFramebuffer,d=u.createTexture2D;this.sampleRenderTarget=h({color:d({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.prevRenderTarget=h({color:d({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.outputRenderTarget=h({color:d({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.copyRenderTarget=h({color:d({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})});for(var m=0;m<30;m++)this.haltonSequence.push([t1(m,2),t1(m,3)]);this.blendModel=this.createTriangleModel("blend-pass",eS),this.outputModel=this.createTriangleModel("copy-pass",e1,{blend:{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:Y.ONE,dstAlpha:Y.ONE_MINUS_SRC_ALPHA},equation:{rgb:Y.FUNC_ADD,alpha:Y.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",e1)}},{key:"render",value:function(r){var o=this,u=this.rendererService,h=u.clear,d=u.getViewportSize,m=u.useFramebuffer,b=d(),A=b.width,P=b.height;this.sampleRenderTarget.resize({width:A,height:P}),this.prevRenderTarget.resize({width:A,height:P}),this.outputRenderTarget.resize({width:A,height:P}),this.copyRenderTarget.resize({width:A,height:P}),this.resetFrame(),this.stopAccumulating();var L=r.multiPassRenderer.getPostProcessor().getReadFBO();m(L,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:L}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var B=function Z(j){!o.accumulatingId||j!==o.accumulatingId||o.isFinished()||(o.doRender(r),Ui.requestAnimationFrame(function(){Z(j)}))};this.accumulatingId=rS++,this.timer=Ui.setTimeout(function(){B(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,h=u.clear,d=u.getViewportSize,m=u.useFramebuffer,b=d(),A=b.width,P=b.height,L=r.getLayerConfig(),B=L.jitterScale,Z=B===void 0?1:B,j=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((j[0]*2-1)/A*Z,(j[1]*2-1)/P*Z),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),m(this.sampleRenderTarget,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var J=r.getLayerConfig();m(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:J.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(m(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),m(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var fe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=fe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ui.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:tS,fs:o});var h=this.shaderModuleService.getModule(r),d=h.vs,m=h.fs,b=h.uniforms,A=this.rendererService,P=A.createAttribute,L=A.createBuffer,B=A.createModel;return B((0,Q.Z)({vs:d,fs:m,attributes:{a_Position:P({buffer:L({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,Q.Z)({},b),depth:{enable:!1},count:3},u))}}]),t}(Xm),J_=wa(jg.prototype,"shaderModuleService",[K_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jg))||Q_),sm=new $r.W2;sm.bind(rr.IGlobalConfigService).to(pp).inSingletonScope(),(0,$r.GW)((0,$r.b2)(),qu.EventEmitter),sm.bind(rr.IEventEmitter).to(qu.EventEmitter);var r1=(0,Uo.Z)(sm,!1),Gg=function(a){var t=r1.lazyInject(a);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},rL=function(a){var t=r1.lazyMultiInject(a);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},Vh=sm,iS=0;function aS(){var e=new $r.W2;return e.parent=sm,e.bind(rr.SceneID).toConstantValue("".concat(iS++)),e.bind(rr.IShaderModuleService).to(WE).inSingletonScope(),e.bind(rr.ILayerService).to(te).inSingletonScope(),e.bind(rr.ISceneService).to(TE).inSingletonScope(),e.bind(rr.ICameraService).to(f0).inSingletonScope(),e.bind(rr.ICoordinateSystemService).to(Bm).inSingletonScope(),e.bind(rr.IInteractionService).to(tm).inSingletonScope(),e.bind(rr.IPickingService).to(zg).inSingletonScope(),e.bind(rr.IControlService).to(h0).inSingletonScope(),e.bind(rr.IMarkerService).to(p0).inSingletonScope(),e.bind(rr.IIconService).to(Rd).inSingletonScope(),e.bind(rr.IFontService).to(kp).inSingletonScope(),e.bind(rr.IPopupService).to(dv).inSingletonScope(),e.bind(rr.INormalPass).to(qE).whenTargetNamed("clear"),e.bind(rr.INormalPass).to(tC).whenTargetNamed("pixelPicking"),e.bind(rr.INormalPass).to(KC).whenTargetNamed("render"),e.bind(rr.INormalPass).to(nS).whenTargetNamed("taa"),e.bind(rr.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(rr.INormalPass,t)}}),e.bind(rr.IPostProcessingPass).to(TC).whenTargetNamed("copy"),e.bind(rr.IPostProcessingPass).to(sC).whenTargetNamed("bloom"),e.bind(rr.IPostProcessingPass).to(hC).whenTargetNamed("blurH"),e.bind(rr.IPostProcessingPass).to(gC).whenTargetNamed("blurV"),e.bind(rr.IPostProcessingPass).to(VC).whenTargetNamed("noise"),e.bind(rr.IPostProcessingPass).to(XC).whenTargetNamed("sepia"),e.bind(rr.IPostProcessingPass).to(EC).whenTargetNamed("colorHalftone"),e.bind(rr.IPostProcessingPass).to(LC).whenTargetNamed("hexagonalPixelate"),e.bind(rr.IPostProcessingPass).to(BC).whenTargetNamed("ink"),e.bind(rr.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var n=a.container.getNamed(rr.IPostProcessingPass,t);return n.setName(t),n}}),e}function Hg(e){var a=new $r.W2;return a.parent=e,a.bind(rr.IStyleAttributeService).to(Ei).inSingletonScope(),a.bind(rr.IMultiPassRenderer).to(QE).inSingletonScope(),a.bind(rr.IPostProcessor).to(YC).inSingletonScope(),a}var oS=null;function nL(e){return oS.indexOf(e)}var sS=2,iL=4,uS=64,aL=128,lS=256,cS=512,oL=8192,sL=16384,uL=32768,fS=null,n1=131072,lL=262144,hS=524288,cL=1048576,pS=2097152,fL=4194304,dS=8388608,vS=16777216,mS=null;function Ym(e,a){return e=clamp(Math.floor(e),0,255),a=clamp(Math.floor(a),0,255),256*e+a}function hL(e){var a=e.color,t=e.radius,n=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,h=e.stroke,d=e.strokeWidth,m=e.strokeOpacity,b=[],A=[],P=[],L=[Ym(a[0],a[1]),Ym(a[2],a[3])],B=[Ym(h[0],h[1]),Ym(h[2],h[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Z){var j=_slicedToArray(Z,2),J=j[0],fe=j[1];b.push([].concat(L,[(J+1)*dS+(fe+1)*pS+getShapeIndex(o)*n1+t,(n+512)*hS+(r+512)*uS])),A.push([].concat(B,[d,m])),P.push([u,0,0,0])}),{packedBuffer:b,packedBuffer2:A,packedBuffer3:P}}function pL(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var t=a?1:0,n=Math.floor(e*127);return n*mS+t*vS+n*n1+t*fS+n*cS+t*lS+n*sS+t}var jh;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(jh||(jh={}));var is;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(is||(is={}));var bv;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(bv||(bv={}));var jn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(jn||(jn={}));var gS=["mapload","mapchange","mapAfterFrameChange"],Xv={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Wg=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Ev;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Ev||(Ev={}));function yS(e){var a=_S();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=0,qm=function(e){(0,Or.Z)(t,e);var a=yS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this),r.controlOption=(0,Q.Z)((0,Q.Z)({},r.getDefault()),n||{}),r}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{position:Ev.TOPRIGHT,name:"".concat(xS++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ev.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(rr.IMapService),this.renderService=r.get(rr.IRendererService),this.layerService=r.get(rr.ILayerService),this.controlService=r.get(rr.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,h=this.controlService.controlCorners[u];return Zl(o,"l7-control"),u.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;Zl(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;fu(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ku(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),t}(qu.EventEmitter);function bS(e){var a=ES();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dL=function(e){(0,Or.Z)(t,e);var a=bS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),p(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,At.Z)(r)),r}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:Ev.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",r.onLayerChange),o.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,o){return this.addLayer(r,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),o=r.height;Zl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(Zl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):fu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return fu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",r.onLayerChange),o.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",o=this.container=Mo("div",r),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var h=this.form=Mo("form",r+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=Mo("a",r+"-toggle",o);var d=this.layersLink;d.title="Layers",u||this.expand(),this.baseLayersList=Mo("div",r+"-base",h),this.separator=Mo("div",r+"-separator",h),this.overlaysList=Mo("div",r+"-overlays",h),o.appendChild(h)}},{key:"initLayers",value:function(){var r=this,o=this.controlOption,u=o.baseLayers,h=u===void 0?{}:u,d=o.overlayers,m=d===void 0?{}:d;Object.keys(h).forEach(function(b,A){r.addLayer(h[b],b,!1)}),Object.keys(m).forEach(function(b,A){r.addLayer(m[b],b,!0)})}},{key:"update",value:function(){if(!this.container)return this;Vl(this.baseLayersList),Vl(this.overlaysList),this.layerControlInputs=[];var r,o,u,h,d=0;for(u=0;u<this.layers.length;u++)h=this.layers[u],this.addItem(h),o=o||h.overlay,r=r||!h.overlay,d+=h.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&d>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=o&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,o,u,h=this.mapsService.getZoom(),d=r.length-1;d>=0;d--)if(o=r[d],u=this.layerService.getLayer(o.layerId),u&&u.inited){var m=u.getMinZoom(),b=u.getMaxZoom();o.disabled=h<m||h>b}}},{key:"addLayer",value:function(r,o,u){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:o,overlay:u});var h=this.controlOption,d=h.sortLayers,m=h.sortFunction,b=h.autoZIndex;d&&this.layers.sort(function(A,P){return m(A.layer,P.layer,A.name,P.name)}),b&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var o=this.layerService.getLayer(r.target.layerId),u=o!=null&&o.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(r,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(o?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=u,h.firstChild}},{key:"addItem",value:function(r){var o=document.createElement("label"),u=this.layerService.getLayer(r.layer.id),h=u&&u.inited&&r.layer.isVisible(),d;r.overlay?(d=document.createElement("input"),d.type="checkbox",d.className="l7-control-layers-selector",d.defaultChecked=h):d=this.createRadioElement("l7-base-layers",h),this.layerControlInputs.push(d),d.layerId=r.layer.id,d.addEventListener("click",this.onInputClick);var m=document.createElement("span");m.innerHTML=" "+r.name;var b=document.createElement("div");o.appendChild(b),b.appendChild(d),b.appendChild(m);var A=r.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,o,u,h=[],d=[];this.handlingClick=!0;for(var m=r.length-1;m>=0;m--)o=r[m],u=this.layerService.getLayer(o.layerId),o.checked?h.push(u):o.checked||d.push(u);d.forEach(function(b){b.hide()}),h.forEach(function(b){b.show()}),this.handlingClick=!1}}]),t}(qm);function CS(e){var a=SS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function SS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AS=function(e){(0,Or.Z)(t,e);var a=CS(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{position:Ev.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",o=Mo("div",r),u=Mo("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),t}(qm);function wS(e){var a=TS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function TS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vL=function(e){(0,Or.Z)(t,e);var a=wS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),p(["update"],(0,At.Z)(r)),r}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{position:Ev.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",o=Mo("div",r);this.addScales(r+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,o=this.controlOption.maxWidth,u=r.getSize()[1]/2,h=r.containerToLngLat([0,u]),d=r.containerToLngLat([o,u]),m=ih([h.lng,h.lat],[d.lng,d.lat]);this.updateScales(m)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,h=o.imperial;u&&r&&this.updateMetric(r),h&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,h,d;o>5280?(u=o/5280,h=this.getRoundNum(u),this.updateScale(this.iScale,h+" mi",h/u)):(d=this.getRoundNum(o),this.updateScale(this.iScale,d+" ft",d/o))}},{key:"updateScale",value:function(r,o,u){var h=this.controlOption.maxWidth;r.style.width=Math.round(h*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(r,o){var u=this.controlOption,h=u.metric,d=u.imperial;h&&(this.mScale=Mo("div",r,o)),d&&(this.iScale=Mo("div",r,o))}}]),t}(qm);function MS(e){var a=IS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mL=function(e){(0,Or.Z)(t,e);var a=MS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),p(["updateDisabled","zoomIn","zoomOut"],(0,At.Z)(r)),r}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{position:Ev.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",o=Mo("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,o,u,h,d){var m=Mo("a",u,h);return m.innerHTML=r,m.title=o,m.href="javascript:void(0)",m.addEventListener("click",d),m}},{key:"updateDisabled",value:function(){var r=this.mapsService,o="l7-disabled";fu(this.zoomInButton,o),fu(this.zoomOutButton,o),(this.disabled||r.getZoom()<=r.getMinZoom())&&Zl(this.zoomOutButton,o),(this.disabled||r.getZoom()>=r.getMaxZoom())&&Zl(this.zoomInButton,o)}}]),t}(qm);function PS(e){var a=kS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i1=function(e){(0,Or.Z)(t,e);var a=PS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this),(0,ae.Z)((0,At.Z)(r),"added",!1),(0,ae.Z)((0,At.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,Q.Z)((0,Q.Z)({},r.getDefault()),n),p(["update","onMove","onUp","addDragHandler","onMapClick"],(0,At.Z)(r)),r.init(),r}return(0,Rt.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:oe.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(rr.IMapService),this.sceneSerive=r.get(rr.ISceneService);var o=this.markerOption,u=o.element,h=o.draggable;return this.mapsService.getMarkerContainer().appendChild(u),this.registerMarkerEvent(u),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&ku(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&ku(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),il(o,"".concat(Te[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var r=this.mapsService.getContainer();return{containerHeight:(r==null?void 0:r.scrollHeight)||0,containerWidth:(r==null?void 0:r.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,h=this.lngLat,d=h.lng,m=h.lat,b=this.mapsService.lngLatToContainer([d,m]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var A=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),P=A.containerHeight,L=A.containerWidth,B=A.bounds;if(!B)return;if(Math.abs(B[0][0])>180||Math.abs(B[1][0])>180){if(b.x>L){var Z=this.mapsService.lngLatToContainer([d-360,m]);b.x=Z.x}if(b.x<0){var j=this.mapsService.lngLatToContainer([d+360,m]);b.x=j.x}}(b.x>L||b.x<0||b.y>P||b.y<0)&&(o.style.display="none"),o.style.left=b.x+u[0]+"px",o.style.top=b.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,h=u.color,d=u.anchor;if(!o){this.defaultMarker=!0,o=Mo("div"),this.markerOption.element=o;var m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height","48px"),m.setAttributeNS(null,"width","48px"),m.setAttributeNS(null,"viewBox","0 0 1024 1024");var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),b.setAttributeNS(null,"fill",h),m.appendChild(b),o.appendChild(m)}Zl(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var P,L,B=((P=r.markerOption)===null||P===void 0?void 0:P.style)&&((L=r.markerOption)===null||L===void 0?void 0:L.style[A]);o&&(o.style[A]=B)}),o.addEventListener("click",function(A){r.onMapClick(A)}),o.addEventListener("click",this.eventHandle),Pe(o,d,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(qu.EventEmitter);function LS(e){var a=OS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gL=function(e){(0,Or.Z)(t,e);var a=LS(t);function t(n){var r,o;return(0,Ht.Z)(this,t),o=a.call(this),(0,ae.Z)((0,At.Z)(o),"markers",[]),(0,ae.Z)((0,At.Z)(o),"points",[]),(0,ae.Z)((0,At.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,l.merge)(o.getDefault(),n),p(["update"],(0,At.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,Rt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(rr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var r=this.mapsService.getContainer();this.containerSize={containerWidth:(r==null?void 0:r.scrollWidth)||0,containerHeight:(r==null?void 0:r.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(r.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),h=this.mapsService.getBounds();this.bbox=cl(h,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this)),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),h=u.lng,d=u.lat,m={geometry:{type:"Point",coordinates:[h,d]},properties:(0,Q.Z)((0,Q.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(m),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,h=u===void 0?0:u,d=r.maxZoom;this.clusterIndex=new(x())({radius:o,minZoom:h,maxZoom:d}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,h=r[0].concat(r[1]),d=this.clusterIndex.getClusters(h,o);this.clusterMarkers.forEach(function(m){m.remove()}),this.clusterMarkers=[],d.forEach(function(m){var b,A=u.markerLayerOption.clusterOption,P=A.field,L=A.method;if(m.properties&&(b=m.properties)!==null&&b!==void 0&&b.cluster_id){var B,Z=u.getLeaves((B=m.properties)===null||B===void 0?void 0:B.cluster_id);if(m.properties.clusterData=Z,P&&L){var j=Z==null?void 0:Z.map(function(tt){var st=(0,ae.Z)({},P,tt.properties[P]);return st}),J=Rc(j,P),fe=Mh(L,J),Ce="point_"+L;m.properties[Ce]=fe.toFixed(2)}}var Ve=u.clusterMarker(m);u.clusterMarkers.push(Ve),Ve.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,h=u.element,d=h===void 0?this.generateElement.bind(this):h,m=new i1({element:d(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return m}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!oc(this.bbox,o))&&(this.bbox=cl(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=Mo("div","l7-marker-cluster"),u=Mo("div","",o),h=Mo("span","",u),d=this.markerLayerOption.clusterOption,m=d.field,b=d.method;r.properties.point_count=r.properties.point_count||1;var A=m&&b?r.properties["point_"+b]||r.properties[m]:r.properties.point_count;return h.textContent=A,o}}]),t}(qu.EventEmitter);function RS(e){var a=DS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a1=function(e){(0,Or.Z)(t,e);var a=RS(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this),r.popupOption=(0,Q.Z)((0,Q.Z)({},r.getdefault()),n),p(["update","onClickClose","remove"],(0,At.Z)(r)),r}return(0,Rt.Z)(t,[{key:"addTo",value:function(r){var o=this;return this.mapsService=r.get(rr.IMapService),this.sceneSerive=r.get(rr.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),h;for(u.innerHTML=r;h=u.firstChild,!!h;)o.appendChild(h);return this.setDOMContent(o)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ku(this.content),this.content=Mo("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Mo("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,o,u){var h=window.document.createElement(r);return o!==void 0&&(h.className=o),u&&u.appendChild(h),h}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:oe.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,o=this.lngLat,u=this.popupOption,h=u.className,d=u.maxWidth,m=u.anchor;if(!(!this.mapsService||!o||!this.content)){var b=this.mapsService.getMarkerContainer();if(!this.container&&b){this.container=this.creatDom("div","l7-popup",b),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),h&&h.split(" ").forEach(function(P){return r.container.classList.add(P)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(P){r.container.addEventListener(P,function(L){L.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}d&&this.container.style.maxWidth!==d&&(this.container.style.maxWidth=d),this.updatePosition(),il(this.container,"".concat(Te[m])),Pe(this.container,m,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,o=r.lng,u=r.lat,h=this.popupOption.offsets,d=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=d.x+h[0]+"px",this.container.style.top=d.y-h[1]+"px"}}}]),t}(qu.EventEmitter);function FS(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}FS(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Cv,Xg=(Cv={},(0,ae.Z)(Cv,jh.additive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:1,dstAlpha:1}}),(0,ae.Z)(Cv,jh.none,{enable:!1}),(0,ae.Z)(Cv,jh.normal,{enable:!0,func:{srcRGB:Y.SRC_ALPHA,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,ae.Z)(Cv,jh.subtractive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:Y.ZERO,dstAlpha:Y.ONE_MINUS_SRC_COLOR},equation:{rgb:Y.FUNC_SUBTRACT,alpha:Y.FUNC_SUBTRACT}}),(0,ae.Z)(Cv,jh.max,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MAX_EXT}}),(0,ae.Z)(Cv,jh.min,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MIN_EXT}}),Cv),yL=1024;function Xf(e,a,t,n,r){a.updateStyleAttribute(e,t,n,r)}function BS(e,a){e.opacity&&$m("opacity",a,e.opacity),e.strokeWidth&&$m("strokeWidth",a,e.strokeWidth),e.strokeOpacity&&$m("strokeOpacity",a,e.strokeOpacity),e.stroke&&NS("stroke",a,e.stroke),e.offsets&&o1("offsets",a,e.offsets),e.textOffset&&o1("textOffset",a,e.textOffset),e.thetaOffset&&$m("thetaOffset",a,e.thetaOffset)}function $m(e,a,t){(0,l.isString)(t)?Xf(e,a,t,function(n){return n}):(0,l.isNumber)(t)?Xf(e,a,[t],void 0):Array.isArray(t)&&t.length===2?(0,l.isString)(t[0])&&(0,l.isFunction)(t[1])||(0,l.isString)(t[0])&&Array.isArray(t[1])&&(0,l.isNumber)(t[1][0])&&(0,l.isNumber)(t[1][1])?Xf(e,a,t[0],t[1]):Xf(e,a,[1],void 0):Xf(e,a,[1],void 0)}function o1(e,a,t){(0,l.isString)(t)?Xf(e,a,t,function(n){return n}):Array.isArray(t)&&t.length===2&&(0,l.isString)(t[0])&&(0,l.isFunction)(t[1])?Xf(e,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,l.isNumber)(t[0])&&(0,l.isNumber)(t[1])?Xf(e,a,t,void 0):Xf(e,a,[0,0],void 0)}function NS(e,a,t){(0,l.isString)(t)?Xf(e,a,t,void 0):Array.isArray(t)&&t.length===2&&((0,l.isString)(t[0])&&(0,l.isFunction)(t[1])||(0,l.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Xf(e,a,t[0],t[1]):Xf(e,a,"#fff",void 0)}var Vu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Vu||(Vu={}));function zS(e,a){var t=[a[0]-e[0],a[1]-e[1]],n=sc(t),r=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return r}function US(e,a){var t=this;e.length>0&&a.version===Vu["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Vu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Vu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoords(n.coordinates)}))}function ZS(e,a){e.length>0&&a.version===Vu.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=VS(t.coordinates,a),t.simpleCoordinate=!0)})}function VS(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var n=[];return e.map(function(r){n.push(a.simpleMapCoord.unproject(r))}),n}}function jS(e,a,t){var n;if(!e.scale)return[];var r=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],o=[];r.forEach(function(h){var d,m=h.field;(a.hasOwnProperty(m)||((d=e.scale)===null||d===void 0?void 0:d.type)==="variable")&&o.push(a[m])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!S(u[0])?[t]:u}function GS(e,a,t,n,r,o){var u=o==null?void 0:o.getLayerConfig(),h=u.arrow,d=h===void 0?{enable:!1}:h,m=a.map(function(b){var A={id:b._id,coordinates:b.coordinates};if(e.filter(function(B){return B.scale!==void 0}).forEach(function(B){var Z=jS(B,b,r);B.needRemapping=!1,B.name==="color"&&(Z=Z.map(function(j){return I(j)})),A[B.name]=Array.isArray(Z)&&Z.length===1?Z[0]:Z,B.name==="shape"&&(A.shape=t.getIconFontKey(A[B.name]))}),A.shape==="line"&&d.enable){var P=A.coordinates,L=zS(P[0],P[1]);A.coordinates.splice(1,0,L,L)}return A});return US(m,n),ZS(m,n),m}function HS(e,a,t,n,r,o){var u=new To(r,o),h=e.getBottomColor(),d=n.getLayerStyleAttributes()||[],m=u.data.dataArray,b=m,A=GS(d,b,a,t,h,e);return u.destroy(),A}function s1(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function u1(e,a,t,n){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enablePicking,h=o.enableTAA;return h?r.add(n("taa")):r.add(n("render")),s1(a).forEach(function(d){var m=(0,Pr.Z)(d,2),b=m[0],A=m[1];r.add(t(b),A)}),r.add(t("copy")),r}var WS=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function XS(e,a,t){if(typeof a=="string"&&typeof t=="string"&&a!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}WS.map(function(n){if(n.includes(a)&&n.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var YS=["passes"],qS=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],l1,Yg,c1;function $S(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=KS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function KS(e,a){if(!!e){if(typeof e=="string")return f1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f1(e,a)}}function f1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function QS(e){var a=JS();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h1=0,_d=(l1=Gg(rr.IGlobalConfigService),Yg=function(e){(0,Or.Z)(t,e);var a=QS(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Ht.Z)(this,t),n=a.call(this),(0,ae.Z)((0,At.Z)(n),"id","".concat(h1++)),(0,ae.Z)((0,At.Z)(n),"name","".concat(h1)),(0,ae.Z)((0,At.Z)(n),"visible",!0),(0,ae.Z)((0,At.Z)(n),"zIndex",0),(0,ae.Z)((0,At.Z)(n),"inited",!1),(0,ae.Z)((0,At.Z)(n),"layerModelNeedUpdate",!1),(0,ae.Z)((0,At.Z)(n),"pickedFeatureID",null),(0,ae.Z)((0,At.Z)(n),"selectedFeatureID",null),(0,ae.Z)((0,At.Z)(n),"styleNeedUpdate",!1),(0,ae.Z)((0,At.Z)(n),"clusterZoom",0),(0,ae.Z)((0,At.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,ae.Z)((0,At.Z)(n),"hooks",{init:new i,afterInit:new i,beforeRender:new i,beforeRenderData:new Ld,afterRender:new Kl,beforePickingEncode:new Kl,afterPickingEncode:new Kl,beforeHighlight:new Kl(["pickedColor"]),afterHighlight:new Kl,beforeSelect:new Kl(["pickedColor"]),afterSelect:new Kl,beforeDestroy:new Kl,afterDestroy:new Kl}),(0,ae.Z)((0,At.Z)(n),"models",[]),(0,ae.Z)((0,At.Z)(n),"layerChildren",[]),(0,ae.Z)((0,At.Z)(n),"masks",[]),(0,ae.Z)((0,At.Z)(n),"isVector",!1),ga((0,At.Z)(n),"configService",c1,(0,At.Z)(n)),(0,ae.Z)((0,At.Z)(n),"animateOptions",{enable:!1}),(0,ae.Z)((0,At.Z)(n),"currentPickId",null),(0,ae.Z)((0,At.Z)(n),"pendingStyleAttributes",[]),(0,ae.Z)((0,At.Z)(n),"scaleOptions",{}),(0,ae.Z)((0,At.Z)(n),"aniamateStatus",!1),(0,ae.Z)((0,At.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,ae.Z)((0,At.Z)(n),"isDestroied",!1),(0,ae.Z)((0,At.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions),n.reRender()}),n.name=r.name||n.id,n.zIndex=r.zIndex||0,n.rawConfig=r,n}return(0,Rt.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(h){h in o.rawConfig&&(o.rawConfig[h]=r[h])}),!this.inited)this.needUpdateConfig=(0,Q.Z)((0,Q.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(rr.SceneID);BS(r,this),this.configService.setLayerConfig(u,this.id,(0,Q.Z)((0,Q.Z)((0,Q.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,o=this.container.get(rr.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(rr.IIconService),this.fontService=this.container.get(rr.IFontService),this.rendererService=this.container.get(rr.IRendererService),this.layerService=this.container.get(rr.ILayerService),this.interactionService=this.container.get(rr.IInteractionService),this.pickingService=this.container.get(rr.IPickingService),this.mapService=this.container.get(rr.IMapService);var u=this.getLayerConfig(),h=u.enableMultiPassRenderer,d=u.passes;h&&d!==null&&d!==void 0&&d.length&&d.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(rr.ICameraService),this.coordinateService=this.container.get(rr.ICoordinateSystemService),this.shaderModuleService=this.container.get(rr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(rr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(rr.IFactoryNormalPass),this.styleAttributeService=this.container.get(rr.IStyleAttributeService),this.multiPassRenderer=this.container.get(rr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(P){var L=P.attributeName,B=P.attributeField,Z=P.attributeValues,j=P.updateOptions;r.styleAttributeService.updateStyleAttribute(L,{scale:(0,Q.Z)({field:B},r.splitValuesAndCallbackInAttribute(Z,r.getLayerConfig()[L]))},j)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(rr.ILayerPlugin);var m=$S(this.plugins),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(P){m.e(P)}finally{m.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var h=this.calculateEncodeData(r,o),d=this.triangulation;return h&&d?this.styleAttributeService.createAttributesAndIndices(h,d):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,o){return this.inited?HS(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,Q.Z)((0,Q.Z)({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){return this.updateStyleAttribute("filter",r,o,u),this}},{key:"shape",value:function(r,o,u){var h,d,m,b=(h=this.styleAttributeService)===null||h===void 0||(d=h.getLayerStyleAttribute("shape"))===null||d===void 0||(m=d.scale)===null||m===void 0?void 0:m.field,A=r;return this.shapeOption={field:r,values:o},this.updateStyleAttribute("shape",r,o,u),this.tileLayer||XS(this,b,A),this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,l.isObject)(r)?(o.enable=!0,o=(0,Q.Z)((0,Q.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var h=u.getSource();h?u.layerSource.setData(r,o):(u.source(new To(r,o)),u.sourceEvent())}),this}},{key:"style",value:function(r){var o=this,u=this.getLayerConfig(),h=r.passes,d=(0,pe.Z)(r,YS);return h&&s1(h).forEach(function(m){var b=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(m[0]);b&&b.updateOptions(m[1])}),this.rawConfig=(0,Q.Z)((0,Q.Z)({},this.rawConfig),d),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&r.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(m){o.models=m})),this}},{key:"scale",value:function(r,o){return(0,l.isObject)(r)?this.scaleOptions=(0,Q.Z)((0,Q.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var n=(0,xa.Z)(di().mark(function o(){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){h.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){h.next=6;break}return h.next=4,this.multiPassRenderer.render();case 4:h.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return h.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,l.isObject)(r)?!0:r,(0,l.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,l.isObject)(r)){var h=r.x,d=h===void 0?0:h,m=r.y,b=m===void 0?0:m;this.updateLayerConfig({highlightColor:(0,l.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,l.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:d,y:b})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,l.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,l.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(z(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,l.isObject)(r)?!0:r,(0,l.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,l.isObject)(r)){var h=r.x,d=h===void 0?0:h,m=r.y,b=m===void 0?0:m;this.updateLayerConfig({selectColor:(0,l.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,l.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:d,y:b})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,l.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,l.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(z(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,h=o.minZoom,d=h===void 0?-Infinity:h,m=o.maxZoom,b=m===void 0?Infinity:m;return!!u&&r>=d&&r<=b}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),h=u.passes,d=h===void 0?[]:h;this.multiPassRenderer=u1(this,d,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var m=this.rendererService.getViewportSize(),b=m.width,A=m.height;this.multiPassRenderer.resize(b,A)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,h=u.some(function(d){return Math.abs(d)===Infinity});return h?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(u){return u.destroy()}),this.layerChildren=[],this.masks.map(function(u){return u.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,o),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(m){return(0,ae.Z)({value:o.invertExtent(m)},r,m)});return u}else if(o.ticks){var h=o.ticks().map(function(m){return(0,ae.Z)({value:m},r,o(m))});return h}else if(o!=null&&o.domain){var d=o.domain().filter(function(m){return!(0,l.isUndefined)(m)}).map(function(m){return(0,ae.Z)({value:m},r,o(m))});return d}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(r){var o=this,u=r.moduleName,h=r.vertexShader,d=r.fragmentShader,m=r.triangulation,b=r.segmentNumber,A=r.workerEnabled,P=A===void 0?!1:A,L=r.workerOptions,B=(0,pe.Z)(r,qS);this.shaderModuleService.registerModule(u,{vs:h,fs:d});var Z=this.shaderModuleService.getModule(u),j=Z.vs,J=Z.fs,fe=Z.uniforms,Ce=this.rendererService.createModel;return new Promise(function(Ve,tt){if(L&&L.modelType in Yp&&P)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,b,L).then(function(Qr){var Fn=Qr.attributes,ci=Qr.elements,Ba=Ce((0,Q.Z)({attributes:Fn,uniforms:fe,fs:J,vs:j,elements:ci,blend:Xg[jh.normal]},B));Ve(Ba)}).catch(function(Qr){return tt(Qr)});else{var st=o.styleAttributeService.createAttributesAndIndices(o.encodedData,m,b),Bt=st.attributes,Xt=st.elements,cr=st.count,Ir=(0,Q.Z)({attributes:Bt,uniforms:fe,fs:J,vs:j,elements:Xt,blend:Xg[jh.normal]},B);cr&&(Ir.count=cr);var wr=Ce(Ir);Ve(wr)}})}},{key:"createAttrubutes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),h=u.attributes;return h}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,h=u===void 0?!0:u,d=o.enableSelect,m=d===void 0?!0:d,b=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&m&&(b=!0),r==="mousemove"&&(h||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(b=!0),this.isVisible()&&b}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,xa.Z)(di().mark(function o(u){return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,u.render();case 2:case"end":return d.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var u;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(h){o.models=h,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(u=this.layerModel)!==null&&u!==void 0&&u.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(h){h.draw({uniforms:o.layerModel.getUninforms()},r)})}return this}},{key:"updateStyleAttribute",value:function(r,o,u,h){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,Q.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},h):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:h})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,l.isFunction)(r)?void 0:r||o,callback:(0,l.isFunction)(r)?r:void 0}}}]),t}(qu.EventEmitter),c1=wa(Yg.prototype,"configService",[l1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg),p1,qg,d1;function eA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function tA(e,a){if(!!e){if(typeof e=="string")return v1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return v1(e,a)}}function v1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var ko=(p1=Gg(rr.IGlobalConfigService),qg=function(){function e(a){(0,Ht.Z)(this,e),ga(this,"configService",d1,this),this.layer=a,this.rendererService=a.getContainer().get(rr.IRendererService),this.pickingService=a.getContainer().get(rr.IPickingService),this.shaderModuleService=a.getContainer().get(rr.IShaderModuleService),this.styleAttributeService=a.getContainer().get(rr.IStyleAttributeService),this.mapService=a.getContainer().get(rr.IMapService),this.iconService=a.getContainer().get(rr.IIconService),this.fontService=a.getContainer().get(rr.IFontService),this.cameraService=a.getContainer().get(rr.ICameraService),this.layerService=a.getContainer().get(rr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:Y.NEAREST,min:Y.NEAREST,width:1,height:1}))}return(0,Rt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return(0,l.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,l.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),(0,l.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,l.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,l.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),(0,l.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,l.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,l.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,l.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,l.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,l.isString)(t)?!!(0,g.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=I(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,l.isNumber)(t[0])&&(0,l.isNumber)(t[1]))}},{key:"patchMod",value:function(t,n){for(var r=0;r<n;r++)t.push(-1)}},{key:"patchData",value:function(t,n,r){var o=eA(r),u;try{for(o.s();!(u=o.n()).done;){var h=u.value,d=h.attr,m=h.count,b=n[d];b!==void 0?d==="stroke"?t.push.apply(t,(0,V.Z)(I(b))):d==="offsets"?this.isOffsetStatic(b)?t.push(-b[0],b[1]):t.push(0,0):t.push((0,l.isNumber)(b)?b:1):this.patchMod(t,m)}}catch(A){o.e(A)}finally{o.f()}}},{key:"calDataFrame",value:function(t,n,r){for(var o=n.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),h=u*this.DATA_TEXTURE_WIDTH,d=[],m=0;m<o;m++){var b=n[m];this.patchData(d,b,r)}for(var A=d.length;A<h;A++)d.push(-1);return{data:d,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,r=n===void 0?"normal":n;return Xg[jh[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),d1=wa(qg.prototype,"configService",[p1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qg),$g=100,_L=36,xL=40;function m1(e){return e/180*Math.acos(-1)}function g1(e){var a=m1(e[0])+Math.PI/2,t=m1(e[1]),n=$g+Math.random()*.4,r=n*Math.cos(t)*Math.cos(a),o=n*Math.cos(t)*Math.sin(a),u=n*Math.sin(t);return[o,u,r]}function bL(e,a){var t=mat4.create(),n=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);a=a||{},e=typeof e!="undefined"?e:1;for(var u=typeof a.segments!="undefined"?a.segments:32,h=2+u,d=2*h,m=[],b=[],A=[],P=[],L=[],B=[],Z=0;Z<=h;Z++){for(var j=Z/h,J=j*Math.PI,fe=0;fe<=d;fe++){var Ce=fe/d,Ve=Ce*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-J),mat4.identity(t),mat4.rotateY(t,t,Ve),vec3.transformMat4(o,r,n),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),A.push(o.slice()),P.push.apply(P,_toConsumableArray(o.slice())),vec3.normalize(o,o),L.push.apply(L,_toConsumableArray(o.slice())),B.push([Ce,1-j]),P.push(Ce,1-j)}if(Z>0)for(var tt=A.length,st=tt-2*(d+1);st+d+2<tt;st++)m.push([st,st+1,st+d+1]),b.push(st,st+1,st+d+1),m.push([st+d+1,st+1,st+d+2]),b.push(st+d+1,st+1,st+d+2)}return{cells:m,positions:A,uvs:B,positionsArr:P,indicesArr:b,normalArr:L}}var Km=cn.Ue(),EL=cn.Ue(),Fl=cn.Ue(),Sv=cn.Ue(),T0=cn.Ue();function Kg(e,a,t,n,r){cn.IH(e,t,n),cn.Fv(e,e),a=cn.al(-e[1],e[0]);var o=cn.al(-t[1],t[0]);return[r/cn.AK(a,o),a]}function Av(e,a){return cn.t8(e,-a[1],a[0])}function M0(e,a,t){return cn.lu(e,a,t),cn.Fv(e,e),e}function Qg(e,a){return e[0]===a[0]&&e[1]===a[1]}function CL(e){for(var a=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(t,1),t++):a.set(n,n)}return e}var rA=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ht.Z)(this,e),(0,ae.Z)(this,"lastFlip",-1),(0,ae.Z)(this,"miter",cn.al(0,0)),(0,ae.Z)(this,"started",!1),(0,ae.Z)(this,"dash",!1),(0,ae.Z)(this,"totalDistance",0),(0,ae.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Rt.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],d=t[u],m=u<t.length-1?t[u+1]:null,b=this.simpleSegment(n,o,h,d,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var d,m,b,A=t[h-1];A.push((d=n[h-1][2])!==null&&d!==void 0?d:0);var P=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,V.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,j=h<n.length-1?n[h+1]:null,J=this.simpleSegment(r,u,A,L,Z,P,B,j);u+=J}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var d,m,b,A=t[h-1];A.push((d=n[h-1][2])!==null&&d!==void 0?d:0);var P=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,V.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,j=h<n.length-1?n[h+1]:null,J=this.segment_gaode2(r,u,A,L,Z,P,B,j);u+=J}if(this.dash)for(var fe=0;fe<r.positions.length/6;fe++)r.positions[fe*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],d=t[u],m=u<t.length-1?t[u+1]:null,b=this.segment(n,o,h,d,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,r,o,u){var h=0,d=t.indices,m=t.positions,b=t.normals,A=Ao([o[0],o[1]]),P=Ao([r[0],r[1]]);M0(Fl,A,P);var L=0;if(this.dash&&(L=this.lineSegmentDistance(A,P),this.totalDistance+=L),this.normal||(this.normal=cn.Ue(),Av(this.normal,Fl)),this.started||(this.started=!0,this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-L)),d.push(n+0,n+1,n+2),!u)Av(this.normal,Fl),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2;else{var B=Ao([u[0],u[1]]);Qg(A,B)&&cn.IH(B,A,cn.Fv(B,cn.$X(B,A,P))),M0(Sv,B,A);var Z=Kg(T0,cn.Ue(),Fl,Sv,this.thickness),j=(0,Pr.Z)(Z,2),J=j[0],fe=j[1],Ce=cn.AK(T0,this.normal)<0?-1:1;this.extrusions(m,b,o,fe,J,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ce=-1,cn.JG(this.normal,fe),h+=2,this.lastFlip=Ce}return h}},{key:"segment_gaode2",value:function(t,n,r,o,u,h,d,m){var b=0,A=t.indices,P=t.positions,L=t.normals,B=this.cap==="square",Z=this.join==="bevel",j=Ao([d[0],d[1]]),J=Ao([h[0],h[1]]);M0(Fl,o,r);var fe=0;if(this.dash&&(fe=this.lineSegmentDistance(j,J),this.totalDistance+=fe),this.normal||(this.normal=cn.Ue(),Av(this.normal,Fl)),!this.started)if(this.started=!0,B){var Ce=cn.Ue(),Ve=cn.Ue();cn.IH(Ce,this.normal,Fl),cn.IH(Ve,this.normal,Fl),L.push(Ve[0],Ve[1],0),L.push(Ce[0],Ce[1],0),P.push(r[0],r[1],r[2]|0,this.totalDistance-fe,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),P.push(r[0],r[1],r[2]|0,this.totalDistance-fe,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,L,r,this.normal,this.thickness,this.totalDistance-fe);if(A.push(n+0,n+1,n+2),u){Qg(o,u)&&cn.IH(u,o,cn.Fv(u,cn.$X(u,o,r))),M0(Sv,u,o);var Bt=Kg(T0,cn.Ue(),Fl,Sv,this.thickness),Xt=(0,Pr.Z)(Bt,2),cr=Xt[0],Ir=Xt[1],wr=cn.AK(T0,this.normal)<0?-1:1,Qr=Z;if(!Qr&&this.join==="miter"){var Fn=cr;Fn>this.miterLimit&&(Qr=!0)}Qr?(L.push(this.normal[0],this.normal[1],0),L.push(Ir[0],Ir[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,V.Z)(this.lastFlip!==-wr?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),Av(Km,Sv),cn.JG(this.normal,Km),L.push(this.normal[0],this.normal[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(P,L,o,Ir,cr,this.totalDistance),A.push.apply(A,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wr=-1,cn.JG(this.normal,Ir),b+=2),this.lastFlip=wr}else{if(Av(this.normal,Fl),B){var tt=cn.Ue(),st=cn.Ue();cn.lu(st,Fl,this.normal),cn.IH(tt,Fl,this.normal),L.push(st[0],st[1],0),L.push(tt[0],tt[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,L,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"segment",value:function(t,n,r,o,u){var h=0,d=t.indices,m=t.positions,b=t.normals,A=this.cap==="square",P=this.join==="bevel",L=Ao([o[0],o[1]]),B=Ao([r[0],r[1]]);M0(Fl,L,B);var Z=0;if(this.dash&&(Z=this.lineSegmentDistance(L,B),this.totalDistance+=Z),this.normal||(this.normal=cn.Ue(),Av(this.normal,Fl)),!this.started)if(this.started=!0,A){var j=cn.Ue(),J=cn.Ue();cn.IH(j,this.normal,Fl),cn.IH(J,this.normal,Fl),b.push(J[0],J[1],0),b.push(j[0],j[1],0),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-Z);if(d.push(n+0,n+1,n+2),u){var Ve=Ao([u[0],u[1]]);Qg(L,Ve)&&cn.IH(Ve,L,cn.Fv(Ve,cn.$X(Ve,L,B))),M0(Sv,Ve,L);var tt=Kg(T0,cn.Ue(),Fl,Sv,this.thickness),st=(0,Pr.Z)(tt,2),Bt=st[0],Xt=st[1],cr=cn.AK(T0,this.normal)<0?-1:1,Ir=P;if(!Ir&&this.join==="miter"){var wr=Bt;wr>this.miterLimit&&(Ir=!0)}Ir?(b.push(this.normal[0],this.normal[1],0),b.push(Xt[0],Xt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,d.push.apply(d,(0,V.Z)(this.lastFlip!==-cr?[n,n+2,n+3]:[n+2,n+1,n+3])),d.push(n+2,n+3,n+4),Av(Km,Sv),cn.JG(this.normal,Km),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*cr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(m,b,o,Xt,Bt,this.totalDistance),d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),cr=-1,cn.JG(this.normal,Xt),h+=2),this.lastFlip=cr}else{if(Av(this.normal,Fl),A){var fe=cn.Ue(),Ce=cn.Ue();cn.lu(Ce,Fl,this.normal),cn.IH(fe,Fl,this.normal),b.push(Ce[0],Ce[1],0),b.push(fe[0],fe[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);d.push.apply(d,(0,V.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2}return h}},{key:"extrusions",value:function(t,n,r,o,u,h){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,h,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,h,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),Qo=ue(77160);function nA(e){var a=e[0][0],t=e[0][e[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,r=Fu().flatten(e),o=r.vertices,u=r.dimensions,h=[],d=[],m=0;m<o.length/u;m++)u===2?h.push(o[m*2],o[m*2+1],1):h.push(o[m*3],o[m*3+1],1);var b=Fu()(r.vertices,r.holes,r.dimensions);d.push.apply(d,(0,V.Z)(b));for(var A=function(B){var Z=r.vertices.slice(B*u,(B+1)*u),j=r.vertices.slice((B+1)*u,(B+2)*u);j.length===0&&(j=r.vertices.slice(0,u));var J=h.length/3;h.push(Z[0],Z[1],1,j[0],j[1],1,Z[0],Z[1],0,j[0],j[1],0),d.push.apply(d,(0,V.Z)([0,2,1,2,3,1].map(function(fe){return fe+J})))},P=0;P<n;P++)A(P);return{positions:h,index:d}}function iA(e){var a=Fu().flatten(e),t=Fu()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function y1(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=Fu().flatten(e),u=o.vertices,h=o.dimensions,d=[],m=[],b=[],A=0;A<u.length/h;A++)h===2?d.push(u[A*2],u[A*2+1],1,-1,-1):d.push(u[A*3],u[A*3+1],1,-1,-1),b.push(0,0,1);var P=Fu()(o.vertices,o.holes,o.dimensions);m.push.apply(m,(0,V.Z)(P));for(var L=function(j){var J=o.vertices.slice(j*h,(j+1)*h),fe=o.vertices.slice((j+1)*h,(j+2)*h);fe.length===0&&(fe=o.vertices.slice(0,h));var Ce=d.length/5;d.push(J[0],J[1],1,0,0,fe[0],fe[1],1,.1,0,J[0],J[1],0,0,.8,fe[0],fe[1],0,.1,.8);var Ve=aA([fe[0],fe[1],1],[J[0],J[1],0],[J[0],J[1],1],a);b.push.apply(b,(0,V.Z)(Ve).concat((0,V.Z)(Ve),(0,V.Z)(Ve),(0,V.Z)(Ve))),m.push.apply(m,(0,V.Z)([1,2,0,3,2,1].map(function(tt){return tt+Ce})))},B=0;B<r;B++)L(B);return{positions:d,index:m,normals:b}}function aA(e,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=Qo.create(),o=Qo.create(),u=Qo.create();n&&(e=rh(e),a=rh(a),t=rh(t));var h=Qo.fromValues.apply(Qo,(0,V.Z)(e)),d=Qo.fromValues.apply(Qo,(0,V.Z)(a)),m=Qo.fromValues.apply(Qo,(0,V.Z)(t));Qo.sub(r,m,d),Qo.sub(o,h,d),Qo.cross(u,r,o);var b=Qo.create();return Qo.normalize(b,u),b}var vp,Yv;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Yv||(Yv={}));var qv;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(qv||(qv={}));function um(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],r=0;r<e;r++)n.push(t*r+a*Math.PI/12);var o=n.map(function(u){var h=Math.sin(u+Math.PI/4),d=Math.cos(u+Math.PI/4);return[h,d,0]});return o}function _1(){return um(30)}function x1(){return um(4)}function b1(){return um(3)}function E1(){return um(6,1)}function C1(){return um(5)}var I0=(vp={},(0,ae.Z)(vp,qv.CIRCLE,_1),(0,ae.Z)(vp,qv.HEXAGON,E1),(0,ae.Z)(vp,qv.TRIANGLE,b1),(0,ae.Z)(vp,qv.SQUARE,x1),(0,ae.Z)(vp,qv.PENTAGON,C1),(0,ae.Z)(vp,Yv.CYLINDER,_1),(0,ae.Z)(vp,Yv.HEXAGONCOLUMN,E1),(0,ae.Z)(vp,Yv.TRIANGLECOLUMN,b1),(0,ae.Z)(vp,Yv.SQUARECOLUMN,x1),(0,ae.Z)(vp,Yv.PENTAGONCOLUMN,C1),vp),Qm={};function $v(e){var a=Wu(e.coordinates);return{vertices:[].concat((0,V.Z)(a),(0,V.Z)(a),(0,V.Z)(a),(0,V.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function S1(e){var a=Wu(e.coordinates),t=g1(a);return{vertices:[].concat((0,V.Z)(t),(0,V.Z)(t),(0,V.Z)(t),(0,V.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Jg(e){var a=e.shape,t=fA(a,!1),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function oA(e){var a=Wu(e.coordinates);return{vertices:(0,V.Z)(a),indices:[0],size:a.length}}function Kv(e){var a=e.coordinates,t=e.originCoordinates,n=e.version,r=new rA({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var h=0;h<o.length;h++){var d=o[h],m=u[h];r.extrude_gaode2(d,m)}}else{var b=a;b[0]&&!Array.isArray(b[0][0])&&(b=[a]),b.forEach(function(P){r.extrude(P)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function sA(e){var a=e.coordinates,t=[],n=uA(a),r=n.results,o=n.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function A1(e,a){var t=a[0]-e[0],n=a[1]-e[1];return Math.sqrt(t*t+n*n)}function ey(e,a){return e.length<3&&e.push(0),e.push(a),e}function uA(e){var a=0;if(e.length<2)return{results:e,totalDistance:0};var t=[],n=ey(e[0],a);t.push(n);for(var r=1;r<e.length-1;r++){var o=A1(e[r-1],e[r]);a+=o;var u=ey(e[r],a);t.push(u),t.push(u)}var h=A1(e[e.length-2],e[e.length-1]);return a+=h,t.push(ey(e[e.length-1],a)),{results:t,totalDistance:a}}function lm(e){var a=e.coordinates,t=Fu().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(n,o,r),vertices:n,size:r}}function lA(e){var a=e.coordinates,t=Fu().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Fu()(n,o,r),vertices:cA(n),size:r+4}}function cA(e){for(var a=[],t=nf(e),n=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],h=e[o+1];a.push.apply(a,[u,h,0].concat((0,V.Z)(n),[r]))}return a}function w1(e){var a=e.coordinates,t=y1(a,!0),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function T1(e){var a=e.shape,t=pA(a),n=t.positions,r=t.index;return{vertices:n,indices:r,size:3}}function ty(e){var a=e.coordinates,t=[].concat((0,V.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,V.Z)(a[1]),[0,1,0],(0,V.Z)(a[0]),[0,0,1],(0,V.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Jm(e,a){for(var t=a||30,n=e.coordinates,r=[],o=[],u=function(m){r.push(m,1,m,n[0][0],n[0][1],n[1][0],n[1][1],m,-1,m,n[0][0],n[0][1],n[1][0],n[1][1]),m!==t-1&&o.push.apply(o,(0,V.Z)([0,1,2,1,3,2].map(function(b){return m*2+b})))},h=0;h<t;h++)u(h);return{vertices:r,indices:o,size:7}}function M1(e){var a=e.coordinates;a.length===2&&a.push(0);var t=e.size,n=eg(-1,1),r=eg(1,1),o=eg(-1,-1),u=eg(1,-1),h=[].concat((0,V.Z)(a),(0,V.Z)(n),(0,V.Z)(a),(0,V.Z)(o),(0,V.Z)(a),(0,V.Z)(u),(0,V.Z)(a),(0,V.Z)(r)),d=[0,1,2,3,0,2];return{vertices:h,indices:d,size:5}}function fA(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Qm&&Qm[e])return Qm[e];var t=I0[e]?I0[e]():I0.cylinder(),n=y1([t],a);return Qm[e]=n,n}function SL(e,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,h,d=vec3.create(),m=vec3.create(),b=vec3.create(),A=0,P=a.length;A<P;A+=3){o=a[A+0]*3,u=a[A+1]*3,h=a[A+2]*3;var L=[e[o],e[o+1]],B=[e[u],e[u+1]],Z=[e[h],e[h+1]];n&&(L=lngLatToMeters(L),B=lngLatToMeters(B),Z=lngLatToMeters(Z));var j=L,J=_slicedToArray(j,2),fe=J[0],Ce=J[1],Ve=vec3.fromValues(fe,Ce,e[o+2]),tt=B,st=_slicedToArray(tt,2),Bt=st[0],Xt=st[1],cr=vec3.fromValues(Bt,Xt,e[u+2]),Ir=Z,wr=_slicedToArray(Ir,2),Qr=wr[0],Fn=wr[1],ci=vec3.fromValues(Qr,Fn,e[h+2]);vec3.sub(d,ci,cr),vec3.sub(m,Ve,cr),vec3.cross(b,d,m),r[o]+=d[0],r[o+1]+=d[1],r[o+2]+=d[2],r[u]+=d[0],r[u+1]+=d[1],r[u+2]+=d[2],r[h]+=d[0],r[h+1]+=d[1],r[h+2]+=d[2]}return hA(r),r}function hA(e){for(var a=0,t=e.length;a<t;a+=3){var n=vec3.fromValues(e[a],e[a+1],e[a+2]),r=vec3.create();vec3.normalize(r,n),e.set(r,a)}}function AL(e){var a=e[0][0],t=e[0][e[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function pA(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=I0[e]?I0[e]():I0.circle(),n=a.indexOf(e)===-1?iA([t]):nA([t]);return n}function eg(e,a){var t=(e+1)/2,n=(a+1)/2;return[t,n]}function wL(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function TL(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function dA(e){var a=vA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,yA=function(e){(0,Or.Z)(t,e);var a=dA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.baseColor,d=h===void 0?"rgb(16,16,16)":h,m=r.brightColor,b=m===void 0?"rgb(255,176,38)":m,A=r.windowColor,P=A===void 0?"rgb(30,60,89)":A,L=r.time,B=L===void 0?0:L,Z=r.sweep,j=Z===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Z;return{u_cityCenter:j.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*j.sweepRadius,u_circleSweep:j.enable?1:0,u_circleSweepColor:I(j.sweepColor).slice(0,3),u_circleSweepSpeed:j.sweepSpeed,u_opacity:u,u_baseColor:I(d),u_brightColor:I(b),u_windowColor:I(P),u_time:this.layer.getLayerAnimateTime()||B}}},{key:"calCityGeo",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],d=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(h+o)/2,(d+u)/2]);var m=this.mapService.lngLatToCoord([h,d]),b=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(m[0]-b[0],2)+Math.pow(m[1]-b[1],2))/4}else{var A=h-o,P=d-u;this.cityCenter=[(h+o)/2,(d+u)/2],this.cityMinSize=Math.sqrt(Math.pow(A,2)+Math.pow(P,2))/4}}},{key:"initModels",value:function(r){this.calCityGeo(),this.startModelAnimate(),this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:gA,fragmentShader:mA,triangulation:w1,depth:{enable:!0},cull:{enable:!0,face:Y.BACK}}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?10:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){var m=o.size;return[h[3],h[4]]}}})}}]),t}(ko);function _A(e){var a=xA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=function(e){(0,Or.Z)(t,e);var a=_A(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","CityBuildingLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this;this.layerModel=new yA(this),this.layerModel.initModels(function(o){r.models=o,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(_d);function EA(e){var a=CA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function CA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SA=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,AA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,wA=function(e){(0,Or.Z)(t,e);var a=EA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:SA,fragmentShader:AA,triangulation:T1,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(ko);function TA(e){var a=MA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,PA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,kA=function(e){(0,Or.Z)(t,e);var a=TA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:IA,fragmentShader:PA,triangulation:Jg,primitive:Y.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size;return Array.isArray(m)?[m[0]]:[m]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(ko);function LA(e,a){for(var t=[],n=[],r=[],o=e+1,u=a+1,h=e/2,d=a/2,m=0;m<u;m++)for(var b=m-d,A=0;A<o;A++){var P=A-h;n.push(P/h,-b/d,0),r.push(A/e),r.push(1-m/a)}for(var L=0;L<a;L++)for(var B=0;B<e;B++){var Z=B+o*L,j=B+o*(L+1),J=B+1+o*(L+1),fe=B+1+o*L;t.push(Z,j,fe),t.push(j,J,fe)}return{vertices:n,indices:t,uvs:r}}var I1,P1;function OA(e){var a=RA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function RA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,FA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,BA=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,NA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,zA=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,UA=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,k1=(I1=(0,$r.b2)(),I1(P1=function(e){(0,Or.Z)(t,e);var a=OA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,h=o.useFramebuffer;h(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){var h,d,m,b,A,P,L,B,Z,j,J,fe;return di().wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:return d=this.rendererService,m=d.createFramebuffer,b=d.clear,A=d.getViewportSize,P=d.createTexture2D,L=d.useFramebuffer,B=this.styleAttributeService.getLayerStyleAttribute("shape"),Z=(B==null||(h=B.scale)===null||h===void 0?void 0:h.field)||"heatmap",this.shapeType=Z,Ve.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=Ve.sent,this.colorModel=Z==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),j=A(),J=j.width,fe=j.height,this.heatmapFramerBuffer=m({color:P({width:Math.floor(J/4),height:Math.floor(fe/4),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return Ve.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:jn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return[b]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,xa.Z)(di().mark(function o(){var u;return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.layer.triangulation=M1,d.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:UA,fragmentShader:zA,triangulation:M1,depth:{enable:!1},cull:{enable:!0,face:sf(this.mapService.version)},blend:{enable:!0,func:{srcRGB:Y.ONE,srcAlpha:1,dstRGB:Y.ONE,dstAlpha:1}}});case 3:return u=d.sent,d.abrupt("return",u);case 5:case"end":return d.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,h=r.maskInside,d=h===void 0?!0:h;this.shaderModuleService.registerModule("heatmapColor",{vs:NA,fs:BA});var m=this.shaderModuleService.getModule("heatmapColor"),b=m.vs,A=m.fs,P=m.uniforms,L=this.rendererService,B=L.createAttribute,Z=L.createElements,j=L.createBuffer,J=L.createModel;return J({vs:b,fs:A,attributes:{a_Position:B({buffer:j({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Y.FLOAT}),size:3}),a_Uv:B({buffer:j({data:[0,1,1,1,0,0,1,0],type:Y.FLOAT}),size:2})},uniforms:(0,Q.Z)({},P),depth:{enable:!1},blend:this.getBlend(),elements:Z({data:[0,2,1,2,3,1],type:Y.UNSIGNED_INT,count:6}),stencil:_e(u,d)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,h=o.intensity,d=h===void 0?10:h,m=o.radius,b=m===void 0?5:m;(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:b,u_intensity:d}})}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,h=Xc();jf(h,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,V.Z)(h)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,h=r.maskInside,d=h===void 0?!0:h,m=this.rendererService.getViewportSize,b=m(),A=b.width,P=b.height,L=LA(A/4,P/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:FA,fs:DA});var B=this.shaderModuleService.getModule("heatmap3dColor"),Z=B.vs,j=B.fs,J=B.uniforms,fe=this.rendererService,Ce=fe.createAttribute,Ve=fe.createElements,tt=fe.createBuffer,st=fe.createModel;return st({vs:Z,fs:j,attributes:{a_Position:Ce({buffer:tt({data:L.vertices,type:Y.FLOAT}),size:3}),a_Uv:Ce({buffer:tt({data:L.uvs,type:Y.FLOAT}),size:2})},primitive:Y.TRIANGLES,uniforms:(0,Q.Z)({},J),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ve({data:L.indices,type:Y.UNSIGNED_INT,count:L.indices.length}),stencil:_e(u,d)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:new Uint8Array(h.data),width:h.width,height:h.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1})}}]),t}(ko))||P1);function ZA(e){var a=VA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,HA=function(e){(0,Or.Z)(t,e);var a=ZA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:GA,fragmentShader:jA,triangulation:T1,depth:{enable:!1},primitive:Y.TRIANGLES,blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(ko),WA={heatmap:k1,heatmap3d:k1,grid:wA,grid3d:kA,hexagon:HA},XA=WA;function YA(e){var a=qA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function qA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $A=function(e){(0,Or.Z)(t,e);var a=YA(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","HeatMapLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new XA[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return r.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),h=u.shape3d,d=this.getSource(),m=d.data.type,b=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return b==="heatmap"||b==="heatmap3d"?"heatmap":m==="hexagon"?(h==null?void 0:h.indexOf(b))===-1?"hexagon":"grid3d":m==="grid"?(h==null?void 0:h.indexOf(b))===-1?"grid":"grid3d":"heatmap"}}]),t}(_d);function KA(e){var a=QA();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,ew=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,tw=function(e){(0,Or.Z)(t,e);var a=KA(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,h=u===void 0?!0:u,d=r.clampHigh,m=d===void 0?!0:d,b=r.noDataValue,A=b===void 0?-9999999:b,P=r.domain,L=P===void 0?[0,1]:P,B=r.rampColors,Z=r.pixelConstant,j=Z===void 0?0:Z,J=r.pixelConstantR,fe=J===void 0?256*256:J,Ce=r.pixelConstantG,Ve=Ce===void 0?256:Ce,tt=r.pixelConstantB,st=tt===void 0?1:tt,Bt=r.pixelConstantRGB,Xt=Bt===void 0?.1:Bt;return(0,l.isEqual)(this.rampColors,B)||(this.updateColorTexure(),this.rampColors=B),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:j,u_pixelConstantR:fe,u_pixelConstantG:Ve,u_pixelConstantB:st,u_pixelConstantRGB:Xt,u_domain:L,u_clampLow:h,u_clampHigh:typeof m!="undefined"?m:h,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),h=u.mask,d=h===void 0?!1:h,m=u.maskInside,b=m===void 0?!0:m,A=u.rampColorsData,P=u.rampColors,L=this.layer.getSource(),B=this.rendererService.createTexture2D;if(this.texture=B({height:0,width:0}),Eu){var Z=this.layerService.sceneService.getSceneConfig().canvas,j=Z.createImage();j.crossOrigin="anonymous",j.src=L.data.originData,j.onload=function(){o.texture=B({data:j,width:j.width,height:j.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else L.data.images.then(function(fe){o.texture=B({data:fe[0],width:fe[0].width,height:fe[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});var J=A||q(P);this.colorTexture=B({data:J.data,width:J.width,height:J.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:ew,fragmentShader:JA,triangulation:ty,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:_e(d,b)}).then(function(fe){r([fe])}).catch(function(fe){console.warn(fe),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:h.data,width:h.width,height:h.height,flipY:!1})}}]),t}(ko);function rw(e){var a=nw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,aw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ow=function(e){(0,Or.Z)(t,e);var a=rw(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),h=u.mask,d=h===void 0?!1:h,m=u.maskInside,b=m===void 0?!0:m,A=this.layer.getSource(),P=this.rendererService.createTexture2D;if(this.texture=P({height:0,width:0}),Eu){var L=this.layerService.sceneService.getSceneConfig().canvas,B=L.createImage();B.crossOrigin="anonymous",B.src=A.data.originData,B.onload=function(){o.texture=P({data:B,width:B.width,height:B.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else A.data.images.then(function(Z){o.texture=P({data:Z[0],width:Z[0].width,height:Z[0].height,mag:Y.LINEAR,min:Y.LINEAR}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:aw,fragmentShader:iw,triangulation:ty,primitive:Y.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:_e(d,b)}).then(function(Z){r([Z])}).catch(function(Z){console.warn(Z),r([])})}},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}})}}]),t}(ko),sw={image:ow,dataImage:tw},uw=sw;function lw(e){var a=cw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L1=function(e){(0,Or.Z)(t,e);var a=lw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","ImageLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new uw[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{},dataImage:{}};return o[r]}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="dataImage"?"dataImage":(u==="image","image")}}]),t}(_d);function fw(e){var a=hw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,dw=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,vw=function(e){(0,Or.Z)(t,e);var a=fw(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o;return{u_opacity:(0,l.isNumber)(u)?u:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){return di().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:dw,fragmentShader:pw,triangulation:lm,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:Y.ALWAYS,ref:1,mask:255},opFront:{fail:Y.REPLACE,zfail:Y.REPLACE,zpass:Y.REPLACE}}}).then(function(m){u([m])}).catch(function(m){console.warn(m),u([])});case 1:case"end":return d.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(ko),mw={fill:vw},gw=mw;function yw(e){var a=_w();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O1=function(e){(0,Or.Z)(t,e);var a=yw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","MaskLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new gw[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(_d),xw=["mvt","geojsonvt","testTile"];function ry(e){return xw.indexOf(e)>=0}function ny(e,a){a.map(function(t){var n=Hg(e.sceneContainer);t.setContainer(n,e.sceneContainer),t.init()})}function R1(e,a){var t,n=a.getAttribute("shape");if(n&&(t=n.scale)!==null&&t!==void 0&&t.field){var r;return((r=n.scale)===null||r===void 0?void 0:r.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function bw(e,a){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function Ew(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function Cw(e,a,t,n){var r,o,u,h,d=(e==null||(r=e.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],m=(0,Pr.Z)(d,4),b=m[0],A=b===void 0?0:b,P=m[1],L=P===void 0?0:P,B=m[2],Z=B===void 0?10:B,j=m[3],J=j===void 0?-10:j,fe=a.lngLatToContainer([A,L]),Ce=a.lngLatToContainer([Z,J]),Ve=Ce.x-fe.x,tt=fe.y-Ce.y,st=[(t-fe.x)/Ve,(n-Ce.y)/tt],Bt=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,Xt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,cr=Math.floor(st[0]*Bt),Ir=Math.floor(st[1]*Xt),wr=Math.max(0,Ir-1)*Bt+cr,Qr=e==null||(h=e.data)===null||h===void 0?void 0:h.data[wr];return Qr}function ML(e,a,t){var n=t.readPixels,r=t.getContainer,o=e*DOM.DPR,u=a*DOM.DPR,h=Ew(r()),d=h.width,m=h.height;if(d*=DOM.DPR,m*=DOM.DPR,o>d-1*DOM.DPR||o<0||u>m-1*DOM.DPR||u<0)return!1;var b=n({x:Math.floor(o),y:Math.floor(m-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return b}function Sw(e){var a=Aw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ww=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Tw=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,iy=function(e){(0,Or.Z)(t,e);var a=Sw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.textureBlend,d=h===void 0?"normal":h,m=r.lineTexture,b=m===void 0?!1:m,A=r.iconStep,P=A===void 0?100:A,L=r.vertexHeightScale,B=L===void 0?20:L,Z=r.borderWidth,j=Z===void 0?0:Z,J=r.borderColor,fe=J===void 0?"#ccc":J,Ce=r.heightfixed,Ve=Ce===void 0?!1:Ce,tt=r.arrow,st=tt===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:tt,Bt=r.coord,Xt=Bt===void 0?"lnglat":Bt,cr=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Ir=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,Ir,this.cellProperties),Qr=wr.data,Fn=wr.width,ci=wr.height;this.rowCount=ci,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:Fn,height:ci}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:cr||[0,0],u_coord:Xt==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_textureBlend:d==="normal"?0:1,u_texture:this.texture,u_line_texture:b?1:0,u_icon_step:P,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:j,u_borderColor:I(fe),u_heightfixed:Number(Ve),u_vertexScale:B,u_arrow:Number(st.enable),u_arrowHeight:st.arrowHeight||3,u_arrowWidth:st.arrowWidth||2,u_tailWidth:st.tailWidth===void 0?1:st.tailWidth}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){var h,d,m,b,A,P,L;return di().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:h=this.layer.getLayerConfig(),d=h.mask,m=d===void 0?!1:d,b=h.maskInside,A=b===void 0?!0:b,P=h.depth,L=P===void 0?!1:P,this.layer.triangulation=Kv,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:Tw,fragmentShader:ww,triangulation:Kv,blend:this.getBlend(),depth:{enable:L},stencil:_e(m,A)}).then(function(j){u([j])}).catch(function(j){console.warn(j),u([])});case 3:case"end":return Z.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m,b,A){return A===void 0?[d[3],10]:[d[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function Mw(e){var a=Iw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pw=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,kw=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,D1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,F1=function(e){(0,Or.Z)(t,e);var a=Mw(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.vertexHeightScale,b=m===void 0?20:m,A=0,P=[0,0,0,0],L=[0,0,0,0];if(h&&d&&(P=I(h),L=I(d),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var B=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,B,this.cellProperties),j=Z.data,J=Z.width,fe=Z.height;this.rowCount=fe,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:Y.LUMINANCE,type:Y.FLOAT,width:J,height:fe}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:P,u_targetColor:L,u_vertexScale:b}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:kw,vert:D1,type:"lineSimpleLinear"}:{frag:Pw,vert:D1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=this.getShaders(),A=b.frag,P=b.vert,L=b.type;this.layer.buildLayerModel({moduleName:L,vertexShader:P,fragmentShader:A,triangulation:sA,primitive:Y.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(B){r([B])}).catch(function(B){console.warn(B),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:jn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){return[h[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){return[h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}})}}]),t}(ko);function Lw(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ow(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Ow(e,a){if(!!e){if(typeof e=="string")return B1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return B1(e,a)}}function B1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Rw=function(){function e(a,t,n){(0,Ht.Z)(this,e),(0,ae.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(a/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,Rt.Z)(e,[{key:"insert",value:function(t,n,r,o,u){this.forEachCell(n,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!1,u)}},{key:"hitTest",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,n,r,o,u,h){this.boxCells[u].push(h)}},{key:"queryHitTest",value:function(t,n,r,o,u,h){if(r<0||t>this.width||o<0||n>this.height)return u?!1:[];var d=[];if(t<=0&&n<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var m=0;m<this.boxKeys.length;m++)d.push({key:this.boxKeys[m],x1:this.bboxes[m*4],y1:this.bboxes[m*4+1],x2:this.bboxes[m*4+2],y2:this.bboxes[m*4+3]});return h?d.filter(h):d}var b={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,r,o,this.queryCell,d,b,h),u?d.length>0:d}},{key:"queryCell",value:function(t,n,r,o,u,h,d,m){var b=d.seenUids,A=this.boxCells[u];if(A!==null){var P=this.bboxes,L=Lw(A),B;try{for(L.s();!(B=L.n()).done;){var Z=B.value;if(!b.box[Z]){b.box[Z]=!0;var j=Z*4;if(t<=P[j+2]&&n<=P[j+3]&&r>=P[j+0]&&o>=P[j+1]&&(!m||m(this.boxKeys[Z]))){if(d.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[Z],x1:P[j],y1:P[j+1],x2:P[j+2],y2:P[j+3]})}}}}catch(J){L.e(J)}finally{L.f()}}return!1}},{key:"forEachCell",value:function(t,n,r,o,u,h,d,m){for(var b=this.convertToXCellCoord(t),A=this.convertToYCellCoord(n),P=this.convertToXCellCoord(r),L=this.convertToYCellCoord(o),B=b;B<=P;B++)for(var Z=A;Z<=L;Z++){var j=this.xCellCount*Z+B;if(u.call(this,t,n,r,o,j,h,d,m))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),Dw=Rw,N1=function(){function e(a,t){(0,Ht.Z)(this,e),(0,ae.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new Dw(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,Rt.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,r,o,u)||this.grid.hitTest(n,r,o,u)?{box:[]}:{box:[n,r,o,u]}}},{key:"insertCollisionBox",value:function(t,n){var r={featureIndex:n};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,r){var o=G0(n,r,0,1),u=v0(),h=Op.apply(Re,(0,V.Z)(t));return Y0(u,o,h),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function z1(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Fw(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Fw(e,a){if(!!e){if(typeof e=="string")return U1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return U1(e,a)}}function U1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Z1(e){var a=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function V1(e,a,t,n,r){if(!!r){var o=e[n],u=o.glyph;if(u)for(var h=a[u].advance*o.scale,d=(e[n].x+h)*r,m=t;m<=n;m++)e[m].x-=d}}function j1(e,a,t,n,r,o,u){var h=(a-t)*r,d=(-n*u+.5)*o,m=z1(e),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.x+=h,A.y+=d}}catch(P){m.e(P)}finally{m.f()}}function Bw(e,a,t,n,r,o,u){var h=-8,d=0,m=h,b=0,A=e.positionedGlyphs,P=o==="right"?1:o==="left"?0:.5,L=A.length;t.forEach(function(fe){if(fe.split("").forEach(function(Ve){var tt=a[Ve],st=0;tt&&(A.push({glyph:Ve,x:d,y:m+st,vertical:!1,scale:1,metrics:tt}),d+=tt.advance+u)}),A.length!==L){var Ce=d-u;b=Math.max(Ce,b),V1(A,a,L,A.length-1,P)}d=0,m-=n+5});var B=Z1(r),Z=B.horizontalAlign,j=B.verticalAlign;j1(A,P,Z,j,b,n,t.length);var J=m-h;e.top+=-j*J,e.bottom=e.top-J,e.left+=-Z*b,e.right=e.left+b}function Nw(e,a,t,n,r,o,u){var h=-8,d=0,m=h,b=0,A=e.positionedGlyphs,P=o==="right"?1:o==="left"?0:.5,L=A.length;t.forEach(function(fe){var Ce=a[fe],Ve=0;if(Ce&&(A.push({glyph:fe,x:Ce.advance/2,y:m+Ve,vertical:!1,scale:1,metrics:Ce}),d+=Ce.advance+u),A.length!==L){var tt=d-u;b=Math.max(tt,b),V1(A,a,L,A.length-1,P)}d=0,m-=n+5});var B=Z1(r),Z=B.horizontalAlign,j=B.verticalAlign;j1(A,P,Z,j,b,n,t.length);var J=m-h;e.top+=-j*J,e.bottom=e.top-J,e.left+=-Z*b,e.right=e.left+b}function G1(e,a,t,n,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],h=arguments.length>7?arguments[7]:void 0,d=e.split(`
`),m=[],b={positionedGlyphs:m,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:d.length,text:e};return h?Nw(b,a,d,t,n,r,o):Bw(b,a,d,t,n,r,o),m.length?b:!1}function H1(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,r=n===void 0?[]:n,o=[],u=z1(r),h;try{for(u.s();!(h=u.n()).done;){var d=h.value,m=d.metrics,b=4,A=m.advance*d.scale/2,P=t?[d.x+A,d.y]:[0,0],L=t?[0,0]:[d.x+A+a[0],d.y+a[1]],B=(0-b)*d.scale-A+L[0],Z=(0-b)*d.scale+L[1],j=B+m.width*d.scale,J=Z+m.height*d.scale,fe={x:B,y:Z},Ce={x:j,y:Z},Ve={x:B,y:J},tt={x:j,y:J};o.push({tl:fe,tr:Ce,bl:Ve,br:tt,tex:m,glyphOffset:P})}}catch(st){u.e(st)}finally{u.f()}return o}function zw(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Uw(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Uw(e,a){if(!!e){if(typeof e=="string")return W1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return W1(e,a)}}function W1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Zw(e){var a=Vw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Y1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function q1(e){var a=this,t=e.id,n=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(h,d){n.push.apply(n,(0,V.Z)(u).concat([h.tex.x,h.tex.y+h.tex.height,h.tl.x,h.tl.y],(0,V.Z)(u),[h.tex.x+h.tex.width,h.tex.y+h.tex.height,h.tr.x,h.tr.y],(0,V.Z)(u),[h.tex.x+h.tex.width,h.tex.y,h.br.x,h.br.y],(0,V.Z)(u),[h.tex.x,h.tex.y,h.bl.x,h.bl.y])),r.push(0+d*4,1+d*4,2+d*4,2+d*4,3+d*4,0+d*4)}),{vertices:n,indices:r,size:7}}var $1=function(e){(0,Or.Z)(t,e);var a=Zw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"glyphInfoMap",{}),(0,ae.Z)((0,At.Z)(n),"currentZoom",-1),(0,ae.Z)((0,At.Z)(n),"textureHeight",0),(0,ae.Z)((0,At.Z)(n),"textCount",0),(0,ae.Z)((0,At.Z)(n),"preTextStyle",{}),(0,ae.Z)((0,At.Z)(n),"buildModels",function(){var h=(0,xa.Z)(di().mark(function d(m){var b,A,P,L,B;return di().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:b=n.layer.getLayerConfig(),A=b.mask,P=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Y1,fragmentShader:X1,triangulation:q1.bind((0,At.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:_e(P,B)}).then(function(J){m([J])}).catch(function(J){console.warn(J),m([])});case 3:case"end":return j.stop()}},d)}));return function(d){return h.apply(this,arguments)}}()),(0,ae.Z)((0,At.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.stroke,d=h===void 0?"#fff":h,m=r.strokeWidth,b=m===void 0?0:m,A=r.textAnchor,P=A===void 0?"center":A,L=r.textAllowOverlap,B=L===void 0?!1:L,Z=r.halo,j=Z===void 0?.5:Z,J=r.gamma,fe=J===void 0?2:J,Ce=r.raisingHeight,Ve=Ce===void 0?0:Ce,tt=this.fontService,st=tt.canvas,Bt=tt.mapping;if(Object.keys(Bt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Bt).length),this.preTextStyle={textAnchor:P,textAllowOverlap:B},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:b,stroke:d})){this.judgeStyleAttributes({opacity:u,strokeWidth:b,stroke:d});var Xt=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Ir=cr.data,wr=cr.width,Qr=cr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Ir.length>0?this.createTexture2D({flipY:!0,data:Ir,format:Y.LUMINANCE,type:Y.FLOAT,width:wr,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Ve),u_opacity:(0,l.isNumber)(u)?u:1,u_stroke_width:(0,l.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(d),u_sdf_map:this.texture,u_halo_blur:j,u_gamma_scale:fe,u_sdf_map_size:[st.width,st.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,h=u===void 0?"center":u,d=o.textAllowOverlap,m=d===void 0?!0:d;this.preTextStyle={textAnchor:h,textAllowOverlap:m},this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:jn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.rotate,b=m===void 0?0:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:jn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[5],h[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?12:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:jn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return cl(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,d=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var P=A.shape,L=P===void 0?"":P;L=L.toString();var B=zw(L),Z;try{for(B.s();!(Z=B.n()).done;){var j=Z.value;b.indexOf(j)===-1&&b.push(j)}}catch(J){B.e(J)}finally{B.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:d,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,d=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var P=A.shape,L=P===void 0?"":P;L="".concat(L),b.indexOf(L)===-1&&b.push(L)}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:d,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,h=this.layer.getLayerConfig(),d=h.spacing,m=d===void 0?2:d,b=h.textAnchor,A=b===void 0?"center":b,P=this.layer.getEncodedData();this.glyphInfo=P.map(function(L){var B=L.shape,Z=B===void 0?"":B,j=L.id,J=L.size,fe=J===void 0?1:J,Ce=L.textOffset,Ve=Ce===void 0?[0,0]:Ce,tt=G1(Z.toString(),u,fe,A,"left",m,Ve,r),st=H1(tt,Ve,!1);return L.shaping=tt,L.glyphQuads=st,L.centroid=Wu(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?Wu(L.originCoordinates):L.originCentroid=L.centroid,o.glyphInfoMap[j]={shaping:tt,glyphQuads:st,centroid:Wu(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,h=u===void 0?[4,4]:u,d=o.textAllowOverlap,m=d===void 0?!1:d;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),A=b.width,P=b.height,L=new N1(A,P),B=this.glyphInfo.filter(function(Z){var j=Z.shaping,J=Z.id,fe=J===void 0?0:J,Ce=Z.version==="GAODE2.x"?Z.originCentroid:Z.centroid,Ve=Z.size,tt=Ve/24,st=r.mapService.lngLatToContainer(Ce),Bt=L.placeCollisionBox({x1:j.left*tt-h[0],x2:j.right*tt+h[0],y1:j.top*tt-h[1],y2:j.bottom*tt+h[1],anchorPointX:st.x,anchorPointY:st.y}),Xt=Bt.box;return Xt&&Xt.length?(L.insertCollisionBox(Xt,fe),!0):!1});B.forEach(function(Z){r.glyphInfoMap[Z.id]=Z})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:Y.LINEAR,min:Y.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText",vertexShader:Y1,fragmentShader:X1,triangulation:q1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r.layer.models=[b],r.layer.renderLayers()}).catch(function(b){console.warn(b),r.layer.models=[]})}}]),t}(ko);function jw(e){var a=Gw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hw=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Ww=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,tg=function(e){(0,Or.Z)(t,e);var a=jw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"meter2coord",1),(0,ae.Z)((0,At.Z)(n),"isMeter",!1),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,d=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,j=r.blur,J=j===void 0?0:j,fe=r.coord,Ce=fe===void 0?"lnglat":fe,Ve=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B});var tt=this.layer.getEncodedData(),st=this.calDataFrame(this.cellLength,tt,this.cellProperties),Bt=st.data,Xt=st.width,cr=st.height;this.rowCount=cr,this.dataTexture=this.cellLength>0&&Bt.length>0?this.createTexture2D({flipY:!0,data:Bt,format:Y.LUMINANCE,type:Y.FLOAT,width:Xt,height:cr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:Ve||[0,0],u_coord:Ce==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:J,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_stroke_opacity:Number(d),u_stroke_width:Number(b),u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$v)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,d=this.mapService.version;h==="meter"&&d!==Vu.L7MAP&&d!==Vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],d=r[3],m=[(o+h)/2,(u+d)/2],b=this.mapService.version;if(b===Vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),P=1,L=P*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var j=this.mapService.meterToCoord(m,[o,u]),J=this.mapService.meterToCoord(m,[h===o?h+.1:h,d===u?u+.1:d]);this.meter2coord=(j+J)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=o.workerEnabled,A=b===void 0?!1:b;this.layer.triangulation=$v,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:Ww,fragmentShader:Hw,triangulation:$v,depth:{enable:!1},cull:{enable:!0,face:sf(this.mapService.version)},blend:this.getBlend(),stencil:_e(h,m),workerEnabled:A,workerOptions:{modelType:"pointTile"}}).then(function(P){r([P])}).catch(function(P){console.warn(P),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.shape,A=b===void 0?2:b,P=r.layer.getLayerConfig().shape2d,L=P.indexOf(A);return[L]}}})}}]),t}(ko);function Xw(e){var a=Yw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$w=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,K1=function(e){(0,Or.Z)(t,e);var a=Xw(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.tileOrigin,d=r.coord,m=d===void 0?"lnglat":d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var b=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,b,this.cellProperties),P=A.data,L=A.width,B=A.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:Y.LUMINANCE,type:Y.FLOAT,width:L,height:B}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:h||[0,0],u_coord:m==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:u}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.triangulation=lm,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:$w,fragmentShader:qw,triangulation:lm,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(ko);function Kw(e){var a=Qw();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function Qw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Or.Z)(t,e);var a=Kw(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"isVector",!0),(0,ae.Z)((0,At.Z)(n),"type",n.layerType),(0,ae.Z)((0,At.Z)(n),"pickedID",null),n}return(0,Rt.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return K1;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return tg}}},{key:"getLineModel",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;switch(u){case"tileline":case"line":return iy;case"simple":return F1;default:return iy}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,h=r.find(function(m){return m.hasOwnProperty("shape")});if(h){var d=h.shape;return(u==null?void 0:u.indexOf(d))!==-1?tg:$1}else return tg}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(_d),Jw=ue(32676);function eT(e,a,t){t===void 0&&(t={});var n=Yt(e),r=Yt(a),o=Jw.union(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?en(o[0],t.properties):hi(o,t.properties)}var tT=eT;function rT(e,a){a===void 0&&(a={});var t=Yt(e);switch(!a.properties&&e.type==="Feature"&&(a.properties=e.properties),t.type){case"Polygon":return nT(t,a);case"MultiPolygon":return iT(t,a);default:throw new Error("invalid poly")}}function nT(e,a){a===void 0&&(a={});var t=Yt(e),n=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{};return Q1(n,r)}function iT(e,a){a===void 0&&(a={});var t=Yt(e),n=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(u){o.push(Q1(u,r))}),ya(o)}function Q1(e,a){return e.length>1?fi(e,a):ra(e[0],a)}var P0=function(){function e(a){(0,Ht.Z)(this,e),(0,ae.Z)(this,"outSideEventTimer",null),(0,ae.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,Rt.Z)(e,[{key:"createTile",value:function(t,n){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,n){var r={features:[],featureId:null,vectorTileLayer:null,source:null},o=n.sourceLayer,u=n.featureId,h=n.transforms,d=n.layerType,m=n.shape;if(!o)return r;var b=t.data.layers[o],A=b==null?void 0:b.features;if(Array.isArray(A)&&A.length>0){var P=[];d==="LineLayer"&&m==="simple"?A.map(function(B){if(B.geometry.type==="MultiPolygon"){var Z,j=rT(B).features;(Z=P).push.apply(Z,(0,V.Z)(j))}else B.geometry.type==="Polygon"&&(B.geometry.type="MultiLineString"),P.push(B)}):P=A;var L=new To({type:"FeatureCollection",features:P},{parser:{type:"geojson",featureId:u},transforms:h});return{features:P,featureId:u,vectorTileLayer:b,source:L}}else return r}},{key:"createLayer",value:function(t){var n=t.L7Layer,r=t.tile,o=t.initOptions,u=t.vectorTileLayer,h=t.source,d=o.mask,m=o.color,b=o.layerType,A=o.size,P=o.shape,L=n||ay,B=new L((0,Q.Z)({visible:r.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord},this.getLayerInitOption(o)));B.isVector&&(this.emitEvent([B]),B.type=b,B.select(!0)),B.source(h),this.setScale(B),this.setStyleAttributeField(B,"shape",P),this.setStyleAttributeField(B,"color",m),this.setStyleAttributeField(B,"size",A);var Z=[B];if(d&&B.isVector){var j=new O1().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");Z.push(j),B.addMaskLayer(j)}return ny(this.parentLayer,Z),this.layers=[B],B}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,n){switch(n){case"size":return 2;case"color":return"#fff";case"shape":return R1(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,n,r){if(Array.isArray(r)){t[n].apply(t,(0,V.Z)(r));return}if(typeof r=="string"){t[n](r);return}var o=this.getDefautStyleAttributeField(t,n);if(!r)return t[n](o),t;var u=this.parseScaleValue(r,n);u.length===0?t[n](o):t[n].apply(t,(0,V.Z)(u))}},{key:"parseScaleValue",value:function(t,n){if(n==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var r=t,o=r.field,u=r.values,h=r.callback;return o&&u&&Array.isArray(u)?[o,u]:o&&h?[o,h]:o?[o]:[]}},{key:"getTile",value:function(t,n){var r=this.mapService.getZoom(),o=Math.ceil(r)+this.zoomOffset,u=gc(t,n,o),h=this.tilesetManager.tiles.filter(function(m){return m.key==="".concat(u[0],",").concat(u[1],",").concat(o)}),d=h[0];return d}},{key:"emitEvent",value:function(t,n){var r=this;t.map(function(o){o.once("inited",function(){o.on("click",function(u){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var h=u.lngLat,d=h.lng,m=h.lat,b=r.getTile(d,m);r.getFeatureAndEmitEvent(o,"subLayerClick",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerClick",u)}),o.on("mousemove",function(u){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var h=u.lngLat,d=h.lng,m=h.lat,b=r.getTile(d,m);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u)}),o.on("mouseup",function(u){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(o,"subLayerMouseUp",u)}),o.on("mouseenter",function(u){if(r.parentLayer.type==="RasterLayer"){var h=u.lngLat,d=h.lng,m=h.lat,b=r.getTile(d,m);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerMouseEnter",u)}),o.on("mouseout",function(u){r.getFeatureAndEmitEvent(o,"subLayerMouseOut",u)}),o.on("mousedown",function(u){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(o,"subLayerMouseDown",u)}),o.on("contextmenu",function(u){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(o,"subLayerContextmenu",u)}),o.on("unclick",function(u){return r.handleOutsideEvent("click","subLayerUnClick",o,u)}),o.on("unmouseup",function(u){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",o,u)}),o.on("unmousedown",function(u){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",o,u)}),o.on("uncontextmenu",function(u){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",o,u)})})})}},{key:"getCombineFeature",value:function(t){var n=null,r=t[0];return t.map(function(o){var u=en(o.coordinates);n===null&&(n=u),n=tT(n,u)}),r&&(n.properties=(0,Q.Z)({},r)),n}},{key:"getFeatureAndEmitEvent",value:function(t,n,r,o,u){if(o===!1)r.value=Cw(u,this.mapService,r.x,r.y);else{var h=r.featureId,d=this.getAllFeatures(h);try{r.feature=this.getCombineFeature(d)}catch(m){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=d[0]}}this.parentLayer.emit(n,r)}},{key:"setScale",value:function(t){var n=this.parentLayer.tileLayer.scaleField,r=Object.keys(n);r.map(function(o){t.scale(o,n[o])})}},{key:"getAllFeatures",value:function(t){var n=this.parentLayer.tileLayer.children,r=[];return n.map(function(o){var u=o.getSource();u.data.dataArray.map(function(h){h._id===t&&r.push(h)})}),r}},{key:"getLayerInitOption",value:function(t){var n=(0,Q.Z)({},t);return delete n.color,delete n.shape,delete n.size,delete n.coords,delete n.sourceLayer,delete n.coords,n}},{key:"handleOutsideEvent",value:function(t,n,r,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[t]>0?u.eventCache[t]=0:u.getFeatureAndEmitEvent(r,n,o)},64)}}]),e}();function aT(e){var a=oT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sT=function(e){(0,Or.Z)(t,e);var a=aT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,d=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:d,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(P0);function uT(e){var a=lT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function lT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cT=function(e){(0,Or.Z)(t,e);var a=uT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,d=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:d,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(P0);function fT(e){var a=hT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=function(e){(0,Or.Z)(t,e);var a=fT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,d=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:d,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(P0);function dT(e){var a=vT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function vT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J1=function(e){(0,Or.Z)(t,e);var a=dT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=new To(r.data,{parser:{type:"image",extent:r.bounds}}),h=this.createLayer({L7Layer:L1,tile:r,initOptions:o,source:u});return{layers:[h],layerIDList:[h.id]}}}]),t}(P0);function mT(e){var a=gT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function gT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yT=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,_T=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Or.Z)(t,e);var a=mT(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.clampLow,d=h===void 0?!0:h,m=r.clampHigh,b=m===void 0?!0:m,A=r.noDataValue,P=A===void 0?-9999999:A,L=r.domain,B=L===void 0?[0,1]:L,Z=r.rampColors;return(0,l.isEqual)(this.rampColors,Z)||(this.updateColorTexure(),this.rampColors=Z),{u_opacity:u||1,u_texture:this.texture,u_domain:B,u_clampLow:d,u_clampHigh:typeof b!="undefined"?b:d,u_noDataValue:P,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=o.rampColorsData,A=o.rampColors,P=this.layer.getSource(),L=this.rendererService.createTexture2D,B=P.data.dataArray[0];this.texture=L({data:B.data,width:B.width,height:B.height,format:Y.LUMINANCE,type:Y.FLOAT});var Z=b||q(A);this.colorTexture=L({data:Z.data,width:Z.width,height:Z.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:_T,fragmentShader:yT,triangulation:ty,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:_e(h,m)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:h.data,width:h.width,height:h.height,flipY:!1})}}]),t}(ko);function xT(e){var a=bT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=function(e){(0,Or.Z)(t,e);var a=xT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type",n.layerType),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){return oy}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(_d);function CT(e){var a=ST();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function ST(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AT=function(e){(0,Or.Z)(t,e);var a=CT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=o.opacity,h=o.domain,d=o.clampHigh,m=o.clampLow,b=o.rampColors,A=o.rampColorsData,P=o.mask,L=r.data;if(!L.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var B=new ET({visible:r.isVisible,mask:P}).source(L.data,{parser:{type:"raster",width:L.width,height:L.height,extent:r.bboxPolygon.bbox}}).style({opacity:u,domain:h,clampHigh:d,clampLow:m,rampColors:b,rampColorsData:A});return this.emitEvent([B],!1),ny(this.parentLayer,[B]),{layers:[B],layerIDList:[B.id]}}}]),t}(P0);function wT(e){var a=TT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function TT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MT=function(e){(0,Or.Z)(t,e);var a=wT(t);function t(n){var r;return(0,Ht.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,Rt.Z)(t,[{key:"createTile",value:function(r,o){var u=o.sourceLayer;if(!u)return{layers:[],layerIDList:[]};var h=r.data.layers[u],d=h==null?void 0:h.features;if(d.length===0)return{layers:[],layerIDList:[]};var m=d[0].properties,b=new ay({layerType:"PointLayer"}).source([m],{parser:{type:"json",x:"textLng",y:"textLat"}}).shape("key","text").size(20).color("#000").style({stroke:"#fff",strokeWidth:2}),A=new ay({layerType:"LineLayer"}).source({type:"FeatureCollection",features:d}).shape("simple").color("#000");return ny(this.parentLayer,[A,b]),{layers:[A,b],layerIDList:[A.id,b.id]}}}]),t}(P0);function IT(e,a){switch(e){case"PolygonLayer":return pT;case"LineLayer":return sT;case"PointLayer":return cT;case"TileDebugLayer":return MT;case"RasterLayer":return a.dataType==="arraybuffer"?AT:J1;default:return console.warn("Current Tile Not Exist!"),J1}}function PT(e){var a=kT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function kT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LT=function(e){(0,Or.Z)(t,e);var a=PT(t);function t(){var n;return(0,Ht.Z)(this,t),n=a.call(this),(0,ae.Z)((0,At.Z)(n),"checkConfigList",[]),n.cacheConfig=new Map,n}return(0,Rt.Z)(t,[{key:"setConfig",value:function(r,o){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,o)}},{key:"removeConfig",value:function(r){var o=this.checkConfigList.indexOf(r);o>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(r){var o=this;if(!!r.inited){var u=r.getLayerConfig(),h=[];this.checkConfigList.map(function(d){var m=o.cacheConfig.get(d),b;if(["color","size","shape"].includes(d)){var A;b=(A=r.getAttribute(d))===null||A===void 0?void 0:A.scale}else{if(!(d in u))return;b=u[d]}(0,l.isEqual)(m,b)||(h.push(d),o.setConfig(d,b))}),h.length>0&&(console.warn("tile config cache update!",h),this.emit("updateConfig",h))}}},{key:"getAttributeScale",value:function(r,o){var u=r.getAttribute(o),h={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var d=u.scale,m=d.field,b=d.values,A=d.callback;h.field=m,h.values=b,h.callback=A}return h}}]),t}(Mp());function OT(e){var a=RT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function RT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DT=function(e){(0,Or.Z)(t,e);var a=OT(t);function t(n,r,o,u,h){var d;return(0,Ht.Z)(this,t),d=a.call(this),(0,ae.Z)((0,At.Z)(d),"isLastPicked",!1),d.parent=n,d.rendererService=r,d.pickingService=o,d.layerService=h,d.children=u,d}return(0,Rt.Z)(t,[{key:"normalRender",value:function(r){var o=this;r.filter(function(u){return u.inited}).filter(function(u){return u.isVisible()}).map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(h){h.hooks.beforeRenderData.call(),h.hooks.beforeRender.call(),h.render(),h.hooks.afterRender.call()})),u.render(),u.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,o){var u=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var h=r.filter(function(d){return u.parent.needPick(o.type)&&d.inited&&d.isVisible()}).some(function(d){d.hooks.beforePickingEncode.call(),d.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),d.masks.map(function(b){b.hooks.beforeRender.call(),b.render(),b.hooks.afterRender.call()})),d.renderModels(!0),d.hooks.afterPickingEncode.call();var m=u.pickingService.pickFromPickingFBO(d,o);return m&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:d}),u.pickingService.pickedTileLayers=[u.parent]),m});return this.parent.type!=="RasterLayer"&&!h&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=h,h}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(o){o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),t}(qu.EventEmitter),FT=function(){function e(a,t,n,r,o,u){(0,Ht.Z)(this,e),this.parent=a,this.children=a.layerChildren,this.mapService=t,this.rendererService=n,this.transforms=u,this.tilePickManager=new DT(a,n,r,this.children,o),this.tileConfigManager=new LT,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,Rt.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,n,r){t.map(function(o){n==="mask"?o.style({mask:r}):o.updateLayerConfig((0,ae.Z)({},n,r))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var n;(n=this.children).push.apply(n,(0,V.Z)(t))}},{key:"removeChilds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],o=[];this.children.filter(function(u){t.includes(u.id)?r.push(u):o.push(u)}),r.map(function(u){return u.destroy(n)}),this.children=o}},{key:"removeChild",value:function(t){var n=this.children.indexOf(t);n>-1&&this.children.splice(n,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(n){return t.includes(n.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(n){return n.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,n;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(n=this.tilePickManager)===null||n===void 0||n.normalRender(this.children)}},{key:"pickLayers",value:function(t){var n;return(n=this.tilePickManager)===null||n===void 0?void 0:n.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,n=this.parent.getLayerConfig(),r=n.zIndex,o=r===void 0?0:r,u=n.opacity,h=u===void 0?1:u,d=n.mask,m=d===void 0?!1:d,b=n.stroke,A=b===void 0?"#fff":b,P=n.strokeWidth,L=P===void 0?0:P,B=n.strokeOpacity,Z=B===void 0?1:B,j=n.clampLow,J=j===void 0?!0:j,fe=n.clampHigh,Ce=fe===void 0?!0:fe,Ve=n.domain,tt=Ve===void 0?[0,1]:Ve,st=n.rampColors,Bt=st===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:st,Xt=n.featureId,cr=Xt===void 0?"id":Xt,Ir=n.workerEnabled,wr=Ir===void 0?!1:Ir,Qr=n.sourceLayer,Fn=n.pixelConstant,ci=Fn===void 0?0:Fn,Ba=n.pixelConstantR,Ya=Ba===void 0?256*256:Ba,Is=n.pixelConstantG,Iu=Is===void 0?256:Is,gu=n.pixelConstantB,vf=gu===void 0?1:gu,Mv=n.pixelConstantRGB,Iv=Mv===void 0?.1:Mv,i0=this.tileConfigManager.getAttributeScale(this.parent,"color"),Z0=this.tileConfigManager.getAttributeScale(this.parent,"size"),Pv=this.parent.getSource(),V0=(Pv==null||(t=Pv.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Uy=V0.coords,Zy=Pv.getParserType(),Ji=R1(this.parent.type,this.parent);Bt&&(this.rampColorsData=q(Bt)),this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:Ji,zIndex:o,opacity:h,sourceLayer:this.getSourceLayer(Zy,Qr),coords:Uy,featureId:cr,color:i0,size:Z0,mask:bw(this.parent.type,m),stroke:A,strokeWidth:L,strokeOpacity:Z,clampLow:J,clampHigh:Ce,domain:tt,rampColors:Bt,rampColorsData:this.rampColorsData,workerEnabled:wr,pixelConstant:ci,pixelConstantR:Ya,pixelConstantG:Iu,pixelConstantB:vf,pixelConstantRGB:Iv}}},{key:"getSourceLayer",value:function(t,n){return t==="geojsonvt"?"geojsonvt":t==="testTile"?"testTile":n}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var n,r,o;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(n=this.parent.getAttribute("color"))===null||n===void 0?void 0:n.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(o=this.parent.getAttribute("size"))===null||o===void 0?void 0:o.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(h){return t.updateStyle(h),""})})}},{key:"updateStyle",value:function(t){var n=this,r=null;if(["size","color","shape"].includes(t)){var o,u=(o=this.parent.getAttribute(t))===null||o===void 0?void 0:o.scale;if(!u)return;r=u,this.children.map(function(m){return n.tileFactory.setStyleAttributeField(m,t,u),""})}else{var h=this.parent.getLayerConfig();if(!(t in h))return;var d=h[t];r=d,this.updateLayersConfig(this.children,t,d),t==="rampColors"&&d&&(this.rampColorsData=q(d))}this.initOptions[t]=r}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),n=IT(this.parent.type,t.parser);this.tileFactory=new n({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),BT=function(){function e(a){var t,n=a.parent,r=a.rendererService,o=a.mapService,u=a.layerService,h=a.pickingService,d=a.transforms;(0,Ht.Z)(this,e),(0,ae.Z)(this,"type","baseTile"),(0,ae.Z)(this,"initedTileset",!1),(0,ae.Z)(this,"pickColors",{select:null,active:null});var m=n.getSource(),b=(m==null||(t=m.data)===null||t===void 0?void 0:t.tilesetOptions)||{},A=b.sourceLayer,P=b.coords,L=b.featureId;this.sourceLayer=A,this.parent=n,this.mapService=o,this.layerService=u,this.tileLayerManager=new FT(n,o,r,h,u,d),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,Rt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(n){return n.inited&&n.isVisible()}).filter(function(n){return n.getCurrentSelectedId()!==null}).map(function(n){t.selectFeature(n,new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(n){return n.isLoaded}).map(function(n){if(n.layerIDList.length===0){var r=t.tileLayerManager.createTile(n),o=r.layers,u=r.layerIDList;n.layerIDList=u,t.tileLayerManager.addChilds(o)}else{if(!n.isVisibleChange)return;var h=t.tileLayerManager.getChilds(n.layerIDList);t.tileLayerManager.updateLayersConfig(h,"visible",n.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var n=this;if(this.pickColors.select){var r=O(this.pickColors.select);t.map(function(u){n.selectFeature(u,n.pickColors.select),u.setCurrentSelectedId(r)})}if(this.pickColors.active){var o=O(this.pickColors.active);t.filter(function(u){return u.inited&&u.isVisible()}).map(function(u){u.hooks.beforeHighlight.call(n.pickColors.active),u.setCurrentPickId(o)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(n){var r=(0,Pr.Z)(n.pickedColors,3),o=r[0],u=r[1],h=r[2];if(n.type==="click"){var d=t.children.filter(function(m){return m.inited&&m.isVisible()&&m.isVector}).filter(function(m){return m!==n.layer});t.setSelect(d,[o,u,h])}else t.setHighlight([o,u,h])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var n=O(t);this.pickColors.active=t,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==n}).map(function(r){r.setPickID(n),r.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,n){var r=this,o=O(n);t.map(function(h){h.getCurrentSelectedId()===null||o!==h.getCurrentSelectedId()?(r.selectFeature(h,n),h.setCurrentSelectedId(o),r.pickColors.select=n):(r.selectFeature(h,new Uint8Array([0,0,0,0])),h.setCurrentSelectedId(null),r.pickColors.select=null)});var u=this.layerService.getRenderList();u.filter(function(h){return h.inited&&!h.isVector&&h.isVisible()&&h.needPick("click")}).filter(function(h){return h.getCurrentSelectedId()!==null}).map(function(h){r.selectFeature(h,new Uint8Array([0,0,0,0])),h.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,n){var r=(0,Pr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeSelect.call([o,u,h])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(n){t.parent.emit("click",(0,Q.Z)({},n))}),this.parent.on("subLayerMouseMove",function(n){return t.parent.emit("mousemove",(0,Q.Z)({},n))}),this.parent.on("subLayerMouseUp",function(n){return t.parent.emit("mouseup",(0,Q.Z)({},n))}),this.parent.on("subLayerMouseEnter",function(n){return t.parent.emit("mouseenter",(0,Q.Z)({},n))}),this.parent.on("subLayerMouseOut",function(n){return t.parent.emit("mouseout",(0,Q.Z)({},n))}),this.parent.on("subLayerMouseDown",function(n){return t.parent.emit("mousedown",(0,Q.Z)({},n))}),this.parent.on("subLayerContextmenu",function(n){return t.parent.emit("contextmenu",(0,Q.Z)({},n))}),this.parent.on("subLayerUnClick",function(n){return t.parent.emit("unclick",(0,Q.Z)({},n))}),this.parent.on("subLayerUnMouseMove",function(n){return t.parent.emit("unmousemove",(0,Q.Z)({},n))}),this.parent.on("subLayerUnMouseUp",function(n){return t.parent.emit("unmouseup",(0,Q.Z)({},n))}),this.parent.on("subLayerUnMouseDown",function(n){return t.parent.emit("unmousedown",(0,Q.Z)({},n))}),this.parent.on("subLayerUnContextmenu",function(n){return t.parent.emit("uncontextmenu",(0,Q.Z)({},n))})}},{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,n=this.getCurrentView(),r=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),h=u.visible;o<3&&h?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):o>=3&&!h&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(o,r))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,r){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:n,zoom:r}}}]),e}();function NT(e){var a=zT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function zT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=function(e){(0,Or.Z)(t,e);var a=NT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","TMS"),n}return(0,Rt.Z)(t,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(o){return o.isLoaded}).map(function(o){var u;if((u=o.data)!==null&&u!==void 0&&u.layers&&r.sourceLayer){var h=o.data.layers[r.sourceLayer],d=h==null?void 0:h.features;if(!(Array.isArray(d)&&d.length>0))return}if(o.parentLayerIDList.includes(r.parent.id)){if(!o.isVisibleChange)return;var L=r.tileLayerManager.getChilds(o.layerIDList);r.tileLayerManager.updateLayersConfig(L,"visible",o.isVisible),r.setPickState(L)}else{var m,b=r.tileLayerManager.createTile(o),A=b.layers,P=b.layerIDList;o.parentLayerIDList.push(r.parent.id),(m=o.layerIDList).push.apply(m,(0,V.Z)(P)),r.tileLayerManager.addChilds(A),r.setPickState(A)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(BT);function ZT(e){var a=VT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rg=function(e){(0,Or.Z)(t,e);var a=ZT(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r=this.layer.getSource();return r!=null&&r.data.isTile&&(this.layer.tileLayer=new UT({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:r.transforms})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(ko);function jT(e){var a=GT();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function GT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HT=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,WT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,XT=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,YT=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
     return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,qT=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,$T=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,KT={solid:0,dash:1},QT=function(e){(0,Or.Z)(t,e);var a=jT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,P=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.forward,j=Z===void 0?!0:Z,J=r.lineTexture,fe=J===void 0?!1:J,Ce=r.iconStep,Ve=Ce===void 0?100:Ce,tt=r.segmentNumber,st=tt===void 0?30:tt,Bt=r.thetaOffset,Xt=Bt===void 0?.314:Bt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Xt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Xt});var cr=this.layer.getEncodedData(),Ir=this.calDataFrame(this.cellLength,cr,this.cellProperties),wr=Ir.data,Qr=Ir.width,Fn=Ir.height;this.rowCount=Fn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:Y.LUMINANCE,type:Y.FLOAT,width:Qr,height:Fn}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}B.length===2&&B.push(0,0);var ci=0,Ba=[0,0,0,0],Ya=[0,0,0,0];return h&&d&&(Ba=I(h),Ya=I(d),ci=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,l.isNumber)(Xt)?Xt:0,u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:st,u_line_type:KT[P||"solid"],u_dash_array:B,u_blur:.9,u_lineDir:j?1:-1,u_texture:this.texture,u_line_texture:fe?1:0,u_icon_step:Ve,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ci,u_sourceColor:Ba,u_targetColor:Ya}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,h=r.lineType;return h==="dash"?{frag:HT,vert:WT,type:"Dash"}:o&&u?{frag:qT,vert:$T,type:"Linear"}:{frag:XT,vert:YT,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,d=o.mask,m=d===void 0?!1:d,b=o.maskInside,A=b===void 0?!0:b,P=this.getShaders(),L=P.frag,B=P.vert,Z=P.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+Z,vertexShader:B,fragmentShader:L,triangulation:Jm,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h,stencil:_e(m,A)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,d,m){return[d[3],d[4],d[5],d[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function JT(e){var a=eM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,nM=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,iM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,aM={solid:0,dash:1},oM=function(e){(0,Or.Z)(t,e);var a=JT(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,P=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,j=Z===void 0?!1:Z,J=r.iconStep,fe=J===void 0?100:J,Ce=r.segmentNumber,Ve=Ce===void 0?30:Ce,tt=r.globalArcHeight,st=tt===void 0?10:tt;B.length===2&&B.push(0,0);var Bt=0,Xt=[0,0,0,0],cr=[0,0,0,0];if(h&&d&&(Xt=I(h),cr=I(d),Bt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Ir=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,Ir,this.cellProperties),Qr=wr.data,Fn=wr.width,ci=wr.height;this.rowCount=ci,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:Fn,height:ci}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:$g,u_global_height:st,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Ve,u_line_type:aM[P]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:j?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bt,u_sourceColor:Xt,u_targetColor:cr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:nM,vert:iM,type:"Linear"}:{frag:tM,vert:rM,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,d=o.mask,m=d===void 0?!1:d,b=o.maskInside,A=b===void 0?!0:b,P=this.getShaders(),L=P.frag,B=P.vert,Z=P.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+Z,vertexShader:B,fragmentShader:L,triangulation:Jm,blend:this.getBlend(),segmentNumber:h,stencil:_e(m,A)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,d,m){return[d[3],d[4],d[5],d[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function sM(e){var a=uM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function uM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,fM=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,hM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,pM={solid:0,dash:1},dM=function(e){(0,Or.Z)(t,e);var a=sM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,P=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,j=Z===void 0?!1:Z,J=r.iconStep,fe=J===void 0?100:J,Ce=r.segmentNumber,Ve=Ce===void 0?30:Ce,tt=r.globalArcHeight,st=tt===void 0?10:tt;B.length===2&&B.push(0,0);var Bt=0,Xt=[0,0,0,0],cr=[0,0,0,0];if(h&&d&&(Xt=I(h),cr=I(d),Bt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Ir=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,Ir,this.cellProperties),Qr=wr.data,Fn=wr.width,ci=wr.height;this.rowCount=ci,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:Fn,height:ci}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:$g,u_global_height:st,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Ve,u_line_type:pM[P]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:j?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bt,u_sourceColor:Xt,u_targetColor:cr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:fM,vert:hM,type:"Linear"}:{frag:lM,vert:cM,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,d=o.mask,m=d===void 0?!1:d,b=o.maskInside,A=b===void 0?!0:b,P=this.getShaders(),L=P.frag,B=P.vert,Z=P.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+Z,vertexShader:B,fragmentShader:L,triangulation:Jm,depth:{enable:!0},blend:this.getBlend(),segmentNumber:h,stencil:_e(m,A)}).then(function(j){r([j])}).catch(function(j){console.warn(j),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,d,m){return[d[3],d[4],d[5],d[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function vM(e){var a=mM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,yM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,_M={solid:0,dash:1},xM=function(e){(0,Or.Z)(t,e);var a=vM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,P=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,j=Z===void 0?!1:Z,J=r.iconStep,fe=J===void 0?100:J,Ce=r.segmentNumber,Ve=Ce===void 0?30:Ce;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var tt=0,st=[0,0,0,0],Bt=[0,0,0,0];if(h&&d&&(st=I(h),Bt=I(d),tt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Xt=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Ir=cr.data,wr=cr.width,Qr=cr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Ir.length>0?this.createTexture2D({flipY:!0,data:Ir,format:Y.LUMINANCE,type:Y.FLOAT,width:wr,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Ve,u_line_type:_M[P]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:j?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:tt,u_sourceColor:st,u_targetColor:Bt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:yM,fragmentShader:gM,triangulation:Jm,depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,d,m){return[d[3],d[4],d[5],d[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function bM(e){var a=EM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CM=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,SM=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,AM=function(e){(0,Or.Z)(t,e);var a=bM(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.arrow,b=m===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:m,A=0,P=[0,0,0,0],L=[0,0,0,0];if(h&&d&&(P=I(h),L=I(d),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var B=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,B,this.cellProperties),j=Z.data,J=Z.width,fe=Z.height;this.rowCount=fe,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:Y.LUMINANCE,type:Y.FLOAT,width:J,height:fe}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:P,u_targetColor:L,u_arrow:Number(b.enable),u_arrowHeight:b.arrowHeight||3,u_arrowWidth:b.arrowWidth||2,u_tailWidth:b.tailWidth===void 0?1:b.tailWidth}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){var h,d,m,b,A,P,L,B,Z,j;return di().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:h=this.layer.getLayerConfig(),d=h.mask,m=d===void 0?!1:d,b=h.maskInside,A=b===void 0?!0:b,P=h.depth,L=P===void 0?!1:P,B=this.getShaders(),Z=B.frag,j=B.vert,this.layer.triangulation=Kv,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:j,fragmentShader:Z,triangulation:Kv,depth:{enable:L},blend:this.getBlend(),stencil:_e(m,A)}).then(function(Ce){u([Ce])}).catch(function(Ce){console.warn(Ce),u([])});case 4:case"end":return fe.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:CM,vert:SM,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m,b){return b===void 0?[h[3],10,h[5]]:[h[3],b,h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:jn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,u,h,d){var m=o.coordinates[0]||[0,0],b=o.coordinates[3]||[0,0];return[m[0],m[1],b[0],b[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){return[h[4]]}}})}}]),t}(ko),ex;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(ex||(ex={}));var k0;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(k0||(k0={}));var sy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(sy||(sy={}));var tx;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(tx||(tx={}));function wM(e){var a=TM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function TM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MM=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,IM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,PM=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,rx=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,kM=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,LM={solid:0,dash:1},nx=function(e){(0,Or.Z)(t,e);var a=wM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,P=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5,0,0]:L,Z=r.lineTexture,j=Z===void 0?!1:Z,J=r.iconStep,fe=J===void 0?100:J,Ce=r.vertexHeightScale,Ve=Ce===void 0?20:Ce,tt=r.borderWidth,st=tt===void 0?0:tt,Bt=r.borderColor,Xt=Bt===void 0?"#ccc":Bt,cr=r.raisingHeight,Ir=cr===void 0?0:cr,wr=r.heightfixed,Qr=wr===void 0?!1:wr,Fn=r.linearDir,ci=Fn===void 0?k0.VERTICAL:Fn,Ba=r.blur,Ya=Ba===void 0?[1,1,1]:Ba,Is=r.arrow,Iu=Is===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Is;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gu=0,vf=[0,0,0,0],Mv=[0,0,0,0];if(h&&d&&(vf=I(h),Mv=I(d),gu=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Iv=this.layer.getEncodedData(),i0=this.calDataFrame(this.cellLength,Iv,this.cellProperties),Z0=i0.data,Pv=i0.width,V0=i0.height;this.rowCount=V0,this.dataTexture=this.cellLength>0&&Z0.length>0?this.createTexture2D({flipY:!0,data:Z0,format:Y.LUMINANCE,type:Y.FLOAT,width:Pv,height:V0}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b===sy.NORMAL?0:1,u_line_type:LM[P],u_dash_array:B,u_blur:Ya,u_texture:this.texture,u_line_texture:j?1:0,u_icon_step:fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:st,u_borderColor:I(Xt),u_linearDir:ci===k0.VERTICAL?1:0,u_linearColor:gu,u_sourceColor:vf,u_targetColor:Mv,u_heightfixed:Number(Qr),u_vertexScale:Ve,u_raisingHeight:Number(Ir),u_arrow:Number(Iu.enable),u_arrowHeight:Iu.arrowHeight||3,u_arrowWidth:Iu.arrowWidth||2,u_tailWidth:Iu.tailWidth===void 0?1:Iu.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=o.depth,A=b===void 0?!1:b,P=o.workerEnabled,L=P===void 0?!1:P,B=o.enablePicking,Z=this.getShaders(),j=Z.frag,J=Z.vert,fe=Z.type;this.layer.triangulation=Rh,this.layer.buildLayerModel({moduleName:"line"+fe,vertexShader:J,fragmentShader:j,triangulation:Rh,depth:{enable:A},blend:this.getBlend(),stencil:_e(h,m),workerEnabled:L,workerOptions:{modelType:"line"+fe,enablePicking:B,iconMap:this.iconService.getIconMap()}}).then(function(Ce){r([Ce])}).catch(function(Ce){console.warn(Ce),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,h=r.lineType;return h==="dash"?{frag:MM,vert:IM,type:"Dash"}:o&&u?{frag:kM,vert:rx,type:"Linear"}:{frag:PM,vert:rx,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m,b,A){return A===void 0?[d[3],10]:[d[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function OM(e){var a=RM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function RM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DM=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,FM=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,BM=function(e){(0,Or.Z)(t,e);var a=OM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var d=n.layer.getLayerConfig(),m=d.rampColors,b=q(m);n.colorTexture=h({data:new Uint8Array(b.data),width:b.width,height:b.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.vertexHeightScale,d=h===void 0?20:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.heightfixed,P=A===void 0?!1:A,L=r.linearDir,B=L===void 0?k0.VERTICAL:L;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Z=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,Z,this.cellProperties),J=j.data,fe=j.width,Ce=j.height;this.rowCount=Ce,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:Y.LUMINANCE,type:Y.FLOAT,width:fe,height:Ce}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:B===k0.VERTICAL?1:0,u_opacity:(0,l.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(P),u_vertexScale:d,u_raisingHeight:Number(b)}}},{key:"initModels",value:function(r){this.updateTexture(),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=o.depth,A=b===void 0?!1:b;this.layer.triangulation=Kv,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:FM,fragmentShader:DM,triangulation:Kv,depth:{enable:A},blend:this.getBlend(),stencil:_e(h,m)}).then(function(P){r([P])}).catch(function(P){console.warn(P),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:jn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d,m,b){return b===void 0?[h[3],10]:[h[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){return[h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){return[h[4]]}}})}}]),t}(ko);function NM(e){var a=zM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function zM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UM=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZM=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,VM=function(e){(0,Or.Z)(t,e);var a=NM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,d=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.heightfixed,P=A===void 0?!1:A,L=r.lineTexture,B=L===void 0?!1:L,Z=r.iconStep,j=Z===void 0?100:Z,J=r.iconStepCount,fe=J===void 0?1:J;this.rendererService.getDirty()&&this.texture.bind();var Ce=0,Ve=[0,0,0,0],tt=[0,0,0,0];if(h&&d&&(Ve=I(h),tt=I(d),Ce=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var st=this.layer.getEncodedData(),Bt=this.calDataFrame(this.cellLength,st,this.cellProperties),Xt=Bt.data,cr=Bt.width,Ir=Bt.height;this.rowCount=Ir,this.dataTexture=this.cellLength>0&&Xt.length>0?this.createTexture2D({flipY:!0,data:Xt,format:Y.LUMINANCE,type:Y.FLOAT,width:cr,height:Ir}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,u_texture:this.texture,u_line_texture:B?1:0,u_iconStepCount:fe,u_icon_step:j,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ce,u_sourceColor:Ve,u_targetColor:tt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:ZM,fragmentShader:UM,triangulation:Kv,depth:{enable:!1},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:jn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){return[d[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.texture,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko),jM={arc:QT,arc3d:oM,greatcircle:xM,wall:VM,line:nx,halfLine:AM,simple:F1,linearline:BM,vectorline:rg,tileLine:iy,earthArc3d:dM},GM=jM;function HM(e){var a=WM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function WM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XM=function(e){(0,Or.Z)(t,e);var a=HM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","LineLayer"),(0,ae.Z)((0,At.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new GM[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;var o=this.layerSource.getParserType();if(ry(o))return"vectorline";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),h=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return h||"line"}}]),t}(_d);function YM(e){var a=qM();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function qM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $M=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,QM=function(e){(0,Or.Z)(t,e);var a=YM(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"raiseCount",0),(0,ae.Z)((0,At.Z)(n),"raiserepeat",0),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,h=r.opacity,d=h===void 0?1:h,m=r.sourceColor,b=r.targetColor,A=r.pickLight,P=A===void 0?!1:A,L=r.heightfixed,B=L===void 0?!1:L,Z=r.opacityLinear,j=Z===void 0?{enable:!1,dir:"up"}:Z,J=r.lightEnable,fe=J===void 0?!0:J;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ce=this.layer.getEncodedData(),Ve=this.calDataFrame(this.cellLength,Ce,this.cellProperties),tt=Ve.data,st=Ve.width,Bt=Ve.height;this.rowCount=Bt,this.dataTexture=this.cellLength>0&&tt.length>0?this.createTexture2D({flipY:!0,data:tt,format:Y.LUMINANCE,type:Y.FLOAT,width:st,height:Bt}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var Xt=0,cr=[0,0,0,0],Ir=[0,0,0,0];if(m&&b&&(cr=I(m),Ir=I(b),Xt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var wr=u.speed,Qr=wr===void 0?.01:wr,Fn=u.repeat,ci=Fn===void 0?!1:Fn;this.raiseCount+=Qr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(P),u_heightfixed:Number(B),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(d)?d:1,u_linearColor:Xt,u_sourceColor:cr,u_targetColor:Ir,u_opacitylinear:Number(j.enable),u_opacitylinear_dir:j.dir==="up"?1:0,u_lightEnable:Number(fe)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,h=u===void 0?1:u;this.raiserepeat=h,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:KM,fragmentShader:$M,triangulation:Jg,depth:{enable:!0},cull:{enable:!0,face:sf(this.mapService.version)},blend:this.getBlend()}).then(function(d){r([d])}).catch(function(d){console.warn(d),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d){var m=o.size;if(m){var b=[];return Array.isArray(m)&&(b=m.length===2?[m[0],m[0],m[1]]:m),Array.isArray(m)||(b=[m,m,m]),b}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=Wu(o.coordinates);return g1([h[0],h[1]])}}})}}]),t}(ko);function JM(e){var a=e5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,r5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,n5=function(e){(0,Or.Z)(t,e);var a=JM(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,d=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,j=r.blur,J=j===void 0?0:j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B});var fe=this.layer.getEncodedData(),Ce=this.calDataFrame(this.cellLength,fe,this.cellProperties),Ve=Ce.data,tt=Ce.width,st=Ce.height;this.rowCount=st,this.dataTexture=this.cellLength>0&&Ve.length>0?this.createTexture2D({flipY:!0,data:Ve,format:Y.LUMINANCE,type:Y.FLOAT,width:tt,height:st}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_blur:J,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_stroke_opacity:(0,l.isNumber)(d)?d:1,u_stroke_width:(0,l.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.triangulation=S1,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:r5,fragmentShader:t5,triangulation:S1,depth:{enable:!0},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m){var b=(0,Pr.Z)(d,3),A=b[0],P=b[1],L=b[2],B=Qo.fromValues(0,0,1),Z=Qo.fromValues(A,0,L),j=A>=0?Qo.angle(B,Z):Math.PI*2-Qo.angle(B,Z),J=Math.PI*2-Math.asin(P/100),fe=Xc();Dd(fe,fe,j),zh(fe,fe,J);var Ce=Qo.fromValues(1,1,0);Qo.transformMat4(Ce,Ce,fe),Qo.normalize(Ce,Ce);var Ve=Qo.fromValues(-1,1,0);Qo.transformMat4(Ve,Ve,fe),Qo.normalize(Ve,Ve);var tt=Qo.fromValues(-1,-1,0);Qo.transformMat4(tt,tt,fe),Qo.normalize(tt,tt);var st=Qo.fromValues(1,-1,0);Qo.transformMat4(st,st,fe),Qo.normalize(st,st);var Bt=[].concat((0,V.Z)(Ce),(0,V.Z)(Ve),(0,V.Z)(tt),(0,V.Z)(st)),Xt=m%4*3;return[Bt[Xt],Bt[Xt+1],Bt[Xt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.shape,A=b===void 0?2:b,P=r.layer.getLayerConfig().shape2d,L=P.indexOf(A);return[L]}}})}}]),t}(ko);function i5(e){var a=a5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,s5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,ix=function(e){(0,Or.Z)(t,e);var a=i5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"raiseCount",0),(0,ae.Z)((0,At.Z)(n),"raiserepeat",0),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,h=r.opacity,d=h===void 0?1:h,m=r.sourceColor,b=r.targetColor,A=r.pickLight,P=A===void 0?!1:A,L=r.heightfixed,B=L===void 0?!1:L,Z=r.opacityLinear,j=Z===void 0?{enable:!1,dir:"up"}:Z,J=r.lightEnable,fe=J===void 0?!0:J;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ce=this.layer.getEncodedData(),Ve=this.calDataFrame(this.cellLength,Ce,this.cellProperties),tt=Ve.data,st=Ve.width,Bt=Ve.height;this.rowCount=Bt,this.dataTexture=this.cellLength>0&&tt.length>0?this.createTexture2D({flipY:!0,data:tt,format:Y.LUMINANCE,type:Y.FLOAT,width:st,height:Bt}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var Xt=0,cr=[0,0,0,0],Ir=[0,0,0,0];if(m&&b&&(cr=I(m),Ir=I(b),Xt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var wr=u.speed,Qr=wr===void 0?.01:wr,Fn=u.repeat,ci=Fn===void 0?!1:Fn;this.raiseCount+=Qr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(P),u_heightfixed:Number(B),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(d)?d:1,u_linearColor:Xt,u_sourceColor:cr,u_targetColor:Ir,u_opacitylinear:Number(j.enable),u_opacitylinear_dir:j.dir==="up"?1:0,u_lightEnable:Number(fe)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){var h,d,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:h=this.layer.getLayerConfig(),d=h.depth,m=d===void 0?!0:d,b=h.animateOption.repeat,A=b===void 0?1:b,this.raiserepeat=A,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:s5,fragmentShader:o5,triangulation:Jg,blend:this.getBlend(),cull:{enable:!0,face:sf(this.mapService.version)},depth:{enable:m}}).then(function(B){u([B])}).catch(function(B){console.warn(B),u([])});case 3:case"end":return L.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d){var m=o.size;if(m){var b=[];return Array.isArray(m)&&(b=m.length===2?[m[0],m[0],m[1]]:m),Array.isArray(m)||(b=[m,m,m]),b}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,d,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=Wu(o.coordinates);return[h[0],h[1],0]}}})}}]),t}(ko);function u5(e){var a=l5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ax=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,c5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,uy=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ox=function(e){(0,Or.Z)(t,e);var a=u5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"meter2coord",1),(0,ae.Z)((0,At.Z)(n),"meteryScale",1),(0,ae.Z)((0,At.Z)(n),"isMeter",!1),(0,ae.Z)((0,At.Z)(n),"unit","l7size"),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,d=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,j=r.blur,J=j===void 0?0:j,fe=r.raisingHeight,Ce=fe===void 0?0:fe,Ve=r.heightfixed,tt=Ve===void 0?!1:Ve,st=r.unit,Bt=st===void 0?"l7size":st;if(this.updateUnit(Bt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:d,strokeWidth:b,stroke:P,offsets:B});var Xt=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Ir=cr.data,wr=cr.width,Qr=cr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Ir.length>0?this.createTexture2D({flipY:!0,data:Ir,format:Y.LUMINANCE,type:Y.FLOAT,width:wr,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Ce),u_heightfixed:Number(tt),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:J,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_stroke_opacity:(0,l.isNumber)(d)?d:1,u_stroke_width:(0,l.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),pc)}},{key:"initModels",value:function(r){this.updateUnit("l7size"),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],d=r[3],m=[(o+h)/2,(u+d)/2],b=this.mapService.version,A=Ui==null?void 0:Ui.mapboxgl;if(b===Vu.MAPBOX&&A!==null&&A!==void 0&&A.MercatorCoordinate){var P=A.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),L=P.meterInMercatorCoordinateUnits(),B=new A.MercatorCoordinate(P.x-L,P.y,P.z),Z=B.toLngLat(),j=new A.MercatorCoordinate(P.x,P.y-L,P.z),J=j.toLngLat();this.meter2coord=m[0]-Z.lng,this.meteryScale=(J.lat-m[1])/this.meter2coord;return}var fe=this.mapService.meterToCoord(m,[o,u]),Ce=this.mapService.meterToCoord(m,[h===o?h+.1:h,d===u?u+.1:d]);this.meter2coord=(fe+Ce)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,xa.Z)(di().mark(function o(u){var h,d,m,b,A,P,L,B,Z,j,J,fe,Ce,Ve,tt;return di().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:h=this.layer.getLayerConfig(),d=h.mask,m=d===void 0?!1:d,b=h.maskInside,A=b===void 0?!0:b,P=h.animateOption,L=P===void 0?{enable:!1}:P,B=h.workerEnabled,Z=B===void 0?!1:B,j=h.enablePicking,J=h.shape2d,fe=this.getShaders(L),Ce=fe.frag,Ve=fe.vert,tt=fe.type,this.layer.triangulation=pc,this.layer.buildLayerModel({moduleName:tt,vertexShader:Ve,fragmentShader:Ce,triangulation:pc,depth:{enable:!1},blend:this.getBlend(),stencil:_e(m,A),workerEnabled:Z,workerOptions:{modelType:tt,enablePicking:j,shape2d:J}}).then(function(Xt){u([Xt])}).catch(function(Xt){console.warn(Xt),u([])});case 4:case"end":return Bt.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:ax,vert:uy,type:"pointWave"};default:return{frag:ax,vert:uy,type:"pointWave"}}else return{frag:c5,vert:uy,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.shape,A=b===void 0?2:b,P=r.indexOf(A);return[P]}}})}},{key:"updateUnit",value:function(r){var o=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&o!==Vu.L7MAP&&o!==Vu.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),t}(ko);function f5(e){var a=h5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,d5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,v5=function(e){(0,Or.Z)(t,e);var a=f5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"meter2coord",1),(0,ae.Z)((0,At.Z)(n),"isMeter",!1),(0,ae.Z)((0,At.Z)(n),"radian",0),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,d=h===void 0?[0,0]:h,m=r.rotation,b=r.raisingHeight,A=b===void 0?0:b,P=r.heightfixed,L=P===void 0?!1:P;this.rendererService.getDirty()&&this.texture.bind();var B=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(B=-1),this.radian=m!==void 0?B*Math.PI*m/180:B*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:d})){this.judgeStyleAttributes({opacity:u,offsets:d});var Z=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,Z,this.cellProperties),J=j.data,fe=j.width,Ce=j.height;this.rowCount=Ce,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:Y.LUMINANCE,type:Y.FLOAT,width:fe,height:Ce}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(A),u_heightfixed:Number(L),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,l.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(d)?d:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$v)}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,d=this.mapService.version;h==="meter"&&d!==Vu.L7MAP&&d!==Vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],d=r[3],m=[(o+h)/2,(u+d)/2],b=this.mapService.version;if(b===Vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),P=1,L=P*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var j=this.mapService.meterToCoord(m,[o,u]),J=this.mapService.meterToCoord(m,[h===o?h+.1:h,d===u?u+.1:d]);this.meter2coord=(j+J)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:d5,fragmentShader:p5,triangulation:$v,depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m),cull:{enable:!0,face:sf(this.mapService.version)}}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:jn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.rotate,A=b===void 0?0:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.shape,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}})}}]),t}(ko);function m5(e){var a=g5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function g5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,_5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,sx=function(e){(0,Or.Z)(t,e);var a=m5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,d=h===void 0?[0,0]:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.heightfixed,P=A===void 0?!1:A;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:d})){this.judgeStyleAttributes({opacity:u,offsets:d});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),Z=B.data,j=B.width,J=B.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&Z.length>0?this.createTexture2D({flipY:!0,data:Z,format:Y.LUMINANCE,type:Y.FLOAT,width:j,height:J}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(b),u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,l.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(d)?d:[0,0]}}},{key:"initModels",value:function(r){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:_5,fragmentShader:y5,triangulation:oA,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,d,m){var b=r.iconService.getIconMap(),A=u.shape,P=b[A]||{x:0,y:0},L=P.x,B=P.y;return[L,B]}}})}}]),t}(ko);function x5(e){var a=b5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function b5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,C5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function ux(e){var a=e.coordinates;return{vertices:(0,V.Z)(a),indices:[0],size:a.length}}var lx=function(e){(0,Or.Z)(t,e);var a=x5(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,d=h===void 0?[0,0]:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:d})){this.judgeStyleAttributes({opacity:u,offsets:d});var m=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,m,this.cellProperties),A=b.data,P=b.width,L=b.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:Y.LUMINANCE,type:Y.FLOAT,width:P,height:L}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(d)?d:[0,0]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.triangulation=ux,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:C5,fragmentShader:E5,triangulation:ux,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0]]:[b]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:jh.additive}}}]),t}(ko);function S5(e){var a=A5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function A5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,T5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,M5=function(e){(0,Or.Z)(t,e);var a=S5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"meter2coord",1),(0,ae.Z)((0,At.Z)(n),"isMeter",!1),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,d=h===void 0?[0,0]:h,m=r.blend,b=r.speed,A=b===void 0?1:b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:d})){this.judgeStyleAttributes({opacity:u,offsets:d});var P=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,P,this.cellProperties),B=L.data,Z=L.width,j=L.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:Y.LUMINANCE,type:Y.FLOAT,width:Z,height:j}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:A,u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(d)?d:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$v)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,d=this.mapService.version;h==="meter"&&d!==Vu.L7MAP&&d!==Vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Pr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],d=r[3],m=[(o+h)/2,(u+d)/2],b=this.mapService.version;if(b===Vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),P=1,L=P*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var j=this.mapService.meterToCoord(m,[o,u]),J=this.mapService.meterToCoord(m,[h===o?h+.1:h,d===u?u+.1:d]);this.meter2coord=(j+J)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:T5,fragmentShader:w5,triangulation:$v,depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,d,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:jn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,d,m){var b=u.shape,A=b===void 0?2:b,P=r.layer.getLayerConfig().shape2d,L=P.indexOf(A);return[L]}}})}}]),t}(ko);function I5(e){var a=P5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function P5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,L5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function cx(e){var a=e.coordinates;return{vertices:(0,V.Z)(a),indices:[0],size:a.length}}var O5=function(e){(0,Or.Z)(t,e);var a=I5(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,d=h===void 0?[0,0]:h,m=r.blend,b=r.strokeOpacity,A=b===void 0?1:b,P=r.strokeWidth,L=P===void 0?0:P,B=r.stroke,Z=B===void 0?"#fff":B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:d})){this.judgeStyleAttributes({opacity:u,offsets:d});var j=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,j,this.cellProperties),fe=J.data,Ce=J.width,Ve=J.height;this.rowCount=Ve,this.dataTexture=this.cellLength>0&&fe.length>0?this.createTexture2D({flipY:!0,data:fe,format:Y.LUMINANCE,type:Y.FLOAT,width:Ce,height:Ve}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(d)?d:[0,0],u_stroke_opacity:(0,l.isNumber)(A)?A:1,u_stroke_width:(0,l.isNumber)(L)?L:1,u_stroke_color:this.getStrokeColor(Z)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.triangulation=cx,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:L5,fragmentShader:k5,triangulation:cx,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0]]:[b]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:jh.additive}}}]),t}(ko);function R5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=D5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function D5(e,a){if(!!e){if(typeof e=="string")return fx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fx(e,a)}}function fx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function F5(e){var a=B5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function B5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,px=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function dx(e){var a=this,t=e.id,n=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(h,d){n.push.apply(n,(0,V.Z)(u).concat([h.tex.x,h.tex.y+h.tex.height,h.tl.x,h.tl.y],(0,V.Z)(u),[h.tex.x+h.tex.width,h.tex.y+h.tex.height,h.tr.x,h.tr.y],(0,V.Z)(u),[h.tex.x+h.tex.width,h.tex.y,h.br.x,h.br.y],(0,V.Z)(u),[h.tex.x,h.tex.y,h.bl.x,h.bl.y])),r.push(0+d*4,1+d*4,2+d*4,2+d*4,3+d*4,0+d*4)}),{vertices:n,indices:r,size:7}}var vx=function(e){(0,Or.Z)(t,e);var a=F5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"glyphInfoMap",{}),(0,ae.Z)((0,At.Z)(n),"currentZoom",-1),(0,ae.Z)((0,At.Z)(n),"textureHeight",0),(0,ae.Z)((0,At.Z)(n),"textCount",0),(0,ae.Z)((0,At.Z)(n),"preTextStyle",{}),(0,ae.Z)((0,At.Z)(n),"buildModels",function(){var h=(0,xa.Z)(di().mark(function d(m){var b,A,P,L,B;return di().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:b=n.layer.getLayerConfig(),A=b.mask,P=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:px,fragmentShader:hx,triangulation:dx.bind((0,At.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:_e(P,B)}).then(function(J){m([J])}).catch(function(J){console.warn(J),m([])});case 3:case"end":return j.stop()}},d)}));return function(d){return h.apply(this,arguments)}}()),(0,ae.Z)((0,At.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.stroke,d=h===void 0?"#fff":h,m=r.strokeWidth,b=m===void 0?0:m,A=r.textAnchor,P=A===void 0?"center":A,L=r.textAllowOverlap,B=L===void 0?!1:L,Z=r.halo,j=Z===void 0?.5:Z,J=r.gamma,fe=J===void 0?2:J,Ce=r.raisingHeight,Ve=Ce===void 0?0:Ce,tt=this.fontService,st=tt.canvas,Bt=tt.mapping;if(Object.keys(Bt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Bt).length),this.preTextStyle={textAnchor:P,textAllowOverlap:B},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:b,stroke:d})){this.judgeStyleAttributes({opacity:u,strokeWidth:b,stroke:d});var Xt=this.layer.getEncodedData(),cr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),Ir=cr.data,wr=cr.width,Qr=cr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Ir.length>0?this.createTexture2D({flipY:!0,data:Ir,format:Y.LUMINANCE,type:Y.FLOAT,width:wr,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Ve),u_opacity:(0,l.isNumber)(u)?u:1,u_stroke_width:(0,l.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(d),u_sdf_map:this.texture,u_halo_blur:j,u_gamma_scale:fe,u_sdf_map_size:[st.width,st.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,h=u===void 0?"center":u,d=o.textAllowOverlap,m=d===void 0?!0:d;this.preTextStyle={textAnchor:h,textAllowOverlap:m},this.buildModels(r)}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),o=r.textAllowOverlap,u=o===void 0?!1:o,h=this.mapService.getZoom(),d=this.mapService.getBounds(),m=oc(this.extent,d);return!u&&(Math.abs(this.currentZoom-h)>1||!m)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:jn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.rotate,b=m===void 0?0:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:jn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[5],h[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,d){var m=o.size,b=m===void 0?12:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:jn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,d){return[h[3],h[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return cl(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,d=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var P=A.shape,L=P===void 0?"":P;L=L.toString();var B=R5(L),Z;try{for(B.s();!(Z=B.n()).done;){var j=Z.value;b.indexOf(j)===-1&&b.push(j)}}catch(J){B.e(J)}finally{B.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:d,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,d=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var P=A.shape,L=P===void 0?"":P;L="".concat(L),b.indexOf(L)===-1&&b.push(L)}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:d,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,h=this.layer.getLayerConfig(),d=h.spacing,m=d===void 0?2:d,b=h.textAnchor,A=b===void 0?"center":b,P=this.layer.getEncodedData();this.glyphInfo=P.map(function(L){var B=L.shape,Z=B===void 0?"":B,j=L.id,J=L.size,fe=J===void 0?1:J,Ce=L.textOffset,Ve=Ce===void 0?[0,0]:Ce,tt=G1(Z.toString(),u,fe,A,"left",m,Ve,r),st=H1(tt,Ve,!1);return L.shaping=tt,L.glyphQuads=st,L.centroid=Wu(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?Wu(L.originCoordinates):L.originCentroid=L.centroid,o.glyphInfoMap[j]={shaping:tt,glyphQuads:st,centroid:Wu(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,h=u===void 0?[4,4]:u,d=o.textAllowOverlap,m=d===void 0?!1:d;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),A=b.width,P=b.height,L=new N1(A,P),B=this.glyphInfo.filter(function(Z){var j=Z.shaping,J=Z.id,fe=J===void 0?0:J,Ce=Z.version==="GAODE2.x"?Z.originCentroid:Z.centroid,Ve=Z.size,tt=Ve/24,st=r.mapService.lngLatToContainer(Ce),Bt=L.placeCollisionBox({x1:j.left*tt-h[0],x2:j.right*tt+h[0],y1:j.top*tt-h[1],y2:j.bottom*tt+h[1],anchorPointX:st.x,anchorPointY:st.y}),Xt=Bt.box;return Xt&&Xt.length?(L.insertCollisionBox(Xt,fe),!0):!1});B.forEach(function(Z){r.glyphInfoMap[Z.id]=Z})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:Y.LINEAR,min:Y.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:px,fragmentShader:hx,triangulation:dx.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:_e(h,m)}).then(function(b){r.layer.models=[b],r.layer.renderLayers()}).catch(function(b){console.warn(b),r.layer.models=[]})}}]),t}(ko),N5={fillImage:v5,fill:ox,radar:M5,image:sx,normal:lx,simplePoint:O5,extrude:ix,text:vx,vectorpoint:rg,tile:tg,tileText:$1,earthFill:n5,earthExtrude:QM},z5=N5;function U5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Z5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Z5(e,a){if(!!e){if(typeof e=="string")return mx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mx(e,a)}}function mx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function V5(e){var a=j5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function j5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G5=function(e){(0,Or.Z)(t,e);var a=V5(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","PointLayer"),(0,ae.Z)((0,At.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new z5[o](this),this.layerModel.initModels(function(u){r.models=u,r.layerService.updateLayerRenderList(),r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,h=this.getLayerConfig(),d=h.shape2d,m=this.iconService.getIconMap();if(o&&(d==null?void 0:d.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var b=U5(u),A;try{for(b.s();!(A=b.n()).done;){var P=A.value;if(typeof P=="string"&&m.hasOwnProperty(P))return"image"}}catch(L){b.e(L)}finally{b.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();if(ry(r))return"vectorpoint";var o=this.getEncodedData(),u=this.getLayerConfig(),h=u.shape2d,d=u.shape3d,m=this.iconService.getIconMap(),b=o.find(function(P){return P.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(h==null?void 0:h.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(d==null?void 0:d.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":m.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(_d);function H5(e){var a=W5();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function W5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Y5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,q5=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,K5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Q5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,J5=function(e){(0,Or.Z)(t,e);var a=H5(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.heightfixed,d=h===void 0?!1:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.topsurface,P=A===void 0?!0:A,L=r.sidesurface,B=L===void 0?!0:L,Z=r.sourceColor,j=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var J=this.layer.getEncodedData(),fe=this.calDataFrame(this.cellLength,J,this.cellProperties),Ce=fe.data,Ve=fe.width,tt=fe.height;this.rowCount=tt,this.dataTexture=this.cellLength>0&&Ce.length>0?this.createTexture2D({flipY:!0,data:Ce,format:Y.LUMINANCE,type:Y.FLOAT,width:Ve,height:tt}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var st=0,Bt=[1,1,1,1],Xt=[1,1,1,1];return Z&&j&&(Bt=I(Z),Xt=I(j),st=1),{u_topsurface:Number(P),u_sidesurface:Number(B),u_heightfixed:Number(d),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(b),u_opacity:(0,l.isNumber)(u)?u:1,u_linearColor:st,u_sourceColor:Bt,u_targetColor:Xt,u_texture:this.texture}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d,b=this.getShaders(),A=b.frag,P=b.vert,L=b.type;this.layer.buildLayerModel({moduleName:L,vertexShader:P,fragmentShader:A,triangulation:w1,stencil:_e(h,m)}).then(function(B){r([B])}).catch(function(B){console.warn(B),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:q5,vert:$5,type:"polygonExtrudeTexture"}:o?{frag:K5,vert:Q5,type:"polygonExtrudePickLight"}:{frag:X5,vert:Y5,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],h=o[1],d=o[2],m=o[3],b=d-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:jn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(L,B,Z,j,J){var fe=Z[0],Ce=Z[1];return[(fe-u)/b,(Ce-h)/A,Z[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(L,B,Z,j,J){return J}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(L,B,Z,j){var J=L.size,fe=J===void 0?10:J;return Array.isArray(fe)?[fe[0]]:[fe]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,h=this.rendererService.createTexture2D;if(this.texture=h({height:0,width:0}),u){var d=new Image;d.crossOrigin="",d.src=u,d.onload=function(){r.texture=h({data:d,width:d.width,height:d.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),t}(ko);function e3(e){var a=t3();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function t3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r3=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,n3=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,i3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,a3=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,o3=function(e){(0,Or.Z)(t,e);var a=e3(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,h=r.opacity,d=h===void 0?1:h,m=r.opacityLinear,b=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var A=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,A,this.cellProperties),L=P.data,B=P.width,Z=P.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:Y.LUMINANCE,type:Y.FLOAT,width:B,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,l.isNumber)(d)?d:1,u_opacitylinear:Number(b.enable),u_dir:b.dir==="in"?1:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.getModelParams(),u=o.frag,h=o.vert,d=o.triangulation,m=o.type,b=this.layer.getLayerConfig(),A=b.mask,P=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,Z=b.workerEnabled,j=Z===void 0?!1:Z,J=b.enablePicking;this.layer.triangulation=d,this.layer.buildLayerModel({moduleName:m,vertexShader:h,fragmentShader:u,triangulation:d,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:_e(P,B),workerEnabled:j,workerOptions:{modelType:m,enablePicking:J}}).then(function(fe){r([fe])}).catch(function(fe){console.warn(fe),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:jn.Attribute,descriptor:{name:"a_linear",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(d,m,b,A,P){return[b[3],b[4],b[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:n3,vert:i3,type:"polygonLinear",triangulation:lA}:{frag:r3,vert:a3,type:"polygonFill",triangulation:ch}}}]),t}(ko);function s3(e){var a=u3();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function u3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l3=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,c3=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,f3=function(e){(0,Or.Z)(t,e);var a=s3(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.watercolor,d=h===void 0?"#6D99A8":h,m=r.watercolor2,b=m===void 0?"#0F121C":m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var A=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,A,this.cellProperties),L=P.data,B=P.width,Z=P.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:Y.LUMINANCE,type:Y.FLOAT,width:B,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:I(d),u_watercolor2:I(b),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,l.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:c3,fragmentShader:l3,triangulation:lm,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o,u,h;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy(),(h=this.dataTexture)===null||h===void 0||h.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],h=o[1],d=o[2],m=o[3],b=d-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:jn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(L,B,Z,j,J){var fe=(0,Pr.Z)(Z,2),Ce=fe[0],Ve=fe[1];return[(Ce-u)/b,(Ve-h)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),h(function(m){r.texture1=d(m[0]),r.texture2=d(m[1]),r.texture3=d(m[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function h(m){var b=0,A=[],P=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];P.map(function(L){var B=new Image;B.crossOrigin="",B.src=L,A.push(B),B.onload=function(){b++,b===3&&m(A)}})}function d(m){return o({data:m,width:m.width,height:m.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR})}}}]),t}(ko);function h3(e){var a=p3();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function p3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d3=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,v3=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,m3=function(e){(0,Or.Z)(t,e);var a=h3(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.speed,d=h===void 0?.5:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var m=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,m,this.cellProperties),A=b.data,P=b.width,L=b.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:Y.LUMINANCE,type:Y.FLOAT,width:P,height:L}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:d,u_opacity:(0,l.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,d=o.maskInside,m=d===void 0?!0:d;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:v3,fragmentShader:d3,triangulation:lm,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:_e(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Pr.Z)(r,4),u=o[0],h=o[1],d=o[2],m=o[3],b=d-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:jn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(L,B,Z,j,J){var fe=(0,Pr.Z)(Z,2),Ce=fe[0],Ve=fe[1];return[(Ce-u)/b,(Ve-h)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0});var d=new Image;d.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),d.src=u):d.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",d.onload=function(){r.texture=h({data:d,width:d.width,height:d.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),t}(ko),g3={fill:o3,line:nx,extrude:J5,text:vx,point_fill:ox,point_image:sx,point_normal:lx,point_extrude:ix,water:m3,ocean:f3,vectorpolygon:rg,tile:K1},y3=g3;function _3(e){var a=x3();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function x3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gx=function(e){(0,Or.Z)(t,e);var a=_3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","PolygonLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new y3[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.layerSource.getParserType();if(ry(o))return"vectorpolygon";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),h=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return h==="fill"?"fill":h==="extrude"?"extrude":h==="water"?"water":h==="ocean"?"ocean":h==="line"?"line":h==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,h=o.shape3d,d=this.iconService.getIconMap(),m=r.find(function(A){return A.hasOwnProperty("shape")});if(m){var b=m.shape;return b==="dot"?"point_normal":(u==null?void 0:u.indexOf(b))!==-1?"point_fill":(h==null?void 0:h.indexOf(b))!==-1?"point_extrude":d.hasOwnProperty(b)?"point_image":"text"}else return"fill"}}]),t}(_d),b3={raster:oy,raster3d:oy,rasterTile:rg},E3=b3;function C3(e){var a=S3();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=function(e){(0,Or.Z)(t,e);var a=C3(t);function t(){var n;(0,Ht.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,ae.Z)((0,At.Z)(n),"type","RasterLayer"),n}return(0,Rt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new E3[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},raster3d:{},rasterTile:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();switch(r){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(_d),yx,_x,xx,bx,Ex,cm,Cx,Sx,Ax,w3=(yx=(0,$r.b2)(),_x=(0,$r.f3)(rr.IGlobalConfigService),xx=(0,$r.f3)(rr.IMapService),bx=(0,$r.f3)(rr.IFontService),yx(Ex=(cm=function(){function e(){(0,Ht.Z)(this,e),ga(this,"configService",Cx,this),ga(this,"mapService",Sx,this),ga(this,"fontService",Ax,this)}return(0,Rt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var u=t.getSource();u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var u=t.getSource();return u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var h=t.getBottomColor(),d=o.getLayerStyleAttributes()||[],m=o.getLayerStyleAttribute("filter"),b=u.data.dataArray,A=d.filter(function(L){return L.needRemapping}),P=b;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(P=b.filter(function(L){return r.applyAttributeMapping(m,L,h)[0]})),A.length&&(m!=null&&m.needRemapping?(t.setEncodedData(r.mapping(t,d,P,void 0,h)),m.needRemapping=!1):t.setEncodedData(r.mapping(t,A,P,t.getEncodedData(),h)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,n){var r=this,o=n.styleAttributeService,u=t.getBottomColor(),h=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),m=t.getSource().data.dataArray,b=m;d!=null&&d.scale&&(b=m.filter(function(A){return r.applyAttributeMapping(d,A,u)[0]})),t.setEncodedData(this.mapping(t,h,b,void 0,u)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,n){var r=[n[0]-t[0],n[1]-t[1]],o=sc(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}},{key:"mapping",value:function(t,n,r,o,u){var h=this,d=t.getLayerConfig(),m=d.arrow,b=m===void 0?{enable:!1}:m,A=r.map(function(P,L){var B=o?o[L]:{},Z=(0,Q.Z)({id:P._id,coordinates:P.coordinates},B);if(n.filter(function(fe){return fe.scale!==void 0}).forEach(function(fe){var Ce=h.applyAttributeMapping(fe,P,u);fe.needRemapping=!1,fe.name==="color"&&(Ce=Ce.map(function(Ve){return I(Ve)})),Z[fe.name]=Array.isArray(Ce)&&Ce.length===1?Ce[0]:Ce,fe.name==="shape"&&(Z.shape=h.fontService.getIconFontKey(Z[fe.name]))}),b.enable&&(Z.shape==="line"||Z.shape==="halfLine")){var j=Z.coordinates,J=h.getArrowPoints(j[0],j[1]);Z.coordinates.splice(1,0,J,J)}return Z});return this.adjustData2Amap2Coordinates(A,t),this.adjustData2SimpleCoordinates(A),A}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var r=this;if(t.length>0&&this.mapService.version===Vu["GAODE2.x"]){var o=this.getLayerCenter(n);typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Vu["GAODE2.x"],u.originCoordinates=(0,l.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Vu["GAODE2.x"],u.originCoordinates=(0,l.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Vu.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=n.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var h=[];u.map(function(d){h.push(n.mapService.simpleMapCoord.unproject(d))}),r.push(h)}),r}else{var o=[];return t.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,n,r){var o;if(!t.scale)return[];var u=(t==null||(o=t.scale)===null||o===void 0?void 0:o.scalers)||[],h=[];u.forEach(function(m){var b,A=m.field;(n.hasOwnProperty(A)||((b=t.scale)===null||b===void 0?void 0:b.type)==="variable")&&h.push(n[A])});var d=t.mapping?t.mapping(h):[];return t.name==="color"&&!S(d[0])?[r]:d}}]),e}(),Cx=wa(cm.prototype,"configService",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=wa(cm.prototype,"mapService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=wa(cm.prototype,"fontService",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm))||Ex),Tx,Mx,T3=(Tx=(0,$r.b2)(),Tx(Mx=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(rr.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var r=t.getSource();if(!r){var o=t.sourceOption||t.defaultSourceConfig,u=o.data,h=o.options;r=new To(u,h),t.setSource(r)}r.inited?n.updateClusterData(t):r.once("sourceUpdate",function(){n.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=n.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,r||o})}},{key:"updateClusterData",value:function(t){var n=t.getSource(),r=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,h=this.mapService.getZoom()-1,d=t.dataState.dataSourceNeedUpdate;return r&&d&&n.updateClusterData(Math.floor(h)),r&&Math.abs(t.clusterZoom-h)>=1?(u!==Math.floor(h)&&n.updateClusterData(Math.floor(h)),t.clusterZoom=h,!0):!1}}]),e}())||Mx);function ly(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function Ix(e){return e.length===1&&(e=M3(e)),{left:function(a,t,n,r){for(n==null&&(n=0),r==null&&(r=a.length);n<r;){var o=n+r>>>1;e(a[o],t)<0?n=o+1:r=o}return n},right:function(a,t,n,r){for(n==null&&(n=0),r==null&&(r=a.length);n<r;){var o=n+r>>>1;e(a[o],t)>0?r=o:n=o+1}return n}}}function M3(e){return function(a,t){return ly(e(a),t)}}var Px=Ix(ly),I3=Px.right,IL=Px.left,ng=I3;function kx(e,a){var t=e.length,n=-1,r,o,u;if(a==null){for(;++n<t;)if((r=e[n])!=null&&r>=r)for(o=u=r;++n<t;)(r=e[n])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++n<t;)if((r=a(e[n],n,e))!=null&&r>=r)for(o=u=r;++n<t;)(r=a(e[n],n,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var Lx=Array.prototype,PL=Lx.slice,kL=Lx.map,cy=Math.sqrt(50),fy=Math.sqrt(10),hy=Math.sqrt(2);function Ox(e,a,t){var n,r=-1,o,u,h;if(a=+a,e=+e,t=+t,e===a&&t>0)return[e];if((n=a<e)&&(o=e,e=a,a=o),(h=ig(e,a,t))===0||!isFinite(h))return[];if(h>0)for(e=Math.ceil(e/h),a=Math.floor(a/h),u=new Array(o=Math.ceil(a-e+1));++r<o;)u[r]=(e+r)*h;else for(e=Math.floor(e*h),a=Math.ceil(a*h),u=new Array(o=Math.ceil(e-a+1));++r<o;)u[r]=(e-r)/h;return n&&u.reverse(),u}function ig(e,a,t){var n=(a-e)/Math.max(0,t),r=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,r);return r>=0?(o>=cy?10:o>=fy?5:o>=hy?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=cy?10:o>=fy?5:o>=hy?2:1)}function py(e,a,t){var n=Math.abs(a-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/r;return o>=cy?r*=10:o>=fy?r*=5:o>=hy&&(r*=2),a<e?-r:r}function LL(){var e=identity,a=extent,t=sturges;function n(r){var o,u=r.length,h,d=new Array(u);for(o=0;o<u;++o)d[o]=e(r[o],o,r);var m=a(d),b=m[0],A=m[1],P=t(d,b,A);Array.isArray(P)||(P=tickStep(b,A,P),P=range(Math.ceil(b/P)*P,A,P));for(var L=P.length;P[0]<=b;)P.shift(),--L;for(;P[L-1]>A;)P.pop(),--L;var B=new Array(L+1),Z;for(o=0;o<=L;++o)Z=B[o]=[],Z.x0=o>0?P[o-1]:b,Z.x1=o<L?P[o]:A;for(o=0;o<u;++o)h=d[o],b<=h&&h<=A&&B[bisect(P,h,0,L)].push(r[o]);return B}return n.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),n):e},n.domain=function(r){return arguments.length?(a=typeof r=="function"?r:constant([r[0],r[1]]),n):a},n.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),n):t},n}function OL(e,a,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function P3(e){return e===null?NaN:+e}function k3(e,a,t){if(t==null&&(t=P3),!!(n=e.length)){if((a=+a)<=0||n<2)return+t(e[0],0,e);if(a>=1)return+t(e[n-1],n-1,e);var n,r=(n-1)*a,o=Math.floor(r),u=+t(e[o],o,e),h=+t(e[o+1],o+1,e);return u+(h-u)*(r-o)}}var L3=ue(87765),mp="$";function ag(){}ag.prototype=Rx.prototype={constructor:ag,has:function(e){return mp+e in this},get:function(e){return this[mp+e]},set:function(e,a){return this[mp+e]=a,this},remove:function(e){var a=mp+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===mp&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===mp&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===mp&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===mp&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===mp&&++e;return e},empty:function(){for(var e in this)if(e[0]===mp)return!1;return!0},each:function(e){for(var a in this)a[0]===mp&&e(this[a],a.slice(1),this)}};function Rx(e,a){var t=new ag;if(e instanceof ag)e.each(function(h,d){t.set(d,h)});else if(Array.isArray(e)){var n=-1,r=e.length,o;if(a==null)for(;++n<r;)t.set(n,e[n]);else for(;++n<r;)t.set(a(o=e[n],n,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var dy=Rx;function RL(){var e=[],a=[],t,n,r;function o(h,d,m,b){if(d>=e.length)return t!=null&&h.sort(t),n!=null?n(h):h;for(var A=-1,P=h.length,L=e[d++],B,Z,j=map(),J,fe=m();++A<P;)(J=j.get(B=L(Z=h[A])+""))?J.push(Z):j.set(B,[Z]);return j.each(function(Ce,Ve){b(fe,Ve,o(Ce,d,m,b))}),fe}function u(h,d){if(++d>e.length)return h;var m,b=a[d-1];return n!=null&&d>=e.length?m=h.entries():(m=[],h.each(function(A,P){m.push({key:P,values:u(A,d)})})),b!=null?m.sort(function(A,P){return b(A.key,P.key)}):m}return r={object:function(h){return o(h,0,O3,R3)},map:function(h){return o(h,0,Dx,Fx)},entries:function(h){return u(o(h,0,Dx,Fx),0)},key:function(h){return e.push(h),r},sortKeys:function(h){return a[e.length-1]=h,r},sortValues:function(h){return t=h,r},rollup:function(h){return n=h,r}}}function O3(){return{}}function R3(e,a,t){e[a]=t}function Dx(){return map()}function Fx(e,a,t){e.set(a,t)}function og(){}var Qv=dy.prototype;og.prototype=D3.prototype={constructor:og,has:Qv.has,add:function(e){return e+="",this[mp+e]=e,this},remove:Qv.remove,clear:Qv.clear,values:Qv.keys,size:Qv.size,empty:Qv.empty,each:Qv.each};function D3(e,a){var t=new og;if(e instanceof og)e.each(function(o){t.add(o)});else if(e){var n=-1,r=e.length;if(a==null)for(;++n<r;)t.add(e[n]);else for(;++n<r;)t.add(a(e[n],n,e))}return t}var DL=null,Bx=Array.prototype,sg=Bx.map,Jv=Bx.slice;function wv(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function Nx(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var zx={name:"implicit"};function ug(){var e=dy(),a=[],t=[],n=zx;function r(o){var u=o+"",h=e.get(u);if(!h){if(n!==zx)return n;e.set(u,h=a.push(o))}return t[(h-1)%t.length]}return r.domain=function(o){if(!arguments.length)return a.slice();a=[],e=dy();for(var u=-1,h=o.length,d,m;++u<h;)e.has(m=(d=o[u])+"")||e.set(m,a.push(d));return r},r.range=function(o){return arguments.length?(t=Jv.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return ug(a,t).unknown(n)},wv.apply(r,arguments),r}function Ux(){var e=ordinal().unknown(void 0),a=e.domain,t=e.range,n=[0,1],r,o,u=!1,h=0,d=0,m=.5;delete e.unknown;function b(){var A=a().length,P=n[1]<n[0],L=n[P-0],B=n[1-P];r=(B-L)/Math.max(1,A-h+d*2),u&&(r=Math.floor(r)),L+=(B-L-r*(A-h))*m,o=r*(1-h),u&&(L=Math.round(L),o=Math.round(o));var Z=sequence(A).map(function(j){return L+r*j});return t(P?Z.reverse():Z)}return e.domain=function(A){return arguments.length?(a(A),b()):a()},e.range=function(A){return arguments.length?(n=[+A[0],+A[1]],b()):n.slice()},e.rangeRound=function(A){return n=[+A[0],+A[1]],u=!0,b()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(A){return arguments.length?(u=!!A,b()):u},e.padding=function(A){return arguments.length?(h=Math.min(1,d=+A),b()):h},e.paddingInner=function(A){return arguments.length?(h=Math.min(1,A),b()):h},e.paddingOuter=function(A){return arguments.length?(d=+A,b()):d},e.align=function(A){return arguments.length?(m=Math.max(0,Math.min(1,A)),b()):m},e.copy=function(){return Ux(a(),n).round(u).paddingInner(h).paddingOuter(d).align(m)},initRange.apply(b(),arguments)}function Zx(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Zx(a())},e}function FL(){return Zx(Ux.apply(null,arguments).paddingInner(1))}var F3=ue(21775),B3=ue(73626);function N3(e,a){return e=+e,a=+a,function(t){return Math.round(e*(1-t)+a*t)}}function z3(e){return function(){return e}}function vy(e){return+e}var Vx=[0,1];function df(e){return e}function gy(e,a){return(a-=e=+e)?function(t){return(t-e)/a}:z3(isNaN(a)?NaN:.5)}function jx(e){var a=e[0],t=e[e.length-1],n;return a>t&&(n=a,a=t,t=n),function(r){return Math.max(a,Math.min(t,r))}}function U3(e,a,t){var n=e[0],r=e[1],o=a[0],u=a[1];return r<n?(n=gy(r,n),o=t(u,o)):(n=gy(n,r),o=t(o,u)),function(h){return o(n(h))}}function Z3(e,a,t){var n=Math.min(e.length,a.length)-1,r=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<n;)r[u]=gy(e[u],e[u+1]),o[u]=t(a[u],a[u+1]);return function(h){var d=ng(e,h,1,n)-1;return o[d](r[d](h))}}function lg(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yy(){var e=Vx,a=Vx,t=F3.Z,n,r,o,u=df,h,d,m;function b(){return h=Math.min(e.length,a.length)>2?Z3:U3,d=m=null,A}function A(P){return isNaN(P=+P)?o:(d||(d=h(e.map(n),a,t)))(n(u(P)))}return A.invert=function(P){return u(r((m||(m=h(a,e.map(n),B3.Z)))(P)))},A.domain=function(P){return arguments.length?(e=sg.call(P,vy),u===df||(u=jx(e)),b()):e.slice()},A.range=function(P){return arguments.length?(a=Jv.call(P),b()):a.slice()},A.rangeRound=function(P){return a=Jv.call(P),t=N3,b()},A.clamp=function(P){return arguments.length?(u=P?jx(e):df,A):u!==df},A.interpolate=function(P){return arguments.length?(t=P,b()):t},A.unknown=function(P){return arguments.length?(o=P,A):o},function(P,L){return n=P,r=L,b()}}function Gx(e,a){return yy()(e,a)}var V3=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function cg(e){if(!(a=V3.exec(e)))throw new Error("invalid format: "+e);var a;return new _y({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}cg.prototype=_y.prototype;function _y(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}_y.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function j3(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function fg(e,a){if((t=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function L0(e){return e=fg(Math.abs(e)),e?e[1]:NaN}function G3(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(L0(a)/3)))*3-L0(Math.abs(e)))}function H3(e,a){return function(t,n){for(var r=t.length,o=[],u=0,h=e[0],d=0;r>0&&h>0&&(d+h+1>n&&(h=Math.max(1,n-d)),o.push(t.substring(r-=h,r+h)),!((d+=h+1)>n));)h=e[u=(u+1)%e.length];return o.reverse().join(a)}}function W3(e){return function(a){return a.replace(/[0-9]/g,function(t){return e[+t]})}}function X3(e){e:for(var a=e.length,t=1,n=-1,r;t<a;++t)switch(e[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(r+1):e}var Hx;function Y3(e,a){var t=fg(e,a);if(!t)return e+"";var n=t[0],r=t[1],o=r-(Hx=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+fg(e,Math.max(0,a+o-1))[0]}function Wx(e,a){var t=fg(e,a);if(!t)return e+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}var Xx={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:j3,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return Wx(e*100,a)},r:Wx,s:Y3,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Yx(e){return e}var qx=Array.prototype.map,$x=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function q3(e){var a=e.grouping===void 0||e.thousands===void 0?Yx:H3(qx.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Yx:W3(qx.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",h=e.minus===void 0?"-":e.minus+"",d=e.nan===void 0?"NaN":e.nan+"";function m(A){A=cg(A);var P=A.fill,L=A.align,B=A.sign,Z=A.symbol,j=A.zero,J=A.width,fe=A.comma,Ce=A.precision,Ve=A.trim,tt=A.type;tt==="n"?(fe=!0,tt="g"):Xx[tt]||(Ce===void 0&&(Ce=12),Ve=!0,tt="g"),(j||P==="0"&&L==="=")&&(j=!0,P="0",L="=");var st=Z==="$"?t:Z==="#"&&/[boxX]/.test(tt)?"0"+tt.toLowerCase():"",Bt=Z==="$"?n:/[%p]/.test(tt)?u:"",Xt=Xx[tt],cr=/[defgprs%]/.test(tt);Ce=Ce===void 0?6:/[gprs]/.test(tt)?Math.max(1,Math.min(21,Ce)):Math.max(0,Math.min(20,Ce));function Ir(wr){var Qr=st,Fn=Bt,ci,Ba,Ya;if(tt==="c")Fn=Xt(wr)+Fn,wr="";else{wr=+wr;var Is=wr<0||1/wr<0;if(wr=isNaN(wr)?d:Xt(Math.abs(wr),Ce),Ve&&(wr=X3(wr)),Is&&+wr==0&&B!=="+"&&(Is=!1),Qr=(Is?B==="("?B:h:B==="-"||B==="("?"":B)+Qr,Fn=(tt==="s"?$x[8+Hx/3]:"")+Fn+(Is&&B==="("?")":""),cr){for(ci=-1,Ba=wr.length;++ci<Ba;)if(Ya=wr.charCodeAt(ci),48>Ya||Ya>57){Fn=(Ya===46?r+wr.slice(ci+1):wr.slice(ci))+Fn,wr=wr.slice(0,ci);break}}}fe&&!j&&(wr=a(wr,Infinity));var Iu=Qr.length+wr.length+Fn.length,gu=Iu<J?new Array(J-Iu+1).join(P):"";switch(fe&&j&&(wr=a(gu+wr,gu.length?J-Fn.length:Infinity),gu=""),L){case"<":wr=Qr+wr+Fn+gu;break;case"=":wr=Qr+gu+wr+Fn;break;case"^":wr=gu.slice(0,Iu=gu.length>>1)+Qr+wr+Fn+gu.slice(Iu);break;default:wr=gu+Qr+wr+Fn;break}return o(wr)}return Ir.toString=function(){return A+""},Ir}function b(A,P){var L=m((A=cg(A),A.type="f",A)),B=Math.max(-8,Math.min(8,Math.floor(L0(P)/3)))*3,Z=Math.pow(10,-B),j=$x[8+B/3];return function(J){return L(Z*J)+j}}return{format:m,formatPrefix:b}}var hg,xy,Kx;$3({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function $3(e){return hg=q3(e),xy=hg.format,Kx=hg.formatPrefix,hg}function K3(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,L0(a)-L0(e))+1}function Q3(e){return Math.max(0,-L0(Math.abs(e)))}function J3(e,a,t,n){var r=py(e,a,t),o;switch(n=cg(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return n.precision==null&&!isNaN(o=G3(r,u))&&(n.precision=o),Kx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=K3(r,Math.max(Math.abs(e),Math.abs(a))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=Q3(r))&&(n.precision=o-(n.type==="%")*2);break}}return xy(n)}function O0(e){var a=e.domain;return e.ticks=function(t){var n=a();return Ox(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var r=a();return J3(r[0],r[r.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=a(),r=0,o=n.length-1,u=n[r],h=n[o],d;return h<u&&(d=u,u=h,h=d,d=r,r=o,o=d),d=ig(u,h,t),d>0?(u=Math.floor(u/d)*d,h=Math.ceil(h/d)*d,d=ig(u,h,t)):d<0&&(u=Math.ceil(u*d)/d,h=Math.floor(h*d)/d,d=ig(u,h,t)),d>0?(n[r]=Math.floor(u/d)*d,n[o]=Math.ceil(h/d)*d,a(n)):d<0&&(n[r]=Math.ceil(u*d)/d,n[o]=Math.floor(h*d)/d,a(n)),e},e}function Qx(){var e=Gx(df,df);return e.copy=function(){return lg(e,Qx())},wv.apply(e,arguments),O0(e)}function Jx(e){var a;function t(n){return isNaN(n=+n)?a:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=sg.call(n,vy),t):e.slice()},t.unknown=function(n){return arguments.length?(a=n,t):a},t.copy=function(){return Jx(e).unknown(a)},e=arguments.length?sg.call(e,vy):[0,1],O0(t)}function eb(e,a){e=e.slice();var t=0,n=e.length-1,r=e[t],o=e[n],u;return o<r&&(u=t,t=n,n=u,u=r,r=o,o=u),e[t]=a.floor(r),e[n]=a.ceil(o),e}function tb(e){return Math.log(e)}function rb(e){return Math.exp(e)}function e4(e){return-Math.log(-e)}function t4(e){return-Math.exp(-e)}function r4(e){return isFinite(e)?+("1e"+e):e<0?0:e}function n4(e){return e===10?r4:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function i4(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function nb(e){return function(a){return-e(-a)}}function a4(e){var a=e(tb,rb),t=a.domain,n=10,r,o;function u(){return r=i4(n),o=n4(n),t()[0]<0?(r=nb(r),o=nb(o),e(e4,t4)):e(tb,rb),a}return a.base=function(h){return arguments.length?(n=+h,u()):n},a.domain=function(h){return arguments.length?(t(h),u()):t()},a.ticks=function(h){var d=t(),m=d[0],b=d[d.length-1],A;(A=b<m)&&(P=m,m=b,b=P);var P=r(m),L=r(b),B,Z,j,J=h==null?10:+h,fe=[];if(!(n%1)&&L-P<J){if(P=Math.round(P)-1,L=Math.round(L)+1,m>0){for(;P<L;++P)for(Z=1,B=o(P);Z<n;++Z)if(j=B*Z,!(j<m)){if(j>b)break;fe.push(j)}}else for(;P<L;++P)for(Z=n-1,B=o(P);Z>=1;--Z)if(j=B*Z,!(j<m)){if(j>b)break;fe.push(j)}}else fe=Ox(P,L,Math.min(L-P,J)).map(o);return A?fe.reverse():fe},a.tickFormat=function(h,d){if(d==null&&(d=n===10?".0e":","),typeof d!="function"&&(d=xy(d)),h===Infinity)return d;h==null&&(h=10);var m=Math.max(1,n*h/a.ticks().length);return function(b){var A=b/o(Math.round(r(b)));return A*n<n-.5&&(A*=n),A<=m?d(b):""}},a.nice=function(){return t(eb(t(),{floor:function(h){return o(Math.floor(r(h)))},ceil:function(h){return o(Math.ceil(r(h)))}}))},a}function ib(){var e=a4(yy()).domain([1,10]);return e.copy=function(){return lg(e,ib()).base(e.base())},wv.apply(e,arguments),e}function ab(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function ob(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function o4(e){var a=1,t=e(ab(a),ob(a));return t.constant=function(n){return arguments.length?e(ab(a=+n),ob(a)):a},linearish(t)}function s4(){var e=o4(transformer());return e.copy=function(){return copy(e,s4()).constant(e.constant())},initRange.apply(e,arguments)}function sb(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function u4(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function l4(e){return e<0?-e*e:e*e}function c4(e){var a=e(df,df),t=1;function n(){return t===1?e(df,df):t===.5?e(u4,l4):e(sb(t),sb(1/t))}return a.exponent=function(r){return arguments.length?(t=+r,n()):t},O0(a)}function by(){var e=c4(yy());return e.copy=function(){return lg(e,by()).exponent(e.exponent())},wv.apply(e,arguments),e}function BL(){return by.apply(null,arguments).exponent(.5)}function ub(){var e=[],a=[],t=[],n;function r(){var u=0,h=Math.max(1,a.length);for(t=new Array(h-1);++u<h;)t[u-1]=k3(e,u/h);return o}function o(u){return isNaN(u=+u)?n:a[ng(t,u)]}return o.invertExtent=function(u){var h=a.indexOf(u);return h<0?[NaN,NaN]:[h>0?t[h-1]:e[0],h<t.length?t[h]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var h=0,d=u.length,m;h<d;++h)m=u[h],m!=null&&!isNaN(m=+m)&&e.push(m);return e.sort(ly),r()},o.range=function(u){return arguments.length?(a=Jv.call(u),r()):a.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return t.slice()},o.copy=function(){return ub().domain(e).range(a).unknown(n)},wv.apply(o,arguments)}function lb(){var e=0,a=1,t=1,n=[.5],r=[0,1],o;function u(d){return d<=d?r[ng(n,d,0,t)]:o}function h(){var d=-1;for(n=new Array(t);++d<t;)n[d]=((d+1)*a-(d-t)*e)/(t+1);return u}return u.domain=function(d){return arguments.length?(e=+d[0],a=+d[1],h()):[e,a]},u.range=function(d){return arguments.length?(t=(r=Jv.call(d)).length-1,h()):r.slice()},u.invertExtent=function(d){var m=r.indexOf(d);return m<0?[NaN,NaN]:m<1?[e,n[0]]:m>=t?[n[t-1],a]:[n[m-1],n[m]]},u.unknown=function(d){return arguments.length&&(o=d),u},u.thresholds=function(){return n.slice()},u.copy=function(){return lb().domain([e,a]).range(r).unknown(o)},wv.apply(O0(u),arguments)}function cb(){var e=[.5],a=[0,1],t,n=1;function r(o){return o<=o?a[ng(e,o,0,n)]:t}return r.domain=function(o){return arguments.length?(e=Jv.call(o),n=Math.min(e.length,a.length-1),r):e.slice()},r.range=function(o){return arguments.length?(a=Jv.call(o),n=Math.min(e.length,a.length-1),r):a.slice()},r.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return cb().domain(e).range(a).unknown(t)},wv.apply(r,arguments)}var Ey=new Date,Cy=new Date;function Yf(e,a,t,n){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},r.round=function(o){var u=r(o),h=r.ceil(o);return o-u<h-o?u:h},r.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,h){var d=[],m;if(o=r.ceil(o),h=h==null?1:Math.floor(h),!(o<u)||!(h>0))return d;do d.push(m=new Date(+o)),a(o,h),e(o);while(m<o&&o<u);return d},r.filter=function(o){return Yf(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,h){if(u>=u)if(h<0)for(;++h<=0;)for(;a(u,-1),!o(u););else for(;--h>=0;)for(;a(u,1),!o(u););})},t&&(r.count=function(o,u){return Ey.setTime(+o),Cy.setTime(+u),e(Ey),e(Cy),Math.floor(t(Ey,Cy))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?function(u){return n(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var Sy=Yf(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Sy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Yf(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,t){a.setFullYear(a.getFullYear()+t*e)})};var R0=Sy,NL=Sy.range,fb=Yf(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),f4=fb,zL=fb.range,pg=1e3,fm=6e4,hb=36e5,pb=864e5,db=6048e5;function e0(e){return Yf(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,t){a.setDate(a.getDate()+t*7)},function(a,t){return(t-a-(t.getTimezoneOffset()-a.getTimezoneOffset())*fm)/db})}var Ay=e0(0),dg=e0(1),h4=e0(2),p4=e0(3),D0=e0(4),d4=e0(5),v4=e0(6),UL=Ay.range,ZL=dg.range,VL=h4.range,jL=p4.range,GL=D0.range,HL=d4.range,WL=v4.range,vb=Yf(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*fm)/pb},function(e){return e.getDate()-1}),wy=vb,XL=vb.range,mb=Yf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*pg-e.getMinutes()*fm)},function(e,a){e.setTime(+e+a*hb)},function(e,a){return(a-e)/hb},function(e){return e.getHours()}),m4=mb,YL=mb.range,gb=Yf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*pg)},function(e,a){e.setTime(+e+a*fm)},function(e,a){return(a-e)/fm},function(e){return e.getMinutes()}),g4=gb,qL=gb.range,yb=Yf(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*pg)},function(e,a){return(a-e)/pg},function(e){return e.getUTCSeconds()}),y4=yb,$L=yb.range,vg=Yf(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});vg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Yf(function(a){a.setTime(Math.floor(a/e)*e)},function(a,t){a.setTime(+a+t*e)},function(a,t){return(t-a)/e}):vg};var _4=vg,KL=vg.range;function t0(e){return Yf(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCDate(a.getUTCDate()+t*7)},function(a,t){return(t-a)/db})}var _b=t0(0),mg=t0(1),x4=t0(2),b4=t0(3),F0=t0(4),E4=t0(5),C4=t0(6),QL=_b.range,JL=mg.range,eO=x4.range,tO=b4.range,rO=F0.range,nO=E4.range,iO=C4.range,xb=Yf(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/pb},function(e){return e.getUTCDate()-1}),bb=xb,aO=xb.range,Ty=Yf(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ty.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Yf(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCFullYear(a.getUTCFullYear()+t*e)})};var hm=Ty,oO=Ty.range;function My(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Iy(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function pm(e,a,t){return{y:e,m:a,d:t,H:0,M:0,S:0,L:0}}function S4(e){var a=e.dateTime,t=e.date,n=e.time,r=e.periods,o=e.days,u=e.shortDays,h=e.months,d=e.shortMonths,m=dm(r),b=vm(r),A=dm(o),P=vm(o),L=dm(u),B=vm(u),Z=dm(h),j=vm(h),J=dm(d),fe=vm(d),Ce={a:Is,A:Iu,b:gu,B:vf,c:null,d:Tb,e:Tb,f:X4,g:nI,G:aI,H:G4,I:H4,j:W4,L:Mb,m:Y4,M:q4,p:Mv,q:Iv,Q:Rb,s:Db,S:$4,u:K4,U:Q4,V:J4,w:eI,W:tI,x:null,X:null,y:rI,Y:iI,Z:oI,"%":Ob},Ve={a:i0,A:Z0,b:Pv,B:V0,c:null,d:Pb,e:Pb,f:cI,g:xI,G:EI,H:sI,I:uI,j:lI,L:kb,m:fI,M:hI,p:Uy,q:Zy,Q:Rb,s:Db,S:pI,u:dI,U:vI,V:mI,w:gI,W:yI,x:null,X:null,y:_I,Y:bI,Z:CI,"%":Ob},tt={a:Ir,A:wr,b:Qr,B:Fn,c:ci,d:Ab,e:Ab,f:U4,g:Sb,G:Cb,H:wb,I:wb,j:F4,L:z4,m:D4,M:B4,p:cr,q:R4,Q:V4,s:j4,S:N4,u:I4,U:P4,V:k4,w:M4,W:L4,x:Ba,X:Ya,y:Sb,Y:Cb,Z:O4,"%":Z4};Ce.x=st(t,Ce),Ce.X=st(n,Ce),Ce.c=st(a,Ce),Ve.x=st(t,Ve),Ve.X=st(n,Ve),Ve.c=st(a,Ve);function st(Ji,Ro){return function(os){var li=[],Eh=-1,su=0,Hh=Ji.length,Wh,a0,SE;for(os instanceof Date||(os=new Date(+os));++Eh<Hh;)Ji.charCodeAt(Eh)===37&&(li.push(Ji.slice(su,Eh)),(a0=Eb[Wh=Ji.charAt(++Eh)])!=null?Wh=Ji.charAt(++Eh):a0=Wh==="e"?" ":"0",(SE=Ro[Wh])&&(Wh=SE(os,a0)),li.push(Wh),su=Eh+1);return li.push(Ji.slice(su,Eh)),li.join("")}}function Bt(Ji,Ro){return function(os){var li=pm(1900,void 0,1),Eh=Xt(li,Ji,os+="",0),su,Hh;if(Eh!=os.length)return null;if("Q"in li)return new Date(li.Q);if("s"in li)return new Date(li.s*1e3+("L"in li?li.L:0));if(Ro&&!("Z"in li)&&(li.Z=0),"p"in li&&(li.H=li.H%12+li.p*12),li.m===void 0&&(li.m="q"in li?li.q:0),"V"in li){if(li.V<1||li.V>53)return null;"w"in li||(li.w=1),"Z"in li?(su=Iy(pm(li.y,0,1)),Hh=su.getUTCDay(),su=Hh>4||Hh===0?mg.ceil(su):mg(su),su=bb.offset(su,(li.V-1)*7),li.y=su.getUTCFullYear(),li.m=su.getUTCMonth(),li.d=su.getUTCDate()+(li.w+6)%7):(su=My(pm(li.y,0,1)),Hh=su.getDay(),su=Hh>4||Hh===0?dg.ceil(su):dg(su),su=wy.offset(su,(li.V-1)*7),li.y=su.getFullYear(),li.m=su.getMonth(),li.d=su.getDate()+(li.w+6)%7)}else("W"in li||"U"in li)&&("w"in li||(li.w="u"in li?li.u%7:"W"in li?1:0),Hh="Z"in li?Iy(pm(li.y,0,1)).getUTCDay():My(pm(li.y,0,1)).getDay(),li.m=0,li.d="W"in li?(li.w+6)%7+li.W*7-(Hh+5)%7:li.w+li.U*7-(Hh+6)%7);return"Z"in li?(li.H+=li.Z/100|0,li.M+=li.Z%100,Iy(li)):My(li)}}function Xt(Ji,Ro,os,li){for(var Eh=0,su=Ro.length,Hh=os.length,Wh,a0;Eh<su;){if(li>=Hh)return-1;if(Wh=Ro.charCodeAt(Eh++),Wh===37){if(Wh=Ro.charAt(Eh++),a0=tt[Wh in Eb?Ro.charAt(Eh++):Wh],!a0||(li=a0(Ji,os,li))<0)return-1}else if(Wh!=os.charCodeAt(li++))return-1}return li}function cr(Ji,Ro,os){var li=m.exec(Ro.slice(os));return li?(Ji.p=b[li[0].toLowerCase()],os+li[0].length):-1}function Ir(Ji,Ro,os){var li=L.exec(Ro.slice(os));return li?(Ji.w=B[li[0].toLowerCase()],os+li[0].length):-1}function wr(Ji,Ro,os){var li=A.exec(Ro.slice(os));return li?(Ji.w=P[li[0].toLowerCase()],os+li[0].length):-1}function Qr(Ji,Ro,os){var li=J.exec(Ro.slice(os));return li?(Ji.m=fe[li[0].toLowerCase()],os+li[0].length):-1}function Fn(Ji,Ro,os){var li=Z.exec(Ro.slice(os));return li?(Ji.m=j[li[0].toLowerCase()],os+li[0].length):-1}function ci(Ji,Ro,os){return Xt(Ji,a,Ro,os)}function Ba(Ji,Ro,os){return Xt(Ji,t,Ro,os)}function Ya(Ji,Ro,os){return Xt(Ji,n,Ro,os)}function Is(Ji){return u[Ji.getDay()]}function Iu(Ji){return o[Ji.getDay()]}function gu(Ji){return d[Ji.getMonth()]}function vf(Ji){return h[Ji.getMonth()]}function Mv(Ji){return r[+(Ji.getHours()>=12)]}function Iv(Ji){return 1+~~(Ji.getMonth()/3)}function i0(Ji){return u[Ji.getUTCDay()]}function Z0(Ji){return o[Ji.getUTCDay()]}function Pv(Ji){return d[Ji.getUTCMonth()]}function V0(Ji){return h[Ji.getUTCMonth()]}function Uy(Ji){return r[+(Ji.getUTCHours()>=12)]}function Zy(Ji){return 1+~~(Ji.getUTCMonth()/3)}return{format:function(Ji){var Ro=st(Ji+="",Ce);return Ro.toString=function(){return Ji},Ro},parse:function(Ji){var Ro=Bt(Ji+="",!1);return Ro.toString=function(){return Ji},Ro},utcFormat:function(Ji){var Ro=st(Ji+="",Ve);return Ro.toString=function(){return Ji},Ro},utcParse:function(Ji){var Ro=Bt(Ji+="",!0);return Ro.toString=function(){return Ji},Ro}}}var Eb={"-":"",_:" ","0":"0"},Ac=/^\s*\d+/,A4=/^%/,w4=/[\\^$*+?|[\]().{}]/g;function as(e,a,t){var n=e<0?"-":"",r=(n?-e:e)+"",o=r.length;return n+(o<t?new Array(t-o+1).join(a)+r:r)}function T4(e){return e.replace(w4,"\\$&")}function dm(e){return new RegExp("^(?:"+e.map(T4).join("|")+")","i")}function vm(e){for(var a={},t=-1,n=e.length;++t<n;)a[e[t].toLowerCase()]=t;return a}function M4(e,a,t){var n=Ac.exec(a.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function I4(e,a,t){var n=Ac.exec(a.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function P4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function k4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function L4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function Cb(e,a,t){var n=Ac.exec(a.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function Sb(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function O4(e,a,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function R4(e,a,t){var n=Ac.exec(a.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function D4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function Ab(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function F4(e,a,t){var n=Ac.exec(a.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function wb(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function B4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function N4(e,a,t){var n=Ac.exec(a.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function z4(e,a,t){var n=Ac.exec(a.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function U4(e,a,t){var n=Ac.exec(a.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function Z4(e,a,t){var n=A4.exec(a.slice(t,t+1));return n?t+n[0].length:-1}function V4(e,a,t){var n=Ac.exec(a.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function j4(e,a,t){var n=Ac.exec(a.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function Tb(e,a){return as(e.getDate(),a,2)}function G4(e,a){return as(e.getHours(),a,2)}function H4(e,a){return as(e.getHours()%12||12,a,2)}function W4(e,a){return as(1+wy.count(R0(e),e),a,3)}function Mb(e,a){return as(e.getMilliseconds(),a,3)}function X4(e,a){return Mb(e,a)+"000"}function Y4(e,a){return as(e.getMonth()+1,a,2)}function q4(e,a){return as(e.getMinutes(),a,2)}function $4(e,a){return as(e.getSeconds(),a,2)}function K4(e){var a=e.getDay();return a===0?7:a}function Q4(e,a){return as(Ay.count(R0(e)-1,e),a,2)}function Ib(e){var a=e.getDay();return a>=4||a===0?D0(e):D0.ceil(e)}function J4(e,a){return e=Ib(e),as(D0.count(R0(e),e)+(R0(e).getDay()===4),a,2)}function eI(e){return e.getDay()}function tI(e,a){return as(dg.count(R0(e)-1,e),a,2)}function rI(e,a){return as(e.getFullYear()%100,a,2)}function nI(e,a){return e=Ib(e),as(e.getFullYear()%100,a,2)}function iI(e,a){return as(e.getFullYear()%1e4,a,4)}function aI(e,a){var t=e.getDay();return e=t>=4||t===0?D0(e):D0.ceil(e),as(e.getFullYear()%1e4,a,4)}function oI(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+as(a/60|0,"0",2)+as(a%60,"0",2)}function Pb(e,a){return as(e.getUTCDate(),a,2)}function sI(e,a){return as(e.getUTCHours(),a,2)}function uI(e,a){return as(e.getUTCHours()%12||12,a,2)}function lI(e,a){return as(1+bb.count(hm(e),e),a,3)}function kb(e,a){return as(e.getUTCMilliseconds(),a,3)}function cI(e,a){return kb(e,a)+"000"}function fI(e,a){return as(e.getUTCMonth()+1,a,2)}function hI(e,a){return as(e.getUTCMinutes(),a,2)}function pI(e,a){return as(e.getUTCSeconds(),a,2)}function dI(e){var a=e.getUTCDay();return a===0?7:a}function vI(e,a){return as(_b.count(hm(e)-1,e),a,2)}function Lb(e){var a=e.getUTCDay();return a>=4||a===0?F0(e):F0.ceil(e)}function mI(e,a){return e=Lb(e),as(F0.count(hm(e),e)+(hm(e).getUTCDay()===4),a,2)}function gI(e){return e.getUTCDay()}function yI(e,a){return as(mg.count(hm(e)-1,e),a,2)}function _I(e,a){return as(e.getUTCFullYear()%100,a,2)}function xI(e,a){return e=Lb(e),as(e.getUTCFullYear()%100,a,2)}function bI(e,a){return as(e.getUTCFullYear()%1e4,a,4)}function EI(e,a){var t=e.getUTCDay();return e=t>=4||t===0?F0(e):F0.ceil(e),as(e.getUTCFullYear()%1e4,a,4)}function CI(){return"+0000"}function Ob(){return"%"}function Rb(e){return+e}function Db(e){return Math.floor(+e/1e3)}var B0,Fb,SI,AI,wI;TI({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function TI(e){return B0=S4(e),Fb=B0.format,SI=B0.parse,AI=B0.utcFormat,wI=B0.utcParse,B0}var mm=1e3,gm=mm*60,ym=gm*60,_m=ym*24,MI=_m*7,Bb=_m*30,Py=_m*365;function II(e){return new Date(e)}function PI(e){return e instanceof Date?+e:+new Date(+e)}function Nb(e,a,t,n,r,o,u,h,d){var m=Gx(df,df),b=m.invert,A=m.domain,P=d(".%L"),L=d(":%S"),B=d("%I:%M"),Z=d("%I %p"),j=d("%a %d"),J=d("%b %d"),fe=d("%B"),Ce=d("%Y"),Ve=[[u,1,mm],[u,5,5*mm],[u,15,15*mm],[u,30,30*mm],[o,1,gm],[o,5,5*gm],[o,15,15*gm],[o,30,30*gm],[r,1,ym],[r,3,3*ym],[r,6,6*ym],[r,12,12*ym],[n,1,_m],[n,2,2*_m],[t,1,MI],[a,1,Bb],[a,3,3*Bb],[e,1,Py]];function tt(Bt){return(u(Bt)<Bt?P:o(Bt)<Bt?L:r(Bt)<Bt?B:n(Bt)<Bt?Z:a(Bt)<Bt?t(Bt)<Bt?j:J:e(Bt)<Bt?fe:Ce)(Bt)}function st(Bt,Xt,cr,Ir){if(Bt==null&&(Bt=10),typeof Bt=="number"){var wr=Math.abs(cr-Xt)/Bt,Qr=Ix(function(Fn){return Fn[2]}).right(Ve,wr);Qr===Ve.length?(Ir=py(Xt/Py,cr/Py,Bt),Bt=e):Qr?(Qr=Ve[wr/Ve[Qr-1][2]<Ve[Qr][2]/wr?Qr-1:Qr],Ir=Qr[1],Bt=Qr[0]):(Ir=Math.max(py(Xt,cr,Bt),1),Bt=h)}return Ir==null?Bt:Bt.every(Ir)}return m.invert=function(Bt){return new Date(b(Bt))},m.domain=function(Bt){return arguments.length?A(sg.call(Bt,PI)):A().map(II)},m.ticks=function(Bt,Xt){var cr=A(),Ir=cr[0],wr=cr[cr.length-1],Qr=wr<Ir,Fn;return Qr&&(Fn=Ir,Ir=wr,wr=Fn),Fn=st(Bt,Ir,wr,Xt),Fn=Fn?Fn.range(Ir,wr+1):[],Qr?Fn.reverse():Fn},m.tickFormat=function(Bt,Xt){return Xt==null?tt:d(Xt)},m.nice=function(Bt,Xt){var cr=A();return(Bt=st(Bt,cr[0],cr[cr.length-1],Xt))?A(eb(cr,Bt)):m},m.copy=function(){return lg(m,Nb(e,a,t,n,r,o,u,h,d))},m}function kI(){return wv.apply(Nb(R0,f4,Ay,wy,m4,g4,y4,_4,Fb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function sO(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function gg(){var e=0,a=1,t,n,r,o,u=df,h=!1,d;function m(b){return isNaN(b=+b)?d:u(r===0?.5:(b=(o(b)-t)*r,h?Math.max(0,Math.min(1,b)):b))}return m.domain=function(b){return arguments.length?(t=o(e=+b[0]),n=o(a=+b[1]),r=t===n?0:1/(n-t),m):[e,a]},m.clamp=function(b){return arguments.length?(h=!!b,m):h},m.interpolator=function(b){return arguments.length?(u=b,m):u},m.unknown=function(b){return arguments.length?(d=b,m):d},function(b){return o=b,t=b(e),n=b(a),r=t===n?0:1/(n-t),m}}function xm(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function zb(){var e=O0(gg()(df));return e.copy=function(){return xm(e,zb())},Nx.apply(e,arguments)}function LI(){var e=loggish(gg()).domain([1,10]);return e.copy=function(){return xm(e,LI()).base(e.base())},initInterpolator.apply(e,arguments)}function OI(){var e=symlogish(gg());return e.copy=function(){return xm(e,OI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Ub(){var e=powish(gg());return e.copy=function(){return xm(e,Ub()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function uO(){return Ub.apply(null,arguments).exponent(.5)}function RI(){var e=[],a=identity;function t(n){if(!isNaN(n=+n))return a((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var r=0,o=n.length,u;r<o;++r)u=n[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(a=n,t):a},t.copy=function(){return RI(a).domain(e)},initInterpolator.apply(t,arguments)}function yg(){var e=0,a=.5,t=1,n,r,o,u,h,d=df,m,b=!1,A;function P(L){return isNaN(L=+L)?A:(L=.5+((L=+m(L))-r)*(L<r?u:h),d(b?Math.max(0,Math.min(1,L)):L))}return P.domain=function(L){return arguments.length?(n=m(e=+L[0]),r=m(a=+L[1]),o=m(t=+L[2]),u=n===r?0:.5/(r-n),h=r===o?0:.5/(o-r),P):[e,a,t]},P.clamp=function(L){return arguments.length?(b=!!L,P):b},P.interpolator=function(L){return arguments.length?(d=L,P):d},P.unknown=function(L){return arguments.length?(A=L,P):A},function(L){return m=L,n=L(e),r=L(a),o=L(t),u=n===r?0:.5/(r-n),h=r===o?0:.5/(o-r),P}}function Zb(){var e=O0(yg()(df));return e.copy=function(){return xm(e,Zb())},Nx.apply(e,arguments)}function DI(){var e=loggish(yg()).domain([.1,1,10]);return e.copy=function(){return copy(e,DI()).base(e.base())},initInterpolator.apply(e,arguments)}function FI(){var e=symlogish(yg());return e.copy=function(){return copy(e,FI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Vb(){var e=powish(yg());return e.copy=function(){return copy(e,Vb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function lO(){return Vb.apply(null,arguments).exponent(.5)}var Gh,jb,Gb,Hb,ky,Wb,BI=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,NI=(Gh={},(0,ae.Z)(Gh,is.LINEAR,Qx),(0,ae.Z)(Gh,is.POWER,by),(0,ae.Z)(Gh,is.LOG,ib),(0,ae.Z)(Gh,is.IDENTITY,Jx),(0,ae.Z)(Gh,is.SEQUENTIAL,zb),(0,ae.Z)(Gh,is.TIME,kI),(0,ae.Z)(Gh,is.QUANTILE,ub),(0,ae.Z)(Gh,is.QUANTIZE,lb),(0,ae.Z)(Gh,is.THRESHOLD,cb),(0,ae.Z)(Gh,is.CAT,ug),(0,ae.Z)(Gh,is.DIVERGING,Zb),Gh),zI=(jb=(0,$r.b2)(),Gb=(0,$r.f3)(rr.IGlobalConfigService),jb(Hb=(ky=function(){function e(){(0,Ht.Z)(this,e),ga(this,"configService",Wb,this),(0,ae.Z)(this,"scaleCache",{}),(0,ae.Z)(this,"scaleOptions",{})}return(0,Rt.Z)(e,[{key:"getSourceData",value:function(t,n){var r=t.getSource();r.inited?n(r.data):r.once("sourceUpdate",function(){n(r.data)})}},{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();r.getSourceData(t,function(h){var d=h.dataArray;Array.isArray(d)&&d.length===0||r.caculateScalesForAttributes(u||[],d)})}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();return r.getSourceData(t,function(h){var d=h.dataArray;Array.isArray(d)&&d.length===0||(r.caculateScalesForAttributes(u||[],d),t.layerModelNeedUpdate=!0)}),!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();u&&r.getSourceData(t,function(h){var d=h.dataArray;if(d.length!==0){var m=u.filter(function(b){return b.needRescale});m.length&&r.caculateScalesForAttributes(m,d)}})}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;this.scaleCache={},t.forEach(function(o){if(o.scale){var u=o.scale;u.names=r.parseFields(o.scale.field||[]);var h=[];u.names.forEach(function(d){var m;h.push(r.createScale(d,o.name,(m=o.scale)===null||m===void 0?void 0:m.values,n))}),h.some(function(d){return d.type===bv.VARIABLE})?(u.type=bv.VARIABLE,h.forEach(function(d){var m;if(!u.callback&&u.values!=="text")switch((m=d.option)===null||m===void 0?void 0:m.type){case is.LOG:case is.LINEAR:case is.POWER:if(u.values&&u.values.length>2){var b=d.scale.ticks(u.values.length);d.scale.domain(b)}u.values?d.scale.range(u.values):d.scale.range(d.option.domain);break;case is.QUANTILE:case is.QUANTIZE:case is.THRESHOLD:d.scale.range(u.values);break;case is.CAT:u.values?d.scale.range(u.values):d.scale.range(d.option.domain);break;case is.DIVERGING:case is.SEQUENTIAL:d.scale.interpolator(L3.hD(u.values));break}if(u.values==="text"){var A;d.scale.range((A=d.option)===null||A===void 0?void 0:A.domain)}})):(u.type=bv.CONSTANT,u.defaultValues=h.map(function(d,m){return d.scale(u.names[m])})),u.scalers=h.map(function(d){return{field:d.field,func:d.scale,option:d.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,l.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,r,o){var u,h,d=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[n]:this.scaleOptions[t],m={field:t,scale:void 0,type:bv.VARIABLE,option:d};if(!o||!o.length)return d&&d.type?m.scale=this.createDefaultScale(d):(m.scale=ug([t]),m.type=bv.CONSTANT),m;var b=(h=o.find(function(L){return!(0,l.isNil)(L[t])}))===null||h===void 0?void 0:h[t];if(this.isNumber(t)||(0,l.isNil)(b)&&!d)m.scale=ug([t]),m.type=bv.CONSTANT;else{var A=d&&d.type||this.getDefaultType(b);r==="text"&&(A=is.CAT);var P=this.createScaleConfig(A,t,d,o);m.scale=this.createDefaultScale(P),m.option=P}return m}},{key:"getDefaultType",value:function(t){var n=is.LINEAR;return typeof t=="string"&&(n=BI.test(t)?is.TIME:is.CAT),n}},{key:"createScaleConfig",value:function(t,n,r,o){var u={type:t},h=(o==null?void 0:o.map(function(b){return b[n]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t!==is.CAT&&t!==is.QUANTILE&&t!==is.DIVERGING)u.domain=kx(h);else if(t===is.CAT)u.domain=(0,l.uniq)(h);else if(t===is.QUANTILE)u.domain=h;else if(t===is.DIVERGING){var d=kx(h),m=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(d[0]+d[1])/2;u.domain=[d[0],m,d[1]]}return(0,Q.Z)((0,Q.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var n=t.type,r=t.domain,o=t.unknown,u=t.clamp,h=t.nice,d=NI[n]();return r&&d.domain&&d.domain(r),o&&d.unknown(o),u!==void 0&&d.clamp&&d.clamp(u),h!==void 0&&d.nice&&d.nice(h),d}}]),e}(),Wb=wa(ky.prototype,"configService",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky))||Hb),Xb,Yb,qb,$b,_g,Kb,Qb,UI=(Xb=(0,$r.b2)(),Yb=(0,$r.f3)(rr.ICameraService),qb=(0,$r.f3)(rr.IRendererService),Xb($b=(_g=function(){function e(){(0,Ht.Z)(this,e),ga(this,"cameraService",Kb,this),ga(this,"rendererService",Qb,this)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(n){n.addUniforms((0,Q.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),Kb=wa(_g.prototype,"cameraService",[Yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=wa(_g.prototype,"rendererService",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g))||$b),Jb,e2,ZI=(Jb=(0,$r.b2)(),Jb(e2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var n=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var r=t.getSource();r.inited&&n.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=t.getSource();return r.inited?n.prepareLayerModel(t):r.once("sourceUpdate",function(){n.prepareLayerModel(t)}),!1})}}]),e}())||e2),t2,r2,VI=(t2=(0,$r.b2)(),t2(r2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var n=t.getLayerConfig(),r=n.autoFit,o=n.fitBoundsOptions;r&&setTimeout(function(){t.fitBounds(o)},100)})}}]),e}())||r2),n2,i2,jI=["type"],a2={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},GI={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},HI={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},WI={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},cO=null;function XI(e){var a={u_DirectionalLights:new Array(3).fill((0,Q.Z)({},HI)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Q.Z)({},WI)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[GI]),e.forEach(function(t,n){var r=t.type,o=r===void 0?"directional":r,u=(0,pe.Z)(t,jI),h=a2[o].lights,d=a2[o].num,m=a[d];a[h][m]=(0,Q.Z)((0,Q.Z)({},a[h][m]),u),a[d]++}),a}var YI=(n2=(0,$r.b2)(),n2(i2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),r=n.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,Q.Z)({},XI()))})})}}]),e}())||i2),o2,s2,u2,Ly,l2,qI=(o2=(0,$r.b2)(),s2=(0,$r.f3)(rr.IGlobalConfigService),o2(u2=(Ly=function(){function e(){(0,Ht.Z)(this,e),ga(this,"configService",l2,this)}return(0,Rt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.rendererService,u=n.postProcessingPassFactory,h=n.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var d=t.getLayerConfig(),m=d.enableMultiPassRenderer,b=d.passes,A=b===void 0?[]:b;r.enabled=!!m&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=u1(t,A,u,h),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var d=o.getViewportSize(),m=d.width,b=d.height;t.multiPassRenderer.resize(m,b)}})}}]),e}(),l2=wa(Ly.prototype,"configService",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly))||u2),c2,f2,xg={NONE:0,ENCODE:1,HIGHLIGHT:2},$I=(c2=(0,$r.b2)(),c2(f2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t,n){var r=n.rendererService,o=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking,d=u.enableMultiPassRenderer;o.registerStyleAttribute({name:"pickingColor",type:jn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:Y.FLOAT},size:3,update:function(b,A){var P=b.id;return h?z(P):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking;h&&t.isVisible()&&t.models.forEach(function(d){return d.addUniforms({u_PickingStage:xg.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking;h&&t.isVisible()&&t.models.forEach(function(d){return d.addUniforms({u_PickingStage:xg.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(u){var h=t.getLayerConfig(),d=h.highlightColor,m=h.activeMix,b=m===void 0?0:m,A=typeof d=="string"?I(d):d||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:O(new Uint8Array(u))}),t.models.forEach(function(P){return P.addUniforms({u_PickingStage:xg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(L){return L*255}),u_activeMix:b})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(u){var h=t.getLayerConfig(),d=h.selectColor,m=h.selectMix,b=m===void 0?0:m,A=typeof d=="string"?I(d):d||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:O(new Uint8Array(u))}),t.models.forEach(function(P){return P.addUniforms({u_PickingStage:xg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(L){return L*255}),u_activeMix:b,u_CurrentSelectedId:u,u_SelectColor:A.map(function(L){return L*255}),u_EnableSelect:1})})})}}]),e}())||f2),h2,p2,KI=(h2=(0,$r.b2)(),h2(p2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(o)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:jn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:Y.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}}),t.registerStyleAttribute({name:"filter",type:jn.Attribute,descriptor:{name:"filter",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r,o){var u=r.filter;return u?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:jn.Attribute,descriptor:{name:"a_Color",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(r,o){var u=r.color;return!u||!u.length?[1,1,1,1]:u}}}),t.registerStyleAttribute({name:"vertexId",type:jn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r,o,u,h){return[o]}}})}}]),e}())||p2),d2,v2,m2,g2,y2,_2,N0,x2,b2,E2,C2,QI=(d2=(0,$r.b2)(),v2=(0,$r.f3)(rr.ICameraService),m2=(0,$r.f3)(rr.ICoordinateSystemService),g2=(0,$r.f3)(rr.IRendererService),y2=(0,$r.f3)(rr.IMapService),d2(_2=(N0=function(){function e(){(0,Ht.Z)(this,e),ga(this,"cameraService",x2,this),ga(this,"coordinateSystemService",b2,this),ga(this,"rendererService",E2,this),ga(this,"mapService",C2,this)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){var n=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var h=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(h),r==="GAODE2.x"){var d=n.getLayerCenter(t);n.mapService.map.customCoords.setCenter(d),n.mapService.setCustomCoordCenter(d),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter()}var m=n.rendererService.getViewportSize(),b=m.width,A=m.height;t.models.forEach(function(P){var L;P.addUniforms((L={},(0,ae.Z)(L,Xv.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,ae.Z)(L,Xv.ViewMatrix,n.cameraService.getViewMatrix()),(0,ae.Z)(L,Xv.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,ae.Z)(L,Xv.Zoom,n.cameraService.getZoom()),(0,ae.Z)(L,Xv.ZoomScale,n.cameraService.getZoomScale()),(0,ae.Z)(L,Xv.FocalDistance,n.cameraService.getFocalDistance()),(0,ae.Z)(L,Xv.CameraPosition,n.cameraService.getCameraPosition()),(0,ae.Z)(L,gd.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,ae.Z)(L,gd.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,ae.Z)(L,gd.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,ae.Z)(L,gd.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,ae.Z)(L,gd.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,ae.Z)(L,gd.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,ae.Z)(L,gd.Mvp,o),(0,ae.Z)(L,"u_SceneCenterMKT",u),(0,ae.Z)(L,"u_ViewportSize",[b,A]),(0,ae.Z)(L,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,ae.Z)(L,"u_DevicePixelRatio",Ui.devicePixelRatio),(0,ae.Z)(L,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,ae.Z)(L,"u_shaderPick",Number(t.getShaderPickStat())),L))})})}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}}]),e}(),x2=wa(N0.prototype,"cameraService",[v2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b2=wa(N0.prototype,"coordinateSystemService",[m2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E2=wa(N0.prototype,"rendererService",[g2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C2=wa(N0.prototype,"mapService",[y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0))||_2),S2,A2,JI=(S2=(0,$r.b2)(),S2(A2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||A2),w2,T2,eP=(w2=(0,$r.b2)(),w2(T2=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||r.updateStyleAtrribute(t,{styleAttributeService:o})})}},{key:"updateStyleAtrribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),h=r.getLayerStyleAttribute("shape");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(d){return d.needRegenerateVertices=!1});return}o.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){r.updateAttributeByFeatureRange(d.name,t.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||T2);Vh.bind(rr.ILayerPlugin).to(T3).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(KI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(zI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(w3).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(VI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(eP).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(JI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(qI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(QI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(UI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(YI).inRequestScope(),Vh.bind(rr.ILayerPlugin).to($I).inRequestScope(),Vh.bind(rr.ILayerPlugin).to(ZI).inRequestScope();var tP=ue(88307),rP=ue.n(tP),nP=function(){function e(a,t){(0,Ht.Z)(this,e);var n=t.buffer,r=t.offset,o=t.stride,u=t.normalized,h=t.size,d=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:d||0},h&&(this.attribute.size=h)}return(0,Rt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),qd,bm,$d,gp,Em,Tv,Cm,bg,xd,r0,$c,bd,Ed,Eg,iP=(qd={},(0,ae.Z)(qd,Y.POINTS,"points"),(0,ae.Z)(qd,Y.LINES,"lines"),(0,ae.Z)(qd,Y.LINE_LOOP,"line loop"),(0,ae.Z)(qd,Y.LINE_STRIP,"line strip"),(0,ae.Z)(qd,Y.TRIANGLES,"triangles"),(0,ae.Z)(qd,Y.TRIANGLE_FAN,"triangle fan"),(0,ae.Z)(qd,Y.TRIANGLE_STRIP,"triangle strip"),qd),M2=(bm={},(0,ae.Z)(bm,Y.STATIC_DRAW,"static"),(0,ae.Z)(bm,Y.DYNAMIC_DRAW,"dynamic"),(0,ae.Z)(bm,Y.STREAM_DRAW,"stream"),bm),Oy=($d={},(0,ae.Z)($d,Y.BYTE,"int8"),(0,ae.Z)($d,Y.UNSIGNED_INT,"int16"),(0,ae.Z)($d,Y.INT,"int32"),(0,ae.Z)($d,Y.UNSIGNED_BYTE,"uint8"),(0,ae.Z)($d,Y.UNSIGNED_SHORT,"uint16"),(0,ae.Z)($d,Y.UNSIGNED_INT,"uint32"),(0,ae.Z)($d,Y.FLOAT,"float"),$d),aP=(gp={},(0,ae.Z)(gp,Y.ALPHA,"alpha"),(0,ae.Z)(gp,Y.LUMINANCE,"luminance"),(0,ae.Z)(gp,Y.LUMINANCE_ALPHA,"luminance alpha"),(0,ae.Z)(gp,Y.RGB,"rgb"),(0,ae.Z)(gp,Y.RGBA,"rgba"),(0,ae.Z)(gp,Y.RGBA4,"rgba4"),(0,ae.Z)(gp,Y.RGB5_A1,"rgb5 a1"),(0,ae.Z)(gp,Y.RGB565,"rgb565"),(0,ae.Z)(gp,Y.DEPTH_COMPONENT,"depth"),(0,ae.Z)(gp,Y.DEPTH_STENCIL,"depth stencil"),gp),oP=(Em={},(0,ae.Z)(Em,Y.DONT_CARE,"dont care"),(0,ae.Z)(Em,Y.NICEST,"nice"),(0,ae.Z)(Em,Y.FASTEST,"fast"),Em),I2=(Tv={},(0,ae.Z)(Tv,Y.NEAREST,"nearest"),(0,ae.Z)(Tv,Y.LINEAR,"linear"),(0,ae.Z)(Tv,Y.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,ae.Z)(Tv,Y.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,ae.Z)(Tv,Y.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,ae.Z)(Tv,Y.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Tv),P2=(Cm={},(0,ae.Z)(Cm,Y.REPEAT,"repeat"),(0,ae.Z)(Cm,Y.CLAMP_TO_EDGE,"clamp"),(0,ae.Z)(Cm,Y.MIRRORED_REPEAT,"mirror"),Cm),sP=(bg={},(0,ae.Z)(bg,Y.NONE,"none"),(0,ae.Z)(bg,Y.BROWSER_DEFAULT_WEBGL,"browser"),bg),uP=(xd={},(0,ae.Z)(xd,Y.NEVER,"never"),(0,ae.Z)(xd,Y.ALWAYS,"always"),(0,ae.Z)(xd,Y.LESS,"less"),(0,ae.Z)(xd,Y.LEQUAL,"lequal"),(0,ae.Z)(xd,Y.GREATER,"greater"),(0,ae.Z)(xd,Y.GEQUAL,"gequal"),(0,ae.Z)(xd,Y.EQUAL,"equal"),(0,ae.Z)(xd,Y.NOTEQUAL,"notequal"),xd),k2=(r0={},(0,ae.Z)(r0,Y.FUNC_ADD,"add"),(0,ae.Z)(r0,Y.MIN_EXT,"min"),(0,ae.Z)(r0,Y.MAX_EXT,"max"),(0,ae.Z)(r0,Y.FUNC_SUBTRACT,"subtract"),(0,ae.Z)(r0,Y.FUNC_REVERSE_SUBTRACT,"reverse subtract"),r0),Cg=($c={},(0,ae.Z)($c,Y.ZERO,"zero"),(0,ae.Z)($c,Y.ONE,"one"),(0,ae.Z)($c,Y.SRC_COLOR,"src color"),(0,ae.Z)($c,Y.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,ae.Z)($c,Y.SRC_ALPHA,"src alpha"),(0,ae.Z)($c,Y.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,ae.Z)($c,Y.DST_COLOR,"dst color"),(0,ae.Z)($c,Y.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,ae.Z)($c,Y.DST_ALPHA,"dst alpha"),(0,ae.Z)($c,Y.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,ae.Z)($c,Y.CONSTANT_COLOR,"constant color"),(0,ae.Z)($c,Y.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,ae.Z)($c,Y.CONSTANT_ALPHA,"constant alpha"),(0,ae.Z)($c,Y.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,ae.Z)($c,Y.SRC_ALPHA_SATURATE,"src alpha saturate"),$c),lP=(bd={},(0,ae.Z)(bd,Y.NEVER,"never"),(0,ae.Z)(bd,Y.ALWAYS,"always"),(0,ae.Z)(bd,Y.LESS,"less"),(0,ae.Z)(bd,Y.LEQUAL,"lequal"),(0,ae.Z)(bd,Y.GREATER,"greater"),(0,ae.Z)(bd,Y.GEQUAL,"gequal"),(0,ae.Z)(bd,Y.EQUAL,"equal"),(0,ae.Z)(bd,Y.NOTEQUAL,"notequal"),bd),z0=(Ed={},(0,ae.Z)(Ed,Y.ZERO,"zero"),(0,ae.Z)(Ed,Y.KEEP,"keep"),(0,ae.Z)(Ed,Y.REPLACE,"replace"),(0,ae.Z)(Ed,Y.INVERT,"invert"),(0,ae.Z)(Ed,Y.INCR,"increment"),(0,ae.Z)(Ed,Y.DECR,"decrement"),(0,ae.Z)(Ed,Y.INCR_WRAP,"increment wrap"),(0,ae.Z)(Ed,Y.DECR_WRAP,"decrement wrap"),Ed),cP=(Eg={},(0,ae.Z)(Eg,Y.FRONT,"front"),(0,ae.Z)(Eg,Y.BACK,"back"),Eg),fP=function(){function e(a,t){(0,Ht.Z)(this,e);var n=t.data,r=t.usage,o=t.type;this.buffer=a.buffer({data:n,usage:M2[r||Y.STATIC_DRAW],type:Oy[o||Y.UNSIGNED_BYTE]})}return(0,Rt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,r=t.offset;this.buffer.subdata(n,r)}}]),e}(),hP=function(){function e(a,t){(0,Ht.Z)(this,e);var n=t.data,r=t.usage,o=t.type,u=t.count;this.elements=a.elements({data:n,usage:M2[r||Y.STATIC_DRAW],type:Oy[o||Y.UNSIGNED_BYTE],count:u})}return(0,Rt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),pP=function(){function e(a,t){(0,Ht.Z)(this,e);var n=t.width,r=t.height,o=t.color,u=t.colors,h=t.depth,d=t.stencil,m={width:n,height:r};Array.isArray(u)&&(m.colors=u.map(function(b){return b.get()})),o&&typeof o!="boolean"&&(m.color=o.get()),this.framebuffer=a.framebuffer(m)}return(0,Rt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.framebuffer.resize(n,r)}}]),e}(),dP=function(){function e(a,t){(0,Ht.Z)(this,e),(0,ae.Z)(this,"destroyed",!1),(0,ae.Z)(this,"uniforms",{}),this.reGl=a;var n=t.vs,r=t.fs,o=t.attributes,u=t.uniforms,h=t.primitive,d=t.count,m=t.elements,b=t.depth,A=t.blend,P=t.stencil,L=t.cull,B=t.instances,Z={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Ce){Z[Ce]=a.prop(Ce)}));var j={};Object.keys(o).forEach(function(Ce){j[Ce]=o[Ce].get()});var J={attributes:j,frag:r,uniforms:Z,vert:n,blend:{},primitive:iP[h===void 0?Y.TRIANGLES:h]};B&&(J.instances=B),d?J.count=d:m&&(J.elements=m.get()),this.initDepthDrawParams({depth:b},J),this.initBlendDrawParams({blend:A},J),this.initStencilDrawParams({stencil:P},J),this.initCullDrawParams({cull:L},J),this.drawCommand=a(J);var fe=(0,l.cloneDeep)(J);fe.blend=(0,Q.Z)((0,Q.Z)({},fe.blend),{},{enable:!1}),this.drawPickCommand=a(fe),this.drawParams=J}return(0,Rt.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var r={};Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var o=(0,l.cloneDeep)(this.drawParams);o.blend=(0,Q.Z)((0,Q.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(o){n[o]=t[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var r=(0,l.cloneDeep)(this.drawParams);r.blend=(0,Q.Z)((0,Q.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(t){this.uniforms=(0,Q.Z)((0,Q.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,Q.Z)((0,Q.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var h=(0,le.Z)(r[u]);h==="boolean"||h==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),n?this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:uP[r.func||Y.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var o=r.enable,u=r.func,h=r.equation,d=r.color,m=d===void 0?[0,0,0,0]:d;n.blend={enable:!!o,func:{srcRGB:Cg[u&&u.srcRGB||Y.SRC_ALPHA],srcAlpha:Cg[u&&u.srcAlpha||Y.SRC_ALPHA],dstRGB:Cg[u&&u.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:Cg[u&&u.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:k2[h&&h.rgb||Y.FUNC_ADD],alpha:k2[h&&h.alpha||Y.FUNC_ADD]},color:m}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var o=r.enable,u=r.mask,h=u===void 0?-1:u,d=r.func,m=d===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:d,b=r.opFront,A=b===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:b,P=r.opBack,L=P===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:P;n.stencil={enable:!!o,mask:h,func:(0,Q.Z)((0,Q.Z)({},m),{},{cmp:lP[m.cmp]}),opFront:{fail:z0[A.fail],zfail:z0[A.zfail],zpass:z0[A.zpass]},opBack:{fail:z0[L.fail],zfail:z0[L.zfail],zpass:z0[L.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var o=r.enable,u=r.face,h=u===void 0?Y.BACK:u;n.cull={enable:!!o,face:cP[h]}}}},{key:"extractUniforms",value:function(t){var n=this,r={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,n,r,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,l.isTypedArray)(n)||n===""||"resize"in n){r["".concat(o&&o+".").concat(t)]=n;return}(0,l.isPlainObject)(n)&&Object.keys(n).forEach(function(h){u.extractUniformsRecursively(h,n[h],r,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(h,d){Object.keys(h).forEach(function(m){u.extractUniformsRecursively(m,h[m],r,"".concat(o&&o+".").concat(t,"[").concat(d,"]"))})})}}]),e}(),vP=function(){function e(a,t){(0,Ht.Z)(this,e),(0,ae.Z)(this,"isDistroy",!1);var n=t.data,r=t.type,o=r===void 0?Y.UNSIGNED_BYTE:r,u=t.width,h=t.height,d=t.flipY,m=d===void 0?!1:d,b=t.format,A=b===void 0?Y.RGBA:b,P=t.mipmap,L=P===void 0?!1:P,B=t.wrapS,Z=B===void 0?Y.CLAMP_TO_EDGE:B,j=t.wrapT,J=j===void 0?Y.CLAMP_TO_EDGE:j,fe=t.aniso,Ce=fe===void 0?0:fe,Ve=t.alignment,tt=Ve===void 0?1:Ve,st=t.premultiplyAlpha,Bt=st===void 0?!1:st,Xt=t.mag,cr=Xt===void 0?Y.NEAREST:Xt,Ir=t.min,wr=Ir===void 0?Y.NEAREST:Ir,Qr=t.colorSpace,Fn=Qr===void 0?Y.BROWSER_DEFAULT_WEBGL:Qr,ci=t.x,Ba=ci===void 0?0:ci,Ya=t.y,Is=Ya===void 0?0:Ya,Iu=t.copy,gu=Iu===void 0?!1:Iu;this.width=u,this.height=h;var vf={width:u,height:h,type:Oy[o],format:aP[A],wrapS:P2[Z],wrapT:P2[J],mag:I2[cr],min:I2[wr],alignment:tt,flipY:m,colorSpace:sP[Fn],premultiplyAlpha:Bt,aniso:Ce,x:Ba,y:Is,copy:gu};n&&(vf.data=n),typeof L=="number"?vf.mipmap=oP[L]:typeof L=="boolean"&&(vf.mipmap=L),this.texture=a.texture(vf)}return(0,Rt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.texture.resize(n,r),this.width=n,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),L2,O2,mP=(L2=(0,$r.b2)(),L2(O2=function(){function e(){var a=this;(0,Ht.Z)(this,e),(0,ae.Z)(this,"createModel",function(t){return new dP(a.gl,t)}),(0,ae.Z)(this,"createAttribute",function(t){return new nP(a.gl,t)}),(0,ae.Z)(this,"createBuffer",function(t){return new fP(a.gl,t)}),(0,ae.Z)(this,"createElements",function(t){return new hP(a.gl,t)}),(0,ae.Z)(this,"createTexture2D",function(t){return new vP(a.gl,t)}),(0,ae.Z)(this,"createFramebuffer",function(t){return new pP(a.gl,t)}),(0,ae.Z)(this,"useFramebuffer",function(t,n){a.gl({framebuffer:t?t.get():null})(n)}),(0,ae.Z)(this,"clear",function(t){var n,r=t.color,o=t.depth,u=t.stencil,h=t.framebuffer,d=h===void 0?null:h,m={color:r,depth:o,stencil:u};m.framebuffer=d===null?d:d.get(),(n=a.gl)===null||n===void 0||n.clear(m)}),(0,ae.Z)(this,"viewport",function(t){var n=t.x,r=t.y,o=t.width,u=t.height;a.gl._gl.viewport(n,r,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,ae.Z)(this,"readPixels",function(t){var n=t.framebuffer,r=t.x,o=t.y,u=t.width,h=t.height,d={x:r,y:o,width:u,height:h};return n&&(d.framebuffer=n.get()),a.gl.read(d)}),(0,ae.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,ae.Z)(this,"getContainer",function(){if(Eu)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,ae.Z)(this,"getCanvas",function(){return a.canvas}),(0,ae.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,ae.Z)(this,"destroy",function(){var t,n,r;a.canvas=null,(t=a.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(r=n.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),a.gl.destroy(),a.gl=null})}return(0,Rt.Z)(e,[{key:"init",value:function(){var a=(0,xa.Z)(di().mark(function n(r,o,u){var h=this;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.canvas=r,!u){m.next=5;break}this.gl=u,m.next=8;break;case 5:return m.next=7,new Promise(function(b,A){rP()({canvas:h.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(L,B){(L||!B)&&A(L),b(B)}})});case 7:this.gl=m.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return m.stop()}},n,this)}));function t(n,r,o){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||O2),gP=function(){function e(a){(0,Ht.Z)(this,e);var t=a.id,n=a.map,r=a.canvas,o=a.hasBaseMap,u=aS();this.container=u,n.setContainer(u,t,r,o),u.bind(rr.IRendererService).to(mP).inSingletonScope(),this.sceneService=u.get(rr.ISceneService),this.mapService=u.get(rr.IMapService),this.iconService=u.get(rr.IIconService),this.fontService=u.get(rr.IFontService),this.controlService=u.get(rr.IControlService),this.layerService=u.get(rr.ILayerService),this.markerService=u.get(rr.IMarkerService),this.interactionService=u.get(rr.IInteractionService),this.popupService=u.get(rr.IPopupService),Eu?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,Rt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(n);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=Hg(this.container);t.setContainer(n,this.container),this.sceneService.addLayer(t);var r=t.getLayerConfig();if(r){var o=r.mask,u=r.maskfence,h=r.maskColor,d=h===void 0?"#000":h,m=r.maskOpacity,b=m===void 0?0:m;if(o&&u){var A=new O1().source(u).shape("fill").color(d).style({opacity:b});this.addMask(A,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,n){var r=this.getLayer(n);if(r){var o=Hg(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,n){this.layerService.remove(t,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(r){var o=(0,Pr.Z)(r,2),u=o[0],h=o[1];n.fontService.addIconFont(u,h)})}},{key:"addFontFace",value:function(t,n){this.sceneService.addFontFace(t,n)}},{key:"addImage",value:function(t,n){Eu?this.iconService.addImageMini(t,n,this.sceneService):this.iconService.addImage(t,n)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.on(t,n)}},{key:"once",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.once(t,n):this.sceneService.once(t,n)}},{key:"off",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.off(t,n):this.sceneService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,n||(0,Q.Z)((0,Q.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(rr.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:El(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,r=t.logoPosition;n&&this.addControl(new AS({position:r}))}}]),e}(),fO="2.9.26";function R2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function hO(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?R2(Object(t),!0).forEach(function(n){yP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function pO(e,a){return EP(e)||bP(e,a)||xP(e,a)||_P()}function _P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xP(e,a){if(!!e){if(typeof e=="string")return D2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return D2(e,a)}}function D2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function bP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function EP(e){if(Array.isArray(e))return e}var dO=null,vO=null,F2,Ry,B2,CP=(F2=Gg(rr.IGlobalConfigService),Ry=function(){function e(a){(0,Ht.Z)(this,e),ga(this,"configService",B2,this),this.config=a}return(0,Rt.Z)(e,[{key:"setContainer",value:function(t,n,r,o){t.bind(rr.MapConfig).toConstantValue((0,Q.Z)((0,Q.Z)({},this.config),{},{id:n,canvas:r,hasBaseMap:o})),t.bind(rr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),B2=wa(Ry.prototype,"configService",[F2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry),SP=ue(6158),Sm=ue.n(SP);function Am(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Sg(e,a){var t=Y0([],a,e);return m0(t,t,1/t[3]),t}function mO(e,a){var t=e%a;return t<0?a+t:t}function gO(e,a,t){return t*a+(1-t)*e}function n0(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var Vp=Math.PI,N2=Vp/4,Kd=Vp/180,z2=180/Vp,Dy=512,Fy=4003e4,AP=1.5;function U2(e){return Math.pow(2,e)}function wP(e){return Math.log2(e)}function Ag(e,a){var t=(0,Pr.Z)(e,2),n=t[0],r=t[1];n0(Number.isFinite(n)&&Number.isFinite(a)),n0(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),a*=Dy;var o=n*Kd,u=r*Kd,h=a*(o+Vp)/(2*Vp),d=a*(Vp-Math.log(Math.tan(N2+u*.5)))/(2*Vp);return[h,d]}function By(e,a){var t=(0,Pr.Z)(e,2),n=t[0],r=t[1];a*=Dy;var o=n/a*(2*Vp)-Vp,u=2*(Math.atan(Math.exp(Vp-r/a*(2*Vp)))-N2);return[o*z2,u*z2]}function yO(e){var a=e.latitude;assert(Number.isFinite(a));var t=Math.cos(a*Kd);return wP(Fy*t)-9}function Z2(e){var a=e.latitude,t=e.longitude,n=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:U2(n),n0(Number.isFinite(a)&&Number.isFinite(t)&&Number.isFinite(r));var h={},d=Dy*r,m=Math.cos(a*Kd),b=d/360,A=b/m,P=d/Fy/m;if(h.pixelsPerMeter=[P,-P,P],h.metersPerPixel=[1/P,-1/P,1/P],h.pixelsPerDegree=[b,-A,P],h.degreesPerPixel=[1/b,-1/A,1/P],u){var L=Kd*Math.tan(a*Kd)/m,B=b*L/2,Z=d/Fy*L,j=Z/A*P;h.pixelsPerDegree2=[0,-B,Z],h.pixelsPerMeter2=[j,0,j]}return h}function _O(e,a){var t=_slicedToArray(e,3),n=t[0],r=t[1],o=t[2],u=_slicedToArray(a,3),h=u[0],d=u[1],m=u[2],b=1,A=Z2({longitude:n,latitude:r,scale:b,highPrecision:!0}),P=A.pixelsPerMeter,L=A.pixelsPerMeter2,B=Ag(e,b);B[0]+=h*(P[0]+L[0]*d),B[1]+=d*(P[1]+L[1]*d);var Z=By(B,b),j=(o||0)+(m||0);return Number.isFinite(o)||Number.isFinite(m)?[Z[0],Z[1],j]:Z}function TP(e){var a=e.height,t=e.pitch,n=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,h=e.flipY,d=h===void 0?!1:h,m=Am();return Ql(m,m,[0,0,-r]),_h(m,m,[1,1,1/a]),zh(m,m,-t*Kd),fd(m,m,n*Kd),d&&_h(m,m,[1,-1,1]),u&&Ql(m,m,Qo.negate([],u)),m}function MP(e){var a=e.width,t=e.height,n=e.altitude,r=n===void 0?AP:n,o=e.pitch,u=o===void 0?0:o,h=e.nearZMultiplier,d=h===void 0?1:h,m=e.farZMultiplier,b=m===void 0?1:m,A=u*Kd,P=Math.atan(.5/r),L=Math.sin(P)*r/Math.sin(Math.PI/2-A-P),B=Math.cos(Math.PI/2-A)*L+r;return{fov:2*Math.atan(t/2/r),aspect:a/t,focalDistance:r,near:d,far:B*b}}function IP(e){var a=e.width,t=e.height,n=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,h=MP({width:a,height:t,altitude:r,pitch:n,nearZMultiplier:o,farZMultiplier:u}),d=h.fov,m=h.aspect,b=h.near,A=h.far,P=uv([],d,m,b,A);return P}function PP(e,a){var t=(0,Pr.Z)(e,3),n=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return n0(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(u)),Sg(a,[n,r,u,1])}function V2(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Pr.Z)(e,3),r=n[0],o=n[1],u=n[2];if(n0(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var h=Sg(a,[r,o,u,1]);return h}var d=Sg(a,[r,o,0,1]),m=Sg(a,[r,o,1,1]),b=d[2],A=m[2],P=b===A?0:((t||0)-b)/(A-b);return cn.t7([],d,m,P)}var j2=Am(),kP=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a.width,n=a.height,r=a.viewMatrix,o=r===void 0?j2:r,u=a.projectionMatrix,h=u===void 0?j2:u;(0,Ht.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=h;var d=Am();Ol(d,d,this.projectionMatrix),Ol(d,d,this.viewMatrix),this.viewProjectionMatrix=d;var m=Am();_h(m,m,[this.width/2,-this.height/2,1]),Ql(m,m,[1,-1,0]),Ol(m,m,this.viewProjectionMatrix);var b=jf(Am(),m);if(!b)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=m,this.pixelUnprojectionMatrix=b,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Rt.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Zh(t.projectionMatrix,this.projectionMatrix)&&Zh(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),h=PP(u,this.pixelProjectionMatrix),d=(0,Pr.Z)(h,2),m=d[0],b=d[1],A=o?b:this.height-b;return t.length===2?[m,A]:[m,A,h[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=n.targetZ,h=(0,Pr.Z)(t,3),d=h[0],m=h[1],b=h[2],A=o?m:this.height-m,P=u&&u*this.pixelsPerMeter,L=V2([d,A,b],this.pixelUnprojectionMatrix,P),B=this.unprojectPosition(L),Z=(0,Pr.Z)(B,3),j=Z[0],J=Z[1],fe=Z[2];return Number.isFinite(b)?[j,J,fe]:Number.isFinite(u)?[j,J,u]:[j,J]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),r=(0,Pr.Z)(n,2),o=r[0],u=r[1],h=(t[2]||0)*this.pixelsPerMeter;return[o,u,h]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),r=(0,Pr.Z)(n,2),o=r[0],u=r[1],h=(t[2]||0)/this.pixelsPerMeter;return[o,u,h]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function LP(e){var a=e.width,t=e.height,n=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,h=u===void 0?24:u,d=e.padding,m=d===void 0?0:d,b=e.offset,A=b===void 0?[0,0]:b,P=(0,Pr.Z)(n,2),L=(0,Pr.Z)(P[0],2),B=L[0],Z=L[1],j=(0,Pr.Z)(P[1],2),J=j[0],fe=j[1];if(Number.isFinite(m)){var Ce=m;m={top:Ce,bottom:Ce,left:Ce,right:Ce}}else n0(Number.isFinite(m.top)&&Number.isFinite(m.bottom)&&Number.isFinite(m.left)&&Number.isFinite(m.right));var Ve=new G2({width:a,height:t,longitude:0,latitude:0,zoom:0}),tt=Ve.project([B,fe]),st=Ve.project([J,Z]),Bt=[Math.max(Math.abs(st[0]-tt[0]),o),Math.max(Math.abs(st[1]-tt[1]),o)],Xt=[a-m.left-m.right-Math.abs(A[0])*2,t-m.top-m.bottom-Math.abs(A[1])*2];n0(Xt[0]>0&&Xt[1]>0);var cr=Xt[0]/Bt[0],Ir=Xt[1]/Bt[1],wr=(m.right-m.left)/2/cr,Qr=(m.bottom-m.top)/2/Ir,Fn=[(st[0]+tt[0])/2+wr,(st[1]+tt[1])/2+Qr],ci=Ve.unproject(Fn),Ba=Ve.zoom+Math.log2(Math.abs(Math.min(cr,Ir)));return{longitude:ci[0],latitude:ci[1],zoom:Math.min(Ba,h)}}var G2=function(e){(0,Or.Z)(a,e);function a(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,o=n.height,u=n.latitude,h=u===void 0?0:u,d=n.longitude,m=d===void 0?0:d,b=n.zoom,A=b===void 0?0:b,P=n.pitch,L=P===void 0?0:P,B=n.bearing,Z=B===void 0?0:B,j=n.altitude,J=j===void 0?1.5:j,fe=n.nearZMultiplier,Ce=n.farZMultiplier;(0,Ht.Z)(this,a),r=r||1,o=o||1;var Ve=U2(A);J=Math.max(.75,J);var tt=Ag([m,h],Ve);tt[2]=0;var st=IP({width:r,height:o,pitch:L,bearing:Z,altitude:J,nearZMultiplier:fe||1/o,farZMultiplier:Ce||1.01}),Bt=TP({height:o,center:tt,pitch:L,bearing:Z,altitude:J,flipY:!0});return t=(0,Dr.Z)(this,(0,Mt.Z)(a).call(this,{width:r,height:o,viewMatrix:Bt,projectionMatrix:st})),t.latitude=h,t.longitude=m,t.zoom=A,t.pitch=L,t.bearing=Z,t.altitude=J,t.scale=Ve,t.center=tt,t.pixelsPerMeter=Z2((0,At.Z)((0,At.Z)(t))).pixelsPerMeter[2],Object.freeze((0,At.Z)((0,At.Z)(t))),t}return(0,Rt.Z)(a,[{key:"projectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Ag(n,r)}},{key:"unprojectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return By(n,r)}},{key:"getMapCenterByLngLatPosition",value:function(n){var r=n.lngLat,o=n.pos,u=V2(o,this.pixelUnprojectionMatrix),h=Ag(r,this.scale),d=cn.IH([],h,cn.tk([],u)),m=cn.IH([],this.center,d);return By(m,this.scale)}},{key:"getLocationAtPoint",value:function(n){var r=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,h=LP(Object.assign({width:o,height:u,bounds:n},r)),d=h.longitude,m=h.latitude,b=h.zoom;return new a({width:o,height:u,longitude:d,latitude:m,zoom:b})}}]),a}(kP),OP=function(){function e(){(0,Ht.Z)(this,e)}return(0,Rt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,r=t.zoom,o=t.pitch,u=t.bearing,h=t.viewportHeight,d=t.viewportWidth;this.viewport=new G2({width:d,height:h,longitude:n&&n[0],latitude:n&&n[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),RP=function(){function e(a){(0,Ht.Z)(this,e),(0,ae.Z)(this,"size",1e4),this.size=a||1e4}return(0,Rt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[n,r]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[n,r]}}]),e}(),H2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},DP=["id","attributionControl","style","token","rotation","mapInstance"],W2,X2,Y2,q2,$2,K2,U0,Q2,J2,eE,tE;function FP(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}FP(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Sm();var rE={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},BP=0,NP=12,nE="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",zP=(W2=(0,$r.b2)(),X2=(0,$r.f3)(rr.MapConfig),Y2=(0,$r.f3)(rr.IGlobalConfigService),q2=(0,$r.f3)(rr.ICoordinateSystemService),$2=(0,$r.f3)(rr.IEventEmitter),W2(K2=(U0=function(){function e(){var a=this;(0,Ht.Z)(this,e),(0,ae.Z)(this,"version",Vu.MAPBOX),(0,ae.Z)(this,"simpleMapCoord",new RP),(0,ae.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ga(this,"config",Q2,this),ga(this,"configService",J2,this),ga(this,"coordinateSystemService",eE,this),ga(this,"eventEmitter",tE,this),(0,ae.Z)(this,"handleCameraChanged",function(){var t=a.map.getCenter().wrap(),n=t.lat,r=t.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[r,n],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0});var o=a.config.offsetZoom,u=o===void 0?NP:o;a.viewport.getZoom()>u?a.coordinateSystemService.setCoordinateSystem(zp.LNGLAT_OFFSET):a.coordinateSystemService.setCoordinateSystem(zp.LNGLAT),a.cameraChangedCallback(a.viewport)})}return(0,Rt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Mo("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){gS.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(rE[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(rE[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},r=this.lngLatToMercator(t,0),o=r.x,u=r.y;return[o-n.x,u-n.y]}},{key:"lngLatToMercator",value:function(t,n){var r=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),o=r.x,u=o===void 0?0:o,h=r.y,d=h===void 0?0:h,m=r.z,b=m===void 0?0:m;return{x:u,y:d,z:b}}},{key:"getModelMatrix",value:function(t,n,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},h=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),d=h.meterInMercatorCoordinateUnits(),m=Xc();return Ql(m,m,Qo.fromValues(h.x-u.x,h.y-u.y,h.z||0-u.z)),_h(m,m,Qo.fromValues(d*o[0],-d*o[1],d*o[2])),zh(m,m,r[0]),Dd(m,m,r[1]),fd(m,m,r[2]),m}},{key:"init",value:function(){var a=(0,xa.Z)(di().mark(function n(){var r,o,u,h,d,m,b,A,P,L,B,Z,j;return di().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:r=this.config,o=r.id,u=o===void 0?"map":o,h=r.attributionControl,d=h===void 0?!1:h,m=r.style,b=m===void 0?"light":m,A=r.token,P=A===void 0?nE:A,L=r.rotation,B=L===void 0?0:L,Z=r.mapInstance,j=(0,pe.Z)(r,DP),this.viewport=new OP,!Z&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),P===nE&&b!=="blank"&&!window.mapboxgl.accessToken&&!Z&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Z&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=P),Z?(this.map=Z,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(u),this.map=new window.mapboxgl.Map((0,Q.Z)({container:this.$mapContainer,style:this.getMapStyle(b),attributionControl:d,bearing:B},j))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return fe.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[t].concat(o))}},{key:"once",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var r=new(Sm()).LngLat(t[0],t[1]),o=new(Sm()).LngLat(n[0],n[1]),u=r.distanceTo(o),h=Sm().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),d=Sm().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),m=h.x,b=h.y,A=d.x,P=d.y,L=Math.sqrt(Math.pow(m-A,2)+Math.pow(b-P,2))*4194304*2;return L/u}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),r=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.id="l7_mapbox_div"+BP++,n.appendChild(r),r}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:H2[t]?H2[t]:t}}]),e}(),Q2=wa(U0.prototype,"config",[X2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J2=wa(U0.prototype,"configService",[Y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=wa(U0.prototype,"coordinateSystemService",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tE=wa(U0.prototype,"eventEmitter",[$2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U0))||K2);function UP(e){var a=ZP();return function(){var n=(0,Mt.Z)(e),r;if(a){var o=(0,Mt.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Dr.Z)(this,r)}}function ZP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function VP(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}VP(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var jP=function(e){(0,Or.Z)(t,e);var a=UP(t);function t(){return(0,Ht.Z)(this,t),a.apply(this,arguments)}return(0,Rt.Z)(t,[{key:"getServiceConstructor",value:function(){return zP}}]),t}(CP);function iE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function aE(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?iE(Object(t),!0).forEach(function(n){GP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):iE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function GP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function HP(e,a){return qP(e)||YP(e,a)||XP(e,a)||WP()}function WP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XP(e,a){if(!!e){if(typeof e=="string")return oE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oE(e,a)}}function oE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function YP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function qP(e){if(Array.isArray(e))return e}var $P=ge.memo(function(e){var a=e.style,t=e.className,n=e.map,r=e.option,o=e.onSceneLoaded,u=(0,ge.createRef)(),h=(0,ge.useState)(),d=HP(h,2),m=d[0],b=d[1];return(0,ge.useEffect)(function(){var A=new gP(aE(aE({id:u.current},r),{},{map:new jP(n)}));return A.on("loaded",function(){b(A),o&&o(A)}),function(){A.destroy()}},[]),(0,ge.useEffect)(function(){m&&n.style&&m.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ge.useEffect)(function(){m&&n.zoom&&m.setZoom(n.zoom)},[n.zoom]),(0,ge.useEffect)(function(){m&&n.center&&m.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ge.useEffect)(function(){m&&n.pitch!==void 0&&m.setPitch(n.pitch||0)},[n.pitch]),(0,ge.useEffect)(function(){m&&n.rotation&&m.setRotation(n.rotation)},[n.rotation]),ge.createElement(y.Provider,{value:m},(0,ge.createElement)("div",{ref:u,style:a,className:t},m&&e.children))}),KP=$P;function sE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function xO(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?sE(Object(t),!0).forEach(function(n){QP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function QP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function bO(e,a){return rk(e)||tk(e,a)||ek(e,a)||JP()}function JP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ek(e,a){if(!!e){if(typeof e=="string")return uE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return uE(e,a)}}function uE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function tk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function rk(e){if(Array.isArray(e))return e}var EO=null,CO=null;function lE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function SO(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?lE(Object(t),!0).forEach(function(n){nk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function nk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function AO(e,a){return sk(e)||ok(e,a)||ak(e,a)||ik()}function ik(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ak(e,a){if(!!e){if(typeof e=="string")return cE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cE(e,a)}}function cE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function ok(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function sk(e){if(Array.isArray(e))return e}var wO=null,TO=null;function MO(e,a){return fk(e)||ck(e,a)||lk(e,a)||uk()}function uk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lk(e,a){if(!!e){if(typeof e=="string")return fE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fE(e,a)}}function fE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function ck(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function fk(e){if(Array.isArray(e))return e}var IO=null,PO=null;function hE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function kO(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?hE(Object(t),!0).forEach(function(n){hk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function LO(e,a){if(e==null)return{};var t=pk(e,a),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(a.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function pk(e,a){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var OO=null,pE=ue(73935);function dE(e,a){return gk(e)||mk(e,a)||vk(e,a)||dk()}function dk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vk(e,a){if(!!e){if(typeof e=="string")return vE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return vE(e,a)}}function vE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function mk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function gk(e){if(Array.isArray(e))return e}var mE=ge.useEffect,gE=ge.useState,yk=/\B([A-Z])/g,_k=function(a){return a.replace(yk,"-$1").toLowerCase()};function RO(e){var a=e.className,t=e.style,n=e.children,r=e.position,o=gE(),u=dE(o,2),h=u[0],d=u[1],m=useSceneValue(),b=gE(function(){return document.createElement("div")}),A=dE(b,1),P=A[0];return mE(function(){var L=new Control({position:r});return L.onAdd=function(){if(a&&(P.className=a),t){var B=Object.keys(t).map(function(Z){return"".concat(_k(Z),":").concat(t[Z])}).join(";");P.style.cssText=B}return P},L.onRemove=function(){},d(L),m.addControl(L),function(){m.removeControl(L)}},[]),mE(function(){h&&h.setPosition(r||"bottomleft")},[r]),createPortal(n,P)}var yE=(0,ge.createContext)({});function DO(){return useContext(yE)}var FO=ge.useEffect,xk=ge.memo(function(a){var t=a.layer,n=a.active;return t.active(n.option),null},l.isEqual),BO=ge.useEffect,bk=ge.memo(function(a){var t=a.layer,n=a.animate;return t.animate(n),null},l.isEqual),NO=ge.useEffect,Ek=ge.memo(function(a){var t=a.layer,n=a.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},l.isEqual),Ck=ge.memo(function(a){var t=a.layer,n=a.filter;return n.field&&t.filter(n.field,n.values),null},l.isEqual),Sk=ge.memo(function(a){var t=a.layer,n=a.scale;return t.scale(n.values),null},l.isEqual),zO=ge.useEffect,Ak=ge.memo(function(a){var t=a.layer,n=a.select;return t.select(n.option),null},l.isEqual),wk=ge.memo(function(a){var t=a.layer,n=a.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},l.isEqual),Tk=ge.memo(function(a){var t=a.layer,n=a.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},l.isEqual),Mk=["data"];function Ik(e,a){if(e==null)return{};var t=Pk(e,a),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(a.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function Pk(e,a){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var kk=ge.memo(function(a){var t=a.layer,n=a.source,r=n.data,o=Ik(n,Mk);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},l.isEqual),UO=ge.useEffect,Lk=ge.memo(function(a){var t=a.layer,n=a.style;return t.style(n),null},l.isEqual);function Ok(e,a){return Bk(e)||Fk(e,a)||Dk(e,a)||Rk()}function Rk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dk(e,a){if(!!e){if(typeof e=="string")return _E(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _E(e,a)}}function _E(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Fk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(d){o=!0,h=d}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function Bk(e){if(Array.isArray(e))return e}var wm=ge.useEffect,Nk=ge.useState;function xE(e,a){var t=a.source,n=a.color,r=a.shape,o=a.style,u=a.size,h=a.scale,d=a.active,m=a.select,b=a.filter,A=a.animate,P=a.options,L=a.onLayerLoaded,B=Fe(),Z=Nk(function(){var fe;switch(e){case"polygonLayer":fe=new gx(P);break;case"lineLayer":fe=new XM(P);break;case"pointLayer":fe=new G5(P);break;case"heatmapLayer":fe=new $A(P);break;case"rasterLayer":fe=new A3(P);break;case"imageLayer":fe=new L1(P);break;case"citybuildingLayer":fe=new bA(P);break;default:fe=new gx(P)}return fe.on("inited",function(){L&&L(fe,B)}),fe}),j=Ok(Z,1),J=j[0];return wm(function(){return B.addLayer(J),function(){B.removeLayer(J)}},[]),wm(function(){J.inited&&P&&J.updateLayerConfig(P)},[P==null?void 0:P.minZoom,P==null?void 0:P.maxZoom,P==null?void 0:P.visible]),wm(function(){J.inited&&(P==null?void 0:P.zIndex)&&J.setIndex(P.zIndex)},[P==null?void 0:P.zIndex]),wm(function(){J.inited&&(P==null?void 0:P.blend)&&J.setBlend(P.blend)},[P==null?void 0:P.blend]),wm(function(){B.render()}),ge.createElement(yE.Provider,{value:J},ge.createElement(kk,{layer:J,source:t}),h&&ge.createElement(Sk,{layer:J,scale:h}),n&&ge.createElement(Ek,{layer:J,color:n}),u&&ge.createElement(Tk,{layer:J,size:u}),r&&ge.createElement(wk,{layer:J,shape:r}),o&&ge.createElement(Lk,{layer:J,style:o}),d&&ge.createElement(xk,{layer:J,active:d}),m&&ge.createElement(Ak,{layer:J,select:m}),b&&ge.createElement(Ck,{layer:J,filter:b}),A&&ge.createElement(bk,{layer:J,animate:A}),a.children)}var ZO=null,VO=null,zk=ge.memo(function(a){return xE("pointLayer",a)}),Uk=ge.memo(function(a){return xE("heatmapLayer",a)}),jO=null,GO=null,HO=null,WO=ge.useEffect,XO=null,YO=null;function wg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?wg=function(t){return typeof t}:wg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wg(e)}function bE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Tg(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?bE(Object(t),!0).forEach(function(n){Zk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Zk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Vk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function EE(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jk(e,a,t){return a&&EE(e.prototype,a),t&&EE(e,t),e}function Gk(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&Ny(e,a)}function Ny(e,a){return Ny=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Ny(e,a)}function Hk(e){var a=Yk();return function(){var n=Mg(e),r;if(a){var o=Mg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Wk(this,r)}}function Wk(e,a){if(a&&(wg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xk(e)}function Xk(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Mg(e){return Mg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mg(e)}var qO=function(e){Gk(t,e);var a=Hk(t);function t(n){var r;return Vk(this,t),r=a.call(this,n),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return jk(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,h=o.children,d=o.option,m=o.lngLat,b=new a1(Tg(Tg({},d),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&b.setLnglat(u),m&&b.setLnglat(m),h&&b.setDOMContent(this.el),this.popup=b,this.scene.addPopup(b)}},{key:"componentDidUpdate",value:function(r){var o,u,h,d,m,b,A=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],P=Array.isArray(this.props.lnglat)?this.props.lnglat:[(h=this.props)===null||h===void 0||(d=h.lnglat)===null||d===void 0?void 0:d.lng,(m=this.props)===null||m===void 0||(b=m.lnglat)===null||b===void 0?void 0:b.lat],L=A.toString()!==P.toString();if(L){var B;this.popup.remove(),this.popup=new a1(Tg(Tg({},this.props.option),{},{stopPropagation:(B=this.props.option)===null||B===void 0?void 0:B.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return ge.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,pE.createPortal)(r.props.children,r.el)})}}]),t}(ge.PureComponent);function Ig(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ig=function(t){return typeof t}:Ig=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ig(e)}function qk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function CE(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $k(e,a,t){return a&&CE(e.prototype,a),t&&CE(e,t),e}function Kk(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&zy(e,a)}function zy(e,a){return zy=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},zy(e,a)}function Qk(e){var a=tL();return function(){var n=Pg(e),r;if(a){var o=Pg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Jk(this,r)}}function Jk(e,a){if(a&&(Ig(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eL(e)}function eL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Pg(e){return Pg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Pg(e)}var $O=function(e){Kk(t,e);var a=Qk(t);function t(n){var r;return qk(this,t),r=a.call(this,n),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return $k(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,h=r.option,d=r.onMarkerLoaded,m=new i1(h);o&&m.setLnglat(o),u&&m.setElement(this.el),this.marker=m,d&&d(m),this.scene.addMarker(m)}},{key:"componentDidUpdate",value:function(r){var o,u=(r==null?void 0:r.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return ge.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,pE.createPortal)(r.props.children,r.el)})}}]),t}(ge.PureComponent),KO=ge.useEffect,QO=null,JO=null,eR=ge.useEffect,tR=null},75174:function(wn,Ee,ue){var Re=function(ge){"use strict";function y(_,w){var M=Object.keys(_);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(_);w&&(D=D.filter(function(N){return Object.getOwnPropertyDescriptor(_,N).enumerable})),M.push.apply(M,D)}return M}function Fe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fe=function(){return _};var _={},w=Object.prototype,M=w.hasOwnProperty,D=typeof Symbol=="function"?Symbol:{},N=D.iterator||"@@iterator",te=D.asyncIterator||"@@asyncIterator",pe=D.toStringTag||"@@toStringTag";function de(Kr,fn,Fi){return Object.defineProperty(Kr,fn,{value:Fi,enumerable:!0,configurable:!0,writable:!0}),Kr[fn]}try{de({},"")}catch(Kr){de=function(fn,Fi,Wa){return fn[Fi]=Wa}}function ze(Kr,fn,Fi,Wa){var ba=fn&&fn.prototype instanceof nr?fn:nr,Qu=Object.create(ba.prototype),vl=new Xa(Wa||[]);return Qu._invoke=function(rs,ml,ps){var bh="suspendedStart";return function(dp,Zu){if(bh==="executing")throw new Error("Generator is already running");if(bh==="completed"){if(dp==="throw")throw Zu;return no()}for(ps.method=dp,ps.arg=Zu;;){var ns=ps.delegate;if(ns){var Vo=Ei(ns,ps);if(Vo){if(Vo===He)continue;return Vo}}if(ps.method==="next")ps.sent=ps._sent=ps.arg;else if(ps.method==="throw"){if(bh==="suspendedStart")throw bh="completed",ps.arg;ps.dispatchException(ps.arg)}else ps.method==="return"&&ps.abrupt("return",ps.arg);bh="executing";var Mu=Xe(rs,ml,ps);if(Mu.type==="normal"){if(bh=ps.done?"completed":"suspendedYield",Mu.arg===He)continue;return{value:Mu.arg,done:ps.done}}Mu.type==="throw"&&(bh="completed",ps.method="throw",ps.arg=Mu.arg)}}}(Kr,Fi,vl),Qu}function Xe(Kr,fn,Fi){try{return{type:"normal",arg:Kr.call(fn,Fi)}}catch(Wa){return{type:"throw",arg:Wa}}}_.wrap=ze;var He={};function nr(){}function Er(){}function Nr(){}var Yr={};de(Yr,N,function(){return this});var Ln=Object.getPrototypeOf,Sn=Ln&&Ln(Ln(ro([])));Sn&&Sn!==w&&M.call(Sn,N)&&(Yr=Sn);var Zn=Nr.prototype=nr.prototype=Object.create(Yr);function bn(Kr){["next","throw","return"].forEach(function(fn){de(Kr,fn,function(Fi){return this._invoke(fn,Fi)})})}function ii(Kr,fn){var Fi;this._invoke=function(Wa,ba){function Qu(){return new fn(function(vl,rs){(function ml(ps,bh,dp,Zu){var ns=Xe(Kr[ps],Kr,bh);if(ns.type!=="throw"){var Vo=ns.arg,Mu=Vo.value;return Mu&&typeof Mu=="object"&&M.call(Mu,"__await")?fn.resolve(Mu.__await).then(function(Dl){ml("next",Dl,dp,Zu)},function(Dl){ml("throw",Dl,dp,Zu)}):fn.resolve(Mu).then(function(Dl){Vo.value=Dl,dp(Vo)},function(Dl){return ml("throw",Dl,dp,Zu)})}Zu(ns.arg)})(Wa,ba,vl,rs)})}return Fi=Fi?Fi.then(Qu,Qu):Qu()}}function Ei(Kr,fn){var Fi=Kr.iterator[fn.method];if(Fi===void 0){if(fn.delegate=null,fn.method==="throw"){if(Kr.iterator.return&&(fn.method="return",fn.arg=void 0,Ei(Kr,fn),fn.method==="throw"))return He;fn.method="throw",fn.arg=new TypeError("The iterator does not provide a 'throw' method")}return He}var Wa=Xe(Fi,Kr.iterator,fn.arg);if(Wa.type==="throw")return fn.method="throw",fn.arg=Wa.arg,fn.delegate=null,He;var ba=Wa.arg;return ba?ba.done?(fn[Kr.resultName]=ba.value,fn.next=Kr.nextLoc,fn.method!=="return"&&(fn.method="next",fn.arg=void 0),fn.delegate=null,He):ba:(fn.method="throw",fn.arg=new TypeError("iterator result is not an object"),fn.delegate=null,He)}function go(Kr){var fn={tryLoc:Kr[0]};1 in Kr&&(fn.catchLoc=Kr[1]),2 in Kr&&(fn.finallyLoc=Kr[2],fn.afterLoc=Kr[3]),this.tryEntries.push(fn)}function uo(Kr){var fn=Kr.completion||{};fn.type="normal",delete fn.arg,Kr.completion=fn}function Xa(Kr){this.tryEntries=[{tryLoc:"root"}],Kr.forEach(go,this),this.reset(!0)}function ro(Kr){if(Kr){var fn=Kr[N];if(fn)return fn.call(Kr);if(typeof Kr.next=="function")return Kr;if(!isNaN(Kr.length)){var Fi=-1,Wa=function ba(){for(;++Fi<Kr.length;)if(M.call(Kr,Fi))return ba.value=Kr[Fi],ba.done=!1,ba;return ba.value=void 0,ba.done=!0,ba};return Wa.next=Wa}}return{next:no}}function no(){return{value:void 0,done:!0}}return Er.prototype=Nr,de(Zn,"constructor",Nr),de(Nr,"constructor",Er),Er.displayName=de(Nr,pe,"GeneratorFunction"),_.isGeneratorFunction=function(Kr){var fn=typeof Kr=="function"&&Kr.constructor;return!!fn&&(fn===Er||(fn.displayName||fn.name)==="GeneratorFunction")},_.mark=function(Kr){return Object.setPrototypeOf?Object.setPrototypeOf(Kr,Nr):(Kr.__proto__=Nr,de(Kr,pe,"GeneratorFunction")),Kr.prototype=Object.create(Zn),Kr},_.awrap=function(Kr){return{__await:Kr}},bn(ii.prototype),de(ii.prototype,te,function(){return this}),_.AsyncIterator=ii,_.async=function(Kr,fn,Fi,Wa,ba){ba===void 0&&(ba=Promise);var Qu=new ii(ze(Kr,fn,Fi,Wa),ba);return _.isGeneratorFunction(fn)?Qu:Qu.next().then(function(vl){return vl.done?vl.value:Qu.next()})},bn(Zn),de(Zn,pe,"Generator"),de(Zn,N,function(){return this}),de(Zn,"toString",function(){return"[object Generator]"}),_.keys=function(Kr){var fn=[];for(var Fi in Kr)fn.push(Fi);return fn.reverse(),function Wa(){for(;fn.length;){var ba=fn.pop();if(ba in Kr)return Wa.value=ba,Wa.done=!1,Wa}return Wa.done=!0,Wa}},_.values=ro,Xa.prototype={constructor:Xa,reset:function(Kr){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(uo),!Kr)for(var fn in this)fn.charAt(0)==="t"&&M.call(this,fn)&&!isNaN(+fn.slice(1))&&(this[fn]=void 0)},stop:function(){this.done=!0;var Kr=this.tryEntries[0].completion;if(Kr.type==="throw")throw Kr.arg;return this.rval},dispatchException:function(Kr){if(this.done)throw Kr;var fn=this;function Fi(ml,ps){return Qu.type="throw",Qu.arg=Kr,fn.next=ml,ps&&(fn.method="next",fn.arg=void 0),!!ps}for(var Wa=this.tryEntries.length-1;Wa>=0;--Wa){var ba=this.tryEntries[Wa],Qu=ba.completion;if(ba.tryLoc==="root")return Fi("end");if(ba.tryLoc<=this.prev){var vl=M.call(ba,"catchLoc"),rs=M.call(ba,"finallyLoc");if(vl&&rs){if(this.prev<ba.catchLoc)return Fi(ba.catchLoc,!0);if(this.prev<ba.finallyLoc)return Fi(ba.finallyLoc)}else if(vl){if(this.prev<ba.catchLoc)return Fi(ba.catchLoc,!0)}else{if(!rs)throw new Error("try statement without catch or finally");if(this.prev<ba.finallyLoc)return Fi(ba.finallyLoc)}}}},abrupt:function(Kr,fn){for(var Fi=this.tryEntries.length-1;Fi>=0;--Fi){var Wa=this.tryEntries[Fi];if(Wa.tryLoc<=this.prev&&M.call(Wa,"finallyLoc")&&this.prev<Wa.finallyLoc){var ba=Wa;break}}ba&&(Kr==="break"||Kr==="continue")&&ba.tryLoc<=fn&&fn<=ba.finallyLoc&&(ba=null);var Qu=ba?ba.completion:{};return Qu.type=Kr,Qu.arg=fn,ba?(this.method="next",this.next=ba.finallyLoc,He):this.complete(Qu)},complete:function(Kr,fn){if(Kr.type==="throw")throw Kr.arg;return Kr.type==="break"||Kr.type==="continue"?this.next=Kr.arg:Kr.type==="return"?(this.rval=this.arg=Kr.arg,this.method="return",this.next="end"):Kr.type==="normal"&&fn&&(this.next=fn),He},finish:function(Kr){for(var fn=this.tryEntries.length-1;fn>=0;--fn){var Fi=this.tryEntries[fn];if(Fi.finallyLoc===Kr)return this.complete(Fi.completion,Fi.afterLoc),uo(Fi),He}},catch:function(Kr){for(var fn=this.tryEntries.length-1;fn>=0;--fn){var Fi=this.tryEntries[fn];if(Fi.tryLoc===Kr){var Wa=Fi.completion;if(Wa.type==="throw"){var ba=Wa.arg;uo(Fi)}return ba}}throw new Error("illegal catch attempt")},delegateYield:function(Kr,fn,Fi){return this.delegate={iterator:ro(Kr),resultName:fn,nextLoc:Fi},this.method==="next"&&(this.arg=void 0),He}},_}function K(_,w,M,D,N,te,pe){try{var de=_[te](pe),ze=de.value}catch(Xe){return void M(Xe)}de.done?w(ze):Promise.resolve(ze).then(D,N)}function Me(_){return function(){var w=this,M=arguments;return new Promise(function(D,N){var te=_.apply(w,M);function pe(ze){K(te,D,N,pe,de,"next",ze)}function de(ze){K(te,D,N,pe,de,"throw",ze)}pe(void 0)})}}function ve(_,w){if(!(_ instanceof w))throw new TypeError("Cannot call a class as a function")}function at(_,w){for(var M=0;M<w.length;M++){var D=w[M];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(_,D.key,D)}}function se(_,w,M){return w&&at(_.prototype,w),M&&at(_,M),Object.defineProperty(_,"prototype",{writable:!1}),_}function Be(_,w,M){return w in _?Object.defineProperty(_,w,{value:M,enumerable:!0,configurable:!0,writable:!0}):_[w]=M,_}function dt(_,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(w&&w.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),w&&Et(_,w)}function rt(_){return(rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)})(_)}function Et(_,w){return(Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,D){return M.__proto__=D,M})(_,w)}function Vt(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function Ut(_,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vt(_)}function lr(_){var w=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}();return function(){var M,D=rt(_);if(w){var N=rt(this).constructor;M=Reflect.construct(D,arguments,N)}else M=D.apply(this,arguments);return Ut(this,M)}}function Qt(_,w){return function(M){if(Array.isArray(M))return M}(_)||function(M,D){var N=M==null?null:typeof Symbol!="undefined"&&M[Symbol.iterator]||M["@@iterator"];if(N!=null){var te,pe,de=[],ze=!0,Xe=!1;try{for(N=N.call(M);!(ze=(te=N.next()).done)&&(de.push(te.value),!D||de.length!==D);ze=!0);}catch(He){Xe=!0,pe=He}finally{try{ze||N.return==null||N.return()}finally{if(Xe)throw pe}}return de}}(_,w)||Lt(_,w)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function It(_){return function(w){if(Array.isArray(w))return fr(w)}(_)||function(w){if(typeof Symbol!="undefined"&&w[Symbol.iterator]!=null||w["@@iterator"]!=null)return Array.from(w)}(_)||Lt(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Lt(_,w){if(_){if(typeof _=="string")return fr(_,w);var M=Object.prototype.toString.call(_).slice(8,-1);return M==="Object"&&_.constructor&&(M=_.constructor.name),M==="Map"||M==="Set"?Array.from(_):M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M)?fr(_,w):void 0}}function fr(_,w){(w==null||w>_.length)&&(w=_.length);for(var M=0,D=new Array(w);M<w;M++)D[M]=_[M];return D}var ie=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof ue.g!="undefined"?ue.g:typeof self!="undefined"?self:{};function yr(_,w){return _(w={exports:{}},w.exports),w.exports}var Dt,xt,Jt=function(_){return _&&_.Math==Math&&_},je=Jt(typeof globalThis=="object"&&globalThis)||Jt(typeof window=="object"&&window)||Jt(typeof self=="object"&&self)||Jt(typeof ie=="object"&&ie)||function(){return this}()||Function("return this")(),Sr=Object.defineProperty,tn=function(_,w){try{Sr(je,_,{value:w,configurable:!0,writable:!0})}catch(M){je[_]=w}return w},re=je["__core-js_shared__"]||tn("__core-js_shared__",{}),Se=yr(function(_){(_.exports=function(w,M){return re[w]||(re[w]=M!==void 0?M:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),V=function(_){try{return!!_()}catch(w){return!0}},Q=!V(function(){var _=function(){}.bind();return typeof _!="function"||_.hasOwnProperty("prototype")}),Le=Function.prototype,ht=Le.bind,wt=Le.call,er=Q&&ht.bind(wt,wt),Tt=Q?function(_){return _&&er(_)}:function(_){return _&&function(){return wt.apply(_,arguments)}},vr=TypeError,ln=function(_){if(_==null)throw vr("Can't call method on "+_);return _},sn=Object,Mi=function(_){return sn(ln(_))},vi=Tt({}.hasOwnProperty),en=Object.hasOwn||function(_,w){return vi(Mi(_),w)},Oa=0,ra=Math.random(),Vi=Tt(1 .toString),ya=function(_){return"Symbol("+(_===void 0?"":_)+")_"+Vi(++Oa+ra,36)},fi=function(_){return typeof _=="function"},$i=function(_){return fi(_)?_:void 0},hi=function(_,w){return arguments.length<2?$i(je[_]):je[_]&&je[_][w]},yi=hi("navigator","userAgent")||"",ss=je.process,yo=je.Deno,qa=ss&&ss.versions||yo&&yo.version,Ft=qa&&qa.v8;Ft&&(xt=(Dt=Ft.split("."))[0]>0&&Dt[0]<4?1:+(Dt[0]+Dt[1])),!xt&&yi&&(!(Dt=yi.match(/Edge\/(\d+)/))||Dt[1]>=74)&&(Dt=yi.match(/Chrome\/(\d+)/))&&(xt=+Dt[1]);var be=xt,he=!!Object.getOwnPropertySymbols&&!V(function(){var _=Symbol();return!String(_)||!(Object(_)instanceof Symbol)||!Symbol.sham&&be&&be<41}),Ie=he&&!Symbol.sham&&typeof Symbol.iterator=="symbol",G=Se("wks"),lt=je.Symbol,sr=lt&&lt.for,Jr=Ie?lt:lt&&lt.withoutSetter||ya,nt=function(_){if(!en(G,_)||!he&&typeof G[_]!="string"){var w="Symbol."+_;he&&en(lt,_)?G[_]=lt[_]:G[_]=Ie&&sr?sr(w):Jr(w)}return G[_]},Gt={};Gt[nt("toStringTag")]="z";var Ar=String(Gt)==="[object z]",Tr=!V(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Rr=function(_){return typeof _=="object"?_!==null:fi(_)},mn=je.document,mi=Rr(mn)&&Rr(mn.createElement),ai=function(_){return mi?mn.createElement(_):{}},Tn=!Tr&&!V(function(){return Object.defineProperty(ai("div"),"a",{get:function(){return 7}}).a!=7}),Ri=Tr&&V(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),zi=String,ka=TypeError,ia=function(_){if(Rr(_))return _;throw ka(zi(_)+" is not an object")},io=Function.prototype.call,Ci=Q?io.bind(io):function(){return io.apply(io,arguments)},pa=Tt({}.isPrototypeOf),ee=Object,ce=Ie?function(_){return typeof _=="symbol"}:function(_){var w=hi("Symbol");return fi(w)&&pa(w.prototype,ee(_))},xe=String,Oe=function(_){try{return xe(_)}catch(w){return"Object"}},qe=TypeError,ct=function(_){if(fi(_))return _;throw qe(Oe(_)+" is not a function")},St=function(_,w){var M=_[w];return M==null?void 0:ct(M)},ke=TypeError,it=TypeError,Yt=nt("toPrimitive"),jr=function(_,w){if(!Rr(_)||ce(_))return _;var M,D=St(_,Yt);if(D){if(w===void 0&&(w="default"),M=Ci(D,_,w),!Rr(M)||ce(M))return M;throw it("Can't convert object to primitive value")}return w===void 0&&(w="number"),function(N,te){var pe,de;if(te==="string"&&fi(pe=N.toString)&&!Rr(de=Ci(pe,N))||fi(pe=N.valueOf)&&!Rr(de=Ci(pe,N))||te!=="string"&&fi(pe=N.toString)&&!Rr(de=Ci(pe,N)))return de;throw ke("Can't convert object to primitive value")}(_,w)},or=function(_){var w=jr(_,"string");return ce(w)?w:w+""},mr=TypeError,Hr=Object.defineProperty,si=Object.getOwnPropertyDescriptor,Mn={f:Tr?Ri?function(_,w,M){if(ia(_),w=or(w),ia(M),typeof _=="function"&&w==="prototype"&&"value"in M&&"writable"in M&&!M.writable){var D=si(_,w);D&&D.writable&&(_[w]=M.value,M={configurable:"configurable"in M?M.configurable:D.configurable,enumerable:"enumerable"in M?M.enumerable:D.enumerable,writable:!1})}return Hr(_,w,M)}:Hr:function(_,w,M){if(ia(_),w=or(w),ia(M),Tn)try{return Hr(_,w,M)}catch(D){}if("get"in M||"set"in M)throw mr("Accessors not supported");return"value"in M&&(_[w]=M.value),_}},ar=Function.prototype,Yn=Tr&&Object.getOwnPropertyDescriptor,Pr=en(ar,"name"),gn={EXISTS:Pr,PROPER:Pr&&function(){}.name==="something",CONFIGURABLE:Pr&&(!Tr||Tr&&Yn(ar,"name").configurable)},ea=Tt(Function.toString);fi(re.inspectSource)||(re.inspectSource=function(_){return ea(_)});var Vn,na,Ht,Rt=re.inspectSource,da=je.WeakMap,aa=fi(da)&&/native code/.test(Rt(da)),Di=function(_,w){return{enumerable:!(1&_),configurable:!(2&_),writable:!(4&_),value:w}},Ii=Tr?function(_,w,M){return Mn.f(_,w,Di(1,M))}:function(_,w,M){return _[w]=M,_},_o=Se("keys"),Na=function(_){return _o[_]||(_o[_]=ya(_))},Or={},Dr=je.TypeError,Mt=je.WeakMap;if(aa||re.state){var us=re.state||(re.state=new Mt),At=Tt(us.get),ao=Tt(us.has),yu=Tt(us.set);Vn=function(_,w){if(ao(us,_))throw new Dr("Object already initialized");return w.facade=_,yu(us,_,w),w},na=function(_){return At(us,_)||{}},Ht=function(_){return ao(us,_)}}else{var Jo=Na("state");Or[Jo]=!0,Vn=function(_,w){if(en(_,Jo))throw new Dr("Object already initialized");return w.facade=_,Ii(_,Jo,w),w},na=function(_){return en(_,Jo)?_[Jo]:{}},Ht=function(_){return en(_,Jo)}}var Bi={set:Vn,get:na,has:Ht,enforce:function(_){return Ht(_)?na(_):Vn(_,{})},getterFor:function(_){return function(w){var M;if(!Rr(w)||(M=na(w)).type!==_)throw Dr("Incompatible receiver, "+_+" required");return M}}},gl=yr(function(_){var w=gn.CONFIGURABLE,M=Bi.enforce,D=Bi.get,N=Object.defineProperty,te=Tr&&!V(function(){return N(function(){},"length",{value:8}).length!==8}),pe=String(String).split("String"),de=_.exports=function(ze,Xe,He){String(Xe).slice(0,7)==="Symbol("&&(Xe="["+String(Xe).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),He&&He.getter&&(Xe="get "+Xe),He&&He.setter&&(Xe="set "+Xe),(!en(ze,"name")||w&&ze.name!==Xe)&&(Tr?N(ze,"name",{value:Xe,configurable:!0}):ze.name=Xe),te&&He&&en(He,"arity")&&ze.length!==He.arity&&N(ze,"length",{value:He.arity});try{He&&en(He,"constructor")&&He.constructor?Tr&&N(ze,"prototype",{writable:!1}):ze.prototype&&(ze.prototype=void 0)}catch(Er){}var nr=M(ze);return en(nr,"source")||(nr.source=pe.join(typeof Xe=="string"?Xe:"")),ze};Function.prototype.toString=de(function(){return fi(this)&&D(this).source||Rt(this)},"toString")}),Ra=function(_,w,M,D){D||(D={});var N=D.enumerable,te=D.name!==void 0?D.name:w;if(fi(M)&&gl(M,te,D),D.global)N?_[w]=M:tn(w,M);else{try{D.unsafe?_[w]&&(N=!0):delete _[w]}catch(pe){}N?_[w]=M:Mn.f(_,w,{value:M,enumerable:!1,configurable:!D.nonConfigurable,writable:!D.nonWritable})}return _},Lo=Tt({}.toString),Do=Tt("".slice),Ea=function(_){return Do(Lo(_),8,-1)},Ps=nt("toStringTag"),ks=Object,Jl=Ea(function(){return arguments}())=="Arguments",fo=Ar?Ea:function(_){var w,M,D;return _===void 0?"Undefined":_===null?"Null":typeof(M=function(N,te){try{return N[te]}catch(pe){}}(w=ks(_),Ps))=="string"?M:Jl?Ea(w):(D=Ea(w))=="Object"&&fi(w.callee)?"Arguments":D},ds=Ar?{}.toString:function(){return"[object "+fo(this)+"]"};Ar||Ra(Object.prototype,"toString",ds,{unsafe:!0});var ja={}.propertyIsEnumerable,Fo=Object.getOwnPropertyDescriptor,vs={f:Fo&&!ja.call({1:2},1)?function(_){var w=Fo(this,_);return!!w&&w.enumerable}:ja},Bo=Object,Ju=Tt("".split),ju=V(function(){return!Bo("z").propertyIsEnumerable(0)})?function(_){return Ea(_)=="String"?Ju(_,""):Bo(_)}:Bo,jo=function(_){return ju(ln(_))},ye=Object.getOwnPropertyDescriptor,Ze={f:Tr?ye:function(_,w){if(_=jo(_),w=or(w),Tn)try{return ye(_,w)}catch(M){}if(en(_,w))return Di(!Ci(vs.f,_,w),_[w])}},Ct=Math.ceil,hr=Math.floor,En=Math.trunc||function(_){var w=+_;return(w>0?hr:Ct)(w)},ri=function(_){var w=+_;return w!=w||w===0?0:En(w)},_a=Math.max,Go=Math.min,Da=function(_,w){var M=ri(_);return M<0?_a(M+w,0):Go(M,w)},No=Math.min,So=function(_){return _>0?No(ri(_),9007199254740991):0},oo=function(_){return So(_.length)},Ls=function(_){return function(w,M,D){var N,te=jo(w),pe=oo(te),de=Da(D,pe);if(_&&M!=M){for(;pe>de;)if((N=te[de++])!=N)return!0}else for(;pe>de;de++)if((_||de in te)&&te[de]===M)return _||de||0;return!_&&-1}},Qs={includes:Ls(!0),indexOf:Ls(!1)},uu=Qs.indexOf,_u=Tt([].push),Gu=function(_,w){var M,D=jo(_),N=0,te=[];for(M in D)!en(Or,M)&&en(D,M)&&_u(te,M);for(;w.length>N;)en(D,M=w[N++])&&(~uu(te,M)||_u(te,M));return te},xu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Oo=xu.concat("length","prototype"),fa={f:Object.getOwnPropertyNames||function(_){return Gu(_,Oo)}},Cs={f:Object.getOwnPropertySymbols},Ch=Tt([].concat),el=hi("Reflect","ownKeys")||function(_){var w=fa.f(ia(_)),M=Cs.f;return M?Ch(w,M(_)):w},mf=function(_,w,M){for(var D=el(w),N=Mn.f,te=Ze.f,pe=0;pe<D.length;pe++){var de=D[pe];en(_,de)||M&&en(M,de)||N(_,de,te(w,de))}},qf=/#|\.prototype\./,yl=function(_,w){var M=_l[wc(_)];return M==E||M!=gf&&(fi(w)?V(w):!!w)},wc=yl.normalize=function(_){return String(_).replace(qf,".").toLowerCase()},_l=yl.data={},gf=yl.NATIVE="N",E=yl.POLYFILL="P",k=yl,H=Ze.f,F=function(_,w){var M,D,N,te,pe,de=_.target,ze=_.global,Xe=_.stat;if(M=ze?je:Xe?je[de]||tn(de,{}):(je[de]||{}).prototype)for(D in w){if(te=w[D],N=_.dontCallGetSet?(pe=H(M,D))&&pe.value:M[D],!k(ze?D:de+(Xe?".":"#")+D,_.forced)&&N!==void 0){if(typeof te==typeof N)continue;mf(te,N)}(_.sham||N&&N.sham)&&Ii(te,"sham",!0),Ra(M,D,te,_)}},le=Ea(je.process)=="process",Ue=String,yt=TypeError,Ot=Object.setPrototypeOf||("__proto__"in{}?function(){var _,w=!1,M={};try{(_=Tt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),w=M instanceof Array}catch(D){}return function(D,N){return ia(D),function(te){if(typeof te=="object"||fi(te))return te;throw yt("Can't set "+Ue(te)+" as a prototype")}(N),w?_(D,N):D.__proto__=N,D}}():void 0),Nt=Mn.f,Br=nt("toStringTag"),Xr=function(_,w,M){_&&!M&&(_=_.prototype),_&&!en(_,Br)&&Nt(_,Br,{configurable:!0,value:w})},Jn=nt("species"),Ki=function(_){var w=hi(_),M=Mn.f;Tr&&w&&!w[Jn]&&M(w,Jn,{configurable:!0,get:function(){return this}})},ji=TypeError,ha=function(_,w){if(pa(w,_))return _;throw ji("Incorrect invocation")},Ka=function(){},xo=[],Ta=hi("Reflect","construct"),Hs=/^\s*(?:class|function)\b/,Bl=Tt(Hs.exec),Kc=!Hs.exec(Ka),Qc=function(_){if(!fi(_))return!1;try{return Ta(Ka,xo,_),!0}catch(w){return!1}},Tc=function(_){if(!fi(_))return!1;switch(fo(_)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Kc||!!Bl(Hs,Rt(_))}catch(w){return!0}};Tc.sham=!0;var Mc,Pu,Nl,xl,Ho=!Ta||V(function(){var _;return Qc(Qc.call)||!Qc(Object)||!Qc(function(){_=!0})||_})?Tc:Qc,Sh=TypeError,Ah=function(_){if(Ho(_))return _;throw Sh(Oe(_)+" is not a constructor")},bu=nt("species"),Xh=function(_,w){var M,D=ia(_).constructor;return D===void 0||(M=ia(D)[bu])==null?w:Ah(M)},zl=Function.prototype,tl=zl.apply,Ul=zl.call,bl=typeof Reflect=="object"&&Reflect.apply||(Q?Ul.bind(tl):function(){return Ul.apply(tl,arguments)}),lo=Tt(Tt.bind),rl=function(_,w){return ct(_),w===void 0?_:Q?lo(_,w):function(){return _.apply(w,arguments)}},$f=hi("document","documentElement"),Hu=Tt([].slice),yp=TypeError,Qd=function(_,w){if(_<w)throw yp("Not enough arguments");return _},jp=/(?:ipad|iphone|ipod).*applewebkit/i.test(yi),wh=je.setImmediate,yf=je.clearImmediate,_f=je.process,Ic=je.Dispatch,xf=je.Function,ec=je.MessageChannel,bf=je.String,tc=0,lu={};try{Mc=je.location}catch(_){}var Kf=function(_){if(en(lu,_)){var w=lu[_];delete lu[_],w()}},rc=function(_){return function(){Kf(_)}},Yh=function(_){Kf(_.data)},Pc=function(_){je.postMessage(bf(_),Mc.protocol+"//"+Mc.host)};wh&&yf||(wh=function(_){Qd(arguments.length,1);var w=fi(_)?_:xf(_),M=Hu(arguments,1);return lu[++tc]=function(){bl(w,void 0,M)},Pu(tc),tc},yf=function(_){delete lu[_]},le?Pu=function(_){_f.nextTick(rc(_))}:Ic&&Ic.now?Pu=function(_){Ic.now(rc(_))}:ec&&!jp?(xl=(Nl=new ec).port2,Nl.port1.onmessage=Yh,Pu=rl(xl.postMessage,xl)):je.addEventListener&&fi(je.postMessage)&&!je.importScripts&&Mc&&Mc.protocol!=="file:"&&!V(Pc)?(Pu=Pc,je.addEventListener("message",Yh,!1)):Pu="onreadystatechange"in ai("script")?function(_){$f.appendChild(ai("script")).onreadystatechange=function(){$f.removeChild(this),Kf(_)}}:function(_){setTimeout(rc(_),0)});var nc,nl,Ef,kc,_p,Cf,ic,qh,Sf={set:wh,clear:yf},Af=/ipad|iphone|ipod/i.test(yi)&&je.Pebble!==void 0,Gp=/web0s(?!.*chrome)/i.test(yi),Hp=Ze.f,Th=Sf.set,Jc=je.MutationObserver||je.WebKitMutationObserver,Eu=je.document,ef=je.process,Ui=je.Promise,wf=Hp(je,"queueMicrotask"),Tf=wf&&wf.value;Tf||(nc=function(){var _,w;for(le&&(_=ef.domain)&&_.exit();nl;){w=nl.fn,nl=nl.next;try{w()}catch(M){throw nl?kc():Ef=void 0,M}}Ef=void 0,_&&_.enter()},jp||le||Gp||!Jc||!Eu?!Af&&Ui&&Ui.resolve?((ic=Ui.resolve(void 0)).constructor=Ui,qh=rl(ic.then,ic),kc=function(){qh(nc)}):le?kc=function(){ef.nextTick(nc)}:(Th=rl(Th,je),kc=function(){Th(nc)}):(_p=!0,Cf=Eu.createTextNode(""),new Jc(nc).observe(Cf,{characterData:!0}),kc=function(){Cf.data=_p=!_p}));var El=Tf||function(_){var w={fn:_,next:void 0};Ef&&(Ef.next=w),nl||(nl=w,kc()),Ef=w},Aa=function(_){try{return{error:!1,value:_()}}catch(w){return{error:!0,value:w}}},bo=function(){this.head=null,this.tail=null};bo.prototype={add:function(_){var w={item:_,next:null};this.head?this.tail.next=w:this.head=w,this.tail=w},get:function(){var _=this.head;if(_)return this.head=_.next,this.tail===_&&(this.tail=null),_.item}};var cu,Mo,ku,Zl=bo,fu=je.Promise,Wp=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Qf=!Wp&&!le&&typeof window=="object"&&typeof document=="object",Mf=(fu&&fu.prototype,nt("species")),Vl=!1,ms=fi(je.PromiseRejectionEvent),il={CONSTRUCTOR:k("Promise",function(){var _=Rt(fu),w=_!==String(fu);if(!w&&be===66)return!0;if(!be||be<51||!/native code/.test(_)){var M=new fu(function(N){N(1)}),D=function(N){N(function(){},function(){})};if((M.constructor={})[Mf]=D,!(Vl=M.then(function(){})instanceof D))return!0}return!w&&(Qf||Wp)&&!ms}),REJECTION_EVENT:ms,SUBCLASSING:Vl},Jf=function(_){var w,M;this.promise=new _(function(D,N){if(w!==void 0||M!==void 0)throw TypeError("Bad Promise constructor");w=D,M=N}),this.resolve=ct(w),this.reject=ct(M)},Wo={f:function(_){return new Jf(_)}},ni=Sf.set,va=il.CONSTRUCTOR,Lc=il.REJECTION_EVENT,If=il.SUBCLASSING,Lu=Bi.getterFor("Promise"),Ou=Bi.set,Oc=fu&&fu.prototype,In=fu,Rc=Oc,Mh=je.TypeError,xa=je.document,ho=je.process,hu=Wo.f,Ih=hu,al=!!(xa&&xa.createEvent&&je.dispatchEvent),Js=function(_){var w;return!(!Rr(_)||!fi(w=_.then))&&w},jl=function(_,w){var M,D,N,te=w.value,pe=w.state==1,de=pe?_.ok:_.fail,ze=_.resolve,Xe=_.reject,He=_.domain;try{de?(pe||(w.rejection===2&&ol(w),w.rejection=1),de===!0?M=te:(He&&He.enter(),M=de(te),He&&(He.exit(),N=!0)),M===_.promise?Xe(Mh("Promise-chain cycle")):(D=Js(M))?Ci(D,M,ze,Xe):ze(M)):Xe(te)}catch(nr){He&&!N&&He.exit(),Xe(nr)}},di=function(_,w){_.notified||(_.notified=!0,El(function(){for(var M,D=_.reactions;M=D.get();)jl(M,_);_.notified=!1,w&&!_.rejection&&xp(_)}))},eh=function(_,w,M){var D,N;al?((D=xa.createEvent("Event")).promise=w,D.reason=M,D.initEvent(_,!1,!0),je.dispatchEvent(D)):D={promise:w,reason:M},!Lc&&(N=je["on"+_])?N(D):_==="unhandledrejection"&&function(te,pe){var de=je.console;de&&de.error&&(arguments.length==1?de.error(te):de.error(te,pe))}("Unhandled promise rejection",M)},xp=function(_){Ci(ni,je,function(){var w,M=_.facade,D=_.value;if(bp(_)&&(w=Aa(function(){le?ho.emit("unhandledRejection",D,M):eh("unhandledrejection",M,D)}),_.rejection=le||bp(_)?2:1,w.error))throw w.value})},bp=function(_){return _.rejection!==1&&!_.parent},ol=function(_){Ci(ni,je,function(){var w=_.facade;le?ho.emit("rejectionHandled",w):eh("rejectionhandled",w,_.value)})},Ws=function(_,w,M){return function(D){_(w,D,M)}},ua=function(_,w,M){_.done||(_.done=!0,M&&(_=M),_.value=w,_.state=2,di(_,!0))},Cl=function(_,w,M){if(!_.done){_.done=!0,M&&(_=M);try{if(_.facade===w)throw Mh("Promise can't be resolved itself");var D=Js(w);D?El(function(){var N={done:!1};try{Ci(D,w,Ws(Cl,N,_),Ws(ua,N,_))}catch(te){ua(N,te,_)}}):(_.value=w,_.state=1,di(_,!1))}catch(N){ua({done:!1},N,_)}}};if(va&&(Rc=(In=function(_){ha(this,Rc),ct(_),Ci(cu,this);var w=Lu(this);try{_(Ws(Cl,w),Ws(ua,w))}catch(M){ua(w,M)}}).prototype,(cu=function(_){Ou(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Zl,rejection:!1,state:0,value:void 0})}).prototype=Ra(Rc,"then",function(_,w){var M=Lu(this),D=hu(Xh(this,In));return M.parent=!0,D.ok=!fi(_)||_,D.fail=fi(w)&&w,D.domain=le?ho.domain:void 0,M.state==0?M.reactions.add(D):El(function(){jl(D,M)}),D.promise}),Mo=function(){var _=new cu,w=Lu(_);this.promise=_,this.resolve=Ws(Cl,w),this.reject=Ws(ua,w)},Wo.f=hu=function(_){return _===In||_===void 0?new Mo(_):Ih(_)},fi(fu)&&Oc!==Object.prototype)){ku=Oc.then,If||Ra(Oc,"then",function(_,w){var M=this;return new In(function(D,N){Ci(ku,M,D,N)}).then(_,w)},{unsafe:!0});try{delete Oc.constructor}catch(_){}Ot&&Ot(Oc,Rc)}F({global:!0,constructor:!0,wrap:!0,forced:va},{Promise:In}),Xr(In,"Promise",!1),Ki("Promise");var pu={},Ss=nt("iterator"),Pf=Array.prototype,Gl=function(_){return _!==void 0&&(pu.Array===_||Pf[Ss]===_)},sl=nt("iterator"),du=function(_){if(_!=null)return St(_,sl)||St(_,"@@iterator")||pu[fo(_)]},ul=TypeError,_i=function(_,w){var M=arguments.length<2?du(_):w;if(ct(M))return ia(Ci(M,_));throw ul(Oe(_)+" is not iterable")},pi=function(_,w,M){var D,N;ia(_);try{if(!(D=St(_,"return"))){if(w==="throw")throw M;return M}D=Ci(D,_)}catch(te){N=!0,D=te}if(w==="throw")throw M;if(N)throw D;return ia(D),M},kf=TypeError,Os=function(_,w){this.stopped=_,this.result=w},ll=Os.prototype,Yo=function(_,w,M){var D,N,te,pe,de,ze,Xe,He=M&&M.that,nr=!(!M||!M.AS_ENTRIES),Er=!(!M||!M.IS_RECORD),Nr=!(!M||!M.IS_ITERATOR),Yr=!(!M||!M.INTERRUPTED),Ln=rl(w,He),Sn=function(bn){return D&&pi(D,"normal",bn),new Os(!0,bn)},Zn=function(bn){return nr?(ia(bn),Yr?Ln(bn[0],bn[1],Sn):Ln(bn[0],bn[1])):Yr?Ln(bn,Sn):Ln(bn)};if(Er)D=_.iterator;else if(Nr)D=_;else{if(!(N=du(_)))throw kf(Oe(_)+" is not iterable");if(Gl(N)){for(te=0,pe=oo(_);pe>te;te++)if((de=Zn(_[te]))&&pa(ll,de))return de;return new Os(!1)}D=_i(_,N)}for(ze=Er?_.next:D.next;!(Xe=Ci(ze,D)).done;){try{de=Zn(Xe.value)}catch(bn){pi(D,"throw",bn)}if(typeof de=="object"&&de&&pa(ll,de))return de}return new Os(!1)},Ru=nt("iterator"),Ph=!1;try{var th=0,Qa={next:function(){return{done:!!th++}},return:function(){Ph=!0}};Qa[Ru]=function(){return this},Array.from(Qa,function(){throw 2})}catch(_){}var po=function(_,w){if(!w&&!Ph)return!1;var M=!1;try{var D={};D[Ru]=function(){return{next:function(){return{done:M=!0}}}},_(D)}catch(N){}return M},rh=il.CONSTRUCTOR||!po(function(_){fu.all(_).then(void 0,function(){})});F({target:"Promise",stat:!0,forced:rh},{all:function(_){var w=this,M=Wo.f(w),D=M.resolve,N=M.reject,te=Aa(function(){var pe=ct(w.resolve),de=[],ze=0,Xe=1;Yo(_,function(He){var nr=ze++,Er=!1;Xe++,Ci(pe,w,He).then(function(Nr){Er||(Er=!0,de[nr]=Nr,--Xe||D(de))},N)}),--Xe||D(de)});return te.error&&N(te.value),M.promise}});var nh=il.CONSTRUCTOR,Sl=fu&&fu.prototype;if(F({target:"Promise",proto:!0,forced:nh,real:!0},{catch:function(_){return this.then(void 0,_)}}),fi(fu)){var Al=hi("Promise").prototype.catch;Sl.catch!==Al&&Ra(Sl,"catch",Al,{unsafe:!0})}F({target:"Promise",stat:!0,forced:rh},{race:function(_){var w=this,M=Wo.f(w),D=M.reject,N=Aa(function(){var te=ct(w.resolve);Yo(_,function(pe){Ci(te,w,pe).then(M.resolve,D)})});return N.error&&D(N.value),M.promise}}),F({target:"Promise",stat:!0,forced:il.CONSTRUCTOR},{reject:function(_){var w=Wo.f(this);return Ci(w.reject,void 0,_),w.promise}});var Rs=il.CONSTRUCTOR;hi("Promise");function Ao(_,w){if(!_)throw new Error(w||"web worker helper assertion failed.")}F({target:"Promise",stat:!0,forced:Rs},{resolve:function(_){return function(w,M){if(ia(w),Rr(M)&&M.constructor===w)return M;var D=Wo.f(w);return(0,D.resolve)(M),D.promise}(this,_)}});var ac=typeof window!="undefined"&&window.orientation!==void 0,$h=function(){function _(w,M){var D=this;this.name=w,this.workerThread=M,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(N,te){D.resolve=N,D.reject=te})}return _.prototype.postMessage=function(w,M){this.workerThread.postMessage({source:"Main thread",type:w,payload:M})},_.prototype.done=function(w){Ao(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(w)},_.prototype.error=function(w){Ao(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(w)},_}(),tf=new Map;function ih(_){Ao(_.source&&!_.url||!_.source&&_.url);var w=tf.get(_.source||_.url);return w||(_.url&&(w=function(M){if(!M.startsWith("http"))return M;return Kh((D=M,`try {
  importScripts('`+D+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var D}(_.url),tf.set(_.url,w)),_.source&&(w=Kh(_.source),tf.set(_.source,w))),Ao(w),w}function Kh(_){var w=new Blob([_],{type:"application/javascript"});return URL.createObjectURL(w)}function cl(_,w,M){w===void 0&&(w=!0);var D=M||new Set;if(_){if(oc(_))D.add(_);else if(oc(_.buffer))D.add(_.buffer);else if(!ArrayBuffer.isView(_)){if(w&&typeof _=="object")for(var N in _)cl(_[N],w,D)}}return M===void 0?Array.from(D):[]}function oc(_){return!!_&&(_ instanceof ArrayBuffer||typeof MessagePort!="undefined"&&_ instanceof MessagePort||typeof ImageBitmap!="undefined"&&_ instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&_ instanceof OffscreenCanvas)}var rf=function(){},sc=function(){function _(w){this.terminated=!1,this.loadableURL="";var M=w.name,D=w.source,N=w.url;Ao(D||N),this.name=M,this.source=D,this.url=N,this.onMessage=rf,this.onError=function(te){return console.log(te)},this.worker=this.createBrowserWorker()}return _.isSupported=function(){return typeof Worker!="undefined"},_.prototype.destroy=function(){this.onMessage=rf,this.onError=rf,this.worker.terminate(),this.terminated=!0},Object.defineProperty(_.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),_.prototype.postMessage=function(w,M){M=M||cl(w),this.worker.postMessage(w,M)},_.prototype.getErrorFromErrorEvent=function(w){var M="Failed to load ";return M+="worker "+this.name+" from "+this.url+". ",w.message&&(M+=w.message+" in "),w.lineno&&(M+=":"+w.lineno+":"+w.colno),new Error(M)},_.prototype.createBrowserWorker=function(){var w=this;this.loadableURL=ih({source:this.source,url:this.url});var M=new Worker(this.loadableURL,{name:this.name});return M.onmessage=function(D){D.data?w.onMessage(D.data):w.onError(new Error("No data received"))},M.onerror=function(D){w.onError(w.getErrorFromErrorEvent(D)),w.terminated=!0},M.onmessageerror=function(D){return console.error("worker "+w.name+", message error: "+D)},M},_}(),Hl=self&&self.__assign||function(){return(Hl=Object.assign||function(_){for(var w,M=1,D=arguments.length;M<D;M++)for(var N in w=arguments[M])Object.prototype.hasOwnProperty.call(w,N)&&(_[N]=w[N]);return _}).apply(this,arguments)},kh=self&&self.__awaiter||function(_,w,M,D){return new(M||(M=Promise))(function(N,te){function pe(Xe){try{ze(D.next(Xe))}catch(He){te(He)}}function de(Xe){try{ze(D.throw(Xe))}catch(He){te(He)}}function ze(Xe){var He;Xe.done?N(Xe.value):(He=Xe.value,He instanceof M?He:new M(function(nr){nr(He)})).then(pe,de)}ze((D=D.apply(_,w||[])).next())})},uc=self&&self.__generator||function(_,w){var M,D,N,te,pe={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return te={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function de(ze){return function(Xe){return function(He){if(M)throw new TypeError("Generator is already executing.");for(;pe;)try{if(M=1,D&&(N=2&He[0]?D.return:He[0]?D.throw||((N=D.return)&&N.call(D),0):D.next)&&!(N=N.call(D,He[1])).done)return N;switch(D=0,N&&(He=[2&He[0],N.value]),He[0]){case 0:case 1:N=He;break;case 4:return pe.label++,{value:He[1],done:!1};case 5:pe.label++,D=He[1],He=[0];continue;case 7:He=pe.ops.pop(),pe.trys.pop();continue;default:if(N=pe.trys,!((N=N.length>0&&N[N.length-1])||He[0]!==6&&He[0]!==2)){pe=0;continue}if(He[0]===3&&(!N||He[1]>N[0]&&He[1]<N[3])){pe.label=He[1];break}if(He[0]===6&&pe.label<N[1]){pe.label=N[1],N=He;break}if(N&&pe.label<N[2]){pe.label=N[2],pe.ops.push(He);break}N[2]&&pe.ops.pop(),pe.trys.pop();continue}He=w.call(_,pe)}catch(nr){He=[6,nr],D=0}finally{M=N=0}if(5&He[0])throw He[1];return{value:He[0]?He[1]:void 0,done:!0}}([ze,Xe])}}},wl=function(){function _(w){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=w.source,this.url=w.url,this.setProps(w)}return _.prototype.destroy=function(){this.idleQueue.forEach(function(w){return w.destroy()}),this.isDestroyed=!0},_.prototype.setProps=function(w){this.props=Hl(Hl({},this.props),w),w.name!==void 0&&(this.name=w.name),w.maxConcurrency!==void 0&&(this.maxConcurrency=w.maxConcurrency),w.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=w.maxMobileConcurrency),w.reuseWorkers!==void 0&&(this.reuseWorkers=w.reuseWorkers),w.onDebug!==void 0&&(this.onDebug=w.onDebug)},_.prototype.startJob=function(w,M,D){return M===void 0&&(M=function(N,te,pe){return N.done(pe)}),D===void 0&&(D=function(N,te){return N.error(te)}),kh(this,void 0,void 0,function(){var N,te=this;return uc(this,function(pe){switch(pe.label){case 0:return N=new Promise(function(de){return te.jobQueue.push({name:w,onMessage:M,onError:D,onStart:de}),te}),this.startQueuedJob(),[4,N];case 1:return[2,pe.sent()]}})})},_.prototype.startQueuedJob=function(){return kh(this,void 0,void 0,function(){var w,M,D;return uc(this,function(N){switch(N.label){case 0:if(!this.jobQueue.length)return[2];if(!(w=this.getAvailableWorker()))return[2];if(!(M=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:M.name,backlog:this.jobQueue.length,workerThread:w}),D=new $h(M.name,w),w.onMessage=function(te){return M.onMessage(D,te.type,te.payload)},w.onError=function(te){return M.onError(D,te)},M.onStart(D),N.label=1;case 1:return N.trys.push([1,,3,4]),[4,D.result];case 2:return N.sent(),[3,4];case 3:return this.returnWorkerToQueue(w),[7];case 4:return[2]}})})},_.prototype.returnWorkerToQueue=function(w){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(w.destroy(),this.count--):this.idleQueue.push(w),this.isDestroyed||this.startQueuedJob()},_.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var w=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new sc({name:w,source:this.source,url:this.url})}return null},_.prototype.getMaxConcurrency=function(){return ac?this.maxMobileConcurrency:this.maxConcurrency},_}(),Lf=self&&self.__assign||function(){return(Lf=Object.assign||function(_){for(var w,M=1,D=arguments.length;M<D;M++)for(var N in w=arguments[M])Object.prototype.hasOwnProperty.call(w,N)&&(_[N]=w[N]);return _}).apply(this,arguments)},Lh=self&&self.__values||function(_){var w=typeof Symbol=="function"&&Symbol.iterator,M=w&&_[w],D=0;if(M)return M.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&D>=_.length&&(_=void 0),{value:_&&_[D++],done:!_}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},Wu={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},nf=(function(){function _(w){this.workerPools=new Map,this.props=Lf({},Wu),this.setProps(w),this.workerPools=new Map}_.isSupported=function(){return sc.isSupported()},_.getWorkerFarm=function(w){return w===void 0&&(w={}),_.workerFarm=_.workerFarm||new _({}),_.workerFarm.setProps(w),_.workerFarm},_.prototype.destroy=function(){var w,M;try{for(var D=Lh(this.workerPools.values()),N=D.next();!N.done;N=D.next())N.value.destroy()}catch(te){w={error:te}}finally{try{N&&!N.done&&(M=D.return)&&M.call(D)}finally{if(w)throw w.error}}},_.prototype.setProps=function(w){var M,D;this.props=Lf(Lf({},this.props),w);try{for(var N=Lh(this.workerPools.values()),te=N.next();!te.done;te=N.next())te.value.setProps(this.getWorkerPoolProps())}catch(pe){M={error:pe}}finally{try{te&&!te.done&&(D=N.return)&&D.call(N)}finally{if(M)throw M.error}}},_.prototype.getWorkerPool=function(w){var M=w.name,D=w.source,N=w.url,te=this.workerPools.get(M);return te||((te=new wl({name:M,source:D,url:N})).setProps(this.getWorkerPoolProps()),this.workerPools.set(M,te)),te},_.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),c=function(){function _(){}return Object.defineProperty(_,"onmessage",{set:function(w){self.onmessage=function(M){if(p(M)){var D=M.data,N=D.type,te=D.payload;w(N,te)}}},enumerable:!1,configurable:!0}),_.addEventListener=function(w){var M=nf.get(w);M||(M=function(D){if(p(D)){var N=D.data,te=N.type,pe=N.payload;w(te,pe)}}),self.addEventListener("message",M)},_.removeEventListener=function(w){var M=nf.get(w);nf.delete(w),self.removeEventListener("message",M)},_.postMessage=function(w,M){if(self){var D={source:"Worker thread",type:w,payload:M},N=cl(M);self.postMessage(D,N)}},_}();function p(_){var w=_.type,M=_.data;return w==="message"&&M&&typeof M.source=="string"&&M.source==="Main thread"}self&&self.__awaiter,self&&self.__generator;var f,g,S=function(){function _(){this._values=[],this._settlers=[],this._closed=!1}return _.prototype[Symbol.asyncIterator]=function(){return this},_.prototype.push=function(w){return this.enqueue(w)},_.prototype.enqueue=function(w){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var M=this._settlers.shift();w instanceof Error?M.reject(w):M.resolve({value:w})}else this._values.push(w)},_.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},_.prototype.next=function(){var w=this;if(this._values.length>0){var M=this._values.shift();return M instanceof Error?Promise.reject(M):Promise.resolve({done:!1,value:M})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(D,N){w._settlers.push({resolve:D,reject:N})})},_}(),I=self&&self.__awaiter||function(_,w,M,D){return new(M||(M=Promise))(function(N,te){function pe(Xe){try{ze(D.next(Xe))}catch(He){te(He)}}function de(Xe){try{ze(D.throw(Xe))}catch(He){te(He)}}function ze(Xe){var He;Xe.done?N(Xe.value):(He=Xe.value,He instanceof M?He:new M(function(nr){nr(He)})).then(pe,de)}ze((D=D.apply(_,w||[])).next())})},O=self&&self.__generator||function(_,w){var M,D,N,te,pe={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return te={next:de(0),throw:de(1),return:de(2)},typeof Symbol=="function"&&(te[Symbol.iterator]=function(){return this}),te;function de(ze){return function(Xe){return function(He){if(M)throw new TypeError("Generator is already executing.");for(;pe;)try{if(M=1,D&&(N=2&He[0]?D.return:He[0]?D.throw||((N=D.return)&&N.call(D),0):D.next)&&!(N=N.call(D,He[1])).done)return N;switch(D=0,N&&(He=[2&He[0],N.value]),He[0]){case 0:case 1:N=He;break;case 4:return pe.label++,{value:He[1],done:!1};case 5:pe.label++,D=He[1],He=[0];continue;case 7:He=pe.ops.pop(),pe.trys.pop();continue;default:if(N=pe.trys,!((N=N.length>0&&N[N.length-1])||He[0]!==6&&He[0]!==2)){pe=0;continue}if(He[0]===3&&(!N||He[1]>N[0]&&He[1]<N[3])){pe.label=He[1];break}if(He[0]===6&&pe.label<N[1]){pe.label=N[1],N=He;break}if(N&&pe.label<N[2]){pe.label=N[2],pe.ops.push(He);break}N[2]&&pe.ops.pop(),pe.trys.pop();continue}He=w.call(_,pe)}catch(nr){He=[6,nr],D=0}finally{M=N=0}if(5&He[0])throw He[1];return{value:He[0]?He[1]:void 0,done:!0}}([ze,Xe])}}},z=self&&self.__asyncValues||function(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var w,M=_[Symbol.asyncIterator];return M?M.call(_):(_=typeof __values=="function"?__values(_):_[Symbol.iterator](),w={},D("next"),D("throw"),D("return"),w[Symbol.asyncIterator]=function(){return this},w);function D(N){w[N]=_[N]&&function(te){return new Promise(function(pe,de){(function(ze,Xe,He,nr){Promise.resolve(nr).then(function(Er){ze({value:Er,done:He})},Xe)})(pe,de,(te=_[N](te)).done,te.value)})}}},q=0;function oe(_,w){var M=this;if(typeof self!="undefined"){var D={process:Te};c.onmessage=function(N,te){return I(M,void 0,void 0,function(){var pe,de,ze,Xe,He,nr,Er,Nr,Yr,Ln;return O(this,function(Sn){switch(Sn.label){case 0:switch(Sn.trys.push([0,19,,20]),N){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!_)throw new Error("Worker does not support atomic processing");return[4,_(te.input,te.options||{},D)];case 2:return pe=Sn.sent(),c.postMessage("done",{result:pe}),[3,18];case 3:if(!w)throw new Error("Worker does not support batched processing");f=new S,g=te.options||{},de=w(f,g,D),Sn.label=4;case 4:Sn.trys.push([4,9,10,15]),ze=z(de),Sn.label=5;case 5:return[4,ze.next()];case 6:if((Xe=Sn.sent()).done)return[3,8];He=Xe.value,c.postMessage("output-batch",{result:He}),Sn.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return nr=Sn.sent(),Yr={error:nr},[3,15];case 10:return Sn.trys.push([10,,13,14]),Xe&&!Xe.done&&(Ln=ze.return)?[4,Ln.call(ze)]:[3,12];case 11:Sn.sent(),Sn.label=12;case 12:return[3,14];case 13:if(Yr)throw Yr.error;return[7];case 14:return[7];case 15:return c.postMessage("done",{}),[3,18];case 16:return f.push(te.input),[3,18];case 17:return f.close(),[3,18];case 18:return[3,20];case 19:return Er=Sn.sent(),Nr=Er instanceof Error?Er.message:"",c.postMessage("error",{error:Nr}),[3,20];case 20:return[2]}})})}}}function Te(_,w){return w===void 0&&(w={}),new Promise(function(M,D){var N=q++,te=function(de,ze){if(ze.id===N)switch(de){case"done":c.removeEventListener(te),M(ze.result);break;case"error":c.removeEventListener(te),D(ze.error)}};c.addEventListener(te);var pe={id:N,input:_,options:w};c.postMessage("process",pe)})}self&&self.__awaiter,self&&self.__generator;var Pe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},_e=ai("span").classList,Je=_e&&_e.constructor&&_e.constructor.prototype,$e=Je===Object.prototype?void 0:Je,mt=Array.isArray||function(_){return Ea(_)=="Array"},Ye=nt("species"),gt=Array,Pt=function(_,w){return new(function(M){var D;return mt(M)&&(D=M.constructor,(Ho(D)&&(D===gt||mt(D.prototype))||Rr(D)&&(D=D[Ye])===null)&&(D=void 0)),D===void 0?gt:D}(_))(w===0?0:w)},qt=Tt([].push),_r=function(_){var w=_==1,M=_==2,D=_==3,N=_==4,te=_==6,pe=_==7,de=_==5||te;return function(ze,Xe,He,nr){for(var Er,Nr,Yr=Mi(ze),Ln=ju(Yr),Sn=rl(Xe,He),Zn=oo(Ln),bn=0,ii=nr||Pt,Ei=w?ii(ze,Zn):M||pe?ii(ze,0):void 0;Zn>bn;bn++)if((de||bn in Ln)&&(Nr=Sn(Er=Ln[bn],bn,Yr),_))if(w)Ei[bn]=Nr;else if(Nr)switch(_){case 3:return!0;case 5:return Er;case 6:return bn;case 2:qt(Ei,Er)}else switch(_){case 4:return!1;case 7:qt(Ei,Er)}return te?-1:D||N?N:Ei}},ir={forEach:_r(0),map:_r(1),filter:_r(2),some:_r(3),every:_r(4),find:_r(5),findIndex:_r(6),filterReject:_r(7)},Mr=function(_,w){var M=[][_];return!!M&&V(function(){M.call(null,w||function(){return 1},1)})},Wr=ir.forEach,Cn=Mr("forEach")?[].forEach:function(_){return Wr(this,_,arguments.length>1?arguments[1]:void 0)},yn=function(_){if(_&&_.forEach!==Cn)try{Ii(_,"forEach",Cn)}catch(w){_.forEach=Cn}};for(var Hn in Pe)Pe[Hn]&&yn(je[Hn]&&je[Hn].prototype);yn($e);var xi=function(_,w,M){var D=or(w);D in _?Mn.f(_,D,Di(0,M)):_[D]=M},Si=nt("species"),bi=function(_){return be>=51||!V(function(){var w=[];return(w.constructor={})[Si]=function(){return{foo:1}},w[_](Boolean).foo!==1})},Ca=bi("slice"),qn=nt("species"),Hi=Array,Qi=Math.max;F({target:"Array",proto:!0,forced:!Ca},{slice:function(_,w){var M,D,N,te=jo(this),pe=oo(te),de=Da(_,pe),ze=Da(w===void 0?pe:w,pe);if(mt(te)&&(M=te.constructor,(Ho(M)&&(M===Hi||mt(M.prototype))||Rr(M)&&(M=M[qn])===null)&&(M=void 0),M===Hi||M===void 0))return Hu(te,de,ze);for(D=new(M===void 0?Hi:M)(Qi(ze-de,0)),N=0;de<ze;de++,N++)de in te&&xi(D,N,te[de]);return D.length=N,D}});var Wi=gn.EXISTS,Oi=Mn.f,oa=Function.prototype,Zi=Tt(oa.toString),wi=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,ls=Tt(wi.exec);Tr&&!Wi&&Oi(oa,"name",{configurable:!0,get:function(){try{return ls(wi,Zi(this))[1]}catch(_){return""}}});var Xo=ir.map,Ds=bi("map");F({target:"Array",proto:!0,forced:!Ds},{map:function(_){return Xo(this,_,arguments.length>1?arguments[1]:void 0)}});var cs,co=Object.keys||function(_){return Gu(_,xu)},es={f:Tr&&!Ri?Object.defineProperties:function(_,w){ia(_);for(var M,D=jo(w),N=co(w),te=N.length,pe=0;te>pe;)Mn.f(_,M=N[pe++],D[M]);return _}},ts=Na("IE_PROTO"),Fs=function(){},lc=function(_){return"<script>"+_+"</script>"},eu=function(_){_.write(lc("")),_.close();var w=_.parentWindow.Object;return _=null,w},Xu=function(){try{cs=new ActiveXObject("htmlfile")}catch(D){}var _,w;Xu=typeof document!="undefined"?document.domain&&cs?eu(cs):((w=ai("iframe")).style.display="none",$f.appendChild(w),w.src=String("javascript:"),(_=w.contentWindow.document).open(),_.write(lc("document.F=Object")),_.close(),_.F):eu(cs);for(var M=xu.length;M--;)delete Xu.prototype[xu[M]];return Xu()};Or[ts]=!0;var Cu=Object.create||function(_,w){var M;return _!==null?(Fs.prototype=ia(_),M=new Fs,Fs.prototype=null,M[ts]=_):M=Xu(),w===void 0?M:es.f(M,w)},Of=Mn.f,cc=nt("unscopables"),Wl=Array.prototype;Wl[cc]==null&&Of(Wl,cc,{configurable:!0,value:Cu(null)});var Tl,Rf,fl,fc=function(_){Wl[cc][_]=!0},Xl=!V(function(){function _(){}return _.prototype.constructor=null,Object.getPrototypeOf(new _)!==_.prototype}),fs=Na("IE_PROTO"),Ml=Object,Dc=Ml.prototype,Bs=Xl?Ml.getPrototypeOf:function(_){var w=Mi(_);if(en(w,fs))return w[fs];var M=w.constructor;return fi(M)&&w instanceof M?M.prototype:w instanceof Ml?Dc:null},za=nt("iterator"),Du=!1;[].keys&&("next"in(fl=[].keys())?(Rf=Bs(Bs(fl)))!==Object.prototype&&(Tl=Rf):Du=!0),(Tl==null||V(function(){var _={};return Tl[za].call(_)!==_}))&&(Tl={}),fi(Tl[za])||Ra(Tl,za,function(){return this});var Xs={IteratorPrototype:Tl,BUGGY_SAFARI_ITERATORS:Du},hc=Xs.IteratorPrototype,ah=function(){return this},Df=gn.PROPER,Ep=gn.CONFIGURABLE,Yu=Xs.IteratorPrototype,Fc=Xs.BUGGY_SAFARI_ITERATORS,Su=nt("iterator"),Ff=function(){return this},oh=function(_,w,M,D,N,te,pe){(function(Zn,bn,ii,Ei){var go=bn+" Iterator";Zn.prototype=Cu(hc,{next:Di(+!Ei,ii)}),Xr(Zn,go,!1),pu[go]=ah})(M,w,D);var de,ze,Xe,He=function(Zn){if(Zn===N&&Ln)return Ln;if(!Fc&&Zn in Nr)return Nr[Zn];switch(Zn){case"keys":case"values":case"entries":return function(){return new M(this,Zn)}}return function(){return new M(this)}},nr=w+" Iterator",Er=!1,Nr=_.prototype,Yr=Nr[Su]||Nr["@@iterator"]||N&&Nr[N],Ln=!Fc&&Yr||He(N),Sn=w=="Array"&&Nr.entries||Yr;if(Sn&&(de=Bs(Sn.call(new _)))!==Object.prototype&&de.next&&(Bs(de)!==Yu&&(Ot?Ot(de,Yu):fi(de[Su])||Ra(de,Su,Ff)),Xr(de,nr,!0)),Df&&N=="values"&&Yr&&Yr.name!=="values"&&(Ep?Ii(Nr,"name","values"):(Er=!0,Ln=function(){return Ci(Yr,this)})),N)if(ze={values:He("values"),keys:te?Ln:He("keys"),entries:He("entries")},pe)for(Xe in ze)(Fc||Er||!(Xe in Nr))&&Ra(Nr,Xe,ze[Xe]);else F({target:w,proto:!0,forced:Fc||Er},ze);return Nr[Su]!==Ln&&Ra(Nr,Su,Ln,{name:N}),pu[w]=Ln,ze},Yl=Mn.f,Ns=Bi.set,Bf=Bi.getterFor("Array Iterator"),Il=oh(Array,"Array",function(_,w){Ns(this,{type:"Array Iterator",target:jo(_),index:0,kind:w})},function(){var _=Bf(this),w=_.target,M=_.kind,D=_.index++;return!w||D>=w.length?(_.target=void 0,{value:void 0,done:!0}):M=="keys"?{value:D,done:!1}:M=="values"?{value:w[D],done:!1}:{value:[D,w[D]],done:!1}},"values"),Oh=pu.Arguments=pu.Array;if(fc("keys"),fc("values"),fc("entries"),Tr&&Oh.name!=="values")try{Yl(Oh,"name",{value:"values"})}catch(_){}var tu,sh,Fu,ae=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined",cn=Mn.f,uh=Bi.enforce,kv=Bi.get,Io=je.Int8Array,hl=Io&&Io.prototype,lh=je.Uint8ClampedArray,Xp=lh&&lh.prototype,zs=Io&&Bs(Io),Au=hl&&Bs(hl),Cd=Object.prototype,Jd=je.TypeError,Sd=nt("toStringTag"),Rh=ya("TYPED_ARRAY_TAG"),pc=ae&&!!Ot&&fo(je.opera)!=="Opera",ch=!1,Nf={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},hs={BigInt64Array:8,BigUint64Array:8},Cp=function(_){var w=Bs(_);if(Rr(w)){var M=kv(w);return M&&en(M,"TypedArrayConstructor")?M.TypedArrayConstructor:Cp(w)}},Yp=function(_){if(!Rr(_))return!1;var w=fo(_);return en(Nf,w)||en(hs,w)};for(tu in Nf)(Fu=(sh=je[tu])&&sh.prototype)?uh(Fu).TypedArrayConstructor=sh:pc=!1;for(tu in hs)(Fu=(sh=je[tu])&&sh.prototype)&&(uh(Fu).TypedArrayConstructor=sh);if((!pc||!fi(zs)||zs===Function.prototype)&&(zs=function(){throw Jd("Incorrect invocation")},pc))for(tu in Nf)je[tu]&&Ot(je[tu],zs);if((!pc||!Au||Au===Cd)&&(Au=zs.prototype,pc))for(tu in Nf)je[tu]&&Ot(je[tu].prototype,Au);if(pc&&Bs(Xp)!==Au&&Ot(Xp,Au),Tr&&!en(Au,Sd))for(tu in ch=!0,cn(Au,Sd,{get:function(){return Rr(this)?this[Rh]:void 0}}),Nf)je[tu]&&Ii(je[tu],Rh,tu);var Xi={NATIVE_ARRAY_BUFFER_VIEWS:pc,TYPED_ARRAY_TAG:ch&&Rh,aTypedArray:function(_){if(Yp(_))return _;throw Jd("Target is not a typed array")},aTypedArrayConstructor:function(_){if(fi(_)&&(!Ot||pa(zs,_)))return _;throw Jd(Oe(_)+" is not a typed array constructor")},exportTypedArrayMethod:function(_,w,M,D){if(Tr){if(M)for(var N in Nf){var te=je[N];if(te&&en(te.prototype,_))try{delete te.prototype[_]}catch(pe){try{te.prototype[_]=w}catch(de){}}}Au[_]&&!M||Ra(Au,_,M?w:pc&&hl[_]||w,D)}},exportTypedArrayStaticMethod:function(_,w,M){var D,N;if(Tr){if(Ot){if(M){for(D in Nf)if((N=je[D])&&en(N,_))try{delete N[_]}catch(te){}}if(zs[_]&&!M)return;try{return Ra(zs,_,M?w:pc&&zs[_]||w)}catch(te){}}for(D in Nf)!(N=je[D])||N[_]&&!M||Ra(N,_,w)}},getTypedArrayConstructor:Cp,isView:function(_){if(!Rr(_))return!1;var w=fo(_);return w==="DataView"||en(Nf,w)||en(hs,w)},isTypedArray:Yp,TypedArray:zs,TypedArrayPrototype:Au},qp=Xi.NATIVE_ARRAY_BUFFER_VIEWS,Dh=je.ArrayBuffer,Bc=je.Int8Array,Sp=!qp||!V(function(){Bc(1)})||!V(function(){new Bc(-1)})||!po(function(_){new Bc,new Bc(null),new Bc(1.5),new Bc(_)},!0)||V(function(){return new Bc(new Dh(2),1,void 0).length!==1}),Pl=function(_,w,M){for(var D in w)Ra(_,D,w[D],M);return _},af=RangeError,of=function(_){if(_===void 0)return 0;var w=ri(_),M=So(w);if(w!==M)throw af("Wrong length or index");return M},$p=Array,fh=Math.abs,dc=Math.pow,Ap=Math.floor,Qh=Math.log,vc=Math.LN2,sf=function(_,w,M){var D,N,te,pe=$p(M),de=8*M-w-1,ze=(1<<de)-1,Xe=ze>>1,He=w===23?dc(2,-24)-dc(2,-77):0,nr=_<0||_===0&&1/_<0?1:0,Er=0;for((_=fh(_))!=_||_===1/0?(N=_!=_?1:0,D=ze):(D=Ap(Qh(_)/vc),_*(te=dc(2,-D))<1&&(D--,te*=2),(_+=D+Xe>=1?He/te:He*dc(2,1-Xe))*te>=2&&(D++,te/=2),D+Xe>=ze?(N=0,D=ze):D+Xe>=1?(N=(_*te-1)*dc(2,w),D+=Xe):(N=_*dc(2,Xe-1)*dc(2,w),D=0));w>=8;)pe[Er++]=255&N,N/=256,w-=8;for(D=D<<w|N,de+=w;de>0;)pe[Er++]=255&D,D/=256,de-=8;return pe[--Er]|=128*nr,pe},kl=function(_,w){var M,D=_.length,N=8*D-w-1,te=(1<<N)-1,pe=te>>1,de=N-7,ze=D-1,Xe=_[ze--],He=127&Xe;for(Xe>>=7;de>0;)He=256*He+_[ze--],de-=8;for(M=He&(1<<-de)-1,He>>=-de,de+=w;de>0;)M=256*M+_[ze--],de-=8;if(He===0)He=1-pe;else{if(He===te)return M?NaN:Xe?-1/0:1/0;M+=dc(2,w),He-=pe}return(Xe?-1:1)*M*dc(2,He-w)},hh=function(_){for(var w=Mi(this),M=oo(w),D=arguments.length,N=Da(D>1?arguments[1]:void 0,M),te=D>2?arguments[2]:void 0,pe=te===void 0?M:Da(te,M);pe>N;)w[N++]=_;return w},uf=Array,Bu=Math.max,ph=function(_,w,M){for(var D=oo(_),N=Da(w,D),te=Da(M===void 0?D:M,D),pe=uf(Bu(te-N,0)),de=0;N<te;N++,de++)xi(pe,de,_[N]);return pe.length=de,pe},wp=fa.f,Nc=Mn.f,lf=gn.PROPER,Ad=gn.CONFIGURABLE,zf=Bi.get,wd=Bi.set,mc=je.ArrayBuffer,ql=mc,Us=ql&&ql.prototype,Uf=je.DataView,zc=Uf&&Uf.prototype,Fh=Object.prototype,Uc=je.Array,Tp=je.RangeError,Lv=Tt(hh),gc=Tt([].reverse),dh=sf,vh=kl,Zf=function(_){return[255&_]},Td=function(_){return[255&_,_>>8&255]},Kp=function(_){return[255&_,_>>8&255,_>>16&255,_>>24&255]},qu=function(_){return _[3]<<24|_[2]<<16|_[1]<<8|_[0]},Mp=function(_){return dh(_,23,4)},so=function(_){return dh(_,52,8)},Zc=function(_,w){Nc(_.prototype,w,{get:function(){return zf(this)[w]}})},Ja=function(_,w,M,D){var N=of(M),te=zf(_);if(N+w>te.byteLength)throw Tp("Wrong index");var pe=zf(te.buffer).bytes,de=N+te.byteOffset,ze=ph(pe,de,de+w);return D?ze:gc(ze)},Zs=function(_,w,M,D,N,te){var pe=of(M),de=zf(_);if(pe+w>de.byteLength)throw Tp("Wrong index");for(var ze=zf(de.buffer).bytes,Xe=pe+de.byteOffset,He=D(+N),nr=0;nr<w;nr++)ze[Xe+nr]=He[te?nr:w-nr-1]};if(ae){var Qp=lf&&mc.name!=="ArrayBuffer";if(V(function(){mc(1)})&&V(function(){new mc(-1)})&&!V(function(){return new mc,new mc(1.5),new mc(NaN),Qp&&!Ad}))Qp&&Ad&&Ii(mc,"name","ArrayBuffer");else{(ql=function(_){return ha(this,Us),new mc(of(_))}).prototype=Us;for(var Jp,ev=wp(mc),tv=0;ev.length>tv;)(Jp=ev[tv++])in ql||Ii(ql,Jp,mc[Jp]);Us.constructor=ql}Ot&&Bs(zc)!==Fh&&Ot(zc,Fh);var Ip=new Uf(new ql(2)),Md=Tt(zc.setInt8);Ip.setInt8(0,2147483648),Ip.setInt8(1,2147483649),!Ip.getInt8(0)&&Ip.getInt8(1)||Pl(zc,{setInt8:function(_,w){Md(this,_,w<<24>>24)},setUint8:function(_,w){Md(this,_,w<<24>>24)}},{unsafe:!0})}else Us=(ql=function(_){ha(this,Us);var w=of(_);wd(this,{bytes:Lv(Uc(w),0),byteLength:w}),Tr||(this.byteLength=w)}).prototype,zc=(Uf=function(_,w,M){ha(this,zc),ha(_,Us);var D=zf(_).byteLength,N=ri(w);if(N<0||N>D)throw Tp("Wrong offset");if(N+(M=M===void 0?D-N:So(M))>D)throw Tp("Wrong length");wd(this,{buffer:_,byteLength:M,byteOffset:N}),Tr||(this.buffer=_,this.byteLength=M,this.byteOffset=N)}).prototype,Tr&&(Zc(ql,"byteLength"),Zc(Uf,"buffer"),Zc(Uf,"byteLength"),Zc(Uf,"byteOffset")),Pl(zc,{getInt8:function(_){return Ja(this,1,_)[0]<<24>>24},getUint8:function(_){return Ja(this,1,_)[0]},getInt16:function(_){var w=Ja(this,2,_,arguments.length>1?arguments[1]:void 0);return(w[1]<<8|w[0])<<16>>16},getUint16:function(_){var w=Ja(this,2,_,arguments.length>1?arguments[1]:void 0);return w[1]<<8|w[0]},getInt32:function(_){return qu(Ja(this,4,_,arguments.length>1?arguments[1]:void 0))},getUint32:function(_){return qu(Ja(this,4,_,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(_){return vh(Ja(this,4,_,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(_){return vh(Ja(this,8,_,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(_,w){Zs(this,1,_,Zf,w)},setUint8:function(_,w){Zs(this,1,_,Zf,w)},setInt16:function(_,w){Zs(this,2,_,Td,w,arguments.length>2?arguments[2]:void 0)},setUint16:function(_,w){Zs(this,2,_,Td,w,arguments.length>2?arguments[2]:void 0)},setInt32:function(_,w){Zs(this,4,_,Kp,w,arguments.length>2?arguments[2]:void 0)},setUint32:function(_,w){Zs(this,4,_,Kp,w,arguments.length>2?arguments[2]:void 0)},setFloat32:function(_,w){Zs(this,4,_,Mp,w,arguments.length>2?arguments[2]:void 0)},setFloat64:function(_,w){Zs(this,8,_,so,w,arguments.length>2?arguments[2]:void 0)}});Xr(ql,"ArrayBuffer"),Xr(Uf,"DataView");var Pp={ArrayBuffer:ql,DataView:Uf},Ov=Math.floor,Jh=Number.isInteger||function(_){return!Rr(_)&&isFinite(_)&&Ov(_)===_},Id=RangeError,Rv=RangeError,mh=function(_,w){var M=function(D){var N=ri(D);if(N<0)throw Id("The argument can't be less than 0");return N}(_);if(M%w)throw Rv("Wrong offset");return M},Eo=Xi.aTypedArrayConstructor,ed=function(_){var w,M,D,N,te,pe,de=Ah(this),ze=Mi(_),Xe=arguments.length,He=Xe>1?arguments[1]:void 0,nr=He!==void 0,Er=du(ze);if(Er&&!Gl(Er))for(pe=(te=_i(ze,Er)).next,ze=[];!(N=Ci(pe,te)).done;)ze.push(N.value);for(nr&&Xe>2&&(He=rl(He,arguments[2])),M=oo(ze),D=new(Eo(de))(M),w=0;M>w;w++)D[w]=nr?He(ze[w],w):ze[w];return D},Vc=function(_,w,M){var D,N;return Ot&&fi(D=w.constructor)&&D!==M&&Rr(N=D.prototype)&&N!==M.prototype&&Ot(_,N),_},ep=yr(function(_){var w=fa.f,M=ir.forEach,D=Bi.get,N=Bi.set,te=Bi.enforce,pe=Mn.f,de=Ze.f,ze=Math.round,Xe=je.RangeError,He=Pp.ArrayBuffer,nr=He.prototype,Er=Pp.DataView,Nr=Xi.NATIVE_ARRAY_BUFFER_VIEWS,Yr=Xi.TYPED_ARRAY_TAG,Ln=Xi.TypedArray,Sn=Xi.TypedArrayPrototype,Zn=Xi.aTypedArrayConstructor,bn=Xi.isTypedArray,ii=function(no,Kr){Zn(no);for(var fn=0,Fi=Kr.length,Wa=new no(Fi);Fi>fn;)Wa[fn]=Kr[fn++];return Wa},Ei=function(no,Kr){pe(no,Kr,{get:function(){return D(this)[Kr]}})},go=function(no){var Kr;return pa(nr,no)||(Kr=fo(no))=="ArrayBuffer"||Kr=="SharedArrayBuffer"},uo=function(no,Kr){return bn(no)&&!ce(Kr)&&Kr in no&&Jh(+Kr)&&Kr>=0},Xa=function(no,Kr){return Kr=or(Kr),uo(no,Kr)?Di(2,no[Kr]):de(no,Kr)},ro=function(no,Kr,fn){return Kr=or(Kr),!(uo(no,Kr)&&Rr(fn)&&en(fn,"value"))||en(fn,"get")||en(fn,"set")||fn.configurable||en(fn,"writable")&&!fn.writable||en(fn,"enumerable")&&!fn.enumerable?pe(no,Kr,fn):(no[Kr]=fn.value,no)};Tr?(Nr||(Ze.f=Xa,Mn.f=ro,Ei(Sn,"buffer"),Ei(Sn,"byteOffset"),Ei(Sn,"byteLength"),Ei(Sn,"length")),F({target:"Object",stat:!0,forced:!Nr},{getOwnPropertyDescriptor:Xa,defineProperty:ro}),_.exports=function(no,Kr,fn){var Fi=no.match(/\d+$/)[0]/8,Wa=no+(fn?"Clamped":"")+"Array",ba="get"+no,Qu="set"+no,vl=je[Wa],rs=vl,ml=rs&&rs.prototype,ps={},bh=function(Zu,ns){pe(Zu,ns,{get:function(){return function(Vo,Mu){var Dl=D(Vo);return Dl.view[ba](Mu*Fi+Dl.byteOffset,!0)}(this,ns)},set:function(Vo){return function(Mu,Dl,Wf){var Zp=D(Mu);fn&&(Wf=(Wf=ze(Wf))<0?0:Wf>255?255:255&Wf),Zp.view[Qu](Dl*Fi+Zp.byteOffset,Wf,!0)}(this,ns,Vo)},enumerable:!0})};Nr?Sp&&(rs=Kr(function(Zu,ns,Vo,Mu){return ha(Zu,ml),Vc(Rr(ns)?go(ns)?Mu!==void 0?new vl(ns,mh(Vo,Fi),Mu):Vo!==void 0?new vl(ns,mh(Vo,Fi)):new vl(ns):bn(ns)?ii(rs,ns):Ci(ed,rs,ns):new vl(of(ns)),Zu,rs)}),Ot&&Ot(rs,Ln),M(w(vl),function(Zu){Zu in rs||Ii(rs,Zu,vl[Zu])}),rs.prototype=ml):(rs=Kr(function(Zu,ns,Vo,Mu){ha(Zu,ml);var Dl,Wf,Zp,om=0,Wv=0;if(Rr(ns)){if(!go(ns))return bn(ns)?ii(rs,ns):Ci(ed,rs,ns);Dl=ns,Wv=mh(Vo,Fi);var A0=ns.byteLength;if(Mu===void 0){if(A0%Fi||(Wf=A0-Wv)<0)throw Xe("Wrong length")}else if((Wf=So(Mu)*Fi)+Wv>A0)throw Xe("Wrong length");Zp=Wf/Fi}else Zp=of(ns),Dl=new He(Wf=Zp*Fi);for(N(Zu,{buffer:Dl,byteOffset:Wv,byteLength:Wf,length:Zp,view:new Er(Dl)});om<Zp;)bh(Zu,om++)}),Ot&&Ot(rs,Ln),ml=rs.prototype=Cu(Sn)),ml.constructor!==rs&&Ii(ml,"constructor",rs),te(ml).TypedArrayConstructor=rs,Yr&&Ii(ml,Yr,Wa);var dp=rs!=vl;ps[Wa]=rs,F({global:!0,constructor:!0,forced:dp,sham:!Nr},ps),"BYTES_PER_ELEMENT"in rs||Ii(rs,"BYTES_PER_ELEMENT",Fi),"BYTES_PER_ELEMENT"in ml||Ii(ml,"BYTES_PER_ELEMENT",Fi),Ki(Wa)}):_.exports=function(){}});ep("Uint8",function(_){return function(w,M,D){return _(this,w,M,D)}},!0);var Pd=TypeError,td=function(_,w){if(!delete _[w])throw Pd("Cannot delete property "+Oe(w)+" of "+Oe(_))},W=Math.min,De=Tt([].copyWithin||function(_,w){var M=Mi(this),D=oo(M),N=Da(_,D),te=Da(w,D),pe=arguments.length>2?arguments[2]:void 0,de=W((pe===void 0?D:Da(pe,D))-te,D-N),ze=1;for(te<N&&N<te+de&&(ze=-1,te+=de-1,N+=de-1);de-- >0;)te in M?M[N]=M[te]:td(M,N),N+=ze,te+=ze;return M}),ut=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("copyWithin",function(_,w){return De(ut(this),_,w,arguments.length>2?arguments[2]:void 0)});var dr=ir.every,zr=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("every",function(_){return dr(zr(this),_,arguments.length>1?arguments[1]:void 0)});var pr=TypeError,Lr=function(_){var w=jr(_,"number");if(typeof w=="number")throw pr("Can't convert number to bigint");return BigInt(w)},Gr=Xi.aTypedArray,qr=Xi.exportTypedArrayMethod,nn=Tt("".slice);qr("fill",function(_){var w=arguments.length;Gr(this);var M=nn(fo(this),0,3)==="Big"?Lr(_):+_;return Ci(hh,this,M,w>1?arguments[1]:void 0,w>2?arguments[2]:void 0)},V(function(){var _=0;return new Int8Array(2).fill({valueOf:function(){return _++}}),_!==1}));var dn=Xi.aTypedArrayConstructor,vn=Xi.getTypedArrayConstructor,kn=function(_){return dn(Xh(_,vn(_)))},an=function(_,w){return function(M,D){for(var N=0,te=oo(D),pe=new M(te);te>N;)pe[N]=D[N++];return pe}(kn(_),w)},hn=ir.filter,Zt=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("filter",function(_){var w=hn(Zt(this),_,arguments.length>1?arguments[1]:void 0);return an(this,w)});var Cr=ir.find,rn=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("find",function(_){return Cr(rn(this),_,arguments.length>1?arguments[1]:void 0)});var On=ir.findIndex,Ur=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("findIndex",function(_){return On(Ur(this),_,arguments.length>1?arguments[1]:void 0)});var _n=ir.forEach,Nn=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("forEach",function(_){_n(Nn(this),_,arguments.length>1?arguments[1]:void 0)});var Ti=Qs.includes,kr=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("includes",function(_){return Ti(kr(this),_,arguments.length>1?arguments[1]:void 0)});var Fr=Qs.indexOf,oi=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("indexOf",function(_){return Fr(oi(this),_,arguments.length>1?arguments[1]:void 0)});var Rn=nt("iterator"),on=je.Uint8Array,zn=Tt(Il.values),Pn=Tt(Il.keys),la=Tt(Il.entries),Gi=Xi.aTypedArray,Dn=Xi.exportTypedArrayMethod,Bn=on&&on.prototype,Li=!V(function(){Bn[Rn].call([1])}),ta=!!Bn&&Bn.values&&Bn[Rn]===Bn.values&&Bn.values.name==="values",Ma=function(){return zn(Gi(this))};Dn("entries",function(){return la(Gi(this))},Li),Dn("keys",function(){return Pn(Gi(this))},Li),Dn("values",Ma,Li||!ta,{name:"values"}),Dn(Rn,Ma,Li||!ta,{name:"values"});var qo=Xi.aTypedArray,$o=Xi.exportTypedArrayMethod,Sa=Tt([].join);$o("join",function(_){return Sa(qo(this),_)});var Ys=Math.min,wo=[].lastIndexOf,Vs=!!wo&&1/[1].lastIndexOf(1,-0)<0,gs=Mr("lastIndexOf"),As=Vs||!gs?function(_){if(Vs)return bl(wo,this,arguments)||0;var w=jo(this),M=oo(w),D=M-1;for(arguments.length>1&&(D=Ys(D,ri(arguments[1]))),D<0&&(D=M+D);D>=0;D--)if(D in w&&w[D]===_)return D||0;return-1}:wo,js=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("lastIndexOf",function(_){var w=arguments.length;return bl(As,js(this),w>1?[_,arguments[1]]:[_])});var vu=ir.map,zo=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("map",function(_){return vu(zo(this),_,arguments.length>1?arguments[1]:void 0,function(w,M){return new(kn(w))(M)})});var sa=TypeError,ws=function(_){return function(w,M,D,N){ct(M);var te=Mi(w),pe=ju(te),de=oo(te),ze=_?de-1:0,Xe=_?-1:1;if(D<2)for(;;){if(ze in pe){N=pe[ze],ze+=Xe;break}if(ze+=Xe,_?ze<0:de<=ze)throw sa("Reduce of empty array with no initial value")}for(;_?ze>=0:de>ze;ze+=Xe)ze in pe&&(N=M(N,pe[ze],ze,te));return N}},Za={left:ws(!1),right:ws(!0)},ru=Za.left,Yi=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("reduce",function(_){var w=arguments.length;return ru(Yi(this),_,w,w>1?arguments[1]:void 0)});var Ia=Za.right,eo=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("reduceRight",function(_){var w=arguments.length;return Ia(eo(this),_,w,w>1?arguments[1]:void 0)});var ys=Xi.aTypedArray,cf=Xi.exportTypedArrayMethod,Ke=Math.floor;cf("reverse",function(){for(var _,w=ys(this).length,M=Ke(w/2),D=0;D<M;)_=this[D],this[D++]=this[--w],this[w]=_;return this});var gr=je.RangeError,$t=je.Int8Array,ei=$t&&$t.prototype,Pa=ei&&ei.set,Ge=Xi.aTypedArray,we=Xi.exportTypedArrayMethod,vt=!V(function(){var _=new Uint8ClampedArray(2);return Ci(Pa,_,{length:1,0:3},1),_[1]!==3}),Wt=vt&&Xi.NATIVE_ARRAY_BUFFER_VIEWS&&V(function(){var _=new $t(2);return _.set(1),_.set("2",1),_[0]!==0||_[1]!==2});we("set",function(_){Ge(this);var w=mh(arguments.length>1?arguments[1]:void 0,1),M=Mi(_);if(vt)return Ci(Pa,this,M,w);var D=this.length,N=oo(M),te=0;if(N+w>D)throw gr("Wrong length");for(;te<N;)this[w+te]=M[te++]},!vt||Wt);var ur=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("slice",function(_,w){for(var M=Hu(ur(this),_,w),D=kn(this),N=0,te=M.length,pe=new D(te);te>N;)pe[N]=M[N++];return pe},V(function(){new Int8Array(1).slice()}));var bt=ir.some,ot=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("some",function(_){return bt(ot(this),_,arguments.length>1?arguments[1]:void 0)});var kt=Math.floor,Ne=function(_,w){var M=_.length,D=kt(M/2);return M<8?pt(_,w):We(_,Ne(ph(_,0,D),w),Ne(ph(_,D),w),w)},pt=function(_,w){for(var M,D,N=_.length,te=1;te<N;){for(D=te,M=_[te];D&&w(_[D-1],M)>0;)_[D]=_[--D];D!==te++&&(_[D]=M)}return _},We=function(_,w,M,D){for(var N=w.length,te=M.length,pe=0,de=0;pe<N||de<te;)_[pe+de]=pe<N&&de<te?D(w[pe],M[de])<=0?w[pe++]:M[de++]:pe<N?w[pe++]:M[de++];return _},jt=Ne,Kt=yi.match(/firefox\/(\d+)/i),Vr=!!Kt&&+Kt[1],An=/MSIE|Trident/.test(yi),un=yi.match(/AppleWebKit\/(\d+)\./),Gn=!!un&&+un[1],xn=Xi.aTypedArray,$n=Xi.exportTypedArrayMethod,Wn=je.Uint16Array,Kn=Wn&&Tt(Wn.prototype.sort),ui=!(!Kn||V(function(){Kn(new Wn(2),null)})&&V(function(){Kn(new Wn(2),{})})),Qn=!!Kn&&!V(function(){if(be)return be<74;if(Vr)return Vr<67;if(An)return!0;if(Gn)return Gn<602;var _,w,M=new Wn(516),D=Array(516);for(_=0;_<516;_++)w=_%4,M[_]=515-_,D[_]=_-2*w+3;for(Kn(M,function(N,te){return(N/4|0)-(te/4|0)}),_=0;_<516;_++)if(M[_]!==D[_])return!0});$n("sort",function(_){return _!==void 0&&ct(_),Qn?Kn(this,_):jt(xn(this),function(w){return function(M,D){return w!==void 0?+w(M,D)||0:D!=D?-1:M!=M?1:M===0&&D===0?1/M>0&&1/D<0?1:-1:M>D}}(_))},!Qn||ui);var Ni=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("subarray",function(_,w){var M=Ni(this),D=M.length,N=Da(_,D);return new(kn(M))(M.buffer,M.byteOffset+N*M.BYTES_PER_ELEMENT,So((w===void 0?D:Da(w,D))-N))});var Ua=je.Int8Array,qs=Xi.aTypedArray,Po=Xi.exportTypedArrayMethod,$a=[].toLocaleString,jc=!!Ua&&V(function(){$a.call(new Ua(1))});Po("toLocaleString",function(){return bl($a,jc?Hu(qs(this)):qs(this),Hu(arguments))},V(function(){return[1,2].toLocaleString()!=new Ua([1,2]).toLocaleString()})||!V(function(){Ua.prototype.toLocaleString.call([1,2])}));var Nu=Xi.exportTypedArrayMethod,yc=je.Uint8Array,$l=yc&&yc.prototype||{},_c=[].toString,pl=Tt([].join);V(function(){_c.call({})})&&(_c=function(){return pl(this)});var Gc=$l.toString!=_c;Nu("toString",_c,Gc);var gh,tp,Ts=String,Gs=function(_){if(fo(_)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Ts(_)},xc=function(){var _=ia(this),w="";return _.hasIndices&&(w+="d"),_.global&&(w+="g"),_.ignoreCase&&(w+="i"),_.multiline&&(w+="m"),_.dotAll&&(w+="s"),_.unicode&&(w+="u"),_.unicodeSets&&(w+="v"),_.sticky&&(w+="y"),w},rp=je.RegExp,yh=V(function(){var _=rp("a","y");return _.lastIndex=2,_.exec("abcd")!=null}),kd=yh||V(function(){return!rp("a","y").sticky}),Kl={BROKEN_CARET:yh||V(function(){var _=rp("^r","gy");return _.lastIndex=2,_.exec("str")!=null}),MISSED_STICKY:kd,UNSUPPORTED_Y:yh},Vf=je.RegExp,rv=V(function(){var _=Vf(".","s");return!(_.dotAll&&_.exec(`
`)&&_.flags==="s")}),o0=je.RegExp,j0=V(function(){var _=o0("(?<a>b)","g");return _.exec("b").groups.a!=="b"||"b".replace(_,"$<a>c")!=="bc"}),$s=Bi.get,np=Se("native-string-replace",String.prototype.replace),Ld=RegExp.prototype.exec,i=Ld,s=Tt("".charAt),l=Tt("".indexOf),v=Tt("".replace),x=Tt("".slice),C=(tp=/b*/g,Ci(Ld,gh=/a/,"a"),Ci(Ld,tp,"a"),gh.lastIndex!==0||tp.lastIndex!==0),T=Kl.BROKEN_CARET,R=/()??/.exec("")[1]!==void 0;(C||R||T||rv||j0)&&(i=function(_){var w,M,D,N,te,pe,de,ze=this,Xe=$s(ze),He=Gs(_),nr=Xe.raw;if(nr)return nr.lastIndex=ze.lastIndex,w=Ci(i,nr,He),ze.lastIndex=nr.lastIndex,w;var Er=Xe.groups,Nr=T&&ze.sticky,Yr=Ci(xc,ze),Ln=ze.source,Sn=0,Zn=He;if(Nr&&(Yr=v(Yr,"y",""),l(Yr,"g")===-1&&(Yr+="g"),Zn=x(He,ze.lastIndex),ze.lastIndex>0&&(!ze.multiline||ze.multiline&&s(He,ze.lastIndex-1)!==`
`)&&(Ln="(?: "+Ln+")",Zn=" "+Zn,Sn++),M=new RegExp("^(?:"+Ln+")",Yr)),R&&(M=new RegExp("^"+Ln+"$(?!\\s)",Yr)),C&&(D=ze.lastIndex),N=Ci(Ld,Nr?M:ze,Zn),Nr?N?(N.input=x(N.input,Sn),N[0]=x(N[0],Sn),N.index=ze.lastIndex,ze.lastIndex+=N[0].length):ze.lastIndex=0:C&&N&&(ze.lastIndex=ze.global?N.index+N[0].length:D),R&&N&&N.length>1&&Ci(np,N[0],M,function(){for(te=1;te<arguments.length-2;te++)arguments[te]===void 0&&(N[te]=void 0)}),N&&Er)for(N.groups=pe=Cu(null),te=0;te<Er.length;te++)pe[(de=Er[te])[0]]=N[de[1]];return N});var U=i;F({target:"RegExp",proto:!0,forced:/./.exec!==U},{exec:U});var X,$=nt("species"),ne=RegExp.prototype,me=function(_,w,M,D){var N=nt(_),te=!V(function(){var Xe={};return Xe[N]=function(){return 7},""[_](Xe)!=7}),pe=te&&!V(function(){var Xe=!1,He=/a/;return _==="split"&&((He={}).constructor={},He.constructor[$]=function(){return He},He.flags="",He[N]=/./[N]),He.exec=function(){return Xe=!0,null},He[N](""),!Xe});if(!te||!pe||M){var de=Tt(/./[N]),ze=w(N,""[_],function(Xe,He,nr,Er,Nr){var Yr=Tt(Xe),Ln=He.exec;return Ln===U||Ln===ne.exec?te&&!Nr?{done:!0,value:de(He,nr,Er)}:{done:!0,value:Yr(nr,He,Er)}:{done:!1}});Ra(String.prototype,_,ze[0]),Ra(ne,N,ze[1])}D&&Ii(ne[N],"sham",!0)},Ae=Tt("".charAt),Qe=Tt("".charCodeAt),et=Tt("".slice),_t=function(_){return function(w,M){var D,N,te=Gs(ln(w)),pe=ri(M),de=te.length;return pe<0||pe>=de?_?"":void 0:(D=Qe(te,pe))<55296||D>56319||pe+1===de||(N=Qe(te,pe+1))<56320||N>57343?_?Ae(te,pe):D:_?et(te,pe,pe+2):N-56320+(D-55296<<10)+65536}},ft={codeAt:_t(!1),charAt:_t(!0)},zt=ft.charAt,tr=function(_,w,M){return w+(M?zt(_,w).length:1)},xr=Math.floor,br=Tt("".charAt),Zr=Tt("".replace),pn=Tt("".slice),Un=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ai=/\$([$&'`]|\d{1,2})/g,ti=function(_,w,M,D,N,te){var pe=M+_.length,de=D.length,ze=Ai;return N!==void 0&&(N=Mi(N),ze=Un),Zr(te,ze,function(Xe,He){var nr;switch(br(He,0)){case"$":return"$";case"&":return _;case"`":return pn(w,0,M);case"'":return pn(w,pe);case"<":nr=N[pn(He,1,-1)];break;default:var Er=+He;if(Er===0)return Xe;if(Er>de){var Nr=xr(Er/10);return Nr===0?Xe:Nr<=de?D[Nr-1]===void 0?br(He,1):D[Nr-1]+br(He,1):Xe}nr=D[Er-1]}return nr===void 0?"":nr})},Pi=TypeError,Xn=function(_,w){var M=_.exec;if(fi(M)){var D=Ci(M,_,w);return D!==null&&ia(D),D}if(Ea(_)==="RegExp")return Ci(U,_,w);throw Pi("RegExp#exec called on incompatible receiver")},ma=nt("replace"),qi=Math.max,gi=Math.min,La=Tt([].concat),ca=Tt([].push),Va=Tt("".indexOf),ki=Tt("".slice),to="a".replace(/./,"$0")==="$0",To=!!/./[ma]&&/./[ma]("a","$0")==="";function _s(_){this.message=_}me("replace",function(_,w,M){var D=To?"$":"$0";return[function(N,te){var pe=ln(this),de=N==null?void 0:St(N,ma);return de?Ci(de,N,pe,te):Ci(w,Gs(pe),N,te)},function(N,te){var pe=ia(this),de=Gs(N);if(typeof te=="string"&&Va(te,D)===-1&&Va(te,"$<")===-1){var ze=M(w,pe,de,te);if(ze.done)return ze.value}var Xe=fi(te);Xe||(te=Gs(te));var He=pe.global;if(He){var nr=pe.unicode;pe.lastIndex=0}for(var Er=[];;){var Nr=Xn(pe,de);if(Nr===null||(ca(Er,Nr),!He))break;Gs(Nr[0])===""&&(pe.lastIndex=tr(de,So(pe.lastIndex),nr))}for(var Yr,Ln="",Sn=0,Zn=0;Zn<Er.length;Zn++){for(var bn=Gs((Nr=Er[Zn])[0]),ii=qi(gi(ri(Nr.index),de.length),0),Ei=[],go=1;go<Nr.length;go++)ca(Ei,(Yr=Nr[go])===void 0?Yr:String(Yr));var uo=Nr.groups;if(Xe){var Xa=La([bn],Ei,ii,de);uo!==void 0&&ca(Xa,uo);var ro=Gs(bl(te,void 0,Xa))}else ro=ti(bn,de,ii,Ei,uo,te);ii>=Sn&&(Ln+=ki(de,Sn,ii)+ro,Sn=ii+bn.length)}return Ln+ki(de,Sn)}]},!!V(function(){var _=/./;return _.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(_,"$<a>")!=="7"})||!to||To),_s.prototype=new Error,_s.prototype.name="InvalidCharacterError",F({global:!0},{globalThis:je}),X=typeof window=="undefined"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(_){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(_){return null},clearMeasures:function(_){return null},clearMarks:function(_){return null},measure:function(_,w,M){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(_){return!0},Event:function(_,w){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:X.devicePixelRatio;var $r=TypeError,Uo=function(_){if(_>9007199254740991)throw $r("Maximum allowed index exceeded");return _},rr=bi("splice"),nu=Math.max,iu=Math.min;F({target:"Array",proto:!0,forced:!rr},{splice:function(_,w){var M,D,N,te,pe,de,ze=Mi(this),Xe=oo(ze),He=Da(_,Xe),nr=arguments.length;for(nr===0?M=D=0:nr===1?(M=0,D=Xe-He):(M=nr-2,D=iu(nu(ri(w),0),Xe-He)),Uo(Xe+M-D),N=Pt(ze,D),te=0;te<D;te++)(pe=He+te)in ze&&xi(N,te,ze[pe]);if(N.length=D,M<D){for(te=He;te<Xe-D;te++)de=te+M,(pe=te+D)in ze?ze[de]=ze[pe]:td(ze,de);for(te=Xe;te>Xe-D+M;te--)td(ze,te-1)}else if(M>D)for(te=Xe-D;te>He;te--)de=te+M-1,(pe=te+D-1)in ze?ze[de]=ze[pe]:td(ze,de);for(te=0;te<M;te++)ze[te+He]=arguments[te+2];return ze.length=Xe-D+M,N}});var zu=se(function _(w,M){ve(this,_),Be(this,"cancelBubble",void 0),Be(this,"cancelable",void 0),Be(this,"target",void 0),Be(this,"currentTarget",void 0),Be(this,"preventDefault",void 0),Be(this,"stopPropagation",void 0),Be(this,"type",void 0),Be(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=w,this.timeStamp=Date.now()}),xs=Object.assign,wu=Object.defineProperty,Ko=Tt([].concat),au=!xs||V(function(){if(Tr&&xs({b:1},xs(wu({},"a",{enumerable:!0,get:function(){wu(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var _={},w={},M=Symbol();return _[M]=7,"abcdefghijklmnopqrst".split("").forEach(function(D){w[D]=D}),xs({},_)[M]!=7||co(xs({},w)).join("")!="abcdefghijklmnopqrst"})?function(_,w){for(var M=Mi(_),D=arguments.length,N=1,te=Cs.f,pe=vs.f;D>N;)for(var de,ze=ju(arguments[N++]),Xe=te?Ko(co(ze),te(ze)):co(ze),He=Xe.length,nr=0;He>nr;)de=Xe[nr++],Tr&&!Ci(pe,ze,de)||(M[de]=ze[de]);return M}:xs;F({target:"Object",stat:!0,arity:2,forced:Object.assign!==au},{assign:au});var Fa=ir.findIndex,Co=!0;"findIndex"in[]&&Array(1).findIndex(function(){Co=!1}),F({target:"Array",proto:!0,forced:Co},{findIndex:function(_){return Fa(this,_,arguments.length>1?arguments[1]:void 0)}}),fc("findIndex");var vo=ft.charAt,Ga=Bi.set,$u=Bi.getterFor("String Iterator");oh(String,"String",function(_){Ga(this,{type:"String Iterator",string:Gs(_),index:0})},function(){var _,w=$u(this),M=w.string,D=w.index;return D>=M.length?{value:void 0,done:!0}:(_=vo(M,D),w.index+=_.length,{value:_,done:!1})});var mu=fa.f,Zo=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ms={f:function(_){return Zo&&Ea(_)=="Window"?function(w){try{return mu(w)}catch(M){return ph(Zo)}}(_):mu(jo(_))}},Tu=V(function(){if(typeof ArrayBuffer=="function"){var _=new ArrayBuffer(8);Object.isExtensible(_)&&Object.defineProperty(_,"a",{value:8})}}),Ha=Object.isExtensible,Ll=V(function(){Ha(1)})||Tu?function(_){return!!Rr(_)&&(!Tu||Ea(_)!="ArrayBuffer")&&(!Ha||Ha(_))}:Ha,bc=!V(function(){return Object.isExtensible(Object.preventExtensions({}))}),dl=yr(function(_){var w=Mn.f,M=!1,D=ya("meta"),N=0,te=function(de){w(de,D,{value:{objectID:"O"+N++,weakData:{}}})},pe=_.exports={enable:function(){pe.enable=function(){},M=!0;var de=fa.f,ze=Tt([].splice),Xe={};Xe[D]=1,de(Xe).length&&(fa.f=function(He){for(var nr=de(He),Er=0,Nr=nr.length;Er<Nr;Er++)if(nr[Er]===D){ze(nr,Er,1);break}return nr},F({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ms.f}))},fastKey:function(de,ze){if(!Rr(de))return typeof de=="symbol"?de:(typeof de=="string"?"S":"P")+de;if(!en(de,D)){if(!Ll(de))return"F";if(!ze)return"E";te(de)}return de[D].objectID},getWeakData:function(de,ze){if(!en(de,D)){if(!Ll(de))return!0;if(!ze)return!1;te(de)}return de[D].weakData},onFreeze:function(de){return bc&&M&&Ll(de)&&!en(de,D)&&te(de),de}};Or[D]=!0}),bs=(dl.enable,dl.fastKey,dl.getWeakData,dl.onFreeze,function(_,w,M){var D=_.indexOf("Map")!==-1,N=_.indexOf("Weak")!==-1,te=D?"set":"add",pe=je[_],de=pe&&pe.prototype,ze=pe,Xe={},He=function(Sn){var Zn=Tt(de[Sn]);Ra(de,Sn,Sn=="add"?function(bn){return Zn(this,bn===0?0:bn),this}:Sn=="delete"?function(bn){return!(N&&!Rr(bn))&&Zn(this,bn===0?0:bn)}:Sn=="get"?function(bn){return N&&!Rr(bn)?void 0:Zn(this,bn===0?0:bn)}:Sn=="has"?function(bn){return!(N&&!Rr(bn))&&Zn(this,bn===0?0:bn)}:function(bn,ii){return Zn(this,bn===0?0:bn,ii),this})};if(k(_,!fi(pe)||!(N||de.forEach&&!V(function(){new pe().entries().next()}))))ze=M.getConstructor(w,_,D,te),dl.enable();else if(k(_,!0)){var nr=new ze,Er=nr[te](N?{}:-0,1)!=nr,Nr=V(function(){nr.has(1)}),Yr=po(function(Sn){new pe(Sn)}),Ln=!N&&V(function(){for(var Sn=new pe,Zn=5;Zn--;)Sn[te](Zn,Zn);return!Sn.has(-0)});Yr||((ze=w(function(Sn,Zn){ha(Sn,de);var bn=Vc(new pe,Sn,ze);return Zn!=null&&Yo(Zn,bn[te],{that:bn,AS_ENTRIES:D}),bn})).prototype=de,de.constructor=ze),(Nr||Ln)&&(He("delete"),He("has"),D&&He("get")),(Ln||Er)&&He(te),N&&de.clear&&delete de.clear}return Xe[_]=ze,F({global:!0,constructor:!0,forced:ze!=pe},Xe),Xr(ze,_),N||M.setStrong(ze,_,D),ze}),Hc=dl.getWeakData,Wc=Bi.set,rd=Bi.getterFor,ip=ir.find,nd=ir.findIndex,ap=Tt([].splice),id=0,op=function(_){return _.frozen||(_.frozen=new sp)},sp=function(){this.entries=[]},kp=function(_,w){return ip(_.entries,function(M){return M[0]===w})};sp.prototype={get:function(_){var w=kp(this,_);if(w)return w[1]},has:function(_){return!!kp(this,_)},set:function(_,w){var M=kp(this,_);M?M[1]=w:this.entries.push([_,w])},delete:function(_){var w=nd(this.entries,function(M){return M[0]===_});return~w&&ap(this.entries,w,1),!!~w}};var Bh,ad={getConstructor:function(_,w,M,D){var N=_(function(ze,Xe){ha(ze,te),Wc(ze,{type:w,id:id++,frozen:void 0}),Xe!=null&&Yo(Xe,ze[D],{that:ze,AS_ENTRIES:M})}),te=N.prototype,pe=rd(w),de=function(ze,Xe,He){var nr=pe(ze),Er=Hc(ia(Xe),!0);return Er===!0?op(nr).set(Xe,He):Er[nr.id]=He,ze};return Pl(te,{delete:function(ze){var Xe=pe(this);if(!Rr(ze))return!1;var He=Hc(ze);return He===!0?op(Xe).delete(ze):He&&en(He,Xe.id)&&delete He[Xe.id]},has:function(ze){var Xe=pe(this);if(!Rr(ze))return!1;var He=Hc(ze);return He===!0?op(Xe).has(ze):He&&en(He,Xe.id)}}),Pl(te,M?{get:function(ze){var Xe=pe(this);if(Rr(ze)){var He=Hc(ze);return He===!0?op(Xe).get(ze):He?He[Xe.id]:void 0}},set:function(ze,Xe){return de(this,ze,Xe)}}:{add:function(ze){return de(this,ze,!0)}}),N}},ff=Bi.enforce,Od=!je.ActiveXObject&&"ActiveXObject"in je,Lp=function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},Nh=bs("WeakMap",Lp,ad);if(aa&&Od){Bh=ad.getConstructor(Lp,"WeakMap",!0),dl.enable();var Ec=Nh.prototype,Rd=Tt(Ec.delete),mo=Tt(Ec.has),Xc=Tt(Ec.get),od=Tt(Ec.set);Pl(Ec,{delete:function(_){if(Rr(_)&&!Ll(_)){var w=ff(this);return w.frozen||(w.frozen=new Bh),Rd(this,_)||w.frozen.delete(_)}return Rd(this,_)},has:function(_){if(Rr(_)&&!Ll(_)){var w=ff(this);return w.frozen||(w.frozen=new Bh),mo(this,_)||w.frozen.has(_)}return mo(this,_)},get:function(_){if(Rr(_)&&!Ll(_)){var w=ff(this);return w.frozen||(w.frozen=new Bh),mo(this,_)?Xc(this,_):w.frozen.get(_)}return Xc(this,_)},set:function(_,w){if(Rr(_)&&!Ll(_)){var M=ff(this);M.frozen||(M.frozen=new Bh),mo(this,_)?od(this,_,w):M.frozen.set(_,w)}else od(this,_,w);return this}})}var sd=nt("iterator"),Op=nt("toStringTag"),Rp=Il.values,Dp=function(_,w){if(_){if(_[sd]!==Rp)try{Ii(_,sd,Rp)}catch(D){_[sd]=Rp}if(_[Op]||Ii(_,Op,w),Pe[w]){for(var M in Il)if(_[M]!==Il[M])try{Ii(_,M,Il[M])}catch(D){_[M]=Il[M]}}}};for(var ud in Pe)Dp(je[ud]&&je[ud].prototype,ud);Dp($e,"DOMTokenList");var jf,ld,up,Ol,Ql=new WeakMap,_h=function(){function _(){ve(this,_),Ql.set(this,{})}return se(_,[{key:"addEventListener",value:function(w,M){var D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},N=Ql.get(this);N||(N={}),N[w]||(N[w]=[]),N[w].push(M),Ql.set(this,N),D.capture,D.once,D.passive}},{key:"removeEventListener",value:function(w,M){var D=Ql.get(this);if(D){var N=D[w];if(N&&N.length>0){for(var te=N.length;te--;te>0)if(N[te]===M){N.splice(te,1);break}}}}},{key:"dispatchEvent",value:function(w){var M=Ql.get(this)[w.type];if(M){var D,N=function(te,pe){var de=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!de){if(Array.isArray(te)||(de=Lt(te))||pe&&te&&typeof te.length=="number"){de&&(te=de);var ze=0,Xe=function(){};return{s:Xe,n:function(){return ze>=te.length?{done:!0}:{done:!1,value:te[ze++]}},e:function(Nr){throw Nr},f:Xe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var He,nr=!0,Er=!1;return{s:function(){de=de.call(te)},n:function(){var Nr=de.next();return nr=Nr.done,Nr},e:function(Nr){Er=!0,He=Nr},f:function(){try{nr||de.return==null||de.return()}finally{if(Er)throw He}}}}(M);try{for(N.s();!(D=N.n()).done;)(0,D.value)(w)}catch(te){N.e(te)}finally{N.f()}}}}]),_}(),cd=function(_){dt(M,_);var w=lr(M);function M(){var D;return ve(this,M),Be(Vt(D=w.call(this)),"className",void 0),Be(Vt(D),"children",void 0),D.className="",D.children=[],D}return se(M,[{key:"setAttribute",value:function(D,N){this[D]=N}},{key:"getAttribute",value:function(D){return this[D]}},{key:"setAttributeNS",value:function(D,N){this[D]=N}},{key:"getAttributeNS",value:function(D){return this[D]}}]),M}(function(_){dt(M,_);var w=lr(M);function M(){var D;return ve(this,M),Be(Vt(D=w.call(this)),"childNodes",void 0),D.childNodes=[],D}return se(M,[{key:"appendChild",value:function(D){this.childNodes.push(D)}},{key:"cloneNode",value:function(){var D=Object.create(this);return Object.assign(D,this),D}},{key:"removeChild",value:function(D){var N=this.childNodes.findIndex(function(te){return te===D});return N>-1?this.childNodes.splice(N,1):null}}]),M}(_h));if(typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var zh=my.getSystemInfoSync();jf=zh.screenWidth,ld=zh.screenHeight,up=zh.windowWidth,Ol=zh.windowHeight}else{var Dd=X.innerWidth,fd=X.innerHeight;jf=Dd,ld=fd,up=Dd,Ol=fd}var nv={width:jf,height:ld,availWidth:up,availHeight:Ol,availLeft:0,availTop:0},hd=nv.availWidth,iv=nv.availHeight,pd={style:[]};function Es(_,w){var M,D;"parentNode"in _||(M=w===0?function(){return null}:w===1?function(){return pd}:function(){return null},Object.defineProperty(_,"parentNode",{enumerable:!0,get:M})),"parentElement"in _||(D=w===0?function(){return null}:w===1?function(){return pd}:function(){return null},Object.defineProperty(_,"parentElement",{enumerable:!0,get:D}))}function Gf(_){_.style=_.style||{},Object.assign(_.style,{top:"0px",left:"0px",width:hd+"px",height:iv+"px",margin:"0px",padding:"0px"})}function s0(_){"clientLeft"in _||(_.clientLeft=0,_.clientTop=0),"clientWidth"in _||(_.clientWidth=hd,_.clientHeight=iv),"getBoundingClientRect"in _||(_.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function lp(_){"offsetLeft"in _||(_.offsetLeft=0,_.offsetTop=0),"offsetWidth"in _||(_.offsetWidth=hd,_.offsetHeight=iv)}function Dv(_){"scrollLeft"in _||(_.scrollLeft=0,_.scrollTop=0),"scrollWidth"in _||(_.scrollWidth=hd,_.scrollHeight=iv)}function av(_){var w=function(){return!0};_.classList=[],_.classList.add=w,_.classList.remove=w,_.classList.contains=w,_.classList.toggle=w}function Uh(){}var Cc=function(_){dt(M,_);var w=lr(M);function M(){var D,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",te=arguments.length>1?arguments[1]:void 0;return ve(this,M),Be(Vt(D=w.call(this)),"className",void 0),Be(Vt(D),"children",void 0),Be(Vt(D),"focus",void 0),Be(Vt(D),"blur",void 0),Be(Vt(D),"insertBefore",void 0),Be(Vt(D),"appendChild",void 0),Be(Vt(D),"removeChild",void 0),Be(Vt(D),"remove",void 0),Be(Vt(D),"innerHTML",void 0),Be(Vt(D),"tagName",void 0),D.className="",D.children=[],D.focus=Uh,D.blur=Uh,D.insertBefore=Uh,D.appendChild=Uh,D.removeChild=Uh,D.remove=Uh,D.innerHTML="",D.tagName=N.toUpperCase(),Es(Vt(D),te),Gf(Vt(D)),av(Vt(D)),s0(Vt(D)),lp(Vt(D)),Dv(Vt(D)),D}return se(M)}(cd),ov=function(_){dt(M,_);var w=lr(M);function M(){return ve(this,M),w.call(this,"video")}return se(M)}(function(_){dt(M,_);var w=lr(M);function M(D){return ve(this,M),w.call(this,D)}return se(M,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),M}(Cc)),Fd={};function sv(){return Fd}var Bd=se(function _(){ve(this,_);var w=sv(),M=w.createImage&&w.createImage()||{};return"tagName"in M||(M.tagName="IMG",M.__proto__=_.prototype),Es(M),av(M),Object.assign(M,{addEventListener:function(D,N){M["on".concat(D)]=N.bind(M)},removeEventListener:function(D){M["on".concat(D)]=null}}),M}),uv={href:"",protocol:"",host:""},u0=function(_){dt(M,_);var w=lr(M);function M(){return ve(this,M),w.call(this,"body",0)}return se(M,[{key:"addEventListener",value:function(D,N){}},{key:"removeEventListener",value:function(D,N,te){}},{key:"dispatchEvent",value:function(D){}}]),M}(Cc),Nd=function(_){dt(M,_);var w=lr(M);function M(){return ve(this,M),w.call(this,"html",0)}return se(M,[{key:"addEventListener",value:function(D,N){}},{key:"removeEventListener",value:function(D,N){}},{key:"dispatchEvent",value:function(D){}}]),M}(Cc),Fp={},lv={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:uv,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(_){return(_=_.toLowerCase())==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):_==="img"?new Bd:_==="video"?new ov:new Cc(_)},createElementNS:function(_,w){return this.createElement(w)},createTextNode:function(_){return _},getElementById:function(_){return null},getElementsByTagName:function(_){return _=_.toLowerCase(),[]},getElementsByTagNameNS:function(_,w){return this.getElementsByTagName(w)},getElementsByName:function(_){return[]},querySelector:function(_){return null},querySelectorAll:function(_){return[]},addEventListener:function(_,w,M){Fp[_]||(Fp[_]=[]),Fp[_].push(w)},removeEventListener:function(_,w){var M=Fp[_];if(M&&M.length>0){for(var D=M.length;D--;D>0)if(M[D]===w){M.splice(D,1);break}}},dispatchEvent:function(_){var w=_.type,M=Fp[w];if(M)for(var D=0;D<M.length;D++)M[D](_);_.target&&typeof _.target["on"+w]=="function"&&_.target["on"+w](_)},createEvent:function(_){return new zu(_)}};lv.documentElement=new Nd,lv.head=new Cc("head"),lv.body=new u0,me("match",function(_,w,M){return[function(D){var N=ln(this),te=D==null?void 0:St(D,_);return te?Ci(te,D,N):new RegExp(D)[_](Gs(N))},function(D){var N=ia(this),te=Gs(D),pe=M(w,N,te);if(pe.done)return pe.value;if(!N.global)return Xn(N,te);var de=N.unicode;N.lastIndex=0;for(var ze,Xe=[],He=0;(ze=Xn(N,te))!==null;){var nr=Gs(ze[0]);Xe[He]=nr,nr===""&&(N.lastIndex=tr(te,So(N.lastIndex),de)),He++}return He===0?null:Xe}]});var cv,Rl,Fv=nt("isConcatSpreadable"),Sc=be>=51||!V(function(){var _=[];return _[Fv]=!1,_.concat()[0]!==_}),fv=bi("concat"),l0=function(_){if(!Rr(_))return!1;var w=_[Fv];return w!==void 0?!!w:mt(_)};if(F({target:"Array",proto:!0,arity:1,forced:!Sc||!fv},{concat:function(_){var w,M,D,N,te,pe=Mi(this),de=Pt(pe,0),ze=0;for(w=-1,D=arguments.length;w<D;w++)if(l0(te=w===-1?pe:arguments[w]))for(N=oo(te),Uo(ze+N),M=0;M<N;M++,ze++)M in te&&xi(de,ze,te[M]);else Uo(ze+1),xi(de,ze++,te);return de.length=ze,de}}),typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Yc=my.getSystemInfoSync();cv=Yc.system,Yc.platform,Yc.language}else{var qc={versions:(Rl=X.navigator.userAgent,{trident:Rl.indexOf("Trident")>-1,presto:Rl.indexOf("Presto")>-1,webKit:Rl.indexOf("AppleWebKit")>-1,gecko:Rl.indexOf("Gecko")>-1&&Rl.indexOf("KHTML")===-1,mobile:!!Rl.match(/AppleWebKit.*Mobile.*/),ios:!!Rl.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Rl.indexOf("Android")>-1||Rl.indexOf("Linux")>-1,iPhone:Rl.indexOf("iPhone")>-1,iPad:Rl.indexOf("iPad")>-1,webApp:Rl.indexOf("Safari")===-1,weixin:Rl.indexOf("MicroMessenger")>-1,qq:Rl.match(/\sQQ/i)===" qq"}),language:(X.navigator.browserLanguage||X.navigator.language).toLowerCase()};qc.versions.android||qc.versions.trident||qc.versions.presto||qc.versions.webKit||qc.versions.gecko||qc.versions.mobile||qc.versions.ios||qc.versions.iPhone||qc.versions.iPad||qc.versions.webApp||qc.versions.weixin||qc.versions.qq,cv=X.navigator.userAgent,qc.language}cv.toLowerCase().indexOf("android"),ep("Uint8",function(_){return function(w,M,D){return _(this,w,M,D)}});var c0=Mn.f,cp=dl.fastKey,Zh=Bi.set,fp=Bi.getterFor;bs("Map",function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(_,w,M,D){var N=_(function(Xe,He){ha(Xe,te),Zh(Xe,{type:w,index:Cu(null),first:void 0,last:void 0,size:0}),Tr||(Xe.size=0),He!=null&&Yo(He,Xe[D],{that:Xe,AS_ENTRIES:M})}),te=N.prototype,pe=fp(w),de=function(Xe,He,nr){var Er,Nr,Yr=pe(Xe),Ln=ze(Xe,He);return Ln?Ln.value=nr:(Yr.last=Ln={index:Nr=cp(He,!0),key:He,value:nr,previous:Er=Yr.last,next:void 0,removed:!1},Yr.first||(Yr.first=Ln),Er&&(Er.next=Ln),Tr?Yr.size++:Xe.size++,Nr!=="F"&&(Yr.index[Nr]=Ln)),Xe},ze=function(Xe,He){var nr,Er=pe(Xe),Nr=cp(He);if(Nr!=="F")return Er.index[Nr];for(nr=Er.first;nr;nr=nr.next)if(nr.key==He)return nr};return Pl(te,{clear:function(){for(var Xe=pe(this),He=Xe.index,nr=Xe.first;nr;)nr.removed=!0,nr.previous&&(nr.previous=nr.previous.next=void 0),delete He[nr.index],nr=nr.next;Xe.first=Xe.last=void 0,Tr?Xe.size=0:this.size=0},delete:function(Xe){var He=pe(this),nr=ze(this,Xe);if(nr){var Er=nr.next,Nr=nr.previous;delete He.index[nr.index],nr.removed=!0,Nr&&(Nr.next=Er),Er&&(Er.previous=Nr),He.first==nr&&(He.first=Er),He.last==nr&&(He.last=Nr),Tr?He.size--:this.size--}return!!nr},forEach:function(Xe){for(var He,nr=pe(this),Er=rl(Xe,arguments.length>1?arguments[1]:void 0);He=He?He.next:nr.first;)for(Er(He.value,He.key,this);He&&He.removed;)He=He.previous},has:function(Xe){return!!ze(this,Xe)}}),Pl(te,M?{get:function(Xe){var He=ze(this,Xe);return He&&He.value},set:function(Xe,He){return de(this,Xe===0?0:Xe,He)}}:{add:function(Xe){return de(this,Xe=Xe===0?0:Xe,Xe)}}),Tr&&c0(te,"size",{get:function(){return pe(this).size}}),N},setStrong:function(_,w,M){var D=w+" Iterator",N=fp(w),te=fp(D);oh(_,w,function(pe,de){Zh(this,{type:D,target:pe,state:N(pe),kind:de,last:void 0})},function(){for(var pe=te(this),de=pe.kind,ze=pe.last;ze&&ze.removed;)ze=ze.previous;return pe.target&&(pe.last=ze=ze?ze.next:pe.state.first)?de=="keys"?{value:ze.key,done:!1}:de=="values"?{value:ze.value,done:!1}:{value:[ze.key,ze.value],done:!1}:(pe.target=void 0,{value:void 0,done:!0})},M?"entries":"values",!M,!0),Ki(w)}});var dd=Tt([].join),Bp=ju!=Object,Bv=Mr("join",",");F({target:"Array",proto:!0,forced:Bp||!Bv},{join:function(_){return dd(jo(this),_===void 0?",":_)}});var f0=V(function(){co(1)});F({target:"Object",stat:!0,forced:f0},{keys:function(_){return co(Mi(_))}});var zd=new Map,hv=new Map,Nv=new Map,hf=function(_){dt(M,_);var w=lr(M);function M(){var D;return ve(this,M),Be(Vt(D=w.call(this)),"onabort",void 0),Be(Vt(D),"onerror",void 0),Be(Vt(D),"onload",void 0),Be(Vt(D),"onloadstart",void 0),Be(Vt(D),"onprogress",void 0),Be(Vt(D),"ontimeout",void 0),Be(Vt(D),"onloadend",void 0),Be(Vt(D),"onreadystatechange",void 0),Be(Vt(D),"readyState",void 0),Be(Vt(D),"response",void 0),Be(Vt(D),"responseText",void 0),Be(Vt(D),"_responseType",void 0),Be(Vt(D),"responseXML",void 0),Be(Vt(D),"status",void 0),Be(Vt(D),"statusText",void 0),Be(Vt(D),"upload",void 0),Be(Vt(D),"withCredentials",void 0),Be(Vt(D),"timeout",void 0),Be(Vt(D),"_url",void 0),Be(Vt(D),"_method",void 0),D.onabort=null,D.onerror=null,D.onload=null,D.onloadstart=null,D.onprogress=null,D.ontimeout=null,D.onloadend=null,D.onreadystatechange=null,D.readyState=0,D.response=null,D.responseText=null,D._responseType="text",D.responseXML=null,D.status=0,D.statusText="",D.upload={},D.withCredentials=!1,zd.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),D}return se(M,[{key:"responseType",set:function(D){this._responseType=D}},{key:"abort",value:function(){var D=Nv.get("requestTask");D&&D.abort()}},{key:"getAllResponseHeaders",value:function(){var D=hv.get("responseHeader");return Object.keys(D).map(function(N){return"".concat(N,": ").concat(D[N])}).join(`
`)}},{key:"getResponseHeader",value:function(D){return hv.get("responseHeader")[D]}},{key:"open",value:function(D,N,te){this._method=D,this._url=N}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(D,N){var te=zd.get("requestHeader");te[D]=N,zd.set("requestHeader",te)}},{key:"addEventListener",value:function(D,N){var te=this;typeof N=="function"&&(this["on"+D]=function(){var pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pe.target=pe.target||te,N.call(te,pe)})}},{key:"removeEventListener",value:function(D,N){this["on"+D]===N&&(this["on"+D]=null)}}]),M}(_h);Be(hf,"UNSEND",void 0),Be(hf,"OPENED",void 0),Be(hf,"HEADERS_RECEIVED",void 0),Be(hf,"LOADING",void 0),Be(hf,"DONE",void 0),hf.UNSEND=0,hf.OPENED=1,hf.HEADERS_RECEIVED=2,hf.LOADING=3,hf.DONE=4;var xh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,h0=typeof wx!="undefined"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),Ud=xh||h0;Ud||X.XMLHttpRequest,Ud||X.location;function vd(_){return[_+1&255,_+1>>8&255,_+1>>8>>8&255]}var p0=ir.filter,pv=bi("filter");function Zd(_,w){var M=_.color;return M&&M.length?M:[1,1,1,1]}function dv(_,w,M){return M.length===2?[M[0],M[1],0]:[M[0],M[1],M[2]]}function Vd(_,w){return _.filter?[1]:[0]}function vv(_,w,M,D){return[w]}F({target:"Array",proto:!0,forced:!pv},{filter:function(_){return p0(this,_,arguments.length>1?arguments[1]:void 0)}});var hp=Np,zv=Np;function Np(_,w,M){M=M||2;var D,N,te,pe,de,ze,Xe,He=w&&w.length,nr=He?w[0]*M:_.length,Er=d0(_,0,nr,M,!0),Nr=[];if(!Er||Er.next===Er.prev)return Nr;if(He&&(Er=function(Ln,Sn,Zn,bn){var ii,Ei,go,uo,Xa,ro=[];for(ii=0,Ei=Sn.length;ii<Ei;ii++)go=Sn[ii]*bn,uo=ii<Ei-1?Sn[ii+1]*bn:Ln.length,(Xa=d0(Ln,go,uo,bn,!1))===Xa.next&&(Xa.steiner=!0),ro.push(Uv(Xa));for(ro.sort(Mm),ii=0;ii<ro.length;ii++)Zn=Im(ro[ii],Zn);return Zn}(_,w,Er,M)),_.length>80*M){D=te=_[0],N=pe=_[1];for(var Yr=M;Yr<nr;Yr+=M)(de=_[Yr])<D&&(D=de),(ze=_[Yr+1])<N&&(N=ze),de>te&&(te=de),ze>pe&&(pe=ze);Xe=(Xe=Math.max(te-D,pe-N))!==0?32767/Xe:0}return ga(Er,Nr,M,D,N,Xe,0),Nr}function d0(_,w,M,D,N){var te,pe;if(N===Lm(_,w,M,D)>0)for(te=w;te<M;te+=D)pe=Og(te,_[te],_[te+1],pe);else for(te=M-D;te>=w;te-=D)pe=Og(te,_[te],_[te+1],pe);return pe&&H0(pe,pe.next)&&(y0(pe),pe=pe.next),pe}function pp(_,w){if(!_)return _;w||(w=_);var M,D=_;do if(M=!1,D.steiner||!H0(D,D.next)&&Ks(D.prev,D,D.next)!==0)D=D.next;else{if(y0(D),(D=w=D.prev)===D.next)break;M=!0}while(M||D!==w);return w}function ga(_,w,M,D,N,te,pe){if(_){!pe&&te&&function(He,nr,Er,Nr){var Yr=He;do Yr.z===0&&(Yr.z=Hf(Yr.x,Yr.y,nr,Er,Nr)),Yr.prevZ=Yr.prev,Yr.nextZ=Yr.next,Yr=Yr.next;while(Yr!==He);Yr.prevZ.nextZ=null,Yr.prevZ=null,function(Ln){var Sn,Zn,bn,ii,Ei,go,uo,Xa,ro=1;do{for(Zn=Ln,Ln=null,Ei=null,go=0;Zn;){for(go++,bn=Zn,uo=0,Sn=0;Sn<ro&&(uo++,bn=bn.nextZ);Sn++);for(Xa=ro;uo>0||Xa>0&&bn;)uo!==0&&(Xa===0||!bn||Zn.z<=bn.z)?(ii=Zn,Zn=Zn.nextZ,uo--):(ii=bn,bn=bn.nextZ,Xa--),Ei?Ei.nextZ=ii:Ln=ii,ii.prevZ=Ei,Ei=ii;Zn=bn}Ei.nextZ=null,ro*=2}while(go>1)}(Yr)}(_,D,N,te);for(var de,ze,Xe=_;_.prev!==_.next;)if(de=_.prev,ze=_.next,te?v0(_,D,N,te):wa(_))w.push(de.i/M|0),w.push(_.i/M|0),w.push(ze.i/M|0),y0(_),_=ze.next,Xe=ze.next;else if((_=ze)===Xe){pe?pe===1?ga(_=Tm(pp(_),w,M),w,M,D,N,te,2):pe===2&&G0(_,w,M,D,N,te):ga(pp(_),w,M,D,N,te,1);break}}}function wa(_){var w=_.prev,M=_,D=_.next;if(Ks(w,M,D)>=0)return!1;for(var N=w.x,te=M.x,pe=D.x,de=w.y,ze=M.y,Xe=D.y,He=N<te?N<pe?N:pe:te<pe?te:pe,nr=de<ze?de<Xe?de:Xe:ze<Xe?ze:Xe,Er=N>te?N>pe?N:pe:te>pe?te:pe,Nr=de>ze?de>Xe?de:Xe:ze>Xe?ze:Xe,Yr=D.next;Yr!==w;){if(Yr.x>=He&&Yr.x<=Er&&Yr.y>=nr&&Yr.y<=Nr&&md(N,de,te,ze,pe,Xe,Yr.x,Yr.y)&&Ks(Yr.prev,Yr,Yr.next)>=0)return!1;Yr=Yr.next}return!0}function v0(_,w,M,D){var N=_.prev,te=_,pe=_.next;if(Ks(N,te,pe)>=0)return!1;for(var de=N.x,ze=te.x,Xe=pe.x,He=N.y,nr=te.y,Er=pe.y,Nr=de<ze?de<Xe?de:Xe:ze<Xe?ze:Xe,Yr=He<nr?He<Er?He:Er:nr<Er?nr:Er,Ln=de>ze?de>Xe?de:Xe:ze>Xe?ze:Xe,Sn=He>nr?He>Er?He:Er:nr>Er?nr:Er,Zn=Hf(Nr,Yr,w,M,D),bn=Hf(Ln,Sn,w,M,D),ii=_.prevZ,Ei=_.nextZ;ii&&ii.z>=Zn&&Ei&&Ei.z<=bn;){if(ii.x>=Nr&&ii.x<=Ln&&ii.y>=Yr&&ii.y<=Sn&&ii!==N&&ii!==pe&&md(de,He,ze,nr,Xe,Er,ii.x,ii.y)&&Ks(ii.prev,ii,ii.next)>=0||(ii=ii.prevZ,Ei.x>=Nr&&Ei.x<=Ln&&Ei.y>=Yr&&Ei.y<=Sn&&Ei!==N&&Ei!==pe&&md(de,He,ze,nr,Xe,Er,Ei.x,Ei.y)&&Ks(Ei.prev,Ei,Ei.next)>=0))return!1;Ei=Ei.nextZ}for(;ii&&ii.z>=Zn;){if(ii.x>=Nr&&ii.x<=Ln&&ii.y>=Yr&&ii.y<=Sn&&ii!==N&&ii!==pe&&md(de,He,ze,nr,Xe,Er,ii.x,ii.y)&&Ks(ii.prev,ii,ii.next)>=0)return!1;ii=ii.prevZ}for(;Ei&&Ei.z<=bn;){if(Ei.x>=Nr&&Ei.x<=Ln&&Ei.y>=Yr&&Ei.y<=Sn&&Ei!==N&&Ei!==pe&&md(de,He,ze,nr,Xe,Er,Ei.x,Ei.y)&&Ks(Ei.prev,Ei,Ei.next)>=0)return!1;Ei=Ei.nextZ}return!0}function Tm(_,w,M){var D=_;do{var N=D.prev,te=D.next.next;!H0(N,te)&&kg(N,D,D.next,te)&&g0(N,te)&&g0(te,N)&&(w.push(N.i/M|0),w.push(D.i/M|0),w.push(te.i/M|0),y0(D),y0(D.next),D=_=te),D=D.next}while(D!==_);return pp(D)}function G0(_,w,M,D,N,te){var pe=_;do{for(var de=pe.next.next;de!==pe.prev;){if(pe.i!==de.i&&mv(pe,de)){var ze=Lg(pe,de);return pe=pp(pe,pe.next),ze=pp(ze,ze.next),ga(pe,w,M,D,N,te,0),void ga(ze,w,M,D,N,te,0)}de=de.next}pe=pe.next}while(pe!==_)}function Mm(_,w){return _.x-w.x}function Im(_,w){var M=function(N,te){var pe,de=te,ze=N.x,Xe=N.y,He=-1/0;do{if(Xe<=de.y&&Xe>=de.next.y&&de.next.y!==de.y){var nr=de.x+(Xe-de.y)*(de.next.x-de.x)/(de.next.y-de.y);if(nr<=ze&&nr>He&&(He=nr,pe=de.x<de.next.x?de:de.next,nr===ze))return pe}de=de.next}while(de!==te);if(!pe)return null;var Er,Nr=pe,Yr=pe.x,Ln=pe.y,Sn=1/0;de=pe;do ze>=de.x&&de.x>=Yr&&ze!==de.x&&md(Xe<Ln?ze:He,Xe,Yr,Ln,Xe<Ln?He:ze,Xe,de.x,de.y)&&(Er=Math.abs(Xe-de.y)/(ze-de.x),g0(de,N)&&(Er<Sn||Er===Sn&&(de.x>pe.x||de.x===pe.x&&Pm(pe,de)))&&(pe=de,Sn=Er)),de=de.next;while(de!==Nr);return pe}(_,w);if(!M)return w;var D=Lg(M,_);return pp(D,D.next),pp(M,M.next)}function Pm(_,w){return Ks(_.prev,_,w.prev)<0&&Ks(w.next,_,_.next)<0}function Hf(_,w,M,D,N){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-M)*N|0)|_<<8))|_<<4))|_<<2))|_<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w=(w-D)*N|0)|w<<8))|w<<4))|w<<2))|w<<1))<<1}function Uv(_){var w=_,M=_;do(w.x<M.x||w.x===M.x&&w.y<M.y)&&(M=w),w=w.next;while(w!==_);return M}function md(_,w,M,D,N,te,pe,de){return(N-pe)*(w-de)>=(_-pe)*(te-de)&&(_-pe)*(D-de)>=(M-pe)*(w-de)&&(M-pe)*(te-de)>=(N-pe)*(D-de)}function mv(_,w){return _.next.i!==w.i&&_.prev.i!==w.i&&!function(M,D){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==D.i&&N.next.i!==D.i&&kg(N,N.next,M,D))return!0;N=N.next}while(N!==M);return!1}(_,w)&&(g0(_,w)&&g0(w,_)&&function(M,D){var N=M,te=!1,pe=(M.x+D.x)/2,de=(M.y+D.y)/2;do N.y>de!=N.next.y>de&&N.next.y!==N.y&&pe<(N.next.x-N.x)*(de-N.y)/(N.next.y-N.y)+N.x&&(te=!te),N=N.next;while(N!==M);return te}(_,w)&&(Ks(_.prev,_,w.prev)||Ks(_,w.prev,w))||H0(_,w)&&Ks(_.prev,_,_.next)>0&&Ks(w.prev,w,w.next)>0)}function Ks(_,w,M){return(w.y-_.y)*(M.x-w.x)-(w.x-_.x)*(M.y-w.y)}function H0(_,w){return _.x===w.x&&_.y===w.y}function kg(_,w,M,D){var N=m0(Ks(_,w,M)),te=m0(Ks(_,w,D)),pe=m0(Ks(M,D,_)),de=m0(Ks(M,D,w));return N!==te&&pe!==de||!(N!==0||!W0(_,M,w))||!(te!==0||!W0(_,D,w))||!(pe!==0||!W0(M,_,D))||!(de!==0||!W0(M,w,D))}function W0(_,w,M){return w.x<=Math.max(_.x,M.x)&&w.x>=Math.min(_.x,M.x)&&w.y<=Math.max(_.y,M.y)&&w.y>=Math.min(_.y,M.y)}function m0(_){return _>0?1:_<0?-1:0}function g0(_,w){return Ks(_.prev,_,_.next)<0?Ks(_,w,_.next)>=0&&Ks(_,_.prev,w)>=0:Ks(_,w,_.prev)<0||Ks(_,_.next,w)<0}function Lg(_,w){var M=new km(_.i,_.x,_.y),D=new km(w.i,w.x,w.y),N=_.next,te=w.prev;return _.next=w,w.prev=_,M.next=N,N.prev=M,D.next=M,M.prev=D,te.next=D,D.prev=te,D}function Og(_,w,M,D){var N=new km(_,w,M);return D?(N.next=D.next,N.prev=D,D.next.prev=N,D.next=N):(N.prev=N,N.next=N),N}function y0(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function km(_,w,M){this.i=_,this.x=w,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lm(_,w,M,D){for(var N=0,te=w,pe=M-D;te<M;te+=D)N+=(_[pe]-_[te])*(_[te+1]+_[pe+1]),pe=te;return N}Np.deviation=function(_,w,M,D){var N=w&&w.length,te=N?w[0]*M:_.length,pe=Math.abs(Lm(_,0,te,M));if(N)for(var de=0,ze=w.length;de<ze;de++){var Xe=w[de]*M,He=de<ze-1?w[de+1]*M:_.length;pe-=Math.abs(Lm(_,Xe,He,M))}var nr=0;for(de=0;de<D.length;de+=3){var Er=D[de]*M,Nr=D[de+1]*M,Yr=D[de+2]*M;nr+=Math.abs((_[Er]-_[Yr])*(_[Nr+1]-_[Er+1])-(_[Er]-_[Nr])*(_[Yr+1]-_[Er+1]))}return pe===0&&nr===0?0:Math.abs((nr-pe)/pe)},Np.flatten=function(_){for(var w=_[0][0].length,M={vertices:[],holes:[],dimensions:w},D=0,N=0;N<_.length;N++){for(var te=0;te<_[N].length;te++)for(var pe=0;pe<w;pe++)M.vertices.push(_[N][te][pe]);N>0&&(D+=_[N-1].length,M.holes.push(D))}return M},hp.default=zv;var Rg=Tt(1 .valueOf),Dg=Tt("".replace),X0=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,Vy=RegExp("^"+X0+X0+"*"),jy=RegExp(X0+X0+"*$"),Om=function(_){return function(w){var M=Gs(ln(w));return 1&_&&(M=Dg(M,Vy,"")),2&_&&(M=Dg(M,jy,"")),M}},Y0={start:Om(1),end:Om(2),trim:Om(3)},Gy=fa.f,Hy=Ze.f,Wy=Mn.f,Xy=Y0.trim,jd=je.Number,Rm=jd.prototype,Yy=je.TypeError,qy=Tt("".slice),q0=Tt("".charCodeAt),$y=function(_){var w=jr(_,"number");return typeof w=="bigint"?w:Ky(w)},Ky=function(_){var w,M,D,N,te,pe,de,ze,Xe=jr(_,"number");if(ce(Xe))throw Yy("Cannot convert a Symbol value to a number");if(typeof Xe=="string"&&Xe.length>2){if(Xe=Xy(Xe),(w=q0(Xe,0))===43||w===45){if((M=q0(Xe,2))===88||M===120)return NaN}else if(w===48){switch(q0(Xe,1)){case 66:case 98:D=2,N=49;break;case 79:case 111:D=8,N=55;break;default:return+Xe}for(pe=(te=qy(Xe,2)).length,de=0;de<pe;de++)if((ze=q0(te,de))<48||ze>N)return NaN;return parseInt(te,D)}}return+Xe};if(k("Number",!jd(" 0o1")||!jd("0b1")||jd("+0x1"))){for(var $0,Zv=function(_){var w=arguments.length<1?0:jd($y(_)),M=this;return pa(Rm,M)&&V(function(){Rg(M)})?Vc(Object(w),M,Zv):w},_0=Tr?Gy(jd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),K0=0;_0.length>K0;K0++)en(jd,$0=_0[K0])&&!en(Zv,$0)&&Wy(Zv,$0,Hy(jd,$0));Zv.prototype=Rm,Rm.constructor=Zv,Ra(je,"Number",Zv,{constructor:!0})}var Dm=RangeError,Fm=RangeError,zp=String,gd=Math.floor,x0=Tt(function(_){var w=Gs(ln(this)),M="",D=ri(_);if(D<0||D==1/0)throw Dm("Wrong number of repetitions");for(;D>0;(D>>>=1)&&(w+=w))1&D&&(M+=w);return M}),Q0=Tt("".slice),gv=Tt(1 .toFixed),yd=function(_,w,M){return w===0?M:w%2==1?yd(_,w-1,M*_):yd(_*_,w/2,M)},Gd=function(_,w,M){for(var D=-1,N=M;++D<6;)N+=w*_[D],_[D]=N%1e7,N=gd(N/1e7)},J0=function(_,w){for(var M=6,D=0;--M>=0;)D+=_[M],_[M]=gd(D/w),D=D%w*1e7},Bm=function(_){for(var w=6,M="";--w>=0;)if(M!==""||w===0||_[w]!==0){var D=zp(_[w]);M=M===""?D:M+x0("0",7-D.length)+D}return M},Fg=V(function(){return gv(8e-5,3)!=="0.000"||gv(.9,0)!=="1"||gv(1.255,2)!=="1.25"||gv(1000000000000000100,0)!=="1000000000000000128"})||!V(function(){gv({})});function Hd(_){return typeof _=="number"}function ou(_){var w=Math.max(Math.min(85.0511287798,_[1]),-85.0511287798),M=Math.PI/180,D=_[0]*M,N=w*M;return N=Math.log(Math.tan(Math.PI/4+N/2)),D=(256<<20)*(.5/Math.PI*D+.5),N=(256<<20)*(-.5/Math.PI*N+(M=.5)),[Math.floor(D),Math.floor(N)]}F({target:"Number",proto:!0,forced:Fg},{toFixed:function(_){var w,M,D,N,te=Rg(this),pe=ri(_),de=[0,0,0,0,0,0],ze="",Xe="0";if(pe<0||pe>20)throw Fm("Incorrect fraction digits");if(te!=te)return"NaN";if(te<=-1e21||te>=1e21)return zp(te);if(te<0&&(ze="-",te=-te),te>1e-21)if(M=(w=function(He){for(var nr=0,Er=He;Er>=4096;)nr+=12,Er/=4096;for(;Er>=2;)nr+=1,Er/=2;return nr}(te*yd(2,69,1))-69)<0?te*yd(2,-w,1):te/yd(2,w,1),M*=4503599627370496,(w=52-w)>0){for(Gd(de,0,M),D=pe;D>=7;)Gd(de,1e7,0),D-=7;for(Gd(de,yd(10,D,1),0),D=w-1;D>=23;)J0(de,1<<23),D-=23;J0(de,1<<D),Gd(de,1,1),J0(de,2),Xe=Bm(de)}else Gd(de,0,M),Gd(de,1<<-w,0),Xe=Bm(de)+x0("0",pe);return Xe=pe>0?ze+((N=Xe.length)<=pe?"0."+x0("0",pe-N)+Xe:Q0(Xe,0,N-pe)+"."+Q0(Xe,N-pe)):ze+Xe}});var em,Nm=/"/g,zm=Tt("".replace);F({target:"String",proto:!0,forced:(em="sub",V(function(){var _=""[em]('"');return _!==_.toLowerCase()||_.split('"').length>3}))},{sub:function(){return _="sub",w="",M="",D=Gs(ln(this)),N="<"+_,w!==""&&(N+=" "+w+'="'+zm(Gs(M),Nm,"&quot;")+'"'),N+">"+D+"</"+_+">";var _,w,M,D,N}});var b0=RegExp.prototype,Um=gn.PROPER,Zm=RegExp.prototype.toString,Bg=V(function(){return Zm.call({source:"a",flags:"b"})!="/a/b"}),Ng=Um&&Zm.name!="toString";(Bg||Ng)&&Ra(RegExp.prototype,"toString",function(){var _=ia(this);return"/"+Gs(_.source)+"/"+Gs(function(w){var M=w.flags;return M!==void 0||"flags"in b0||en(w,"flags")||!pa(b0,w)?M:Ci(xc,w)}(_))},{unsafe:!0});var tm=typeof Float32Array!="undefined"?Float32Array:Array;function Ku(){var _=new tm(2);return tm!=Float32Array&&(_[0]=0,_[1]=0),_}function rm(_,w){var M=new tm(2);return M[0]=_,M[1]=w,M}function Vv(_,w){return _[0]=w[0],_[1]=w[1],_}function Y(_,w,M){return _[0]=w[0]+M[0],_[1]=w[1]+M[1],_}function jv(_,w,M){return _[0]=w[0]-M[0],_[1]=w[1]-M[1],_}function yv(_,w){var M=w[0],D=w[1],N=M*M+D*D;return N>0&&(N=1/Math.sqrt(N)),_[0]=w[0]*N,_[1]=w[1]*N,_}function Gv(_,w){return _[0]*w[0]+_[1]*w[1]}Math.hypot||(Math.hypot=function(){for(var _=0,w=arguments.length;w--;)_+=arguments[w]*arguments[w];return Math.sqrt(_)});var Vm,E0=jv,Hv=(Vm=Ku(),Ku()),Uu=(Ku(),Ku()),pf=Ku(),Wd=Ku();function C0(_,w,M,D,N){return Y(_,M,D),yv(_,_),[N/Gv(w=rm(-_[1],_[0]),rm(-M[1],M[0])),w]}function Up(_,w){return function(M,D,N){return M[0]=D,M[1]=N,M}(_,-w[1],w[0])}function Xd(_,w,M){return E0(_,w,M),yv(_,_),_}function S0(_,w){return _[0]===w[0]&&_[1]===w[1]}var zg=function(){function _(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ve(this,_),Be(this,"complex",void 0),Be(this,"join",void 0),Be(this,"cap",void 0),Be(this,"miterLimit",void 0),Be(this,"thickness",void 0),Be(this,"normal",void 0),Be(this,"lastFlip",-1),Be(this,"miter",rm(0,0)),Be(this,"started",!1),Be(this,"dash",!1),Be(this,"totalDistance",0),Be(this,"currentIndex",0),this.join=w.join||"miter",this.cap=w.cap||"butt",this.miterLimit=w.miterLimit||10,this.thickness=w.thickness||1,this.dash=w.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return se(_,[{key:"extrude_gaode2",value:function(w,M){var D=this.complex;if(w.length<=1)return D;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=w.length,te=D.startIndex,pe=1;pe<N;pe++){var de,ze,Xe,He=w[pe-1];He.push((de=M[pe-1][2])!==null&&de!==void 0?de:0);var nr=M[pe-1],Er=w[pe];Er.push((ze=M[pe][2])!==null&&ze!==void 0?ze:0);var Nr=M[pe],Yr=pe<w.length-1?[].concat(It(w[pe+1]),[(Xe=M[pe+1][2])!==null&&Xe!==void 0?Xe:0]):null,Ln=pe<M.length-1?M[pe+1]:null;te+=this.segment_gaode2(D,te,He,Er,Yr,nr,Nr,Ln)}if(this.dash)for(var Sn=0;Sn<D.positions.length/6;Sn++)D.positions[6*Sn+5]=this.totalDistance;return D.startIndex=D.positions.length/6,D}},{key:"simpleExtrude_gaode2",value:function(w,M){var D=this.complex;if(w.length<=1)return D;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=w.length,te=D.startIndex,pe=1;pe<N;pe++){var de,ze,Xe,He=w[pe-1];He.push((de=M[pe-1][2])!==null&&de!==void 0?de:0);var nr=M[pe-1],Er=w[pe];Er.push((ze=M[pe][2])!==null&&ze!==void 0?ze:0);var Nr=M[pe],Yr=pe<w.length-1?[].concat(It(w[pe+1]),[(Xe=M[pe+1][2])!==null&&Xe!==void 0?Xe:0]):null,Ln=pe<M.length-1?M[pe+1]:null;te+=this.simpleSegment(D,te,He,Er,Yr,nr,Nr,Ln)}if(this.dash)for(var Sn=0;Sn<D.positions.length/6;Sn++)D.positions[6*Sn+5]=this.totalDistance;return D.startIndex=D.positions.length/6,D}},{key:"extrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var D=w.length,N=M.startIndex,te=1;te<D;te++){var pe=w[te-1],de=w[te],ze=te<w.length-1?w[te+1]:null;N+=this.segment(M,N,pe,de,ze)}if(this.dash)for(var Xe=0;Xe<M.positions.length/6;Xe++)M.positions[6*Xe+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"simpleExtrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var D=w.length,N=M.startIndex,te=1;te<D;te++){var pe=w[te-1],de=w[te],ze=te<w.length-1?w[te+1]:null;N+=this.simpleSegment(M,N,pe,de,ze)}if(this.dash)for(var Xe=0;Xe<M.positions.length/6;Xe++)M.positions[6*Xe+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"segment_gaode2",value:function(w,M,D,N,te,pe,de,ze){var Xe=0,He=w.indices,nr=w.positions,Er=w.normals,Nr=this.cap==="square",Yr=this.join==="bevel",Ln=ou([de[0],de[1]]),Sn=ou([pe[0],pe[1]]);Xd(Uu,N,D);var Zn=0;if(this.dash&&(Zn=this.lineSegmentDistance(Ln,Sn),this.totalDistance+=Zn),this.normal||(this.normal=Ku(),Up(this.normal,Uu)),!this.started)if(this.started=!0,Nr){var bn=Ku(),ii=Ku();Y(bn,this.normal,Uu),Y(ii,this.normal,Uu),Er.push(ii[0],ii[1],0),Er.push(bn[0],bn[1],0),nr.push(D[0],D[1],0|D[2],this.totalDistance-Zn,-this.thickness,0|D[2]),this.complex.indexes.push(this.currentIndex),nr.push(D[0],D[1],0|D[2],this.totalDistance-Zn,this.thickness,0|D[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(nr,Er,D,this.normal,this.thickness,this.totalDistance-Zn);if(He.push(M+0,M+1,M+2),te){S0(N,te)&&Y(te,N,yv(te,jv(te,N,D))),Xd(pf,te,N);var Ei=Qt(C0(Wd,Ku(),Uu,pf,this.thickness),2),go=Ei[0],uo=Ei[1],Xa=Gv(Wd,this.normal)<0?-1:1,ro=Yr;!ro&&this.join==="miter"&&go>this.miterLimit&&(ro=!0),ro?(Er.push(this.normal[0],this.normal[1],0),Er.push(uo[0],uo[1],0),nr.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Xa,0|N[2]),this.complex.indexes.push(this.currentIndex),nr.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*Xa,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,He.push.apply(He,It(this.lastFlip!==-Xa?[M,M+2,M+3]:[M+2,M+1,M+3])),He.push(M+2,M+3,M+4),Up(Hv,pf),Vv(this.normal,Hv),Er.push(this.normal[0],this.normal[1],0),nr.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Xa,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Xe+=3):(this.extrusions(nr,Er,N,uo,go,this.totalDistance),He.push.apply(He,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Xa=-1,Vv(this.normal,uo),Xe+=2),this.lastFlip=Xa}else{if(Up(this.normal,Uu),Nr){var no=Ku(),Kr=Ku();E0(Kr,Uu,this.normal),Y(no,Uu,this.normal),Er.push(Kr[0],Kr[1],0),Er.push(no[0],no[1],0),nr.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),nr.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(nr,Er,N,this.normal,this.thickness,this.totalDistance);He.push.apply(He,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Xe+=2}return Xe}},{key:"simpleSegment",value:function(w,M,D,N,te){var pe=0,de=w.indices,ze=w.positions,Xe=w.normals,He=ou([N[0],N[1]]),nr=ou([D[0],D[1]]);Xd(Uu,He,nr);var Er=0;if(this.dash&&(Er=this.lineSegmentDistance(He,nr),this.totalDistance+=Er),this.normal||(this.normal=Ku(),Up(this.normal,Uu)),this.started||(this.started=!0,this.extrusions(ze,Xe,D,this.normal,this.thickness,this.totalDistance-Er)),de.push(M+0,M+1,M+2),te){var Nr=ou([te[0],te[1]]);S0(He,Nr)&&Y(Nr,He,yv(Nr,jv(Nr,He,nr))),Xd(pf,Nr,He);var Yr=Qt(C0(Wd,Ku(),Uu,pf,this.thickness),2),Ln=Yr[0],Sn=Yr[1];Gv(Wd,this.normal),this.extrusions(ze,Xe,N,Sn,Ln,this.totalDistance),de.push.apply(de,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Vv(this.normal,Sn),pe+=2,this.lastFlip=-1}else Up(this.normal,Uu),this.extrusions(ze,Xe,N,this.normal,this.thickness,this.totalDistance),de.push.apply(de,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),pe+=2;return pe}},{key:"segment",value:function(w,M,D,N,te){var pe=0,de=w.indices,ze=w.positions,Xe=w.normals,He=this.cap==="square",nr=this.join==="bevel",Er=ou([N[0],N[1]]),Nr=ou([D[0],D[1]]);Xd(Uu,Er,Nr);var Yr=0;if(this.dash&&(Yr=this.lineSegmentDistance(Er,Nr),this.totalDistance+=Yr),this.normal||(this.normal=Ku(),Up(this.normal,Uu)),!this.started)if(this.started=!0,He){var Ln=Ku(),Sn=Ku();Y(Ln,this.normal,Uu),Y(Sn,this.normal,Uu),Xe.push(Sn[0],Sn[1],0),Xe.push(Ln[0],Ln[1],0),ze.push(D[0],D[1],0|D[2],this.totalDistance-Yr,-this.thickness,0|D[2]),this.complex.indexes.push(this.currentIndex),ze.push(D[0],D[1],0|D[2],this.totalDistance-Yr,this.thickness,0|D[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(ze,Xe,D,this.normal,this.thickness,this.totalDistance-Yr);if(de.push(M+0,M+1,M+2),te){var Zn=ou([te[0],te[1]]);S0(Er,Zn)&&Y(Zn,Er,yv(Zn,jv(Zn,Er,Nr))),Xd(pf,Zn,Er);var bn=Qt(C0(Wd,Ku(),Uu,pf,this.thickness),2),ii=bn[0],Ei=bn[1],go=Gv(Wd,this.normal)<0?-1:1,uo=nr;!uo&&this.join==="miter"&&ii>this.miterLimit&&(uo=!0),uo?(Xe.push(this.normal[0],this.normal[1],0),Xe.push(Ei[0],Ei[1],0),ze.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*go,0|N[2]),this.complex.indexes.push(this.currentIndex),ze.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*go,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,de.push.apply(de,It(this.lastFlip!==-go?[M,M+2,M+3]:[M+2,M+1,M+3])),de.push(M+2,M+3,M+4),Up(Hv,pf),Vv(this.normal,Hv),Xe.push(this.normal[0],this.normal[1],0),ze.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*go,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,pe+=3):(this.extrusions(ze,Xe,N,Ei,ii,this.totalDistance),de.push.apply(de,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),go=-1,Vv(this.normal,Ei),pe+=2),this.lastFlip=go}else{if(Up(this.normal,Uu),He){var Xa=Ku(),ro=Ku();E0(ro,Uu,this.normal),Y(Xa,Uu,this.normal),Xe.push(ro[0],ro[1],0),Xe.push(Xa[0],Xa[1],0),ze.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),ze.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(ze,Xe,N,this.normal,this.thickness,this.totalDistance);de.push.apply(de,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),pe+=2}return pe}},{key:"extrusions",value:function(w,M,D,N,te,pe){M.push(N[0],N[1],0),M.push(N[0],N[1],0),w.push(D[0],D[1],0|D[2],pe,-te,0|D[2]),this.complex.indexes.push(this.currentIndex),w.push(D[0],D[1],0|D[2],pe,te,0|D[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(w,M){var D=M[0]-w[0],N=M[1]-w[1];return Math.sqrt(D*D+N*N)}}]),_}();function Ug(_){var w=_.coordinates,M=_.originCoordinates,D=_.version,N=new zg({dash:!0,join:"bevel"});if(D==="GAODE2.x"){var te=w;Array.isArray(te[0][0])||(te=[w]);var pe=M;Array.isArray(pe[0][0])||(pe=[M]);for(var de=0;de<te.length;de++){var ze=te[de],Xe=pe[de];N.extrude_gaode2(ze,Xe)}}else{var He=w;He[0]&&!Array.isArray(He[0][0])&&(He=[w]),He.forEach(function(Er){N.extrude(Er)})}var nr=N.complex;return{vertices:nr.positions,indices:nr.indices,normals:nr.normals,indexes:nr.indexes,size:6}}function jm(_){var w=function(M){if(Hd(M[0]))return M;if(Hd(M[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Hd(M[0][0][0])){var D=0,N=0,te=0;return M.forEach(function(pe){pe.forEach(function(de){D+=de[0],N+=de[1],te++})}),[D/te,N/te,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(_.coordinates);return{vertices:[].concat(It(w),It(w),It(w),It(w)),indices:[0,1,2,2,3,0],size:w.length}}function Gm(_){var w=_.coordinates,M=hp.flatten(w),D=M.vertices,N=M.dimensions,te=M.holes;return{indices:hp(D,te,N),vertices:D,size:N}}var Hm=function(){var _=Me(Fe().mark(function w(M){var D,N,te,pe,de,ze,Xe,He,nr;return Fe().wrap(function(Er){for(;;)switch(Er.prev=Er.next){case 0:return D=M.descriptors,N=M.features,te=M.enablePicking,pe=M.iconMap,de={a_Color:Zd,a_Position:dv,filter:Vd,a_vertexId:vv,a_PickingColor:function(Nr,Yr){var Ln=Nr.id;return te?vd(Ln):[0,0,0]},a_DistanceAndIndex:function(Nr,Yr,Ln,Sn,Zn,bn){return bn===void 0?[Ln[3],10]:[Ln[3],bn]},a_Total_Distance:function(Nr,Yr,Ln,Sn){return[Ln[5]]},a_Size:function(Nr,Yr,Ln,Sn){var Zn=Nr.size,bn=Zn===void 0?1:Zn;return Array.isArray(bn)?[bn[0],bn[1]]:[bn,0]},a_Normal:function(Nr,Yr,Ln,Sn,Zn){return Zn},a_Miter:function(Nr,Yr,Ln,Sn){return[Ln[4]]},a_iconMapUV:function(Nr,Yr,Ln,Sn){var Zn=Nr.texture,bn=pe[Zn]||{x:0,y:0};return[bn.x,bn.y]}},ze={sizePerElement:0,elements:[]},Xe=0,He=[],nr=3,N.forEach(function(Nr,Yr){var Ln=Ug(Nr),Sn=Ln.indices,Zn=Ln.vertices,bn=Ln.normals,ii=Ln.size,Ei=Ln.indexes;Sn.forEach(function(ro){He.push(ro+Xe)}),nr=ii;var go=Zn.length/ii;ze.sizePerElement=nr,ze.elements.push({featureIdx:Yr,vertices:Zn,normals:bn,offset:Xe}),Xe+=go;for(var uo=function(ro){var no=(bn==null?void 0:bn.slice(3*ro,3*ro+3))||[],Kr=Zn.slice(ro*ii,ro*ii+ii),fn=0;Ei&&Ei[ro]!==void 0&&(fn=Ei[ro]),D.forEach(function(Fi,Wa){var ba;Fi&&de[Fi.name]&&(ba=Fi.buffer.data).push.apply(ba,It(de[Fi.name](Nr,Yr,Kr,ro,no,fn)))})},Xa=0;Xa<go;Xa++)uo(Xa)}),Er.abrupt("return",{descriptors:D,featureLayout:ze,indices:He});case 8:case"end":return Er.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),nm={pointFill:function(){var _=Me(Fe().mark(function w(M){var D,N,te,pe,de,ze,Xe,He,nr;return Fe().wrap(function(Er){for(;;)switch(Er.prev=Er.next){case 0:return D=M.descriptors,N=M.features,te=M.enablePicking,pe=M.shape2d,de={a_Color:Zd,a_Position:dv,filter:Vd,a_vertexId:vv,a_PickingColor:function(Nr,Yr){var Ln=Nr.id;return te?vd(Ln):[0,0,0]},a_Shape:function(Nr,Yr,Ln,Sn){var Zn=Nr.shape,bn=Zn===void 0?2:Zn;return[pe.indexOf(bn)]},a_Extrude:function(Nr,Yr,Ln,Sn){var Zn=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],bn=Sn%4*3;return[Zn[bn],Zn[bn+1],Zn[bn+2]]},a_Size:function(Nr,Yr,Ln,Sn){var Zn=Nr.size,bn=Zn===void 0?5:Zn;return Array.isArray(bn)?[bn[0]]:[bn]}},ze={sizePerElement:0,elements:[]},Xe=0,He=[],nr=3,N.forEach(function(Nr,Yr){var Ln=jm(Nr),Sn=Ln.indices,Zn=Ln.vertices,bn=Ln.normals,ii=Ln.size;Sn.forEach(function(Xa){He.push(Xa+Xe)}),nr=ii;var Ei=Zn.length/ii;ze.sizePerElement=nr,ze.elements.push({featureIdx:Yr,vertices:Zn,normals:bn,offset:Xe}),Xe+=Ei;for(var go=function(Xa){var ro=[],no=Zn.slice(Xa*ii,Xa*ii+ii);D.forEach(function(Kr,fn){var Fi;Kr&&de[Kr.name]&&(Fi=Kr.buffer.data).push.apply(Fi,It(de[Kr.name](Nr,Yr,no,Xa,ro,0)))})},uo=0;uo<Ei;uo++)go(uo)}),Er.abrupt("return",{descriptors:D,featureLayout:ze,indices:He});case 8:case"end":return Er.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),line:Hm,polygonFill:function(){var _=Me(Fe().mark(function w(M){var D,N,te,pe,de,ze,Xe,He;return Fe().wrap(function(nr){for(;;)switch(nr.prev=nr.next){case 0:return D=M.descriptors,N=M.features,te=M.enablePicking,pe={a_Color:Zd,a_Position:dv,filter:Vd,a_vertexId:vv,a_PickingColor:function(Er,Nr){var Yr=Er.id;return te?vd(Yr):[0,0,0]}},de={sizePerElement:0,elements:[]},ze=0,Xe=[],He=3,N.forEach(function(Er,Nr){var Yr=Gm(Er),Ln=Yr.indices,Sn=Yr.vertices,Zn=Yr.normals,bn=Yr.size;Ln.forEach(function(uo){Xe.push(uo+ze)}),He=bn;var ii=Sn.length/bn;de.sizePerElement=He,de.elements.push({featureIdx:Nr,vertices:Sn,normals:Zn,offset:ze}),ze+=ii;for(var Ei=function(uo){var Xa=[],ro=Sn.slice(uo*bn,uo*bn+bn);D.forEach(function(no,Kr){var fn;no&&pe[no.name]&&(fn=no.buffer.data).push.apply(fn,It(pe[no.name](Er,Nr,ro,uo,Xa,0)))})},go=0;go<ii;go++)Ei(go)}),nr.abrupt("return",{descriptors:D,featureLayout:de,indices:Xe});case 8:case"end":return nr.stop()}},w)}));return function(w){return _.apply(this,arguments)}}()},im=function(_){for(var w=1;w<arguments.length;w++){var M=arguments[w]!=null?arguments[w]:{};w%2?y(Object(M),!0).forEach(function(D){Be(_,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(M)):y(Object(M)).forEach(function(D){Object.defineProperty(_,D,Object.getOwnPropertyDescriptor(M,D))})}return _}({},nm);function _v(_){return am.apply(this,arguments)}function am(){return(am=Me(Fe().mark(function _(w){var M,D;return Fe().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(M=w.workerType,D=w.data,!im[M]){N.next=3;break}return N.abrupt("return",im[M](D));case 3:return N.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(M,'" non-existent.'))));case 4:case"end":return N.stop()}},_)}))).apply(this,arguments)}return oe(_v),ge.WorkerSourceMap=nm,ge.createWorker=oe,ge.worker=_v,ge}({})},66213:function(wn,Ee,ue){"use strict";ue.d(Ee,{Z:function(){return y}});var Re=ue(77608);function ge(Fe,K){for(;!Object.prototype.hasOwnProperty.call(Fe,K)&&(Fe=(0,Re.Z)(Fe),Fe!==null););return Fe}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(K,Me,ve){var at=ge(K,Me);if(!!at){var se=Object.getOwnPropertyDescriptor(at,Me);return se.get?se.get.call(arguments.length<3?K:ve):se.value}},y.apply(this,arguments)}},59591:function(wn,Ee,ue){var Re=ue(50008).default;function ge(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */wn.exports=ge=function(){return y},wn.exports.__esModule=!0,wn.exports.default=wn.exports;var y={},Fe=Object.prototype,K=Fe.hasOwnProperty,Me=typeof Symbol=="function"?Symbol:{},ve=Me.iterator||"@@iterator",at=Me.asyncIterator||"@@asyncIterator",se=Me.toStringTag||"@@toStringTag";function Be(re,Se,V){return Object.defineProperty(re,Se,{value:V,enumerable:!0,configurable:!0,writable:!0}),re[Se]}try{Be({},"")}catch(re){Be=function(V,Q,Le){return V[Q]=Le}}function dt(re,Se,V,Q){var Le=Se&&Se.prototype instanceof Vt?Se:Vt,ht=Object.create(Le.prototype),wt=new je(Q||[]);return ht._invoke=function(er,Tt,vr){var ln="suspendedStart";return function(sn,Mi){if(ln==="executing")throw new Error("Generator is already running");if(ln==="completed"){if(sn==="throw")throw Mi;return tn()}for(vr.method=sn,vr.arg=Mi;;){var vi=vr.delegate;if(vi){var en=Dt(vi,vr);if(en){if(en===Et)continue;return en}}if(vr.method==="next")vr.sent=vr._sent=vr.arg;else if(vr.method==="throw"){if(ln==="suspendedStart")throw ln="completed",vr.arg;vr.dispatchException(vr.arg)}else vr.method==="return"&&vr.abrupt("return",vr.arg);ln="executing";var Oa=rt(er,Tt,vr);if(Oa.type==="normal"){if(ln=vr.done?"completed":"suspendedYield",Oa.arg===Et)continue;return{value:Oa.arg,done:vr.done}}Oa.type==="throw"&&(ln="completed",vr.method="throw",vr.arg=Oa.arg)}}}(re,V,wt),ht}function rt(re,Se,V){try{return{type:"normal",arg:re.call(Se,V)}}catch(Q){return{type:"throw",arg:Q}}}y.wrap=dt;var Et={};function Vt(){}function Ut(){}function lr(){}var Qt={};Be(Qt,ve,function(){return this});var It=Object.getPrototypeOf,Lt=It&&It(It(Sr([])));Lt&&Lt!==Fe&&K.call(Lt,ve)&&(Qt=Lt);var fr=lr.prototype=Vt.prototype=Object.create(Qt);function ie(re){["next","throw","return"].forEach(function(Se){Be(re,Se,function(V){return this._invoke(Se,V)})})}function yr(re,Se){function V(Le,ht,wt,er){var Tt=rt(re[Le],re,ht);if(Tt.type!=="throw"){var vr=Tt.arg,ln=vr.value;return ln&&Re(ln)=="object"&&K.call(ln,"__await")?Se.resolve(ln.__await).then(function(sn){V("next",sn,wt,er)},function(sn){V("throw",sn,wt,er)}):Se.resolve(ln).then(function(sn){vr.value=sn,wt(vr)},function(sn){return V("throw",sn,wt,er)})}er(Tt.arg)}var Q;this._invoke=function(Le,ht){function wt(){return new Se(function(er,Tt){V(Le,ht,er,Tt)})}return Q=Q?Q.then(wt,wt):wt()}}function Dt(re,Se){var V=re.iterator[Se.method];if(V===void 0){if(Se.delegate=null,Se.method==="throw"){if(re.iterator.return&&(Se.method="return",Se.arg=void 0,Dt(re,Se),Se.method==="throw"))return Et;Se.method="throw",Se.arg=new TypeError("The iterator does not provide a 'throw' method")}return Et}var Q=rt(V,re.iterator,Se.arg);if(Q.type==="throw")return Se.method="throw",Se.arg=Q.arg,Se.delegate=null,Et;var Le=Q.arg;return Le?Le.done?(Se[re.resultName]=Le.value,Se.next=re.nextLoc,Se.method!=="return"&&(Se.method="next",Se.arg=void 0),Se.delegate=null,Et):Le:(Se.method="throw",Se.arg=new TypeError("iterator result is not an object"),Se.delegate=null,Et)}function xt(re){var Se={tryLoc:re[0]};1 in re&&(Se.catchLoc=re[1]),2 in re&&(Se.finallyLoc=re[2],Se.afterLoc=re[3]),this.tryEntries.push(Se)}function Jt(re){var Se=re.completion||{};Se.type="normal",delete Se.arg,re.completion=Se}function je(re){this.tryEntries=[{tryLoc:"root"}],re.forEach(xt,this),this.reset(!0)}function Sr(re){if(re){var Se=re[ve];if(Se)return Se.call(re);if(typeof re.next=="function")return re;if(!isNaN(re.length)){var V=-1,Q=function Le(){for(;++V<re.length;)if(K.call(re,V))return Le.value=re[V],Le.done=!1,Le;return Le.value=void 0,Le.done=!0,Le};return Q.next=Q}}return{next:tn}}function tn(){return{value:void 0,done:!0}}return Ut.prototype=lr,Be(fr,"constructor",lr),Be(lr,"constructor",Ut),Ut.displayName=Be(lr,se,"GeneratorFunction"),y.isGeneratorFunction=function(re){var Se=typeof re=="function"&&re.constructor;return!!Se&&(Se===Ut||(Se.displayName||Se.name)==="GeneratorFunction")},y.mark=function(re){return Object.setPrototypeOf?Object.setPrototypeOf(re,lr):(re.__proto__=lr,Be(re,se,"GeneratorFunction")),re.prototype=Object.create(fr),re},y.awrap=function(re){return{__await:re}},ie(yr.prototype),Be(yr.prototype,at,function(){return this}),y.AsyncIterator=yr,y.async=function(re,Se,V,Q,Le){Le===void 0&&(Le=Promise);var ht=new yr(dt(re,Se,V,Q),Le);return y.isGeneratorFunction(Se)?ht:ht.next().then(function(wt){return wt.done?wt.value:ht.next()})},ie(fr),Be(fr,se,"Generator"),Be(fr,ve,function(){return this}),Be(fr,"toString",function(){return"[object Generator]"}),y.keys=function(re){var Se=[];for(var V in re)Se.push(V);return Se.reverse(),function Q(){for(;Se.length;){var Le=Se.pop();if(Le in re)return Q.value=Le,Q.done=!1,Q}return Q.done=!0,Q}},y.values=Sr,je.prototype={constructor:je,reset:function(Se){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Jt),!Se)for(var V in this)V.charAt(0)==="t"&&K.call(this,V)&&!isNaN(+V.slice(1))&&(this[V]=void 0)},stop:function(){this.done=!0;var Se=this.tryEntries[0].completion;if(Se.type==="throw")throw Se.arg;return this.rval},dispatchException:function(Se){if(this.done)throw Se;var V=this;function Q(vr,ln){return wt.type="throw",wt.arg=Se,V.next=vr,ln&&(V.method="next",V.arg=void 0),!!ln}for(var Le=this.tryEntries.length-1;Le>=0;--Le){var ht=this.tryEntries[Le],wt=ht.completion;if(ht.tryLoc==="root")return Q("end");if(ht.tryLoc<=this.prev){var er=K.call(ht,"catchLoc"),Tt=K.call(ht,"finallyLoc");if(er&&Tt){if(this.prev<ht.catchLoc)return Q(ht.catchLoc,!0);if(this.prev<ht.finallyLoc)return Q(ht.finallyLoc)}else if(er){if(this.prev<ht.catchLoc)return Q(ht.catchLoc,!0)}else{if(!Tt)throw new Error("try statement without catch or finally");if(this.prev<ht.finallyLoc)return Q(ht.finallyLoc)}}}},abrupt:function(Se,V){for(var Q=this.tryEntries.length-1;Q>=0;--Q){var Le=this.tryEntries[Q];if(Le.tryLoc<=this.prev&&K.call(Le,"finallyLoc")&&this.prev<Le.finallyLoc){var ht=Le;break}}ht&&(Se==="break"||Se==="continue")&&ht.tryLoc<=V&&V<=ht.finallyLoc&&(ht=null);var wt=ht?ht.completion:{};return wt.type=Se,wt.arg=V,ht?(this.method="next",this.next=ht.finallyLoc,Et):this.complete(wt)},complete:function(Se,V){if(Se.type==="throw")throw Se.arg;return Se.type==="break"||Se.type==="continue"?this.next=Se.arg:Se.type==="return"?(this.rval=this.arg=Se.arg,this.method="return",this.next="end"):Se.type==="normal"&&V&&(this.next=V),Et},finish:function(Se){for(var V=this.tryEntries.length-1;V>=0;--V){var Q=this.tryEntries[V];if(Q.finallyLoc===Se)return this.complete(Q.completion,Q.afterLoc),Jt(Q),Et}},catch:function(Se){for(var V=this.tryEntries.length-1;V>=0;--V){var Q=this.tryEntries[V];if(Q.tryLoc===Se){var Le=Q.completion;if(Le.type==="throw"){var ht=Le.arg;Jt(Q)}return ht}}throw new Error("illegal catch attempt")},delegateYield:function(Se,V,Q){return this.delegate={iterator:Sr(Se),resultName:V,nextLoc:Q},this.method==="next"&&(this.arg=void 0),Et}},y}wn.exports=ge,wn.exports.__esModule=!0,wn.exports.default=wn.exports},87757:function(wn,Ee,ue){var Re=ue(59591)();wn.exports=Re;try{regeneratorRuntime=Re}catch(ge){typeof globalThis=="object"?globalThis.regeneratorRuntime=Re:Function("r","regeneratorRuntime = r")(Re)}},38163:function(wn){wn.exports=Ee;function Ee(ge,y){var Fe=ge&&ge.type,K;if(Fe==="FeatureCollection")for(K=0;K<ge.features.length;K++)Ee(ge.features[K],y);else if(Fe==="GeometryCollection")for(K=0;K<ge.geometries.length;K++)Ee(ge.geometries[K],y);else if(Fe==="Feature")Ee(ge.geometry,y);else if(Fe==="Polygon")ue(ge.coordinates,y);else if(Fe==="MultiPolygon")for(K=0;K<ge.coordinates.length;K++)ue(ge.coordinates[K],y);return ge}function ue(ge,y){if(ge.length!==0){Re(ge[0],y);for(var Fe=1;Fe<ge.length;Fe++)Re(ge[Fe],!y)}}function Re(ge,y){for(var Fe=0,K=0,Me=0,ve=ge.length,at=ve-1;Me<ve;at=Me++){var se=(ge[Me][0]-ge[at][0])*(ge[at][1]+ge[Me][1]),Be=Fe+se;K+=Math.abs(Fe)>=Math.abs(se)?Fe-Be+se:se-Be+Fe,Fe=Be}Fe+K>=0!=!!y&&ge.reverse()}},75550:function(wn){"use strict";wn.exports=Ee;function Ee(ue,Re){this.x=ue,this.y=Re}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(ue){return this.clone()._add(ue)},sub:function(ue){return this.clone()._sub(ue)},multByPoint:function(ue){return this.clone()._multByPoint(ue)},divByPoint:function(ue){return this.clone()._divByPoint(ue)},mult:function(ue){return this.clone()._mult(ue)},div:function(ue){return this.clone()._div(ue)},rotate:function(ue){return this.clone()._rotate(ue)},rotateAround:function(ue,Re){return this.clone()._rotateAround(ue,Re)},matMult:function(ue){return this.clone()._matMult(ue)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(ue){return this.x===ue.x&&this.y===ue.y},dist:function(ue){return Math.sqrt(this.distSqr(ue))},distSqr:function(ue){var Re=ue.x-this.x,ge=ue.y-this.y;return Re*Re+ge*ge},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(ue){return Math.atan2(this.y-ue.y,this.x-ue.x)},angleWith:function(ue){return this.angleWithSep(ue.x,ue.y)},angleWithSep:function(ue,Re){return Math.atan2(this.x*Re-this.y*ue,this.x*ue+this.y*Re)},_matMult:function(ue){var Re=ue[0]*this.x+ue[1]*this.y,ge=ue[2]*this.x+ue[3]*this.y;return this.x=Re,this.y=ge,this},_add:function(ue){return this.x+=ue.x,this.y+=ue.y,this},_sub:function(ue){return this.x-=ue.x,this.y-=ue.y,this},_mult:function(ue){return this.x*=ue,this.y*=ue,this},_div:function(ue){return this.x/=ue,this.y/=ue,this},_multByPoint:function(ue){return this.x*=ue.x,this.y*=ue.y,this},_divByPoint:function(ue){return this.x/=ue.x,this.y/=ue.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var ue=this.y;return this.y=this.x,this.x=-ue,this},_rotate:function(ue){var Re=Math.cos(ue),ge=Math.sin(ue),y=Re*this.x-ge*this.y,Fe=ge*this.x+Re*this.y;return this.x=y,this.y=Fe,this},_rotateAround:function(ue,Re){var ge=Math.cos(ue),y=Math.sin(ue),Fe=Re.x+ge*(this.x-Re.x)-y*(this.y-Re.y),K=Re.y+y*(this.x-Re.x)+ge*(this.y-Re.y);return this.x=Fe,this.y=K,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(ue){return ue instanceof Ee?ue:Array.isArray(ue)?new Ee(ue[0],ue[1]):ue}},38929:function(wn,Ee,ue){wn.exports.VectorTile=ue(22779),ue(66024),ue(59701)},22779:function(wn,Ee,ue){"use strict";var Re=ue(59701);wn.exports=ge;function ge(Fe,K){this.layers=Fe.readFields(y,{},K)}function y(Fe,K,Me){if(Fe===3){var ve=new Re(Me,Me.readVarint()+Me.pos);ve.length&&(K[ve.name]=ve)}}},66024:function(wn,Ee,ue){"use strict";var Re=ue(75550);wn.exports=ge;function ge(ve,at,se,Be,dt){this.properties={},this.extent=se,this.type=0,this._pbf=ve,this._geometry=-1,this._keys=Be,this._values=dt,ve.readFields(y,this,at)}function y(ve,at,se){ve==1?at.id=se.readVarint():ve==2?Fe(se,at):ve==3?at.type=se.readVarint():ve==4&&(at._geometry=se.pos)}function Fe(ve,at){for(var se=ve.readVarint()+ve.pos;ve.pos<se;){var Be=at._keys[ve.readVarint()],dt=at._values[ve.readVarint()];at.properties[Be]=dt}}ge.types=["Unknown","Point","LineString","Polygon"],ge.prototype.loadGeometry=function(){var ve=this._pbf;ve.pos=this._geometry;for(var at=ve.readVarint()+ve.pos,se=1,Be=0,dt=0,rt=0,Et=[],Vt;ve.pos<at;){if(Be<=0){var Ut=ve.readVarint();se=Ut&7,Be=Ut>>3}if(Be--,se===1||se===2)dt+=ve.readSVarint(),rt+=ve.readSVarint(),se===1&&(Vt&&Et.push(Vt),Vt=[]),Vt.push(new Re(dt,rt));else if(se===7)Vt&&Vt.push(Vt[0].clone());else throw new Error("unknown command "+se)}return Vt&&Et.push(Vt),Et},ge.prototype.bbox=function(){var ve=this._pbf;ve.pos=this._geometry;for(var at=ve.readVarint()+ve.pos,se=1,Be=0,dt=0,rt=0,Et=Infinity,Vt=-Infinity,Ut=Infinity,lr=-Infinity;ve.pos<at;){if(Be<=0){var Qt=ve.readVarint();se=Qt&7,Be=Qt>>3}if(Be--,se===1||se===2)dt+=ve.readSVarint(),rt+=ve.readSVarint(),dt<Et&&(Et=dt),dt>Vt&&(Vt=dt),rt<Ut&&(Ut=rt),rt>lr&&(lr=rt);else if(se!==7)throw new Error("unknown command "+se)}return[Et,Ut,Vt,lr]},ge.prototype.toGeoJSON=function(ve,at,se){var Be=this.extent*Math.pow(2,se),dt=this.extent*ve,rt=this.extent*at,Et=this.loadGeometry(),Vt=ge.types[this.type],Ut,lr;function Qt(fr){for(var ie=0;ie<fr.length;ie++){var yr=fr[ie],Dt=180-(yr.y+rt)*360/Be;fr[ie]=[(yr.x+dt)*360/Be-180,360/Math.PI*Math.atan(Math.exp(Dt*Math.PI/180))-90]}}switch(this.type){case 1:var It=[];for(Ut=0;Ut<Et.length;Ut++)It[Ut]=Et[Ut][0];Et=It,Qt(Et);break;case 2:for(Ut=0;Ut<Et.length;Ut++)Qt(Et[Ut]);break;case 3:for(Et=K(Et),Ut=0;Ut<Et.length;Ut++)for(lr=0;lr<Et[Ut].length;lr++)Qt(Et[Ut][lr]);break}Et.length===1?Et=Et[0]:Vt="Multi"+Vt;var Lt={type:"Feature",geometry:{type:Vt,coordinates:Et},properties:this.properties};return"id"in this&&(Lt.id=this.id),Lt};function K(ve){var at=ve.length;if(at<=1)return[ve];for(var se=[],Be,dt,rt=0;rt<at;rt++){var Et=Me(ve[rt]);Et!==0&&(dt===void 0&&(dt=Et<0),dt===Et<0?(Be&&se.push(Be),Be=[ve[rt]]):Be.push(ve[rt]))}return Be&&se.push(Be),se}function Me(ve){for(var at=0,se=0,Be=ve.length,dt=Be-1,rt,Et;se<Be;dt=se++)rt=ve[se],Et=ve[dt],at+=(Et.x-rt.x)*(rt.y+Et.y);return at}},59701:function(wn,Ee,ue){"use strict";var Re=ue(66024);wn.exports=ge;function ge(K,Me){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=K,this._keys=[],this._values=[],this._features=[],K.readFields(y,this,Me),this.length=this._features.length}function y(K,Me,ve){K===15?Me.version=ve.readVarint():K===1?Me.name=ve.readString():K===5?Me.extent=ve.readVarint():K===2?Me._features.push(ve.pos):K===3?Me._keys.push(ve.readString()):K===4&&Me._values.push(Fe(ve))}function Fe(K){for(var Me=null,ve=K.readVarint()+K.pos;K.pos<ve;){var at=K.readVarint()>>3;Me=at===1?K.readString():at===2?K.readFloat():at===3?K.readDouble():at===4?K.readVarint64():at===5?K.readVarint():at===6?K.readSVarint():at===7?K.readBoolean():null}return Me}ge.prototype.feature=function(K){if(K<0||K>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[K];var Me=this._pbf.readVarint()+this._pbf.pos;return new Re(this._pbf,Me,this.extent,this._keys,this._values)}},53645:function(){},9187:function(wn){"use strict";wn.exports=Ee,wn.exports.default=Ee;function Ee(V,Q,Le){Le=Le||2;var ht=Q&&Q.length,wt=ht?Q[0]*Le:V.length,er=ue(V,0,wt,Le,!0),Tt=[];if(!er||er.next===er.prev)return Tt;var vr,ln,sn,Mi,vi,en,Oa;if(ht&&(er=ve(V,Q,er,Le)),V.length>80*Le){vr=sn=V[0],ln=Mi=V[1];for(var ra=Le;ra<wt;ra+=Le)vi=V[ra],en=V[ra+1],vi<vr&&(vr=vi),en<ln&&(ln=en),vi>sn&&(sn=vi),en>Mi&&(Mi=en);Oa=Math.max(sn-vr,Mi-ln),Oa=Oa!==0?32767/Oa:0}return ge(er,Tt,Le,vr,ln,Oa,0),Tt}function ue(V,Q,Le,ht,wt){var er,Tt;if(wt===Se(V,Q,Le,ht)>0)for(er=Q;er<Le;er+=ht)Tt=Sr(er,V[er],V[er+1],Tt);else for(er=Le-ht;er>=Q;er-=ht)Tt=Sr(er,V[er],V[er+1],Tt);return Tt&&Lt(Tt,Tt.next)&&(tn(Tt),Tt=Tt.next),Tt}function Re(V,Q){if(!V)return V;Q||(Q=V);var Le=V,ht;do if(ht=!1,!Le.steiner&&(Lt(Le,Le.next)||It(Le.prev,Le,Le.next)===0)){if(tn(Le),Le=Q=Le.prev,Le===Le.next)break;ht=!0}else Le=Le.next;while(ht||Le!==Q);return Q}function ge(V,Q,Le,ht,wt,er,Tt){if(!!V){!Tt&&er&&rt(V,ht,wt,er);for(var vr=V,ln,sn;V.prev!==V.next;){if(ln=V.prev,sn=V.next,er?Fe(V,ht,wt,er):y(V)){Q.push(ln.i/Le|0),Q.push(V.i/Le|0),Q.push(sn.i/Le|0),tn(V),V=sn.next,vr=sn.next;continue}if(V=sn,V===vr){Tt?Tt===1?(V=K(Re(V),Q,Le),ge(V,Q,Le,ht,wt,er,2)):Tt===2&&Me(V,Q,Le,ht,wt,er):ge(Re(V),Q,Le,ht,wt,er,1);break}}}}function y(V){var Q=V.prev,Le=V,ht=V.next;if(It(Q,Le,ht)>=0)return!1;for(var wt=Q.x,er=Le.x,Tt=ht.x,vr=Q.y,ln=Le.y,sn=ht.y,Mi=wt<er?wt<Tt?wt:Tt:er<Tt?er:Tt,vi=vr<ln?vr<sn?vr:sn:ln<sn?ln:sn,en=wt>er?wt>Tt?wt:Tt:er>Tt?er:Tt,Oa=vr>ln?vr>sn?vr:sn:ln>sn?ln:sn,ra=ht.next;ra!==Q;){if(ra.x>=Mi&&ra.x<=en&&ra.y>=vi&&ra.y<=Oa&&lr(wt,vr,er,ln,Tt,sn,ra.x,ra.y)&&It(ra.prev,ra,ra.next)>=0)return!1;ra=ra.next}return!0}function Fe(V,Q,Le,ht){var wt=V.prev,er=V,Tt=V.next;if(It(wt,er,Tt)>=0)return!1;for(var vr=wt.x,ln=er.x,sn=Tt.x,Mi=wt.y,vi=er.y,en=Tt.y,Oa=vr<ln?vr<sn?vr:sn:ln<sn?ln:sn,ra=Mi<vi?Mi<en?Mi:en:vi<en?vi:en,Vi=vr>ln?vr>sn?vr:sn:ln>sn?ln:sn,ya=Mi>vi?Mi>en?Mi:en:vi>en?vi:en,fi=Vt(Oa,ra,Q,Le,ht),$i=Vt(Vi,ya,Q,Le,ht),hi=V.prevZ,yi=V.nextZ;hi&&hi.z>=fi&&yi&&yi.z<=$i;){if(hi.x>=Oa&&hi.x<=Vi&&hi.y>=ra&&hi.y<=ya&&hi!==wt&&hi!==Tt&&lr(vr,Mi,ln,vi,sn,en,hi.x,hi.y)&&It(hi.prev,hi,hi.next)>=0||(hi=hi.prevZ,yi.x>=Oa&&yi.x<=Vi&&yi.y>=ra&&yi.y<=ya&&yi!==wt&&yi!==Tt&&lr(vr,Mi,ln,vi,sn,en,yi.x,yi.y)&&It(yi.prev,yi,yi.next)>=0))return!1;yi=yi.nextZ}for(;hi&&hi.z>=fi;){if(hi.x>=Oa&&hi.x<=Vi&&hi.y>=ra&&hi.y<=ya&&hi!==wt&&hi!==Tt&&lr(vr,Mi,ln,vi,sn,en,hi.x,hi.y)&&It(hi.prev,hi,hi.next)>=0)return!1;hi=hi.prevZ}for(;yi&&yi.z<=$i;){if(yi.x>=Oa&&yi.x<=Vi&&yi.y>=ra&&yi.y<=ya&&yi!==wt&&yi!==Tt&&lr(vr,Mi,ln,vi,sn,en,yi.x,yi.y)&&It(yi.prev,yi,yi.next)>=0)return!1;yi=yi.nextZ}return!0}function K(V,Q,Le){var ht=V;do{var wt=ht.prev,er=ht.next.next;!Lt(wt,er)&&fr(wt,ht,ht.next,er)&&xt(wt,er)&&xt(er,wt)&&(Q.push(wt.i/Le|0),Q.push(ht.i/Le|0),Q.push(er.i/Le|0),tn(ht),tn(ht.next),ht=V=er),ht=ht.next}while(ht!==V);return Re(ht)}function Me(V,Q,Le,ht,wt,er){var Tt=V;do{for(var vr=Tt.next.next;vr!==Tt.prev;){if(Tt.i!==vr.i&&Qt(Tt,vr)){var ln=je(Tt,vr);Tt=Re(Tt,Tt.next),ln=Re(ln,ln.next),ge(Tt,Q,Le,ht,wt,er,0),ge(ln,Q,Le,ht,wt,er,0);return}vr=vr.next}Tt=Tt.next}while(Tt!==V)}function ve(V,Q,Le,ht){var wt=[],er,Tt,vr,ln,sn;for(er=0,Tt=Q.length;er<Tt;er++)vr=Q[er]*ht,ln=er<Tt-1?Q[er+1]*ht:V.length,sn=ue(V,vr,ln,ht,!1),sn===sn.next&&(sn.steiner=!0),wt.push(Ut(sn));for(wt.sort(at),er=0;er<wt.length;er++)Le=se(wt[er],Le);return Le}function at(V,Q){return V.x-Q.x}function se(V,Q){var Le=Be(V,Q);if(!Le)return Q;var ht=je(Le,V);return Re(ht,ht.next),Re(Le,Le.next)}function Be(V,Q){var Le=Q,ht=V.x,wt=V.y,er=-Infinity,Tt;do{if(wt<=Le.y&&wt>=Le.next.y&&Le.next.y!==Le.y){var vr=Le.x+(wt-Le.y)*(Le.next.x-Le.x)/(Le.next.y-Le.y);if(vr<=ht&&vr>er&&(er=vr,Tt=Le.x<Le.next.x?Le:Le.next,vr===ht))return Tt}Le=Le.next}while(Le!==Q);if(!Tt)return null;var ln=Tt,sn=Tt.x,Mi=Tt.y,vi=Infinity,en;Le=Tt;do ht>=Le.x&&Le.x>=sn&&ht!==Le.x&&lr(wt<Mi?ht:er,wt,sn,Mi,wt<Mi?er:ht,wt,Le.x,Le.y)&&(en=Math.abs(wt-Le.y)/(ht-Le.x),xt(Le,V)&&(en<vi||en===vi&&(Le.x>Tt.x||Le.x===Tt.x&&dt(Tt,Le)))&&(Tt=Le,vi=en)),Le=Le.next;while(Le!==ln);return Tt}function dt(V,Q){return It(V.prev,V,Q.prev)<0&&It(Q.next,V,V.next)<0}function rt(V,Q,Le,ht){var wt=V;do wt.z===0&&(wt.z=Vt(wt.x,wt.y,Q,Le,ht)),wt.prevZ=wt.prev,wt.nextZ=wt.next,wt=wt.next;while(wt!==V);wt.prevZ.nextZ=null,wt.prevZ=null,Et(wt)}function Et(V){var Q,Le,ht,wt,er,Tt,vr,ln,sn=1;do{for(Le=V,V=null,er=null,Tt=0;Le;){for(Tt++,ht=Le,vr=0,Q=0;Q<sn&&(vr++,ht=ht.nextZ,!!ht);Q++);for(ln=sn;vr>0||ln>0&&ht;)vr!==0&&(ln===0||!ht||Le.z<=ht.z)?(wt=Le,Le=Le.nextZ,vr--):(wt=ht,ht=ht.nextZ,ln--),er?er.nextZ=wt:V=wt,wt.prevZ=er,er=wt;Le=ht}er.nextZ=null,sn*=2}while(Tt>1);return V}function Vt(V,Q,Le,ht,wt){return V=(V-Le)*wt|0,Q=(Q-ht)*wt|0,V=(V|V<<8)&16711935,V=(V|V<<4)&252645135,V=(V|V<<2)&858993459,V=(V|V<<1)&1431655765,Q=(Q|Q<<8)&16711935,Q=(Q|Q<<4)&252645135,Q=(Q|Q<<2)&858993459,Q=(Q|Q<<1)&1431655765,V|Q<<1}function Ut(V){var Q=V,Le=V;do(Q.x<Le.x||Q.x===Le.x&&Q.y<Le.y)&&(Le=Q),Q=Q.next;while(Q!==V);return Le}function lr(V,Q,Le,ht,wt,er,Tt,vr){return(wt-Tt)*(Q-vr)>=(V-Tt)*(er-vr)&&(V-Tt)*(ht-vr)>=(Le-Tt)*(Q-vr)&&(Le-Tt)*(er-vr)>=(wt-Tt)*(ht-vr)}function Qt(V,Q){return V.next.i!==Q.i&&V.prev.i!==Q.i&&!Dt(V,Q)&&(xt(V,Q)&&xt(Q,V)&&Jt(V,Q)&&(It(V.prev,V,Q.prev)||It(V,Q.prev,Q))||Lt(V,Q)&&It(V.prev,V,V.next)>0&&It(Q.prev,Q,Q.next)>0)}function It(V,Q,Le){return(Q.y-V.y)*(Le.x-Q.x)-(Q.x-V.x)*(Le.y-Q.y)}function Lt(V,Q){return V.x===Q.x&&V.y===Q.y}function fr(V,Q,Le,ht){var wt=yr(It(V,Q,Le)),er=yr(It(V,Q,ht)),Tt=yr(It(Le,ht,V)),vr=yr(It(Le,ht,Q));return!!(wt!==er&&Tt!==vr||wt===0&&ie(V,Le,Q)||er===0&&ie(V,ht,Q)||Tt===0&&ie(Le,V,ht)||vr===0&&ie(Le,Q,ht))}function ie(V,Q,Le){return Q.x<=Math.max(V.x,Le.x)&&Q.x>=Math.min(V.x,Le.x)&&Q.y<=Math.max(V.y,Le.y)&&Q.y>=Math.min(V.y,Le.y)}function yr(V){return V>0?1:V<0?-1:0}function Dt(V,Q){var Le=V;do{if(Le.i!==V.i&&Le.next.i!==V.i&&Le.i!==Q.i&&Le.next.i!==Q.i&&fr(Le,Le.next,V,Q))return!0;Le=Le.next}while(Le!==V);return!1}function xt(V,Q){return It(V.prev,V,V.next)<0?It(V,Q,V.next)>=0&&It(V,V.prev,Q)>=0:It(V,Q,V.prev)<0||It(V,V.next,Q)<0}function Jt(V,Q){var Le=V,ht=!1,wt=(V.x+Q.x)/2,er=(V.y+Q.y)/2;do Le.y>er!=Le.next.y>er&&Le.next.y!==Le.y&&wt<(Le.next.x-Le.x)*(er-Le.y)/(Le.next.y-Le.y)+Le.x&&(ht=!ht),Le=Le.next;while(Le!==V);return ht}function je(V,Q){var Le=new re(V.i,V.x,V.y),ht=new re(Q.i,Q.x,Q.y),wt=V.next,er=Q.prev;return V.next=Q,Q.prev=V,Le.next=wt,wt.prev=Le,ht.next=Le,Le.prev=ht,er.next=ht,ht.prev=er,ht}function Sr(V,Q,Le,ht){var wt=new re(V,Q,Le);return ht?(wt.next=ht.next,wt.prev=ht,ht.next.prev=wt,ht.next=wt):(wt.prev=wt,wt.next=wt),wt}function tn(V){V.next.prev=V.prev,V.prev.next=V.next,V.prevZ&&(V.prevZ.nextZ=V.nextZ),V.nextZ&&(V.nextZ.prevZ=V.prevZ)}function re(V,Q,Le){this.i=V,this.x=Q,this.y=Le,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ee.deviation=function(V,Q,Le,ht){var wt=Q&&Q.length,er=wt?Q[0]*Le:V.length,Tt=Math.abs(Se(V,0,er,Le));if(wt)for(var vr=0,ln=Q.length;vr<ln;vr++){var sn=Q[vr]*Le,Mi=vr<ln-1?Q[vr+1]*Le:V.length;Tt-=Math.abs(Se(V,sn,Mi,Le))}var vi=0;for(vr=0;vr<ht.length;vr+=3){var en=ht[vr]*Le,Oa=ht[vr+1]*Le,ra=ht[vr+2]*Le;vi+=Math.abs((V[en]-V[ra])*(V[Oa+1]-V[en+1])-(V[en]-V[Oa])*(V[ra+1]-V[en+1]))}return Tt===0&&vi===0?0:Math.abs((vi-Tt)/Tt)};function Se(V,Q,Le,ht){for(var wt=0,er=Q,Tt=Le-ht;er<Le;er+=ht)wt+=(V[Tt]-V[er])*(V[er+1]+V[Tt+1]),Tt=er;return wt}Ee.flatten=function(V){for(var Q=V[0][0].length,Le={vertices:[],holes:[],dimensions:Q},ht=0,wt=0;wt<V.length;wt++){for(var er=0;er<V[wt].length;er++)for(var Tt=0;Tt<Q;Tt++)Le.vertices.push(V[wt][er][Tt]);wt>0&&(ht+=V[wt-1].length,Le.holes.push(ht))}return Le}},67709:function(wn){function Ee(Re){var ge=Re.target||Re.srcElement;ge.__resizeRAF__&&cancelAnimationFrame(ge.__resizeRAF__),ge.__resizeRAF__=requestAnimationFrame(function(){var y=ge.__resizeTrigger__,Fe=y&&y.__resizeListeners__;Fe&&Fe.forEach(function(K){K.call(y,Re)})})}var ue=function(ge,y){var Fe=this,K=Fe.document,Me,ve=K.attachEvent;typeof navigator!="undefined"&&(Me=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function at(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Ee)}if(!ge.__resizeListeners__)if(ge.__resizeListeners__=[],ve)ge.__resizeTrigger__=ge,ge.attachEvent("onresize",Ee);else{getComputedStyle(ge).position==="static"&&(ge.style.position="relative");var se=ge.__resizeTrigger__=K.createElement("object");se.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),se.setAttribute("class","resize-sensor"),se.setAttribute("tabindex","-1"),se.setAttribute("title",""),se.__resizeElement__=ge,se.onload=at,se.type="text/html",Me&&ge.appendChild(se),se.data="about:blank",Me||ge.appendChild(se)}ge.__resizeListeners__.push(y)};wn.exports=typeof window=="undefined"?ue:ue.bind(window),wn.exports.unbind=function(Re,ge){var y=document.attachEvent,Fe=Re.__resizeListeners__||[];if(ge){var K=Fe.indexOf(ge);K!==-1&&Fe.splice(K,1)}else Fe=Re.__resizeListeners__=[];if(!Fe.length){if(y)Re.detachEvent("onresize",Ee);else if(Re.__resizeTrigger__){var Me=Re.__resizeTrigger__.contentDocument,ve=Me&&Me.defaultView;ve&&(ve.removeEventListener("resize",Ee),delete ve.__resizeTrigger__),Re.__resizeTrigger__=!Re.removeChild(Re.__resizeTrigger__)}delete Re.__resizeListeners__}}},26729:function(wn){"use strict";var Ee=Object.prototype.hasOwnProperty,ue="~";function Re(){}Object.create&&(Re.prototype=Object.create(null),new Re().__proto__||(ue=!1));function ge(Me,ve,at){this.fn=Me,this.context=ve,this.once=at||!1}function y(Me,ve,at,se,Be){if(typeof at!="function")throw new TypeError("The listener must be a function");var dt=new ge(at,se||Me,Be),rt=ue?ue+ve:ve;return Me._events[rt]?Me._events[rt].fn?Me._events[rt]=[Me._events[rt],dt]:Me._events[rt].push(dt):(Me._events[rt]=dt,Me._eventsCount++),Me}function Fe(Me,ve){--Me._eventsCount==0?Me._events=new Re:delete Me._events[ve]}function K(){this._events=new Re,this._eventsCount=0}K.prototype.eventNames=function(){var ve=[],at,se;if(this._eventsCount===0)return ve;for(se in at=this._events)Ee.call(at,se)&&ve.push(ue?se.slice(1):se);return Object.getOwnPropertySymbols?ve.concat(Object.getOwnPropertySymbols(at)):ve},K.prototype.listeners=function(ve){var at=ue?ue+ve:ve,se=this._events[at];if(!se)return[];if(se.fn)return[se.fn];for(var Be=0,dt=se.length,rt=new Array(dt);Be<dt;Be++)rt[Be]=se[Be].fn;return rt},K.prototype.listenerCount=function(ve){var at=ue?ue+ve:ve,se=this._events[at];return se?se.fn?1:se.length:0},K.prototype.emit=function(ve,at,se,Be,dt,rt){var Et=ue?ue+ve:ve;if(!this._events[Et])return!1;var Vt=this._events[Et],Ut=arguments.length,lr,Qt;if(Vt.fn){switch(Vt.once&&this.removeListener(ve,Vt.fn,void 0,!0),Ut){case 1:return Vt.fn.call(Vt.context),!0;case 2:return Vt.fn.call(Vt.context,at),!0;case 3:return Vt.fn.call(Vt.context,at,se),!0;case 4:return Vt.fn.call(Vt.context,at,se,Be),!0;case 5:return Vt.fn.call(Vt.context,at,se,Be,dt),!0;case 6:return Vt.fn.call(Vt.context,at,se,Be,dt,rt),!0}for(Qt=1,lr=new Array(Ut-1);Qt<Ut;Qt++)lr[Qt-1]=arguments[Qt];Vt.fn.apply(Vt.context,lr)}else{var It=Vt.length,Lt;for(Qt=0;Qt<It;Qt++)switch(Vt[Qt].once&&this.removeListener(ve,Vt[Qt].fn,void 0,!0),Ut){case 1:Vt[Qt].fn.call(Vt[Qt].context);break;case 2:Vt[Qt].fn.call(Vt[Qt].context,at);break;case 3:Vt[Qt].fn.call(Vt[Qt].context,at,se);break;case 4:Vt[Qt].fn.call(Vt[Qt].context,at,se,Be);break;default:if(!lr)for(Lt=1,lr=new Array(Ut-1);Lt<Ut;Lt++)lr[Lt-1]=arguments[Lt];Vt[Qt].fn.apply(Vt[Qt].context,lr)}}return!0},K.prototype.on=function(ve,at,se){return y(this,ve,at,se,!1)},K.prototype.once=function(ve,at,se){return y(this,ve,at,se,!0)},K.prototype.removeListener=function(ve,at,se,Be){var dt=ue?ue+ve:ve;if(!this._events[dt])return this;if(!at)return Fe(this,dt),this;var rt=this._events[dt];if(rt.fn)rt.fn===at&&(!Be||rt.once)&&(!se||rt.context===se)&&Fe(this,dt);else{for(var Et=0,Vt=[],Ut=rt.length;Et<Ut;Et++)(rt[Et].fn!==at||Be&&!rt[Et].once||se&&rt[Et].context!==se)&&Vt.push(rt[Et]);Vt.length?this._events[dt]=Vt.length===1?Vt[0]:Vt:Fe(this,dt)}return this},K.prototype.removeAllListeners=function(ve){var at;return ve?(at=ue?ue+ve:ve,this._events[at]&&Fe(this,at)):(this._events=new Re,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=ue,K.EventEmitter=K,wn.exports=K},80645:function(wn,Ee){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ee.read=function(ue,Re,ge,y,Fe){var K,Me,ve=Fe*8-y-1,at=(1<<ve)-1,se=at>>1,Be=-7,dt=ge?Fe-1:0,rt=ge?-1:1,Et=ue[Re+dt];for(dt+=rt,K=Et&(1<<-Be)-1,Et>>=-Be,Be+=ve;Be>0;K=K*256+ue[Re+dt],dt+=rt,Be-=8);for(Me=K&(1<<-Be)-1,K>>=-Be,Be+=y;Be>0;Me=Me*256+ue[Re+dt],dt+=rt,Be-=8);if(K===0)K=1-se;else{if(K===at)return Me?NaN:(Et?-1:1)*Infinity;Me=Me+Math.pow(2,y),K=K-se}return(Et?-1:1)*Me*Math.pow(2,K-y)},Ee.write=function(ue,Re,ge,y,Fe,K){var Me,ve,at,se=K*8-Fe-1,Be=(1<<se)-1,dt=Be>>1,rt=Fe===23?Math.pow(2,-24)-Math.pow(2,-77):0,Et=y?0:K-1,Vt=y?1:-1,Ut=Re<0||Re===0&&1/Re<0?1:0;for(Re=Math.abs(Re),isNaN(Re)||Re===Infinity?(ve=isNaN(Re)?1:0,Me=Be):(Me=Math.floor(Math.log(Re)/Math.LN2),Re*(at=Math.pow(2,-Me))<1&&(Me--,at*=2),Me+dt>=1?Re+=rt/at:Re+=rt*Math.pow(2,1-dt),Re*at>=2&&(Me++,at/=2),Me+dt>=Be?(ve=0,Me=Be):Me+dt>=1?(ve=(Re*at-1)*Math.pow(2,Fe),Me=Me+dt):(ve=Re*Math.pow(2,dt-1)*Math.pow(2,Fe),Me=0));Fe>=8;ue[ge+Et]=ve&255,Et+=Vt,ve/=256,Fe-=8);for(Me=Me<<Fe|ve,se+=Fe;se>0;ue[ge+Et]=Me&255,Et+=Vt,Me/=256,se-=8);ue[ge+Et-Vt]|=Ut*128}},7375:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});var ue=Symbol.for("INJECTION");function Re(Me,ve,at,se){function Be(){return se&&!Reflect.hasMetadata(ue,this,ve)&&Reflect.defineMetadata(ue,at(),this,ve),Reflect.hasMetadata(ue,this,ve)?Reflect.getMetadata(ue,this,ve):at()}function dt(rt){Reflect.defineMetadata(ue,rt,this,ve)}Object.defineProperty(Me,ve,{configurable:!0,enumerable:!0,get:Be,set:dt})}function ge(Me,ve){return function(at){return function(se,Be){var dt=function(){return Me.get(at)};Re(se,Be,dt,ve)}}}Ee.makePropertyInjectDecorator=ge;function y(Me,ve){return function(at,se){return function(Be,dt){var rt=function(){return Me.getNamed(at,se)};Re(Be,dt,rt,ve)}}}Ee.makePropertyInjectNamedDecorator=y;function Fe(Me,ve){return function(at,se,Be){return function(dt,rt){var Et=function(){return Me.getTagged(at,se,Be)};Re(dt,rt,Et,ve)}}}Ee.makePropertyInjectTaggedDecorator=Fe;function K(Me,ve){return function(at){return function(se,Be){var dt=function(){return Me.getAll(at)};Re(se,Be,dt,ve)}}}Ee.makePropertyMultiInjectDecorator=K},84879:function(wn,Ee,ue){"use strict";var Re;Re={value:!0};var ge=ue(7375);function y(Fe,K){K===void 0&&(K=!0);var Me=ge.makePropertyInjectDecorator(Fe,K),ve=ge.makePropertyInjectNamedDecorator(Fe,K),at=ge.makePropertyInjectTaggedDecorator(Fe,K),se=ge.makePropertyMultiInjectDecorator(Fe,K);return{lazyInject:Me,lazyInjectNamed:ve,lazyInjectTagged:at,lazyMultiInject:se}}Ee.Z=y},99934:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.tagProperty=Ee.tagParameter=Ee.decorate=void 0;var Re=ue(16674),ge=ue(6867);function y(se,Be,dt,rt){var Et=ge.TAGGED;K(Et,se,Be,rt,dt)}Ee.tagParameter=y;function Fe(se,Be,dt){var rt=ge.TAGGED_PROP;K(rt,se.constructor,Be,dt)}Ee.tagProperty=Fe;function K(se,Be,dt,rt,Et){var Vt={},Ut=typeof Et=="number",lr=Et!==void 0&&Ut?Et.toString():dt;if(Ut&&dt!==void 0)throw new Error(Re.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(se,Be)&&(Vt=Reflect.getMetadata(se,Be));var Qt=Vt[lr];if(!Array.isArray(Qt))Qt=[];else for(var It=0,Lt=Qt;It<Lt.length;It++){var fr=Lt[It];if(fr.key===rt.key)throw new Error(Re.DUPLICATED_METADATA+" "+fr.key.toString())}Qt.push(rt),Vt[lr]=Qt,Reflect.defineMetadata(se,Vt,Be)}function Me(se,Be){Reflect.decorate(se,Be)}function ve(se,Be){return function(dt,rt){Be(dt,rt,se)}}function at(se,Be,dt){typeof dt=="number"?Me([ve(dt,se)],Be):typeof dt=="string"?Reflect.decorate([se],Be,dt):Me([se],Be)}Ee.decorate=at},5744:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.inject=Ee.LazyServiceIdentifer=void 0;var Re=ue(16674),ge=ue(6867),y=ue(47738),Fe=ue(99934),K=function(){function ve(at){this._cb=at}return ve.prototype.unwrap=function(){return this._cb()},ve}();Ee.LazyServiceIdentifer=K;function Me(ve){return function(at,se,Be){if(ve===void 0)throw new Error(Re.UNDEFINED_INJECT_ANNOTATION(at.name));var dt=new y.Metadata(ge.INJECT_TAG,ve);typeof Be=="number"?Fe.tagParameter(at,se,Be,dt):Fe.tagProperty(at,se,dt)}}Ee.inject=Me},64315:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.injectable=void 0;var Re=ue(16674),ge=ue(6867);function y(){return function(Fe){if(Reflect.hasOwnMetadata(ge.PARAM_TYPES,Fe))throw new Error(Re.DUPLICATED_INJECTABLE_DECORATOR);var K=Reflect.getMetadata(ge.DESIGN_PARAM_TYPES,Fe)||[];return Reflect.defineMetadata(ge.PARAM_TYPES,K,Fe),Fe}}Ee.injectable=y},71693:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.multiInject=void 0;var Re=ue(6867),ge=ue(47738),y=ue(99934);function Fe(K){return function(Me,ve,at){var se=new ge.Metadata(Re.MULTI_INJECT_TAG,K);typeof at=="number"?y.tagParameter(Me,ve,at,se):y.tagProperty(Me,ve,se)}}Ee.multiInject=Fe},38085:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.named=void 0;var Re=ue(6867),ge=ue(47738),y=ue(99934);function Fe(K){return function(Me,ve,at){var se=new ge.Metadata(Re.NAMED_TAG,K);typeof at=="number"?y.tagParameter(Me,ve,at,se):y.tagProperty(Me,ve,se)}}Ee.named=Fe},6515:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.optional=void 0;var Re=ue(6867),ge=ue(47738),y=ue(99934);function Fe(){return function(K,Me,ve){var at=new ge.Metadata(Re.OPTIONAL_TAG,!0);typeof ve=="number"?y.tagParameter(K,Me,ve,at):y.tagProperty(K,Me,at)}}Ee.optional=Fe},7014:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.postConstruct=void 0;var Re=ue(16674),ge=ue(6867),y=ue(47738);function Fe(){return function(K,Me,ve){var at=new y.Metadata(ge.POST_CONSTRUCT,Me);if(Reflect.hasOwnMetadata(ge.POST_CONSTRUCT,K.constructor))throw new Error(Re.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ge.POST_CONSTRUCT,at,K.constructor)}}Ee.postConstruct=Fe},32052:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.tagged=void 0;var Re=ue(47738),ge=ue(99934);function y(Fe,K){return function(Me,ve,at){var se=new Re.Metadata(Fe,K);typeof at=="number"?ge.tagParameter(Me,ve,at,se):ge.tagProperty(Me,ve,se)}}Ee.tagged=y},55638:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.targetName=void 0;var Re=ue(6867),ge=ue(47738),y=ue(99934);function Fe(K){return function(Me,ve,at){var se=new ge.Metadata(Re.NAME_TAG,K);y.tagParameter(Me,ve,at,se)}}Ee.targetName=Fe},86757:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.unmanaged=void 0;var Re=ue(6867),ge=ue(47738),y=ue(99934);function Fe(){return function(K,Me,ve){var at=new ge.Metadata(Re.UNMANAGED_TAG,!0);y.tagParameter(K,Me,ve,at)}}Ee.unmanaged=Fe},44290:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Binding=void 0;var Re=ue(28421),ge=ue(37791),y=function(){function Fe(K,Me){this.id=ge.id(),this.activated=!1,this.serviceIdentifier=K,this.scope=Me,this.type=Re.BindingTypeEnum.Invalid,this.constraint=function(ve){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Fe.prototype.clone=function(){var K=new Fe(this.serviceIdentifier,this.scope);return K.activated=K.scope===Re.BindingScopeEnum.Singleton?this.activated:!1,K.implementationType=this.implementationType,K.dynamicValue=this.dynamicValue,K.scope=this.scope,K.type=this.type,K.factory=this.factory,K.provider=this.provider,K.constraint=this.constraint,K.onActivation=this.onActivation,K.cache=this.cache,K},Fe}();Ee.Binding=y},23184:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingCount=void 0;var ue={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Ee.BindingCount=ue},16674:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.STACK_OVERFLOW=Ee.CIRCULAR_DEPENDENCY_IN_FACTORY=Ee.POST_CONSTRUCT_ERROR=Ee.MULTIPLE_POST_CONSTRUCT_METHODS=Ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ee.ARGUMENTS_LENGTH_MISMATCH=Ee.INVALID_DECORATOR_OPERATION=Ee.INVALID_TO_SELF_VALUE=Ee.INVALID_FUNCTION_BINDING=Ee.INVALID_MIDDLEWARE_RETURN=Ee.NO_MORE_SNAPSHOTS_AVAILABLE=Ee.INVALID_BINDING_TYPE=Ee.NOT_IMPLEMENTED=Ee.CIRCULAR_DEPENDENCY=Ee.UNDEFINED_INJECT_ANNOTATION=Ee.MISSING_INJECT_ANNOTATION=Ee.MISSING_INJECTABLE_ANNOTATION=Ee.NOT_REGISTERED=Ee.CANNOT_UNBIND=Ee.AMBIGUOUS_MATCH=Ee.KEY_NOT_FOUND=Ee.NULL_ARGUMENT=Ee.DUPLICATED_METADATA=Ee.DUPLICATED_INJECTABLE_DECORATOR=void 0,Ee.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Ee.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Ee.NULL_ARGUMENT="NULL argument",Ee.KEY_NOT_FOUND="Key Not Found",Ee.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Ee.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Ee.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Ee.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Ee.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var ue=function(Fe){return"@inject called with undefined this could mean that the class "+Fe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ee.UNDEFINED_INJECT_ANNOTATION=ue,Ee.CIRCULAR_DEPENDENCY="Circular dependency found:",Ee.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Ee.INVALID_BINDING_TYPE="Invalid binding type:",Ee.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Ee.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Ee.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Ee.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Ee.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Re=function(){for(var Fe=[],K=0;K<arguments.length;K++)Fe[K]=arguments[K];return"The number of constructor arguments in the derived class "+(Fe[0]+" must be >= than the number of constructor arguments of its base class.")};Ee.ARGUMENTS_LENGTH_MISMATCH=Re,Ee.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Ee.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Ee.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Ee.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Ee.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ge=function(){for(var Fe=[],K=0;K<arguments.length;K++)Fe[K]=arguments[K];return"@postConstruct error in class "+Fe[0]+": "+Fe[1]};Ee.POST_CONSTRUCT_ERROR=ge;var y=function(){for(var Fe=[],K=0;K<arguments.length;K++)Fe[K]=arguments[K];return"It looks like there is a circular dependency "+("in one of the '"+Fe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Fe[1]+"'.")};Ee.CIRCULAR_DEPENDENCY_IN_FACTORY=y,Ee.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.TargetTypeEnum=Ee.BindingTypeEnum=Ee.BindingScopeEnum=void 0;var ue={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Ee.BindingScopeEnum=ue;var Re={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Ee.BindingTypeEnum=Re;var ge={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Ee.TargetTypeEnum=ge},6867:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.NON_CUSTOM_TAG_KEYS=Ee.POST_CONSTRUCT=Ee.DESIGN_PARAM_TYPES=Ee.PARAM_TYPES=Ee.TAGGED_PROP=Ee.TAGGED=Ee.MULTI_INJECT_TAG=Ee.INJECT_TAG=Ee.OPTIONAL_TAG=Ee.UNMANAGED_TAG=Ee.NAME_TAG=Ee.NAMED_TAG=void 0,Ee.NAMED_TAG="named",Ee.NAME_TAG="name",Ee.UNMANAGED_TAG="unmanaged",Ee.OPTIONAL_TAG="optional",Ee.INJECT_TAG="inject",Ee.MULTI_INJECT_TAG="multi_inject",Ee.TAGGED="inversify:tagged",Ee.TAGGED_PROP="inversify:tagged_props",Ee.PARAM_TYPES="inversify:paramtypes",Ee.DESIGN_PARAM_TYPES="design:paramtypes",Ee.POST_CONSTRUCT="post_construct";function ue(){return[Ee.INJECT_TAG,Ee.MULTI_INJECT_TAG,Ee.NAME_TAG,Ee.UNMANAGED_TAG,Ee.NAMED_TAG,Ee.OPTIONAL_TAG]}Ee.NON_CUSTOM_TAG_KEYS=ue()},51389:function(wn,Ee,ue){"use strict";var Re=this&&this.__awaiter||function(Qt,It,Lt,fr){function ie(yr){return yr instanceof Lt?yr:new Lt(function(Dt){Dt(yr)})}return new(Lt||(Lt=Promise))(function(yr,Dt){function xt(Sr){try{je(fr.next(Sr))}catch(tn){Dt(tn)}}function Jt(Sr){try{je(fr.throw(Sr))}catch(tn){Dt(tn)}}function je(Sr){Sr.done?yr(Sr.value):ie(Sr.value).then(xt,Jt)}je((fr=fr.apply(Qt,It||[])).next())})},ge=this&&this.__generator||function(Qt,It){var Lt={label:0,sent:function(){if(yr[0]&1)throw yr[1];return yr[1]},trys:[],ops:[]},fr,ie,yr,Dt;return Dt={next:xt(0),throw:xt(1),return:xt(2)},typeof Symbol=="function"&&(Dt[Symbol.iterator]=function(){return this}),Dt;function xt(je){return function(Sr){return Jt([je,Sr])}}function Jt(je){if(fr)throw new TypeError("Generator is already executing.");for(;Lt;)try{if(fr=1,ie&&(yr=je[0]&2?ie.return:je[0]?ie.throw||((yr=ie.return)&&yr.call(ie),0):ie.next)&&!(yr=yr.call(ie,je[1])).done)return yr;switch(ie=0,yr&&(je=[je[0]&2,yr.value]),je[0]){case 0:case 1:yr=je;break;case 4:return Lt.label++,{value:je[1],done:!1};case 5:Lt.label++,ie=je[1],je=[0];continue;case 7:je=Lt.ops.pop(),Lt.trys.pop();continue;default:if(yr=Lt.trys,!(yr=yr.length>0&&yr[yr.length-1])&&(je[0]===6||je[0]===2)){Lt=0;continue}if(je[0]===3&&(!yr||je[1]>yr[0]&&je[1]<yr[3])){Lt.label=je[1];break}if(je[0]===6&&Lt.label<yr[1]){Lt.label=yr[1],yr=je;break}if(yr&&Lt.label<yr[2]){Lt.label=yr[2],Lt.ops.push(je);break}yr[2]&&Lt.ops.pop(),Lt.trys.pop();continue}je=It.call(Qt,Lt)}catch(Sr){je=[6,Sr],ie=0}finally{fr=yr=0}if(je[0]&5)throw je[1];return{value:je[0]?je[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(Qt,It){for(var Lt=0,fr=It.length,ie=Qt.length;Lt<fr;Lt++,ie++)Qt[ie]=It[Lt];return Qt};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Container=void 0;var Fe=ue(44290),K=ue(16674),Me=ue(28421),ve=ue(6867),at=ue(51377),se=ue(86311),Be=ue(31927),dt=ue(15451),rt=ue(37791),Et=ue(55800),Vt=ue(85700),Ut=ue(80175),lr=function(){function Qt(It){this._appliedMiddleware=[];var Lt=It||{};if(typeof Lt!="object")throw new Error(""+K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Lt.defaultScope===void 0)Lt.defaultScope=Me.BindingScopeEnum.Transient;else if(Lt.defaultScope!==Me.BindingScopeEnum.Singleton&&Lt.defaultScope!==Me.BindingScopeEnum.Transient&&Lt.defaultScope!==Me.BindingScopeEnum.Request)throw new Error(""+K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Lt.autoBindInjectable===void 0)Lt.autoBindInjectable=!1;else if(typeof Lt.autoBindInjectable!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Lt.skipBaseClassChecks===void 0)Lt.skipBaseClassChecks=!1;else if(typeof Lt.skipBaseClassChecks!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Lt.autoBindInjectable,defaultScope:Lt.defaultScope,skipBaseClassChecks:Lt.skipBaseClassChecks},this.id=rt.id(),this._bindingDictionary=new Ut.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new at.MetadataReader}return Qt.merge=function(It,Lt){for(var fr=[],ie=2;ie<arguments.length;ie++)fr[ie-2]=arguments[ie];var yr=new Qt,Dt=y([It,Lt],fr).map(function(je){return se.getBindingDictionary(je)}),xt=se.getBindingDictionary(yr);function Jt(je,Sr){je.traverse(function(tn,re){re.forEach(function(Se){Sr.add(Se.serviceIdentifier,Se.clone())})})}return Dt.forEach(function(je){Jt(je,xt)}),yr},Qt.prototype.load=function(){for(var It=[],Lt=0;Lt<arguments.length;Lt++)It[Lt]=arguments[Lt];for(var fr=this._getContainerModuleHelpersFactory(),ie=0,yr=It;ie<yr.length;ie++){var Dt=yr[ie],xt=fr(Dt.id);Dt.registry(xt.bindFunction,xt.unbindFunction,xt.isboundFunction,xt.rebindFunction)}},Qt.prototype.loadAsync=function(){for(var It=[],Lt=0;Lt<arguments.length;Lt++)It[Lt]=arguments[Lt];return Re(this,void 0,void 0,function(){var fr,ie,yr,Dt,xt;return ge(this,function(Jt){switch(Jt.label){case 0:fr=this._getContainerModuleHelpersFactory(),ie=0,yr=It,Jt.label=1;case 1:return ie<yr.length?(Dt=yr[ie],xt=fr(Dt.id),[4,Dt.registry(xt.bindFunction,xt.unbindFunction,xt.isboundFunction,xt.rebindFunction)]):[3,4];case 2:Jt.sent(),Jt.label=3;case 3:return ie++,[3,1];case 4:return[2]}})})},Qt.prototype.unload=function(){for(var It=this,Lt=[],fr=0;fr<arguments.length;fr++)Lt[fr]=arguments[fr];var ie=function(yr){return function(Dt){return Dt.moduleId===yr}};Lt.forEach(function(yr){var Dt=ie(yr.id);It._bindingDictionary.removeByCondition(Dt)})},Qt.prototype.bind=function(It){var Lt=this.options.defaultScope||Me.BindingScopeEnum.Transient,fr=new Fe.Binding(It,Lt);return this._bindingDictionary.add(It,fr),new dt.BindingToSyntax(fr)},Qt.prototype.rebind=function(It){return this.unbind(It),this.bind(It)},Qt.prototype.unbind=function(It){try{this._bindingDictionary.remove(It)}catch(Lt){throw new Error(K.CANNOT_UNBIND+" "+Et.getServiceIdentifierAsString(It))}},Qt.prototype.unbindAll=function(){this._bindingDictionary=new Ut.Lookup},Qt.prototype.isBound=function(It){var Lt=this._bindingDictionary.hasKey(It);return!Lt&&this.parent&&(Lt=this.parent.isBound(It)),Lt},Qt.prototype.isBoundNamed=function(It,Lt){return this.isBoundTagged(It,ve.NAMED_TAG,Lt)},Qt.prototype.isBoundTagged=function(It,Lt,fr){var ie=!1;if(this._bindingDictionary.hasKey(It)){var yr=this._bindingDictionary.get(It),Dt=se.createMockRequest(this,It,Lt,fr);ie=yr.some(function(xt){return xt.constraint(Dt)})}return!ie&&this.parent&&(ie=this.parent.isBoundTagged(It,Lt,fr)),ie},Qt.prototype.snapshot=function(){this._snapshots.push(Vt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Qt.prototype.restore=function(){var It=this._snapshots.pop();if(It===void 0)throw new Error(K.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=It.bindings,this._middleware=It.middleware},Qt.prototype.createChild=function(It){var Lt=new Qt(It||this.options);return Lt.parent=this,Lt},Qt.prototype.applyMiddleware=function(){for(var It=[],Lt=0;Lt<arguments.length;Lt++)It[Lt]=arguments[Lt];this._appliedMiddleware=this._appliedMiddleware.concat(It);var fr=this._middleware?this._middleware:this._planAndResolve();this._middleware=It.reduce(function(ie,yr){return yr(ie)},fr)},Qt.prototype.applyCustomMetadataReader=function(It){this._metadataReader=It},Qt.prototype.get=function(It){return this._get(!1,!1,Me.TargetTypeEnum.Variable,It)},Qt.prototype.getTagged=function(It,Lt,fr){return this._get(!1,!1,Me.TargetTypeEnum.Variable,It,Lt,fr)},Qt.prototype.getNamed=function(It,Lt){return this.getTagged(It,ve.NAMED_TAG,Lt)},Qt.prototype.getAll=function(It){return this._get(!0,!0,Me.TargetTypeEnum.Variable,It)},Qt.prototype.getAllTagged=function(It,Lt,fr){return this._get(!1,!0,Me.TargetTypeEnum.Variable,It,Lt,fr)},Qt.prototype.getAllNamed=function(It,Lt){return this.getAllTagged(It,ve.NAMED_TAG,Lt)},Qt.prototype.resolve=function(It){var Lt=this.createChild();return Lt.bind(It).toSelf(),this._appliedMiddleware.forEach(function(fr){Lt.applyMiddleware(fr)}),Lt.get(It)},Qt.prototype._getContainerModuleHelpersFactory=function(){var It=this,Lt=function(xt,Jt){xt._binding.moduleId=Jt},fr=function(xt){return function(Jt){var je=It.bind.bind(It),Sr=je(Jt);return Lt(Sr,xt),Sr}},ie=function(xt){return function(Jt){var je=It.unbind.bind(It);je(Jt)}},yr=function(xt){return function(Jt){var je=It.isBound.bind(It);return je(Jt)}},Dt=function(xt){return function(Jt){var je=It.rebind.bind(It),Sr=je(Jt);return Lt(Sr,xt),Sr}};return function(xt){return{bindFunction:fr(xt),isboundFunction:yr(xt),rebindFunction:Dt(xt),unbindFunction:ie(xt)}}},Qt.prototype._get=function(It,Lt,fr,ie,yr,Dt){var xt=null,Jt={avoidConstraints:It,contextInterceptor:function(je){return je},isMultiInject:Lt,key:yr,serviceIdentifier:ie,targetType:fr,value:Dt};if(this._middleware){if(xt=this._middleware(Jt),xt==null)throw new Error(K.INVALID_MIDDLEWARE_RETURN)}else xt=this._planAndResolve()(Jt);return xt},Qt.prototype._planAndResolve=function(){var It=this;return function(Lt){var fr=se.plan(It._metadataReader,It,Lt.isMultiInject,Lt.targetType,Lt.serviceIdentifier,Lt.key,Lt.value,Lt.avoidConstraints);fr=Lt.contextInterceptor(fr);var ie=Be.resolve(fr);return ie}},Qt}();Ee.Container=lr},33244:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.AsyncContainerModule=Ee.ContainerModule=void 0;var Re=ue(37791),ge=function(){function Fe(K){this.id=Re.id(),this.registry=K}return Fe}();Ee.ContainerModule=ge;var y=function(){function Fe(K){this.id=Re.id(),this.registry=K}return Fe}();Ee.AsyncContainerModule=y},85700:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.ContainerSnapshot=void 0;var ue=function(){function Re(){}return Re.of=function(ge,y){var Fe=new Re;return Fe.bindings=ge,Fe.middleware=y,Fe},Re}();Ee.ContainerSnapshot=ue},80175:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Lookup=void 0;var Re=ue(16674),ge=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Fe,K){if(Fe==null)throw new Error(Re.NULL_ARGUMENT);if(K==null)throw new Error(Re.NULL_ARGUMENT);var Me=this._map.get(Fe);Me!==void 0?(Me.push(K),this._map.set(Fe,Me)):this._map.set(Fe,[K])},y.prototype.get=function(Fe){if(Fe==null)throw new Error(Re.NULL_ARGUMENT);var K=this._map.get(Fe);if(K!==void 0)return K;throw new Error(Re.KEY_NOT_FOUND)},y.prototype.remove=function(Fe){if(Fe==null)throw new Error(Re.NULL_ARGUMENT);if(!this._map.delete(Fe))throw new Error(Re.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Fe){var K=this;this._map.forEach(function(Me,ve){var at=Me.filter(function(se){return!Fe(se)});at.length>0?K._map.set(ve,at):K._map.delete(ve)})},y.prototype.hasKey=function(Fe){if(Fe==null)throw new Error(Re.NULL_ARGUMENT);return this._map.has(Fe)},y.prototype.clone=function(){var Fe=new y;return this._map.forEach(function(K,Me){K.forEach(function(ve){return Fe.add(Me,ve.clone())})}),Fe},y.prototype.traverse=function(Fe){this._map.forEach(function(K,Me){Fe(Me,K)})},y}();Ee.Lookup=ge},86700:function(wn,Ee,ue){"use strict";var Re;Re={value:!0},Re=Re=Re=Re=Re=Re=Ee.GW=Re=Re=Ee.zY=Re=Re=Re=Re=Re=Ee.f3=Re=Re=Ee.b2=Re=Re=Re=Re=Re=Ee.W2=Re=void 0;var ge=ue(6867);Re=ge;var y=ue(51389);Object.defineProperty(Ee,"W2",{enumerable:!0,get:function(){return y.Container}});var Fe=ue(28421);Re={enumerable:!0,get:function(){return Fe.BindingScopeEnum}},Re={enumerable:!0,get:function(){return Fe.BindingTypeEnum}},Re={enumerable:!0,get:function(){return Fe.TargetTypeEnum}};var K=ue(33244);Re={enumerable:!0,get:function(){return K.AsyncContainerModule}},Re={enumerable:!0,get:function(){return K.ContainerModule}};var Me=ue(64315);Object.defineProperty(Ee,"b2",{enumerable:!0,get:function(){return Me.injectable}});var ve=ue(32052);Re={enumerable:!0,get:function(){return ve.tagged}};var at=ue(38085);Re={enumerable:!0,get:function(){return at.named}};var se=ue(5744);Object.defineProperty(Ee,"f3",{enumerable:!0,get:function(){return se.inject}}),Re={enumerable:!0,get:function(){return se.LazyServiceIdentifer}};var Be=ue(6515);Re={enumerable:!0,get:function(){return Be.optional}};var dt=ue(86757);Re={enumerable:!0,get:function(){return dt.unmanaged}};var rt=ue(71693);Re={enumerable:!0,get:function(){return rt.multiInject}};var Et=ue(55638);Re={enumerable:!0,get:function(){return Et.targetName}};var Vt=ue(7014);Object.defineProperty(Ee,"zY",{enumerable:!0,get:function(){return Vt.postConstruct}});var Ut=ue(51377);Re={enumerable:!0,get:function(){return Ut.MetadataReader}};var lr=ue(37791);Re={enumerable:!0,get:function(){return lr.id}};var Qt=ue(99934);Object.defineProperty(Ee,"GW",{enumerable:!0,get:function(){return Qt.decorate}});var It=ue(80758);Re={enumerable:!0,get:function(){return It.traverseAncerstors}},Re={enumerable:!0,get:function(){return It.taggedConstraint}},Re={enumerable:!0,get:function(){return It.namedConstraint}},Re={enumerable:!0,get:function(){return It.typeConstraint}};var Lt=ue(55800);Re={enumerable:!0,get:function(){return Lt.getServiceIdentifierAsString}};var fr=ue(70600);Re={enumerable:!0,get:function(){return fr.multiBindToService}}},95228:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Context=void 0;var Re=ue(37791),ge=function(){function y(Fe){this.id=Re.id(),this.container=Fe}return y.prototype.addPlan=function(Fe){this.plan=Fe},y.prototype.setCurrentRequest=function(Fe){this.currentRequest=Fe},y}();Ee.Context=ge},47738:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Metadata=void 0;var Re=ue(6867),ge=function(){function y(Fe,K){this.key=Fe,this.value=K}return y.prototype.toString=function(){return this.key===Re.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();Ee.Metadata=ge},51377:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.MetadataReader=void 0;var Re=ue(6867),ge=function(){function y(){}return y.prototype.getConstructorMetadata=function(Fe){var K=Reflect.getMetadata(Re.PARAM_TYPES,Fe),Me=Reflect.getMetadata(Re.TAGGED,Fe);return{compilerGeneratedMetadata:K,userGeneratedMetadata:Me||{}}},y.prototype.getPropertiesMetadata=function(Fe){var K=Reflect.getMetadata(Re.TAGGED_PROP,Fe)||[];return K},y}();Ee.MetadataReader=ge},55314:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Plan=void 0;var ue=function(){function Re(ge,y){this.parentContext=ge,this.rootRequest=y}return Re}();Ee.Plan=ue},86311:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.getBindingDictionary=Ee.createMockRequest=Ee.plan=void 0;var Re=ue(23184),ge=ue(16674),y=ue(28421),Fe=ue(6867),K=ue(85265),Me=ue(55800),ve=ue(95228),at=ue(47738),se=ue(55314),Be=ue(6e3),dt=ue(6748),rt=ue(18924);function Et(ie){return ie._bindingDictionary}Ee.getBindingDictionary=Et;function Vt(ie,yr,Dt,xt,Jt,je){var Sr=ie?Fe.MULTI_INJECT_TAG:Fe.INJECT_TAG,tn=new at.Metadata(Sr,Dt),re=new rt.Target(yr,xt,Dt,tn);if(Jt!==void 0){var Se=new at.Metadata(Jt,je);re.metadata.push(Se)}return re}function Ut(ie,yr,Dt,xt,Jt){var je=It(Dt.container,Jt.serviceIdentifier),Sr=[];return je.length===Re.BindingCount.NoBindingsAvailable&&Dt.container.options.autoBindInjectable&&typeof Jt.serviceIdentifier=="function"&&ie.getConstructorMetadata(Jt.serviceIdentifier).compilerGeneratedMetadata&&(Dt.container.bind(Jt.serviceIdentifier).toSelf(),je=It(Dt.container,Jt.serviceIdentifier)),yr?Sr=je:Sr=je.filter(function(tn){var re=new dt.Request(tn.serviceIdentifier,Dt,xt,tn,Jt);return tn.constraint(re)}),lr(Jt.serviceIdentifier,Sr,Jt,Dt.container),Sr}function lr(ie,yr,Dt,xt){switch(yr.length){case Re.BindingCount.NoBindingsAvailable:if(Dt.isOptional())return yr;var Jt=Me.getServiceIdentifierAsString(ie),je=ge.NOT_REGISTERED;throw je+=Me.listMetadataForTarget(Jt,Dt),je+=Me.listRegisteredBindingsForServiceIdentifier(xt,Jt,It),new Error(je);case Re.BindingCount.OnlyOneBindingAvailable:if(!Dt.isArray())return yr;case Re.BindingCount.MultipleBindingsAvailable:default:if(Dt.isArray())return yr;var Jt=Me.getServiceIdentifierAsString(ie),je=ge.AMBIGUOUS_MATCH+" "+Jt;throw je+=Me.listRegisteredBindingsForServiceIdentifier(xt,Jt,It),new Error(je)}}function Qt(ie,yr,Dt,xt,Jt,je){var Sr,tn;if(Jt===null){Sr=Ut(ie,yr,xt,null,je),tn=new dt.Request(Dt,xt,null,Sr,je);var re=new se.Plan(xt,tn);xt.addPlan(re)}else Sr=Ut(ie,yr,xt,Jt,je),tn=Jt.addChildRequest(je.serviceIdentifier,Sr,je);Sr.forEach(function(Se){var V=null;if(je.isArray())V=tn.addChildRequest(Se.serviceIdentifier,Se,je);else{if(Se.cache)return;V=tn}if(Se.type===y.BindingTypeEnum.Instance&&Se.implementationType!==null){var Q=Be.getDependencies(ie,Se.implementationType);if(!xt.container.options.skipBaseClassChecks){var Le=Be.getBaseClassDependencyCount(ie,Se.implementationType);if(Q.length<Le){var ht=ge.ARGUMENTS_LENGTH_MISMATCH(Be.getFunctionName(Se.implementationType));throw new Error(ht)}}Q.forEach(function(wt){Qt(ie,!1,wt.serviceIdentifier,xt,V,wt)})}})}function It(ie,yr){var Dt=[],xt=Et(ie);return xt.hasKey(yr)?Dt=xt.get(yr):ie.parent!==null&&(Dt=It(ie.parent,yr)),Dt}function Lt(ie,yr,Dt,xt,Jt,je,Sr,tn){tn===void 0&&(tn=!1);var re=new ve.Context(yr),Se=Vt(Dt,xt,Jt,"",je,Sr);try{return Qt(ie,tn,Jt,re,null,Se),re}catch(V){throw K.isStackOverflowExeption(V)&&re.plan&&Me.circularDependencyToException(re.plan.rootRequest),V}}Ee.plan=Lt;function fr(ie,yr,Dt,xt){var Jt=new rt.Target(y.TargetTypeEnum.Variable,"",yr,new at.Metadata(Dt,xt)),je=new ve.Context(ie),Sr=new dt.Request(yr,je,null,[],Jt);return Sr}Ee.createMockRequest=fr},88460:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.QueryableString=void 0;var ue=function(){function Re(ge){this.str=ge}return Re.prototype.startsWith=function(ge){return this.str.indexOf(ge)===0},Re.prototype.endsWith=function(ge){var y="",Fe=ge.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Fe)},Re.prototype.contains=function(ge){return this.str.indexOf(ge)!==-1},Re.prototype.equals=function(ge){return this.str===ge},Re.prototype.value=function(){return this.str},Re}();Ee.QueryableString=ue},6e3:function(wn,Ee,ue){"use strict";var Re=this&&this.__spreadArray||function(Ut,lr){for(var Qt=0,It=lr.length,Lt=Ut.length;Qt<It;Qt++,Lt++)Ut[Lt]=lr[Qt];return Ut};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.getFunctionName=Ee.getBaseClassDependencyCount=Ee.getDependencies=void 0;var ge=ue(5744),y=ue(16674),Fe=ue(28421),K=ue(6867),Me=ue(55800);Object.defineProperty(Ee,"getFunctionName",{enumerable:!0,get:function(){return Me.getFunctionName}});var ve=ue(18924);function at(Ut,lr){var Qt=Me.getFunctionName(lr),It=se(Ut,Qt,lr,!1);return It}Ee.getDependencies=at;function se(Ut,lr,Qt,It){var Lt=Ut.getConstructorMetadata(Qt),fr=Lt.compilerGeneratedMetadata;if(fr===void 0){var ie=y.MISSING_INJECTABLE_ANNOTATION+" "+lr+".";throw new Error(ie)}var yr=Lt.userGeneratedMetadata,Dt=Object.keys(yr),xt=Qt.length===0&&Dt.length>0,Jt=Dt.length>Qt.length,je=xt||Jt?Dt.length:Qt.length,Sr=dt(It,lr,fr,yr,je),tn=rt(Ut,Qt),re=Re(Re([],Sr),tn);return re}function Be(Ut,lr,Qt,It,Lt){var fr=Lt[Ut.toString()]||[],ie=Vt(fr),yr=ie.unmanaged!==!0,Dt=It[Ut],xt=ie.inject||ie.multiInject;if(Dt=xt||Dt,Dt instanceof ge.LazyServiceIdentifer&&(Dt=Dt.unwrap()),yr){var Jt=Dt===Object,je=Dt===Function,Sr=Dt===void 0,tn=Jt||je||Sr;if(!lr&&tn){var re=y.MISSING_INJECT_ANNOTATION+" argument "+Ut+" in class "+Qt+".";throw new Error(re)}var Se=new ve.Target(Fe.TargetTypeEnum.ConstructorArgument,ie.targetName,Dt);return Se.metadata=fr,Se}return null}function dt(Ut,lr,Qt,It,Lt){for(var fr=[],ie=0;ie<Lt;ie++){var yr=ie,Dt=Be(yr,Ut,lr,Qt,It);Dt!==null&&fr.push(Dt)}return fr}function rt(Ut,lr){for(var Qt=Ut.getPropertiesMetadata(lr),It=[],Lt=Object.keys(Qt),fr=0,ie=Lt;fr<ie.length;fr++){var yr=ie[fr],Dt=Qt[yr],xt=Vt(Qt[yr]),Jt=xt.targetName||yr,je=xt.inject||xt.multiInject,Sr=new ve.Target(Fe.TargetTypeEnum.ClassProperty,Jt,je);Sr.metadata=Dt,It.push(Sr)}var tn=Object.getPrototypeOf(lr.prototype).constructor;if(tn!==Object){var re=rt(Ut,tn);It=Re(Re([],It),re)}return It}function Et(Ut,lr){var Qt=Object.getPrototypeOf(lr.prototype).constructor;if(Qt!==Object){var It=Me.getFunctionName(Qt),Lt=se(Ut,It,Qt,!0),fr=Lt.map(function(Dt){return Dt.metadata.filter(function(xt){return xt.key===K.UNMANAGED_TAG})}),ie=[].concat.apply([],fr).length,yr=Lt.length-ie;return yr>0?yr:Et(Ut,Qt)}else return 0}Ee.getBaseClassDependencyCount=Et;function Vt(Ut){var lr={};return Ut.forEach(function(Qt){lr[Qt.key.toString()]=Qt.value}),{inject:lr[K.INJECT_TAG],multiInject:lr[K.MULTI_INJECT_TAG],targetName:lr[K.NAME_TAG],unmanaged:lr[K.UNMANAGED_TAG]}}},6748:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Request=void 0;var Re=ue(37791),ge=function(){function y(Fe,K,Me,ve,at){this.id=Re.id(),this.serviceIdentifier=Fe,this.parentContext=K,this.parentRequest=Me,this.target=at,this.childRequests=[],this.bindings=Array.isArray(ve)?ve:[ve],this.requestScope=Me===null?new Map:null}return y.prototype.addChildRequest=function(Fe,K,Me){var ve=new y(Fe,this.parentContext,this,K,Me);return this.childRequests.push(ve),ve},y}();Ee.Request=ge},18924:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Target=void 0;var Re=ue(6867),ge=ue(37791),y=ue(47738),Fe=ue(88460),K=function(){function Me(ve,at,se,Be){this.id=ge.id(),this.type=ve,this.serviceIdentifier=se,this.name=new Fe.QueryableString(at||""),this.metadata=new Array;var dt=null;typeof Be=="string"?dt=new y.Metadata(Re.NAMED_TAG,Be):Be instanceof y.Metadata&&(dt=Be),dt!==null&&this.metadata.push(dt)}return Me.prototype.hasTag=function(ve){for(var at=0,se=this.metadata;at<se.length;at++){var Be=se[at];if(Be.key===ve)return!0}return!1},Me.prototype.isArray=function(){return this.hasTag(Re.MULTI_INJECT_TAG)},Me.prototype.matchesArray=function(ve){return this.matchesTag(Re.MULTI_INJECT_TAG)(ve)},Me.prototype.isNamed=function(){return this.hasTag(Re.NAMED_TAG)},Me.prototype.isTagged=function(){return this.metadata.some(function(ve){return Re.NON_CUSTOM_TAG_KEYS.every(function(at){return ve.key!==at})})},Me.prototype.isOptional=function(){return this.matchesTag(Re.OPTIONAL_TAG)(!0)},Me.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ve){return ve.key===Re.NAMED_TAG})[0]:null},Me.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ve){return Re.NON_CUSTOM_TAG_KEYS.every(function(at){return ve.key!==at})}):null},Me.prototype.matchesNamedTag=function(ve){return this.matchesTag(Re.NAMED_TAG)(ve)},Me.prototype.matchesTag=function(ve){var at=this;return function(se){for(var Be=0,dt=at.metadata;Be<dt.length;Be++){var rt=dt[Be];if(rt.key===ve&&rt.value===se)return!0}return!1}},Me}();Ee.Target=K},52279:function(wn,Ee,ue){"use strict";var Re=this&&this.__spreadArray||function(se,Be){for(var dt=0,rt=Be.length,Et=se.length;dt<rt;dt++,Et++)se[Et]=Be[dt];return se};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.resolveInstance=void 0;var ge=ue(16674),y=ue(28421),Fe=ue(6867);function K(se,Be,dt){var rt=Be.filter(function(Vt){return Vt.target!==null&&Vt.target.type===y.TargetTypeEnum.ClassProperty}),Et=rt.map(dt);return rt.forEach(function(Vt,Ut){var lr="";lr=Vt.target.name.value();var Qt=Et[Ut];se[lr]=Qt}),se}function Me(se,Be){return new(se.bind.apply(se,Re([void 0],Be)))}function ve(se,Be){if(Reflect.hasMetadata(Fe.POST_CONSTRUCT,se)){var dt=Reflect.getMetadata(Fe.POST_CONSTRUCT,se);try{Be[dt.value]()}catch(rt){throw new Error(ge.POST_CONSTRUCT_ERROR(se.name,rt.message))}}}function at(se,Be,dt){var rt=null;if(Be.length>0){var Et=Be.filter(function(Ut){return Ut.target!==null&&Ut.target.type===y.TargetTypeEnum.ConstructorArgument}),Vt=Et.map(dt);rt=Me(se,Vt),rt=K(rt,Be,dt)}else rt=new se;return ve(se,rt),rt}Ee.resolveInstance=at},31927:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.resolve=void 0;var Re=ue(16674),ge=ue(28421),y=ue(85265),Fe=ue(55800),K=ue(52279),Me=function(se,Be,dt){try{return dt()}catch(rt){throw y.isStackOverflowExeption(rt)?new Error(Re.CIRCULAR_DEPENDENCY_IN_FACTORY(se,Be.toString())):rt}},ve=function(se){return function(Be){Be.parentContext.setCurrentRequest(Be);var dt=Be.bindings,rt=Be.childRequests,Et=Be.target&&Be.target.isArray(),Vt=!Be.parentRequest||!Be.parentRequest.target||!Be.target||!Be.parentRequest.target.matchesArray(Be.target.serviceIdentifier);if(Et&&Vt)return rt.map(function(fr){var ie=ve(se);return ie(fr)});var Ut=null;if(Be.target.isOptional()&&dt.length===0)return;var lr=dt[0],Qt=lr.scope===ge.BindingScopeEnum.Singleton,It=lr.scope===ge.BindingScopeEnum.Request;if(Qt&&lr.activated)return lr.cache;if(It&&se!==null&&se.has(lr.id))return se.get(lr.id);if(lr.type===ge.BindingTypeEnum.ConstantValue)Ut=lr.cache,lr.activated=!0;else if(lr.type===ge.BindingTypeEnum.Function)Ut=lr.cache,lr.activated=!0;else if(lr.type===ge.BindingTypeEnum.Constructor)Ut=lr.implementationType;else if(lr.type===ge.BindingTypeEnum.DynamicValue&&lr.dynamicValue!==null)Ut=Me("toDynamicValue",lr.serviceIdentifier,function(){return lr.dynamicValue(Be.parentContext)});else if(lr.type===ge.BindingTypeEnum.Factory&&lr.factory!==null)Ut=Me("toFactory",lr.serviceIdentifier,function(){return lr.factory(Be.parentContext)});else if(lr.type===ge.BindingTypeEnum.Provider&&lr.provider!==null)Ut=Me("toProvider",lr.serviceIdentifier,function(){return lr.provider(Be.parentContext)});else if(lr.type===ge.BindingTypeEnum.Instance&&lr.implementationType!==null)Ut=K.resolveInstance(lr.implementationType,rt,ve(se));else{var Lt=Fe.getServiceIdentifierAsString(Be.serviceIdentifier);throw new Error(Re.INVALID_BINDING_TYPE+" "+Lt)}return typeof lr.onActivation=="function"&&(Ut=lr.onActivation(Be.parentContext,Ut)),Qt&&(lr.cache=Ut,lr.activated=!0),It&&se!==null&&!se.has(lr.id)&&se.set(lr.id,Ut),Ut}};function at(se){var Be=ve(se.plan.rootRequest.requestScope);return Be(se.plan.rootRequest)}Ee.resolve=at},83366:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingInSyntax=void 0;var Re=ue(28421),ge=ue(71325),y=function(){function Fe(K){this._binding=K}return Fe.prototype.inRequestScope=function(){return this._binding.scope=Re.BindingScopeEnum.Request,new ge.BindingWhenOnSyntax(this._binding)},Fe.prototype.inSingletonScope=function(){return this._binding.scope=Re.BindingScopeEnum.Singleton,new ge.BindingWhenOnSyntax(this._binding)},Fe.prototype.inTransientScope=function(){return this._binding.scope=Re.BindingScopeEnum.Transient,new ge.BindingWhenOnSyntax(this._binding)},Fe}();Ee.BindingInSyntax=y},74889:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingInWhenOnSyntax=void 0;var Re=ue(83366),ge=ue(51811),y=ue(98370),Fe=function(){function K(Me){this._binding=Me,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ge.BindingOnSyntax(this._binding),this._bindingInSyntax=new Re.BindingInSyntax(Me)}return K.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},K.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},K.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},K.prototype.when=function(Me){return this._bindingWhenSyntax.when(Me)},K.prototype.whenTargetNamed=function(Me){return this._bindingWhenSyntax.whenTargetNamed(Me)},K.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},K.prototype.whenTargetTagged=function(Me,ve){return this._bindingWhenSyntax.whenTargetTagged(Me,ve)},K.prototype.whenInjectedInto=function(Me){return this._bindingWhenSyntax.whenInjectedInto(Me)},K.prototype.whenParentNamed=function(Me){return this._bindingWhenSyntax.whenParentNamed(Me)},K.prototype.whenParentTagged=function(Me,ve){return this._bindingWhenSyntax.whenParentTagged(Me,ve)},K.prototype.whenAnyAncestorIs=function(Me){return this._bindingWhenSyntax.whenAnyAncestorIs(Me)},K.prototype.whenNoAncestorIs=function(Me){return this._bindingWhenSyntax.whenNoAncestorIs(Me)},K.prototype.whenAnyAncestorNamed=function(Me){return this._bindingWhenSyntax.whenAnyAncestorNamed(Me)},K.prototype.whenAnyAncestorTagged=function(Me,ve){return this._bindingWhenSyntax.whenAnyAncestorTagged(Me,ve)},K.prototype.whenNoAncestorNamed=function(Me){return this._bindingWhenSyntax.whenNoAncestorNamed(Me)},K.prototype.whenNoAncestorTagged=function(Me,ve){return this._bindingWhenSyntax.whenNoAncestorTagged(Me,ve)},K.prototype.whenAnyAncestorMatches=function(Me){return this._bindingWhenSyntax.whenAnyAncestorMatches(Me)},K.prototype.whenNoAncestorMatches=function(Me){return this._bindingWhenSyntax.whenNoAncestorMatches(Me)},K.prototype.onActivation=function(Me){return this._bindingOnSyntax.onActivation(Me)},K}();Ee.BindingInWhenOnSyntax=Fe},51811:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingOnSyntax=void 0;var Re=ue(98370),ge=function(){function y(Fe){this._binding=Fe}return y.prototype.onActivation=function(Fe){return this._binding.onActivation=Fe,new Re.BindingWhenSyntax(this._binding)},y}();Ee.BindingOnSyntax=ge},15451:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingToSyntax=void 0;var Re=ue(16674),ge=ue(28421),y=ue(74889),Fe=ue(71325),K=function(){function Me(ve){this._binding=ve}return Me.prototype.to=function(ve){return this._binding.type=ge.BindingTypeEnum.Instance,this._binding.implementationType=ve,new y.BindingInWhenOnSyntax(this._binding)},Me.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Re.INVALID_TO_SELF_VALUE);var ve=this._binding.serviceIdentifier;return this.to(ve)},Me.prototype.toConstantValue=function(ve){return this._binding.type=ge.BindingTypeEnum.ConstantValue,this._binding.cache=ve,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ge.BindingScopeEnum.Singleton,new Fe.BindingWhenOnSyntax(this._binding)},Me.prototype.toDynamicValue=function(ve){return this._binding.type=ge.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ve,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Me.prototype.toConstructor=function(ve){return this._binding.type=ge.BindingTypeEnum.Constructor,this._binding.implementationType=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Fe.BindingWhenOnSyntax(this._binding)},Me.prototype.toFactory=function(ve){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Fe.BindingWhenOnSyntax(this._binding)},Me.prototype.toFunction=function(ve){if(typeof ve!="function")throw new Error(Re.INVALID_FUNCTION_BINDING);var at=this.toConstantValue(ve);return this._binding.type=ge.BindingTypeEnum.Function,this._binding.scope=ge.BindingScopeEnum.Singleton,at},Me.prototype.toAutoFactory=function(ve){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=function(at){var se=function(){return at.container.get(ve)};return se},this._binding.scope=ge.BindingScopeEnum.Singleton,new Fe.BindingWhenOnSyntax(this._binding)},Me.prototype.toProvider=function(ve){return this._binding.type=ge.BindingTypeEnum.Provider,this._binding.provider=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Fe.BindingWhenOnSyntax(this._binding)},Me.prototype.toService=function(ve){this.toDynamicValue(function(at){return at.container.get(ve)})},Me}();Ee.BindingToSyntax=K},71325:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingWhenOnSyntax=void 0;var Re=ue(51811),ge=ue(98370),y=function(){function Fe(K){this._binding=K,this._bindingWhenSyntax=new ge.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Re.BindingOnSyntax(this._binding)}return Fe.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},Fe.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},Fe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Fe.prototype.whenTargetTagged=function(K,Me){return this._bindingWhenSyntax.whenTargetTagged(K,Me)},Fe.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},Fe.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},Fe.prototype.whenParentTagged=function(K,Me){return this._bindingWhenSyntax.whenParentTagged(K,Me)},Fe.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},Fe.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},Fe.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},Fe.prototype.whenAnyAncestorTagged=function(K,Me){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,Me)},Fe.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},Fe.prototype.whenNoAncestorTagged=function(K,Me){return this._bindingWhenSyntax.whenNoAncestorTagged(K,Me)},Fe.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},Fe.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},Fe.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},Fe}();Ee.BindingWhenOnSyntax=y},98370:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BindingWhenSyntax=void 0;var Re=ue(51811),ge=ue(80758),y=function(){function Fe(K){this._binding=K}return Fe.prototype.when=function(K){return this._binding.constraint=K,new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenTargetNamed=function(K){return this._binding.constraint=ge.namedConstraint(K),new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(K){var Me=K.target!==null&&!K.target.isNamed()&&!K.target.isTagged();return Me},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenTargetTagged=function(K,Me){return this._binding.constraint=ge.taggedConstraint(K)(Me),new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenInjectedInto=function(K){return this._binding.constraint=function(Me){return ge.typeConstraint(K)(Me.parentRequest)},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenParentNamed=function(K){return this._binding.constraint=function(Me){return ge.namedConstraint(K)(Me.parentRequest)},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenParentTagged=function(K,Me){return this._binding.constraint=function(ve){return ge.taggedConstraint(K)(Me)(ve.parentRequest)},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenAnyAncestorIs=function(K){return this._binding.constraint=function(Me){return ge.traverseAncerstors(Me,ge.typeConstraint(K))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenNoAncestorIs=function(K){return this._binding.constraint=function(Me){return!ge.traverseAncerstors(Me,ge.typeConstraint(K))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenAnyAncestorNamed=function(K){return this._binding.constraint=function(Me){return ge.traverseAncerstors(Me,ge.namedConstraint(K))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenNoAncestorNamed=function(K){return this._binding.constraint=function(Me){return!ge.traverseAncerstors(Me,ge.namedConstraint(K))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenAnyAncestorTagged=function(K,Me){return this._binding.constraint=function(ve){return ge.traverseAncerstors(ve,ge.taggedConstraint(K)(Me))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenNoAncestorTagged=function(K,Me){return this._binding.constraint=function(ve){return!ge.traverseAncerstors(ve,ge.taggedConstraint(K)(Me))},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenAnyAncestorMatches=function(K){return this._binding.constraint=function(Me){return ge.traverseAncerstors(Me,K)},new Re.BindingOnSyntax(this._binding)},Fe.prototype.whenNoAncestorMatches=function(K){return this._binding.constraint=function(Me){return!ge.traverseAncerstors(Me,K)},new Re.BindingOnSyntax(this._binding)},Fe}();Ee.BindingWhenSyntax=y},80758:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.typeConstraint=Ee.namedConstraint=Ee.taggedConstraint=Ee.traverseAncerstors=void 0;var Re=ue(6867),ge=ue(47738),y=function(ve,at){var se=ve.parentRequest;return se!==null?at(se)?!0:y(se,at):!1};Ee.traverseAncerstors=y;var Fe=function(ve){return function(at){var se=function(Be){return Be!==null&&Be.target!==null&&Be.target.matchesTag(ve)(at)};return se.metaData=new ge.Metadata(ve,at),se}};Ee.taggedConstraint=Fe;var K=Fe(Re.NAMED_TAG);Ee.namedConstraint=K;var Me=function(ve){return function(at){var se=null;if(at!==null)if(se=at.bindings[0],typeof ve=="string"){var Be=se.serviceIdentifier;return Be===ve}else{var dt=at.bindings[0].implementationType;return ve===dt}return!1}};Ee.typeConstraint=Me},70600:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.multiBindToService=void 0;var ue=function(Re){return function(ge){return function(){for(var y=[],Fe=0;Fe<arguments.length;Fe++)y[Fe]=arguments[Fe];return y.forEach(function(K){return Re.bind(K).toService(ge)})}}};Ee.multiBindToService=ue},85265:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.isStackOverflowExeption=void 0;var Re=ue(16674);function ge(y){return y instanceof RangeError||y.message===Re.STACK_OVERFLOW}Ee.isStackOverflowExeption=ge},37791:function(wn,Ee){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.id=void 0;var ue=0;function Re(){return ue++}Ee.id=Re},55800:function(wn,Ee,ue){"use strict";Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.circularDependencyToException=Ee.listMetadataForTarget=Ee.listRegisteredBindingsForServiceIdentifier=Ee.getServiceIdentifierAsString=Ee.getFunctionName=void 0;var Re=ue(16674);function ge(se){if(typeof se=="function"){var Be=se;return Be.name}else{if(typeof se=="symbol")return se.toString();var Be=se;return Be}}Ee.getServiceIdentifierAsString=ge;function y(se,Be,dt){var rt="",Et=dt(se,Be);return Et.length!==0&&(rt=`
Registered bindings:`,Et.forEach(function(Vt){var Ut="Object";Vt.implementationType!==null&&(Ut=at(Vt.implementationType)),rt=rt+`
 `+Ut,Vt.constraint.metaData&&(rt=rt+" - "+Vt.constraint.metaData)})),rt}Ee.listRegisteredBindingsForServiceIdentifier=y;function Fe(se,Be){return se.parentRequest===null?!1:se.parentRequest.serviceIdentifier===Be?!0:Fe(se.parentRequest,Be)}function K(se){function Be(rt,Et){Et===void 0&&(Et=[]);var Vt=ge(rt.serviceIdentifier);return Et.push(Vt),rt.parentRequest!==null?Be(rt.parentRequest,Et):Et}var dt=Be(se);return dt.reverse().join(" --> ")}function Me(se){se.childRequests.forEach(function(Be){if(Fe(Be,Be.serviceIdentifier)){var dt=K(Be);throw new Error(Re.CIRCULAR_DEPENDENCY+" "+dt)}else Me(Be)})}Ee.circularDependencyToException=Me;function ve(se,Be){if(Be.isTagged()||Be.isNamed()){var dt="",rt=Be.getNamedTag(),Et=Be.getCustomTags();return rt!==null&&(dt+=rt.toString()+`
`),Et!==null&&Et.forEach(function(Vt){dt+=Vt.toString()+`
`})," "+se+`
 `+se+" - "+dt}else return" "+se}Ee.listMetadataForTarget=ve;function at(se){if(se.name)return se.name;var Be=se.toString(),dt=Be.match(/^function\s*([^\s(]+)/);return dt?dt[1]:"Anonymous function: "+Be}Ee.getFunctionName=at},31745:function(wn){"use strict";wn.exports=ue,wn.exports.default=ue;var Ee=1e20;function ue(K,Me,ve,at,se,Be){this.fontSize=K||24,this.buffer=Me===void 0?3:Me,this.cutoff=at||.25,this.fontFamily=se||"sans-serif",this.fontWeight=Be||"normal",this.radius=ve||8;var dt=this.size=this.fontSize+this.buffer*2,rt=dt+this.buffer*2,Et=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Et?this.canvas=my.createOffscreenCanvas(dt,dt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=dt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(rt*rt),this.gridInner=new Float64Array(rt*rt),this.f=new Float64Array(rt),this.z=new Float64Array(rt+1),this.v=new Uint16Array(rt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Et?this.middle=Math.round(dt/2*1):this.middle=Math.round(dt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Re(K,Me,ve,at,se,Be,dt){Be.fill(Ee,0,Me*ve),dt.fill(0,0,Me*ve);for(var rt=(Me-at)/2,Et=0;Et<se;Et++)for(var Vt=0;Vt<at;Vt++){var Ut=(Et+rt)*Me+Vt+rt,lr=K.data[4*(Et*at+Vt)+3]/255;if(lr===1)Be[Ut]=0,dt[Ut]=Ee;else if(lr===0)Be[Ut]=Ee,dt[Ut]=0;else{var Qt=Math.max(0,.5-lr),It=Math.max(0,lr-.5);Be[Ut]=Qt*Qt,dt[Ut]=It*It}}}function ge(K,Me,ve,at,se,Be,dt){for(var rt=0;rt<Me*ve;rt++){var Et=Math.sqrt(at[rt])-Math.sqrt(se[rt]);K[rt]=Math.round(255-255*(Et/Be+dt))}}ue.prototype._draw=function(K,Me){var ve=this.ctx.measureText(K),at=ve.width,se=2*this.buffer,Be,dt,rt,Et,Vt,Ut,lr,Qt;Me&&this.useMetrics?(Vt=Math.floor(ve.actualBoundingBoxAscent),Qt=this.buffer+Math.ceil(ve.actualBoundingBoxAscent),Ut=this.buffer,lr=this.buffer,dt=Math.min(this.size,Math.ceil(ve.actualBoundingBoxRight-ve.actualBoundingBoxLeft)),Et=Math.min(this.size-Ut,Math.ceil(ve.actualBoundingBoxAscent+ve.actualBoundingBoxDescent)),Be=dt+se,rt=Et+se,this.ctx.textBaseline="alphabetic"):(Be=dt=this.size,rt=Et=this.size,Vt=19*this.fontSize/24,Ut=lr=0,Qt=this.middle,this.ctx.textBaseline="middle");var It;dt&&Et&&(this.ctx.clearRect(lr,Ut,dt,Et),this.ctx.fillText(K,this.buffer,Qt),It=this.ctx.getImageData(lr,Ut,dt,Et));var Lt=new Uint8ClampedArray(Be*rt);return Re(It,Be,rt,dt,Et,this.gridOuter,this.gridInner),y(this.gridOuter,Be,rt,this.f,this.v,this.z),y(this.gridInner,Be,rt,this.f,this.v,this.z),ge(Lt,Be,rt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Lt,metrics:{width:dt,height:Et,sdfWidth:Be,sdfHeight:rt,top:Vt,left:0,advance:at}}},ue.prototype.draw=function(K){return this._draw(K,!1).data},ue.prototype.drawWithMetrics=function(K){return this._draw(K,!0)};function y(K,Me,ve,at,se,Be){for(var dt=0;dt<Me;dt++)Fe(K,dt,Me,ve,at,se,Be);for(var rt=0;rt<ve;rt++)Fe(K,rt*Me,1,Me,at,se,Be)}function Fe(K,Me,ve,at,se,Be,dt){var rt,Et,Vt,Ut;for(Be[0]=0,dt[0]=-Ee,dt[1]=Ee,rt=0;rt<at;rt++)se[rt]=K[Me+rt*ve];for(rt=1,Et=0,Vt=0;rt<at;rt++){do Ut=Be[Et],Vt=(se[rt]-se[Ut]+rt*rt-Ut*Ut)/(rt-Ut)/2;while(Vt<=dt[Et]&&--Et>-1);Et++,Be[Et]=rt,dt[Et]=Vt,dt[Et+1]=Ee}for(rt=0,Et=0;rt<at;rt++){for(;dt[Et+1]<rt;)Et++;Ut=Be[Et],K[Me+rt*ve]=se[Ut]+(rt-Ut)*(rt-Ut)}}},18857:function(wn,Ee,ue){"use strict";ue.r(Ee),ue.d(Ee,{Function:function(){return _l},Interpreter:function(){return Cs},default:function(){return gf},evaluate:function(){return wc},vm:function(){return Re}});var Re={};ue.r(Re),ue.d(Re,{Script:function(){return yl},compileFunction:function(){return el},createContext:function(){return Ch},runInContext:function(){return mf},runInNewContext:function(){return qf}});var ge={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Fe={5:y,"5module":y+" export import",6:y+" const class extends export import super"},K=/^in(stanceof)?$/,Me="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ve="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",at=new RegExp("["+Me+"]"),se=new RegExp("["+Me+ve+"]");Me=ve=null;var Be=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],dt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function rt(E,k){for(var H=65536,F=0;F<k.length;F+=2){if(H+=k[F],H>E)return!1;if(H+=k[F+1],H>=E)return!0}}function Et(E,k){return E<65?E===36:E<91?!0:E<97?E===95:E<123?!0:E<=65535?E>=170&&at.test(String.fromCharCode(E)):k===!1?!1:rt(E,Be)}function Vt(E,k){return E<48?E===36:E<58?!0:E<65?!1:E<91?!0:E<97?E===95:E<123?!0:E<=65535?E>=170&&se.test(String.fromCharCode(E)):k===!1?!1:rt(E,Be)||rt(E,dt)}var Ut=function(k,H){H===void 0&&(H={}),this.label=k,this.keyword=H.keyword,this.beforeExpr=!!H.beforeExpr,this.startsExpr=!!H.startsExpr,this.isLoop=!!H.isLoop,this.isAssign=!!H.isAssign,this.prefix=!!H.prefix,this.postfix=!!H.postfix,this.binop=H.binop||null,this.updateContext=null};function lr(E,k){return new Ut(E,{beforeExpr:!0,binop:k})}var Qt={beforeExpr:!0},It={startsExpr:!0},Lt={};function fr(E,k){return k===void 0&&(k={}),k.keyword=E,Lt[E]=new Ut(E,k)}var ie={num:new Ut("num",It),regexp:new Ut("regexp",It),string:new Ut("string",It),name:new Ut("name",It),eof:new Ut("eof"),bracketL:new Ut("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ut("]"),braceL:new Ut("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ut("}"),parenL:new Ut("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ut(")"),comma:new Ut(",",Qt),semi:new Ut(";",Qt),colon:new Ut(":",Qt),dot:new Ut("."),question:new Ut("?",Qt),questionDot:new Ut("?."),arrow:new Ut("=>",Qt),template:new Ut("template"),invalidTemplate:new Ut("invalidTemplate"),ellipsis:new Ut("...",Qt),backQuote:new Ut("`",It),dollarBraceL:new Ut("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ut("=",{beforeExpr:!0,isAssign:!0}),assign:new Ut("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ut("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ut("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:lr("||",1),logicalAND:lr("&&",2),bitwiseOR:lr("|",3),bitwiseXOR:lr("^",4),bitwiseAND:lr("&",5),equality:lr("==/!=/===/!==",6),relational:lr("</>/<=/>=",7),bitShift:lr("<</>>/>>>",8),plusMin:new Ut("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:lr("%",10),star:lr("*",10),slash:lr("/",10),starstar:new Ut("**",{beforeExpr:!0}),coalesce:lr("??",1),_break:fr("break"),_case:fr("case",Qt),_catch:fr("catch"),_continue:fr("continue"),_debugger:fr("debugger"),_default:fr("default",Qt),_do:fr("do",{isLoop:!0,beforeExpr:!0}),_else:fr("else",Qt),_finally:fr("finally"),_for:fr("for",{isLoop:!0}),_function:fr("function",It),_if:fr("if"),_return:fr("return",Qt),_switch:fr("switch"),_throw:fr("throw",Qt),_try:fr("try"),_var:fr("var"),_const:fr("const"),_while:fr("while",{isLoop:!0}),_with:fr("with"),_new:fr("new",{beforeExpr:!0,startsExpr:!0}),_this:fr("this",It),_super:fr("super",It),_class:fr("class",It),_extends:fr("extends",Qt),_export:fr("export"),_import:fr("import",It),_null:fr("null",It),_true:fr("true",It),_false:fr("false",It),_in:fr("in",{beforeExpr:!0,binop:7}),_instanceof:fr("instanceof",{beforeExpr:!0,binop:7}),_typeof:fr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:fr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:fr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},yr=/\r\n?|\n|\u2028|\u2029/,Dt=new RegExp(yr.source,"g");function xt(E,k){return E===10||E===13||!k&&(E===8232||E===8233)}var Jt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,je=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Sr=Object.prototype,tn=Sr.hasOwnProperty,re=Sr.toString;function Se(E,k){return tn.call(E,k)}var V=Array.isArray||function(E){return re.call(E)==="[object Array]"};function Q(E){return new RegExp("^(?:"+E.replace(/ /g,"|")+")$")}var Le=function(k,H){this.line=k,this.column=H};Le.prototype.offset=function(k){return new Le(this.line,this.column+k)};var ht=function(k,H,F){this.start=H,this.end=F,k.sourceFile!==null&&(this.source=k.sourceFile)};function wt(E,k){for(var H=1,F=0;;){Dt.lastIndex=F;var le=Dt.exec(E);if(le&&le.index<k)++H,F=le.index+le[0].length;else return new Le(H,k-F)}}var er={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Tt(E){var k={};for(var H in er)k[H]=E&&Se(E,H)?E[H]:er[H];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),V(k.onToken)){var F=k.onToken;k.onToken=function(le){return F.push(le)}}return V(k.onComment)&&(k.onComment=vr(k,k.onComment)),k}function vr(E,k){return function(H,F,le,Ue,yt,Ot){var Nt={type:H?"Block":"Line",value:F,start:le,end:Ue};E.locations&&(Nt.loc=new ht(this,yt,Ot)),E.ranges&&(Nt.range=[le,Ue]),k.push(Nt)}}var ln=1,sn=2,Mi=ln|sn,vi=4,en=8,Oa=16,ra=32,Vi=64,ya=128;function fi(E,k){return sn|(E?vi:0)|(k?en:0)}var $i=0,hi=1,yi=2,ss=3,yo=4,qa=5,Ft=function(k,H,F){this.options=k=Tt(k),this.sourceFile=k.sourceFile,this.keywords=Q(Fe[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var le="";if(k.allowReserved!==!0){for(var Ue=k.ecmaVersion;!(le=ge[Ue]);Ue--);k.sourceType==="module"&&(le+=" await")}this.reservedWords=Q(le);var yt=(le?le+" ":"")+ge.strict;this.reservedWordsStrict=Q(yt),this.reservedWordsStrictBind=Q(yt+" "+ge.strictBind),this.input=String(H),this.containsEsc=!1,F?(this.pos=F,this.lineStart=this.input.lastIndexOf(`
`,F-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(yr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ie.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ln),this.regexpState=null},be={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ft.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},be.inFunction.get=function(){return(this.currentVarScope().flags&sn)>0},be.inGenerator.get=function(){return(this.currentVarScope().flags&en)>0},be.inAsync.get=function(){return(this.currentVarScope().flags&vi)>0},be.allowSuper.get=function(){return(this.currentThisScope().flags&Vi)>0},be.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ya)>0},be.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ft.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&sn)>0},Ft.extend=function(){for(var k=[],H=arguments.length;H--;)k[H]=arguments[H];for(var F=this,le=0;le<k.length;le++)F=k[le](F);return F},Ft.parse=function(k,H){return new this(H,k).parse()},Ft.parseExpressionAt=function(k,H,F){var le=new this(F,k,H);return le.nextToken(),le.parseExpression()},Ft.tokenizer=function(k,H){return new this(H,k)},Object.defineProperties(Ft.prototype,be);var he=Ft.prototype,Ie=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;he.strictDirective=function(E){for(;;){je.lastIndex=E,E+=je.exec(this.input)[0].length;var k=Ie.exec(this.input.slice(E));if(!k)return!1;if((k[1]||k[2])==="use strict"){je.lastIndex=E+k[0].length;var H=je.exec(this.input),F=H.index+H[0].length,le=this.input.charAt(F);return le===";"||le==="}"||yr.test(H[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(le)||le==="!"&&this.input.charAt(F+1)==="=")}E+=k[0].length,je.lastIndex=E,E+=je.exec(this.input)[0].length,this.input[E]===";"&&E++}},he.eat=function(E){return this.type===E?(this.next(),!0):!1},he.isContextual=function(E){return this.type===ie.name&&this.value===E&&!this.containsEsc},he.eatContextual=function(E){return this.isContextual(E)?(this.next(),!0):!1},he.expectContextual=function(E){this.eatContextual(E)||this.unexpected()},he.canInsertSemicolon=function(){return this.type===ie.eof||this.type===ie.braceR||yr.test(this.input.slice(this.lastTokEnd,this.start))},he.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},he.semicolon=function(){!this.eat(ie.semi)&&!this.insertSemicolon()&&this.unexpected()},he.afterTrailingComma=function(E,k){if(this.type===E)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},he.expect=function(E){this.eat(E)||this.unexpected()},he.unexpected=function(E){this.raise(E!=null?E:this.start,"Unexpected token")};function G(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}he.checkPatternErrors=function(E,k){if(!!E){E.trailingComma>-1&&this.raiseRecoverable(E.trailingComma,"Comma is not permitted after the rest element");var H=k?E.parenthesizedAssign:E.parenthesizedBind;H>-1&&this.raiseRecoverable(H,"Parenthesized pattern")}},he.checkExpressionErrors=function(E,k){if(!E)return!1;var H=E.shorthandAssign,F=E.doubleProto;if(!k)return H>=0||F>=0;H>=0&&this.raise(H,"Shorthand property assignments are valid only in destructuring patterns"),F>=0&&this.raiseRecoverable(F,"Redefinition of __proto__ property")},he.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},he.isSimpleAssignTarget=function(E){return E.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(E.expression):E.type==="Identifier"||E.type==="MemberExpression"};var lt=Ft.prototype;lt.parseTopLevel=function(E){var k={};for(E.body||(E.body=[]);this.type!==ie.eof;){var H=this.parseStatement(null,!0,k);E.body.push(H)}if(this.inModule)for(var F=0,le=Object.keys(this.undefinedExports);F<le.length;F+=1){var Ue=le[F];this.raiseRecoverable(this.undefinedExports[Ue].start,"Export '"+Ue+"' is not defined")}return this.adaptDirectivePrologue(E.body),this.next(),E.sourceType=this.options.sourceType,this.finishNode(E,"Program")};var sr={kind:"loop"},Jr={kind:"switch"};lt.isLet=function(E){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;je.lastIndex=this.pos;var k=je.exec(this.input),H=this.pos+k[0].length,F=this.input.charCodeAt(H);if(F===91)return!0;if(E)return!1;if(F===123)return!0;if(Et(F,!0)){for(var le=H+1;Vt(this.input.charCodeAt(le),!0);)++le;var Ue=this.input.slice(H,le);if(!K.test(Ue))return!0}return!1},lt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;je.lastIndex=this.pos;var E=je.exec(this.input),k=this.pos+E[0].length;return!yr.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!Vt(this.input.charAt(k+8)))},lt.parseStatement=function(E,k,H){var F=this.type,le=this.startNode(),Ue;switch(this.isLet(E)&&(F=ie._var,Ue="let"),F){case ie._break:case ie._continue:return this.parseBreakContinueStatement(le,F.keyword);case ie._debugger:return this.parseDebuggerStatement(le);case ie._do:return this.parseDoStatement(le);case ie._for:return this.parseForStatement(le);case ie._function:return E&&(this.strict||E!=="if"&&E!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(le,!1,!E);case ie._class:return E&&this.unexpected(),this.parseClass(le,!0);case ie._if:return this.parseIfStatement(le);case ie._return:return this.parseReturnStatement(le);case ie._switch:return this.parseSwitchStatement(le);case ie._throw:return this.parseThrowStatement(le);case ie._try:return this.parseTryStatement(le);case ie._const:case ie._var:return Ue=Ue||this.value,E&&Ue!=="var"&&this.unexpected(),this.parseVarStatement(le,Ue);case ie._while:return this.parseWhileStatement(le);case ie._with:return this.parseWithStatement(le);case ie.braceL:return this.parseBlock(!0,le);case ie.semi:return this.parseEmptyStatement(le);case ie._export:case ie._import:if(this.options.ecmaVersion>10&&F===ie._import){je.lastIndex=this.pos;var yt=je.exec(this.input),Ot=this.pos+yt[0].length,Nt=this.input.charCodeAt(Ot);if(Nt===40||Nt===46)return this.parseExpressionStatement(le,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),F===ie._import?this.parseImport(le):this.parseExport(le,H);default:if(this.isAsyncFunction())return E&&this.unexpected(),this.next(),this.parseFunctionStatement(le,!0,!E);var Br=this.value,Xr=this.parseExpression();return F===ie.name&&Xr.type==="Identifier"&&this.eat(ie.colon)?this.parseLabeledStatement(le,Br,Xr,E):this.parseExpressionStatement(le,Xr)}},lt.parseBreakContinueStatement=function(E,k){var H=k==="break";this.next(),this.eat(ie.semi)||this.insertSemicolon()?E.label=null:this.type!==ie.name?this.unexpected():(E.label=this.parseIdent(),this.semicolon());for(var F=0;F<this.labels.length;++F){var le=this.labels[F];if((E.label==null||le.name===E.label.name)&&(le.kind!=null&&(H||le.kind==="loop")||E.label&&H))break}return F===this.labels.length&&this.raise(E.start,"Unsyntactic "+k),this.finishNode(E,H?"BreakStatement":"ContinueStatement")},lt.parseDebuggerStatement=function(E){return this.next(),this.semicolon(),this.finishNode(E,"DebuggerStatement")},lt.parseDoStatement=function(E){return this.next(),this.labels.push(sr),E.body=this.parseStatement("do"),this.labels.pop(),this.expect(ie._while),E.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ie.semi):this.semicolon(),this.finishNode(E,"DoWhileStatement")},lt.parseForStatement=function(E){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(sr),this.enterScope(0),this.expect(ie.parenL),this.type===ie.semi)return k>-1&&this.unexpected(k),this.parseFor(E,null);var H=this.isLet();if(this.type===ie._var||this.type===ie._const||H){var F=this.startNode(),le=H?"let":this.value;return this.next(),this.parseVar(F,!0,le),this.finishNode(F,"VariableDeclaration"),(this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&F.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ie._in?k>-1&&this.unexpected(k):E.await=k>-1),this.parseForIn(E,F)):(k>-1&&this.unexpected(k),this.parseFor(E,F))}var Ue=new G,yt=this.parseExpression(!0,Ue);return this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ie._in?k>-1&&this.unexpected(k):E.await=k>-1),this.toAssignable(yt,!1,Ue),this.checkLVal(yt),this.parseForIn(E,yt)):(this.checkExpressionErrors(Ue,!0),k>-1&&this.unexpected(k),this.parseFor(E,yt))},lt.parseFunctionStatement=function(E,k,H){return this.next(),this.parseFunction(E,Gt|(H?0:Ar),!1,k)},lt.parseIfStatement=function(E){return this.next(),E.test=this.parseParenExpression(),E.consequent=this.parseStatement("if"),E.alternate=this.eat(ie._else)?this.parseStatement("if"):null,this.finishNode(E,"IfStatement")},lt.parseReturnStatement=function(E){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ie.semi)||this.insertSemicolon()?E.argument=null:(E.argument=this.parseExpression(),this.semicolon()),this.finishNode(E,"ReturnStatement")},lt.parseSwitchStatement=function(E){this.next(),E.discriminant=this.parseParenExpression(),E.cases=[],this.expect(ie.braceL),this.labels.push(Jr),this.enterScope(0);for(var k,H=!1;this.type!==ie.braceR;)if(this.type===ie._case||this.type===ie._default){var F=this.type===ie._case;k&&this.finishNode(k,"SwitchCase"),E.cases.push(k=this.startNode()),k.consequent=[],this.next(),F?k.test=this.parseExpression():(H&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),H=!0,k.test=null),this.expect(ie.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(E,"SwitchStatement")},lt.parseThrowStatement=function(E){return this.next(),yr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),E.argument=this.parseExpression(),this.semicolon(),this.finishNode(E,"ThrowStatement")};var nt=[];lt.parseTryStatement=function(E){if(this.next(),E.block=this.parseBlock(),E.handler=null,this.type===ie._catch){var k=this.startNode();if(this.next(),this.eat(ie.parenL)){k.param=this.parseBindingAtom();var H=k.param.type==="Identifier";this.enterScope(H?ra:0),this.checkLVal(k.param,H?yo:yi),this.expect(ie.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),E.handler=this.finishNode(k,"CatchClause")}return E.finalizer=this.eat(ie._finally)?this.parseBlock():null,!E.handler&&!E.finalizer&&this.raise(E.start,"Missing catch or finally clause"),this.finishNode(E,"TryStatement")},lt.parseVarStatement=function(E,k){return this.next(),this.parseVar(E,!1,k),this.semicolon(),this.finishNode(E,"VariableDeclaration")},lt.parseWhileStatement=function(E){return this.next(),E.test=this.parseParenExpression(),this.labels.push(sr),E.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(E,"WhileStatement")},lt.parseWithStatement=function(E){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),E.object=this.parseParenExpression(),E.body=this.parseStatement("with"),this.finishNode(E,"WithStatement")},lt.parseEmptyStatement=function(E){return this.next(),this.finishNode(E,"EmptyStatement")},lt.parseLabeledStatement=function(E,k,H,F){for(var le=0,Ue=this.labels;le<Ue.length;le+=1){var yt=Ue[le];yt.name===k&&this.raise(H.start,"Label '"+k+"' is already declared")}for(var Ot=this.type.isLoop?"loop":this.type===ie._switch?"switch":null,Nt=this.labels.length-1;Nt>=0;Nt--){var Br=this.labels[Nt];if(Br.statementStart===E.start)Br.statementStart=this.start,Br.kind=Ot;else break}return this.labels.push({name:k,kind:Ot,statementStart:this.start}),E.body=this.parseStatement(F?F.indexOf("label")===-1?F+"label":F:"label"),this.labels.pop(),E.label=H,this.finishNode(E,"LabeledStatement")},lt.parseExpressionStatement=function(E,k){return E.expression=k,this.semicolon(),this.finishNode(E,"ExpressionStatement")},lt.parseBlock=function(E,k,H){for(E===void 0&&(E=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(ie.braceL),E&&this.enterScope(0);this.type!==ie.braceR;){var F=this.parseStatement(null);k.body.push(F)}return H&&(this.strict=!1),this.next(),E&&this.exitScope(),this.finishNode(k,"BlockStatement")},lt.parseFor=function(E,k){return E.init=k,this.expect(ie.semi),E.test=this.type===ie.semi?null:this.parseExpression(),this.expect(ie.semi),E.update=this.type===ie.parenR?null:this.parseExpression(),this.expect(ie.parenR),E.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(E,"ForStatement")},lt.parseForIn=function(E,k){var H=this.type===ie._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!H||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(H?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),E.left=k,E.right=H?this.parseExpression():this.parseMaybeAssign(),this.expect(ie.parenR),E.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(E,H?"ForInStatement":"ForOfStatement")},lt.parseVar=function(E,k,H){for(E.declarations=[],E.kind=H;;){var F=this.startNode();if(this.parseVarId(F,H),this.eat(ie.eq)?F.init=this.parseMaybeAssign(k):H==="const"&&!(this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():F.id.type!=="Identifier"&&!(k&&(this.type===ie._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):F.init=null,E.declarations.push(this.finishNode(F,"VariableDeclarator")),!this.eat(ie.comma))break}return E},lt.parseVarId=function(E,k){E.id=this.parseBindingAtom(),this.checkLVal(E.id,k==="var"?hi:yi,!1)};var Gt=1,Ar=2,Tr=4;lt.parseFunction=function(E,k,H,F){this.initFunction(E),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!F)&&(this.type===ie.star&&k&Ar&&this.unexpected(),E.generator=this.eat(ie.star)),this.options.ecmaVersion>=8&&(E.async=!!F),k&Gt&&(E.id=k&Tr&&this.type!==ie.name?null:this.parseIdent(),E.id&&!(k&Ar)&&this.checkLVal(E.id,this.strict||E.generator||E.async?this.treatFunctionsAsVar?hi:yi:ss));var le=this.yieldPos,Ue=this.awaitPos,yt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fi(E.async,E.generator)),k&Gt||(E.id=this.type===ie.name?this.parseIdent():null),this.parseFunctionParams(E),this.parseFunctionBody(E,H,!1),this.yieldPos=le,this.awaitPos=Ue,this.awaitIdentPos=yt,this.finishNode(E,k&Gt?"FunctionDeclaration":"FunctionExpression")},lt.parseFunctionParams=function(E){this.expect(ie.parenL),E.params=this.parseBindingList(ie.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},lt.parseClass=function(E,k){this.next();var H=this.strict;this.strict=!0,this.parseClassId(E,k),this.parseClassSuper(E);var F=this.startNode(),le=!1;for(F.body=[],this.expect(ie.braceL);this.type!==ie.braceR;){var Ue=this.parseClassElement(E.superClass!==null);Ue&&(F.body.push(Ue),Ue.type==="MethodDefinition"&&Ue.kind==="constructor"&&(le&&this.raise(Ue.start,"Duplicate constructor in the same class"),le=!0))}return this.strict=H,this.next(),E.body=this.finishNode(F,"ClassBody"),this.finishNode(E,k?"ClassDeclaration":"ClassExpression")},lt.parseClassElement=function(E){var k=this;if(this.eat(ie.semi))return null;var H=this.startNode(),F=function(Nt,Br){Br===void 0&&(Br=!1);var Xr=k.start,Jn=k.startLoc;return k.eatContextual(Nt)?k.type!==ie.parenL&&(!Br||!k.canInsertSemicolon())?!0:(H.key&&k.unexpected(),H.computed=!1,H.key=k.startNodeAt(Xr,Jn),H.key.name=Nt,k.finishNode(H.key,"Identifier"),!1):!1};H.kind="method",H.static=F("static");var le=this.eat(ie.star),Ue=!1;le||(this.options.ecmaVersion>=8&&F("async",!0)?(Ue=!0,le=this.options.ecmaVersion>=9&&this.eat(ie.star)):F("get")?H.kind="get":F("set")&&(H.kind="set")),H.key||this.parsePropertyName(H);var yt=H.key,Ot=!1;return!H.computed&&!H.static&&(yt.type==="Identifier"&&yt.name==="constructor"||yt.type==="Literal"&&yt.value==="constructor")?(H.kind!=="method"&&this.raise(yt.start,"Constructor can't have get/set modifier"),le&&this.raise(yt.start,"Constructor can't be a generator"),Ue&&this.raise(yt.start,"Constructor can't be an async method"),H.kind="constructor",Ot=E):H.static&&yt.type==="Identifier"&&yt.name==="prototype"&&this.raise(yt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(H,le,Ue,Ot),H.kind==="get"&&H.value.params.length!==0&&this.raiseRecoverable(H.value.start,"getter should have no params"),H.kind==="set"&&H.value.params.length!==1&&this.raiseRecoverable(H.value.start,"setter should have exactly one param"),H.kind==="set"&&H.value.params[0].type==="RestElement"&&this.raiseRecoverable(H.value.params[0].start,"Setter cannot use rest params"),H},lt.parseClassMethod=function(E,k,H,F){return E.value=this.parseMethod(k,H,F),this.finishNode(E,"MethodDefinition")},lt.parseClassId=function(E,k){this.type===ie.name?(E.id=this.parseIdent(),k&&this.checkLVal(E.id,yi,!1)):(k===!0&&this.unexpected(),E.id=null)},lt.parseClassSuper=function(E){E.superClass=this.eat(ie._extends)?this.parseExprSubscripts():null},lt.parseExport=function(E,k){if(this.next(),this.eat(ie.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(E.exported=this.parseIdent(!0),this.checkExport(k,E.exported.name,this.lastTokStart)):E.exported=null),this.expectContextual("from"),this.type!==ie.string&&this.unexpected(),E.source=this.parseExprAtom(),this.semicolon(),this.finishNode(E,"ExportAllDeclaration");if(this.eat(ie._default)){this.checkExport(k,"default",this.lastTokStart);var H;if(this.type===ie._function||(H=this.isAsyncFunction())){var F=this.startNode();this.next(),H&&this.next(),E.declaration=this.parseFunction(F,Gt|Tr,!1,H)}else if(this.type===ie._class){var le=this.startNode();E.declaration=this.parseClass(le,"nullableID")}else E.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(E,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())E.declaration=this.parseStatement(null),E.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,E.declaration.declarations):this.checkExport(k,E.declaration.id.name,E.declaration.id.start),E.specifiers=[],E.source=null;else{if(E.declaration=null,E.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==ie.string&&this.unexpected(),E.source=this.parseExprAtom();else{for(var Ue=0,yt=E.specifiers;Ue<yt.length;Ue+=1){var Ot=yt[Ue];this.checkUnreserved(Ot.local),this.checkLocalExport(Ot.local)}E.source=null}this.semicolon()}return this.finishNode(E,"ExportNamedDeclaration")},lt.checkExport=function(E,k,H){!E||(Se(E,k)&&this.raiseRecoverable(H,"Duplicate export '"+k+"'"),E[k]=!0)},lt.checkPatternExport=function(E,k){var H=k.type;if(H==="Identifier")this.checkExport(E,k.name,k.start);else if(H==="ObjectPattern")for(var F=0,le=k.properties;F<le.length;F+=1){var Ue=le[F];this.checkPatternExport(E,Ue)}else if(H==="ArrayPattern")for(var yt=0,Ot=k.elements;yt<Ot.length;yt+=1){var Nt=Ot[yt];Nt&&this.checkPatternExport(E,Nt)}else H==="Property"?this.checkPatternExport(E,k.value):H==="AssignmentPattern"?this.checkPatternExport(E,k.left):H==="RestElement"?this.checkPatternExport(E,k.argument):H==="ParenthesizedExpression"&&this.checkPatternExport(E,k.expression)},lt.checkVariableExport=function(E,k){if(!!E)for(var H=0,F=k;H<F.length;H+=1){var le=F[H];this.checkPatternExport(E,le.id)}},lt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},lt.parseExportSpecifiers=function(E){var k=[],H=!0;for(this.expect(ie.braceL);!this.eat(ie.braceR);){if(H)H=!1;else if(this.expect(ie.comma),this.afterTrailingComma(ie.braceR))break;var F=this.startNode();F.local=this.parseIdent(!0),F.exported=this.eatContextual("as")?this.parseIdent(!0):F.local,this.checkExport(E,F.exported.name,F.exported.start),k.push(this.finishNode(F,"ExportSpecifier"))}return k},lt.parseImport=function(E){return this.next(),this.type===ie.string?(E.specifiers=nt,E.source=this.parseExprAtom()):(E.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),E.source=this.type===ie.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(E,"ImportDeclaration")},lt.parseImportSpecifiers=function(){var E=[],k=!0;if(this.type===ie.name){var H=this.startNode();if(H.local=this.parseIdent(),this.checkLVal(H.local,yi),E.push(this.finishNode(H,"ImportDefaultSpecifier")),!this.eat(ie.comma))return E}if(this.type===ie.star){var F=this.startNode();return this.next(),this.expectContextual("as"),F.local=this.parseIdent(),this.checkLVal(F.local,yi),E.push(this.finishNode(F,"ImportNamespaceSpecifier")),E}for(this.expect(ie.braceL);!this.eat(ie.braceR);){if(k)k=!1;else if(this.expect(ie.comma),this.afterTrailingComma(ie.braceR))break;var le=this.startNode();le.imported=this.parseIdent(!0),this.eatContextual("as")?le.local=this.parseIdent():(this.checkUnreserved(le.imported),le.local=le.imported),this.checkLVal(le.local,yi),E.push(this.finishNode(le,"ImportSpecifier"))}return E},lt.adaptDirectivePrologue=function(E){for(var k=0;k<E.length&&this.isDirectiveCandidate(E[k]);++k)E[k].directive=E[k].expression.raw.slice(1,-1)},lt.isDirectiveCandidate=function(E){return E.type==="ExpressionStatement"&&E.expression.type==="Literal"&&typeof E.expression.value=="string"&&(this.input[E.start]==='"'||this.input[E.start]==="'")};var Rr=Ft.prototype;Rr.toAssignable=function(E,k,H){if(this.options.ecmaVersion>=6&&E)switch(E.type){case"Identifier":this.inAsync&&E.name==="await"&&this.raise(E.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":E.type="ObjectPattern",H&&this.checkPatternErrors(H,!0);for(var F=0,le=E.properties;F<le.length;F+=1){var Ue=le[F];this.toAssignable(Ue,k),Ue.type==="RestElement"&&(Ue.argument.type==="ArrayPattern"||Ue.argument.type==="ObjectPattern")&&this.raise(Ue.argument.start,"Unexpected token")}break;case"Property":E.kind!=="init"&&this.raise(E.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(E.value,k);break;case"ArrayExpression":E.type="ArrayPattern",H&&this.checkPatternErrors(H,!0),this.toAssignableList(E.elements,k);break;case"SpreadElement":E.type="RestElement",this.toAssignable(E.argument,k),E.argument.type==="AssignmentPattern"&&this.raise(E.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":E.operator!=="="&&this.raise(E.left.end,"Only '=' operator can be used for specifying default value."),E.type="AssignmentPattern",delete E.operator,this.toAssignable(E.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(E.expression,k,H);break;case"ChainExpression":this.raiseRecoverable(E.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(E.start,"Assigning to rvalue")}else H&&this.checkPatternErrors(H,!0);return E},Rr.toAssignableList=function(E,k){for(var H=E.length,F=0;F<H;F++){var le=E[F];le&&this.toAssignable(le,k)}if(H){var Ue=E[H-1];this.options.ecmaVersion===6&&k&&Ue&&Ue.type==="RestElement"&&Ue.argument.type!=="Identifier"&&this.unexpected(Ue.argument.start)}return E},Rr.parseSpread=function(E){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,E),this.finishNode(k,"SpreadElement")},Rr.parseRestBinding=function(){var E=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ie.name&&this.unexpected(),E.argument=this.parseBindingAtom(),this.finishNode(E,"RestElement")},Rr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ie.bracketL:var E=this.startNode();return this.next(),E.elements=this.parseBindingList(ie.bracketR,!0,!0),this.finishNode(E,"ArrayPattern");case ie.braceL:return this.parseObj(!0)}return this.parseIdent()},Rr.parseBindingList=function(E,k,H){for(var F=[],le=!0;!this.eat(E);)if(le?le=!1:this.expect(ie.comma),k&&this.type===ie.comma)F.push(null);else{if(H&&this.afterTrailingComma(E))break;if(this.type===ie.ellipsis){var Ue=this.parseRestBinding();this.parseBindingListItem(Ue),F.push(Ue),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(E);break}else{var yt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(yt),F.push(yt)}}return F},Rr.parseBindingListItem=function(E){return E},Rr.parseMaybeDefault=function(E,k,H){if(H=H||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ie.eq))return H;var F=this.startNodeAt(E,k);return F.left=H,F.right=this.parseMaybeAssign(),this.finishNode(F,"AssignmentPattern")},Rr.checkLVal=function(E,k,H){switch(k===void 0&&(k=$i),E.type){case"Identifier":k===yi&&E.name==="let"&&this.raiseRecoverable(E.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(E.name)&&this.raiseRecoverable(E.start,(k?"Binding ":"Assigning to ")+E.name+" in strict mode"),H&&(Se(H,E.name)&&this.raiseRecoverable(E.start,"Argument name clash"),H[E.name]=!0),k!==$i&&k!==qa&&this.declareName(E.name,k,E.start);break;case"ChainExpression":this.raiseRecoverable(E.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(E.start,"Binding member expression");break;case"ObjectPattern":for(var F=0,le=E.properties;F<le.length;F+=1){var Ue=le[F];this.checkLVal(Ue,k,H)}break;case"Property":this.checkLVal(E.value,k,H);break;case"ArrayPattern":for(var yt=0,Ot=E.elements;yt<Ot.length;yt+=1){var Nt=Ot[yt];Nt&&this.checkLVal(Nt,k,H)}break;case"AssignmentPattern":this.checkLVal(E.left,k,H);break;case"RestElement":this.checkLVal(E.argument,k,H);break;case"ParenthesizedExpression":this.checkLVal(E.expression,k,H);break;default:this.raise(E.start,(k?"Binding":"Assigning to")+" rvalue")}};var mn=Ft.prototype;mn.checkPropClash=function(E,k,H){if(!(this.options.ecmaVersion>=9&&E.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(E.computed||E.method||E.shorthand))){var F=E.key,le;switch(F.type){case"Identifier":le=F.name;break;case"Literal":le=String(F.value);break;default:return}var Ue=E.kind;if(this.options.ecmaVersion>=6){le==="__proto__"&&Ue==="init"&&(k.proto&&(H?H.doubleProto<0&&(H.doubleProto=F.start):this.raiseRecoverable(F.start,"Redefinition of __proto__ property")),k.proto=!0);return}le="$"+le;var yt=k[le];if(yt){var Ot;Ue==="init"?Ot=this.strict&&yt.init||yt.get||yt.set:Ot=yt.init||yt[Ue],Ot&&this.raiseRecoverable(F.start,"Redefinition of property")}else yt=k[le]={init:!1,get:!1,set:!1};yt[Ue]=!0}},mn.parseExpression=function(E,k){var H=this.start,F=this.startLoc,le=this.parseMaybeAssign(E,k);if(this.type===ie.comma){var Ue=this.startNodeAt(H,F);for(Ue.expressions=[le];this.eat(ie.comma);)Ue.expressions.push(this.parseMaybeAssign(E,k));return this.finishNode(Ue,"SequenceExpression")}return le},mn.parseMaybeAssign=function(E,k,H){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(E);this.exprAllowed=!1}var F=!1,le=-1,Ue=-1;k?(le=k.parenthesizedAssign,Ue=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new G,F=!0);var yt=this.start,Ot=this.startLoc;(this.type===ie.parenL||this.type===ie.name)&&(this.potentialArrowAt=this.start);var Nt=this.parseMaybeConditional(E,k);if(H&&(Nt=H.call(this,Nt,yt,Ot)),this.type.isAssign){var Br=this.startNodeAt(yt,Ot);return Br.operator=this.value,Br.left=this.type===ie.eq?this.toAssignable(Nt,!1,k):Nt,F||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=Br.left.start&&(k.shorthandAssign=-1),this.checkLVal(Nt),this.next(),Br.right=this.parseMaybeAssign(E),this.finishNode(Br,"AssignmentExpression")}else F&&this.checkExpressionErrors(k,!0);return le>-1&&(k.parenthesizedAssign=le),Ue>-1&&(k.trailingComma=Ue),Nt},mn.parseMaybeConditional=function(E,k){var H=this.start,F=this.startLoc,le=this.parseExprOps(E,k);if(this.checkExpressionErrors(k))return le;if(this.eat(ie.question)){var Ue=this.startNodeAt(H,F);return Ue.test=le,Ue.consequent=this.parseMaybeAssign(),this.expect(ie.colon),Ue.alternate=this.parseMaybeAssign(E),this.finishNode(Ue,"ConditionalExpression")}return le},mn.parseExprOps=function(E,k){var H=this.start,F=this.startLoc,le=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||le.start===H&&le.type==="ArrowFunctionExpression"?le:this.parseExprOp(le,H,F,-1,E)},mn.parseExprOp=function(E,k,H,F,le){var Ue=this.type.binop;if(Ue!=null&&(!le||this.type!==ie._in)&&Ue>F){var yt=this.type===ie.logicalOR||this.type===ie.logicalAND,Ot=this.type===ie.coalesce;Ot&&(Ue=ie.logicalAND.binop);var Nt=this.value;this.next();var Br=this.start,Xr=this.startLoc,Jn=this.parseExprOp(this.parseMaybeUnary(null,!1),Br,Xr,Ue,le),Ki=this.buildBinary(k,H,E,Jn,Nt,yt||Ot);return(yt&&this.type===ie.coalesce||Ot&&(this.type===ie.logicalOR||this.type===ie.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ki,k,H,F,le)}return E},mn.buildBinary=function(E,k,H,F,le,Ue){var yt=this.startNodeAt(E,k);return yt.left=H,yt.operator=le,yt.right=F,this.finishNode(yt,Ue?"LogicalExpression":"BinaryExpression")},mn.parseMaybeUnary=function(E,k){var H=this.start,F=this.startLoc,le;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))le=this.parseAwait(),k=!0;else if(this.type.prefix){var Ue=this.startNode(),yt=this.type===ie.incDec;Ue.operator=this.value,Ue.prefix=!0,this.next(),Ue.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(E,!0),yt?this.checkLVal(Ue.argument):this.strict&&Ue.operator==="delete"&&Ue.argument.type==="Identifier"?this.raiseRecoverable(Ue.start,"Deleting local variable in strict mode"):k=!0,le=this.finishNode(Ue,yt?"UpdateExpression":"UnaryExpression")}else{if(le=this.parseExprSubscripts(E),this.checkExpressionErrors(E))return le;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ot=this.startNodeAt(H,F);Ot.operator=this.value,Ot.prefix=!1,Ot.argument=le,this.checkLVal(le),this.next(),le=this.finishNode(Ot,"UpdateExpression")}}return!k&&this.eat(ie.starstar)?this.buildBinary(H,F,le,this.parseMaybeUnary(null,!1),"**",!1):le},mn.parseExprSubscripts=function(E){var k=this.start,H=this.startLoc,F=this.parseExprAtom(E);if(F.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return F;var le=this.parseSubscripts(F,k,H);return E&&le.type==="MemberExpression"&&(E.parenthesizedAssign>=le.start&&(E.parenthesizedAssign=-1),E.parenthesizedBind>=le.start&&(E.parenthesizedBind=-1)),le},mn.parseSubscripts=function(E,k,H,F){for(var le=this.options.ecmaVersion>=8&&E.type==="Identifier"&&E.name==="async"&&this.lastTokEnd===E.end&&!this.canInsertSemicolon()&&E.end-E.start==5&&this.potentialArrowAt===E.start,Ue=!1;;){var yt=this.parseSubscript(E,k,H,F,le,Ue);if(yt.optional&&(Ue=!0),yt===E||yt.type==="ArrowFunctionExpression"){if(Ue){var Ot=this.startNodeAt(k,H);Ot.expression=yt,yt=this.finishNode(Ot,"ChainExpression")}return yt}E=yt}},mn.parseSubscript=function(E,k,H,F,le,Ue){var yt=this.options.ecmaVersion>=11,Ot=yt&&this.eat(ie.questionDot);F&&Ot&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Nt=this.eat(ie.bracketL);if(Nt||Ot&&this.type!==ie.parenL&&this.type!==ie.backQuote||this.eat(ie.dot)){var Br=this.startNodeAt(k,H);Br.object=E,Br.property=Nt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Br.computed=!!Nt,Nt&&this.expect(ie.bracketR),yt&&(Br.optional=Ot),E=this.finishNode(Br,"MemberExpression")}else if(!F&&this.eat(ie.parenL)){var Xr=new G,Jn=this.yieldPos,Ki=this.awaitPos,ji=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ha=this.parseExprList(ie.parenR,this.options.ecmaVersion>=8,!1,Xr);if(le&&!Ot&&!this.canInsertSemicolon()&&this.eat(ie.arrow))return this.checkPatternErrors(Xr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Jn,this.awaitPos=Ki,this.awaitIdentPos=ji,this.parseArrowExpression(this.startNodeAt(k,H),ha,!0);this.checkExpressionErrors(Xr,!0),this.yieldPos=Jn||this.yieldPos,this.awaitPos=Ki||this.awaitPos,this.awaitIdentPos=ji||this.awaitIdentPos;var Ka=this.startNodeAt(k,H);Ka.callee=E,Ka.arguments=ha,yt&&(Ka.optional=Ot),E=this.finishNode(Ka,"CallExpression")}else if(this.type===ie.backQuote){(Ot||Ue)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var xo=this.startNodeAt(k,H);xo.tag=E,xo.quasi=this.parseTemplate({isTagged:!0}),E=this.finishNode(xo,"TaggedTemplateExpression")}return E},mn.parseExprAtom=function(E){this.type===ie.slash&&this.readRegexp();var k,H=this.potentialArrowAt===this.start;switch(this.type){case ie._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===ie.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==ie.dot&&this.type!==ie.bracketL&&this.type!==ie.parenL&&this.unexpected(),this.finishNode(k,"Super");case ie._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case ie.name:var F=this.start,le=this.startLoc,Ue=this.containsEsc,yt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ue&&yt.name==="async"&&!this.canInsertSemicolon()&&this.eat(ie._function))return this.parseFunction(this.startNodeAt(F,le),0,!1,!0);if(H&&!this.canInsertSemicolon()){if(this.eat(ie.arrow))return this.parseArrowExpression(this.startNodeAt(F,le),[yt],!1);if(this.options.ecmaVersion>=8&&yt.name==="async"&&this.type===ie.name&&!Ue)return yt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ie.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(F,le),[yt],!0)}return yt;case ie.regexp:var Ot=this.value;return k=this.parseLiteral(Ot.value),k.regex={pattern:Ot.pattern,flags:Ot.flags},k;case ie.num:case ie.string:return this.parseLiteral(this.value);case ie._null:case ie._true:case ie._false:return k=this.startNode(),k.value=this.type===ie._null?null:this.type===ie._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case ie.parenL:var Nt=this.start,Br=this.parseParenAndDistinguishExpression(H);return E&&(E.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Br)&&(E.parenthesizedAssign=Nt),E.parenthesizedBind<0&&(E.parenthesizedBind=Nt)),Br;case ie.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(ie.bracketR,!0,!0,E),this.finishNode(k,"ArrayExpression");case ie.braceL:return this.parseObj(!1,E);case ie._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case ie._class:return this.parseClass(this.startNode(),!1);case ie._new:return this.parseNew();case ie.backQuote:return this.parseTemplate();case ie._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},mn.parseExprImport=function(){var E=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case ie.parenL:return this.parseDynamicImport(E);case ie.dot:return E.meta=k,this.parseImportMeta(E);default:this.unexpected()}},mn.parseDynamicImport=function(E){if(this.next(),E.source=this.parseMaybeAssign(),!this.eat(ie.parenR)){var k=this.start;this.eat(ie.comma)&&this.eat(ie.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(E,"ImportExpression")},mn.parseImportMeta=function(E){this.next();var k=this.containsEsc;return E.property=this.parseIdent(!0),E.property.name!=="meta"&&this.raiseRecoverable(E.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(E.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(E.start,"Cannot use 'import.meta' outside a module"),this.finishNode(E,"MetaProperty")},mn.parseLiteral=function(E){var k=this.startNode();return k.value=E,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},mn.parseParenExpression=function(){this.expect(ie.parenL);var E=this.parseExpression();return this.expect(ie.parenR),E},mn.parseParenAndDistinguishExpression=function(E){var k=this.start,H=this.startLoc,F,le=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ue=this.start,yt=this.startLoc,Ot=[],Nt=!0,Br=!1,Xr=new G,Jn=this.yieldPos,Ki=this.awaitPos,ji;for(this.yieldPos=0,this.awaitPos=0;this.type!==ie.parenR;)if(Nt?Nt=!1:this.expect(ie.comma),le&&this.afterTrailingComma(ie.parenR,!0)){Br=!0;break}else if(this.type===ie.ellipsis){ji=this.start,Ot.push(this.parseParenItem(this.parseRestBinding())),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Ot.push(this.parseMaybeAssign(!1,Xr,this.parseParenItem));var ha=this.start,Ka=this.startLoc;if(this.expect(ie.parenR),E&&!this.canInsertSemicolon()&&this.eat(ie.arrow))return this.checkPatternErrors(Xr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Jn,this.awaitPos=Ki,this.parseParenArrowList(k,H,Ot);(!Ot.length||Br)&&this.unexpected(this.lastTokStart),ji&&this.unexpected(ji),this.checkExpressionErrors(Xr,!0),this.yieldPos=Jn||this.yieldPos,this.awaitPos=Ki||this.awaitPos,Ot.length>1?(F=this.startNodeAt(Ue,yt),F.expressions=Ot,this.finishNodeAt(F,"SequenceExpression",ha,Ka)):F=Ot[0]}else F=this.parseParenExpression();if(this.options.preserveParens){var xo=this.startNodeAt(k,H);return xo.expression=F,this.finishNode(xo,"ParenthesizedExpression")}else return F},mn.parseParenItem=function(E){return E},mn.parseParenArrowList=function(E,k,H){return this.parseArrowExpression(this.startNodeAt(E,k),H)};var mi=[];mn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var E=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ie.dot)){E.meta=k;var H=this.containsEsc;return E.property=this.parseIdent(!0),E.property.name!=="target"&&this.raiseRecoverable(E.property.start,"The only valid meta property for new is 'new.target'"),H&&this.raiseRecoverable(E.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(E.start,"'new.target' can only be used in functions"),this.finishNode(E,"MetaProperty")}var F=this.start,le=this.startLoc,Ue=this.type===ie._import;return E.callee=this.parseSubscripts(this.parseExprAtom(),F,le,!0),Ue&&E.callee.type==="ImportExpression"&&this.raise(F,"Cannot use new with import()"),this.eat(ie.parenL)?E.arguments=this.parseExprList(ie.parenR,this.options.ecmaVersion>=8,!1):E.arguments=mi,this.finishNode(E,"NewExpression")},mn.parseTemplateElement=function(E){var k=E.isTagged,H=this.startNode();return this.type===ie.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),H.value={raw:this.value,cooked:null}):H.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),H.tail=this.type===ie.backQuote,this.finishNode(H,"TemplateElement")},mn.parseTemplate=function(E){E===void 0&&(E={});var k=E.isTagged;k===void 0&&(k=!1);var H=this.startNode();this.next(),H.expressions=[];var F=this.parseTemplateElement({isTagged:k});for(H.quasis=[F];!F.tail;)this.type===ie.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ie.dollarBraceL),H.expressions.push(this.parseExpression()),this.expect(ie.braceR),H.quasis.push(F=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(H,"TemplateLiteral")},mn.isAsyncProp=function(E){return!E.computed&&E.key.type==="Identifier"&&E.key.name==="async"&&(this.type===ie.name||this.type===ie.num||this.type===ie.string||this.type===ie.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ie.star)&&!yr.test(this.input.slice(this.lastTokEnd,this.start))},mn.parseObj=function(E,k){var H=this.startNode(),F=!0,le={};for(H.properties=[],this.next();!this.eat(ie.braceR);){if(F)F=!1;else if(this.expect(ie.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ie.braceR))break;var Ue=this.parseProperty(E,k);E||this.checkPropClash(Ue,le,k),H.properties.push(Ue)}return this.finishNode(H,E?"ObjectPattern":"ObjectExpression")},mn.parseProperty=function(E,k){var H=this.startNode(),F,le,Ue,yt;if(this.options.ecmaVersion>=9&&this.eat(ie.ellipsis))return E?(H.argument=this.parseIdent(!1),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(H,"RestElement")):(this.type===ie.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),H.argument=this.parseMaybeAssign(!1,k),this.type===ie.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(H,"SpreadElement"));this.options.ecmaVersion>=6&&(H.method=!1,H.shorthand=!1,(E||k)&&(Ue=this.start,yt=this.startLoc),E||(F=this.eat(ie.star)));var Ot=this.containsEsc;return this.parsePropertyName(H),!E&&!Ot&&this.options.ecmaVersion>=8&&!F&&this.isAsyncProp(H)?(le=!0,F=this.options.ecmaVersion>=9&&this.eat(ie.star),this.parsePropertyName(H,k)):le=!1,this.parsePropertyValue(H,E,F,le,Ue,yt,k,Ot),this.finishNode(H,"Property")},mn.parsePropertyValue=function(E,k,H,F,le,Ue,yt,Ot){if((H||F)&&this.type===ie.colon&&this.unexpected(),this.eat(ie.colon))E.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,yt),E.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ie.parenL)k&&this.unexpected(),E.kind="init",E.method=!0,E.value=this.parseMethod(H,F);else if(!k&&!Ot&&this.options.ecmaVersion>=5&&!E.computed&&E.key.type==="Identifier"&&(E.key.name==="get"||E.key.name==="set")&&this.type!==ie.comma&&this.type!==ie.braceR&&this.type!==ie.eq){(H||F)&&this.unexpected(),E.kind=E.key.name,this.parsePropertyName(E),E.value=this.parseMethod(!1);var Nt=E.kind==="get"?0:1;if(E.value.params.length!==Nt){var Br=E.value.start;E.kind==="get"?this.raiseRecoverable(Br,"getter should have no params"):this.raiseRecoverable(Br,"setter should have exactly one param")}else E.kind==="set"&&E.value.params[0].type==="RestElement"&&this.raiseRecoverable(E.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!E.computed&&E.key.type==="Identifier"?((H||F)&&this.unexpected(),this.checkUnreserved(E.key),E.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=le),E.kind="init",k?E.value=this.parseMaybeDefault(le,Ue,E.key):this.type===ie.eq&&yt?(yt.shorthandAssign<0&&(yt.shorthandAssign=this.start),E.value=this.parseMaybeDefault(le,Ue,E.key)):E.value=E.key,E.shorthand=!0):this.unexpected()},mn.parsePropertyName=function(E){if(this.options.ecmaVersion>=6){if(this.eat(ie.bracketL))return E.computed=!0,E.key=this.parseMaybeAssign(),this.expect(ie.bracketR),E.key;E.computed=!1}return E.key=this.type===ie.num||this.type===ie.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},mn.initFunction=function(E){E.id=null,this.options.ecmaVersion>=6&&(E.generator=E.expression=!1),this.options.ecmaVersion>=8&&(E.async=!1)},mn.parseMethod=function(E,k,H){var F=this.startNode(),le=this.yieldPos,Ue=this.awaitPos,yt=this.awaitIdentPos;return this.initFunction(F),this.options.ecmaVersion>=6&&(F.generator=E),this.options.ecmaVersion>=8&&(F.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fi(k,F.generator)|Vi|(H?ya:0)),this.expect(ie.parenL),F.params=this.parseBindingList(ie.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(F,!1,!0),this.yieldPos=le,this.awaitPos=Ue,this.awaitIdentPos=yt,this.finishNode(F,"FunctionExpression")},mn.parseArrowExpression=function(E,k,H){var F=this.yieldPos,le=this.awaitPos,Ue=this.awaitIdentPos;return this.enterScope(fi(H,!1)|Oa),this.initFunction(E),this.options.ecmaVersion>=8&&(E.async=!!H),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,E.params=this.toAssignableList(k,!0),this.parseFunctionBody(E,!0,!1),this.yieldPos=F,this.awaitPos=le,this.awaitIdentPos=Ue,this.finishNode(E,"ArrowFunctionExpression")},mn.parseFunctionBody=function(E,k,H){var F=k&&this.type!==ie.braceL,le=this.strict,Ue=!1;if(F)E.body=this.parseMaybeAssign(),E.expression=!0,this.checkParams(E,!1);else{var yt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(E.params);(!le||yt)&&(Ue=this.strictDirective(this.end),Ue&&yt&&this.raiseRecoverable(E.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ot=this.labels;this.labels=[],Ue&&(this.strict=!0),this.checkParams(E,!le&&!Ue&&!k&&!H&&this.isSimpleParamList(E.params)),this.strict&&E.id&&this.checkLVal(E.id,qa),E.body=this.parseBlock(!1,void 0,Ue&&!le),E.expression=!1,this.adaptDirectivePrologue(E.body.body),this.labels=Ot}this.exitScope()},mn.isSimpleParamList=function(E){for(var k=0,H=E;k<H.length;k+=1){var F=H[k];if(F.type!=="Identifier")return!1}return!0},mn.checkParams=function(E,k){for(var H={},F=0,le=E.params;F<le.length;F+=1){var Ue=le[F];this.checkLVal(Ue,hi,k?null:H)}},mn.parseExprList=function(E,k,H,F){for(var le=[],Ue=!0;!this.eat(E);){if(Ue)Ue=!1;else if(this.expect(ie.comma),k&&this.afterTrailingComma(E))break;var yt=void 0;H&&this.type===ie.comma?yt=null:this.type===ie.ellipsis?(yt=this.parseSpread(F),F&&this.type===ie.comma&&F.trailingComma<0&&(F.trailingComma=this.start)):yt=this.parseMaybeAssign(!1,F),le.push(yt)}return le},mn.checkUnreserved=function(E){var k=E.start,H=E.end,F=E.name;if(this.inGenerator&&F==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&F==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(F)&&this.raise(k,"Unexpected keyword '"+F+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,H).indexOf("\\")!==-1)){var le=this.strict?this.reservedWordsStrict:this.reservedWords;le.test(F)&&(!this.inAsync&&F==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+F+"' is reserved"))}},mn.parseIdent=function(E,k){var H=this.startNode();return this.type===ie.name?H.name=this.value:this.type.keyword?(H.name=this.type.keyword,(H.name==="class"||H.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!E),this.finishNode(H,"Identifier"),E||(this.checkUnreserved(H),H.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=H.start)),H},mn.parseYield=function(E){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===ie.semi||this.canInsertSemicolon()||this.type!==ie.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(ie.star),k.argument=this.parseMaybeAssign(E)),this.finishNode(k,"YieldExpression")},mn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var E=this.startNode();return this.next(),E.argument=this.parseMaybeUnary(null,!1),this.finishNode(E,"AwaitExpression")};var ai=Ft.prototype;ai.raise=function(E,k){var H=wt(this.input,E);k+=" ("+H.line+":"+H.column+")";var F=new SyntaxError(k);throw F.pos=E,F.loc=H,F.raisedAt=this.pos,F},ai.raiseRecoverable=ai.raise,ai.curPosition=function(){if(this.options.locations)return new Le(this.curLine,this.pos-this.lineStart)};var Tn=Ft.prototype,Ri=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};Tn.enterScope=function(E){this.scopeStack.push(new Ri(E))},Tn.exitScope=function(){this.scopeStack.pop()},Tn.treatFunctionsAsVarInScope=function(E){return E.flags&sn||!this.inModule&&E.flags&ln},Tn.declareName=function(E,k,H){var F=!1;if(k===yi){var le=this.currentScope();F=le.lexical.indexOf(E)>-1||le.functions.indexOf(E)>-1||le.var.indexOf(E)>-1,le.lexical.push(E),this.inModule&&le.flags&ln&&delete this.undefinedExports[E]}else if(k===yo){var Ue=this.currentScope();Ue.lexical.push(E)}else if(k===ss){var yt=this.currentScope();this.treatFunctionsAsVar?F=yt.lexical.indexOf(E)>-1:F=yt.lexical.indexOf(E)>-1||yt.var.indexOf(E)>-1,yt.functions.push(E)}else for(var Ot=this.scopeStack.length-1;Ot>=0;--Ot){var Nt=this.scopeStack[Ot];if(Nt.lexical.indexOf(E)>-1&&!(Nt.flags&ra&&Nt.lexical[0]===E)||!this.treatFunctionsAsVarInScope(Nt)&&Nt.functions.indexOf(E)>-1){F=!0;break}if(Nt.var.push(E),this.inModule&&Nt.flags&ln&&delete this.undefinedExports[E],Nt.flags&Mi)break}F&&this.raiseRecoverable(H,"Identifier '"+E+"' has already been declared")},Tn.checkLocalExport=function(E){this.scopeStack[0].lexical.indexOf(E.name)===-1&&this.scopeStack[0].var.indexOf(E.name)===-1&&(this.undefinedExports[E.name]=E)},Tn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Tn.currentVarScope=function(){for(var E=this.scopeStack.length-1;;E--){var k=this.scopeStack[E];if(k.flags&Mi)return k}},Tn.currentThisScope=function(){for(var E=this.scopeStack.length-1;;E--){var k=this.scopeStack[E];if(k.flags&Mi&&!(k.flags&Oa))return k}};var zi=function(k,H,F){this.type="",this.start=H,this.end=0,k.options.locations&&(this.loc=new ht(k,F)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[H,0])},ka=Ft.prototype;ka.startNode=function(){return new zi(this,this.start,this.startLoc)},ka.startNodeAt=function(E,k){return new zi(this,E,k)};function ia(E,k,H,F){return E.type=k,E.end=H,this.options.locations&&(E.loc.end=F),this.options.ranges&&(E.range[1]=H),E}ka.finishNode=function(E,k){return ia.call(this,E,k,this.lastTokEnd,this.lastTokEndLoc)},ka.finishNodeAt=function(E,k,H,F){return ia.call(this,E,k,H,F)};var io=function(k,H,F,le,Ue){this.token=k,this.isExpr=!!H,this.preserveSpace=!!F,this.override=le,this.generator=!!Ue},Ci={b_stat:new io("{",!1),b_expr:new io("{",!0),b_tmpl:new io("${",!1),p_stat:new io("(",!1),p_expr:new io("(",!0),q_tmpl:new io("`",!0,!0,function(E){return E.tryReadTemplateToken()}),f_stat:new io("function",!1),f_expr:new io("function",!0),f_expr_gen:new io("function",!0,!1,null,!0),f_gen:new io("function",!1,!1,null,!0)},pa=Ft.prototype;pa.initialContext=function(){return[Ci.b_stat]},pa.braceIsBlock=function(E){var k=this.curContext();return k===Ci.f_expr||k===Ci.f_stat?!0:E===ie.colon&&(k===Ci.b_stat||k===Ci.b_expr)?!k.isExpr:E===ie._return||E===ie.name&&this.exprAllowed?yr.test(this.input.slice(this.lastTokEnd,this.start)):E===ie._else||E===ie.semi||E===ie.eof||E===ie.parenR||E===ie.arrow?!0:E===ie.braceL?k===Ci.b_stat:E===ie._var||E===ie._const||E===ie.name?!1:!this.exprAllowed},pa.inGeneratorContext=function(){for(var E=this.context.length-1;E>=1;E--){var k=this.context[E];if(k.token==="function")return k.generator}return!1},pa.updateContext=function(E){var k,H=this.type;H.keyword&&E===ie.dot?this.exprAllowed=!1:(k=H.updateContext)?k.call(this,E):this.exprAllowed=H.beforeExpr},ie.parenR.updateContext=ie.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var E=this.context.pop();E===Ci.b_stat&&this.curContext().token==="function"&&(E=this.context.pop()),this.exprAllowed=!E.isExpr},ie.braceL.updateContext=function(E){this.context.push(this.braceIsBlock(E)?Ci.b_stat:Ci.b_expr),this.exprAllowed=!0},ie.dollarBraceL.updateContext=function(){this.context.push(Ci.b_tmpl),this.exprAllowed=!0},ie.parenL.updateContext=function(E){var k=E===ie._if||E===ie._for||E===ie._with||E===ie._while;this.context.push(k?Ci.p_stat:Ci.p_expr),this.exprAllowed=!0},ie.incDec.updateContext=function(){},ie._function.updateContext=ie._class.updateContext=function(E){E.beforeExpr&&E!==ie.semi&&E!==ie._else&&!(E===ie._return&&yr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((E===ie.colon||E===ie.braceL)&&this.curContext()===Ci.b_stat)?this.context.push(Ci.f_expr):this.context.push(Ci.f_stat),this.exprAllowed=!1},ie.backQuote.updateContext=function(){this.curContext()===Ci.q_tmpl?this.context.pop():this.context.push(Ci.q_tmpl),this.exprAllowed=!1},ie.star.updateContext=function(E){if(E===ie._function){var k=this.context.length-1;this.context[k]===Ci.f_expr?this.context[k]=Ci.f_expr_gen:this.context[k]=Ci.f_gen}this.exprAllowed=!0},ie.name.updateContext=function(E){var k=!1;this.options.ecmaVersion>=6&&E!==ie.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var ee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=ee+" Extended_Pictographic",xe=ce,Oe={9:ee,10:ce,11:xe},qe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ct="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",St=ct+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ke=St+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",it={9:ct,10:St,11:ke},Yt={};function jr(E){var k=Yt[E]={binary:Q(Oe[E]+" "+qe),nonBinary:{General_Category:Q(qe),Script:Q(it[E])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}jr(9),jr(10),jr(11);var or=Ft.prototype,mr=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Yt[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};mr.prototype.reset=function(k,H,F){var le=F.indexOf("u")!==-1;this.start=k|0,this.source=H+"",this.flags=F,this.switchU=le&&this.parser.options.ecmaVersion>=6,this.switchN=le&&this.parser.options.ecmaVersion>=9},mr.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},mr.prototype.at=function(k,H){H===void 0&&(H=!1);var F=this.source,le=F.length;if(k>=le)return-1;var Ue=F.charCodeAt(k);if(!(H||this.switchU)||Ue<=55295||Ue>=57344||k+1>=le)return Ue;var yt=F.charCodeAt(k+1);return yt>=56320&&yt<=57343?(Ue<<10)+yt-56613888:Ue},mr.prototype.nextIndex=function(k,H){H===void 0&&(H=!1);var F=this.source,le=F.length;if(k>=le)return le;var Ue=F.charCodeAt(k),yt;return!(H||this.switchU)||Ue<=55295||Ue>=57344||k+1>=le||(yt=F.charCodeAt(k+1))<56320||yt>57343?k+1:k+2},mr.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},mr.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},mr.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},mr.prototype.eat=function(k,H){return H===void 0&&(H=!1),this.current(H)===k?(this.advance(H),!0):!1};function Hr(E){return E<=65535?String.fromCharCode(E):(E-=65536,String.fromCharCode((E>>10)+55296,(E&1023)+56320))}or.validateRegExpFlags=function(E){for(var k=E.validFlags,H=E.flags,F=0;F<H.length;F++){var le=H.charAt(F);k.indexOf(le)===-1&&this.raise(E.start,"Invalid regular expression flag"),H.indexOf(le,F+1)>-1&&this.raise(E.start,"Duplicate regular expression flag")}},or.validateRegExpPattern=function(E){this.regexp_pattern(E),!E.switchN&&this.options.ecmaVersion>=9&&E.groupNames.length>0&&(E.switchN=!0,this.regexp_pattern(E))},or.regexp_pattern=function(E){E.pos=0,E.lastIntValue=0,E.lastStringValue="",E.lastAssertionIsQuantifiable=!1,E.numCapturingParens=0,E.maxBackReference=0,E.groupNames.length=0,E.backReferenceNames.length=0,this.regexp_disjunction(E),E.pos!==E.source.length&&(E.eat(41)&&E.raise("Unmatched ')'"),(E.eat(93)||E.eat(125))&&E.raise("Lone quantifier brackets")),E.maxBackReference>E.numCapturingParens&&E.raise("Invalid escape");for(var k=0,H=E.backReferenceNames;k<H.length;k+=1){var F=H[k];E.groupNames.indexOf(F)===-1&&E.raise("Invalid named capture referenced")}},or.regexp_disjunction=function(E){for(this.regexp_alternative(E);E.eat(124);)this.regexp_alternative(E);this.regexp_eatQuantifier(E,!0)&&E.raise("Nothing to repeat"),E.eat(123)&&E.raise("Lone quantifier brackets")},or.regexp_alternative=function(E){for(;E.pos<E.source.length&&this.regexp_eatTerm(E););},or.regexp_eatTerm=function(E){return this.regexp_eatAssertion(E)?(E.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(E)&&E.switchU&&E.raise("Invalid quantifier"),!0):(E.switchU?this.regexp_eatAtom(E):this.regexp_eatExtendedAtom(E))?(this.regexp_eatQuantifier(E),!0):!1},or.regexp_eatAssertion=function(E){var k=E.pos;if(E.lastAssertionIsQuantifiable=!1,E.eat(94)||E.eat(36))return!0;if(E.eat(92)){if(E.eat(66)||E.eat(98))return!0;E.pos=k}if(E.eat(40)&&E.eat(63)){var H=!1;if(this.options.ecmaVersion>=9&&(H=E.eat(60)),E.eat(61)||E.eat(33))return this.regexp_disjunction(E),E.eat(41)||E.raise("Unterminated group"),E.lastAssertionIsQuantifiable=!H,!0}return E.pos=k,!1},or.regexp_eatQuantifier=function(E,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(E,k)?(E.eat(63),!0):!1},or.regexp_eatQuantifierPrefix=function(E,k){return E.eat(42)||E.eat(43)||E.eat(63)||this.regexp_eatBracedQuantifier(E,k)},or.regexp_eatBracedQuantifier=function(E,k){var H=E.pos;if(E.eat(123)){var F=0,le=-1;if(this.regexp_eatDecimalDigits(E)&&(F=E.lastIntValue,E.eat(44)&&this.regexp_eatDecimalDigits(E)&&(le=E.lastIntValue),E.eat(125)))return le!==-1&&le<F&&!k&&E.raise("numbers out of order in {} quantifier"),!0;E.switchU&&!k&&E.raise("Incomplete quantifier"),E.pos=H}return!1},or.regexp_eatAtom=function(E){return this.regexp_eatPatternCharacters(E)||E.eat(46)||this.regexp_eatReverseSolidusAtomEscape(E)||this.regexp_eatCharacterClass(E)||this.regexp_eatUncapturingGroup(E)||this.regexp_eatCapturingGroup(E)},or.regexp_eatReverseSolidusAtomEscape=function(E){var k=E.pos;if(E.eat(92)){if(this.regexp_eatAtomEscape(E))return!0;E.pos=k}return!1},or.regexp_eatUncapturingGroup=function(E){var k=E.pos;if(E.eat(40)){if(E.eat(63)&&E.eat(58)){if(this.regexp_disjunction(E),E.eat(41))return!0;E.raise("Unterminated group")}E.pos=k}return!1},or.regexp_eatCapturingGroup=function(E){if(E.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(E):E.current()===63&&E.raise("Invalid group"),this.regexp_disjunction(E),E.eat(41))return E.numCapturingParens+=1,!0;E.raise("Unterminated group")}return!1},or.regexp_eatExtendedAtom=function(E){return E.eat(46)||this.regexp_eatReverseSolidusAtomEscape(E)||this.regexp_eatCharacterClass(E)||this.regexp_eatUncapturingGroup(E)||this.regexp_eatCapturingGroup(E)||this.regexp_eatInvalidBracedQuantifier(E)||this.regexp_eatExtendedPatternCharacter(E)},or.regexp_eatInvalidBracedQuantifier=function(E){return this.regexp_eatBracedQuantifier(E,!0)&&E.raise("Nothing to repeat"),!1},or.regexp_eatSyntaxCharacter=function(E){var k=E.current();return si(k)?(E.lastIntValue=k,E.advance(),!0):!1};function si(E){return E===36||E>=40&&E<=43||E===46||E===63||E>=91&&E<=94||E>=123&&E<=125}or.regexp_eatPatternCharacters=function(E){for(var k=E.pos,H=0;(H=E.current())!==-1&&!si(H);)E.advance();return E.pos!==k},or.regexp_eatExtendedPatternCharacter=function(E){var k=E.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(E.advance(),!0):!1},or.regexp_groupSpecifier=function(E){if(E.eat(63)){if(this.regexp_eatGroupName(E)){E.groupNames.indexOf(E.lastStringValue)!==-1&&E.raise("Duplicate capture group name"),E.groupNames.push(E.lastStringValue);return}E.raise("Invalid group")}},or.regexp_eatGroupName=function(E){if(E.lastStringValue="",E.eat(60)){if(this.regexp_eatRegExpIdentifierName(E)&&E.eat(62))return!0;E.raise("Invalid capture group name")}return!1},or.regexp_eatRegExpIdentifierName=function(E){if(E.lastStringValue="",this.regexp_eatRegExpIdentifierStart(E)){for(E.lastStringValue+=Hr(E.lastIntValue);this.regexp_eatRegExpIdentifierPart(E);)E.lastStringValue+=Hr(E.lastIntValue);return!0}return!1},or.regexp_eatRegExpIdentifierStart=function(E){var k=E.pos,H=this.options.ecmaVersion>=11,F=E.current(H);return E.advance(H),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(E,H)&&(F=E.lastIntValue),Mn(F)?(E.lastIntValue=F,!0):(E.pos=k,!1)};function Mn(E){return Et(E,!0)||E===36||E===95}or.regexp_eatRegExpIdentifierPart=function(E){var k=E.pos,H=this.options.ecmaVersion>=11,F=E.current(H);return E.advance(H),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(E,H)&&(F=E.lastIntValue),ar(F)?(E.lastIntValue=F,!0):(E.pos=k,!1)};function ar(E){return Vt(E,!0)||E===36||E===95||E===8204||E===8205}or.regexp_eatAtomEscape=function(E){return this.regexp_eatBackReference(E)||this.regexp_eatCharacterClassEscape(E)||this.regexp_eatCharacterEscape(E)||E.switchN&&this.regexp_eatKGroupName(E)?!0:(E.switchU&&(E.current()===99&&E.raise("Invalid unicode escape"),E.raise("Invalid escape")),!1)},or.regexp_eatBackReference=function(E){var k=E.pos;if(this.regexp_eatDecimalEscape(E)){var H=E.lastIntValue;if(E.switchU)return H>E.maxBackReference&&(E.maxBackReference=H),!0;if(H<=E.numCapturingParens)return!0;E.pos=k}return!1},or.regexp_eatKGroupName=function(E){if(E.eat(107)){if(this.regexp_eatGroupName(E))return E.backReferenceNames.push(E.lastStringValue),!0;E.raise("Invalid named reference")}return!1},or.regexp_eatCharacterEscape=function(E){return this.regexp_eatControlEscape(E)||this.regexp_eatCControlLetter(E)||this.regexp_eatZero(E)||this.regexp_eatHexEscapeSequence(E)||this.regexp_eatRegExpUnicodeEscapeSequence(E,!1)||!E.switchU&&this.regexp_eatLegacyOctalEscapeSequence(E)||this.regexp_eatIdentityEscape(E)},or.regexp_eatCControlLetter=function(E){var k=E.pos;if(E.eat(99)){if(this.regexp_eatControlLetter(E))return!0;E.pos=k}return!1},or.regexp_eatZero=function(E){return E.current()===48&&!na(E.lookahead())?(E.lastIntValue=0,E.advance(),!0):!1},or.regexp_eatControlEscape=function(E){var k=E.current();return k===116?(E.lastIntValue=9,E.advance(),!0):k===110?(E.lastIntValue=10,E.advance(),!0):k===118?(E.lastIntValue=11,E.advance(),!0):k===102?(E.lastIntValue=12,E.advance(),!0):k===114?(E.lastIntValue=13,E.advance(),!0):!1},or.regexp_eatControlLetter=function(E){var k=E.current();return Yn(k)?(E.lastIntValue=k%32,E.advance(),!0):!1};function Yn(E){return E>=65&&E<=90||E>=97&&E<=122}or.regexp_eatRegExpUnicodeEscapeSequence=function(E,k){k===void 0&&(k=!1);var H=E.pos,F=k||E.switchU;if(E.eat(117)){if(this.regexp_eatFixedHexDigits(E,4)){var le=E.lastIntValue;if(F&&le>=55296&&le<=56319){var Ue=E.pos;if(E.eat(92)&&E.eat(117)&&this.regexp_eatFixedHexDigits(E,4)){var yt=E.lastIntValue;if(yt>=56320&&yt<=57343)return E.lastIntValue=(le-55296)*1024+(yt-56320)+65536,!0}E.pos=Ue,E.lastIntValue=le}return!0}if(F&&E.eat(123)&&this.regexp_eatHexDigits(E)&&E.eat(125)&&Pr(E.lastIntValue))return!0;F&&E.raise("Invalid unicode escape"),E.pos=H}return!1};function Pr(E){return E>=0&&E<=1114111}or.regexp_eatIdentityEscape=function(E){if(E.switchU)return this.regexp_eatSyntaxCharacter(E)?!0:E.eat(47)?(E.lastIntValue=47,!0):!1;var k=E.current();return k!==99&&(!E.switchN||k!==107)?(E.lastIntValue=k,E.advance(),!0):!1},or.regexp_eatDecimalEscape=function(E){E.lastIntValue=0;var k=E.current();if(k>=49&&k<=57){do E.lastIntValue=10*E.lastIntValue+(k-48),E.advance();while((k=E.current())>=48&&k<=57);return!0}return!1},or.regexp_eatCharacterClassEscape=function(E){var k=E.current();if(gn(k))return E.lastIntValue=-1,E.advance(),!0;if(E.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(E.lastIntValue=-1,E.advance(),E.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(E)&&E.eat(125))return!0;E.raise("Invalid property name")}return!1};function gn(E){return E===100||E===68||E===115||E===83||E===119||E===87}or.regexp_eatUnicodePropertyValueExpression=function(E){var k=E.pos;if(this.regexp_eatUnicodePropertyName(E)&&E.eat(61)){var H=E.lastStringValue;if(this.regexp_eatUnicodePropertyValue(E)){var F=E.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(E,H,F),!0}}if(E.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(E)){var le=E.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(E,le),!0}return!1},or.regexp_validateUnicodePropertyNameAndValue=function(E,k,H){Se(E.unicodeProperties.nonBinary,k)||E.raise("Invalid property name"),E.unicodeProperties.nonBinary[k].test(H)||E.raise("Invalid property value")},or.regexp_validateUnicodePropertyNameOrValue=function(E,k){E.unicodeProperties.binary.test(k)||E.raise("Invalid property name")},or.regexp_eatUnicodePropertyName=function(E){var k=0;for(E.lastStringValue="";ea(k=E.current());)E.lastStringValue+=Hr(k),E.advance();return E.lastStringValue!==""};function ea(E){return Yn(E)||E===95}or.regexp_eatUnicodePropertyValue=function(E){var k=0;for(E.lastStringValue="";Vn(k=E.current());)E.lastStringValue+=Hr(k),E.advance();return E.lastStringValue!==""};function Vn(E){return ea(E)||na(E)}or.regexp_eatLoneUnicodePropertyNameOrValue=function(E){return this.regexp_eatUnicodePropertyValue(E)},or.regexp_eatCharacterClass=function(E){if(E.eat(91)){if(E.eat(94),this.regexp_classRanges(E),E.eat(93))return!0;E.raise("Unterminated character class")}return!1},or.regexp_classRanges=function(E){for(;this.regexp_eatClassAtom(E);){var k=E.lastIntValue;if(E.eat(45)&&this.regexp_eatClassAtom(E)){var H=E.lastIntValue;E.switchU&&(k===-1||H===-1)&&E.raise("Invalid character class"),k!==-1&&H!==-1&&k>H&&E.raise("Range out of order in character class")}}},or.regexp_eatClassAtom=function(E){var k=E.pos;if(E.eat(92)){if(this.regexp_eatClassEscape(E))return!0;if(E.switchU){var H=E.current();(H===99||da(H))&&E.raise("Invalid class escape"),E.raise("Invalid escape")}E.pos=k}var F=E.current();return F!==93?(E.lastIntValue=F,E.advance(),!0):!1},or.regexp_eatClassEscape=function(E){var k=E.pos;if(E.eat(98))return E.lastIntValue=8,!0;if(E.switchU&&E.eat(45))return E.lastIntValue=45,!0;if(!E.switchU&&E.eat(99)){if(this.regexp_eatClassControlLetter(E))return!0;E.pos=k}return this.regexp_eatCharacterClassEscape(E)||this.regexp_eatCharacterEscape(E)},or.regexp_eatClassControlLetter=function(E){var k=E.current();return na(k)||k===95?(E.lastIntValue=k%32,E.advance(),!0):!1},or.regexp_eatHexEscapeSequence=function(E){var k=E.pos;if(E.eat(120)){if(this.regexp_eatFixedHexDigits(E,2))return!0;E.switchU&&E.raise("Invalid escape"),E.pos=k}return!1},or.regexp_eatDecimalDigits=function(E){var k=E.pos,H=0;for(E.lastIntValue=0;na(H=E.current());)E.lastIntValue=10*E.lastIntValue+(H-48),E.advance();return E.pos!==k};function na(E){return E>=48&&E<=57}or.regexp_eatHexDigits=function(E){var k=E.pos,H=0;for(E.lastIntValue=0;Ht(H=E.current());)E.lastIntValue=16*E.lastIntValue+Rt(H),E.advance();return E.pos!==k};function Ht(E){return E>=48&&E<=57||E>=65&&E<=70||E>=97&&E<=102}function Rt(E){return E>=65&&E<=70?10+(E-65):E>=97&&E<=102?10+(E-97):E-48}or.regexp_eatLegacyOctalEscapeSequence=function(E){if(this.regexp_eatOctalDigit(E)){var k=E.lastIntValue;if(this.regexp_eatOctalDigit(E)){var H=E.lastIntValue;k<=3&&this.regexp_eatOctalDigit(E)?E.lastIntValue=k*64+H*8+E.lastIntValue:E.lastIntValue=k*8+H}else E.lastIntValue=k;return!0}return!1},or.regexp_eatOctalDigit=function(E){var k=E.current();return da(k)?(E.lastIntValue=k-48,E.advance(),!0):(E.lastIntValue=0,!1)};function da(E){return E>=48&&E<=55}or.regexp_eatFixedHexDigits=function(E,k){var H=E.pos;E.lastIntValue=0;for(var F=0;F<k;++F){var le=E.current();if(!Ht(le))return E.pos=H,!1;E.lastIntValue=16*E.lastIntValue+Rt(le),E.advance()}return!0};var aa=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new ht(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},Di=Ft.prototype;Di.next=function(E){!E&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new aa(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Di.getToken=function(){return this.next(),new aa(this)},typeof Symbol!="undefined"&&(Di[Symbol.iterator]=function(){var E=this;return{next:function(){var k=E.getToken();return{done:k.type===ie.eof,value:k}}}}),Di.curContext=function(){return this.context[this.context.length-1]},Di.nextToken=function(){var E=this.curContext();if((!E||!E.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ie.eof);if(E.override)return E.override(this);this.readToken(this.fullCharCodeAtPos())},Di.readToken=function(E){return Et(E,this.options.ecmaVersion>=6)||E===92?this.readWord():this.getTokenFromCode(E)},Di.fullCharCodeAtPos=function(){var E=this.input.charCodeAt(this.pos);if(E<=55295||E>=57344)return E;var k=this.input.charCodeAt(this.pos+1);return(E<<10)+k-56613888},Di.skipBlockComment=function(){var E=this.options.onComment&&this.curPosition(),k=this.pos,H=this.input.indexOf("*/",this.pos+=2);if(H===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=H+2,this.options.locations){Dt.lastIndex=k;for(var F;(F=Dt.exec(this.input))&&F.index<this.pos;)++this.curLine,this.lineStart=F.index+F[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,H),k,this.pos,E,this.curPosition())},Di.skipLineComment=function(E){for(var k=this.pos,H=this.options.onComment&&this.curPosition(),F=this.input.charCodeAt(this.pos+=E);this.pos<this.input.length&&!xt(F);)F=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+E,this.pos),k,this.pos,H,this.curPosition())},Di.skipSpace=function(){e:for(;this.pos<this.input.length;){var E=this.input.charCodeAt(this.pos);switch(E){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(E>8&&E<14||E>=5760&&Jt.test(String.fromCharCode(E)))++this.pos;else break e}}},Di.finishToken=function(E,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var H=this.type;this.type=E,this.value=k,this.updateContext(H)},Di.readToken_dot=function(){var E=this.input.charCodeAt(this.pos+1);if(E>=48&&E<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&E===46&&k===46?(this.pos+=3,this.finishToken(ie.ellipsis)):(++this.pos,this.finishToken(ie.dot))},Di.readToken_slash=function(){var E=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):E===61?this.finishOp(ie.assign,2):this.finishOp(ie.slash,1)},Di.readToken_mult_modulo_exp=function(E){var k=this.input.charCodeAt(this.pos+1),H=1,F=E===42?ie.star:ie.modulo;return this.options.ecmaVersion>=7&&E===42&&k===42&&(++H,F=ie.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(ie.assign,H+1):this.finishOp(F,H)},Di.readToken_pipe_amp=function(E){var k=this.input.charCodeAt(this.pos+1);if(k===E){if(this.options.ecmaVersion>=12){var H=this.input.charCodeAt(this.pos+2);if(H===61)return this.finishOp(ie.assign,3)}return this.finishOp(E===124?ie.logicalOR:ie.logicalAND,2)}return k===61?this.finishOp(ie.assign,2):this.finishOp(E===124?ie.bitwiseOR:ie.bitwiseAND,1)},Di.readToken_caret=function(){var E=this.input.charCodeAt(this.pos+1);return E===61?this.finishOp(ie.assign,2):this.finishOp(ie.bitwiseXOR,1)},Di.readToken_plus_min=function(E){var k=this.input.charCodeAt(this.pos+1);return k===E?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||yr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ie.incDec,2):k===61?this.finishOp(ie.assign,2):this.finishOp(ie.plusMin,1)},Di.readToken_lt_gt=function(E){var k=this.input.charCodeAt(this.pos+1),H=1;return k===E?(H=E===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+H)===61?this.finishOp(ie.assign,H+1):this.finishOp(ie.bitShift,H)):k===33&&E===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(H=2),this.finishOp(ie.relational,H))},Di.readToken_eq_excl=function(E){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(ie.equality,this.input.charCodeAt(this.pos+2)===61?3:2):E===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ie.arrow)):this.finishOp(E===61?ie.eq:ie.prefix,1)},Di.readToken_question=function(){var E=this.options.ecmaVersion;if(E>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var H=this.input.charCodeAt(this.pos+2);if(H<48||H>57)return this.finishOp(ie.questionDot,2)}if(k===63){if(E>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(ie.assign,3)}return this.finishOp(ie.coalesce,2)}}return this.finishOp(ie.question,1)},Di.getTokenFromCode=function(E){switch(E){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ie.parenL);case 41:return++this.pos,this.finishToken(ie.parenR);case 59:return++this.pos,this.finishToken(ie.semi);case 44:return++this.pos,this.finishToken(ie.comma);case 91:return++this.pos,this.finishToken(ie.bracketL);case 93:return++this.pos,this.finishToken(ie.bracketR);case 123:return++this.pos,this.finishToken(ie.braceL);case 125:return++this.pos,this.finishToken(ie.braceR);case 58:return++this.pos,this.finishToken(ie.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ie.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(E);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(E);case 124:case 38:return this.readToken_pipe_amp(E);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(E);case 60:case 62:return this.readToken_lt_gt(E);case 61:case 33:return this.readToken_eq_excl(E);case 63:return this.readToken_question();case 126:return this.finishOp(ie.prefix,1)}this.raise(this.pos,"Unexpected character '"+Na(E)+"'")},Di.finishOp=function(E,k){var H=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(E,H)},Di.readRegexp=function(){for(var E,k,H=this.pos;;){this.pos>=this.input.length&&this.raise(H,"Unterminated regular expression");var F=this.input.charAt(this.pos);if(yr.test(F)&&this.raise(H,"Unterminated regular expression"),E)E=!1;else{if(F==="[")k=!0;else if(F==="]"&&k)k=!1;else if(F==="/"&&!k)break;E=F==="\\"}++this.pos}var le=this.input.slice(H,this.pos);++this.pos;var Ue=this.pos,yt=this.readWord1();this.containsEsc&&this.unexpected(Ue);var Ot=this.regexpState||(this.regexpState=new mr(this));Ot.reset(H,le,yt),this.validateRegExpFlags(Ot),this.validateRegExpPattern(Ot);var Nt=null;try{Nt=new RegExp(le,yt)}catch(Br){}return this.finishToken(ie.regexp,{pattern:le,flags:yt,value:Nt})},Di.readInt=function(E,k,H){for(var F=this.options.ecmaVersion>=12&&k===void 0,le=H&&this.input.charCodeAt(this.pos)===48,Ue=this.pos,yt=0,Ot=0,Nt=0,Br=k==null?Infinity:k;Nt<Br;++Nt,++this.pos){var Xr=this.input.charCodeAt(this.pos),Jn=void 0;if(F&&Xr===95){le&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ot===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Nt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ot=Xr;continue}if(Xr>=97?Jn=Xr-97+10:Xr>=65?Jn=Xr-65+10:Xr>=48&&Xr<=57?Jn=Xr-48:Jn=Infinity,Jn>=E)break;Ot=Xr,yt=yt*E+Jn}return F&&Ot===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ue||k!=null&&this.pos-Ue!==k?null:yt};function Ii(E,k){return k?parseInt(E,8):parseFloat(E.replace(/_/g,""))}function _o(E){return typeof BigInt!="function"?null:BigInt(E.replace(/_/g,""))}Di.readRadixNumber=function(E){var k=this.pos;this.pos+=2;var H=this.readInt(E);return H==null&&this.raise(this.start+2,"Expected number in radix "+E),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(H=_o(this.input.slice(k,this.pos)),++this.pos):Et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ie.num,H)},Di.readNumber=function(E){var k=this.pos;!E&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var H=this.pos-k>=2&&this.input.charCodeAt(k)===48;H&&this.strict&&this.raise(k,"Invalid number");var F=this.input.charCodeAt(this.pos);if(!H&&!E&&this.options.ecmaVersion>=11&&F===110){var le=_o(this.input.slice(k,this.pos));return++this.pos,Et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ie.num,le)}H&&/[89]/.test(this.input.slice(k,this.pos))&&(H=!1),F===46&&!H&&(++this.pos,this.readInt(10),F=this.input.charCodeAt(this.pos)),(F===69||F===101)&&!H&&(F=this.input.charCodeAt(++this.pos),(F===43||F===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),Et(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ue=Ii(this.input.slice(k,this.pos),H);return this.finishToken(ie.num,Ue)},Di.readCodePoint=function(){var E=this.input.charCodeAt(this.pos),k;if(E===123){this.options.ecmaVersion<6&&this.unexpected();var H=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(H,"Code point out of bounds")}else k=this.readHexChar(4);return k};function Na(E){return E<=65535?String.fromCharCode(E):(E-=65536,String.fromCharCode((E>>10)+55296,(E&1023)+56320))}Di.readString=function(E){for(var k="",H=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var F=this.input.charCodeAt(this.pos);if(F===E)break;F===92?(k+=this.input.slice(H,this.pos),k+=this.readEscapedChar(!1),H=this.pos):(xt(F,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(H,this.pos++),this.finishToken(ie.string,k)};var Or={};Di.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(E){if(E===Or)this.readInvalidTemplateToken();else throw E}this.inTemplateElement=!1},Di.invalidStringToken=function(E,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Or;this.raise(E,k)},Di.readTmplToken=function(){for(var E="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var H=this.input.charCodeAt(this.pos);if(H===96||H===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ie.template||this.type===ie.invalidTemplate)?H===36?(this.pos+=2,this.finishToken(ie.dollarBraceL)):(++this.pos,this.finishToken(ie.backQuote)):(E+=this.input.slice(k,this.pos),this.finishToken(ie.template,E));if(H===92)E+=this.input.slice(k,this.pos),E+=this.readEscapedChar(!0),k=this.pos;else if(xt(H)){switch(E+=this.input.slice(k,this.pos),++this.pos,H){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:E+=`
`;break;default:E+=String.fromCharCode(H);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},Di.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ie.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Di.readEscapedChar=function(E){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Na(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(E){var H=this.pos-1;return this.invalidStringToken(H,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var F=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],le=parseInt(F,8);return le>255&&(F=F.slice(0,-1),le=parseInt(F,8)),this.pos+=F.length-1,k=this.input.charCodeAt(this.pos),(F!=="0"||k===56||k===57)&&(this.strict||E)&&this.invalidStringToken(this.pos-1-F.length,E?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(le)}return xt(k)?"":String.fromCharCode(k)}},Di.readHexChar=function(E){var k=this.pos,H=this.readInt(16,E);return H===null&&this.invalidStringToken(k,"Bad character escape sequence"),H},Di.readWord1=function(){this.containsEsc=!1;for(var E="",k=!0,H=this.pos,F=this.options.ecmaVersion>=6;this.pos<this.input.length;){var le=this.fullCharCodeAtPos();if(Vt(le,F))this.pos+=le<=65535?1:2;else if(le===92){this.containsEsc=!0,E+=this.input.slice(H,this.pos);var Ue=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var yt=this.readCodePoint();(k?Et:Vt)(yt,F)||this.invalidStringToken(Ue,"Invalid Unicode escape"),E+=Na(yt),H=this.pos}else break;k=!1}return E+this.input.slice(H,this.pos)},Di.readWord=function(){var E=this.readWord1(),k=ie.name;return this.keywords.test(E)&&(k=Lt[E]),this.finishToken(k,E)};var Dr="7.4.1";Ft.acorn={Parser:Ft,version:Dr,defaultOptions:er,Position:Le,SourceLocation:ht,getLineInfo:wt,Node:zi,TokenType:Ut,tokTypes:ie,keywordTypes:Lt,TokContext:io,tokContexts:Ci,isIdentifierChar:Vt,isIdentifierStart:Et,Token:aa,isNewLine:xt,lineBreak:yr,lineBreakG:Dt,nonASCIIwhitespace:Jt};function Mt(E,k){return Ft.parse(E,k)}function us(E,k,H){return Ft.parseExpressionAt(E,k,H)}function At(E,k){return Ft.tokenizer(E,k)}function ao(E,k){E.prototype=Object.create(k.prototype),E.prototype.constructor=E,E.__proto__=k}function yu(E){var k=typeof Map=="function"?new Map:void 0;return yu=function(F){if(F===null||!gl(F))return F;if(typeof F!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(F))return k.get(F);k.set(F,le)}function le(){return Bi(F,arguments,Lo(this).constructor)}return le.prototype=Object.create(F.prototype,{constructor:{value:le,enumerable:!1,writable:!0,configurable:!0}}),Ra(le,F)},yu(E)}function Jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(E){return!1}}function Bi(E,k,H){return Jo()?Bi=Reflect.construct:Bi=function(le,Ue,yt){var Ot=[null];Ot.push.apply(Ot,Ue);var Nt=Function.bind.apply(le,Ot),Br=new Nt;return yt&&Ra(Br,yt.prototype),Br},Bi.apply(null,arguments)}function gl(E){return Function.toString.call(E).indexOf("[native code]")!==-1}function Ra(E,k){return Ra=Object.setPrototypeOf||function(F,le){return F.__proto__=le,F},Ra(E,k)}function Lo(E){return Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(H){return H.__proto__||Object.getPrototypeOf(H)},Lo(E)}var Do=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(yu(Error)),Ea=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(yu(SyntaxError)),Ps=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(yu(ReferenceError)),ks=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(yu(TypeError)),Jl=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(Do),fo=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(Ea),ds=function(E){ao(k,E);function k(){return E.apply(this,arguments)||this}return k}(Ps),ja={UnknownError:[3001,"%0",Jl],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Jl],NodeTypeSyntaxError:[1001,"Unknown node type: %0",ds],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",ds],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",ds],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",ds],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",ds],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",ds],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",ds],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",ds],ParamTypeSyntaxError:[1009,"Unknown param type: %0",ds],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",ds],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ps],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ps],IsNotConstructor:[2003,"%0 is not a constructor",ks]};function Fo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(E){return!1}}function vs(E,k,H){return Fo()?vs=Reflect.construct:vs=function(le,Ue,yt){var Ot=[null];Ot.push.apply(Ot,Ue);var Nt=Function.bind.apply(le,Ot),Br=new Nt;return yt&&Bo(Br,yt.prototype),Br},vs.apply(null,arguments)}function Bo(E,k){return Bo=Object.setPrototypeOf||function(F,le){return F.__proto__=le,F},Bo(E,k)}var Ju="0.0.3";function ju(E,k){Object.defineProperty(E,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var jo=Object.prototype.hasOwnProperty,ye=Symbol("Break"),Ze=Symbol("Continue"),Ct=Symbol("DefaultCase"),hr=Symbol("EmptyStatementReturn"),En=Symbol("WithScopeName"),ri=Symbol("SuperScopeName"),_a=Symbol("RootScopeName"),Go=Symbol("GlobalScopeName");function Da(E){return typeof E=="function"}var No=function(){function E(H){this.interpreter=H}var k=E.prototype;return k.generator=function(){var F=this.interpreter;function le(){return this.getCurrentScope()}function Ue(){return this.getGlobalScope()}function yt(){return this.getCurrentContext()}return{getOptions:F.getOptions.bind(F),getCurrentScope:le.bind(F),getGlobalScope:Ue.bind(F),getCurrentContext:yt.bind(F),getExecStartTime:F.getExecStartTime.bind(F)}},E}();function So(E,k,H){if(H===void 0&&(H=!0),!(E instanceof No))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var F=E.generator(),le=F.getOptions(),Ue={timeout:le.timeout,_initEnv:function(){H||this.setCurrentContext(F.getCurrentContext()),this.execStartTime=F.getExecStartTime(),this.execEndTime=this.execStartTime}},yt=H?F.getGlobalScope():F.getCurrentScope(),Ot=new Cs(yt,Ue);return Ot.evaluate(k)}}Object.defineProperty(So,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function oo(E){if(!(E instanceof No))throw new Error("Illegal call");for(var k=E.generator(),H=arguments.length,F=new Array(H>1?H-1:0),le=1;le<H;le++)F[le-1]=arguments[le];var Ue=F.pop(),yt=new Cs(k.getGlobalScope(),k.getOptions()),Ot=`
		    (function anonymous(`+F.join(",")+`){
		        `+Ue+`
		    });
		    `;return yt.evaluate(Ot)}Object.defineProperty(oo,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ls=function(k){this.value=k},Qs=function(k){this.value=k},uu=function(k){this.value=k},_u=function(k,H,F){H===void 0&&(H=null),this.name=F,this.parent=H,this.data=k,this.labelStack=[]};function Gu(){}function xu(E,k){return E===void 0&&(E=null),new _u(Object.create(null),E,k)}function Oo(E){return Object.create(E)}var fa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:So,Function:oo};typeof JSON!="undefined"&&(fa.JSON=JSON),typeof Promise!="undefined"&&(fa.Promise=Promise),typeof Set!="undefined"&&(fa.Set=Set),typeof Map!="undefined"&&(fa.Map=Map),typeof Symbol!="undefined"&&(fa.Symbol=Symbol),typeof Proxy!="undefined"&&(fa.Proxy=Proxy),typeof WeakMap!="undefined"&&(fa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(fa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(fa.Reflect=Reflect);var Cs=function(){function E(H,F){H===void 0&&(H=E.global),F===void 0&&(F={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:F.ecmaVersion||E.ecmaVersion,timeout:F.timeout||0,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction===void 0?E.globalContextInFunction:F.globalContextInFunction,_initEnv:F._initEnv},this.context=H||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=E.prototype;return k.initEnvironment=function(F){var le;if(F instanceof _u)le=F;else{var Ue=null,yt=this.createSuperScope(F);this.options.rootContext&&(Ue=new _u(Oo(this.options.rootContext),yt,_a)),le=new _u(F,Ue||yt,Go)}this.globalScope=le,this.currentScope=this.globalScope,this.globalContext=le.data,this.currentContext=le.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Ot=this.options._initEnv;Ot&&Ot.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(F){F===void 0&&(F=0),this.options.timeout=F},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(F){return F instanceof Jl||F instanceof ds||F instanceof fo},k.createSuperScope=function(F){var le=Object.assign({},fa),Ue=Object.keys(le);return Ue.forEach(function(yt){yt in F&&delete le[yt]}),new _u(le,null,ri)},k.setCurrentContext=function(F){this.currentContext=F},k.setCurrentScope=function(F){this.currentScope=F},k.evaluate=function(F){F===void 0&&(F="");var le;if(!!F)return le=Mt(F,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||E.ecmaVersion}),this.evaluateNode(le,F)},k.appendCode=function(F){return this.evaluate(F)},k.evaluateNode=function(F,le){var Ue=this;le===void 0&&(le=""),this.value=void 0,this.source=le,this.sourceList.push(le),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var yt=this.getCurrentScope(),Ot=this.getCurrentContext(),Nt=yt.labelStack.concat([]),Br=this.callStack.concat([]),Xr=function(){Ue.setCurrentScope(yt),Ue.setCurrentContext(Ot),yt.labelStack=Nt,Ue.callStack=Br};try{var Jn=this.createClosure(F);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Jn()}catch(Ki){throw Ki}finally{Xr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(F,le,Ue){var yt=F[1].replace("%0",String(le));return Ue!==null&&(yt+=this.getNodePosition(Ue||this.lastExecNode)),yt},k.createError=function(F,le){return new le(F)},k.createThrowError=function(F,le){return this.createError(F,le)},k.createInternalThrowError=function(F,le,Ue){return this.createError(this.createErrorMessage(F,le,Ue),F[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var F=this.options.timeout||0,le=Date.now();return le-this.execStartTime>F},k.getNodePosition=function(F){if(F){var le="";return F.loc?" ["+F.loc.start.line+":"+F.loc.start.column+"]"+le:""}return""},k.createClosure=function(F){var le=this,Ue;switch(F.type){case"BinaryExpression":Ue=this.binaryExpressionHandler(F);break;case"LogicalExpression":Ue=this.logicalExpressionHandler(F);break;case"UnaryExpression":Ue=this.unaryExpressionHandler(F);break;case"UpdateExpression":Ue=this.updateExpressionHandler(F);break;case"ObjectExpression":Ue=this.objectExpressionHandler(F);break;case"ArrayExpression":Ue=this.arrayExpressionHandler(F);break;case"CallExpression":Ue=this.callExpressionHandler(F);break;case"NewExpression":Ue=this.newExpressionHandler(F);break;case"MemberExpression":Ue=this.memberExpressionHandler(F);break;case"ThisExpression":Ue=this.thisExpressionHandler(F);break;case"SequenceExpression":Ue=this.sequenceExpressionHandler(F);break;case"Literal":Ue=this.literalHandler(F);break;case"Identifier":Ue=this.identifierHandler(F);break;case"AssignmentExpression":Ue=this.assignmentExpressionHandler(F);break;case"FunctionDeclaration":Ue=this.functionDeclarationHandler(F);break;case"VariableDeclaration":Ue=this.variableDeclarationHandler(F);break;case"BlockStatement":case"Program":Ue=this.programHandler(F);break;case"ExpressionStatement":Ue=this.expressionStatementHandler(F);break;case"EmptyStatement":Ue=this.emptyStatementHandler(F);break;case"ReturnStatement":Ue=this.returnStatementHandler(F);break;case"FunctionExpression":Ue=this.functionExpressionHandler(F);break;case"IfStatement":Ue=this.ifStatementHandler(F);break;case"ConditionalExpression":Ue=this.conditionalExpressionHandler(F);break;case"ForStatement":Ue=this.forStatementHandler(F);break;case"WhileStatement":Ue=this.whileStatementHandler(F);break;case"DoWhileStatement":Ue=this.doWhileStatementHandler(F);break;case"ForInStatement":Ue=this.forInStatementHandler(F);break;case"WithStatement":Ue=this.withStatementHandler(F);break;case"ThrowStatement":Ue=this.throwStatementHandler(F);break;case"TryStatement":Ue=this.tryStatementHandler(F);break;case"ContinueStatement":Ue=this.continueStatementHandler(F);break;case"BreakStatement":Ue=this.breakStatementHandler(F);break;case"SwitchStatement":Ue=this.switchStatementHandler(F);break;case"LabeledStatement":Ue=this.labeledStatementHandler(F);break;case"DebuggerStatement":Ue=this.debuggerStatementHandler(F);break;default:throw this.createInternalThrowError(ja.NodeTypeSyntaxError,F.type,F)}return function(){var yt=le.options.timeout;if(yt&&yt>0&&le.checkTimeout())throw le.createInternalThrowError(ja.ExecutionTimeOutError,yt,null);return le.lastExecNode=F,Ue.apply(void 0,arguments)}},k.binaryExpressionHandler=function(F){var le=this,Ue=this.createClosure(F.left),yt=this.createClosure(F.right);return function(){var Ot=Ue(),Nt=yt();switch(F.operator){case"==":return Ot==Nt;case"!=":return Ot!=Nt;case"===":return Ot===Nt;case"!==":return Ot!==Nt;case"<":return Ot<Nt;case"<=":return Ot<=Nt;case">":return Ot>Nt;case">=":return Ot>=Nt;case"<<":return Ot<<Nt;case">>":return Ot>>Nt;case">>>":return Ot>>>Nt;case"+":return Ot+Nt;case"-":return Ot-Nt;case"*":return Ot*Nt;case"**":return Math.pow(Ot,Nt);case"/":return Ot/Nt;case"%":return Ot%Nt;case"|":return Ot|Nt;case"^":return Ot^Nt;case"&":return Ot&Nt;case"in":return Ot in Nt;case"instanceof":return Ot instanceof Nt;default:throw le.createInternalThrowError(ja.BinaryOperatorSyntaxError,F.operator,F)}}},k.logicalExpressionHandler=function(F){var le=this,Ue=this.createClosure(F.left),yt=this.createClosure(F.right);return function(){switch(F.operator){case"||":return Ue()||yt();case"&&":return Ue()&&yt();default:throw le.createInternalThrowError(ja.LogicalOperatorSyntaxError,F.operator,F)}}},k.unaryExpressionHandler=function(F){var le=this;switch(F.operator){case"delete":var Ue=this.createObjectGetter(F.argument),yt=this.createNameGetter(F.argument);return function(){var Xr=Ue(),Jn=yt();return delete Xr[Jn]};default:var Ot;if(F.operator==="typeof"&&F.argument.type==="Identifier"){var Nt=this.createObjectGetter(F.argument),Br=this.createNameGetter(F.argument);Ot=function(){return Nt()[Br()]}}else Ot=this.createClosure(F.argument);return function(){var Xr=Ot();switch(F.operator){case"-":return-Xr;case"+":return+Xr;case"!":return!Xr;case"~":return~Xr;case"void":return;case"typeof":return typeof Xr;default:throw le.createInternalThrowError(ja.UnaryOperatorSyntaxError,F.operator,F)}}}},k.updateExpressionHandler=function(F){var le=this,Ue=this.createObjectGetter(F.argument),yt=this.createNameGetter(F.argument);return function(){var Ot=Ue(),Nt=yt();switch(le.assertVariable(Ot,Nt,F),F.operator){case"++":return F.prefix?++Ot[Nt]:Ot[Nt]++;case"--":return F.prefix?--Ot[Nt]:Ot[Nt]--;default:throw le.createInternalThrowError(ja.UpdateOperatorSyntaxError,F.operator,F)}}},k.objectExpressionHandler=function(F){var le=this,Ue=[];function yt(Nt){return Nt.type==="Identifier"?Nt.name:Nt.type==="Literal"?Nt.value:this.throwError(ja.ObjectStructureSyntaxError,Nt.type,Nt)}var Ot=Object.create(null);return F.properties.forEach(function(Nt){var Br=Nt.kind,Xr=yt(Nt.key);(!Ot[Xr]||Br==="init")&&(Ot[Xr]={}),Ot[Xr][Br]=le.createClosure(Nt.value),Ue.push({key:Xr,property:Nt})}),function(){for(var Nt={},Br=Ue.length,Xr=0;Xr<Br;Xr++){var Jn=Ue[Xr],Ki=Jn.key,ji=Ot[Ki],ha=ji.init?ji.init():void 0,Ka=ji.get?ji.get():function(){},xo=ji.set?ji.set():function(Kc){};if("set"in ji||"get"in ji){var Ta={configurable:!0,enumerable:!0,get:Ka,set:xo};Object.defineProperty(Nt,Ki,Ta)}else{var Hs=Jn.property,Bl=Hs.kind;Hs.key.type==="Identifier"&&Hs.value.type==="FunctionExpression"&&Bl==="init"&&!Hs.value.id&&ju(ha,Hs.key.name),Nt[Ki]=ha}}return Nt}},k.arrayExpressionHandler=function(F){var le=this,Ue=F.elements.map(function(yt){return yt&&le.createClosure(yt)});return function(){for(var yt=Ue.length,Ot=Array(yt),Nt=0;Nt<yt;Nt++){var Br=Ue[Nt];Br&&(Ot[Nt]=Br())}return Ot}},k.safeObjectGet=function(F,le,Ue){return F[le]},k.createCallFunctionGetter=function(F){var le=this;switch(F.type){case"MemberExpression":var Ue=this.createClosure(F.object),yt=this.createMemberKeyGetter(F),Ot=this.source;return function(){var Br=Ue(),Xr=yt(),Jn=le.safeObjectGet(Br,Xr,F);if(!Jn||!Da(Jn)){var Ki=Ot.slice(F.start,F.end);throw le.createInternalThrowError(ja.FunctionUndefinedReferenceError,Ki,F)}return Jn.__IS_EVAL_FUNC?function(ji){return Jn(new No(le),ji,!0)}:Jn.__IS_FUNCTION_FUNC?function(){for(var ji=arguments.length,ha=new Array(ji),Ka=0;Ka<ji;Ka++)ha[Ka]=arguments[Ka];return Jn.apply(void 0,[new No(le)].concat(ha))}:Jn.bind(Br)};default:var Nt=this.createClosure(F);return function(){var Br="";F.type==="Identifier"&&(Br=F.name);var Xr=Nt();if(!Xr||!Da(Xr))throw le.createInternalThrowError(ja.FunctionUndefinedReferenceError,Br,F);if(F.type==="Identifier"&&Xr.__IS_EVAL_FUNC&&Br==="eval")return function(ji){var ha=le.getScopeFromName(Br,le.getCurrentScope()),Ka=ha.name===ri||ha.name===Go||ha.name===_a;return Xr(new No(le),ji,!Ka)};if(Xr.__IS_EVAL_FUNC)return function(ji){return Xr(new No(le),ji,!0)};if(Xr.__IS_FUNCTION_FUNC)return function(){for(var ji=arguments.length,ha=new Array(ji),Ka=0;Ka<ji;Ka++)ha[Ka]=arguments[Ka];return Xr.apply(void 0,[new No(le)].concat(ha))};var Jn=le.options.globalContextInFunction;if(F.type==="Identifier"){var Ki=le.getIdentifierScope(F);Ki.name===En&&(Jn=Ki.data)}return Xr.bind(Jn)}}},k.callExpressionHandler=function(F){var le=this,Ue=this.createCallFunctionGetter(F.callee),yt=F.arguments.map(function(Ot){return le.createClosure(Ot)});return function(){return Ue().apply(void 0,yt.map(function(Ot){return Ot()}))}},k.functionExpressionHandler=function(F){var le=this,Ue=this,yt=this.source,Ot=this.collectDeclVars,Nt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Br=F.id?F.id.name:"",Xr=F.params.length,Jn=F.params.map(function(Ka){return le.createParamNameGetter(Ka)}),Ki=this.createClosure(F.body),ji=this.collectDeclVars,ha=this.collectDeclFuncs;return this.collectDeclVars=Ot,this.collectDeclFuncs=Nt,function(){var Ka=Ue.getCurrentScope(),xo=function Ta(){for(var Hs=arguments.length,Bl=new Array(Hs),Kc=0;Kc<Hs;Kc++)Bl[Kc]=arguments[Kc];Ue.callStack.push(""+Br);var Qc=Ue.getCurrentScope(),Tc=xu(Ka,"FunctionScope("+Br+")");Ue.setCurrentScope(Tc),Ue.addDeclarationsToScope(ji,ha,Tc),Br&&(Tc.data[Br]=Ta),Tc.data.arguments=arguments,Jn.forEach(function(Nl,xl){Tc.data[Nl()]=Bl[xl]});var Mc=Ue.getCurrentContext();Ue.setCurrentContext(this);var Pu=Ki();if(Ue.setCurrentContext(Mc),Ue.setCurrentScope(Qc),Ue.callStack.pop(),Pu instanceof Ls)return Pu.value};return ju(xo,Br),Object.defineProperty(xo,"length",{value:Xr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(xo,"toString",{value:function(){return yt.slice(F.start,F.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(xo,"valueOf",{value:function(){return yt.slice(F.start,F.end)},writable:!0,configurable:!0,enumerable:!1}),xo}},k.newExpressionHandler=function(F){var le=this,Ue=this.source,yt=this.createClosure(F.callee),Ot=F.arguments.map(function(Nt){return le.createClosure(Nt)});return function(){var Nt=yt();if(!Da(Nt)||Nt.__IS_EVAL_FUNC){var Br=F.callee,Xr=Ue.slice(Br.start,Br.end);throw le.createInternalThrowError(ja.IsNotConstructor,Xr,F)}return Nt.__IS_FUNCTION_FUNC?Nt.apply(void 0,[new No(le)].concat(Ot.map(function(Jn){return Jn()}))):vs(Nt,Ot.map(function(Jn){return Jn()}))}},k.memberExpressionHandler=function(F){var le=this.createClosure(F.object),Ue=this.createMemberKeyGetter(F);return function(){var yt=le(),Ot=Ue();return yt[Ot]}},k.thisExpressionHandler=function(F){var le=this;return function(){return le.getCurrentContext()}},k.sequenceExpressionHandler=function(F){var le=this,Ue=F.expressions.map(function(yt){return le.createClosure(yt)});return function(){for(var yt,Ot=Ue.length,Nt=0;Nt<Ot;Nt++){var Br=Ue[Nt];yt=Br()}return yt}},k.literalHandler=function(F){return function(){return F.regex?new RegExp(F.regex.pattern,F.regex.flags):F.value}},k.identifierHandler=function(F){var le=this;return function(){var Ue=le.getCurrentScope(),yt=le.getScopeDataFromName(F.name,Ue);return le.assertVariable(yt,F.name,F),yt[F.name]}},k.getIdentifierScope=function(F){var le=this.getCurrentScope(),Ue=this.getScopeFromName(F.name,le);return Ue},k.assignmentExpressionHandler=function(F){var le=this;F.left.type==="Identifier"&&F.right.type==="FunctionExpression"&&!F.right.id&&(F.right.id={type:"Identifier",name:F.left.name});var Ue=this.createObjectGetter(F.left),yt=this.createNameGetter(F.left),Ot=this.createClosure(F.right);return function(){var Nt=Ue(),Br=yt(),Xr=Ot();switch(F.operator!=="="&&le.assertVariable(Nt,Br,F),F.operator){case"=":return Nt[Br]=Xr;case"+=":return Nt[Br]+=Xr;case"-=":return Nt[Br]-=Xr;case"*=":return Nt[Br]*=Xr;case"**=":return Nt[Br]=Math.pow(Nt[Br],Xr);case"/=":return Nt[Br]/=Xr;case"%=":return Nt[Br]%=Xr;case"<<=":return Nt[Br]<<=Xr;case">>=":return Nt[Br]>>=Xr;case">>>=":return Nt[Br]>>>=Xr;case"&=":return Nt[Br]&=Xr;case"^=":return Nt[Br]^=Xr;case"|=":return Nt[Br]|=Xr;default:throw le.createInternalThrowError(ja.AssignmentExpressionSyntaxError,F.type,F)}}},k.functionDeclarationHandler=function(F){if(F.id){var le=this.functionExpressionHandler(F);Object.defineProperty(le,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(F.id.name,le)}return function(){return hr}},k.getVariableName=function(F){if(F.type==="Identifier")return F.name;throw this.createInternalThrowError(ja.VariableTypeSyntaxError,F.type,F)},k.variableDeclarationHandler=function(F){for(var le=this,Ue,yt=[],Ot=0;Ot<F.declarations.length;Ot++){var Nt=F.declarations[Ot];this.varDeclaration(this.getVariableName(Nt.id)),Nt.init&&yt.push({type:"AssignmentExpression",operator:"=",left:Nt.id,right:Nt.init})}return yt.length&&(Ue=this.createClosure({type:"BlockStatement",body:yt})),function(){if(Ue){var Br=le.isVarDeclMode;le.isVarDeclMode=!0,Ue(),le.isVarDeclMode=Br}return hr}},k.assertVariable=function(F,le,Ue){if(F===this.globalScope.data&&!(le in F))throw this.createInternalThrowError(ja.VariableUndefinedReferenceError,le,Ue)},k.programHandler=function(F){var le=this,Ue=F.body.map(function(yt){return le.createClosure(yt)});return function(){for(var yt=hr,Ot=0;Ot<Ue.length;Ot++){var Nt=Ue[Ot],Br=le.setValue(Nt());if(Br!==hr&&(yt=Br,yt instanceof Ls||yt instanceof Qs||yt instanceof uu||yt===ye||yt===Ze))break}return yt}},k.expressionStatementHandler=function(F){return this.createClosure(F.expression)},k.emptyStatementHandler=function(F){return function(){return hr}},k.returnStatementHandler=function(F){var le=F.argument?this.createClosure(F.argument):Gu;return function(){return new Ls(le())}},k.ifStatementHandler=function(F){var le=this.createClosure(F.test),Ue=this.createClosure(F.consequent),yt=F.alternate?this.createClosure(F.alternate):function(){return hr};return function(){return le()?Ue():yt()}},k.conditionalExpressionHandler=function(F){return this.ifStatementHandler(F)},k.forStatementHandler=function(F){var le=this,Ue=Gu,yt=F.test?this.createClosure(F.test):function(){return!0},Ot=Gu,Nt=this.createClosure(F.body);return F.type==="ForStatement"&&(Ue=F.init?this.createClosure(F.init):Ue,Ot=F.update?this.createClosure(F.update):Gu),function(Br){var Xr,Jn=hr,Ki=F.type==="DoWhileStatement";for(Br&&Br.type==="LabeledStatement"&&(Xr=Br.label.name),Ue();Ki||yt();Ot()){Ki=!1;var ji=le.setValue(Nt());if(!(ji===hr||ji===Ze)){if(ji===ye)break;if(Jn=ji,Jn instanceof uu&&Jn.value===Xr){Jn=hr;continue}if(Jn instanceof Ls||Jn instanceof Qs||Jn instanceof uu)break}}return Jn}},k.whileStatementHandler=function(F){return this.forStatementHandler(F)},k.doWhileStatementHandler=function(F){return this.forStatementHandler(F)},k.forInStatementHandler=function(F){var le=this,Ue=F.left,yt=this.createClosure(F.right),Ot=this.createClosure(F.body);return F.left.type==="VariableDeclaration"&&(this.createClosure(F.left)(),Ue=F.left.declarations[0].id),function(Nt){var Br,Xr=hr,Jn;Nt&&Nt.type==="LabeledStatement"&&(Br=Nt.label.name);var Ki=yt();for(Jn in Ki){le.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ue,right:{type:"Literal",value:Jn}})();var ji=le.setValue(Ot());if(!(ji===hr||ji===Ze)){if(ji===ye)break;if(Xr=ji,Xr instanceof uu&&Xr.value===Br){Xr=hr;continue}if(Xr instanceof Ls||Xr instanceof Qs||Xr instanceof uu)break}}return Xr}},k.withStatementHandler=function(F){var le=this,Ue=this.createClosure(F.object),yt=this.createClosure(F.body);return function(){var Ot=Ue(),Nt=le.getCurrentScope(),Br=new _u(Ot,Nt,En);le.setCurrentScope(Br);var Xr=le.setValue(yt());return le.setCurrentScope(Nt),Xr}},k.throwStatementHandler=function(F){var le=this,Ue=this.createClosure(F.argument);return function(){throw le.setValue(void 0),Ue()}},k.tryStatementHandler=function(F){var le=this,Ue=this.createClosure(F.block),yt=F.handler?this.catchClauseHandler(F.handler):null,Ot=F.finalizer?this.createClosure(F.finalizer):null;return function(){var Nt=le.getCurrentScope(),Br=le.getCurrentContext(),Xr=Nt.labelStack.concat([]),Jn=le.callStack.concat([]),Ki=hr,ji,ha,Ka=function(){le.setCurrentScope(Nt),le.setCurrentContext(Br),Nt.labelStack=Xr,le.callStack=Jn};try{Ki=le.setValue(Ue()),Ki instanceof Ls&&(ji=Ki)}catch(xo){if(Ka(),le.isInterruptThrow(xo))throw xo;if(yt)try{Ki=le.setValue(yt(xo)),Ki instanceof Ls&&(ji=Ki)}catch(Ta){if(Ka(),le.isInterruptThrow(Ta))throw Ta;ha=Ta}}if(Ot)try{Ki=Ot(),Ki instanceof Ls&&(ji=Ki)}catch(xo){if(Ka(),le.isInterruptThrow(xo))throw xo;ha=xo}if(ha)throw ha;return ji||Ki}},k.catchClauseHandler=function(F){var le=this,Ue=this.createParamNameGetter(F.param),yt=this.createClosure(F.body);return function(Ot){var Nt,Br=le.getCurrentScope(),Xr=Br.data,Jn=Ue(),Ki=jo.call(Xr,Jn),ji=Xr[Jn];return Xr[Jn]=Ot,Nt=yt(),Ki?Xr[Jn]=ji:delete Xr[Jn],Nt}},k.continueStatementHandler=function(F){return function(){return F.label?new uu(F.label.name):Ze}},k.breakStatementHandler=function(F){return function(){return F.label?new Qs(F.label.name):ye}},k.switchStatementHandler=function(F){var le=this,Ue=this.createClosure(F.discriminant),yt=F.cases.map(function(Ot){return le.switchCaseHandler(Ot)});return function(){for(var Ot=Ue(),Nt=!1,Br,Xr,Jn,Ki=0;Ki<yt.length;Ki++){var ji=yt[Ki](),ha=ji.testClosure();if(ha===Ct){Jn=ji;continue}if(Nt||ha===Ot){if(Nt=!0,Xr=le.setValue(ji.bodyClosure()),Xr===hr)continue;if(Xr===ye||(Br=Xr,Br instanceof Ls||Br instanceof Qs||Br instanceof uu||Br===Ze))break}}if(!Nt&&Jn){Xr=le.setValue(Jn.bodyClosure());var Ka=Xr===hr||Xr===ye||Xr===Ze;Ka||(Br=Xr)}return Br}},k.switchCaseHandler=function(F){var le=F.test?this.createClosure(F.test):function(){return Ct},Ue=this.createClosure({type:"BlockStatement",body:F.consequent});return function(){return{testClosure:le,bodyClosure:Ue}}},k.labeledStatementHandler=function(F){var le=this,Ue=F.label.name,yt=this.createClosure(F.body);return function(){var Ot,Nt=le.getCurrentScope();return Nt.labelStack.push(Ue),Ot=yt(F),Ot instanceof Qs&&Ot.value===Ue&&(Ot=hr),Nt.labelStack.pop(),Ot}},k.debuggerStatementHandler=function(F){return function(){debugger;return hr}},k.createParamNameGetter=function(F){if(F.type==="Identifier")return function(){return F.name};throw this.createInternalThrowError(ja.ParamTypeSyntaxError,F.type,F)},k.createObjectKeyGetter=function(F){var le;return F.type==="Identifier"?le=function(){return F.name}:le=this.createClosure(F),function(){return le()}},k.createMemberKeyGetter=function(F){return F.computed?this.createClosure(F.property):this.createObjectKeyGetter(F.property)},k.createObjectGetter=function(F){var le=this;switch(F.type){case"Identifier":return function(){return le.getScopeDataFromName(F.name,le.getCurrentScope())};case"MemberExpression":return this.createClosure(F.object);default:throw this.createInternalThrowError(ja.AssignmentTypeSyntaxError,F.type,F)}},k.createNameGetter=function(F){switch(F.type){case"Identifier":return function(){return F.name};case"MemberExpression":return this.createMemberKeyGetter(F);default:throw this.createInternalThrowError(ja.AssignmentTypeSyntaxError,F.type,F)}},k.varDeclaration=function(F){var le=this.collectDeclVars;le[F]=void 0},k.funcDeclaration=function(F,le){var Ue=this.collectDeclFuncs;Ue[F]=le},k.addDeclarationsToScope=function(F,le,Ue){var yt=Ue.data;for(var Ot in le){var Nt=le[Ot];yt[Ot]=Nt&&Nt()}for(var Br in F)Br in yt||(yt[Br]=void 0)},k.getScopeValue=function(F,le){var Ue=this.getScopeFromName(F,le);return Ue.data[F]},k.getScopeDataFromName=function(F,le){return this.getScopeFromName(F,le).data},k.getScopeFromName=function(F,le){var Ue=le;do if(F in Ue.data)return Ue;while(Ue=Ue.parent);return this.globalScope},k.setValue=function(F){var le=this.callStack.length;return this.isVarDeclMode||le||F===hr||F===ye||F===Ze||F instanceof Qs||F instanceof uu||(this.value=F instanceof Ls?F.value:F),F},k.getValue=function(){return this.value},E}();Cs.version=Ju,Cs.eval=So,Cs.Function=oo,Cs.ecmaVersion=5,Cs.globalContextInFunction=void 0,Cs.global=Object.create(null);function Ch(E){return E===void 0&&(E=Object.create(null)),E}function el(E,k,H){k===void 0&&(k=[]),H===void 0&&(H={});var F=H.parsingContext,le=H.timeout===void 0?0:H.timeout,Ue=`
    (function anonymous(`+k.join(",")+`){
         `+E+`
    });
    `,yt=new Cs(F,{ecmaVersion:H.ecmaVersion,timeout:le,rootContext:H.rootContext,globalContextInFunction:H.globalContextInFunction});return yt.evaluate(Ue)}function mf(E,k,H){var F=new Cs(k,H);return F.evaluate(E)}var qf=mf,yl=function(){function E(H){this._code=H}var k=E.prototype;return k.runInContext=function(F){return mf(this._code,F)},k.runInNewContext=function(F){return mf(this._code,F)},E}(),wc=function(E,k,H){return mf(E,k,H)};function _l(){for(var E=arguments.length,k=new Array(E),H=0;H<E;H++)k[H]=arguments[H];var F=k.pop();return el(F||"",k)}var gf=wc},20396:function(wn,Ee,ue){var Re;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ge,y,Fe,K){"use strict";var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ve=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),at=Me||ve,se=["","webkit","Moz","MS","ms","o"],Be=at?"":y.createElement("div"),dt="function",rt=Math.round,Et=Math.abs,Vt=Date.now;function Ut(ye,Ze,Ct){return setTimeout(Dt(ye,Ct),Ze)}function lr(ye,Ze,Ct){return Array.isArray(ye)?(Qt(ye,Ct[Ze],Ct),!0):!1}function Qt(ye,Ze,Ct){var hr;if(!!ye)if(ye.forEach)ye.forEach(Ze,Ct);else if(ye.length!==K)for(hr=0;hr<ye.length;)Ze.call(Ct,ye[hr],hr,ye),hr++;else for(hr in ye)ye.hasOwnProperty(hr)&&Ze.call(Ct,ye[hr],hr,ye)}function It(ye,Ze,Ct){var hr="DEPRECATED METHOD: "+Ze+`
`+Ct+` AT 
`;return function(){var En=new Error("get-stack-trace"),ri=En&&En.stack?En.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",_a=ge.console&&(ge.console.warn||ge.console.log);return _a&&_a.call(ge.console,hr,ri),ye.apply(this,arguments)}}var Lt;typeof Object.assign!="function"?Lt=function(Ze){if(Ze===K||Ze===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ct=Object(Ze),hr=1;hr<arguments.length;hr++){var En=arguments[hr];if(En!==K&&En!==null)for(var ri in En)En.hasOwnProperty(ri)&&(Ct[ri]=En[ri])}return Ct}:Lt=Object.assign;var fr=It(function(Ze,Ct,hr){for(var En=Object.keys(Ct),ri=0;ri<En.length;)(!hr||hr&&Ze[En[ri]]===K)&&(Ze[En[ri]]=Ct[En[ri]]),ri++;return Ze},"extend","Use `assign`."),ie=It(function(Ze,Ct){return fr(Ze,Ct,!0)},"merge","Use `assign`.");function yr(ye,Ze,Ct){var hr=Ze.prototype,En;En=ye.prototype=Object.create(hr),En.constructor=ye,En._super=hr,Ct&&Lt(En,Ct)}function Dt(ye,Ze){return function(){return ye.apply(Ze,arguments)}}function xt(ye,Ze){return typeof ye==dt?ye.apply(Ze&&Ze[0]||K,Ze):ye}function Jt(ye,Ze){return ye===K?Ze:ye}function je(ye,Ze,Ct){Qt(Se(Ze),function(hr){ye.addEventListener(hr,Ct,!1)})}function Sr(ye,Ze,Ct){Qt(Se(Ze),function(hr){ye.removeEventListener(hr,Ct,!1)})}function tn(ye,Ze){for(;ye;){if(ye==Ze)return!0;ye=ye.parentNode}return!1}function re(ye,Ze){return ye.indexOf(Ze)>-1}function Se(ye){return ye.trim().split(/\s+/g)}function V(ye,Ze,Ct){if(ye.indexOf&&!Ct)return ye.indexOf(Ze);for(var hr=0;hr<ye.length;){if(Ct&&ye[hr][Ct]==Ze||!Ct&&ye[hr]===Ze)return hr;hr++}return-1}function Q(ye){return Array.prototype.slice.call(ye,0)}function Le(ye,Ze,Ct){for(var hr=[],En=[],ri=0;ri<ye.length;){var _a=Ze?ye[ri][Ze]:ye[ri];V(En,_a)<0&&hr.push(ye[ri]),En[ri]=_a,ri++}return Ct&&(Ze?hr=hr.sort(function(Da,No){return Da[Ze]>No[Ze]}):hr=hr.sort()),hr}function ht(ye,Ze){for(var Ct,hr,En=Ze[0].toUpperCase()+Ze.slice(1),ri=0;ri<se.length;){if(Ct=se[ri],hr=Ct?Ct+En:Ze,hr in ye)return hr;ri++}return K}var wt=1;function er(){return wt++}function Tt(ye){var Ze=ye.ownerDocument||ye;return Ze.defaultView||Ze.parentWindow||ge}var vr=/mobile|tablet|ip(ad|hone|od)|android/i,ln="ontouchstart"in ge,sn=ht(ge,"PointerEvent")!==K,Mi=ln&&vr.test(navigator.userAgent),vi="touch",en="pen",Oa="mouse",ra="kinect",Vi=25,ya=1,fi=2,$i=4,hi=8,yi=1,ss=2,yo=4,qa=8,Ft=16,be=ss|yo,he=qa|Ft,Ie=be|he,G=["x","y"],lt=["clientX","clientY"];function sr(ye,Ze){var Ct=this;this.manager=ye,this.callback=Ze,this.element=ye.element,this.target=ye.options.inputTarget,this.domHandler=function(hr){xt(ye.options.enable,[ye])&&Ct.handler(hr)},this.init()}sr.prototype={handler:function(){},init:function(){this.evEl&&je(this.element,this.evEl,this.domHandler),this.evTarget&&je(this.target,this.evTarget,this.domHandler),this.evWin&&je(Tt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Sr(this.element,this.evEl,this.domHandler),this.evTarget&&Sr(this.target,this.evTarget,this.domHandler),this.evWin&&Sr(Tt(this.element),this.evWin,this.domHandler)}};function Jr(ye){var Ze,Ct=ye.options.inputClass;return Ct?Ze=Ct:sn?Ze=qe:Mi?Ze=mr:ln?Ze=ar:Ze=pa,new Ze(ye,nt)}function nt(ye,Ze,Ct){var hr=Ct.pointers.length,En=Ct.changedPointers.length,ri=Ze&ya&&hr-En==0,_a=Ze&($i|hi)&&hr-En==0;Ct.isFirst=!!ri,Ct.isFinal=!!_a,ri&&(ye.session={}),Ct.eventType=Ze,Gt(ye,Ct),ye.emit("hammer.input",Ct),ye.recognize(Ct),ye.session.prevInput=Ct}function Gt(ye,Ze){var Ct=ye.session,hr=Ze.pointers,En=hr.length;Ct.firstInput||(Ct.firstInput=Rr(Ze)),En>1&&!Ct.firstMultiple?Ct.firstMultiple=Rr(Ze):En===1&&(Ct.firstMultiple=!1);var ri=Ct.firstInput,_a=Ct.firstMultiple,Go=_a?_a.center:ri.center,Da=Ze.center=mn(hr);Ze.timeStamp=Vt(),Ze.deltaTime=Ze.timeStamp-ri.timeStamp,Ze.angle=Ri(Go,Da),Ze.distance=Tn(Go,Da),Ar(Ct,Ze),Ze.offsetDirection=ai(Ze.deltaX,Ze.deltaY);var No=mi(Ze.deltaTime,Ze.deltaX,Ze.deltaY);Ze.overallVelocityX=No.x,Ze.overallVelocityY=No.y,Ze.overallVelocity=Et(No.x)>Et(No.y)?No.x:No.y,Ze.scale=_a?ka(_a.pointers,hr):1,Ze.rotation=_a?zi(_a.pointers,hr):0,Ze.maxPointers=Ct.prevInput?Ze.pointers.length>Ct.prevInput.maxPointers?Ze.pointers.length:Ct.prevInput.maxPointers:Ze.pointers.length,Tr(Ct,Ze);var So=ye.element;tn(Ze.srcEvent.target,So)&&(So=Ze.srcEvent.target),Ze.target=So}function Ar(ye,Ze){var Ct=Ze.center,hr=ye.offsetDelta||{},En=ye.prevDelta||{},ri=ye.prevInput||{};(Ze.eventType===ya||ri.eventType===$i)&&(En=ye.prevDelta={x:ri.deltaX||0,y:ri.deltaY||0},hr=ye.offsetDelta={x:Ct.x,y:Ct.y}),Ze.deltaX=En.x+(Ct.x-hr.x),Ze.deltaY=En.y+(Ct.y-hr.y)}function Tr(ye,Ze){var Ct=ye.lastInterval||Ze,hr=Ze.timeStamp-Ct.timeStamp,En,ri,_a,Go;if(Ze.eventType!=hi&&(hr>Vi||Ct.velocity===K)){var Da=Ze.deltaX-Ct.deltaX,No=Ze.deltaY-Ct.deltaY,So=mi(hr,Da,No);ri=So.x,_a=So.y,En=Et(So.x)>Et(So.y)?So.x:So.y,Go=ai(Da,No),ye.lastInterval=Ze}else En=Ct.velocity,ri=Ct.velocityX,_a=Ct.velocityY,Go=Ct.direction;Ze.velocity=En,Ze.velocityX=ri,Ze.velocityY=_a,Ze.direction=Go}function Rr(ye){for(var Ze=[],Ct=0;Ct<ye.pointers.length;)Ze[Ct]={clientX:rt(ye.pointers[Ct].clientX),clientY:rt(ye.pointers[Ct].clientY)},Ct++;return{timeStamp:Vt(),pointers:Ze,center:mn(Ze),deltaX:ye.deltaX,deltaY:ye.deltaY}}function mn(ye){var Ze=ye.length;if(Ze===1)return{x:rt(ye[0].clientX),y:rt(ye[0].clientY)};for(var Ct=0,hr=0,En=0;En<Ze;)Ct+=ye[En].clientX,hr+=ye[En].clientY,En++;return{x:rt(Ct/Ze),y:rt(hr/Ze)}}function mi(ye,Ze,Ct){return{x:Ze/ye||0,y:Ct/ye||0}}function ai(ye,Ze){return ye===Ze?yi:Et(ye)>=Et(Ze)?ye<0?ss:yo:Ze<0?qa:Ft}function Tn(ye,Ze,Ct){Ct||(Ct=G);var hr=Ze[Ct[0]]-ye[Ct[0]],En=Ze[Ct[1]]-ye[Ct[1]];return Math.sqrt(hr*hr+En*En)}function Ri(ye,Ze,Ct){Ct||(Ct=G);var hr=Ze[Ct[0]]-ye[Ct[0]],En=Ze[Ct[1]]-ye[Ct[1]];return Math.atan2(En,hr)*180/Math.PI}function zi(ye,Ze){return Ri(Ze[1],Ze[0],lt)+Ri(ye[1],ye[0],lt)}function ka(ye,Ze){return Tn(Ze[0],Ze[1],lt)/Tn(ye[0],ye[1],lt)}var ia={mousedown:ya,mousemove:fi,mouseup:$i},io="mousedown",Ci="mousemove mouseup";function pa(){this.evEl=io,this.evWin=Ci,this.pressed=!1,sr.apply(this,arguments)}yr(pa,sr,{handler:function(Ze){var Ct=ia[Ze.type];Ct&ya&&Ze.button===0&&(this.pressed=!0),Ct&fi&&Ze.which!==1&&(Ct=$i),!!this.pressed&&(Ct&$i&&(this.pressed=!1),this.callback(this.manager,Ct,{pointers:[Ze],changedPointers:[Ze],pointerType:Oa,srcEvent:Ze}))}});var ee={pointerdown:ya,pointermove:fi,pointerup:$i,pointercancel:hi,pointerout:hi},ce={2:vi,3:en,4:Oa,5:ra},xe="pointerdown",Oe="pointermove pointerup pointercancel";!at&&ge.MSPointerEvent&&!ge.PointerEvent&&(xe="MSPointerDown",Oe="MSPointerMove MSPointerUp MSPointerCancel");function qe(){this.evEl=xe,this.evWin=Oe,sr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}yr(qe,sr,{handler:function(Ze){var Ct=this.store,hr=!1,En=Ze.type.toLowerCase().replace("ms",""),ri=ee[En],_a=ce[Ze.pointerType]||Ze.pointerType,Go=_a==vi,Da=V(Ct,Ze.pointerId,"pointerId");ri&ya&&(Ze.button===0||Go)?Da<0&&(Ct.push(Ze),Da=Ct.length-1):ri&($i|hi)&&(hr=!0),!(Da<0)&&(Ct[Da]=Ze,this.callback(this.manager,ri,{pointers:Ct,changedPointers:[Ze],pointerType:_a,srcEvent:Ze}),hr&&Ct.splice(Da,1))}});var ct={touchstart:ya,touchmove:fi,touchend:$i,touchcancel:hi},St="touchstart",ke="touchstart touchmove touchend touchcancel";function it(){this.evTarget=St,this.evWin=ke,this.started=!1,sr.apply(this,arguments)}yr(it,sr,{handler:function(Ze){var Ct=ct[Ze.type];if(Ct===ya&&(this.started=!0),!!this.started){var hr=Yt.call(this,Ze,Ct);Ct&($i|hi)&&hr[0].length-hr[1].length==0&&(this.started=!1),this.callback(this.manager,Ct,{pointers:hr[0],changedPointers:hr[1],pointerType:vi,srcEvent:Ze})}}});function Yt(ye,Ze){var Ct=Q(ye.touches),hr=Q(ye.changedTouches);return Ze&($i|hi)&&(Ct=Le(Ct.concat(hr),"identifier",!0)),[Ct,hr]}var jr={touchstart:ya,touchmove:fi,touchend:$i,touchcancel:hi},or="touchstart touchmove touchend touchcancel";function mr(){this.evTarget=or,this.targetIds={},sr.apply(this,arguments)}yr(mr,sr,{handler:function(Ze){var Ct=jr[Ze.type],hr=Hr.call(this,Ze,Ct);!hr||this.callback(this.manager,Ct,{pointers:hr[0],changedPointers:hr[1],pointerType:vi,srcEvent:Ze})}});function Hr(ye,Ze){var Ct=Q(ye.touches),hr=this.targetIds;if(Ze&(ya|fi)&&Ct.length===1)return hr[Ct[0].identifier]=!0,[Ct,Ct];var En,ri,_a=Q(ye.changedTouches),Go=[],Da=this.target;if(ri=Ct.filter(function(No){return tn(No.target,Da)}),Ze===ya)for(En=0;En<ri.length;)hr[ri[En].identifier]=!0,En++;for(En=0;En<_a.length;)hr[_a[En].identifier]&&Go.push(_a[En]),Ze&($i|hi)&&delete hr[_a[En].identifier],En++;if(!!Go.length)return[Le(ri.concat(Go),"identifier",!0),Go]}var si=2500,Mn=25;function ar(){sr.apply(this,arguments);var ye=Dt(this.handler,this);this.touch=new mr(this.manager,ye),this.mouse=new pa(this.manager,ye),this.primaryTouch=null,this.lastTouches=[]}yr(ar,sr,{handler:function(Ze,Ct,hr){var En=hr.pointerType==vi,ri=hr.pointerType==Oa;if(!(ri&&hr.sourceCapabilities&&hr.sourceCapabilities.firesTouchEvents)){if(En)Yn.call(this,Ct,hr);else if(ri&&gn.call(this,hr))return;this.callback(Ze,Ct,hr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Yn(ye,Ze){ye&ya?(this.primaryTouch=Ze.changedPointers[0].identifier,Pr.call(this,Ze)):ye&($i|hi)&&Pr.call(this,Ze)}function Pr(ye){var Ze=ye.changedPointers[0];if(Ze.identifier===this.primaryTouch){var Ct={x:Ze.clientX,y:Ze.clientY};this.lastTouches.push(Ct);var hr=this.lastTouches,En=function(){var ri=hr.indexOf(Ct);ri>-1&&hr.splice(ri,1)};setTimeout(En,si)}}function gn(ye){for(var Ze=ye.srcEvent.clientX,Ct=ye.srcEvent.clientY,hr=0;hr<this.lastTouches.length;hr++){var En=this.lastTouches[hr],ri=Math.abs(Ze-En.x),_a=Math.abs(Ct-En.y);if(ri<=Mn&&_a<=Mn)return!0}return!1}var ea=at?K:ht(Be.style,"touchAction"),Vn=ea!==K,na="compute",Ht="auto",Rt="manipulation",da="none",aa="pan-x",Di="pan-y",Ii=Or();function _o(ye,Ze){this.manager=ye,this.set(Ze)}_o.prototype={set:function(ye){ye==na&&(ye=this.compute()),Vn&&this.manager.element.style&&Ii[ye]&&(this.manager.element.style[ea]=ye),this.actions=ye.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ye=[];return Qt(this.manager.recognizers,function(Ze){xt(Ze.options.enable,[Ze])&&(ye=ye.concat(Ze.getTouchAction()))}),Na(ye.join(" "))},preventDefaults:function(ye){var Ze=ye.srcEvent,Ct=ye.offsetDirection;if(this.manager.session.prevented){Ze.preventDefault();return}var hr=this.actions,En=re(hr,da)&&!Ii[da],ri=re(hr,Di)&&!Ii[Di],_a=re(hr,aa)&&!Ii[aa];if(En){var Go=ye.pointers.length===1,Da=ye.distance<2,No=ye.deltaTime<250;if(Go&&Da&&No)return}if(!(_a&&ri)&&(En||ri&&Ct&be||_a&&Ct&he))return this.preventSrc(Ze)},preventSrc:function(ye){this.manager.session.prevented=!0,ye.preventDefault()}};function Na(ye){if(re(ye,da))return da;var Ze=re(ye,aa),Ct=re(ye,Di);return Ze&&Ct?da:Ze||Ct?Ze?aa:Di:re(ye,Rt)?Rt:Ht}function Or(){if(!Vn)return!1;var ye={};if(at)return ye;var Ze=ge.CSS&&ge.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ct){ye[Ct]=Ze?ge.CSS.supports("touch-action",Ct):!0}),ye}var Dr=1,Mt=2,us=4,At=8,ao=At,yu=16,Jo=32;function Bi(ye){this.options=Lt({},this.defaults,ye||{}),this.id=er(),this.manager=null,this.options.enable=Jt(this.options.enable,!0),this.state=Dr,this.simultaneous={},this.requireFail=[]}Bi.prototype={defaults:{},set:function(ye){return Lt(this.options,ye),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ye){if(lr(ye,"recognizeWith",this))return this;var Ze=this.simultaneous;return ye=Lo(ye,this),Ze[ye.id]||(Ze[ye.id]=ye,ye.recognizeWith(this)),this},dropRecognizeWith:function(ye){return lr(ye,"dropRecognizeWith",this)?this:(ye=Lo(ye,this),delete this.simultaneous[ye.id],this)},requireFailure:function(ye){if(lr(ye,"requireFailure",this))return this;var Ze=this.requireFail;return ye=Lo(ye,this),V(Ze,ye)===-1&&(Ze.push(ye),ye.requireFailure(this)),this},dropRequireFailure:function(ye){if(lr(ye,"dropRequireFailure",this))return this;ye=Lo(ye,this);var Ze=V(this.requireFail,ye);return Ze>-1&&this.requireFail.splice(Ze,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ye){return!!this.simultaneous[ye.id]},emit:function(ye){var Ze=this,Ct=this.state;function hr(En){Ze.manager.emit(En,ye)}Ct<At&&hr(Ze.options.event+gl(Ct)),hr(Ze.options.event),ye.additionalEvent&&hr(ye.additionalEvent),Ct>=At&&hr(Ze.options.event+gl(Ct))},tryEmit:function(ye){if(this.canEmit())return this.emit(ye);this.state=Jo},canEmit:function(){for(var ye=0;ye<this.requireFail.length;){if(!(this.requireFail[ye].state&(Jo|Dr)))return!1;ye++}return!0},recognize:function(ye){var Ze=Lt({},ye);if(!xt(this.options.enable,[this,Ze])){this.reset(),this.state=Jo;return}this.state&(ao|yu|Jo)&&(this.state=Dr),this.state=this.process(Ze),this.state&(Mt|us|At|yu)&&this.tryEmit(Ze)},process:function(ye){},getTouchAction:function(){},reset:function(){}};function gl(ye){return ye&yu?"cancel":ye&At?"end":ye&us?"move":ye&Mt?"start":""}function Ra(ye){return ye==Ft?"down":ye==qa?"up":ye==ss?"left":ye==yo?"right":""}function Lo(ye,Ze){var Ct=Ze.manager;return Ct?Ct.get(ye):ye}function Do(){Bi.apply(this,arguments)}yr(Do,Bi,{defaults:{pointers:1},attrTest:function(ye){var Ze=this.options.pointers;return Ze===0||ye.pointers.length===Ze},process:function(ye){var Ze=this.state,Ct=ye.eventType,hr=Ze&(Mt|us),En=this.attrTest(ye);return hr&&(Ct&hi||!En)?Ze|yu:hr||En?Ct&$i?Ze|At:Ze&Mt?Ze|us:Mt:Jo}});function Ea(){Do.apply(this,arguments),this.pX=null,this.pY=null}yr(Ea,Do,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ie},getTouchAction:function(){var ye=this.options.direction,Ze=[];return ye&be&&Ze.push(Di),ye&he&&Ze.push(aa),Ze},directionTest:function(ye){var Ze=this.options,Ct=!0,hr=ye.distance,En=ye.direction,ri=ye.deltaX,_a=ye.deltaY;return En&Ze.direction||(Ze.direction&be?(En=ri===0?yi:ri<0?ss:yo,Ct=ri!=this.pX,hr=Math.abs(ye.deltaX)):(En=_a===0?yi:_a<0?qa:Ft,Ct=_a!=this.pY,hr=Math.abs(ye.deltaY))),ye.direction=En,Ct&&hr>Ze.threshold&&En&Ze.direction},attrTest:function(ye){return Do.prototype.attrTest.call(this,ye)&&(this.state&Mt||!(this.state&Mt)&&this.directionTest(ye))},emit:function(ye){this.pX=ye.deltaX,this.pY=ye.deltaY;var Ze=Ra(ye.direction);Ze&&(ye.additionalEvent=this.options.event+Ze),this._super.emit.call(this,ye)}});function Ps(){Do.apply(this,arguments)}yr(Ps,Do,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[da]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.scale-1)>this.options.threshold||this.state&Mt)},emit:function(ye){if(ye.scale!==1){var Ze=ye.scale<1?"in":"out";ye.additionalEvent=this.options.event+Ze}this._super.emit.call(this,ye)}});function ks(){Bi.apply(this,arguments),this._timer=null,this._input=null}yr(ks,Bi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ht]},process:function(ye){var Ze=this.options,Ct=ye.pointers.length===Ze.pointers,hr=ye.distance<Ze.threshold,En=ye.deltaTime>Ze.time;if(this._input=ye,!hr||!Ct||ye.eventType&($i|hi)&&!En)this.reset();else if(ye.eventType&ya)this.reset(),this._timer=Ut(function(){this.state=ao,this.tryEmit()},Ze.time,this);else if(ye.eventType&$i)return ao;return Jo},reset:function(){clearTimeout(this._timer)},emit:function(ye){this.state===ao&&(ye&&ye.eventType&$i?this.manager.emit(this.options.event+"up",ye):(this._input.timeStamp=Vt(),this.manager.emit(this.options.event,this._input)))}});function Jl(){Do.apply(this,arguments)}yr(Jl,Do,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[da]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.rotation)>this.options.threshold||this.state&Mt)}});function fo(){Do.apply(this,arguments)}yr(fo,Do,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:be|he,pointers:1},getTouchAction:function(){return Ea.prototype.getTouchAction.call(this)},attrTest:function(ye){var Ze=this.options.direction,Ct;return Ze&(be|he)?Ct=ye.overallVelocity:Ze&be?Ct=ye.overallVelocityX:Ze&he&&(Ct=ye.overallVelocityY),this._super.attrTest.call(this,ye)&&Ze&ye.offsetDirection&&ye.distance>this.options.threshold&&ye.maxPointers==this.options.pointers&&Et(Ct)>this.options.velocity&&ye.eventType&$i},emit:function(ye){var Ze=Ra(ye.offsetDirection);Ze&&this.manager.emit(this.options.event+Ze,ye),this.manager.emit(this.options.event,ye)}});function ds(){Bi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}yr(ds,Bi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Rt]},process:function(ye){var Ze=this.options,Ct=ye.pointers.length===Ze.pointers,hr=ye.distance<Ze.threshold,En=ye.deltaTime<Ze.time;if(this.reset(),ye.eventType&ya&&this.count===0)return this.failTimeout();if(hr&&En&&Ct){if(ye.eventType!=$i)return this.failTimeout();var ri=this.pTime?ye.timeStamp-this.pTime<Ze.interval:!0,_a=!this.pCenter||Tn(this.pCenter,ye.center)<Ze.posThreshold;this.pTime=ye.timeStamp,this.pCenter=ye.center,!_a||!ri?this.count=1:this.count+=1,this._input=ye;var Go=this.count%Ze.taps;if(Go===0)return this.hasRequireFailures()?(this._timer=Ut(function(){this.state=ao,this.tryEmit()},Ze.interval,this),Mt):ao}return Jo},failTimeout:function(){return this._timer=Ut(function(){this.state=Jo},this.options.interval,this),Jo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ao&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ja(ye,Ze){return Ze=Ze||{},Ze.recognizers=Jt(Ze.recognizers,ja.defaults.preset),new Bo(ye,Ze)}ja.VERSION="2.0.7",ja.defaults={domEvents:!1,touchAction:na,enable:!0,inputTarget:null,inputClass:null,preset:[[Jl,{enable:!1}],[Ps,{enable:!1},["rotate"]],[fo,{direction:be}],[Ea,{direction:be},["swipe"]],[ds],[ds,{event:"doubletap",taps:2},["tap"]],[ks]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Fo=1,vs=2;function Bo(ye,Ze){this.options=Lt({},ja.defaults,Ze||{}),this.options.inputTarget=this.options.inputTarget||ye,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ye,this.input=Jr(this),this.touchAction=new _o(this,this.options.touchAction),Ju(this,!0),Qt(this.options.recognizers,function(Ct){var hr=this.add(new Ct[0](Ct[1]));Ct[2]&&hr.recognizeWith(Ct[2]),Ct[3]&&hr.requireFailure(Ct[3])},this)}Bo.prototype={set:function(ye){return Lt(this.options,ye),ye.touchAction&&this.touchAction.update(),ye.inputTarget&&(this.input.destroy(),this.input.target=ye.inputTarget,this.input.init()),this},stop:function(ye){this.session.stopped=ye?vs:Fo},recognize:function(ye){var Ze=this.session;if(!Ze.stopped){this.touchAction.preventDefaults(ye);var Ct,hr=this.recognizers,En=Ze.curRecognizer;(!En||En&&En.state&ao)&&(En=Ze.curRecognizer=null);for(var ri=0;ri<hr.length;)Ct=hr[ri],Ze.stopped!==vs&&(!En||Ct==En||Ct.canRecognizeWith(En))?Ct.recognize(ye):Ct.reset(),!En&&Ct.state&(Mt|us|At)&&(En=Ze.curRecognizer=Ct),ri++}},get:function(ye){if(ye instanceof Bi)return ye;for(var Ze=this.recognizers,Ct=0;Ct<Ze.length;Ct++)if(Ze[Ct].options.event==ye)return Ze[Ct];return null},add:function(ye){if(lr(ye,"add",this))return this;var Ze=this.get(ye.options.event);return Ze&&this.remove(Ze),this.recognizers.push(ye),ye.manager=this,this.touchAction.update(),ye},remove:function(ye){if(lr(ye,"remove",this))return this;if(ye=this.get(ye),ye){var Ze=this.recognizers,Ct=V(Ze,ye);Ct!==-1&&(Ze.splice(Ct,1),this.touchAction.update())}return this},on:function(ye,Ze){if(ye!==K&&Ze!==K){var Ct=this.handlers;return Qt(Se(ye),function(hr){Ct[hr]=Ct[hr]||[],Ct[hr].push(Ze)}),this}},off:function(ye,Ze){if(ye!==K){var Ct=this.handlers;return Qt(Se(ye),function(hr){Ze?Ct[hr]&&Ct[hr].splice(V(Ct[hr],Ze),1):delete Ct[hr]}),this}},emit:function(ye,Ze){this.options.domEvents&&ju(ye,Ze);var Ct=this.handlers[ye]&&this.handlers[ye].slice();if(!(!Ct||!Ct.length)){Ze.type=ye,Ze.preventDefault=function(){Ze.srcEvent.preventDefault()};for(var hr=0;hr<Ct.length;)Ct[hr](Ze),hr++}},destroy:function(){this.element&&Ju(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ju(ye,Ze){var Ct=ye.element;if(!!Ct.style){var hr;Qt(ye.options.cssProps,function(En,ri){hr=ht(Ct.style,ri),Ze?(ye.oldCssProps[hr]=Ct.style[hr],Ct.style[hr]=En):Ct.style[hr]=ye.oldCssProps[hr]||""}),Ze||(ye.oldCssProps={})}}function ju(ye,Ze){if(!at){var Ct=y.createEvent("Event");Ct.initEvent(ye,!0,!0),Ct.gesture=Ze,Ze.target.dispatchEvent(Ct)}}if(!at){Lt(ja,{INPUT_START:ya,INPUT_MOVE:fi,INPUT_END:$i,INPUT_CANCEL:hi,STATE_POSSIBLE:Dr,STATE_BEGAN:Mt,STATE_CHANGED:us,STATE_ENDED:At,STATE_RECOGNIZED:ao,STATE_CANCELLED:yu,STATE_FAILED:Jo,DIRECTION_NONE:yi,DIRECTION_LEFT:ss,DIRECTION_RIGHT:yo,DIRECTION_UP:qa,DIRECTION_DOWN:Ft,DIRECTION_HORIZONTAL:be,DIRECTION_VERTICAL:he,DIRECTION_ALL:Ie,Manager:Bo,Input:sr,TouchAction:_o,TouchInput:mr,MouseInput:pa,PointerEventInput:qe,TouchMouseInput:ar,SingleTouchInput:it,Recognizer:Bi,AttrRecognizer:Do,Tap:ds,Pan:Ea,Swipe:fo,Pinch:Ps,Rotate:Jl,Press:ks,on:je,off:Sr,each:Qt,merge:ie,extend:fr,assign:Lt,inherit:yr,bindFn:Dt,prefixed:ht});var jo=typeof window!="undefined"?window:typeof self!="undefined"?self:{};jo.Hammer=ja,Re=function(){return ja}.call(Ee,ue,Ee,wn),Re!==K&&(wn.exports=Re)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(wn,Ee,ue){(function(Re,ge){wn.exports=ge(ue(18857))})(this,function(Re){"use strict";var ge=function(W){return W instanceof Uint8Array||W instanceof Uint16Array||W instanceof Uint32Array||W instanceof Int8Array||W instanceof Int16Array||W instanceof Int32Array||W instanceof Float32Array||W instanceof Float64Array||W instanceof Uint8ClampedArray},y=function(W,De){for(var ut=Object.keys(De),dr=0;dr<ut.length;++dr)W[ut[dr]]=De[ut[dr]];return W},Fe=`
`;function K(W){return typeof atob!="undefined"?atob(W):"base64:"+W}function Me(W){var De=new Error("(regl) "+W);throw console.error(De),De}function ve(W,De){W||Me(De)}function at(W){return W?": "+W:""}function se(W,De,ut){W in De||Me("unknown parameter ("+W+")"+at(ut)+". possible values: "+Object.keys(De).join())}function Be(W,De){ge(W)||Me("invalid parameter type"+at(De)+". must be a typed array")}function dt(W,De){switch(De){case"number":return typeof W=="number";case"object":return typeof W=="object";case"string":return typeof W=="string";case"boolean":return typeof W=="boolean";case"function":return typeof W=="function";case"undefined":return typeof W=="undefined";case"symbol":return typeof W=="symbol"}}function rt(W,De,ut){dt(W,De)||Me("invalid parameter type"+at(ut)+". expected "+De+", got "+typeof W)}function Et(W,De){W>=0&&(W|0)===W||Me("invalid parameter type, ("+W+")"+at(De)+". must be a nonnegative integer")}function Vt(W,De,ut){De.indexOf(W)<0&&Me("invalid value"+at(ut)+". must be one of: "+De)}var Ut=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function lr(W){Object.keys(W).forEach(function(De){Ut.indexOf(De)<0&&Me('invalid regl constructor argument "'+De+'". must be one of '+Ut)})}function Qt(W,De){for(W=W+"";W.length<De;)W=" "+W;return W}function It(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Lt(W,De){this.number=W,this.line=De,this.errors=[]}function fr(W,De,ut){this.file=W,this.line=De,this.message=ut}function ie(){var W=new Error,De=(W.stack||W).toString(),ut=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(De);if(ut)return ut[1];var dr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(De);return dr?dr[1]:"unknown"}function yr(){var W=new Error,De=(W.stack||W).toString(),ut=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(De);if(ut)return ut[1];var dr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(De);return dr?dr[1]:"unknown"}function Dt(W,De){var ut=W.split(`
`),dr=1,zr=0,pr={unknown:new It,0:new It};pr.unknown.name=pr[0].name=De||ie(),pr.unknown.lines.push(new Lt(0,""));for(var Lr=0;Lr<ut.length;++Lr){var Gr=ut[Lr],qr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Gr);if(qr)switch(qr[1]){case"line":var nn=/(\d+)(\s+\d+)?/.exec(qr[2]);nn&&(dr=nn[1]|0,nn[2]&&(zr=nn[2]|0,zr in pr||(pr[zr]=new It)));break;case"define":var dn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(qr[2]);dn&&(pr[zr].name=dn[1]?K(dn[2]):dn[2]);break}pr[zr].lines.push(new Lt(dr++,Gr))}return Object.keys(pr).forEach(function(vn){var kn=pr[vn];kn.lines.forEach(function(an){kn.index[an.number]=an})}),pr}function xt(W){var De=[];return W.split(`
`).forEach(function(ut){if(!(ut.length<5)){var dr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ut);dr?De.push(new fr(dr[1]|0,dr[2]|0,dr[3].trim())):ut.length>0&&De.push(new fr("unknown",0,ut))}}),De}function Jt(W,De){De.forEach(function(ut){var dr=W[ut.file];if(dr){var zr=dr.index[ut.line];if(zr){zr.errors.push(ut),dr.hasErrors=!0;return}}W.unknown.hasErrors=!0,W.unknown.lines[0].errors.push(ut)})}function je(W,De,ut,dr,zr){if(!W.getShaderParameter(De,W.COMPILE_STATUS)){var pr=W.getShaderInfoLog(De),Lr=dr===W.FRAGMENT_SHADER?"fragment":"vertex";Le(ut,"string",Lr+" shader source must be a string",zr);var Gr=Dt(ut,zr),qr=xt(pr);Jt(Gr,qr),Object.keys(Gr).forEach(function(nn){var dn=Gr[nn];if(!dn.hasErrors)return;var vn=[""],kn=[""];function an(hn,Zt){vn.push(hn),kn.push(Zt||"")}an("file number "+nn+": "+dn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),dn.lines.forEach(function(hn){if(hn.errors.length>0){an(Qt(hn.number,4)+"|  ","background-color:yellow; font-weight:bold"),an(hn.line+Fe,"color:red; background-color:yellow; font-weight:bold");var Zt=0;hn.errors.forEach(function(Cr){var rn=Cr.message,On=/^\s*'(.*)'\s*:\s*(.*)$/.exec(rn);if(On){var Ur=On[1];switch(rn=On[2],Ur){case"assign":Ur="=";break}Zt=Math.max(hn.line.indexOf(Ur,Zt),0)}else Zt=0;an(Qt("| ",6)),an(Qt("^^^",Zt+3)+Fe,"font-weight:bold"),an(Qt("| ",6)),an(rn+Fe,"font-weight:bold")}),an(Qt("| ",6)+Fe)}else an(Qt(hn.number,4)+"|  "),an(hn.line+Fe,"color:red")}),typeof document!="undefined"&&!window.chrome?(kn[0]=vn.join("%c"),console.log.apply(console,kn)):console.log(vn.join(""))}),ve.raise("Error compiling "+Lr+" shader, "+Gr[0].name)}}function Sr(W,De,ut,dr,zr){if(!W.getProgramParameter(De,W.LINK_STATUS)){var pr=W.getProgramInfoLog(De),Lr=Dt(ut,zr),Gr=Dt(dr,zr),qr='Error linking program with vertex shader, "'+Gr[0].name+'", and fragment shader "'+Lr[0].name+'"';typeof document!="undefined"?console.log("%c"+qr+Fe+"%c"+pr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(qr+Fe+pr),ve.raise(qr)}}function tn(W){W._commandRef=ie()}function re(W,De,ut,dr){tn(W);function zr(qr){return qr?dr.id(qr):0}W._fragId=zr(W.static.frag),W._vertId=zr(W.static.vert);function pr(qr,nn){Object.keys(nn).forEach(function(dn){qr[dr.id(dn)]=!0})}var Lr=W._uniformSet={};pr(Lr,De.static),pr(Lr,De.dynamic);var Gr=W._attributeSet={};pr(Gr,ut.static),pr(Gr,ut.dynamic),W._hasCount="count"in W.static||"count"in W.dynamic||"elements"in W.static||"elements"in W.dynamic}function Se(W,De){var ut=yr();Me(W+" in command "+(De||ie())+(ut==="unknown"?"":" called from "+ut))}function V(W,De,ut){W||Se(De,ut||ie())}function Q(W,De,ut,dr){W in De||Se("unknown parameter ("+W+")"+at(ut)+". possible values: "+Object.keys(De).join(),dr||ie())}function Le(W,De,ut,dr){dt(W,De)||Se("invalid parameter type"+at(ut)+". expected "+De+", got "+typeof W,dr||ie())}function ht(W){W()}function wt(W,De,ut){W.texture?Vt(W.texture._texture.internalformat,De,"unsupported texture format for attachment"):Vt(W.renderbuffer._renderbuffer.format,ut,"unsupported renderbuffer format for attachment")}var er=33071,Tt=9728,vr=9984,ln=9985,sn=9986,Mi=9987,vi=5120,en=5121,Oa=5122,ra=5123,Vi=5124,ya=5125,fi=5126,$i=32819,hi=32820,yi=33635,ss=34042,yo=36193,qa={};qa[vi]=qa[en]=1,qa[Oa]=qa[ra]=qa[yo]=qa[yi]=qa[$i]=qa[hi]=2,qa[Vi]=qa[ya]=qa[fi]=qa[ss]=4;function Ft(W,De){return W===hi||W===$i||W===yi?2:W===ss?4:qa[W]*De}function be(W){return!(W&W-1)&&!!W}function he(W,De,ut){var dr,zr=De.width,pr=De.height,Lr=De.channels;ve(zr>0&&zr<=ut.maxTextureSize&&pr>0&&pr<=ut.maxTextureSize,"invalid texture shape"),(W.wrapS!==er||W.wrapT!==er)&&ve(be(zr)&&be(pr),"incompatible wrap mode for texture, both width and height must be power of 2"),De.mipmask===1?zr!==1&&pr!==1&&ve(W.minFilter!==vr&&W.minFilter!==sn&&W.minFilter!==ln&&W.minFilter!==Mi,"min filter requires mipmap"):(ve(be(zr)&&be(pr),"texture must be a square power of 2 to support mipmapping"),ve(De.mipmask===(zr<<1)-1,"missing or incomplete mipmap data")),De.type===fi&&(ut.extensions.indexOf("oes_texture_float_linear")<0&&ve(W.minFilter===Tt&&W.magFilter===Tt,"filter not supported, must enable oes_texture_float_linear"),ve(!W.genMipmaps,"mipmap generation not supported with float textures"));var Gr=De.images;for(dr=0;dr<16;++dr)if(Gr[dr]){var qr=zr>>dr,nn=pr>>dr;ve(De.mipmask&1<<dr,"missing mipmap data");var dn=Gr[dr];if(ve(dn.width===qr&&dn.height===nn,"invalid shape for mip images"),ve(dn.format===De.format&&dn.internalformat===De.internalformat&&dn.type===De.type,"incompatible type for mip image"),!dn.compressed)if(dn.data){var vn=Math.ceil(Ft(dn.type,Lr)*qr/dn.unpackAlignment)*dn.unpackAlignment;ve(dn.data.byteLength===vn*nn,"invalid data for image, buffer size is inconsistent with image format")}else dn.element||dn.copy}else W.genMipmaps||ve((De.mipmask&1<<dr)==0,"extra mipmap data");De.compressed&&ve(!W.genMipmaps,"mipmap generation for compressed images not supported")}function Ie(W,De,ut,dr){var zr=W.width,pr=W.height,Lr=W.channels;ve(zr>0&&zr<=dr.maxTextureSize&&pr>0&&pr<=dr.maxTextureSize,"invalid texture shape"),ve(zr===pr,"cube map must be square"),ve(De.wrapS===er&&De.wrapT===er,"wrap mode not supported by cube map");for(var Gr=0;Gr<ut.length;++Gr){var qr=ut[Gr];ve(qr.width===zr&&qr.height===pr,"inconsistent cube map face shape"),De.genMipmaps&&(ve(!qr.compressed,"can not generate mipmap for compressed textures"),ve(qr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var nn=qr.images,dn=0;dn<16;++dn){var vn=nn[dn];if(vn){var kn=zr>>dn,an=pr>>dn;ve(qr.mipmask&1<<dn,"missing mipmap data"),ve(vn.width===kn&&vn.height===an,"invalid shape for mip images"),ve(vn.format===W.format&&vn.internalformat===W.internalformat&&vn.type===W.type,"incompatible type for mip image"),vn.compressed||(vn.data?ve(vn.data.byteLength===kn*an*Math.max(Ft(vn.type,Lr),vn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):vn.element||vn.copy)}}}}var G=y(ve,{optional:ht,raise:Me,commandRaise:Se,command:V,parameter:se,commandParameter:Q,constructor:lr,type:rt,commandType:Le,isTypedArray:Be,nni:Et,oneOf:Vt,shaderError:je,linkError:Sr,callSite:yr,saveCommandRef:tn,saveDrawInfo:re,framebufferFormat:wt,guessCommand:ie,texture2D:he,textureCube:Ie}),lt=0,sr=0,Jr=5,nt=6;function Gt(W,De){this.id=lt++,this.type=W,this.data=De}function Ar(W){return W.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Tr(W){if(W.length===0)return[];var De=W.charAt(0),ut=W.charAt(W.length-1);if(W.length>1&&De===ut&&(De==='"'||De==="'"))return['"'+Ar(W.substr(1,W.length-2))+'"'];var dr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(W);if(dr)return Tr(W.substr(0,dr.index)).concat(Tr(dr[1])).concat(Tr(W.substr(dr.index+dr[0].length)));var zr=W.split(".");if(zr.length===1)return['"'+Ar(W)+'"'];for(var pr=[],Lr=0;Lr<zr.length;++Lr)pr=pr.concat(Tr(zr[Lr]));return pr}function Rr(W){return"["+Tr(W).join("][")+"]"}function mn(W,De){return new Gt(W,Rr(De+""))}function mi(W){return typeof W=="function"&&!W._reglType||W instanceof Gt}function ai(W,De){if(typeof W=="function")return new Gt(sr,W);if(typeof W=="number"||typeof W=="boolean")return new Gt(Jr,W);if(Array.isArray(W))return new Gt(nt,W.map(function(ut,dr){return ai(ut,De+"["+dr+"]")}));if(W instanceof Gt)return W;G(!1,"invalid option type in uniform "+De)}var Tn={DynamicVariable:Gt,define:mn,isDynamic:mi,unbox:ai,accessor:Rr},Ri={next:typeof requestAnimationFrame=="function"?function(W){return requestAnimationFrame(W)}:function(W){return setTimeout(W,16)},cancel:typeof cancelAnimationFrame=="function"?function(W){return cancelAnimationFrame(W)}:clearTimeout},zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ka=zi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ia(){var W={"":0},De=[""];return{id:function(ut){var dr=W[ut];return dr||(dr=W[ut]=De.length,De.push(ut),dr)},str:function(ut){return De[ut]}}}function io(W,De,ut){var dr=document.createElement("canvas");y(dr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),W.appendChild(dr),W===document.body&&(dr.style.position="absolute",y(W.style,{margin:0,padding:0}));function zr(){var Gr=window.innerWidth,qr=window.innerHeight;if(W!==document.body){var nn=dr.getBoundingClientRect();Gr=nn.right-nn.left,qr=nn.bottom-nn.top}dr.width=ut*Gr,dr.height=ut*qr}var pr;W!==document.body&&typeof ResizeObserver=="function"?(pr=new ResizeObserver(function(){setTimeout(zr)}),pr.observe(W)):window.addEventListener("resize",zr,!1);function Lr(){pr?pr.disconnect():window.removeEventListener("resize",zr),W.removeChild(dr)}return zr(),{canvas:dr,onDestroy:Lr}}function Ci(W,De){function ut(dr){try{return W.getContext(dr,De)}catch(zr){return null}}return ut("webgl")||ut("experimental-webgl")||ut("webgl-experimental")}function pa(W){return typeof W.nodeName=="string"&&typeof W.appendChild=="function"&&typeof W.getBoundingClientRect=="function"}function ee(W){return typeof W.drawArrays=="function"||typeof W.drawElements=="function"}function ce(W){return typeof W=="string"?W.split():(G(Array.isArray(W),"invalid extension array"),W)}function xe(W){return typeof W=="string"?(G(typeof document!="undefined","not supported outside of DOM"),document.querySelector(W)):W}function Oe(W){var De=W||{},ut,dr,zr,pr,Lr={},Gr=[],qr=[],nn=typeof window=="undefined"?1:window.devicePixelRatio,dn=!1,vn=function(hn){hn&&G.raise(hn)},kn=function(){};if(typeof De=="string"?(G(typeof document!="undefined","selector queries only supported in DOM environments"),ut=document.querySelector(De),G(ut,"invalid query string for element")):typeof De=="object"?pa(De)?ut=De:ee(De)?(pr=De,zr=pr.canvas):(G.constructor(De),"gl"in De?pr=De.gl:"canvas"in De?zr=xe(De.canvas):"container"in De&&(dr=xe(De.container)),"attributes"in De&&(Lr=De.attributes,G.type(Lr,"object","invalid context attributes")),"extensions"in De&&(Gr=ce(De.extensions)),"optionalExtensions"in De&&(qr=ce(De.optionalExtensions)),"onDone"in De&&(G.type(De.onDone,"function","invalid or missing onDone callback"),vn=De.onDone),"profile"in De&&(dn=!!De.profile),"pixelRatio"in De&&(nn=+De.pixelRatio,G(nn>0,"invalid pixel ratio"))):G.raise("invalid arguments to regl"),ut&&(ut.nodeName.toLowerCase()==="canvas"?zr=ut:dr=ut),!pr){if(!zr){G(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var an=io(dr||document.body,vn,nn);if(!an)return null;zr=an.canvas,kn=an.onDestroy}Lr.premultipliedAlpha===void 0&&(Lr.premultipliedAlpha=!0),pr=Ci(zr,Lr)}return pr?{gl:pr,canvas:zr,container:dr,extensions:Gr,optionalExtensions:qr,pixelRatio:nn,profile:dn,onDone:vn,onDestroy:kn}:(kn(),vn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function qe(W,De){var ut={};function dr(Gr){G.type(Gr,"string","extension name must be string");var qr=Gr.toLowerCase(),nn;try{nn=ut[qr]=zr(Gr)}catch(dn){}return!!nn}function zr(Gr){return W.getExtension(Gr)?W.getExtension(Gr):W.getExtension(Gr.toLowerCase())?W.getExtension(Gr.toLowerCase()):null}for(var pr=0;pr<De.extensions.length;++pr){var Lr=De.extensions[pr];if(!dr(Lr))return De.onDestroy(),De.onDone('"'+Lr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return De.optionalExtensions.forEach(dr),{extensions:ut,restore:function(){Object.keys(ut).forEach(function(Gr){if(ut[Gr]&&!dr(Gr))throw new Error("(regl): error restoring extension "+Gr)})}}}function ct(W,De){for(var ut=Array(W),dr=0;dr<W;++dr)ut[dr]=De(dr);return ut}var St=5120,ke=5121,it=5122,Yt=5123,jr=5124,or=5125,mr=5126;function Hr(W){for(var De=16;De<=1<<28;De*=16)if(W<=De)return De;return 0}function si(W){var De,ut;return De=(W>65535)<<4,W>>>=De,ut=(W>255)<<3,W>>>=ut,De|=ut,ut=(W>15)<<2,W>>>=ut,De|=ut,ut=(W>3)<<1,W>>>=ut,De|=ut,De|W>>1}function Mn(){var W=ct(8,function(){return[]});function De(pr){var Lr=Hr(pr),Gr=W[si(Lr)>>2];return Gr.length>0?Gr.pop():new ArrayBuffer(Lr)}function ut(pr){W[si(pr.byteLength)>>2].push(pr)}function dr(pr,Lr){var Gr=null;switch(pr){case St:Gr=new Int8Array(De(Lr),0,Lr);break;case ke:Gr=new Uint8Array(De(Lr),0,Lr);break;case it:Gr=new Int16Array(De(2*Lr),0,Lr);break;case Yt:Gr=new Uint16Array(De(2*Lr),0,Lr);break;case jr:Gr=new Int32Array(De(4*Lr),0,Lr);break;case or:Gr=new Uint32Array(De(4*Lr),0,Lr);break;case mr:Gr=new Float32Array(De(4*Lr),0,Lr);break;default:return null}return Gr.length!==Lr?Gr.subarray(0,Lr):Gr}function zr(pr){ut(pr.buffer)}return{alloc:De,free:ut,allocType:dr,freeType:zr}}var ar=Mn();ar.zero=Mn();var Yn=3408,Pr=3410,gn=3411,ea=3412,Vn=3413,na=3414,Ht=3415,Rt=33901,da=33902,aa=3379,Di=3386,Ii=34921,_o=36347,Na=36348,Or=35661,Dr=35660,Mt=34930,us=36349,At=34076,ao=34024,yu=7936,Jo=7937,Bi=7938,gl=35724,Ra=34047,Lo=36063,Do=34852,Ea=3553,Ps=34067,ks=34069,Jl=33984,fo=6408,ds=5126,ja=5121,Fo=36160,vs=36053,Bo=36064,Ju=16384,ju=function(W,De){var ut=1;De.ext_texture_filter_anisotropic&&(ut=W.getParameter(Ra));var dr=1,zr=1;De.webgl_draw_buffers&&(dr=W.getParameter(Do),zr=W.getParameter(Lo));var pr=!!De.oes_texture_float;if(pr){var Lr=W.createTexture();W.bindTexture(Ea,Lr),W.texImage2D(Ea,0,fo,1,1,0,fo,ds,null);var Gr=W.createFramebuffer();if(W.bindFramebuffer(Fo,Gr),W.framebufferTexture2D(Fo,Bo,Ea,Lr,0),W.bindTexture(Ea,null),W.checkFramebufferStatus(Fo)!==vs)pr=!1;else{W.viewport(0,0,1,1),W.clearColor(1,0,0,1),W.clear(Ju);var qr=ar.allocType(ds,4);W.readPixels(0,0,1,1,fo,ds,qr),W.getError()?pr=!1:(W.deleteFramebuffer(Gr),W.deleteTexture(Lr),pr=qr[0]===1),ar.freeType(qr)}}var nn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),dn=!0;if(!nn){var vn=W.createTexture(),kn=ar.allocType(ja,36);W.activeTexture(Jl),W.bindTexture(Ps,vn),W.texImage2D(ks,0,fo,3,3,0,fo,ja,kn),ar.freeType(kn),W.bindTexture(Ps,null),W.deleteTexture(vn),dn=!W.getError()}return{colorBits:[W.getParameter(Pr),W.getParameter(gn),W.getParameter(ea),W.getParameter(Vn)],depthBits:W.getParameter(na),stencilBits:W.getParameter(Ht),subpixelBits:W.getParameter(Yn),extensions:Object.keys(De).filter(function(an){return!!De[an]}),maxAnisotropic:ut,maxDrawbuffers:dr,maxColorAttachments:zr,pointSizeDims:W.getParameter(Rt),lineWidthDims:W.getParameter(da),maxViewportDims:W.getParameter(Di),maxCombinedTextureUnits:W.getParameter(Or),maxCubeMapSize:W.getParameter(At),maxRenderbufferSize:W.getParameter(ao),maxTextureUnits:W.getParameter(Mt),maxTextureSize:W.getParameter(aa),maxAttributes:W.getParameter(Ii),maxVertexUniforms:W.getParameter(_o),maxVertexTextureUnits:W.getParameter(Dr),maxVaryingVectors:W.getParameter(Na),maxFragmentUniforms:W.getParameter(us),glsl:W.getParameter(gl),renderer:W.getParameter(Jo),vendor:W.getParameter(yu),version:W.getParameter(Bi),readFloat:pr,npotTextureCube:dn}};function jo(W){return!!W&&typeof W=="object"&&Array.isArray(W.shape)&&Array.isArray(W.stride)&&typeof W.offset=="number"&&W.shape.length===W.stride.length&&(Array.isArray(W.data)||ge(W.data))}var ye=function(W){return Object.keys(W).map(function(De){return W[De]})},Ze={shape:Go,flatten:_a};function Ct(W,De,ut){for(var dr=0;dr<De;++dr)ut[dr]=W[dr]}function hr(W,De,ut,dr){for(var zr=0,pr=0;pr<De;++pr)for(var Lr=W[pr],Gr=0;Gr<ut;++Gr)dr[zr++]=Lr[Gr]}function En(W,De,ut,dr,zr,pr){for(var Lr=pr,Gr=0;Gr<De;++Gr)for(var qr=W[Gr],nn=0;nn<ut;++nn)for(var dn=qr[nn],vn=0;vn<dr;++vn)zr[Lr++]=dn[vn]}function ri(W,De,ut,dr,zr){for(var pr=1,Lr=ut+1;Lr<De.length;++Lr)pr*=De[Lr];var Gr=De[ut];if(De.length-ut==4){var qr=De[ut+1],nn=De[ut+2],dn=De[ut+3];for(Lr=0;Lr<Gr;++Lr)En(W[Lr],qr,nn,dn,dr,zr),zr+=pr}else for(Lr=0;Lr<Gr;++Lr)ri(W[Lr],De,ut+1,dr,zr),zr+=pr}function _a(W,De,ut,dr){var zr=1;if(De.length)for(var pr=0;pr<De.length;++pr)zr*=De[pr];else zr=0;var Lr=dr||ar.allocType(ut,zr);switch(De.length){case 0:break;case 1:Ct(W,De[0],Lr);break;case 2:hr(W,De[0],De[1],Lr);break;case 3:En(W,De[0],De[1],De[2],Lr,0);break;default:ri(W,De,0,Lr,0)}return Lr}function Go(W){for(var De=[],ut=W;ut.length;ut=ut[0])De.push(ut.length);return De}var Da={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},No=5120,So=5122,oo=5124,Ls=5121,Qs=5123,uu=5125,_u=5126,Gu=5126,xu={int8:No,int16:So,int32:oo,uint8:Ls,uint16:Qs,uint32:uu,float:_u,float32:Gu},Oo=35048,fa=35040,Cs={dynamic:Oo,stream:fa,static:35044},Ch=Ze.flatten,el=Ze.shape,mf=35044,qf=35040,yl=5121,wc=5126,_l=[];_l[5120]=1,_l[5122]=2,_l[5124]=4,_l[5121]=1,_l[5123]=2,_l[5125]=4,_l[5126]=4;function gf(W){return Da[Object.prototype.toString.call(W)]|0}function E(W,De){for(var ut=0;ut<De.length;++ut)W[ut]=De[ut]}function k(W,De,ut,dr,zr,pr,Lr){for(var Gr=0,qr=0;qr<ut;++qr)for(var nn=0;nn<dr;++nn)W[Gr++]=De[zr*qr+pr*nn+Lr]}function H(W,De,ut,dr){var zr=0,pr={};function Lr(Zt){this.id=zr++,this.buffer=W.createBuffer(),this.type=Zt,this.usage=mf,this.byteLength=0,this.dimension=1,this.dtype=yl,this.persistentData=null,ut.profile&&(this.stats={size:0})}Lr.prototype.bind=function(){W.bindBuffer(this.type,this.buffer)},Lr.prototype.destroy=function(){kn(this)};var Gr=[];function qr(Zt,Cr){var rn=Gr.pop();return rn||(rn=new Lr(Zt)),rn.bind(),vn(rn,Cr,qf,0,1,!1),rn}function nn(Zt){Gr.push(Zt)}function dn(Zt,Cr,rn){Zt.byteLength=Cr.byteLength,W.bufferData(Zt.type,Cr,rn)}function vn(Zt,Cr,rn,On,Ur,_n){var Nn;if(Zt.usage=rn,Array.isArray(Cr)){if(Zt.dtype=On||wc,Cr.length>0){var Ti;if(Array.isArray(Cr[0])){Nn=el(Cr);for(var kr=1,Fr=1;Fr<Nn.length;++Fr)kr*=Nn[Fr];Zt.dimension=kr,Ti=Ch(Cr,Nn,Zt.dtype),dn(Zt,Ti,rn),_n?Zt.persistentData=Ti:ar.freeType(Ti)}else if(typeof Cr[0]=="number"){Zt.dimension=Ur;var oi=ar.allocType(Zt.dtype,Cr.length);E(oi,Cr),dn(Zt,oi,rn),_n?Zt.persistentData=oi:ar.freeType(oi)}else ge(Cr[0])?(Zt.dimension=Cr[0].length,Zt.dtype=On||gf(Cr[0])||wc,Ti=Ch(Cr,[Cr.length,Cr[0].length],Zt.dtype),dn(Zt,Ti,rn),_n?Zt.persistentData=Ti:ar.freeType(Ti)):G.raise("invalid buffer data")}}else if(ge(Cr))Zt.dtype=On||gf(Cr),Zt.dimension=Ur,dn(Zt,Cr,rn),_n&&(Zt.persistentData=new Uint8Array(new Uint8Array(Cr.buffer)));else if(jo(Cr)){Nn=Cr.shape;var Rn=Cr.stride,on=Cr.offset,zn=0,Pn=0,la=0,Gi=0;Nn.length===1?(zn=Nn[0],Pn=1,la=Rn[0],Gi=0):Nn.length===2?(zn=Nn[0],Pn=Nn[1],la=Rn[0],Gi=Rn[1]):G.raise("invalid shape"),Zt.dtype=On||gf(Cr.data)||wc,Zt.dimension=Pn;var Dn=ar.allocType(Zt.dtype,zn*Pn);k(Dn,Cr.data,zn,Pn,la,Gi,on),dn(Zt,Dn,rn),_n?Zt.persistentData=Dn:ar.freeType(Dn)}else Cr instanceof ArrayBuffer?(Zt.dtype=yl,Zt.dimension=Ur,dn(Zt,Cr,rn),_n&&(Zt.persistentData=new Uint8Array(new Uint8Array(Cr)))):G.raise("invalid buffer data")}function kn(Zt){De.bufferCount--,dr(Zt);var Cr=Zt.buffer;G(Cr,"buffer must not be deleted already"),W.deleteBuffer(Cr),Zt.buffer=null,delete pr[Zt.id]}function an(Zt,Cr,rn,On){De.bufferCount++;var Ur=new Lr(Cr);pr[Ur.id]=Ur;function _n(kr){var Fr=mf,oi=null,Rn=0,on=0,zn=1;return Array.isArray(kr)||ge(kr)||jo(kr)||kr instanceof ArrayBuffer?oi=kr:typeof kr=="number"?Rn=kr|0:kr&&(G.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(G(oi===null||Array.isArray(oi)||ge(oi)||jo(oi),"invalid data for buffer"),oi=kr.data),"usage"in kr&&(G.parameter(kr.usage,Cs,"invalid buffer usage"),Fr=Cs[kr.usage]),"type"in kr&&(G.parameter(kr.type,xu,"invalid buffer type"),on=xu[kr.type]),"dimension"in kr&&(G.type(kr.dimension,"number","invalid dimension"),zn=kr.dimension|0),"length"in kr&&(G.nni(Rn,"buffer length must be a nonnegative integer"),Rn=kr.length|0)),Ur.bind(),oi?vn(Ur,oi,Fr,on,zn,On):(Rn&&W.bufferData(Ur.type,Rn,Fr),Ur.dtype=on||yl,Ur.usage=Fr,Ur.dimension=zn,Ur.byteLength=Rn),ut.profile&&(Ur.stats.size=Ur.byteLength*_l[Ur.dtype]),_n}function Nn(kr,Fr){G(Fr+kr.byteLength<=Ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+Fr+" to a buffer of size "+Ur.byteLength),W.bufferSubData(Ur.type,Fr,kr)}function Ti(kr,Fr){var oi=(Fr||0)|0,Rn;if(Ur.bind(),ge(kr)||kr instanceof ArrayBuffer)Nn(kr,oi);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var on=ar.allocType(Ur.dtype,kr.length);E(on,kr),Nn(on,oi),ar.freeType(on)}else if(Array.isArray(kr[0])||ge(kr[0])){Rn=el(kr);var zn=Ch(kr,Rn,Ur.dtype);Nn(zn,oi),ar.freeType(zn)}else G.raise("invalid buffer data")}else if(jo(kr)){Rn=kr.shape;var Pn=kr.stride,la=0,Gi=0,Dn=0,Bn=0;Rn.length===1?(la=Rn[0],Gi=1,Dn=Pn[0],Bn=0):Rn.length===2?(la=Rn[0],Gi=Rn[1],Dn=Pn[0],Bn=Pn[1]):G.raise("invalid shape");var Li=Array.isArray(kr.data)?Ur.dtype:gf(kr.data),ta=ar.allocType(Li,la*Gi);k(ta,kr.data,la,Gi,Dn,Bn,kr.offset),Nn(ta,oi),ar.freeType(ta)}else G.raise("invalid data for buffer subdata");return _n}return rn||_n(Zt),_n._reglType="buffer",_n._buffer=Ur,_n.subdata=Ti,ut.profile&&(_n.stats=Ur.stats),_n.destroy=function(){kn(Ur)},_n}function hn(){ye(pr).forEach(function(Zt){Zt.buffer=W.createBuffer(),W.bindBuffer(Zt.type,Zt.buffer),W.bufferData(Zt.type,Zt.persistentData||Zt.byteLength,Zt.usage)})}return ut.profile&&(De.getTotalBufferSize=function(){var Zt=0;return Object.keys(pr).forEach(function(Cr){Zt+=pr[Cr].stats.size}),Zt}),{create:an,createStream:qr,destroyStream:nn,clear:function(){ye(pr).forEach(kn),Gr.forEach(kn)},getBuffer:function(Zt){return Zt&&Zt._buffer instanceof Lr?Zt._buffer:null},restore:hn,_initBuffer:vn}}var F=0,le=0,Ue=1,yt=1,Ot=4,Nt=4,Br={points:F,point:le,lines:Ue,line:yt,triangles:Ot,triangle:Nt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Xr=0,Jn=1,Ki=4,ji=5120,ha=5121,Ka=5122,xo=5123,Ta=5124,Hs=5125,Bl=34963,Kc=35040,Qc=35044;function Tc(W,De,ut,dr){var zr={},pr=0,Lr={uint8:ha,uint16:xo};De.oes_element_index_uint&&(Lr.uint32=Hs);function Gr(hn){this.id=pr++,zr[this.id]=this,this.buffer=hn,this.primType=Ki,this.vertCount=0,this.type=0}Gr.prototype.bind=function(){this.buffer.bind()};var qr=[];function nn(hn){var Zt=qr.pop();return Zt||(Zt=new Gr(ut.create(null,Bl,!0,!1)._buffer)),vn(Zt,hn,Kc,-1,-1,0,0),Zt}function dn(hn){qr.push(hn)}function vn(hn,Zt,Cr,rn,On,Ur,_n){hn.buffer.bind();var Nn;if(Zt){var Ti=_n;!_n&&(!ge(Zt)||jo(Zt)&&!ge(Zt.data))&&(Ti=De.oes_element_index_uint?Hs:xo),ut._initBuffer(hn.buffer,Zt,Cr,Ti,3)}else W.bufferData(Bl,Ur,Cr),hn.buffer.dtype=Nn||ha,hn.buffer.usage=Cr,hn.buffer.dimension=3,hn.buffer.byteLength=Ur;if(Nn=_n,!_n){switch(hn.buffer.dtype){case ha:case ji:Nn=ha;break;case xo:case Ka:Nn=xo;break;case Hs:case Ta:Nn=Hs;break;default:G.raise("unsupported type for element array")}hn.buffer.dtype=Nn}hn.type=Nn,G(Nn!==Hs||!!De.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=On;kr<0&&(kr=hn.buffer.byteLength,Nn===xo?kr>>=1:Nn===Hs&&(kr>>=2)),hn.vertCount=kr;var Fr=rn;if(rn<0){Fr=Ki;var oi=hn.buffer.dimension;oi===1&&(Fr=Xr),oi===2&&(Fr=Jn),oi===3&&(Fr=Ki)}hn.primType=Fr}function kn(hn){dr.elementsCount--,G(hn.buffer!==null,"must not double destroy elements"),delete zr[hn.id],hn.buffer.destroy(),hn.buffer=null}function an(hn,Zt){var Cr=ut.create(null,Bl,!0),rn=new Gr(Cr._buffer);dr.elementsCount++;function On(Ur){if(!Ur)Cr(),rn.primType=Ki,rn.vertCount=0,rn.type=ha;else if(typeof Ur=="number")Cr(Ur),rn.primType=Ki,rn.vertCount=Ur|0,rn.type=ha;else{var _n=null,Nn=Qc,Ti=-1,kr=-1,Fr=0,oi=0;Array.isArray(Ur)||ge(Ur)||jo(Ur)?_n=Ur:(G.type(Ur,"object","invalid arguments for elements"),"data"in Ur&&(_n=Ur.data,G(Array.isArray(_n)||ge(_n)||jo(_n),"invalid data for element buffer")),"usage"in Ur&&(G.parameter(Ur.usage,Cs,"invalid element buffer usage"),Nn=Cs[Ur.usage]),"primitive"in Ur&&(G.parameter(Ur.primitive,Br,"invalid element buffer primitive"),Ti=Br[Ur.primitive]),"count"in Ur&&(G(typeof Ur.count=="number"&&Ur.count>=0,"invalid vertex count for elements"),kr=Ur.count|0),"type"in Ur&&(G.parameter(Ur.type,Lr,"invalid buffer type"),oi=Lr[Ur.type]),"length"in Ur?Fr=Ur.length|0:(Fr=kr,oi===xo||oi===Ka?Fr*=2:(oi===Hs||oi===Ta)&&(Fr*=4))),vn(rn,_n,Nn,Ti,kr,Fr,oi)}return On}return On(hn),On._reglType="elements",On._elements=rn,On.subdata=function(Ur,_n){return Cr.subdata(Ur,_n),On},On.destroy=function(){kn(rn)},On}return{create:an,createStream:nn,destroyStream:dn,getElements:function(hn){return typeof hn=="function"&&hn._elements instanceof Gr?hn._elements:null},clear:function(){ye(zr).forEach(kn)}}}var Mc=new Float32Array(1),Pu=new Uint32Array(Mc.buffer),Nl=5123;function xl(W){for(var De=ar.allocType(Nl,W.length),ut=0;ut<W.length;++ut)if(isNaN(W[ut]))De[ut]=65535;else if(W[ut]===Infinity)De[ut]=31744;else if(W[ut]===-Infinity)De[ut]=64512;else{Mc[0]=W[ut];var dr=Pu[0],zr=dr>>>31<<15,pr=(dr<<1>>>24)-127,Lr=dr>>13&(1<<10)-1;if(pr<-24)De[ut]=zr;else if(pr<-14){var Gr=-14-pr;De[ut]=zr+(Lr+(1<<10)>>Gr)}else pr>15?De[ut]=zr+31744:De[ut]=zr+(pr+15<<10)+Lr}return De}function Ho(W){return Array.isArray(W)||ge(W)}var Sh=function(W){return!(W&W-1)&&!!W},Ah=34467,bu=3553,Xh=34067,zl=34069,tl=6408,Ul=6406,bl=6407,lo=6409,rl=6410,$f=32854,Hu=32855,yp=36194,Qd=32819,jp=32820,wh=33635,yf=34042,_f=6402,Ic=34041,xf=35904,ec=35906,bf=36193,tc=33776,lu=33777,Kf=33778,rc=33779,Yh=35986,Pc=35987,nc=34798,nl=35840,Ef=35841,kc=35842,_p=35843,Cf=36196,ic=5121,qh=5123,Sf=5125,Af=5126,Gp=10242,Hp=10243,Th=10497,Jc=33071,Eu=33648,ef=10240,Ui=10241,wf=9728,Tf=9729,El=9984,Aa=9985,bo=9986,cu=9987,Mo=33170,ku=4352,Zl=4353,fu=4354,Wp=34046,Qf=3317,Mf=37440,Vl=37441,ms=37443,il=37444,Jf=33984,Wo=[El,bo,Aa,cu],ni=[0,lo,rl,bl,tl],va={};va[lo]=va[Ul]=va[_f]=1,va[Ic]=va[rl]=2,va[bl]=va[xf]=3,va[tl]=va[ec]=4;function Lc(W){return"[object "+W+"]"}var If=Lc("HTMLCanvasElement"),Lu=Lc("OffscreenCanvas"),Ou=Lc("CanvasRenderingContext2D"),Oc=Lc("ImageBitmap"),In=Lc("HTMLImageElement"),Rc=Lc("HTMLVideoElement"),Mh=Object.keys(Da).concat([If,Lu,Ou,Oc,In,Rc]),xa=[];xa[ic]=1,xa[Af]=4,xa[bf]=2,xa[qh]=2,xa[Sf]=4;var ho=[];ho[$f]=2,ho[Hu]=2,ho[yp]=2,ho[Ic]=4,ho[tc]=.5,ho[lu]=.5,ho[Kf]=1,ho[rc]=1,ho[Yh]=.5,ho[Pc]=1,ho[nc]=1,ho[nl]=.5,ho[Ef]=.25,ho[kc]=.5,ho[_p]=.25,ho[Cf]=.5;function hu(W){return Array.isArray(W)&&(W.length===0||typeof W[0]=="number")}function Ih(W){if(!Array.isArray(W))return!1;var De=W.length;return!(De===0||!Ho(W[0]))}function al(W){return Object.prototype.toString.call(W)}function Js(W){return al(W)===If}function jl(W){return al(W)===Lu}function di(W){return al(W)===Ou}function eh(W){return al(W)===Oc}function xp(W){return al(W)===In}function bp(W){return al(W)===Rc}function ol(W){var De=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(De&&W&&W.getContext)}function Ws(W){var De=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(De&&W&&"src"in W&&"crossOrigin"in W)}function ua(W){if(!W)return!1;if(ol(W)||Ws(W))return!0;var De=al(W);return Mh.indexOf(De)>=0?!0:hu(W)||Ih(W)||jo(W)}function Cl(W){return Da[Object.prototype.toString.call(W)]|0}function pu(W,De){var ut=De.length;switch(W.type){case ic:case qh:case Sf:case Af:var dr=ar.allocType(W.type,ut);dr.set(De),W.data=dr;break;case bf:W.data=xl(De);break;default:G.raise("unsupported texture type, must specify a typed array")}}function Ss(W,De){return ar.allocType(W.type===bf?Af:W.type,De)}function Pf(W,De){W.type===bf?(W.data=xl(De),ar.freeType(De)):W.data=De}function Gl(W,De,ut,dr,zr,pr){for(var Lr=W.width,Gr=W.height,qr=W.channels,nn=Lr*Gr*qr,dn=Ss(W,nn),vn=0,kn=0;kn<Gr;++kn)for(var an=0;an<Lr;++an)for(var hn=0;hn<qr;++hn)dn[vn++]=De[ut*an+dr*kn+zr*hn+pr];Pf(W,dn)}function sl(W,De,ut,dr,zr,pr){var Lr;if(typeof ho[W]!="undefined"?Lr=ho[W]:Lr=va[W]*xa[De],pr&&(Lr*=6),zr){for(var Gr=0,qr=ut;qr>=1;)Gr+=Lr*qr*qr,qr/=2;return Gr}else return Lr*ut*dr}function du(W,De,ut,dr,zr,pr,Lr){var Gr={"don't care":ku,"dont care":ku,nice:fu,fast:Zl},qr={repeat:Th,clamp:Jc,mirror:Eu},nn={nearest:wf,linear:Tf},dn=y({mipmap:cu,"nearest mipmap nearest":El,"linear mipmap nearest":Aa,"nearest mipmap linear":bo,"linear mipmap linear":cu},nn),vn={none:0,browser:il},kn={uint8:ic,rgba4:Qd,rgb565:wh,"rgb5 a1":jp},an={alpha:Ul,luminance:lo,"luminance alpha":rl,rgb:bl,rgba:tl,rgba4:$f,"rgb5 a1":Hu,rgb565:yp},hn={};De.ext_srgb&&(an.srgb=xf,an.srgba=ec),De.oes_texture_float&&(kn.float32=kn.float=Af),De.oes_texture_half_float&&(kn.float16=kn["half float"]=bf),De.webgl_depth_texture&&(y(an,{depth:_f,"depth stencil":Ic}),y(kn,{uint16:qh,uint32:Sf,"depth stencil":yf})),De.webgl_compressed_texture_s3tc&&y(hn,{"rgb s3tc dxt1":tc,"rgba s3tc dxt1":lu,"rgba s3tc dxt3":Kf,"rgba s3tc dxt5":rc}),De.webgl_compressed_texture_atc&&y(hn,{"rgb atc":Yh,"rgba atc explicit alpha":Pc,"rgba atc interpolated alpha":nc}),De.webgl_compressed_texture_pvrtc&&y(hn,{"rgb pvrtc 4bppv1":nl,"rgb pvrtc 2bppv1":Ef,"rgba pvrtc 4bppv1":kc,"rgba pvrtc 2bppv1":_p}),De.webgl_compressed_texture_etc1&&(hn["rgb etc1"]=Cf);var Zt=Array.prototype.slice.call(W.getParameter(Ah)||new Uint32Array(0));Object.keys(hn).forEach(function(Ke){var gr=hn[Ke];Zt.indexOf(gr)>=0&&(an[Ke]=gr)});var Cr=Object.keys(an);ut.textureFormats=Cr;var rn=[];Object.keys(an).forEach(function(Ke){var gr=an[Ke];rn[gr]=Ke});var On=[];Object.keys(kn).forEach(function(Ke){var gr=kn[Ke];On[gr]=Ke});var Ur=[];Object.keys(nn).forEach(function(Ke){var gr=nn[Ke];Ur[gr]=Ke});var _n=[];Object.keys(dn).forEach(function(Ke){var gr=dn[Ke];_n[gr]=Ke});var Nn=[];Object.keys(qr).forEach(function(Ke){var gr=qr[Ke];Nn[gr]=Ke});var Ti=Cr.reduce(function(Ke,gr){var $t=an[gr];return $t===lo||$t===Ul||$t===lo||$t===rl||$t===_f||$t===Ic||De.ext_srgb&&($t===xf||$t===ec)?Ke[$t]=$t:$t===Hu||gr.indexOf("rgba")>=0?Ke[$t]=tl:Ke[$t]=bl,Ke},{});function kr(){this.internalformat=tl,this.format=tl,this.type=ic,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=il,this.width=0,this.height=0,this.channels=0}function Fr(Ke,gr){Ke.internalformat=gr.internalformat,Ke.format=gr.format,Ke.type=gr.type,Ke.compressed=gr.compressed,Ke.premultiplyAlpha=gr.premultiplyAlpha,Ke.flipY=gr.flipY,Ke.unpackAlignment=gr.unpackAlignment,Ke.colorSpace=gr.colorSpace,Ke.width=gr.width,Ke.height=gr.height,Ke.channels=gr.channels}function oi(Ke,gr){if(!(typeof gr!="object"||!gr)){if("premultiplyAlpha"in gr&&(G.type(gr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ke.premultiplyAlpha=gr.premultiplyAlpha),"flipY"in gr&&(G.type(gr.flipY,"boolean","invalid texture flip"),Ke.flipY=gr.flipY),"alignment"in gr&&(G.oneOf(gr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ke.unpackAlignment=gr.alignment),"colorSpace"in gr&&(G.parameter(gr.colorSpace,vn,"invalid colorSpace"),Ke.colorSpace=vn[gr.colorSpace]),"type"in gr){var $t=gr.type;G(De.oes_texture_float||!($t==="float"||$t==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),G(De.oes_texture_half_float||!($t==="half float"||$t==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),G(De.webgl_depth_texture||!($t==="uint16"||$t==="uint32"||$t==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),G.parameter($t,kn,"invalid texture type"),Ke.type=kn[$t]}var ei=Ke.width,Pa=Ke.height,Ge=Ke.channels,we=!1;"shape"in gr?(G(Array.isArray(gr.shape)&&gr.shape.length>=2,"shape must be an array"),ei=gr.shape[0],Pa=gr.shape[1],gr.shape.length===3&&(Ge=gr.shape[2],G(Ge>0&&Ge<=4,"invalid number of channels"),we=!0),G(ei>=0&&ei<=ut.maxTextureSize,"invalid width"),G(Pa>=0&&Pa<=ut.maxTextureSize,"invalid height")):("radius"in gr&&(ei=Pa=gr.radius,G(ei>=0&&ei<=ut.maxTextureSize,"invalid radius")),"width"in gr&&(ei=gr.width,G(ei>=0&&ei<=ut.maxTextureSize,"invalid width")),"height"in gr&&(Pa=gr.height,G(Pa>=0&&Pa<=ut.maxTextureSize,"invalid height")),"channels"in gr&&(Ge=gr.channels,G(Ge>0&&Ge<=4,"invalid number of channels"),we=!0)),Ke.width=ei|0,Ke.height=Pa|0,Ke.channels=Ge|0;var vt=!1;if("format"in gr){var Wt=gr.format;G(De.webgl_depth_texture||!(Wt==="depth"||Wt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),G.parameter(Wt,an,"invalid texture format");var ur=Ke.internalformat=an[Wt];Ke.format=Ti[ur],Wt in kn&&("type"in gr||(Ke.type=kn[Wt])),Wt in hn&&(Ke.compressed=!0),vt=!0}!we&&vt?Ke.channels=va[Ke.format]:we&&!vt?Ke.channels!==ni[Ke.format]&&(Ke.format=Ke.internalformat=ni[Ke.channels]):vt&&we&&G(Ke.channels===va[Ke.format],"number of channels inconsistent with specified format")}}function Rn(Ke){W.pixelStorei(Mf,Ke.flipY),W.pixelStorei(Vl,Ke.premultiplyAlpha),W.pixelStorei(ms,Ke.colorSpace),W.pixelStorei(Qf,Ke.unpackAlignment)}function on(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function zn(Ke,gr){var $t=null;if(ua(gr)?$t=gr:gr&&(G.type(gr,"object","invalid pixel data type"),oi(Ke,gr),"x"in gr&&(Ke.xOffset=gr.x|0),"y"in gr&&(Ke.yOffset=gr.y|0),ua(gr.data)&&($t=gr.data)),G(!Ke.compressed||$t instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),gr.copy){G(!$t,"can not specify copy and data field for the same texture");var ei=zr.viewportWidth,Pa=zr.viewportHeight;Ke.width=Ke.width||ei-Ke.xOffset,Ke.height=Ke.height||Pa-Ke.yOffset,Ke.needsCopy=!0,G(Ke.xOffset>=0&&Ke.xOffset<ei&&Ke.yOffset>=0&&Ke.yOffset<Pa&&Ke.width>0&&Ke.width<=ei&&Ke.height>0&&Ke.height<=Pa,"copy texture read out of bounds")}else if(!$t)Ke.width=Ke.width||1,Ke.height=Ke.height||1,Ke.channels=Ke.channels||4;else if(ge($t))Ke.channels=Ke.channels||4,Ke.data=$t,!("type"in gr)&&Ke.type===ic&&(Ke.type=Cl($t));else if(hu($t))Ke.channels=Ke.channels||4,pu(Ke,$t),Ke.alignment=1,Ke.needsFree=!0;else if(jo($t)){var Ge=$t.data;!Array.isArray(Ge)&&Ke.type===ic&&(Ke.type=Cl(Ge));var we=$t.shape,vt=$t.stride,Wt,ur,bt,ot,kt,Ne;we.length===3?(bt=we[2],Ne=vt[2]):(G(we.length===2,"invalid ndarray pixel data, must be 2 or 3D"),bt=1,Ne=1),Wt=we[0],ur=we[1],ot=vt[0],kt=vt[1],Ke.alignment=1,Ke.width=Wt,Ke.height=ur,Ke.channels=bt,Ke.format=Ke.internalformat=ni[bt],Ke.needsFree=!0,Gl(Ke,Ge,ot,kt,Ne,$t.offset)}else if(ol($t)||Js($t)||jl($t)||di($t))ol($t)||Js($t)||jl($t)?Ke.element=$t:Ke.element=$t.canvas,Ke.width=Ke.element.width,Ke.height=Ke.element.height,Ke.channels=4;else if(eh($t))Ke.element=$t,Ke.width=$t.width,Ke.height=$t.height,Ke.channels=4;else if(xp($t))Ke.element=$t,Ke.width=$t.naturalWidth,Ke.height=$t.naturalHeight,Ke.channels=4;else if(Ws($t))Ke.element=$t,Ke.width=$t.width,Ke.height=$t.height,Ke.channels=4;else if(bp($t))Ke.element=$t,Ke.width=$t.videoWidth,Ke.height=$t.videoHeight,Ke.channels=4;else if(Ih($t)){var pt=Ke.width||$t[0].length,We=Ke.height||$t.length,jt=Ke.channels;Ho($t[0][0])?jt=jt||$t[0][0].length:jt=jt||1;for(var Kt=Ze.shape($t),Vr=1,An=0;An<Kt.length;++An)Vr*=Kt[An];var un=Ss(Ke,Vr);Ze.flatten($t,Kt,"",un),Pf(Ke,un),Ke.alignment=1,Ke.width=pt,Ke.height=We,Ke.channels=jt,Ke.format=Ke.internalformat=ni[jt],Ke.needsFree=!0}Ke.type===Af?G(ut.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ke.type===bf&&G(ut.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Pn(Ke,gr,$t){var ei=Ke.element,Pa=Ke.data,Ge=Ke.internalformat,we=Ke.format,vt=Ke.type,Wt=Ke.width,ur=Ke.height;Rn(Ke),ei?W.texImage2D(gr,$t,we,we,vt,ei):Ke.compressed?W.compressedTexImage2D(gr,$t,Ge,Wt,ur,0,Pa):Ke.needsCopy?(dr(),W.copyTexImage2D(gr,$t,we,Ke.xOffset,Ke.yOffset,Wt,ur,0)):W.texImage2D(gr,$t,we,Wt,ur,0,we,vt,Pa||null)}function la(Ke,gr,$t,ei,Pa){var Ge=Ke.element,we=Ke.data,vt=Ke.internalformat,Wt=Ke.format,ur=Ke.type,bt=Ke.width,ot=Ke.height;Rn(Ke),Ge?W.texSubImage2D(gr,Pa,$t,ei,Wt,ur,Ge):Ke.compressed?W.compressedTexSubImage2D(gr,Pa,$t,ei,vt,bt,ot,we):Ke.needsCopy?(dr(),W.copyTexSubImage2D(gr,Pa,$t,ei,Ke.xOffset,Ke.yOffset,bt,ot)):W.texSubImage2D(gr,Pa,$t,ei,bt,ot,Wt,ur,we)}var Gi=[];function Dn(){return Gi.pop()||new on}function Bn(Ke){Ke.needsFree&&ar.freeType(Ke.data),on.call(Ke),Gi.push(Ke)}function Li(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=ku,this.mipmask=0,this.images=Array(16)}function ta(Ke,gr,$t){var ei=Ke.images[0]=Dn();Ke.mipmask=1,ei.width=Ke.width=gr,ei.height=Ke.height=$t,ei.channels=Ke.channels=4}function Ma(Ke,gr){var $t=null;if(ua(gr))$t=Ke.images[0]=Dn(),Fr($t,Ke),zn($t,gr),Ke.mipmask=1;else if(oi(Ke,gr),Array.isArray(gr.mipmap))for(var ei=gr.mipmap,Pa=0;Pa<ei.length;++Pa)$t=Ke.images[Pa]=Dn(),Fr($t,Ke),$t.width>>=Pa,$t.height>>=Pa,zn($t,ei[Pa]),Ke.mipmask|=1<<Pa;else $t=Ke.images[0]=Dn(),Fr($t,Ke),zn($t,gr),Ke.mipmask=1;Fr(Ke,Ke.images[0]),Ke.compressed&&(Ke.internalformat===tc||Ke.internalformat===lu||Ke.internalformat===Kf||Ke.internalformat===rc)&&G(Ke.width%4==0&&Ke.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function qo(Ke,gr){for(var $t=Ke.images,ei=0;ei<$t.length;++ei){if(!$t[ei])return;Pn($t[ei],gr,ei)}}var $o=[];function Sa(){var Ke=$o.pop()||new Li;kr.call(Ke),Ke.mipmask=0;for(var gr=0;gr<16;++gr)Ke.images[gr]=null;return Ke}function Ys(Ke){for(var gr=Ke.images,$t=0;$t<gr.length;++$t)gr[$t]&&Bn(gr[$t]),gr[$t]=null;$o.push(Ke)}function wo(){this.minFilter=wf,this.magFilter=wf,this.wrapS=Jc,this.wrapT=Jc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ku}function Vs(Ke,gr){if("min"in gr){var $t=gr.min;G.parameter($t,dn),Ke.minFilter=dn[$t],Wo.indexOf(Ke.minFilter)>=0&&!("faces"in gr)&&(Ke.genMipmaps=!0)}if("mag"in gr){var ei=gr.mag;G.parameter(ei,nn),Ke.magFilter=nn[ei]}var Pa=Ke.wrapS,Ge=Ke.wrapT;if("wrap"in gr){var we=gr.wrap;typeof we=="string"?(G.parameter(we,qr),Pa=Ge=qr[we]):Array.isArray(we)&&(G.parameter(we[0],qr),G.parameter(we[1],qr),Pa=qr[we[0]],Ge=qr[we[1]])}else{if("wrapS"in gr){var vt=gr.wrapS;G.parameter(vt,qr),Pa=qr[vt]}if("wrapT"in gr){var Wt=gr.wrapT;G.parameter(Wt,qr),Ge=qr[Wt]}}if(Ke.wrapS=Pa,Ke.wrapT=Ge,"anisotropic"in gr){var ur=gr.anisotropic;G(typeof ur=="number"&&ur>=1&&ur<=ut.maxAnisotropic,"aniso samples must be between 1 and "),Ke.anisotropic=gr.anisotropic}if("mipmap"in gr){var bt=!1;switch(typeof gr.mipmap){case"string":G.parameter(gr.mipmap,Gr,"invalid mipmap hint"),Ke.mipmapHint=Gr[gr.mipmap],Ke.genMipmaps=!0,bt=!0;break;case"boolean":bt=Ke.genMipmaps=gr.mipmap;break;case"object":G(Array.isArray(gr.mipmap),"invalid mipmap type"),Ke.genMipmaps=!1,bt=!0;break;default:G.raise("invalid mipmap type")}bt&&!("min"in gr)&&(Ke.minFilter=El)}}function gs(Ke,gr){W.texParameteri(gr,Ui,Ke.minFilter),W.texParameteri(gr,ef,Ke.magFilter),W.texParameteri(gr,Gp,Ke.wrapS),W.texParameteri(gr,Hp,Ke.wrapT),De.ext_texture_filter_anisotropic&&W.texParameteri(gr,Wp,Ke.anisotropic),Ke.genMipmaps&&(W.hint(Mo,Ke.mipmapHint),W.generateMipmap(gr))}var As=0,js={},vu=ut.maxTextureUnits,zo=Array(vu).map(function(){return null});function sa(Ke){kr.call(this),this.mipmask=0,this.internalformat=tl,this.id=As++,this.refCount=1,this.target=Ke,this.texture=W.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new wo,Lr.profile&&(this.stats={size:0})}function ws(Ke){W.activeTexture(Jf),W.bindTexture(Ke.target,Ke.texture)}function Za(){var Ke=zo[0];Ke?W.bindTexture(Ke.target,Ke.texture):W.bindTexture(bu,null)}function ru(Ke){var gr=Ke.texture;G(gr,"must not double destroy texture");var $t=Ke.unit,ei=Ke.target;$t>=0&&(W.activeTexture(Jf+$t),W.bindTexture(ei,null),zo[$t]=null),W.deleteTexture(gr),Ke.texture=null,Ke.params=null,Ke.pixels=null,Ke.refCount=0,delete js[Ke.id],pr.textureCount--}y(sa.prototype,{bind:function(){var Ke=this;Ke.bindCount+=1;var gr=Ke.unit;if(gr<0){for(var $t=0;$t<vu;++$t){var ei=zo[$t];if(ei){if(ei.bindCount>0)continue;ei.unit=-1}zo[$t]=Ke,gr=$t;break}gr>=vu&&G.raise("insufficient number of texture units"),Lr.profile&&pr.maxTextureUnits<gr+1&&(pr.maxTextureUnits=gr+1),Ke.unit=gr,W.activeTexture(Jf+gr),W.bindTexture(Ke.target,Ke.texture)}return gr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ru(this)}});function Yi(Ke,gr){var $t=new sa(bu);js[$t.id]=$t,pr.textureCount++;function ei(we,vt){var Wt=$t.texInfo;wo.call(Wt);var ur=Sa();return typeof we=="number"?typeof vt=="number"?ta(ur,we|0,vt|0):ta(ur,we|0,we|0):we?(G.type(we,"object","invalid arguments to regl.texture"),Vs(Wt,we),Ma(ur,we)):ta(ur,1,1),Wt.genMipmaps&&(ur.mipmask=(ur.width<<1)-1),$t.mipmask=ur.mipmask,Fr($t,ur),G.texture2D(Wt,ur,ut),$t.internalformat=ur.internalformat,ei.width=ur.width,ei.height=ur.height,ws($t),qo(ur,bu),gs(Wt,bu),Za(),Ys(ur),Lr.profile&&($t.stats.size=sl($t.internalformat,$t.type,ur.width,ur.height,Wt.genMipmaps,!1)),ei.format=rn[$t.internalformat],ei.type=On[$t.type],ei.mag=Ur[Wt.magFilter],ei.min=_n[Wt.minFilter],ei.wrapS=Nn[Wt.wrapS],ei.wrapT=Nn[Wt.wrapT],ei}function Pa(we,vt,Wt,ur){G(!!we,"must specify image data");var bt=vt|0,ot=Wt|0,kt=ur|0,Ne=Dn();return Fr(Ne,$t),Ne.width=0,Ne.height=0,zn(Ne,we),Ne.width=Ne.width||($t.width>>kt)-bt,Ne.height=Ne.height||($t.height>>kt)-ot,G($t.type===Ne.type&&$t.format===Ne.format&&$t.internalformat===Ne.internalformat,"incompatible format for texture.subimage"),G(bt>=0&&ot>=0&&bt+Ne.width<=$t.width&&ot+Ne.height<=$t.height,"texture.subimage write out of bounds"),G($t.mipmask&1<<kt,"missing mipmap data"),G(Ne.data||Ne.element||Ne.needsCopy,"missing image data"),ws($t),la(Ne,bu,bt,ot,kt),Za(),Bn(Ne),ei}function Ge(we,vt){var Wt=we|0,ur=vt|0||Wt;if(Wt===$t.width&&ur===$t.height)return ei;ei.width=$t.width=Wt,ei.height=$t.height=ur,ws($t);for(var bt=0;$t.mipmask>>bt;++bt){var ot=Wt>>bt,kt=ur>>bt;if(!ot||!kt)break;W.texImage2D(bu,bt,$t.format,ot,kt,0,$t.format,$t.type,null)}return Za(),Lr.profile&&($t.stats.size=sl($t.internalformat,$t.type,Wt,ur,!1,!1)),ei}return ei(Ke,gr),ei.subimage=Pa,ei.resize=Ge,ei._reglType="texture2d",ei._texture=$t,Lr.profile&&(ei.stats=$t.stats),ei.destroy=function(){$t.decRef()},ei}function Ia(Ke,gr,$t,ei,Pa,Ge){var we=new sa(Xh);js[we.id]=we,pr.cubeCount++;var vt=new Array(6);function Wt(ot,kt,Ne,pt,We,jt){var Kt,Vr=we.texInfo;for(wo.call(Vr),Kt=0;Kt<6;++Kt)vt[Kt]=Sa();if(typeof ot=="number"||!ot){var An=ot|0||1;for(Kt=0;Kt<6;++Kt)ta(vt[Kt],An,An)}else if(typeof ot=="object")if(kt)Ma(vt[0],ot),Ma(vt[1],kt),Ma(vt[2],Ne),Ma(vt[3],pt),Ma(vt[4],We),Ma(vt[5],jt);else if(Vs(Vr,ot),oi(we,ot),"faces"in ot){var un=ot.faces;for(G(Array.isArray(un)&&un.length===6,"cube faces must be a length 6 array"),Kt=0;Kt<6;++Kt)G(typeof un[Kt]=="object"&&!!un[Kt],"invalid input for cube map face"),Fr(vt[Kt],we),Ma(vt[Kt],un[Kt])}else for(Kt=0;Kt<6;++Kt)Ma(vt[Kt],ot);else G.raise("invalid arguments to cube map");for(Fr(we,vt[0]),G.optional(function(){ut.npotTextureCube||G(Sh(we.width)&&Sh(we.height),"your browser does not support non power or two texture dimensions")}),Vr.genMipmaps?we.mipmask=(vt[0].width<<1)-1:we.mipmask=vt[0].mipmask,G.textureCube(we,Vr,vt,ut),we.internalformat=vt[0].internalformat,Wt.width=vt[0].width,Wt.height=vt[0].height,ws(we),Kt=0;Kt<6;++Kt)qo(vt[Kt],zl+Kt);for(gs(Vr,Xh),Za(),Lr.profile&&(we.stats.size=sl(we.internalformat,we.type,Wt.width,Wt.height,Vr.genMipmaps,!0)),Wt.format=rn[we.internalformat],Wt.type=On[we.type],Wt.mag=Ur[Vr.magFilter],Wt.min=_n[Vr.minFilter],Wt.wrapS=Nn[Vr.wrapS],Wt.wrapT=Nn[Vr.wrapT],Kt=0;Kt<6;++Kt)Ys(vt[Kt]);return Wt}function ur(ot,kt,Ne,pt,We){G(!!kt,"must specify image data"),G(typeof ot=="number"&&ot===(ot|0)&&ot>=0&&ot<6,"invalid face");var jt=Ne|0,Kt=pt|0,Vr=We|0,An=Dn();return Fr(An,we),An.width=0,An.height=0,zn(An,kt),An.width=An.width||(we.width>>Vr)-jt,An.height=An.height||(we.height>>Vr)-Kt,G(we.type===An.type&&we.format===An.format&&we.internalformat===An.internalformat,"incompatible format for texture.subimage"),G(jt>=0&&Kt>=0&&jt+An.width<=we.width&&Kt+An.height<=we.height,"texture.subimage write out of bounds"),G(we.mipmask&1<<Vr,"missing mipmap data"),G(An.data||An.element||An.needsCopy,"missing image data"),ws(we),la(An,zl+ot,jt,Kt,Vr),Za(),Bn(An),Wt}function bt(ot){var kt=ot|0;if(kt!==we.width){Wt.width=we.width=kt,Wt.height=we.height=kt,ws(we);for(var Ne=0;Ne<6;++Ne)for(var pt=0;we.mipmask>>pt;++pt)W.texImage2D(zl+Ne,pt,we.format,kt>>pt,kt>>pt,0,we.format,we.type,null);return Za(),Lr.profile&&(we.stats.size=sl(we.internalformat,we.type,Wt.width,Wt.height,!1,!0)),Wt}}return Wt(Ke,gr,$t,ei,Pa,Ge),Wt.subimage=ur,Wt.resize=bt,Wt._reglType="textureCube",Wt._texture=we,Lr.profile&&(Wt.stats=we.stats),Wt.destroy=function(){we.decRef()},Wt}function eo(){for(var Ke=0;Ke<vu;++Ke)W.activeTexture(Jf+Ke),W.bindTexture(bu,null),zo[Ke]=null;ye(js).forEach(ru),pr.cubeCount=0,pr.textureCount=0}Lr.profile&&(pr.getTotalTextureSize=function(){var Ke=0;return Object.keys(js).forEach(function(gr){Ke+=js[gr].stats.size}),Ke});function ys(){for(var Ke=0;Ke<vu;++Ke){var gr=zo[Ke];gr&&(gr.bindCount=0,gr.unit=-1,zo[Ke]=null)}ye(js).forEach(function($t){$t.texture=W.createTexture(),W.bindTexture($t.target,$t.texture);for(var ei=0;ei<32;++ei)if(($t.mipmask&1<<ei)!=0)if($t.target===bu)W.texImage2D(bu,ei,$t.internalformat,$t.width>>ei,$t.height>>ei,0,$t.internalformat,$t.type,null);else for(var Pa=0;Pa<6;++Pa)W.texImage2D(zl+Pa,ei,$t.internalformat,$t.width>>ei,$t.height>>ei,0,$t.internalformat,$t.type,null);gs($t.texInfo,$t.target)})}function cf(){for(var Ke=0;Ke<vu;++Ke){var gr=zo[Ke];gr&&(gr.bindCount=0,gr.unit=-1,zo[Ke]=null),W.activeTexture(Jf+Ke),W.bindTexture(bu,null),W.bindTexture(Xh,null)}}return{create2D:Yi,createCube:Ia,clear:eo,getTexture:function(Ke){return null},restore:ys,refresh:cf}}var ul=36161,_i=32854,pi=32855,kf=36194,Os=33189,ll=36168,Yo=34041,Ru=35907,Ph=34836,th=34842,Qa=34843,po=[];po[_i]=2,po[pi]=2,po[kf]=2,po[Os]=2,po[ll]=1,po[Yo]=4,po[Ru]=4,po[Ph]=16,po[th]=8,po[Qa]=6;function rh(W,De,ut){return po[W]*De*ut}var nh=function(W,De,ut,dr,zr){var pr={rgba4:_i,rgb565:kf,"rgb5 a1":pi,depth:Os,stencil:ll,"depth stencil":Yo};De.ext_srgb&&(pr.srgba=Ru),De.ext_color_buffer_half_float&&(pr.rgba16f=th,pr.rgb16f=Qa),De.webgl_color_buffer_float&&(pr.rgba32f=Ph);var Lr=[];Object.keys(pr).forEach(function(an){var hn=pr[an];Lr[hn]=an});var Gr=0,qr={};function nn(an){this.id=Gr++,this.refCount=1,this.renderbuffer=an,this.format=_i,this.width=0,this.height=0,zr.profile&&(this.stats={size:0})}nn.prototype.decRef=function(){--this.refCount<=0&&dn(this)};function dn(an){var hn=an.renderbuffer;G(hn,"must not double destroy renderbuffer"),W.bindRenderbuffer(ul,null),W.deleteRenderbuffer(hn),an.renderbuffer=null,an.refCount=0,delete qr[an.id],dr.renderbufferCount--}function vn(an,hn){var Zt=new nn(W.createRenderbuffer());qr[Zt.id]=Zt,dr.renderbufferCount++;function Cr(On,Ur){var _n=0,Nn=0,Ti=_i;if(typeof On=="object"&&On){var kr=On;if("shape"in kr){var Fr=kr.shape;G(Array.isArray(Fr)&&Fr.length>=2,"invalid renderbuffer shape"),_n=Fr[0]|0,Nn=Fr[1]|0}else"radius"in kr&&(_n=Nn=kr.radius|0),"width"in kr&&(_n=kr.width|0),"height"in kr&&(Nn=kr.height|0);"format"in kr&&(G.parameter(kr.format,pr,"invalid renderbuffer format"),Ti=pr[kr.format])}else typeof On=="number"?(_n=On|0,typeof Ur=="number"?Nn=Ur|0:Nn=_n):On?G.raise("invalid arguments to renderbuffer constructor"):_n=Nn=1;if(G(_n>0&&Nn>0&&_n<=ut.maxRenderbufferSize&&Nn<=ut.maxRenderbufferSize,"invalid renderbuffer size"),!(_n===Zt.width&&Nn===Zt.height&&Ti===Zt.format))return Cr.width=Zt.width=_n,Cr.height=Zt.height=Nn,Zt.format=Ti,W.bindRenderbuffer(ul,Zt.renderbuffer),W.renderbufferStorage(ul,Ti,_n,Nn),G(W.getError()===0,"invalid render buffer format"),zr.profile&&(Zt.stats.size=rh(Zt.format,Zt.width,Zt.height)),Cr.format=Lr[Zt.format],Cr}function rn(On,Ur){var _n=On|0,Nn=Ur|0||_n;return _n===Zt.width&&Nn===Zt.height||(G(_n>0&&Nn>0&&_n<=ut.maxRenderbufferSize&&Nn<=ut.maxRenderbufferSize,"invalid renderbuffer size"),Cr.width=Zt.width=_n,Cr.height=Zt.height=Nn,W.bindRenderbuffer(ul,Zt.renderbuffer),W.renderbufferStorage(ul,Zt.format,_n,Nn),G(W.getError()===0,"invalid render buffer format"),zr.profile&&(Zt.stats.size=rh(Zt.format,Zt.width,Zt.height))),Cr}return Cr(an,hn),Cr.resize=rn,Cr._reglType="renderbuffer",Cr._renderbuffer=Zt,zr.profile&&(Cr.stats=Zt.stats),Cr.destroy=function(){Zt.decRef()},Cr}zr.profile&&(dr.getTotalRenderbufferSize=function(){var an=0;return Object.keys(qr).forEach(function(hn){an+=qr[hn].stats.size}),an});function kn(){ye(qr).forEach(function(an){an.renderbuffer=W.createRenderbuffer(),W.bindRenderbuffer(ul,an.renderbuffer),W.renderbufferStorage(ul,an.format,an.width,an.height)}),W.bindRenderbuffer(ul,null)}return{create:vn,clear:function(){ye(qr).forEach(dn)},restore:kn}},Sl=36160,Al=36161,Rs=3553,Ao=34069,ac=36064,$h=36096,tf=36128,ih=33306,Kh=36053,cl=36054,oc=36055,rf=36057,sc=36061,Hl=36193,kh=5121,uc=5126,wl=6407,Lf=6408,Lh=6402,Wu=[wl,Lf],nf=[];nf[Lf]=4,nf[wl]=3;var c=[];c[kh]=1,c[uc]=4,c[Hl]=2;var p=32854,f=32855,g=36194,S=33189,I=36168,O=34041,z=35907,q=34836,oe=34842,Te=34843,Pe=[p,f,g,z,oe,Te,q],_e={};_e[Kh]="complete",_e[cl]="incomplete attachment",_e[rf]="incomplete dimensions",_e[oc]="incomplete, missing attachment",_e[sc]="unsupported";function Je(W,De,ut,dr,zr,pr){var Lr={cur:null,next:null,dirty:!1,setFBO:null},Gr=["rgba"],qr=["rgba4","rgb565","rgb5 a1"];De.ext_srgb&&qr.push("srgba"),De.ext_color_buffer_half_float&&qr.push("rgba16f","rgb16f"),De.webgl_color_buffer_float&&qr.push("rgba32f");var nn=["uint8"];De.oes_texture_half_float&&nn.push("half float","float16"),De.oes_texture_float&&nn.push("float","float32");function dn(on,zn,Pn){this.target=on,this.texture=zn,this.renderbuffer=Pn;var la=0,Gi=0;zn?(la=zn.width,Gi=zn.height):Pn&&(la=Pn.width,Gi=Pn.height),this.width=la,this.height=Gi}function vn(on){on&&(on.texture&&on.texture._texture.decRef(),on.renderbuffer&&on.renderbuffer._renderbuffer.decRef())}function kn(on,zn,Pn){if(!!on)if(on.texture){var la=on.texture._texture,Gi=Math.max(1,la.width),Dn=Math.max(1,la.height);G(Gi===zn&&Dn===Pn,"inconsistent width/height for supplied texture"),la.refCount+=1}else{var Bn=on.renderbuffer._renderbuffer;G(Bn.width===zn&&Bn.height===Pn,"inconsistent width/height for renderbuffer"),Bn.refCount+=1}}function an(on,zn){zn&&(zn.texture?W.framebufferTexture2D(Sl,on,zn.target,zn.texture._texture.texture,0):W.framebufferRenderbuffer(Sl,on,Al,zn.renderbuffer._renderbuffer.renderbuffer))}function hn(on){var zn=Rs,Pn=null,la=null,Gi=on;typeof on=="object"&&(Gi=on.data,"target"in on&&(zn=on.target|0)),G.type(Gi,"function","invalid attachment data");var Dn=Gi._reglType;return Dn==="texture2d"?(Pn=Gi,G(zn===Rs)):Dn==="textureCube"?(Pn=Gi,G(zn>=Ao&&zn<Ao+6,"invalid cube map target")):Dn==="renderbuffer"?(la=Gi,zn=Al):G.raise("invalid regl object for attachment"),new dn(zn,Pn,la)}function Zt(on,zn,Pn,la,Gi){if(Pn){var Dn=dr.create2D({width:on,height:zn,format:la,type:Gi});return Dn._texture.refCount=0,new dn(Rs,Dn,null)}else{var Bn=zr.create({width:on,height:zn,format:la});return Bn._renderbuffer.refCount=0,new dn(Al,null,Bn)}}function Cr(on){return on&&(on.texture||on.renderbuffer)}function rn(on,zn,Pn){on&&(on.texture?on.texture.resize(zn,Pn):on.renderbuffer&&on.renderbuffer.resize(zn,Pn),on.width=zn,on.height=Pn)}var On=0,Ur={};function _n(){this.id=On++,Ur[this.id]=this,this.framebuffer=W.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Nn(on){on.colorAttachments.forEach(vn),vn(on.depthAttachment),vn(on.stencilAttachment),vn(on.depthStencilAttachment)}function Ti(on){var zn=on.framebuffer;G(zn,"must not double destroy framebuffer"),W.deleteFramebuffer(zn),on.framebuffer=null,pr.framebufferCount--,delete Ur[on.id]}function kr(on){var zn;W.bindFramebuffer(Sl,on.framebuffer);var Pn=on.colorAttachments;for(zn=0;zn<Pn.length;++zn)an(ac+zn,Pn[zn]);for(zn=Pn.length;zn<ut.maxColorAttachments;++zn)W.framebufferTexture2D(Sl,ac+zn,Rs,null,0);W.framebufferTexture2D(Sl,ih,Rs,null,0),W.framebufferTexture2D(Sl,$h,Rs,null,0),W.framebufferTexture2D(Sl,tf,Rs,null,0),an($h,on.depthAttachment),an(tf,on.stencilAttachment),an(ih,on.depthStencilAttachment);var la=W.checkFramebufferStatus(Sl);!W.isContextLost()&&la!==Kh&&G.raise("framebuffer configuration not supported, status = "+_e[la]),W.bindFramebuffer(Sl,Lr.next?Lr.next.framebuffer:null),Lr.cur=Lr.next,W.getError()}function Fr(on,zn){var Pn=new _n;pr.framebufferCount++;function la(Dn,Bn){var Li;G(Lr.next!==Pn,"can not update framebuffer which is currently in use");var ta=0,Ma=0,qo=!0,$o=!0,Sa=null,Ys=!0,wo="rgba",Vs="uint8",gs=1,As=null,js=null,vu=null,zo=!1;if(typeof Dn=="number")ta=Dn|0,Ma=Bn|0||ta;else if(!Dn)ta=Ma=1;else{G.type(Dn,"object","invalid arguments for framebuffer");var sa=Dn;if("shape"in sa){var ws=sa.shape;G(Array.isArray(ws)&&ws.length>=2,"invalid shape for framebuffer"),ta=ws[0],Ma=ws[1]}else"radius"in sa&&(ta=Ma=sa.radius),"width"in sa&&(ta=sa.width),"height"in sa&&(Ma=sa.height);("color"in sa||"colors"in sa)&&(Sa=sa.color||sa.colors,Array.isArray(Sa)&&G(Sa.length===1||De.webgl_draw_buffers,"multiple render targets not supported")),Sa||("colorCount"in sa&&(gs=sa.colorCount|0,G(gs>0,"invalid color buffer count")),"colorTexture"in sa&&(Ys=!!sa.colorTexture,wo="rgba4"),"colorType"in sa&&(Vs=sa.colorType,Ys?(G(De.oes_texture_float||!(Vs==="float"||Vs==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),G(De.oes_texture_half_float||!(Vs==="half float"||Vs==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Vs==="half float"||Vs==="float16"?(G(De.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),wo="rgba16f"):(Vs==="float"||Vs==="float32")&&(G(De.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),wo="rgba32f"),G.oneOf(Vs,nn,"invalid color type")),"colorFormat"in sa&&(wo=sa.colorFormat,Gr.indexOf(wo)>=0?Ys=!0:qr.indexOf(wo)>=0?Ys=!1:G.optional(function(){Ys?G.oneOf(sa.colorFormat,Gr,"invalid color format for texture"):G.oneOf(sa.colorFormat,qr,"invalid color format for renderbuffer")}))),("depthTexture"in sa||"depthStencilTexture"in sa)&&(zo=!!(sa.depthTexture||sa.depthStencilTexture),G(!zo||De.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in sa&&(typeof sa.depth=="boolean"?qo=sa.depth:(As=sa.depth,$o=!1)),"stencil"in sa&&(typeof sa.stencil=="boolean"?$o=sa.stencil:(js=sa.stencil,qo=!1)),"depthStencil"in sa&&(typeof sa.depthStencil=="boolean"?qo=$o=sa.depthStencil:(vu=sa.depthStencil,qo=!1,$o=!1))}var Za=null,ru=null,Yi=null,Ia=null;if(Array.isArray(Sa))Za=Sa.map(hn);else if(Sa)Za=[hn(Sa)];else for(Za=new Array(gs),Li=0;Li<gs;++Li)Za[Li]=Zt(ta,Ma,Ys,wo,Vs);G(De.webgl_draw_buffers||Za.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),G(Za.length<=ut.maxColorAttachments,"too many color attachments, not supported"),ta=ta||Za[0].width,Ma=Ma||Za[0].height,As?ru=hn(As):qo&&!$o&&(ru=Zt(ta,Ma,zo,"depth","uint32")),js?Yi=hn(js):$o&&!qo&&(Yi=Zt(ta,Ma,!1,"stencil","uint8")),vu?Ia=hn(vu):!As&&!js&&$o&&qo&&(Ia=Zt(ta,Ma,zo,"depth stencil","depth stencil")),G(!!As+!!js+!!vu<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var eo=null;for(Li=0;Li<Za.length;++Li)if(kn(Za[Li],ta,Ma),G(!Za[Li]||Za[Li].texture&&Wu.indexOf(Za[Li].texture._texture.format)>=0||Za[Li].renderbuffer&&Pe.indexOf(Za[Li].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Li+" is invalid"),Za[Li]&&Za[Li].texture){var ys=nf[Za[Li].texture._texture.format]*c[Za[Li].texture._texture.type];eo===null?eo=ys:G(eo===ys,"all color attachments much have the same number of bits per pixel.")}return kn(ru,ta,Ma),G(!ru||ru.texture&&ru.texture._texture.format===Lh||ru.renderbuffer&&ru.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),kn(Yi,ta,Ma),G(!Yi||Yi.renderbuffer&&Yi.renderbuffer._renderbuffer.format===I,"invalid stencil attachment for framebuffer object"),kn(Ia,ta,Ma),G(!Ia||Ia.texture&&Ia.texture._texture.format===O||Ia.renderbuffer&&Ia.renderbuffer._renderbuffer.format===O,"invalid depth-stencil attachment for framebuffer object"),Nn(Pn),Pn.width=ta,Pn.height=Ma,Pn.colorAttachments=Za,Pn.depthAttachment=ru,Pn.stencilAttachment=Yi,Pn.depthStencilAttachment=Ia,la.color=Za.map(Cr),la.depth=Cr(ru),la.stencil=Cr(Yi),la.depthStencil=Cr(Ia),la.width=Pn.width,la.height=Pn.height,kr(Pn),la}function Gi(Dn,Bn){G(Lr.next!==Pn,"can not resize a framebuffer which is currently in use");var Li=Math.max(Dn|0,1),ta=Math.max(Bn|0||Li,1);if(Li===Pn.width&&ta===Pn.height)return la;for(var Ma=Pn.colorAttachments,qo=0;qo<Ma.length;++qo)rn(Ma[qo],Li,ta);return rn(Pn.depthAttachment,Li,ta),rn(Pn.stencilAttachment,Li,ta),rn(Pn.depthStencilAttachment,Li,ta),Pn.width=la.width=Li,Pn.height=la.height=ta,kr(Pn),la}return la(on,zn),y(la,{resize:Gi,_reglType:"framebuffer",_framebuffer:Pn,destroy:function(){Ti(Pn),Nn(Pn)},use:function(Dn){Lr.setFBO({framebuffer:la},Dn)}})}function oi(on){var zn=Array(6);function Pn(Gi){var Dn;G(zn.indexOf(Lr.next)<0,"can not update framebuffer which is currently in use");var Bn={color:null},Li=0,ta=null,Ma="rgba",qo="uint8",$o=1;if(typeof Gi=="number")Li=Gi|0;else if(!Gi)Li=1;else{G.type(Gi,"object","invalid arguments for framebuffer");var Sa=Gi;if("shape"in Sa){var Ys=Sa.shape;G(Array.isArray(Ys)&&Ys.length>=2,"invalid shape for framebuffer"),G(Ys[0]===Ys[1],"cube framebuffer must be square"),Li=Ys[0]}else"radius"in Sa&&(Li=Sa.radius|0),"width"in Sa?(Li=Sa.width|0,"height"in Sa&&G(Sa.height===Li,"must be square")):"height"in Sa&&(Li=Sa.height|0);("color"in Sa||"colors"in Sa)&&(ta=Sa.color||Sa.colors,Array.isArray(ta)&&G(ta.length===1||De.webgl_draw_buffers,"multiple render targets not supported")),ta||("colorCount"in Sa&&($o=Sa.colorCount|0,G($o>0,"invalid color buffer count")),"colorType"in Sa&&(G.oneOf(Sa.colorType,nn,"invalid color type"),qo=Sa.colorType),"colorFormat"in Sa&&(Ma=Sa.colorFormat,G.oneOf(Sa.colorFormat,Gr,"invalid color format for texture"))),"depth"in Sa&&(Bn.depth=Sa.depth),"stencil"in Sa&&(Bn.stencil=Sa.stencil),"depthStencil"in Sa&&(Bn.depthStencil=Sa.depthStencil)}var wo;if(ta)if(Array.isArray(ta))for(wo=[],Dn=0;Dn<ta.length;++Dn)wo[Dn]=ta[Dn];else wo=[ta];else{wo=Array($o);var Vs={radius:Li,format:Ma,type:qo};for(Dn=0;Dn<$o;++Dn)wo[Dn]=dr.createCube(Vs)}for(Bn.color=Array(wo.length),Dn=0;Dn<wo.length;++Dn){var gs=wo[Dn];G(typeof gs=="function"&&gs._reglType==="textureCube","invalid cube map"),Li=Li||gs.width,G(gs.width===Li&&gs.height===Li,"invalid cube map shape"),Bn.color[Dn]={target:Ao,data:wo[Dn]}}for(Dn=0;Dn<6;++Dn){for(var As=0;As<wo.length;++As)Bn.color[As].target=Ao+Dn;Dn>0&&(Bn.depth=zn[0].depth,Bn.stencil=zn[0].stencil,Bn.depthStencil=zn[0].depthStencil),zn[Dn]?zn[Dn](Bn):zn[Dn]=Fr(Bn)}return y(Pn,{width:Li,height:Li,color:wo})}function la(Gi){var Dn,Bn=Gi|0;if(G(Bn>0&&Bn<=ut.maxCubeMapSize,"invalid radius for cube fbo"),Bn===Pn.width)return Pn;var Li=Pn.color;for(Dn=0;Dn<Li.length;++Dn)Li[Dn].resize(Bn);for(Dn=0;Dn<6;++Dn)zn[Dn].resize(Bn);return Pn.width=Pn.height=Bn,Pn}return Pn(on),y(Pn,{faces:zn,resize:la,_reglType:"framebufferCube",destroy:function(){zn.forEach(function(Gi){Gi.destroy()})}})}function Rn(){Lr.cur=null,Lr.next=null,Lr.dirty=!0,ye(Ur).forEach(function(on){on.framebuffer=W.createFramebuffer(),kr(on)})}return y(Lr,{getFramebuffer:function(on){if(typeof on=="function"&&on._reglType==="framebuffer"){var zn=on._framebuffer;if(zn instanceof _n)return zn}return null},create:Fr,createCube:oi,clear:function(){ye(Ur).forEach(Ti)},restore:Rn})}var $e=5126,mt=34962,Ye=34963,gt=["attributes","elements","offset","count","primitive","instances"];function Pt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=$e,this.offset=0,this.stride=0,this.divisor=0}function qt(W,De,ut,dr,zr,pr,Lr){for(var Gr=ut.maxAttributes,qr=new Array(Gr),nn=0;nn<Gr;++nn)qr[nn]=new Pt;var dn=0,vn={},kn={Record:Pt,scope:{},state:qr,currentVAO:null,targetVAO:null,restore:hn()?Nn:function(){},createVAO:Ti,getVAO:Cr,destroyBuffer:an,setVAO:hn()?rn:On,clear:hn()?Ur:function(){}};function an(kr){for(var Fr=0;Fr<qr.length;++Fr){var oi=qr[Fr];oi.buffer===kr&&(W.disableVertexAttribArray(Fr),oi.buffer=null)}}function hn(){return De.oes_vertex_array_object}function Zt(){return De.angle_instanced_arrays}function Cr(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function rn(kr){if(kr!==kn.currentVAO){var Fr=hn();kr?Fr.bindVertexArrayOES(kr.vao):Fr.bindVertexArrayOES(null),kn.currentVAO=kr}}function On(kr){if(kr!==kn.currentVAO){if(kr)kr.bindAttrs();else{for(var Fr=Zt(),oi=0;oi<qr.length;++oi){var Rn=qr[oi];Rn.buffer?(W.enableVertexAttribArray(oi),Rn.buffer.bind(),W.vertexAttribPointer(oi,Rn.size,Rn.type,Rn.normalized,Rn.stride,Rn.offfset),Fr&&Rn.divisor&&Fr.vertexAttribDivisorANGLE(oi,Rn.divisor)):(W.disableVertexAttribArray(oi),W.vertexAttrib4f(oi,Rn.x,Rn.y,Rn.z,Rn.w))}Lr.elements?W.bindBuffer(Ye,Lr.elements.buffer.buffer):W.bindBuffer(Ye,null)}kn.currentVAO=kr}}function Ur(){ye(vn).forEach(function(kr){kr.destroy()})}function _n(){this.id=++dn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var kr=hn();kr?this.vao=kr.createVertexArrayOES():this.vao=null,vn[this.id]=this,this.buffers=[]}_n.prototype.bindAttrs=function(){for(var kr=Zt(),Fr=this.attributes,oi=0;oi<Fr.length;++oi){var Rn=Fr[oi];Rn.buffer?(W.enableVertexAttribArray(oi),W.bindBuffer(mt,Rn.buffer.buffer),W.vertexAttribPointer(oi,Rn.size,Rn.type,Rn.normalized,Rn.stride,Rn.offset),kr&&Rn.divisor&&kr.vertexAttribDivisorANGLE(oi,Rn.divisor)):(W.disableVertexAttribArray(oi),W.vertexAttrib4f(oi,Rn.x,Rn.y,Rn.z,Rn.w))}for(var on=Fr.length;on<Gr;++on)W.disableVertexAttribArray(on);var zn=pr.getElements(this.elements);zn?W.bindBuffer(Ye,zn.buffer.buffer):W.bindBuffer(Ye,null)},_n.prototype.refresh=function(){var kr=hn();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),kn.currentVAO=null,kr.bindVertexArrayOES(null))},_n.prototype.destroy=function(){if(this.vao){var kr=hn();this===kn.currentVAO&&(kn.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),vn[this.id]&&(delete vn[this.id],dr.vaoCount-=1)};function Nn(){var kr=hn();kr&&ye(vn).forEach(function(Fr){Fr.refresh()})}function Ti(kr){var Fr=new _n;dr.vaoCount+=1;function oi(Rn){var on;if(Array.isArray(Rn))on=Rn,Fr.elements&&Fr.ownsElements&&Fr.elements.destroy(),Fr.elements=null,Fr.ownsElements=!1,Fr.offset=0,Fr.count=0,Fr.instances=-1,Fr.primitive=4;else{if(G(typeof Rn=="object","invalid arguments for create vao"),G("attributes"in Rn,"must specify attributes for vao"),Rn.elements){var zn=Rn.elements;Fr.ownsElements?typeof zn=="function"&&zn._reglType==="elements"?(Fr.elements.destroy(),Fr.ownsElements=!1):(Fr.elements(zn),Fr.ownsElements=!1):pr.getElements(Rn.elements)?(Fr.elements=Rn.elements,Fr.ownsElements=!1):(Fr.elements=pr.create(Rn.elements),Fr.ownsElements=!0)}else Fr.elements=null,Fr.ownsElements=!1;on=Rn.attributes,Fr.offset=0,Fr.count=-1,Fr.instances=-1,Fr.primitive=4,Fr.elements&&(Fr.count=Fr.elements._elements.vertCount,Fr.primitive=Fr.elements._elements.primType),"offset"in Rn&&(Fr.offset=Rn.offset|0),"count"in Rn&&(Fr.count=Rn.count|0),"instances"in Rn&&(Fr.instances=Rn.instances|0),"primitive"in Rn&&(G(Rn.primitive in Br,"bad primitive type: "+Rn.primitive),Fr.primitive=Br[Rn.primitive]),G.optional(function(){for(var qo=Object.keys(Rn),$o=0;$o<qo.length;++$o)G(gt.indexOf(qo[$o])>=0,'invalid option for vao: "'+qo[$o]+'" valid options are '+gt)}),G(Array.isArray(on),"attributes must be an array")}G(on.length<Gr,"too many attributes"),G(on.length>0,"must specify at least one attribute");var Pn={},la=Fr.attributes;la.length=on.length;for(var Gi=0;Gi<on.length;++Gi){var Dn=on[Gi],Bn=la[Gi]=new Pt,Li=Dn.data||Dn;if(Array.isArray(Li)||ge(Li)||jo(Li)){var ta;Fr.buffers[Gi]&&(ta=Fr.buffers[Gi],ge(Li)&&ta._buffer.byteLength>=Li.byteLength?ta.subdata(Li):(ta.destroy(),Fr.buffers[Gi]=null)),Fr.buffers[Gi]||(ta=Fr.buffers[Gi]=zr.create(Dn,mt,!1,!0)),Bn.buffer=zr.getBuffer(ta),Bn.size=Bn.buffer.dimension|0,Bn.normalized=!1,Bn.type=Bn.buffer.dtype,Bn.offset=0,Bn.stride=0,Bn.divisor=0,Bn.state=1,Pn[Gi]=1}else zr.getBuffer(Dn)?(Bn.buffer=zr.getBuffer(Dn),Bn.size=Bn.buffer.dimension|0,Bn.normalized=!1,Bn.type=Bn.buffer.dtype,Bn.offset=0,Bn.stride=0,Bn.divisor=0,Bn.state=1):zr.getBuffer(Dn.buffer)?(Bn.buffer=zr.getBuffer(Dn.buffer),Bn.size=(+Dn.size||Bn.buffer.dimension)|0,Bn.normalized=!!Dn.normalized||!1,"type"in Dn?(G.parameter(Dn.type,xu,"invalid buffer type"),Bn.type=xu[Dn.type]):Bn.type=Bn.buffer.dtype,Bn.offset=(Dn.offset||0)|0,Bn.stride=(Dn.stride||0)|0,Bn.divisor=(Dn.divisor||0)|0,Bn.state=1,G(Bn.size>=1&&Bn.size<=4,"size must be between 1 and 4"),G(Bn.offset>=0,"invalid offset"),G(Bn.stride>=0&&Bn.stride<=255,"stride must be between 0 and 255"),G(Bn.divisor>=0,"divisor must be positive"),G(!Bn.divisor||!!De.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Dn?(G(Gi>0,"first attribute must not be a constant"),Bn.x=+Dn.x||0,Bn.y=+Dn.y||0,Bn.z=+Dn.z||0,Bn.w=+Dn.w||0,Bn.state=2):G(!1,"invalid attribute spec for location "+Gi)}for(var Ma=0;Ma<Fr.buffers.length;++Ma)!Pn[Ma]&&Fr.buffers[Ma]&&(Fr.buffers[Ma].destroy(),Fr.buffers[Ma]=null);return Fr.refresh(),oi}return oi.destroy=function(){for(var Rn=0;Rn<Fr.buffers.length;++Rn)Fr.buffers[Rn]&&Fr.buffers[Rn].destroy();Fr.buffers.length=0,Fr.ownsElements&&(Fr.elements.destroy(),Fr.elements=null,Fr.ownsElements=!1),Fr.destroy()},oi._vao=Fr,oi._reglType="vao",oi(kr)}return kn}var _r=35632,ir=35633,Mr=35718,Wr=35721;function Cn(W,De,ut,dr){var zr={},pr={};function Lr(Zt,Cr,rn,On){this.name=Zt,this.id=Cr,this.location=rn,this.info=On}function Gr(Zt,Cr){for(var rn=0;rn<Zt.length;++rn)if(Zt[rn].id===Cr.id){Zt[rn].location=Cr.location;return}Zt.push(Cr)}function qr(Zt,Cr,rn){var On=Zt===_r?zr:pr,Ur=On[Cr];if(!Ur){var _n=De.str(Cr);Ur=W.createShader(Zt),W.shaderSource(Ur,_n),W.compileShader(Ur),G.shaderError(W,Ur,_n,Zt,rn),On[Cr]=Ur}return Ur}var nn={},dn=[],vn=0;function kn(Zt,Cr){this.id=vn++,this.fragId=Zt,this.vertId=Cr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,dr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function an(Zt,Cr,rn){var On,Ur,_n=qr(_r,Zt.fragId),Nn=qr(ir,Zt.vertId),Ti=Zt.program=W.createProgram();if(W.attachShader(Ti,_n),W.attachShader(Ti,Nn),rn)for(On=0;On<rn.length;++On){var kr=rn[On];W.bindAttribLocation(Ti,kr[0],kr[1])}W.linkProgram(Ti),G.linkError(W,Ti,De.str(Zt.fragId),De.str(Zt.vertId),Cr);var Fr=W.getProgramParameter(Ti,Mr);dr.profile&&(Zt.stats.uniformsCount=Fr);var oi=Zt.uniforms;for(On=0;On<Fr;++On)if(Ur=W.getActiveUniform(Ti,On),Ur)if(Ur.size>1)for(var Rn=0;Rn<Ur.size;++Rn){var on=Ur.name.replace("[0]","["+Rn+"]");Gr(oi,new Lr(on,De.id(on),W.getUniformLocation(Ti,on),Ur))}else Gr(oi,new Lr(Ur.name,De.id(Ur.name),W.getUniformLocation(Ti,Ur.name),Ur));var zn=W.getProgramParameter(Ti,Wr);dr.profile&&(Zt.stats.attributesCount=zn);var Pn=Zt.attributes;for(On=0;On<zn;++On)Ur=W.getActiveAttrib(Ti,On),Ur&&Gr(Pn,new Lr(Ur.name,De.id(Ur.name),W.getAttribLocation(Ti,Ur.name),Ur))}dr.profile&&(ut.getMaxUniformsCount=function(){var Zt=0;return dn.forEach(function(Cr){Cr.stats.uniformsCount>Zt&&(Zt=Cr.stats.uniformsCount)}),Zt},ut.getMaxAttributesCount=function(){var Zt=0;return dn.forEach(function(Cr){Cr.stats.attributesCount>Zt&&(Zt=Cr.stats.attributesCount)}),Zt});function hn(){zr={},pr={};for(var Zt=0;Zt<dn.length;++Zt)an(dn[Zt],null,dn[Zt].attributes.map(function(Cr){return[Cr.location,Cr.name]}))}return{clear:function(){var Zt=W.deleteShader.bind(W);ye(zr).forEach(Zt),zr={},ye(pr).forEach(Zt),pr={},dn.forEach(function(Cr){W.deleteProgram(Cr.program)}),dn.length=0,nn={},ut.shaderCount=0},program:function(Zt,Cr,rn,On){G.command(Zt>=0,"missing vertex shader",rn),G.command(Cr>=0,"missing fragment shader",rn);var Ur=nn[Cr];Ur||(Ur=nn[Cr]={});var _n=Ur[Zt];if(_n&&(_n.refCount++,!On))return _n;var Nn=new kn(Cr,Zt);return ut.shaderCount++,an(Nn,rn,On),_n||(Ur[Zt]=Nn),dn.push(Nn),y(Nn,{destroy:function(){if(Nn.refCount--,Nn.refCount<=0){W.deleteProgram(Nn.program);var Ti=dn.indexOf(Nn);dn.splice(Ti,1),ut.shaderCount--}Ur[Nn.vertId].refCount<=0&&(W.deleteShader(pr[Nn.vertId]),delete pr[Nn.vertId],delete nn[Nn.fragId][Nn.vertId]),Object.keys(nn[Nn.fragId]).length||(W.deleteShader(zr[Nn.fragId]),delete zr[Nn.fragId],delete nn[Nn.fragId])}})},restore:hn,shader:qr,frag:-1,vert:-1}}var yn=6408,Hn=5121,xi=3333,Si=5126;function bi(W,De,ut,dr,zr,pr,Lr){function Gr(dn){var vn;De.next===null?(G(zr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),vn=Hn):(G(De.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),vn=De.next.colorAttachments[0].texture._texture.type,G.optional(function(){pr.oes_texture_float?(G(vn===Hn||vn===Si,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),vn===Si&&G(Lr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):G(vn===Hn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var kn=0,an=0,hn=dr.framebufferWidth,Zt=dr.framebufferHeight,Cr=null;ge(dn)?Cr=dn:dn&&(G.type(dn,"object","invalid arguments to regl.read()"),kn=dn.x|0,an=dn.y|0,G(kn>=0&&kn<dr.framebufferWidth,"invalid x offset for regl.read"),G(an>=0&&an<dr.framebufferHeight,"invalid y offset for regl.read"),hn=(dn.width||dr.framebufferWidth-kn)|0,Zt=(dn.height||dr.framebufferHeight-an)|0,Cr=dn.data||null),Cr&&(vn===Hn?G(Cr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):vn===Si&&G(Cr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),G(hn>0&&hn+kn<=dr.framebufferWidth,"invalid width for read pixels"),G(Zt>0&&Zt+an<=dr.framebufferHeight,"invalid height for read pixels"),ut();var rn=hn*Zt*4;return Cr||(vn===Hn?Cr=new Uint8Array(rn):vn===Si&&(Cr=Cr||new Float32Array(rn))),G.isTypedArray(Cr,"data buffer for regl.read() must be a typedarray"),G(Cr.byteLength>=rn,"data buffer for regl.read() too small"),W.pixelStorei(xi,4),W.readPixels(kn,an,hn,Zt,yn,vn,Cr),Cr}function qr(dn){var vn;return De.setFBO({framebuffer:dn.framebuffer},function(){vn=Gr(dn)}),vn}function nn(dn){return!dn||!("framebuffer"in dn)?Gr(dn):qr(dn)}return nn}function Ca(W){return Array.prototype.slice.call(W)}function qn(W){return Ca(W).join("")}function Hi(){var W=0,De=[],ut=[];function dr(vn){for(var kn=0;kn<ut.length;++kn)if(ut[kn]===vn)return De[kn];var an="g"+W++;return De.push(an),ut.push(vn),an}function zr(){var vn=[];function kn(){vn.push.apply(vn,Ca(arguments))}var an=[];function hn(){var Zt="v"+W++;return an.push(Zt),arguments.length>0&&(vn.push(Zt,"="),vn.push.apply(vn,Ca(arguments)),vn.push(";")),Zt}return y(kn,{def:hn,toString:function(){return qn([an.length>0?"var "+an.join(",")+";":"",qn(vn)])}})}function pr(){var vn=zr(),kn=zr(),an=vn.toString,hn=kn.toString;function Zt(Cr,rn){kn(Cr,rn,"=",vn.def(Cr,rn),";")}return y(function(){vn.apply(vn,Ca(arguments))},{def:vn.def,entry:vn,exit:kn,save:Zt,set:function(Cr,rn,On){Zt(Cr,rn),vn(Cr,rn,"=",On,";")},toString:function(){return an()+hn()}})}function Lr(){var vn=qn(arguments),kn=pr(),an=pr(),hn=kn.toString,Zt=an.toString;return y(kn,{then:function(){return kn.apply(kn,Ca(arguments)),this},else:function(){return an.apply(an,Ca(arguments)),this},toString:function(){var Cr=Zt();return Cr&&(Cr="else{"+Cr+"}"),qn(["if(",vn,"){",hn(),"}",Cr])}})}var Gr=zr(),qr={};function nn(vn,kn){var an=[];function hn(){var Ur="a"+an.length;return an.push(Ur),Ur}kn=kn||0;for(var Zt=0;Zt<kn;++Zt)hn();var Cr=pr(),rn=Cr.toString,On=qr[vn]=y(Cr,{arg:hn,toString:function(){return qn(["function(",an.join(),"){",rn(),"}"])}});return On}function dn(){var vn=['"use strict";',Gr,"return {"];Object.keys(qr).forEach(function(Zt){vn.push('"',Zt,'":',qr[Zt].toString(),",")}),vn.push("}");var kn=qn(vn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),an=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,hn=an?Re.Function.apply(null,De.concat(kn)):Function.apply(null,De.concat(kn));return hn.apply(null,ut)}return{global:Gr,link:dr,block:zr,proc:nn,scope:pr,cond:Lr,compile:dn}}var Qi="xyzw".split(""),Wi=5121,Oi=1,oa=2,Zi=0,wi=1,ls=2,Xo=3,Ds=4,cs=5,co=6,es="dither",ts="blend.enable",Fs="blend.color",lc="blend.equation",eu="blend.func",Xu="depth.enable",Cu="depth.func",Of="depth.range",cc="depth.mask",Wl="colorMask",Tl="cull.enable",Rf="cull.face",fl="frontFace",fc="lineWidth",Xl="polygonOffset.enable",fs="polygonOffset.offset",Ml="sample.alpha",Dc="sample.enable",Bs="sample.coverage",za="stencil.enable",Du="stencil.mask",Xs="stencil.func",hc="stencil.opFront",ah="stencil.opBack",Df="scissor.enable",Ep="scissor.box",Yu="viewport",Fc="profile",Su="framebuffer",Ff="vert",oh="frag",Yl="elements",Ns="primitive",Bf="count",Il="offset",Oh="instances",tu="vao",sh="Width",Fu="Height",ae=Su+sh,cn=Su+Fu,uh=Yu+sh,kv=Yu+Fu,Io="drawingBuffer",hl=Io+sh,lh=Io+Fu,Xp=[eu,lc,Xs,hc,ah,Bs,Yu,Ep,fs],zs=34962,Au=34963,Cd=35632,Jd=35633,Sd=3553,Rh=34067,pc=2884,ch=3042,Nf=3024,hs=2960,Cp=2929,Yp=3089,Xi=32823,qp=32926,Dh=32928,Bc=5126,Sp=35664,Pl=35665,af=35666,of=5124,$p=35667,fh=35668,dc=35669,Ap=35670,Qh=35671,vc=35672,sf=35673,kl=35674,hh=35675,uf=35676,Bu=35678,ph=35680,wp=4,Nc=1028,lf=1029,Ad=2304,zf=2305,wd=32775,mc=32776,ql=519,Us=7680,Uf=0,zc=1,Fh=32774,Uc=513,Tp=36160,Lv=36064,gc={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},dh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],vh={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Zf={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Td={frag:Cd,vert:Jd},Kp={cw:Ad,ccw:zf};function qu(W){return Array.isArray(W)||ge(W)||jo(W)}function Mp(W){return W.sort(function(De,ut){return De===Yu?-1:ut===Yu?1:De<ut?-1:1})}function so(W,De,ut,dr){this.thisDep=W,this.contextDep=De,this.propDep=ut,this.append=dr}function Zc(W){return W&&!(W.thisDep||W.contextDep||W.propDep)}function Ja(W){return new so(!1,!1,!1,W)}function Zs(W,De){var ut=W.type;if(ut===Zi){var dr=W.data.length;return new so(!0,dr>=1,dr>=2,De)}else if(ut===Ds){var zr=W.data;return new so(zr.thisDep,zr.contextDep,zr.propDep,De)}else{if(ut===cs)return new so(!1,!1,!1,De);if(ut===co){for(var pr=!1,Lr=!1,Gr=!1,qr=0;qr<W.data.length;++qr){var nn=W.data[qr];if(nn.type===wi)Gr=!0;else if(nn.type===ls)Lr=!0;else if(nn.type===Xo)pr=!0;else if(nn.type===Zi){pr=!0;var dn=nn.data;dn>=1&&(Lr=!0),dn>=2&&(Gr=!0)}else nn.type===Ds&&(pr=pr||nn.data.thisDep,Lr=Lr||nn.data.contextDep,Gr=Gr||nn.data.propDep)}return new so(pr,Lr,Gr,De)}else return new so(ut===Xo,ut===ls,ut===wi,De)}}var Qp=new so(!1,!1,!1,function(){});function Jp(W,De,ut,dr,zr,pr,Lr,Gr,qr,nn,dn,vn,kn,an,hn){var Zt=nn.Record,Cr={add:32774,subtract:32778,"reverse subtract":32779};ut.ext_blend_minmax&&(Cr.min=wd,Cr.max=mc);var rn=ut.angle_instanced_arrays,On=ut.webgl_draw_buffers,Ur=ut.oes_vertex_array_object,_n={dirty:!0,profile:hn.profile},Nn={},Ti=[],kr={},Fr={};function oi(Ge){return Ge.replace(".","_")}function Rn(Ge,we,vt){var Wt=oi(Ge);Ti.push(Ge),Nn[Wt]=_n[Wt]=!!vt,kr[Wt]=we}function on(Ge,we,vt){var Wt=oi(Ge);Ti.push(Ge),Array.isArray(vt)?(_n[Wt]=vt.slice(),Nn[Wt]=vt.slice()):_n[Wt]=Nn[Wt]=vt,Fr[Wt]=we}Rn(es,Nf),Rn(ts,ch),on(Fs,"blendColor",[0,0,0,0]),on(lc,"blendEquationSeparate",[Fh,Fh]),on(eu,"blendFuncSeparate",[zc,Uf,zc,Uf]),Rn(Xu,Cp,!0),on(Cu,"depthFunc",Uc),on(Of,"depthRange",[0,1]),on(cc,"depthMask",!0),on(Wl,Wl,[!0,!0,!0,!0]),Rn(Tl,pc),on(Rf,"cullFace",lf),on(fl,fl,zf),on(fc,fc,1),Rn(Xl,Xi),on(fs,"polygonOffset",[0,0]),Rn(Ml,qp),Rn(Dc,Dh),on(Bs,"sampleCoverage",[1,!1]),Rn(za,hs),on(Du,"stencilMask",-1),on(Xs,"stencilFunc",[ql,0,-1]),on(hc,"stencilOpSeparate",[Nc,Us,Us,Us]),on(ah,"stencilOpSeparate",[lf,Us,Us,Us]),Rn(Df,Yp),on(Ep,"scissor",[0,0,W.drawingBufferWidth,W.drawingBufferHeight]),on(Yu,Yu,[0,0,W.drawingBufferWidth,W.drawingBufferHeight]);var zn={gl:W,context:kn,strings:De,next:Nn,current:_n,draw:vn,elements:pr,buffer:zr,shader:dn,attributes:nn.state,vao:nn,uniforms:qr,framebuffer:Gr,extensions:ut,timer:an,isBufferArgs:qu},Pn={primTypes:Br,compareFuncs:vh,blendFuncs:gc,blendEquations:Cr,stencilOps:Zf,glTypes:xu,orientationType:Kp};G.optional(function(){zn.isArrayLike=Ho}),On&&(Pn.backBuffer=[lf],Pn.drawBuffer=ct(dr.maxDrawbuffers,function(Ge){return Ge===0?[0]:ct(Ge,function(we){return Lv+we})}));var la=0;function Gi(){var Ge=Hi(),we=Ge.link,vt=Ge.global;Ge.id=la++,Ge.batchId="0";var Wt=we(zn),ur=Ge.shared={props:"a0"};Object.keys(zn).forEach(function(pt){ur[pt]=vt.def(Wt,".",pt)}),G.optional(function(){Ge.CHECK=we(G),Ge.commandStr=G.guessCommand(),Ge.command=we(Ge.commandStr),Ge.assert=function(pt,We,jt){pt("if(!(",We,"))",this.CHECK,".commandRaise(",we(jt),",",this.command,");")},Pn.invalidBlendCombinations=dh});var bt=Ge.next={},ot=Ge.current={};Object.keys(Fr).forEach(function(pt){Array.isArray(_n[pt])&&(bt[pt]=vt.def(ur.next,".",pt),ot[pt]=vt.def(ur.current,".",pt))});var kt=Ge.constants={};Object.keys(Pn).forEach(function(pt){kt[pt]=vt.def(JSON.stringify(Pn[pt]))}),Ge.invoke=function(pt,We){switch(We.type){case Zi:var jt=["this",ur.context,ur.props,Ge.batchId];return pt.def(we(We.data),".call(",jt.slice(0,Math.max(We.data.length+1,4)),")");case wi:return pt.def(ur.props,We.data);case ls:return pt.def(ur.context,We.data);case Xo:return pt.def("this",We.data);case Ds:return We.data.append(Ge,pt),We.data.ref;case cs:return We.data.toString();case co:return We.data.map(function(Kt){return Ge.invoke(pt,Kt)})}},Ge.attribCache={};var Ne={};return Ge.scopeAttrib=function(pt){var We=De.id(pt);if(We in Ne)return Ne[We];var jt=nn.scope[We];jt||(jt=nn.scope[We]=new Zt);var Kt=Ne[We]=we(jt);return Kt},Ge}function Dn(Ge){var we=Ge.static,vt=Ge.dynamic,Wt;if(Fc in we){var ur=!!we[Fc];Wt=Ja(function(ot,kt){return ur}),Wt.enable=ur}else if(Fc in vt){var bt=vt[Fc];Wt=Zs(bt,function(ot,kt){return ot.invoke(kt,bt)})}return Wt}function Bn(Ge,we){var vt=Ge.static,Wt=Ge.dynamic;if(Su in vt){var ur=vt[Su];return ur?(ur=Gr.getFramebuffer(ur),G.command(ur,"invalid framebuffer object"),Ja(function(ot,kt){var Ne=ot.link(ur),pt=ot.shared;kt.set(pt.framebuffer,".next",Ne);var We=pt.context;return kt.set(We,"."+ae,Ne+".width"),kt.set(We,"."+cn,Ne+".height"),Ne})):Ja(function(ot,kt){var Ne=ot.shared;kt.set(Ne.framebuffer,".next","null");var pt=Ne.context;return kt.set(pt,"."+ae,pt+"."+hl),kt.set(pt,"."+cn,pt+"."+lh),"null"})}else if(Su in Wt){var bt=Wt[Su];return Zs(bt,function(ot,kt){var Ne=ot.invoke(kt,bt),pt=ot.shared,We=pt.framebuffer,jt=kt.def(We,".getFramebuffer(",Ne,")");G.optional(function(){ot.assert(kt,"!"+Ne+"||"+jt,"invalid framebuffer object")}),kt.set(We,".next",jt);var Kt=pt.context;return kt.set(Kt,"."+ae,jt+"?"+jt+".width:"+Kt+"."+hl),kt.set(Kt,"."+cn,jt+"?"+jt+".height:"+Kt+"."+lh),jt})}else return null}function Li(Ge,we,vt){var Wt=Ge.static,ur=Ge.dynamic;function bt(Ne){if(Ne in Wt){var pt=Wt[Ne];G.commandType(pt,"object","invalid "+Ne,vt.commandStr);var We=!0,jt=pt.x|0,Kt=pt.y|0,Vr,An;return"width"in pt?(Vr=pt.width|0,G.command(Vr>=0,"invalid "+Ne,vt.commandStr)):We=!1,"height"in pt?(An=pt.height|0,G.command(An>=0,"invalid "+Ne,vt.commandStr)):We=!1,new so(!We&&we&&we.thisDep,!We&&we&&we.contextDep,!We&&we&&we.propDep,function(xn,$n){var Wn=xn.shared.context,Kn=Vr;"width"in pt||(Kn=$n.def(Wn,".",ae,"-",jt));var ui=An;return"height"in pt||(ui=$n.def(Wn,".",cn,"-",Kt)),[jt,Kt,Kn,ui]})}else if(Ne in ur){var un=ur[Ne],Gn=Zs(un,function(xn,$n){var Wn=xn.invoke($n,un);G.optional(function(){xn.assert($n,Wn+"&&typeof "+Wn+'==="object"',"invalid "+Ne)});var Kn=xn.shared.context,ui=$n.def(Wn,".x|0"),Qn=$n.def(Wn,".y|0"),Ni=$n.def('"width" in ',Wn,"?",Wn,".width|0:","(",Kn,".",ae,"-",ui,")"),Ua=$n.def('"height" in ',Wn,"?",Wn,".height|0:","(",Kn,".",cn,"-",Qn,")");return G.optional(function(){xn.assert($n,Ni+">=0&&"+Ua+">=0","invalid "+Ne)}),[ui,Qn,Ni,Ua]});return we&&(Gn.thisDep=Gn.thisDep||we.thisDep,Gn.contextDep=Gn.contextDep||we.contextDep,Gn.propDep=Gn.propDep||we.propDep),Gn}else return we?new so(we.thisDep,we.contextDep,we.propDep,function(xn,$n){var Wn=xn.shared.context;return[0,0,$n.def(Wn,".",ae),$n.def(Wn,".",cn)]}):null}var ot=bt(Yu);if(ot){var kt=ot;ot=new so(ot.thisDep,ot.contextDep,ot.propDep,function(Ne,pt){var We=kt.append(Ne,pt),jt=Ne.shared.context;return pt.set(jt,"."+uh,We[2]),pt.set(jt,"."+kv,We[3]),We})}return{viewport:ot,scissor_box:bt(Ep)}}function ta(Ge,we){var vt=Ge.static,Wt=typeof vt[oh]=="string"&&typeof vt[Ff]=="string";if(Wt){if(Object.keys(we.dynamic).length>0)return null;var ur=we.static,bt=Object.keys(ur);if(bt.length>0&&typeof ur[bt[0]]=="number"){for(var ot=[],kt=0;kt<bt.length;++kt)G(typeof ur[bt[kt]]=="number","must specify all vertex attribute locations when using vaos"),ot.push([ur[bt[kt]]|0,bt[kt]]);return ot}}return null}function Ma(Ge,we,vt){var Wt=Ge.static,ur=Ge.dynamic;function bt(We){if(We in Wt){var jt=De.id(Wt[We]);G.optional(function(){dn.shader(Td[We],jt,G.guessCommand())});var Kt=Ja(function(){return jt});return Kt.id=jt,Kt}else if(We in ur){var Vr=ur[We];return Zs(Vr,function(An,un){var Gn=An.invoke(un,Vr),xn=un.def(An.shared.strings,".id(",Gn,")");return G.optional(function(){un(An.shared.shader,".shader(",Td[We],",",xn,",",An.command,");")}),xn})}return null}var ot=bt(oh),kt=bt(Ff),Ne=null,pt;return Zc(ot)&&Zc(kt)?(Ne=dn.program(kt.id,ot.id,null,vt),pt=Ja(function(We,jt){return We.link(Ne)})):pt=new so(ot&&ot.thisDep||kt&&kt.thisDep,ot&&ot.contextDep||kt&&kt.contextDep,ot&&ot.propDep||kt&&kt.propDep,function(We,jt){var Kt=We.shared.shader,Vr;ot?Vr=ot.append(We,jt):Vr=jt.def(Kt,".",oh);var An;kt?An=kt.append(We,jt):An=jt.def(Kt,".",Ff);var un=Kt+".program("+An+","+Vr;return G.optional(function(){un+=","+We.command}),jt.def(un+")")}),{frag:ot,vert:kt,progVar:pt,program:Ne}}function qo(Ge,we){var vt=Ge.static,Wt=Ge.dynamic,ur={},bt=!1;function ot(){if(tu in vt){var $n=vt[tu];return $n!==null&&nn.getVAO($n)===null&&($n=nn.createVAO($n)),bt=!0,ur.vao=$n,Ja(function(Kn){var ui=nn.getVAO($n);return ui?Kn.link(ui):"null"})}else if(tu in Wt){bt=!0;var Wn=Wt[tu];return Zs(Wn,function(Kn,ui){var Qn=Kn.invoke(ui,Wn);return ui.def(Kn.shared.vao+".getVAO("+Qn+")")})}return null}var kt=ot(),Ne=!1;function pt(){if(Yl in vt){var $n=vt[Yl];if(ur.elements=$n,qu($n)){var Wn=ur.elements=pr.create($n,!0);$n=pr.getElements(Wn),Ne=!0}else $n&&($n=pr.getElements($n),Ne=!0,G.command($n,"invalid elements",we.commandStr));var Kn=Ja(function(Qn,Ni){if($n){var Ua=Qn.link($n);return Qn.ELEMENTS=Ua,Ua}return Qn.ELEMENTS=null,null});return Kn.value=$n,Kn}else if(Yl in Wt){Ne=!0;var ui=Wt[Yl];return Zs(ui,function(Qn,Ni){var Ua=Qn.shared,qs=Ua.isBufferArgs,Po=Ua.elements,$a=Qn.invoke(Ni,ui),jc=Ni.def("null"),Nu=Ni.def(qs,"(",$a,")"),yc=Qn.cond(Nu).then(jc,"=",Po,".createStream(",$a,");").else(jc,"=",Po,".getElements(",$a,");");return G.optional(function(){Qn.assert(yc.else,"!"+$a+"||"+jc,"invalid elements")}),Ni.entry(yc),Ni.exit(Qn.cond(Nu).then(Po,".destroyStream(",jc,");")),Qn.ELEMENTS=jc,jc})}else if(bt)return new so(kt.thisDep,kt.contextDep,kt.propDep,function(Qn,Ni){return Ni.def(Qn.shared.vao+".currentVAO?"+Qn.shared.elements+".getElements("+Qn.shared.vao+".currentVAO.elements):null")});return null}var We=pt();function jt(){if(Ns in vt){var $n=vt[Ns];return ur.primitive=$n,G.commandParameter($n,Br,"invalid primitve",we.commandStr),Ja(function(Kn,ui){return Br[$n]})}else if(Ns in Wt){var Wn=Wt[Ns];return Zs(Wn,function(Kn,ui){var Qn=Kn.constants.primTypes,Ni=Kn.invoke(ui,Wn);return G.optional(function(){Kn.assert(ui,Ni+" in "+Qn,"invalid primitive, must be one of "+Object.keys(Br))}),ui.def(Qn,"[",Ni,"]")})}else{if(Ne)return Zc(We)?We.value?Ja(function(Kn,ui){return ui.def(Kn.ELEMENTS,".primType")}):Ja(function(){return wp}):new so(We.thisDep,We.contextDep,We.propDep,function(Kn,ui){var Qn=Kn.ELEMENTS;return ui.def(Qn,"?",Qn,".primType:",wp)});if(bt)return new so(kt.thisDep,kt.contextDep,kt.propDep,function(Kn,ui){return ui.def(Kn.shared.vao+".currentVAO?"+Kn.shared.vao+".currentVAO.primitive:"+wp)})}return null}function Kt($n,Wn){if($n in vt){var Kn=vt[$n]|0;return Wn?ur.offset=Kn:ur.instances=Kn,G.command(!Wn||Kn>=0,"invalid "+$n,we.commandStr),Ja(function(Qn,Ni){return Wn&&(Qn.OFFSET=Kn),Kn})}else if($n in Wt){var ui=Wt[$n];return Zs(ui,function(Qn,Ni){var Ua=Qn.invoke(Ni,ui);return Wn&&(Qn.OFFSET=Ua,G.optional(function(){Qn.assert(Ni,Ua+">=0","invalid "+$n)})),Ua})}else if(Wn){if(Ne)return Ja(function(Qn,Ni){return Qn.OFFSET=0,0});if(bt)return new so(kt.thisDep,kt.contextDep,kt.propDep,function(Qn,Ni){return Ni.def(Qn.shared.vao+".currentVAO?"+Qn.shared.vao+".currentVAO.offset:0")})}else if(bt)return new so(kt.thisDep,kt.contextDep,kt.propDep,function(Qn,Ni){return Ni.def(Qn.shared.vao+".currentVAO?"+Qn.shared.vao+".currentVAO.instances:-1")});return null}var Vr=Kt(Il,!0);function An(){if(Bf in vt){var $n=vt[Bf]|0;return ur.count=$n,G.command(typeof $n=="number"&&$n>=0,"invalid vertex count",we.commandStr),Ja(function(){return $n})}else if(Bf in Wt){var Wn=Wt[Bf];return Zs(Wn,function(Ni,Ua){var qs=Ni.invoke(Ua,Wn);return G.optional(function(){Ni.assert(Ua,"typeof "+qs+'==="number"&&'+qs+">=0&&"+qs+"===("+qs+"|0)","invalid vertex count")}),qs})}else if(Ne)if(Zc(We)){if(We)return Vr?new so(Vr.thisDep,Vr.contextDep,Vr.propDep,function(Ni,Ua){var qs=Ua.def(Ni.ELEMENTS,".vertCount-",Ni.OFFSET);return G.optional(function(){Ni.assert(Ua,qs+">=0","invalid vertex offset/element buffer too small")}),qs}):Ja(function(Ni,Ua){return Ua.def(Ni.ELEMENTS,".vertCount")});var Kn=Ja(function(){return-1});return G.optional(function(){Kn.MISSING=!0}),Kn}else{var ui=new so(We.thisDep||Vr.thisDep,We.contextDep||Vr.contextDep,We.propDep||Vr.propDep,function(Ni,Ua){var qs=Ni.ELEMENTS;return Ni.OFFSET?Ua.def(qs,"?",qs,".vertCount-",Ni.OFFSET,":-1"):Ua.def(qs,"?",qs,".vertCount:-1")});return G.optional(function(){ui.DYNAMIC=!0}),ui}else if(bt){var Qn=new so(kt.thisDep,kt.contextDep,kt.propDep,function(Ni,Ua){return Ua.def(Ni.shared.vao,".currentVAO?",Ni.shared.vao,".currentVAO.count:-1")});return Qn}return null}var un=jt(),Gn=An(),xn=Kt(Oh,!1);return{elements:We,primitive:un,count:Gn,instances:xn,offset:Vr,vao:kt,vaoActive:bt,elementsActive:Ne,static:ur}}function $o(Ge,we){var vt=Ge.static,Wt=Ge.dynamic,ur={};return Ti.forEach(function(bt){var ot=oi(bt);function kt(Ne,pt){if(bt in vt){var We=Ne(vt[bt]);ur[ot]=Ja(function(){return We})}else if(bt in Wt){var jt=Wt[bt];ur[ot]=Zs(jt,function(Kt,Vr){return pt(Kt,Vr,Kt.invoke(Vr,jt))})}}switch(bt){case Tl:case ts:case es:case za:case Xu:case Df:case Xl:case Ml:case Dc:case cc:return kt(function(Ne){return G.commandType(Ne,"boolean",bt,we.commandStr),Ne},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,"typeof "+We+'==="boolean"',"invalid flag "+bt,Ne.commandStr)}),We});case Cu:return kt(function(Ne){return G.commandParameter(Ne,vh,"invalid "+bt,we.commandStr),vh[Ne]},function(Ne,pt,We){var jt=Ne.constants.compareFuncs;return G.optional(function(){Ne.assert(pt,We+" in "+jt,"invalid "+bt+", must be one of "+Object.keys(vh))}),pt.def(jt,"[",We,"]")});case Of:return kt(function(Ne){return G.command(Ho(Ne)&&Ne.length===2&&typeof Ne[0]=="number"&&typeof Ne[1]=="number"&&Ne[0]<=Ne[1],"depth range is 2d array",we.commandStr),Ne},function(Ne,pt,We){G.optional(function(){Ne.assert(pt,Ne.shared.isArrayLike+"("+We+")&&"+We+".length===2&&typeof "+We+'[0]==="number"&&typeof '+We+'[1]==="number"&&'+We+"[0]<="+We+"[1]","depth range must be a 2d array")});var jt=pt.def("+",We,"[0]"),Kt=pt.def("+",We,"[1]");return[jt,Kt]});case eu:return kt(function(Ne){G.commandType(Ne,"object","blend.func",we.commandStr);var pt="srcRGB"in Ne?Ne.srcRGB:Ne.src,We="srcAlpha"in Ne?Ne.srcAlpha:Ne.src,jt="dstRGB"in Ne?Ne.dstRGB:Ne.dst,Kt="dstAlpha"in Ne?Ne.dstAlpha:Ne.dst;return G.commandParameter(pt,gc,ot+".srcRGB",we.commandStr),G.commandParameter(We,gc,ot+".srcAlpha",we.commandStr),G.commandParameter(jt,gc,ot+".dstRGB",we.commandStr),G.commandParameter(Kt,gc,ot+".dstAlpha",we.commandStr),G.command(dh.indexOf(pt+", "+jt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+pt+", "+jt+")",we.commandStr),[gc[pt],gc[jt],gc[We],gc[Kt]]},function(Ne,pt,We){var jt=Ne.constants.blendFuncs;G.optional(function(){Ne.assert(pt,We+"&&typeof "+We+'==="object"',"invalid blend func, must be an object")});function Kt(Wn,Kn){var ui=pt.def('"',Wn,Kn,'" in ',We,"?",We,".",Wn,Kn,":",We,".",Wn);return G.optional(function(){Ne.assert(pt,ui+" in "+jt,"invalid "+bt+"."+Wn+Kn+", must be one of "+Object.keys(gc))}),ui}var Vr=Kt("src","RGB"),An=Kt("dst","RGB");G.optional(function(){var Wn=Ne.constants.invalidBlendCombinations;Ne.assert(pt,Wn+".indexOf("+Vr+'+", "+'+An+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var un=pt.def(jt,"[",Vr,"]"),Gn=pt.def(jt,"[",Kt("src","Alpha"),"]"),xn=pt.def(jt,"[",An,"]"),$n=pt.def(jt,"[",Kt("dst","Alpha"),"]");return[un,xn,Gn,$n]});case lc:return kt(function(Ne){if(typeof Ne=="string")return G.commandParameter(Ne,Cr,"invalid "+bt,we.commandStr),[Cr[Ne],Cr[Ne]];if(typeof Ne=="object")return G.commandParameter(Ne.rgb,Cr,bt+".rgb",we.commandStr),G.commandParameter(Ne.alpha,Cr,bt+".alpha",we.commandStr),[Cr[Ne.rgb],Cr[Ne.alpha]];G.commandRaise("invalid blend.equation",we.commandStr)},function(Ne,pt,We){var jt=Ne.constants.blendEquations,Kt=pt.def(),Vr=pt.def(),An=Ne.cond("typeof ",We,'==="string"');return G.optional(function(){function un(Gn,xn,$n){Ne.assert(Gn,$n+" in "+jt,"invalid "+xn+", must be one of "+Object.keys(Cr))}un(An.then,bt,We),Ne.assert(An.else,We+"&&typeof "+We+'==="object"',"invalid "+bt),un(An.else,bt+".rgb",We+".rgb"),un(An.else,bt+".alpha",We+".alpha")}),An.then(Kt,"=",Vr,"=",jt,"[",We,"];"),An.else(Kt,"=",jt,"[",We,".rgb];",Vr,"=",jt,"[",We,".alpha];"),pt(An),[Kt,Vr]});case Fs:return kt(function(Ne){return G.command(Ho(Ne)&&Ne.length===4,"blend.color must be a 4d array",we.commandStr),ct(4,function(pt){return+Ne[pt]})},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,Ne.shared.isArrayLike+"("+We+")&&"+We+".length===4","blend.color must be a 4d array")}),ct(4,function(jt){return pt.def("+",We,"[",jt,"]")})});case Du:return kt(function(Ne){return G.commandType(Ne,"number",ot,we.commandStr),Ne|0},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,"typeof "+We+'==="number"',"invalid stencil.mask")}),pt.def(We,"|0")});case Xs:return kt(function(Ne){G.commandType(Ne,"object",ot,we.commandStr);var pt=Ne.cmp||"keep",We=Ne.ref||0,jt="mask"in Ne?Ne.mask:-1;return G.commandParameter(pt,vh,bt+".cmp",we.commandStr),G.commandType(We,"number",bt+".ref",we.commandStr),G.commandType(jt,"number",bt+".mask",we.commandStr),[vh[pt],We,jt]},function(Ne,pt,We){var jt=Ne.constants.compareFuncs;G.optional(function(){function un(){Ne.assert(pt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}un(We+"&&typeof ",We,'==="object"'),un('!("cmp" in ',We,")||(",We,".cmp in ",jt,")")});var Kt=pt.def('"cmp" in ',We,"?",jt,"[",We,".cmp]",":",Us),Vr=pt.def(We,".ref|0"),An=pt.def('"mask" in ',We,"?",We,".mask|0:-1");return[Kt,Vr,An]});case hc:case ah:return kt(function(Ne){G.commandType(Ne,"object",ot,we.commandStr);var pt=Ne.fail||"keep",We=Ne.zfail||"keep",jt=Ne.zpass||"keep";return G.commandParameter(pt,Zf,bt+".fail",we.commandStr),G.commandParameter(We,Zf,bt+".zfail",we.commandStr),G.commandParameter(jt,Zf,bt+".zpass",we.commandStr),[bt===ah?lf:Nc,Zf[pt],Zf[We],Zf[jt]]},function(Ne,pt,We){var jt=Ne.constants.stencilOps;G.optional(function(){Ne.assert(pt,We+"&&typeof "+We+'==="object"',"invalid "+bt)});function Kt(Vr){return G.optional(function(){Ne.assert(pt,'!("'+Vr+'" in '+We+")||("+We+"."+Vr+" in "+jt+")","invalid "+bt+"."+Vr+", must be one of "+Object.keys(Zf))}),pt.def('"',Vr,'" in ',We,"?",jt,"[",We,".",Vr,"]:",Us)}return[bt===ah?lf:Nc,Kt("fail"),Kt("zfail"),Kt("zpass")]});case fs:return kt(function(Ne){G.commandType(Ne,"object",ot,we.commandStr);var pt=Ne.factor|0,We=Ne.units|0;return G.commandType(pt,"number",ot+".factor",we.commandStr),G.commandType(We,"number",ot+".units",we.commandStr),[pt,We]},function(Ne,pt,We){G.optional(function(){Ne.assert(pt,We+"&&typeof "+We+'==="object"',"invalid "+bt)});var jt=pt.def(We,".factor|0"),Kt=pt.def(We,".units|0");return[jt,Kt]});case Rf:return kt(function(Ne){var pt=0;return Ne==="front"?pt=Nc:Ne==="back"&&(pt=lf),G.command(!!pt,ot,we.commandStr),pt},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,We+'==="front"||'+We+'==="back"',"invalid cull.face")}),pt.def(We,'==="front"?',Nc,":",lf)});case fc:return kt(function(Ne){return G.command(typeof Ne=="number"&&Ne>=dr.lineWidthDims[0]&&Ne<=dr.lineWidthDims[1],"invalid line width, must be a positive number between "+dr.lineWidthDims[0]+" and "+dr.lineWidthDims[1],we.commandStr),Ne},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,"typeof "+We+'==="number"&&'+We+">="+dr.lineWidthDims[0]+"&&"+We+"<="+dr.lineWidthDims[1],"invalid line width")}),We});case fl:return kt(function(Ne){return G.commandParameter(Ne,Kp,ot,we.commandStr),Kp[Ne]},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,We+'==="cw"||'+We+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),pt.def(We+'==="cw"?'+Ad+":"+zf)});case Wl:return kt(function(Ne){return G.command(Ho(Ne)&&Ne.length===4,"color.mask must be length 4 array",we.commandStr),Ne.map(function(pt){return!!pt})},function(Ne,pt,We){return G.optional(function(){Ne.assert(pt,Ne.shared.isArrayLike+"("+We+")&&"+We+".length===4","invalid color.mask")}),ct(4,function(jt){return"!!"+We+"["+jt+"]"})});case Bs:return kt(function(Ne){G.command(typeof Ne=="object"&&Ne,ot,we.commandStr);var pt="value"in Ne?Ne.value:1,We=!!Ne.invert;return G.command(typeof pt=="number"&&pt>=0&&pt<=1,"sample.coverage.value must be a number between 0 and 1",we.commandStr),[pt,We]},function(Ne,pt,We){G.optional(function(){Ne.assert(pt,We+"&&typeof "+We+'==="object"',"invalid sample.coverage")});var jt=pt.def('"value" in ',We,"?+",We,".value:1"),Kt=pt.def("!!",We,".invert");return[jt,Kt]})}}),ur}function Sa(Ge,we){var vt=Ge.static,Wt=Ge.dynamic,ur={};return Object.keys(vt).forEach(function(bt){var ot=vt[bt],kt;if(typeof ot=="number"||typeof ot=="boolean")kt=Ja(function(){return ot});else if(typeof ot=="function"){var Ne=ot._reglType;Ne==="texture2d"||Ne==="textureCube"?kt=Ja(function(pt){return pt.link(ot)}):Ne==="framebuffer"||Ne==="framebufferCube"?(G.command(ot.color.length>0,'missing color attachment for framebuffer sent to uniform "'+bt+'"',we.commandStr),kt=Ja(function(pt){return pt.link(ot.color[0])})):G.commandRaise('invalid data for uniform "'+bt+'"',we.commandStr)}else Ho(ot)?kt=Ja(function(pt){var We=pt.global.def("[",ct(ot.length,function(jt){return G.command(typeof ot[jt]=="number"||typeof ot[jt]=="boolean","invalid uniform "+bt,pt.commandStr),ot[jt]}),"]");return We}):G.commandRaise('invalid or missing data for uniform "'+bt+'"',we.commandStr);kt.value=ot,ur[bt]=kt}),Object.keys(Wt).forEach(function(bt){var ot=Wt[bt];ur[bt]=Zs(ot,function(kt,Ne){return kt.invoke(Ne,ot)})}),ur}function Ys(Ge,we){var vt=Ge.static,Wt=Ge.dynamic,ur={};return Object.keys(vt).forEach(function(bt){var ot=vt[bt],kt=De.id(bt),Ne=new Zt;if(qu(ot))Ne.state=Oi,Ne.buffer=zr.getBuffer(zr.create(ot,zs,!1,!0)),Ne.type=0;else{var pt=zr.getBuffer(ot);if(pt)Ne.state=Oi,Ne.buffer=pt,Ne.type=0;else if(G.command(typeof ot=="object"&&ot,"invalid data for attribute "+bt,we.commandStr),"constant"in ot){var We=ot.constant;Ne.buffer="null",Ne.state=oa,typeof We=="number"?Ne.x=We:(G.command(Ho(We)&&We.length>0&&We.length<=4,"invalid constant for attribute "+bt,we.commandStr),Qi.forEach(function(xn,$n){$n<We.length&&(Ne[xn]=We[$n])}))}else{qu(ot.buffer)?pt=zr.getBuffer(zr.create(ot.buffer,zs,!1,!0)):pt=zr.getBuffer(ot.buffer),G.command(!!pt,'missing buffer for attribute "'+bt+'"',we.commandStr);var jt=ot.offset|0;G.command(jt>=0,'invalid offset for attribute "'+bt+'"',we.commandStr);var Kt=ot.stride|0;G.command(Kt>=0&&Kt<256,'invalid stride for attribute "'+bt+'", must be integer betweeen [0, 255]',we.commandStr);var Vr=ot.size|0;G.command(!("size"in ot)||Vr>0&&Vr<=4,'invalid size for attribute "'+bt+'", must be 1,2,3,4',we.commandStr);var An=!!ot.normalized,un=0;"type"in ot&&(G.commandParameter(ot.type,xu,"invalid type for attribute "+bt,we.commandStr),un=xu[ot.type]);var Gn=ot.divisor|0;G.optional(function(){"divisor"in ot&&(G.command(Gn===0||rn,'cannot specify divisor for attribute "'+bt+'", instancing not supported',we.commandStr),G.command(Gn>=0,'invalid divisor for attribute "'+bt+'"',we.commandStr));var xn=we.commandStr,$n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ot).forEach(function(Wn){G.command($n.indexOf(Wn)>=0,'unknown parameter "'+Wn+'" for attribute pointer "'+bt+'" (valid parameters are '+$n+")",xn)})}),Ne.buffer=pt,Ne.state=Oi,Ne.size=Vr,Ne.normalized=An,Ne.type=un||pt.dtype,Ne.offset=jt,Ne.stride=Kt,Ne.divisor=Gn}}ur[bt]=Ja(function(xn,$n){var Wn=xn.attribCache;if(kt in Wn)return Wn[kt];var Kn={isStream:!1};return Object.keys(Ne).forEach(function(ui){Kn[ui]=Ne[ui]}),Ne.buffer&&(Kn.buffer=xn.link(Ne.buffer),Kn.type=Kn.type||Kn.buffer+".dtype"),Wn[kt]=Kn,Kn})}),Object.keys(Wt).forEach(function(bt){var ot=Wt[bt];function kt(Ne,pt){var We=Ne.invoke(pt,ot),jt=Ne.shared,Kt=Ne.constants,Vr=jt.isBufferArgs,An=jt.buffer;G.optional(function(){Ne.assert(pt,We+"&&(typeof "+We+'==="object"||typeof '+We+'==="function")&&('+Vr+"("+We+")||"+An+".getBuffer("+We+")||"+An+".getBuffer("+We+".buffer)||"+Vr+"("+We+'.buffer)||("constant" in '+We+"&&(typeof "+We+'.constant==="number"||'+jt.isArrayLike+"("+We+".constant))))",'invalid dynamic attribute "'+bt+'"')});var un={isStream:pt.def(!1)},Gn=new Zt;Gn.state=Oi,Object.keys(Gn).forEach(function(Kn){un[Kn]=pt.def(""+Gn[Kn])});var xn=un.buffer,$n=un.type;pt("if(",Vr,"(",We,")){",un.isStream,"=true;",xn,"=",An,".createStream(",zs,",",We,");",$n,"=",xn,".dtype;","}else{",xn,"=",An,".getBuffer(",We,");","if(",xn,"){",$n,"=",xn,".dtype;",'}else if("constant" in ',We,"){",un.state,"=",oa,";","if(typeof "+We+'.constant === "number"){',un[Qi[0]],"=",We,".constant;",Qi.slice(1).map(function(Kn){return un[Kn]}).join("="),"=0;","}else{",Qi.map(function(Kn,ui){return un[Kn]+"="+We+".constant.length>"+ui+"?"+We+".constant["+ui+"]:0;"}).join(""),"}}else{","if(",Vr,"(",We,".buffer)){",xn,"=",An,".createStream(",zs,",",We,".buffer);","}else{",xn,"=",An,".getBuffer(",We,".buffer);","}",$n,'="type" in ',We,"?",Kt.glTypes,"[",We,".type]:",xn,".dtype;",un.normalized,"=!!",We,".normalized;");function Wn(Kn){pt(un[Kn],"=",We,".",Kn,"|0;")}return Wn("size"),Wn("offset"),Wn("stride"),Wn("divisor"),pt("}}"),pt.exit("if(",un.isStream,"){",An,".destroyStream(",xn,");","}"),un}ur[bt]=Zs(ot,kt)}),ur}function wo(Ge){var we=Ge.static,vt=Ge.dynamic,Wt={};return Object.keys(we).forEach(function(ur){var bt=we[ur];Wt[ur]=Ja(function(ot,kt){return typeof bt=="number"||typeof bt=="boolean"?""+bt:ot.link(bt)})}),Object.keys(vt).forEach(function(ur){var bt=vt[ur];Wt[ur]=Zs(bt,function(ot,kt){return ot.invoke(kt,bt)})}),Wt}function Vs(Ge,we,vt,Wt,ur){var bt=Ge.static,ot=Ge.dynamic;G.optional(function(){var Wn=[Su,Ff,oh,Yl,Ns,Il,Bf,Oh,Fc,tu].concat(Ti);function Kn(ui){Object.keys(ui).forEach(function(Qn){G.command(Wn.indexOf(Qn)>=0,'unknown parameter "'+Qn+'"',ur.commandStr)})}Kn(bt),Kn(ot)});var kt=ta(Ge,we),Ne=Bn(Ge,ur),pt=Li(Ge,Ne,ur),We=qo(Ge,ur),jt=$o(Ge,ur),Kt=Ma(Ge,ur,kt);function Vr(Wn){var Kn=pt[Wn];Kn&&(jt[Wn]=Kn)}Vr(Yu),Vr(oi(Ep));var An=Object.keys(jt).length>0,un={framebuffer:Ne,draw:We,shader:Kt,state:jt,dirty:An,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(un.profile=Dn(Ge,ur),un.uniforms=Sa(vt,ur),un.drawVAO=un.scopeVAO=We.vao,!un.drawVAO&&Kt.program&&!kt&&ut.angle_instanced_arrays&&We.static.elements){var Gn=!0,xn=Kt.program.attributes.map(function(Wn){var Kn=we.static[Wn];return Gn=Gn&&!!Kn,Kn});if(Gn&&xn.length>0){var $n=nn.getVAO(nn.createVAO({attributes:xn,elements:We.static.elements}));un.drawVAO=new so(null,null,null,function(Wn,Kn){return Wn.link($n)}),un.useVAO=!0}}return kt?un.useVAO=!0:un.attributes=Ys(we,ur),un.context=wo(Wt,ur),un}function gs(Ge,we,vt){var Wt=Ge.shared,ur=Wt.context,bt=Ge.scope();Object.keys(vt).forEach(function(ot){we.save(ur,"."+ot);var kt=vt[ot],Ne=kt.append(Ge,we);Array.isArray(Ne)?bt(ur,".",ot,"=[",Ne.join(),"];"):bt(ur,".",ot,"=",Ne,";")}),we(bt)}function As(Ge,we,vt,Wt){var ur=Ge.shared,bt=ur.gl,ot=ur.framebuffer,kt;On&&(kt=we.def(ur.extensions,".webgl_draw_buffers"));var Ne=Ge.constants,pt=Ne.drawBuffer,We=Ne.backBuffer,jt;vt?jt=vt.append(Ge,we):jt=we.def(ot,".next"),Wt||we("if(",jt,"!==",ot,".cur){"),we("if(",jt,"){",bt,".bindFramebuffer(",Tp,",",jt,".framebuffer);"),On&&we(kt,".drawBuffersWEBGL(",pt,"[",jt,".colorAttachments.length]);"),we("}else{",bt,".bindFramebuffer(",Tp,",null);"),On&&we(kt,".drawBuffersWEBGL(",We,");"),we("}",ot,".cur=",jt,";"),Wt||we("}")}function js(Ge,we,vt){var Wt=Ge.shared,ur=Wt.gl,bt=Ge.current,ot=Ge.next,kt=Wt.current,Ne=Wt.next,pt=Ge.cond(kt,".dirty");Ti.forEach(function(We){var jt=oi(We);if(!(jt in vt.state)){var Kt,Vr;if(jt in ot){Kt=ot[jt],Vr=bt[jt];var An=ct(_n[jt].length,function(Gn){return pt.def(Kt,"[",Gn,"]")});pt(Ge.cond(An.map(function(Gn,xn){return Gn+"!=="+Vr+"["+xn+"]"}).join("||")).then(ur,".",Fr[jt],"(",An,");",An.map(function(Gn,xn){return Vr+"["+xn+"]="+Gn}).join(";"),";"))}else{Kt=pt.def(Ne,".",jt);var un=Ge.cond(Kt,"!==",kt,".",jt);pt(un),jt in kr?un(Ge.cond(Kt).then(ur,".enable(",kr[jt],");").else(ur,".disable(",kr[jt],");"),kt,".",jt,"=",Kt,";"):un(ur,".",Fr[jt],"(",Kt,");",kt,".",jt,"=",Kt,";")}}}),Object.keys(vt.state).length===0&&pt(kt,".dirty=false;"),we(pt)}function vu(Ge,we,vt,Wt){var ur=Ge.shared,bt=Ge.current,ot=ur.current,kt=ur.gl;Mp(Object.keys(vt)).forEach(function(Ne){var pt=vt[Ne];if(!(Wt&&!Wt(pt))){var We=pt.append(Ge,we);if(kr[Ne]){var jt=kr[Ne];Zc(pt)?We?we(kt,".enable(",jt,");"):we(kt,".disable(",jt,");"):we(Ge.cond(We).then(kt,".enable(",jt,");").else(kt,".disable(",jt,");")),we(ot,".",Ne,"=",We,";")}else if(Ho(We)){var Kt=bt[Ne];we(kt,".",Fr[Ne],"(",We,");",We.map(function(Vr,An){return Kt+"["+An+"]="+Vr}).join(";"),";")}else we(kt,".",Fr[Ne],"(",We,");",ot,".",Ne,"=",We,";")}})}function zo(Ge,we){rn&&(Ge.instancing=we.def(Ge.shared.extensions,".angle_instanced_arrays"))}function sa(Ge,we,vt,Wt,ur){var bt=Ge.shared,ot=Ge.stats,kt=bt.current,Ne=bt.timer,pt=vt.profile;function We(){var Wn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Wn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var jt,Kt;function Vr(Wn){jt=we.def(),Wn(jt,"=",We(),";"),typeof ur=="string"?Wn(ot,".count+=",ur,";"):Wn(ot,".count++;"),an&&(Wt?(Kt=we.def(),Wn(Kt,"=",Ne,".getNumPendingQueries();")):Wn(Ne,".beginQuery(",ot,");"))}function An(Wn){Wn(ot,".cpuTime+=",We(),"-",jt,";"),an&&(Wt?Wn(Ne,".pushScopeStats(",Kt,",",Ne,".getNumPendingQueries(),",ot,");"):Wn(Ne,".endQuery();"))}function un(Wn){var Kn=we.def(kt,".profile");we(kt,".profile=",Wn,";"),we.exit(kt,".profile=",Kn,";")}var Gn;if(pt){if(Zc(pt)){pt.enable?(Vr(we),An(we.exit),un("true")):un("false");return}Gn=pt.append(Ge,we),un(Gn)}else Gn=we.def(kt,".profile");var xn=Ge.block();Vr(xn),we("if(",Gn,"){",xn,"}");var $n=Ge.block();An($n),we.exit("if(",Gn,"){",$n,"}")}function ws(Ge,we,vt,Wt,ur){var bt=Ge.shared;function ot(Ne){switch(Ne){case Sp:case $p:case Qh:return 2;case Pl:case fh:case vc:return 3;case af:case dc:case sf:return 4;default:return 1}}function kt(Ne,pt,We){var jt=bt.gl,Kt=we.def(Ne,".location"),Vr=we.def(bt.attributes,"[",Kt,"]"),An=We.state,un=We.buffer,Gn=[We.x,We.y,We.z,We.w],xn=["buffer","normalized","offset","stride"];function $n(){we("if(!",Vr,".buffer){",jt,".enableVertexAttribArray(",Kt,");}");var Kn=We.type,ui;if(We.size?ui=we.def(We.size,"||",pt):ui=pt,we("if(",Vr,".type!==",Kn,"||",Vr,".size!==",ui,"||",xn.map(function(Ni){return Vr+"."+Ni+"!=="+We[Ni]}).join("||"),"){",jt,".bindBuffer(",zs,",",un,".buffer);",jt,".vertexAttribPointer(",[Kt,ui,Kn,We.normalized,We.stride,We.offset],");",Vr,".type=",Kn,";",Vr,".size=",ui,";",xn.map(function(Ni){return Vr+"."+Ni+"="+We[Ni]+";"}).join(""),"}"),rn){var Qn=We.divisor;we("if(",Vr,".divisor!==",Qn,"){",Ge.instancing,".vertexAttribDivisorANGLE(",[Kt,Qn],");",Vr,".divisor=",Qn,";}")}}function Wn(){we("if(",Vr,".buffer){",jt,".disableVertexAttribArray(",Kt,");",Vr,".buffer=null;","}if(",Qi.map(function(Kn,ui){return Vr+"."+Kn+"!=="+Gn[ui]}).join("||"),"){",jt,".vertexAttrib4f(",Kt,",",Gn,");",Qi.map(function(Kn,ui){return Vr+"."+Kn+"="+Gn[ui]+";"}).join(""),"}")}An===Oi?$n():An===oa?Wn():(we("if(",An,"===",Oi,"){"),$n(),we("}else{"),Wn(),we("}"))}Wt.forEach(function(Ne){var pt=Ne.name,We=vt.attributes[pt],jt;if(We){if(!ur(We))return;jt=We.append(Ge,we)}else{if(!ur(Qp))return;var Kt=Ge.scopeAttrib(pt);G.optional(function(){Ge.assert(we,Kt+".state","missing attribute "+pt)}),jt={},Object.keys(new Zt).forEach(function(Vr){jt[Vr]=we.def(Kt,".",Vr)})}kt(Ge.link(Ne),ot(Ne.info.type),jt)})}function Za(Ge,we,vt,Wt,ur,bt){for(var ot=Ge.shared,kt=ot.gl,Ne,pt=0;pt<Wt.length;++pt){var We=Wt[pt],jt=We.name,Kt=We.info.type,Vr=vt.uniforms[jt],An=Ge.link(We),un=An+".location",Gn;if(Vr){if(!ur(Vr))continue;if(Zc(Vr)){var xn=Vr.value;if(G.command(xn!==null&&typeof xn!="undefined",'missing uniform "'+jt+'"',Ge.commandStr),Kt===Bu||Kt===ph){G.command(typeof xn=="function"&&(Kt===Bu&&(xn._reglType==="texture2d"||xn._reglType==="framebuffer")||Kt===ph&&(xn._reglType==="textureCube"||xn._reglType==="framebufferCube")),"invalid texture for uniform "+jt,Ge.commandStr);var $n=Ge.link(xn._texture||xn.color[0]._texture);we(kt,".uniform1i(",un,",",$n+".bind());"),we.exit($n,".unbind();")}else if(Kt===kl||Kt===hh||Kt===uf){G.optional(function(){G.command(Ho(xn),"invalid matrix for uniform "+jt,Ge.commandStr),G.command(Kt===kl&&xn.length===4||Kt===hh&&xn.length===9||Kt===uf&&xn.length===16,"invalid length for matrix uniform "+jt,Ge.commandStr)});var Wn=Ge.global.def("new Float32Array(["+Array.prototype.slice.call(xn)+"])"),Kn=2;Kt===hh?Kn=3:Kt===uf&&(Kn=4),we(kt,".uniformMatrix",Kn,"fv(",un,",false,",Wn,");")}else{switch(Kt){case Bc:G.commandType(xn,"number","uniform "+jt,Ge.commandStr),Ne="1f";break;case Sp:G.command(Ho(xn)&&xn.length===2,"uniform "+jt,Ge.commandStr),Ne="2f";break;case Pl:G.command(Ho(xn)&&xn.length===3,"uniform "+jt,Ge.commandStr),Ne="3f";break;case af:G.command(Ho(xn)&&xn.length===4,"uniform "+jt,Ge.commandStr),Ne="4f";break;case Ap:G.commandType(xn,"boolean","uniform "+jt,Ge.commandStr),Ne="1i";break;case of:G.commandType(xn,"number","uniform "+jt,Ge.commandStr),Ne="1i";break;case Qh:G.command(Ho(xn)&&xn.length===2,"uniform "+jt,Ge.commandStr),Ne="2i";break;case $p:G.command(Ho(xn)&&xn.length===2,"uniform "+jt,Ge.commandStr),Ne="2i";break;case vc:G.command(Ho(xn)&&xn.length===3,"uniform "+jt,Ge.commandStr),Ne="3i";break;case fh:G.command(Ho(xn)&&xn.length===3,"uniform "+jt,Ge.commandStr),Ne="3i";break;case sf:G.command(Ho(xn)&&xn.length===4,"uniform "+jt,Ge.commandStr),Ne="4i";break;case dc:G.command(Ho(xn)&&xn.length===4,"uniform "+jt,Ge.commandStr),Ne="4i";break}we(kt,".uniform",Ne,"(",un,",",Ho(xn)?Array.prototype.slice.call(xn):xn,");")}continue}else Gn=Vr.append(Ge,we)}else{if(!ur(Qp))continue;Gn=we.def(ot.uniforms,"[",De.id(jt),"]")}Kt===Bu?(G(!Array.isArray(Gn),"must specify a scalar prop for textures"),we("if(",Gn,"&&",Gn,'._reglType==="framebuffer"){',Gn,"=",Gn,".color[0];","}")):Kt===ph&&(G(!Array.isArray(Gn),"must specify a scalar prop for cube maps"),we("if(",Gn,"&&",Gn,'._reglType==="framebufferCube"){',Gn,"=",Gn,".color[0];","}")),G.optional(function(){function Nu(pl,Gc){Ge.assert(we,pl,'bad data or missing for uniform "'+jt+'".  '+Gc)}function yc(pl){G(!Array.isArray(Gn),"must not specify an array type for uniform"),Nu("typeof "+Gn+'==="'+pl+'"',"invalid type, expected "+pl)}function $l(pl,Gc){Array.isArray(Gn)?G(Gn.length===pl,"must have length "+pl):Nu(ot.isArrayLike+"("+Gn+")&&"+Gn+".length==="+pl,"invalid vector, should have length "+pl,Ge.commandStr)}function _c(pl){G(!Array.isArray(Gn),"must not specify a value type"),Nu("typeof "+Gn+'==="function"&&'+Gn+'._reglType==="texture'+(pl===Sd?"2d":"Cube")+'"',"invalid texture type",Ge.commandStr)}switch(Kt){case of:yc("number");break;case $p:$l(2,"number");break;case fh:$l(3,"number");break;case dc:$l(4,"number");break;case Bc:yc("number");break;case Sp:$l(2,"number");break;case Pl:$l(3,"number");break;case af:$l(4,"number");break;case Ap:yc("boolean");break;case Qh:$l(2,"boolean");break;case vc:$l(3,"boolean");break;case sf:$l(4,"boolean");break;case kl:$l(4,"number");break;case hh:$l(9,"number");break;case uf:$l(16,"number");break;case Bu:_c(Sd);break;case ph:_c(Rh);break}});var ui=1;switch(Kt){case Bu:case ph:var Qn=we.def(Gn,"._texture");we(kt,".uniform1i(",un,",",Qn,".bind());"),we.exit(Qn,".unbind();");continue;case of:case Ap:Ne="1i";break;case $p:case Qh:Ne="2i",ui=2;break;case fh:case vc:Ne="3i",ui=3;break;case dc:case sf:Ne="4i",ui=4;break;case Bc:Ne="1f";break;case Sp:Ne="2f",ui=2;break;case Pl:Ne="3f",ui=3;break;case af:Ne="4f",ui=4;break;case kl:Ne="Matrix2fv";break;case hh:Ne="Matrix3fv";break;case uf:Ne="Matrix4fv";break}if(Ne.charAt(0)==="M"){we(kt,".uniform",Ne,"(",un,",");var Ni=Math.pow(Kt-kl+2,2),Ua=Ge.global.def("new Float32Array(",Ni,")");Array.isArray(Gn)?we("false,(",ct(Ni,function(Nu){return Ua+"["+Nu+"]="+Gn[Nu]}),",",Ua,")"):we("false,(Array.isArray(",Gn,")||",Gn," instanceof Float32Array)?",Gn,":(",ct(Ni,function(Nu){return Ua+"["+Nu+"]="+Gn+"["+Nu+"]"}),",",Ua,")"),we(");")}else if(ui>1){for(var qs=[],Po=[],$a=0;$a<ui;++$a)Array.isArray(Gn)?Po.push(Gn[$a]):Po.push(we.def(Gn+"["+$a+"]")),bt&&qs.push(we.def());bt&&we("if(!",Ge.batchId,"||",qs.map(function(Nu,yc){return Nu+"!=="+Po[yc]}).join("||"),"){",qs.map(function(Nu,yc){return Nu+"="+Po[yc]+";"}).join("")),we(kt,".uniform",Ne,"(",un,",",Po.join(","),");"),bt&&we("}")}else{if(G(!Array.isArray(Gn),"uniform value must not be an array"),bt){var jc=we.def();we("if(!",Ge.batchId,"||",jc,"!==",Gn,"){",jc,"=",Gn,";")}we(kt,".uniform",Ne,"(",un,",",Gn,");"),bt&&we("}")}}}function ru(Ge,we,vt,Wt){var ur=Ge.shared,bt=ur.gl,ot=ur.draw,kt=Wt.draw;function Ne(){var ui=kt.elements,Qn,Ni=we;return ui?((ui.contextDep&&Wt.contextDynamic||ui.propDep)&&(Ni=vt),Qn=ui.append(Ge,Ni),kt.elementsActive&&Ni("if("+Qn+")"+bt+".bindBuffer("+Au+","+Qn+".buffer.buffer);")):(Qn=Ni.def(),Ni(Qn,"=",ot,".",Yl,";","if(",Qn,"){",bt,".bindBuffer(",Au,",",Qn,".buffer.buffer);}","else if(",ur.vao,".currentVAO){",Qn,"=",Ge.shared.elements+".getElements("+ur.vao,".currentVAO.elements);",Ur?"":"if("+Qn+")"+bt+".bindBuffer("+Au+","+Qn+".buffer.buffer);","}")),Qn}function pt(){var ui=kt.count,Qn,Ni=we;return ui?((ui.contextDep&&Wt.contextDynamic||ui.propDep)&&(Ni=vt),Qn=ui.append(Ge,Ni),G.optional(function(){ui.MISSING&&Ge.assert(we,"false","missing vertex count"),ui.DYNAMIC&&Ge.assert(Ni,Qn+">=0","missing vertex count")})):(Qn=Ni.def(ot,".",Bf),G.optional(function(){Ge.assert(Ni,Qn+">=0","missing vertex count")})),Qn}var We=Ne();function jt(ui){var Qn=kt[ui];return Qn?Qn.contextDep&&Wt.contextDynamic||Qn.propDep?Qn.append(Ge,vt):Qn.append(Ge,we):we.def(ot,".",ui)}var Kt=jt(Ns),Vr=jt(Il),An=pt();if(typeof An=="number"){if(An===0)return}else vt("if(",An,"){"),vt.exit("}");var un,Gn;rn&&(un=jt(Oh),Gn=Ge.instancing);var xn=We+".type",$n=kt.elements&&Zc(kt.elements)&&!kt.vaoActive;function Wn(){function ui(){vt(Gn,".drawElementsInstancedANGLE(",[Kt,An,xn,Vr+"<<(("+xn+"-"+Wi+")>>1)",un],");")}function Qn(){vt(Gn,".drawArraysInstancedANGLE(",[Kt,Vr,An,un],");")}We&&We!=="null"?$n?ui():(vt("if(",We,"){"),ui(),vt("}else{"),Qn(),vt("}")):Qn()}function Kn(){function ui(){vt(bt+".drawElements("+[Kt,An,xn,Vr+"<<(("+xn+"-"+Wi+")>>1)"]+");")}function Qn(){vt(bt+".drawArrays("+[Kt,Vr,An]+");")}We&&We!=="null"?$n?ui():(vt("if(",We,"){"),ui(),vt("}else{"),Qn(),vt("}")):Qn()}rn&&(typeof un!="number"||un>=0)?typeof un=="string"?(vt("if(",un,">0){"),Wn(),vt("}else if(",un,"<0){"),Kn(),vt("}")):Wn():Kn()}function Yi(Ge,we,vt,Wt,ur){var bt=Gi(),ot=bt.proc("body",ur);return G.optional(function(){bt.commandStr=we.commandStr,bt.command=bt.link(we.commandStr)}),rn&&(bt.instancing=ot.def(bt.shared.extensions,".angle_instanced_arrays")),Ge(bt,ot,vt,Wt),bt.compile().body}function Ia(Ge,we,vt,Wt){zo(Ge,we),vt.useVAO?vt.drawVAO?we(Ge.shared.vao,".setVAO(",vt.drawVAO.append(Ge,we),");"):we(Ge.shared.vao,".setVAO(",Ge.shared.vao,".targetVAO);"):(we(Ge.shared.vao,".setVAO(null);"),ws(Ge,we,vt,Wt.attributes,function(){return!0})),Za(Ge,we,vt,Wt.uniforms,function(){return!0},!1),ru(Ge,we,we,vt)}function eo(Ge,we){var vt=Ge.proc("draw",1);zo(Ge,vt),gs(Ge,vt,we.context),As(Ge,vt,we.framebuffer),js(Ge,vt,we),vu(Ge,vt,we.state),sa(Ge,vt,we,!1,!0);var Wt=we.shader.progVar.append(Ge,vt);if(vt(Ge.shared.gl,".useProgram(",Wt,".program);"),we.shader.program)Ia(Ge,vt,we,we.shader.program);else{vt(Ge.shared.vao,".setVAO(null);");var ur=Ge.global.def("{}"),bt=vt.def(Wt,".id"),ot=vt.def(ur,"[",bt,"]");vt(Ge.cond(ot).then(ot,".call(this,a0);").else(ot,"=",ur,"[",bt,"]=",Ge.link(function(kt){return Yi(Ia,Ge,we,kt,1)}),"(",Wt,");",ot,".call(this,a0);"))}Object.keys(we.state).length>0&&vt(Ge.shared.current,".dirty=true;"),Ge.shared.vao&&vt(Ge.shared.vao,".setVAO(null);")}function ys(Ge,we,vt,Wt){Ge.batchId="a1",zo(Ge,we);function ur(){return!0}ws(Ge,we,vt,Wt.attributes,ur),Za(Ge,we,vt,Wt.uniforms,ur,!1),ru(Ge,we,we,vt)}function cf(Ge,we,vt,Wt){zo(Ge,we);var ur=vt.contextDep,bt=we.def(),ot="a0",kt="a1",Ne=we.def();Ge.shared.props=Ne,Ge.batchId=bt;var pt=Ge.scope(),We=Ge.scope();we(pt.entry,"for(",bt,"=0;",bt,"<",kt,";++",bt,"){",Ne,"=",ot,"[",bt,"];",We,"}",pt.exit);function jt(xn){return xn.contextDep&&ur||xn.propDep}function Kt(xn){return!jt(xn)}if(vt.needsContext&&gs(Ge,We,vt.context),vt.needsFramebuffer&&As(Ge,We,vt.framebuffer),vu(Ge,We,vt.state,jt),vt.profile&&jt(vt.profile)&&sa(Ge,We,vt,!1,!0),Wt)vt.useVAO?vt.drawVAO?jt(vt.drawVAO)?We(Ge.shared.vao,".setVAO(",vt.drawVAO.append(Ge,We),");"):pt(Ge.shared.vao,".setVAO(",vt.drawVAO.append(Ge,pt),");"):pt(Ge.shared.vao,".setVAO(",Ge.shared.vao,".targetVAO);"):(pt(Ge.shared.vao,".setVAO(null);"),ws(Ge,pt,vt,Wt.attributes,Kt),ws(Ge,We,vt,Wt.attributes,jt)),Za(Ge,pt,vt,Wt.uniforms,Kt,!1),Za(Ge,We,vt,Wt.uniforms,jt,!0),ru(Ge,pt,We,vt);else{var Vr=Ge.global.def("{}"),An=vt.shader.progVar.append(Ge,We),un=We.def(An,".id"),Gn=We.def(Vr,"[",un,"]");We(Ge.shared.gl,".useProgram(",An,".program);","if(!",Gn,"){",Gn,"=",Vr,"[",un,"]=",Ge.link(function(xn){return Yi(ys,Ge,vt,xn,2)}),"(",An,");}",Gn,".call(this,a0[",bt,"],",bt,");")}}function Ke(Ge,we){var vt=Ge.proc("batch",2);Ge.batchId="0",zo(Ge,vt);var Wt=!1,ur=!0;Object.keys(we.context).forEach(function(Vr){Wt=Wt||we.context[Vr].propDep}),Wt||(gs(Ge,vt,we.context),ur=!1);var bt=we.framebuffer,ot=!1;bt?(bt.propDep?Wt=ot=!0:bt.contextDep&&Wt&&(ot=!0),ot||As(Ge,vt,bt)):As(Ge,vt,null),we.state.viewport&&we.state.viewport.propDep&&(Wt=!0);function kt(Vr){return Vr.contextDep&&Wt||Vr.propDep}js(Ge,vt,we),vu(Ge,vt,we.state,function(Vr){return!kt(Vr)}),(!we.profile||!kt(we.profile))&&sa(Ge,vt,we,!1,"a1"),we.contextDep=Wt,we.needsContext=ur,we.needsFramebuffer=ot;var Ne=we.shader.progVar;if(Ne.contextDep&&Wt||Ne.propDep)cf(Ge,vt,we,null);else{var pt=Ne.append(Ge,vt);if(vt(Ge.shared.gl,".useProgram(",pt,".program);"),we.shader.program)cf(Ge,vt,we,we.shader.program);else{vt(Ge.shared.vao,".setVAO(null);");var We=Ge.global.def("{}"),jt=vt.def(pt,".id"),Kt=vt.def(We,"[",jt,"]");vt(Ge.cond(Kt).then(Kt,".call(this,a0,a1);").else(Kt,"=",We,"[",jt,"]=",Ge.link(function(Vr){return Yi(cf,Ge,we,Vr,2)}),"(",pt,");",Kt,".call(this,a0,a1);"))}}Object.keys(we.state).length>0&&vt(Ge.shared.current,".dirty=true;"),Ge.shared.vao&&vt(Ge.shared.vao,".setVAO(null);")}function gr(Ge,we){var vt=Ge.proc("scope",3);Ge.batchId="a2";var Wt=Ge.shared,ur=Wt.current;gs(Ge,vt,we.context),we.framebuffer&&we.framebuffer.append(Ge,vt),Mp(Object.keys(we.state)).forEach(function(ot){var kt=we.state[ot],Ne=kt.append(Ge,vt);Ho(Ne)?Ne.forEach(function(pt,We){vt.set(Ge.next[ot],"["+We+"]",pt)}):vt.set(Wt.next,"."+ot,Ne)}),sa(Ge,vt,we,!0,!0),[Yl,Il,Bf,Oh,Ns].forEach(function(ot){var kt=we.draw[ot];!kt||vt.set(Wt.draw,"."+ot,""+kt.append(Ge,vt))}),Object.keys(we.uniforms).forEach(function(ot){var kt=we.uniforms[ot].append(Ge,vt);Array.isArray(kt)&&(kt="["+kt.join()+"]"),vt.set(Wt.uniforms,"["+De.id(ot)+"]",kt)}),Object.keys(we.attributes).forEach(function(ot){var kt=we.attributes[ot].append(Ge,vt),Ne=Ge.scopeAttrib(ot);Object.keys(new Zt).forEach(function(pt){vt.set(Ne,"."+pt,kt[pt])})}),we.scopeVAO&&vt.set(Wt.vao,".targetVAO",we.scopeVAO.append(Ge,vt));function bt(ot){var kt=we.shader[ot];kt&&vt.set(Wt.shader,"."+ot,kt.append(Ge,vt))}bt(Ff),bt(oh),Object.keys(we.state).length>0&&(vt(ur,".dirty=true;"),vt.exit(ur,".dirty=true;")),vt("a1(",Ge.shared.context,",a0,",Ge.batchId,");")}function $t(Ge){if(!(typeof Ge!="object"||Ho(Ge))){for(var we=Object.keys(Ge),vt=0;vt<we.length;++vt)if(Tn.isDynamic(Ge[we[vt]]))return!0;return!1}}function ei(Ge,we,vt){var Wt=we.static[vt];if(!Wt||!$t(Wt))return;var ur=Ge.global,bt=Object.keys(Wt),ot=!1,kt=!1,Ne=!1,pt=Ge.global.def("{}");bt.forEach(function(jt){var Kt=Wt[jt];if(Tn.isDynamic(Kt)){typeof Kt=="function"&&(Kt=Wt[jt]=Tn.unbox(Kt));var Vr=Zs(Kt,null);ot=ot||Vr.thisDep,Ne=Ne||Vr.propDep,kt=kt||Vr.contextDep}else{switch(ur(pt,".",jt,"="),typeof Kt){case"number":ur(Kt);break;case"string":ur('"',Kt,'"');break;case"object":Array.isArray(Kt)&&ur("[",Kt.join(),"]");break;default:ur(Ge.link(Kt));break}ur(";")}});function We(jt,Kt){bt.forEach(function(Vr){var An=Wt[Vr];if(!!Tn.isDynamic(An)){var un=jt.invoke(Kt,An);Kt(pt,".",Vr,"=",un,";")}})}we.dynamic[vt]=new Tn.DynamicVariable(Ds,{thisDep:ot,contextDep:kt,propDep:Ne,ref:pt,append:We}),delete we.static[vt]}function Pa(Ge,we,vt,Wt,ur){var bt=Gi();bt.stats=bt.link(ur),Object.keys(we.static).forEach(function(kt){ei(bt,we,kt)}),Xp.forEach(function(kt){ei(bt,Ge,kt)});var ot=Vs(Ge,we,vt,Wt,bt);return eo(bt,ot),gr(bt,ot),Ke(bt,ot),y(bt.compile(),{destroy:function(){ot.shader.program.destroy()}})}return{next:Nn,current:_n,procs:function(){var Ge=Gi(),we=Ge.proc("poll"),vt=Ge.proc("refresh"),Wt=Ge.block();we(Wt),vt(Wt);var ur=Ge.shared,bt=ur.gl,ot=ur.next,kt=ur.current;Wt(kt,".dirty=false;"),As(Ge,we),As(Ge,vt,null,!0);var Ne;rn&&(Ne=Ge.link(rn)),ut.oes_vertex_array_object&&vt(Ge.link(ut.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var pt=0;pt<dr.maxAttributes;++pt){var We=vt.def(ur.attributes,"[",pt,"]"),jt=Ge.cond(We,".buffer");jt.then(bt,".enableVertexAttribArray(",pt,");",bt,".bindBuffer(",zs,",",We,".buffer.buffer);",bt,".vertexAttribPointer(",pt,",",We,".size,",We,".type,",We,".normalized,",We,".stride,",We,".offset);").else(bt,".disableVertexAttribArray(",pt,");",bt,".vertexAttrib4f(",pt,",",We,".x,",We,".y,",We,".z,",We,".w);",We,".buffer=null;"),vt(jt),rn&&vt(Ne,".vertexAttribDivisorANGLE(",pt,",",We,".divisor);")}return vt(Ge.shared.vao,".currentVAO=null;",Ge.shared.vao,".setVAO(",Ge.shared.vao,".targetVAO);"),Object.keys(kr).forEach(function(Kt){var Vr=kr[Kt],An=Wt.def(ot,".",Kt),un=Ge.block();un("if(",An,"){",bt,".enable(",Vr,")}else{",bt,".disable(",Vr,")}",kt,".",Kt,"=",An,";"),vt(un),we("if(",An,"!==",kt,".",Kt,"){",un,"}")}),Object.keys(Fr).forEach(function(Kt){var Vr=Fr[Kt],An=_n[Kt],un,Gn,xn=Ge.block();if(xn(bt,".",Vr,"("),Ho(An)){var $n=An.length;un=Ge.global.def(ot,".",Kt),Gn=Ge.global.def(kt,".",Kt),xn(ct($n,function(Wn){return un+"["+Wn+"]"}),");",ct($n,function(Wn){return Gn+"["+Wn+"]="+un+"["+Wn+"];"}).join("")),we("if(",ct($n,function(Wn){return un+"["+Wn+"]!=="+Gn+"["+Wn+"]"}).join("||"),"){",xn,"}")}else un=Wt.def(ot,".",Kt),Gn=Wt.def(kt,".",Kt),xn(un,");",kt,".",Kt,"=",un,";"),we("if(",un,"!==",Gn,"){",xn,"}");vt(xn)}),Ge.compile()}(),compile:Pa}}function ev(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var tv=34918,Ip=34919,Md=35007,Pp=function(W,De){if(!De.ext_disjoint_timer_query)return null;var ut=[];function dr(){return ut.pop()||De.ext_disjoint_timer_query.createQueryEXT()}function zr(rn){ut.push(rn)}var pr=[];function Lr(rn){var On=dr();De.ext_disjoint_timer_query.beginQueryEXT(Md,On),pr.push(On),an(pr.length-1,pr.length,rn)}function Gr(){De.ext_disjoint_timer_query.endQueryEXT(Md)}function qr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var nn=[];function dn(){return nn.pop()||new qr}function vn(rn){nn.push(rn)}var kn=[];function an(rn,On,Ur){var _n=dn();_n.startQueryIndex=rn,_n.endQueryIndex=On,_n.sum=0,_n.stats=Ur,kn.push(_n)}var hn=[],Zt=[];function Cr(){var rn,On,Ur=pr.length;if(Ur!==0){Zt.length=Math.max(Zt.length,Ur+1),hn.length=Math.max(hn.length,Ur+1),hn[0]=0,Zt[0]=0;var _n=0;for(rn=0,On=0;On<pr.length;++On){var Nn=pr[On];De.ext_disjoint_timer_query.getQueryObjectEXT(Nn,Ip)?(_n+=De.ext_disjoint_timer_query.getQueryObjectEXT(Nn,tv),zr(Nn)):pr[rn++]=Nn,hn[On+1]=_n,Zt[On+1]=rn}for(pr.length=rn,rn=0,On=0;On<kn.length;++On){var Ti=kn[On],kr=Ti.startQueryIndex,Fr=Ti.endQueryIndex;Ti.sum+=hn[Fr]-hn[kr];var oi=Zt[kr],Rn=Zt[Fr];Rn===oi?(Ti.stats.gpuTime+=Ti.sum/1e6,vn(Ti)):(Ti.startQueryIndex=oi,Ti.endQueryIndex=Rn,kn[rn++]=Ti)}kn.length=rn}}return{beginQuery:Lr,endQuery:Gr,pushScopeStats:an,update:Cr,getNumPendingQueries:function(){return pr.length},clear:function(){ut.push.apply(ut,pr);for(var rn=0;rn<ut.length;rn++)De.ext_disjoint_timer_query.deleteQueryEXT(ut[rn]);pr.length=0,ut.length=0},restore:function(){pr.length=0,ut.length=0}}},Ov=16384,Jh=256,Id=1024,Rv=34962,mh="webglcontextlost",Eo="webglcontextrestored",ed=1,Vc=2,ep=3;function Pd(W,De){for(var ut=0;ut<W.length;++ut)if(W[ut]===De)return ut;return-1}function td(W){var De=Oe(W);if(!De)return null;var ut=De.gl,dr=ut.getContextAttributes(),zr=ut.isContextLost(),pr=qe(ut,De);if(!pr)return null;var Lr=ia(),Gr=ev(),qr=pr.extensions,nn=Pp(ut,qr),dn=ka(),vn=ut.drawingBufferWidth,kn=ut.drawingBufferHeight,an={tick:0,time:0,viewportWidth:vn,viewportHeight:kn,framebufferWidth:vn,framebufferHeight:kn,drawingBufferWidth:vn,drawingBufferHeight:kn,pixelRatio:De.pixelRatio},hn={},Zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Cr=ju(ut,qr),rn=H(ut,Gr,De,_n),On=Tc(ut,qr,rn,Gr),Ur=qt(ut,qr,Cr,Gr,rn,On,Zt);function _n(Yi){return Ur.destroyBuffer(Yi)}var Nn=Cn(ut,Lr,Gr,De),Ti=du(ut,qr,Cr,function(){oi.procs.poll()},an,Gr,De),kr=nh(ut,qr,Cr,Gr,De),Fr=Je(ut,qr,Cr,Ti,kr,Gr),oi=Jp(ut,Lr,qr,Cr,rn,On,Ti,Fr,hn,Ur,Nn,Zt,an,nn,De),Rn=bi(ut,Fr,oi.procs.poll,an,dr,qr,Cr),on=oi.next,zn=ut.canvas,Pn=[],la=[],Gi=[],Dn=[De.onDestroy],Bn=null;function Li(){if(Pn.length===0){nn&&nn.update(),Bn=null;return}Bn=Ri.next(Li),zo();for(var Yi=Pn.length-1;Yi>=0;--Yi){var Ia=Pn[Yi];Ia&&Ia(an,null,0)}ut.flush(),nn&&nn.update()}function ta(){!Bn&&Pn.length>0&&(Bn=Ri.next(Li))}function Ma(){Bn&&(Ri.cancel(Li),Bn=null)}function qo(Yi){Yi.preventDefault(),zr=!0,Ma(),la.forEach(function(Ia){Ia()})}function $o(Yi){ut.getError(),zr=!1,pr.restore(),Nn.restore(),rn.restore(),Ti.restore(),kr.restore(),Fr.restore(),Ur.restore(),nn&&nn.restore(),oi.procs.refresh(),ta(),Gi.forEach(function(Ia){Ia()})}var Sa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Sa&&zn&&(zn.addEventListener(mh,qo,!1),zn.addEventListener(Eo,$o,!1));function Ys(){Pn.length=0,Ma(),!Sa&&zn&&(zn.removeEventListener(mh,qo),zn.removeEventListener(Eo,$o)),Nn.clear(),Fr.clear(),kr.clear(),Ur.clear(),Ti.clear(),On.clear(),rn.clear(),nn&&nn.clear(),Dn.forEach(function(Yi){Yi()})}function wo(Yi){G(!!Yi,"invalid args to regl({...})"),G.type(Yi,"object","invalid args to regl({...})");function Ia(bt){var ot=y({},bt);delete ot.uniforms,delete ot.attributes,delete ot.context,delete ot.vao,"stencil"in ot&&ot.stencil.op&&(ot.stencil.opBack=ot.stencil.opFront=ot.stencil.op,delete ot.stencil.op);function kt(Ne){if(Ne in ot){var pt=ot[Ne];delete ot[Ne],Object.keys(pt).forEach(function(We){ot[Ne+"."+We]=pt[We]})}}return kt("blend"),kt("depth"),kt("cull"),kt("stencil"),kt("polygonOffset"),kt("scissor"),kt("sample"),"vao"in bt&&(ot.vao=bt.vao),ot}function eo(bt,ot){var kt={},Ne={};return Object.keys(bt).forEach(function(pt){var We=bt[pt];if(Tn.isDynamic(We)){Ne[pt]=Tn.unbox(We,pt);return}else if(ot&&Array.isArray(We)){for(var jt=0;jt<We.length;++jt)if(Tn.isDynamic(We[jt])){Ne[pt]=Tn.unbox(We,pt);return}}kt[pt]=We}),{dynamic:Ne,static:kt}}var ys=eo(Yi.context||{},!0),cf=eo(Yi.uniforms||{},!0),Ke=eo(Yi.attributes||{},!1),gr=eo(Ia(Yi),!1),$t={gpuTime:0,cpuTime:0,count:0},ei=oi.compile(gr,Ke,cf,ys,$t),Pa=ei.draw,Ge=ei.batch,we=ei.scope,vt=[];function Wt(bt){for(;vt.length<bt;)vt.push(null);return vt}function ur(bt,ot){var kt;if(zr&&G.raise("context lost"),typeof bt=="function")return we.call(this,null,bt,0);if(typeof ot=="function")if(typeof bt=="number")for(kt=0;kt<bt;++kt)we.call(this,null,ot,kt);else if(Array.isArray(bt))for(kt=0;kt<bt.length;++kt)we.call(this,bt[kt],ot,kt);else return we.call(this,bt,ot,0);else if(typeof bt=="number"){if(bt>0)return Ge.call(this,Wt(bt|0),bt|0)}else if(Array.isArray(bt)){if(bt.length)return Ge.call(this,bt,bt.length)}else return Pa.call(this,bt)}return y(ur,{stats:$t,destroy:function(){ei.destroy()}})}var Vs=Fr.setFBO=wo({framebuffer:Tn.define.call(null,ed,"framebuffer")});function gs(Yi,Ia){var eo=0;oi.procs.poll();var ys=Ia.color;ys&&(ut.clearColor(+ys[0]||0,+ys[1]||0,+ys[2]||0,+ys[3]||0),eo|=Ov),"depth"in Ia&&(ut.clearDepth(+Ia.depth),eo|=Jh),"stencil"in Ia&&(ut.clearStencil(Ia.stencil|0),eo|=Id),G(!!eo,"called regl.clear with no buffer specified"),ut.clear(eo)}function As(Yi){if(G(typeof Yi=="object"&&Yi,"regl.clear() takes an object as input"),"framebuffer"in Yi)if(Yi.framebuffer&&Yi.framebuffer_reglType==="framebufferCube")for(var Ia=0;Ia<6;++Ia)Vs(y({framebuffer:Yi.framebuffer.faces[Ia]},Yi),gs);else Vs(Yi,gs);else gs(null,Yi)}function js(Yi){G.type(Yi,"function","regl.frame() callback must be a function"),Pn.push(Yi);function Ia(){var eo=Pd(Pn,Yi);G(eo>=0,"cannot cancel a frame twice");function ys(){var cf=Pd(Pn,ys);Pn[cf]=Pn[Pn.length-1],Pn.length-=1,Pn.length<=0&&Ma()}Pn[eo]=ys}return ta(),{cancel:Ia}}function vu(){var Yi=on.viewport,Ia=on.scissor_box;Yi[0]=Yi[1]=Ia[0]=Ia[1]=0,an.viewportWidth=an.framebufferWidth=an.drawingBufferWidth=Yi[2]=Ia[2]=ut.drawingBufferWidth,an.viewportHeight=an.framebufferHeight=an.drawingBufferHeight=Yi[3]=Ia[3]=ut.drawingBufferHeight}function zo(){an.tick+=1,an.time=ws(),vu(),oi.procs.poll()}function sa(){Ti.refresh(),vu(),oi.procs.refresh(),nn&&nn.update()}function ws(){return(ka()-dn)/1e3}sa();function Za(Yi,Ia){G.type(Ia,"function","listener callback must be a function");var eo;switch(Yi){case"frame":return js(Ia);case"lost":eo=la;break;case"restore":eo=Gi;break;case"destroy":eo=Dn;break;default:G.raise("invalid event, must be one of frame,lost,restore,destroy")}return eo.push(Ia),{cancel:function(){for(var ys=0;ys<eo.length;++ys)if(eo[ys]===Ia){eo[ys]=eo[eo.length-1],eo.pop();return}}}}var ru=y(wo,{clear:As,prop:Tn.define.bind(null,ed),context:Tn.define.bind(null,Vc),this:Tn.define.bind(null,ep),draw:wo({}),buffer:function(Yi){return rn.create(Yi,Rv,!1,!1)},elements:function(Yi){return On.create(Yi,!1)},texture:Ti.create2D,cube:Ti.createCube,renderbuffer:kr.create,framebuffer:Fr.create,framebufferCube:Fr.createCube,vao:Ur.createVAO,attributes:dr,frame:js,on:Za,limits:Cr,hasExtension:function(Yi){return Cr.extensions.indexOf(Yi.toLowerCase())>=0},read:Rn,destroy:Ys,_gl:ut,_refresh:sa,poll:function(){zo(),nn&&nn.update()},now:ws,stats:Gr});return De.onDone(null,ru),ru}return td})},29932:function(wn){function Ee(ue,Re){for(var ge=-1,y=ue==null?0:ue.length,Fe=Array(y);++ge<y;)Fe[ge]=Re(ue[ge],ge,ue);return Fe}wn.exports=Ee},40371:function(wn){function Ee(ue){return function(Re){return Re==null?void 0:Re[ue]}}wn.exports=Ee},80531:function(wn,Ee,ue){var Re=ue(62705),ge=ue(29932),y=ue(1469),Fe=ue(33448),K=1/0,Me=Re?Re.prototype:void 0,ve=Me?Me.toString:void 0;function at(se){if(typeof se=="string")return se;if(y(se))return ge(se,at)+"";if(Fe(se))return ve?ve.call(se):"";var Be=se+"";return Be=="0"&&1/se==-K?"-0":Be}wn.exports=at},79833:function(wn,Ee,ue){var Re=ue(80531);function ge(y){return y==null?"":Re(y)}wn.exports=ge},6158:function(wn){(function(Ee,ue){wn.exports=ue()})(this,function(){"use strict";var Ee,ue,Re;function ge(y,Fe){if(!Ee)Ee=Fe;else if(!ue)ue=Fe;else{var K="var sharedChunk = {}; ("+Ee+")(sharedChunk); ("+ue+")(sharedChunk);",Me={};Ee(Me),Re=Fe(Me),typeof window!="undefined"&&(Re.workerUrl=window.URL.createObjectURL(new Blob([K],{type:"text/javascript"})))}}return ge(["exports"],function(y){"use strict";function Fe(i,s){return i(s={exports:{}},s.exports),s.exports}var K=Me;function Me(i,s,l,v){this.cx=3*i,this.bx=3*(l-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(v-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=v,this.p2x=l,this.p2y=v}Me.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Me.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Me.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Me.prototype.solveCurveX=function(i,s){var l,v,x,C,T;for(s===void 0&&(s=1e-6),x=i,T=0;T<8;T++){if(C=this.sampleCurveX(x)-i,Math.abs(C)<s)return x;var R=this.sampleCurveDerivativeX(x);if(Math.abs(R)<1e-6)break;x-=C/R}if((x=i)<(l=0))return l;if(x>(v=1))return v;for(;l<v;){if(C=this.sampleCurveX(x),Math.abs(C-i)<s)return x;i>C?l=x:v=x,x=.5*(v-l)+l}return x},Me.prototype.solve=function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))};var ve=at;function at(i,s){this.x=i,this.y=s}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,s){return this.clone()._rotateAround(i,s)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var s=i.x-this.x,l=i.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,s){return Math.atan2(this.x*s-this.y*i,this.x*i+this.y*s)},_matMult:function(i){var s=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=s,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var s=Math.cos(i),l=Math.sin(i),v=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=v,this},_rotateAround:function(i,s){var l=Math.cos(i),v=Math.sin(i),x=s.y+v*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-v*(this.y-s.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(i){return i instanceof at?i:Array.isArray(i)?new at(i[0],i[1]):i};var se=typeof self!="undefined"?self:{},Be=Math.pow(2,53)-1;function dt(i,s,l,v){var x=new K(i,s,l,v);return function(C){return x.solve(C)}}var rt=dt(.25,.1,.25,1);function Et(i,s,l){return Math.min(l,Math.max(s,i))}function Vt(i,s,l){var v=l-s,x=((i-s)%v+v)%v+s;return x===s?l:x}function Ut(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var v=0,x=s;v<x.length;v+=1){var C=x[v];for(var T in C)i[T]=C[T]}return i}var lr=1;function Qt(){return lr++}function It(){return function i(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Lt(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function fr(i,s){i.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function ie(i,s){return i.indexOf(s,i.length-s.length)!==-1}function yr(i,s,l){var v={};for(var x in i)v[x]=s.call(l||this,i[x],x,i);return v}function Dt(i,s,l){var v={};for(var x in i)s.call(l||this,i[x],x,i)&&(v[x]=i[x]);return v}function xt(i){return Array.isArray(i)?i.map(xt):typeof i=="object"&&i?yr(i,xt):i}var Jt={};function je(i){Jt[i]||(typeof console!="undefined"&&console.warn(i),Jt[i]=!0)}function Sr(i,s,l){return(l.y-i.y)*(s.x-i.x)>(s.y-i.y)*(l.x-i.x)}function tn(i){for(var s=0,l=0,v=i.length,x=v-1,C=void 0,T=void 0;l<v;x=l++)s+=((T=i[x]).x-(C=i[l]).x)*(C.y+T.y);return s}function re(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Se(i){var s={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(v,x,C,T){var R=C||T;return s[x]=!R||R.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var V=null;function Q(i){if(V==null){var s=i.navigator?i.navigator.userAgent:null;V=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return V}function Le(i){try{var s=se[i];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var ht,wt,er,Tt,vr=se.performance&&se.performance.now?se.performance.now.bind(se.performance):Date.now.bind(Date),ln=se.requestAnimationFrame||se.mozRequestAnimationFrame||se.webkitRequestAnimationFrame||se.msRequestAnimationFrame,sn=se.cancelAnimationFrame||se.mozCancelAnimationFrame||se.webkitCancelAnimationFrame||se.msCancelAnimationFrame,Mi={now:vr,frame:function(i){var s=ln(i);return{cancel:function(){return sn(s)}}},getImageData:function(i,s){s===void 0&&(s=0);var l=se.document.createElement("canvas"),v=l.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return l.width=i.width,l.height=i.height,v.drawImage(i,0,0,i.width,i.height),v.getImageData(-s,-s,i.width+2*s,i.height+2*s)},resolveURL:function(i){return ht||(ht=se.document.createElement("a")),ht.href=i,ht.href},hardwareConcurrency:se.navigator&&se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return se.devicePixelRatio},get prefersReducedMotion(){return!!se.matchMedia&&(wt==null&&(wt=se.matchMedia("(prefers-reduced-motion: reduce)")),wt.matches)}},vi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},en={supported:!1,testSupport:function(i){!Oa&&Tt&&(ra?Vi(i):er=i)}},Oa=!1,ra=!1;function Vi(i){var s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Tt),i.isContextLost())return;en.supported=!0}catch(l){}i.deleteTexture(s),Oa=!0}se.document&&((Tt=se.document.createElement("img")).onload=function(){er&&Vi(er),er=null,ra=!0},Tt.onerror=function(){Oa=!0,er=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ya="01",fi=function(i,s){this._transformRequestFn=i,this._customAccessToken=s,this._createSkuToken()};function $i(i){return i.indexOf("mapbox:")===0}fi.prototype._createSkuToken=function(){var i=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ya,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},fi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},fi.prototype.transformRequest=function(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}},fi.prototype.normalizeStyleURL=function(i,s){if(!$i(i))return i;var l=yo(i);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeGlyphsURL=function(i,s){if(!$i(i))return i;var l=yo(i);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeSourceURL=function(i,s){if(!$i(i))return i;var l=yo(i);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeSpriteURL=function(i,s,l,v){var x=yo(i);return $i(i)?(x.path="/styles/v1"+x.path+"/sprite"+s+l,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=""+s+l,qa(x))},fi.prototype.normalizeTileURL=function(i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!$i(i))return i;var l=yo(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Mi.devicePixelRatio>=2||s===512?"@2x":"")+(en.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var v=this._customAccessToken||function(x){for(var C=0,T=x;C<T.length;C+=1){var R=T[C].match(/^access_token=(.*)$/);if(R)return R[1]}return null}(l.params)||vi.ACCESS_TOKEN;return vi.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,v)},fi.prototype.canonicalizeTileURL=function(i,s){var l=yo(i);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return i;var v="mapbox://tiles/";v+=l.path.replace("/v4/","");var x=l.params;return s&&(x=x.filter(function(C){return!C.match(/^access_token=/)})),x.length&&(v+="?"+x.join("&")),v},fi.prototype.canonicalizeTileset=function(i,s){for(var l=!!s&&$i(s),v=[],x=0,C=i.tiles||[];x<C.length;x+=1){var T=C[x];yi(T)?v.push(this.canonicalizeTileURL(T,l)):v.push(T)}return v},fi.prototype._makeAPIURL=function(i,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",v=yo(vi.API_URL);if(i.protocol=v.protocol,i.authority=v.authority,i.protocol==="http"){var x=i.params.indexOf("secure");x>=0&&i.params.splice(x,1)}if(v.path!=="/"&&(i.path=""+v.path+i.path),!vi.REQUIRE_ACCESS_TOKEN)return qa(i);if(!(s=s||vi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return i.params=i.params.filter(function(C){return C.indexOf("access_token")===-1}),i.params.push("access_token="+s),qa(i)};var hi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function yi(i){return hi.test(i)}var ss=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yo(i){var s=i.match(ss);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function qa(i){var s=i.params.length?"?"+i.params.join("&"):"";return i.protocol+"://"+i.authority+i.path+s}function Ft(i){if(!i)return null;var s=i.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(se.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var be=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};be.prototype.getStorageKey=function(i){var s,l=Ft(vi.ACCESS_TOKEN);return s=l&&l.u?se.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(v,x){return String.fromCharCode(Number("0x"+x))})):vi.ACCESS_TOKEN||"",i?"mapbox.eventData."+i+":"+s:"mapbox.eventData:"+s},be.prototype.fetchEventData=function(){var i=Le("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{var v=se.localStorage.getItem(s);v&&(this.eventData=JSON.parse(v));var x=se.localStorage.getItem(l);x&&(this.anonId=x)}catch(C){je("Unable to read from LocalStorage")}},be.prototype.saveEventData=function(){var i=Le("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{se.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&se.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(v){je("Unable to write to LocalStorage")}},be.prototype.processRequests=function(i){},be.prototype.postEvent=function(i,s,l,v){var x=this;if(vi.EVENTS_URL){var C=yo(vi.EVENTS_URL);C.params.push("access_token="+(v||vi.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ya,userId:this.anonId},R=s?Ut(T,s):T,U={url:qa(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=pa(U,function(X){x.pendingRequest=null,l(X),x.saveEventData(),x.processRequests(v)})}},be.prototype.queueRequest=function(i,s){this.queue.push(i),this.processRequests(s)};var he,Ie,G=function(i){function s(){i.call(this,"map.load"),this.success={},this.skuToken=""}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,v,x,C){this.skuToken=x,(vi.EVENTS_URL&&C||vi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(T){return $i(T)||yi(T)}))&&this.queueRequest({id:v,timestamp:Date.now()},C)},s.prototype.processRequests=function(l){var v=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),C=x.id,T=x.timestamp;C&&this.success[C]||(this.anonId||this.fetchEventData(),Lt(this.anonId)||(this.anonId=It()),this.postEvent(T,{skuToken:this.skuToken},function(R){R||C&&(v.success[C]=!0)},l))}},s}(be),lt=new(function(i){function s(l){i.call(this,"appUserTurnstile"),this._customAccessToken=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,v){vi.EVENTS_URL&&vi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(x){return $i(x)||yi(x)})&&this.queueRequest(Date.now(),v)},s.prototype.processRequests=function(l){var v=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Ft(vi.ACCESS_TOKEN),C=x?x.u:vi.ACCESS_TOKEN,T=C!==this.eventData.tokenU;Lt(this.anonId)||(this.anonId=It(),T=!0);var R=this.queue.shift();if(this.eventData.lastSuccess){var U=new Date(this.eventData.lastSuccess),X=new Date(R),$=(R-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||U.getDate()!==X.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(R,{"enabled.telemetry":!1},function(ne){ne||(v.eventData.lastSuccess=R,v.eventData.tokenU=C)},l)}},s}(be)),sr=lt.postTurnstileEvent.bind(lt),Jr=new G,nt=Jr.postMapLoadEvent.bind(Jr),Gt=500,Ar=50;function Tr(){se.caches&&!he&&(he=se.caches.open("mapbox-tiles"))}function Rr(i){var s=i.indexOf("?");return s<0?i:i.slice(0,s)}var mn,mi=1/0;function ai(){return mn==null&&(mn=se.OffscreenCanvas&&new se.OffscreenCanvas(1,1).getContext("2d")&&typeof se.createImageBitmap=="function"),mn}var Tn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Tn);var Ri=function(i){function s(l,v,x){v===401&&yi(x)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),i.call(this,l),this.status=v,this.url=x,this.name=this.constructor.name,this.message=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),zi=re()?function(){return self.worker&&self.worker.referrer}:function(){return(se.location.protocol==="blob:"?se.parent:se).location.href},ka,ia,io=function(i,s){if(!(/^file:/.test(l=i.url)||/^file:/.test(zi())&&!/^\w+:/.test(l))){if(se.fetch&&se.Request&&se.AbortController&&se.Request.prototype.hasOwnProperty("signal"))return function(v,x){var C,T=new se.AbortController,R=new se.Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:zi(),signal:T.signal}),U=!1,X=!1,$=(C=R.url).indexOf("sku=")>0&&yi(C);v.type==="json"&&R.headers.set("Accept","application/json");var ne=function(Ae,Qe,et){if(!X){if(Ae&&Ae.message!=="SecurityError"&&je(Ae),Qe&&et)return me(Qe);var _t=Date.now();se.fetch(R).then(function(ft){if(ft.ok){var zt=$?ft.clone():null;return me(ft,zt,_t)}return x(new Ri(ft.statusText,ft.status,v.url))}).catch(function(ft){ft.code!==20&&x(new Error(ft.message))})}},me=function(Ae,Qe,et){(v.type==="arrayBuffer"?Ae.arrayBuffer():v.type==="json"?Ae.json():Ae.text()).then(function(_t){X||(Qe&&et&&function(ft,zt,tr){if(Tr(),he){var xr={status:zt.status,statusText:zt.statusText,headers:new se.Headers};zt.headers.forEach(function(Zr,pn){return xr.headers.set(pn,Zr)});var br=Se(zt.headers.get("Cache-Control")||"");br["no-store"]||(br["max-age"]&&xr.headers.set("Expires",new Date(tr+1e3*br["max-age"]).toUTCString()),new Date(xr.headers.get("Expires")).getTime()-tr<42e4||function(Zr,pn){if(Ie===void 0)try{new Response(new ReadableStream),Ie=!0}catch(Un){Ie=!1}Ie?pn(Zr.body):Zr.blob().then(pn)}(zt,function(Zr){var pn=new se.Response(Zr,xr);Tr(),he&&he.then(function(Un){return Un.put(Rr(ft.url),pn)}).catch(function(Un){return je(Un.message)})}))}}(R,Qe,et),U=!0,x(null,_t,Ae.headers.get("Cache-Control"),Ae.headers.get("Expires")))}).catch(function(_t){X||x(new Error(_t.message))})};return $?function(Ae,Qe){if(Tr(),!he)return Qe(null);var et=Rr(Ae.url);he.then(function(_t){_t.match(et).then(function(ft){var zt=function(tr){if(!tr)return!1;var xr=new Date(tr.headers.get("Expires")||0),br=Se(tr.headers.get("Cache-Control")||"");return xr>Date.now()&&!br["no-cache"]}(ft);_t.delete(et),zt&&_t.put(et,ft.clone()),Qe(null,ft,zt)}).catch(Qe)}).catch(Qe)}(R,ne):ne(null,null),{cancel:function(){X=!0,U||T.abort()}}}(i,s);if(re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,s,void 0,!0)}var l;return function(v,x){var C=new se.XMLHttpRequest;for(var T in C.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(C.responseType="arraybuffer"),v.headers)C.setRequestHeader(T,v.headers[T]);return v.type==="json"&&(C.responseType="text",C.setRequestHeader("Accept","application/json")),C.withCredentials=v.credentials==="include",C.onerror=function(){x(new Error(C.statusText))},C.onload=function(){if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){var R=C.response;if(v.type==="json")try{R=JSON.parse(C.response)}catch(U){return x(U)}x(null,R,C.getResponseHeader("Cache-Control"),C.getResponseHeader("Expires"))}else x(new Ri(C.statusText,C.status,v.url))},C.send(v.body),{cancel:function(){return C.abort()}}}(i,s)},Ci=function(i,s){return io(Ut(i,{type:"arrayBuffer"}),s)},pa=function(i,s){return io(Ut(i,{method:"POST"}),s)},ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ka=[],ia=0;var ce=function(i,s){if(en.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ia>=vi.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:i,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return ka.push(l),l}ia++;var v=!1,x=function(){if(!v)for(v=!0,ia--;ka.length&&ia<vi.MAX_PARALLEL_IMAGE_REQUESTS;){var T=ka.shift();T.cancelled||(T.cancel=ce(T.requestParameters,T.callback).cancel)}},C=Ci(i,function(T,R,U,X){x(),T?s(T):R&&(ai()?function($,ne){var me=new se.Blob([new Uint8Array($)],{type:"image/png"});se.createImageBitmap(me).then(function(Ae){ne(null,Ae)}).catch(function(Ae){ne(new Error("Could not load image because of "+Ae.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(R,s):function($,ne,me,Ae){var Qe=new se.Image,et=se.URL;Qe.onload=function(){ne(null,Qe),et.revokeObjectURL(Qe.src),Qe.onload=null,se.requestAnimationFrame(function(){Qe.src=ee})},Qe.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var _t=new se.Blob([new Uint8Array($)],{type:"image/png"});Qe.cacheControl=me,Qe.expires=Ae,Qe.src=$.byteLength?et.createObjectURL(_t):ee}(R,s,U,X))});return{cancel:function(){C.cancel(),x()}}};function xe(i,s,l){l[i]&&l[i].indexOf(s)!==-1||(l[i]=l[i]||[],l[i].push(s))}function Oe(i,s,l){if(l&&l[i]){var v=l[i].indexOf(s);v!==-1&&l[i].splice(v,1)}}var qe=function(i,s){s===void 0&&(s={}),Ut(this,s),this.type=i},ct=function(i){function s(l,v){v===void 0&&(v={}),i.call(this,"error",Ut({error:l},v))}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(qe),St=function(){};St.prototype.on=function(i,s){return this._listeners=this._listeners||{},xe(i,s,this._listeners),this},St.prototype.off=function(i,s){return Oe(i,s,this._listeners),Oe(i,s,this._oneTimeListeners),this},St.prototype.once=function(i,s){return this._oneTimeListeners=this._oneTimeListeners||{},xe(i,s,this._oneTimeListeners),this},St.prototype.fire=function(i,s){typeof i=="string"&&(i=new qe(i,s||{}));var l=i.type;if(this.listens(l)){i.target=this;for(var v=0,x=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];v<x.length;v+=1)x[v].call(this,i);for(var C=0,T=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];C<T.length;C+=1){var R=T[C];Oe(l,R,this._oneTimeListeners),R.call(this,i)}var U=this._eventedParent;U&&(Ut(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),U.fire(i))}else i instanceof ct&&console.error(i.error);return this},St.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},St.prototype.setEventedParent=function(i,s){return this._eventedParent=i,this._eventedParentData=s,this};var ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},it=function(i,s,l,v){this.message=(i?i+": ":"")+l,v&&(this.identifier=v),s!=null&&s.__line__&&(this.line=s.__line__)};function Yt(i){var s=i.value;return s?[new it(i.key,s,"constants have been deprecated as of v8")]:[]}function jr(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var v=0,x=s;v<x.length;v+=1){var C=x[v];for(var T in C)i[T]=C[T]}return i}function or(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mr(i){if(Array.isArray(i))return i.map(mr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){var s={};for(var l in i)s[l]=mr(i[l]);return s}return or(i)}var Hr=function(i){function s(l,v){i.call(this,v),this.message=v,this.key=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Error),si=function(i,s){s===void 0&&(s=[]),this.parent=i,this.bindings={};for(var l=0,v=s;l<v.length;l+=1){var x=v[l];this.bindings[x[0]]=x[1]}};si.prototype.concat=function(i){return new si(this,i)},si.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},si.prototype.has=function(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)};var Mn={kind:"null"},ar={kind:"number"},Yn={kind:"string"},Pr={kind:"boolean"},gn={kind:"color"},ea={kind:"object"},Vn={kind:"value"},na={kind:"collator"},Ht={kind:"formatted"},Rt={kind:"resolvedImage"};function da(i,s){return{kind:"array",itemType:i,N:s}}function aa(i){if(i.kind==="array"){var s=aa(i.itemType);return typeof i.N=="number"?"array<"+s+", "+i.N+">":i.itemType.kind==="value"?"array":"array<"+s+">"}return i.kind}var Di=[Mn,ar,Yn,Pr,gn,Ht,ea,da(Vn),Rt];function Ii(i,s){if(s.kind==="error")return null;if(i.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Ii(i.itemType,s.itemType))&&(typeof i.N!="number"||i.N===s.N))return null}else{if(i.kind===s.kind)return null;if(i.kind==="value"){for(var l=0,v=Di;l<v.length;l+=1)if(!Ii(v[l],s))return null}}return"Expected "+aa(i)+" but found "+aa(s)+" instead."}function _o(i,s){return s.some(function(l){return l.kind===i.kind})}function Na(i,s){return s.some(function(l){return l==="null"?i===null:l==="array"?Array.isArray(i):l==="object"?i&&!Array.isArray(i)&&typeof i=="object":l===typeof i})}var Or=Fe(function(i,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function v(R){return(R=Math.round(R))<0?0:R>255?255:R}function x(R){return v(R[R.length-1]==="%"?parseFloat(R)/100*255:parseInt(R))}function C(R){return(U=R[R.length-1]==="%"?parseFloat(R)/100:parseFloat(R))<0?0:U>1?1:U;var U}function T(R,U,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?R+(U-R)*X*6:2*X<1?U:3*X<2?R+(U-R)*(2/3-X)*6:R}try{s.parseCSSColor=function(R){var U,X=R.replace(/ /g,"").toLowerCase();if(X in l)return l[X].slice();if(X[0]==="#")return X.length===4?(U=parseInt(X.substr(1),16))>=0&&U<=4095?[(3840&U)>>4|(3840&U)>>8,240&U|(240&U)>>4,15&U|(15&U)<<4,1]:null:X.length===7&&(U=parseInt(X.substr(1),16))>=0&&U<=16777215?[(16711680&U)>>16,(65280&U)>>8,255&U,1]:null;var $=X.indexOf("("),ne=X.indexOf(")");if($!==-1&&ne+1===X.length){var me=X.substr(0,$),Ae=X.substr($+1,ne-($+1)).split(","),Qe=1;switch(me){case"rgba":if(Ae.length!==4)return null;Qe=C(Ae.pop());case"rgb":return Ae.length!==3?null:[x(Ae[0]),x(Ae[1]),x(Ae[2]),Qe];case"hsla":if(Ae.length!==4)return null;Qe=C(Ae.pop());case"hsl":if(Ae.length!==3)return null;var et=(parseFloat(Ae[0])%360+360)%360/360,_t=C(Ae[1]),ft=C(Ae[2]),zt=ft<=.5?ft*(_t+1):ft+_t-ft*_t,tr=2*ft-zt;return[v(255*T(tr,zt,et+1/3)),v(255*T(tr,zt,et)),v(255*T(tr,zt,et-1/3)),Qe];default:return null}}return null}}catch(R){}}).parseCSSColor,Dr=function(i,s,l,v){v===void 0&&(v=1),this.r=i,this.g=s,this.b=l,this.a=v};Dr.parse=function(i){if(i){if(i instanceof Dr)return i;if(typeof i=="string"){var s=Or(i);if(s)return new Dr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Dr.prototype.toString=function(){var i=this.toArray(),s=i[1],l=i[2],v=i[3];return"rgba("+Math.round(i[0])+","+Math.round(s)+","+Math.round(l)+","+v+")"},Dr.prototype.toArray=function(){var i=this.a;return i===0?[0,0,0,0]:[255*this.r/i,255*this.g/i,255*this.b/i,i]},Dr.black=new Dr(0,0,0,1),Dr.white=new Dr(1,1,1,1),Dr.transparent=new Dr(0,0,0,0),Dr.red=new Dr(1,0,0,1);var Mt=function(i,s,l){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Mt.prototype.compare=function(i,s){return this.collator.compare(i,s)},Mt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var us=function(i,s,l,v,x){this.text=i,this.image=s,this.scale=l,this.fontStack=v,this.textColor=x},At=function(i){this.sections=i};At.fromString=function(i){return new At([new us(i,null,null,null,null)])},At.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},At.factory=function(i){return i instanceof At?i:At.fromString(i)},At.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},At.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var v=l[s];if(v.image)i.push(["image",v.image.name]);else{i.push(v.text);var x={};v.fontStack&&(x["text-font"]=["literal",v.fontStack.split(",")]),v.scale&&(x["font-scale"]=v.scale),v.textColor&&(x["text-color"]=["rgba"].concat(v.textColor.toArray())),i.push(x)}}return i};var ao=function(i){this.name=i.name,this.available=i.available};function yu(i,s,l,v){return typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:"Invalid rgba value ["+[i,s,l,v].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof v=="number"?[i,s,l,v]:[i,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Jo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Dr||i instanceof Mt||i instanceof At||i instanceof ao)return!0;if(Array.isArray(i)){for(var s=0,l=i;s<l.length;s+=1)if(!Jo(l[s]))return!1;return!0}if(typeof i=="object"){for(var v in i)if(!Jo(i[v]))return!1;return!0}return!1}function Bi(i){if(i===null)return Mn;if(typeof i=="string")return Yn;if(typeof i=="boolean")return Pr;if(typeof i=="number")return ar;if(i instanceof Dr)return gn;if(i instanceof Mt)return na;if(i instanceof At)return Ht;if(i instanceof ao)return Rt;if(Array.isArray(i)){for(var s,l=i.length,v=0,x=i;v<x.length;v+=1){var C=Bi(x[v]);if(s){if(s===C)continue;s=Vn;break}s=C}return da(s||Vn,l)}return ea}function gl(i){var s=typeof i;return i===null?"":s==="string"||s==="number"||s==="boolean"?String(i):i instanceof Dr||i instanceof At||i instanceof ao?i.toString():JSON.stringify(i)}ao.prototype.toString=function(){return this.name},ao.fromString=function(i){return i?new ao({name:i,available:!1}):null},ao.prototype.serialize=function(){return["image",this.name]};var Ra=function(i,s){this.type=i,this.value=s};Ra.parse=function(i,s){if(i.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!Jo(i[1]))return s.error("invalid value");var l=i[1],v=Bi(l),x=s.expectedType;return v.kind!=="array"||v.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(v=x),new Ra(v,l)},Ra.prototype.evaluate=function(){return this.value},Ra.prototype.eachChild=function(){},Ra.prototype.outputDefined=function(){return!0},Ra.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Dr?["rgba"].concat(this.value.toArray()):this.value instanceof At?this.value.serialize():this.value};var Lo=function(i){this.name="ExpressionEvaluationError",this.message=i};Lo.prototype.toJSON=function(){return this.message};var Do={string:Yn,number:ar,boolean:Pr,object:ea},Ea=function(i,s){this.type=i,this.args=s};Ea.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l,v=1,x=i[0];if(x==="array"){var C,T;if(i.length>2){var R=i[1];if(typeof R!="string"||!(R in Do)||R==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=Do[R],v++}else C=Vn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],v++}l=da(C,T)}else l=Do[x];for(var U=[];v<i.length;v++){var X=s.parse(i[v],v,Vn);if(!X)return null;U.push(X)}return new Ea(l,U)},Ea.prototype.evaluate=function(i){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(i);if(!Ii(this.type,Bi(l)))return l;if(s===this.args.length-1)throw new Lo("Expected value to be of type "+aa(this.type)+", but found "+aa(Bi(l))+" instead.")}return null},Ea.prototype.eachChild=function(i){this.args.forEach(i)},Ea.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Ea.prototype.serialize=function(){var i=this.type,s=[i.kind];if(i.kind==="array"){var l=i.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var v=i.N;(typeof v=="number"||this.args.length>1)&&s.push(v)}}return s.concat(this.args.map(function(x){return x.serialize()}))};var Ps=function(i){this.type=Ht,this.sections=i};Ps.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var v=[],x=!1,C=1;C<=i.length-1;++C){var T=i[C];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var R=null;if(T["font-scale"]&&!(R=s.parse(T["font-scale"],1,ar)))return null;var U=null;if(T["text-font"]&&!(U=s.parse(T["text-font"],1,da(Yn))))return null;var X=null;if(T["text-color"]&&!(X=s.parse(T["text-color"],1,gn)))return null;var $=v[v.length-1];$.scale=R,$.font=U,$.textColor=X}else{var ne=s.parse(i[C],1,Vn);if(!ne)return null;var me=ne.type.kind;if(me!=="string"&&me!=="value"&&me!=="null"&&me!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,v.push({content:ne,scale:null,font:null,textColor:null})}}return new Ps(v)},Ps.prototype.evaluate=function(i){return new At(this.sections.map(function(s){var l=s.content.evaluate(i);return Bi(l)===Rt?new us("",l,null,null,null):new us(gl(l),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))},Ps.prototype.eachChild=function(i){for(var s=0,l=this.sections;s<l.length;s+=1){var v=l[s];i(v.content),v.scale&&i(v.scale),v.font&&i(v.font),v.textColor&&i(v.textColor)}},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var v=l[s];i.push(v.content.serialize());var x={};v.scale&&(x["font-scale"]=v.scale.serialize()),v.font&&(x["text-font"]=v.font.serialize()),v.textColor&&(x["text-color"]=v.textColor.serialize()),i.push(x)}return i};var ks=function(i){this.type=Rt,this.input=i};ks.parse=function(i,s){if(i.length!==2)return s.error("Expected two arguments.");var l=s.parse(i[1],1,Yn);return l?new ks(l):s.error("No image name provided.")},ks.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=ao.fromString(s);return l&&i.availableImages&&(l.available=i.availableImages.indexOf(s)>-1),l},ks.prototype.eachChild=function(i){i(this.input)},ks.prototype.outputDefined=function(){return!1},ks.prototype.serialize=function(){return["image",this.input.serialize()]};var Jl={"to-boolean":Pr,"to-color":gn,"to-number":ar,"to-string":Yn},fo=function(i,s){this.type=i,this.args=s};fo.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[0];if((l==="to-boolean"||l==="to-string")&&i.length!==2)return s.error("Expected one argument.");for(var v=Jl[l],x=[],C=1;C<i.length;C++){var T=s.parse(i[C],C,Vn);if(!T)return null;x.push(T)}return new fo(v,x)},fo.prototype.evaluate=function(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){for(var s,l,v=0,x=this.args;v<x.length;v+=1){if(l=null,(s=x[v].evaluate(i))instanceof Dr)return s;if(typeof s=="string"){var C=i.parseColor(s);if(C)return C}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":yu(s[0],s[1],s[2],s[3])))return new Dr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Lo(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var T=null,R=0,U=this.args;R<U.length;R+=1){if((T=U[R].evaluate(i))===null)return 0;var X=Number(T);if(!isNaN(X))return X}throw new Lo("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?At.fromString(gl(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?ao.fromString(gl(this.args[0].evaluate(i))):gl(this.args[0].evaluate(i))},fo.prototype.eachChild=function(i){this.args.forEach(i)},fo.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},fo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ps([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ks(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(s){i.push(s.serialize())}),i};var ds=["Unknown","Point","LineString","Polygon"],ja=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ja.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ja.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ds[this.feature.type]:this.feature.type:null},ja.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ja.prototype.canonicalID=function(){return this.canonical},ja.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ja.prototype.parseColor=function(i){var s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=Dr.parse(i)),s};var Fo=function(i,s,l,v){this.name=i,this.type=s,this._evaluate=l,this.args=v};Fo.prototype.evaluate=function(i){return this._evaluate(i,this.args)},Fo.prototype.eachChild=function(i){this.args.forEach(i)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},Fo.parse=function(i,s){var l,v=i[0],x=Fo.definitions[v];if(!x)return s.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0);for(var C=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,R=T.filter(function(Pi){var Xn=Pi[0];return!Array.isArray(Xn)||Xn.length===i.length-1}),U=null,X=0,$=R;X<$.length;X+=1){var ne=$[X],me=ne[0],Ae=ne[1];U=new Gu(s.registry,s.path,null,s.scope);for(var Qe=[],et=!1,_t=1;_t<i.length;_t++){var ft=i[_t],zt=Array.isArray(me)?me[_t-1]:me.type,tr=U.parse(ft,1+Qe.length,zt);if(!tr){et=!0;break}Qe.push(tr)}if(!et)if(Array.isArray(me)&&me.length!==Qe.length)U.error("Expected "+me.length+" arguments, but found "+Qe.length+" instead.");else{for(var xr=0;xr<Qe.length;xr++){var br=Array.isArray(me)?me[xr]:me.type,Zr=Qe[xr];U.concat(xr+1).checkSubtype(br,Zr.type)}if(U.errors.length===0)return new Fo(v,C,Ae,Qe)}}if(R.length===1)(l=s.errors).push.apply(l,U.errors);else{for(var pn=(R.length?R:T).map(function(Pi){var Xn;return Xn=Pi[0],Array.isArray(Xn)?"("+Xn.map(aa).join(", ")+")":"("+aa(Xn.type)+"...)"}).join(" | "),Un=[],Ai=1;Ai<i.length;Ai++){var ti=s.parse(i[Ai],1+Un.length);if(!ti)return null;Un.push(aa(ti.type))}s.error("Expected arguments of type "+pn+", but found ("+Un.join(", ")+") instead.")}return null},Fo.register=function(i,s){for(var l in Fo.definitions=s,s)i[l]=Fo};var vs=function(i,s,l){this.type=na,this.locale=l,this.caseSensitive=i,this.diacriticSensitive=s};function Bo(i,s){i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.max(i[2],s[0]),i[3]=Math.max(i[3],s[1])}function Ju(i,s){return!(i[0]<=s[0]||i[2]>=s[2]||i[1]<=s[1]||i[3]>=s[3])}function ju(i,s){var l=(180+i[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,x=Math.pow(2,s.z);return[Math.round(l*x*8192),Math.round(v*x*8192)]}function jo(i,s,l){return s[1]>i[1]!=l[1]>i[1]&&i[0]<(l[0]-s[0])*(i[1]-s[1])/(l[1]-s[1])+s[0]}function ye(i,s){for(var l,v,x,C,T,R,U,X=!1,$=0,ne=s.length;$<ne;$++)for(var me=s[$],Ae=0,Qe=me.length;Ae<Qe-1;Ae++){if((C=(l=i)[0]-(v=me[Ae])[0])*(U=l[1]-(x=me[Ae+1])[1])-(R=l[0]-x[0])*(T=l[1]-v[1])==0&&C*R<=0&&T*U<=0)return!1;jo(i,me[Ae],me[Ae+1])&&(X=!X)}return X}function Ze(i,s){for(var l=0;l<s.length;l++)if(ye(i,s[l]))return!0;return!1}function Ct(i,s,l,v){var x=v[0]-l[0],C=v[1]-l[1],T=(i[0]-l[0])*C-x*(i[1]-l[1]),R=(s[0]-l[0])*C-x*(s[1]-l[1]);return T>0&&R<0||T<0&&R>0}function hr(i,s,l){for(var v=0,x=l;v<x.length;v+=1)for(var C=x[v],T=0;T<C.length-1;++T)if((ne=[($=C[T+1])[0]-(X=C[T])[0],$[1]-X[1]])[0]*(me=[(U=s)[0]-(R=i)[0],U[1]-R[1]])[1]-ne[1]*me[0]!=0&&Ct(R,U,X,$)&&Ct(X,$,R,U))return!0;var R,U,X,$,ne,me;return!1}function En(i,s){for(var l=0;l<i.length;++l)if(!ye(i[l],s))return!1;for(var v=0;v<i.length-1;++v)if(hr(i[v],i[v+1],s))return!1;return!0}function ri(i,s){for(var l=0;l<s.length;l++)if(En(i,s[l]))return!0;return!1}function _a(i,s,l){for(var v=[],x=0;x<i.length;x++){for(var C=[],T=0;T<i[x].length;T++){var R=ju(i[x][T],l);Bo(s,R),C.push(R)}v.push(C)}return v}function Go(i,s,l){for(var v=[],x=0;x<i.length;x++){var C=_a(i[x],s,l);v.push(C)}return v}function Da(i,s,l,v){if(i[0]<l[0]||i[0]>l[2]){var x=.5*v,C=i[0]-l[0]>x?-v:l[0]-i[0]>x?v:0;C===0&&(C=i[0]-l[2]>x?-v:l[2]-i[0]>x?v:0),i[0]+=C}Bo(s,i)}function No(i,s,l,v){for(var x=8192*Math.pow(2,v.z),C=[8192*v.x,8192*v.y],T=[],R=0,U=i;R<U.length;R+=1)for(var X=0,$=U[R];X<$.length;X+=1){var ne=$[X],me=[ne.x+C[0],ne.y+C[1]];Da(me,s,l,x),T.push(me)}return T}function So(i,s,l,v){for(var x,C=8192*Math.pow(2,v.z),T=[8192*v.x,8192*v.y],R=[],U=0,X=i;U<X.length;U+=1){for(var $=[],ne=0,me=X[U];ne<me.length;ne+=1){var Ae=me[ne],Qe=[Ae.x+T[0],Ae.y+T[1]];Bo(s,Qe),$.push(Qe)}R.push($)}if(s[2]-s[0]<=C/2){(x=s)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var et=0,_t=R;et<_t.length;et+=1)for(var ft=0,zt=_t[et];ft<zt.length;ft+=1)Da(zt[ft],s,l,C)}return R}vs.parse=function(i,s){if(i.length!==2)return s.error("Expected one argument.");var l=i[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var v=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Pr);if(!v)return null;var x=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Pr);if(!x)return null;var C=null;return l.locale&&!(C=s.parse(l.locale,1,Yn))?null:new vs(v,x,C)},vs.prototype.evaluate=function(i){return new Mt(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},vs.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},vs.prototype.outputDefined=function(){return!1},vs.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var oo=function(i,s){this.type=Pr,this.geojson=i,this.geometries=s};function Ls(i){if(i instanceof Fo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof oo)return!1;var s=!0;return i.eachChild(function(l){s&&!Ls(l)&&(s=!1)}),s}function Qs(i){if(i instanceof Fo&&i.name==="feature-state")return!1;var s=!0;return i.eachChild(function(l){s&&!Qs(l)&&(s=!1)}),s}function uu(i,s){if(i instanceof Fo&&s.indexOf(i.name)>=0)return!1;var l=!0;return i.eachChild(function(v){l&&!uu(v,s)&&(l=!1)}),l}oo.parse=function(i,s){if(i.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(Jo(i[1])){var l=i[1];if(l.type==="FeatureCollection")for(var v=0;v<l.features.length;++v){var x=l.features[v].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new oo(l,l.features[v].geometry)}else if(l.type==="Feature"){var C=l.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new oo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new oo(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},oo.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,l){var v=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=_a(l.coordinates,x,C),R=No(s.geometry(),v,x,C);if(!Ju(v,x))return!1;for(var U=0,X=R;U<X.length;U+=1)if(!ye(X[U],T))return!1}if(l.type==="MultiPolygon"){var $=Go(l.coordinates,x,C),ne=No(s.geometry(),v,x,C);if(!Ju(v,x))return!1;for(var me=0,Ae=ne;me<Ae.length;me+=1)if(!Ze(Ae[me],$))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,l){var v=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=_a(l.coordinates,x,C),R=So(s.geometry(),v,x,C);if(!Ju(v,x))return!1;for(var U=0,X=R;U<X.length;U+=1)if(!En(X[U],T))return!1}if(l.type==="MultiPolygon"){var $=Go(l.coordinates,x,C),ne=So(s.geometry(),v,x,C);if(!Ju(v,x))return!1;for(var me=0,Ae=ne;me<Ae.length;me+=1)if(!ri(Ae[me],$))return!1}return!0}(i,this.geometries)}return!1},oo.prototype.eachChild=function(){},oo.prototype.outputDefined=function(){return!0},oo.prototype.serialize=function(){return["within",this.geojson]};var _u=function(i,s){this.type=s.type,this.name=i,this.boundExpression=s};_u.parse=function(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=i[1];return s.scope.has(l)?new _u(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},_u.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},_u.prototype.eachChild=function(){},_u.prototype.outputDefined=function(){return!1},_u.prototype.serialize=function(){return["var",this.name]};var Gu=function(i,s,l,v,x){s===void 0&&(s=[]),v===void 0&&(v=new si),x===void 0&&(x=[]),this.registry=i,this.path=s,this.key=s.map(function(C){return"["+C+"]"}).join(""),this.scope=v,this.errors=x,this.expectedType=l};function xu(i,s){for(var l,v=i.length-1,x=0,C=v,T=0;x<=C;)if((l=i[T=Math.floor((x+C)/2)])<=s){if(T===v||s<i[T+1])return T;x=T+1}else{if(!(l>s))throw new Lo("Input is not a number.");C=T-1}return 0}Gu.prototype.parse=function(i,s,l,v,x){return x===void 0&&(x={}),s?this.concat(s,l,v)._parse(i,x):this._parse(i,x)},Gu.prototype._parse=function(i,s){function l(X,$,ne){return ne==="assert"?new Ea($,[X]):ne==="coerce"?new fo($,[X]):X}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var v=i[0];if(typeof v!="string")return this.error("Expression name must be a string, but found "+typeof v+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[v];if(x){var C=x.parse(i,this);if(!C)return null;if(this.expectedType){var T=this.expectedType,R=C.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(T,R))return null}else C=l(C,T,s.typeAnnotation||"coerce");else C=l(C,T,s.typeAnnotation||"assert")}if(!(C instanceof Ra)&&C.type.kind!=="resolvedImage"&&function X($){if($ instanceof _u)return X($.boundExpression);if($ instanceof Fo&&$.name==="error"||$ instanceof vs||$ instanceof oo)return!1;var ne=$ instanceof fo||$ instanceof Ea,me=!0;return $.eachChild(function(Ae){me=ne?me&&X(Ae):me&&Ae instanceof Ra}),!!me&&Ls($)&&uu($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(C)){var U=new ja;try{C=new Ra(C.type,C.evaluate(U))}catch(X){return this.error(X.message),null}}return C}return this.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof i+" instead.")},Gu.prototype.concat=function(i,s,l){var v=typeof i=="number"?this.path.concat(i):this.path,x=l?this.scope.concat(l):this.scope;return new Gu(this.registry,v,s||null,x,this.errors)},Gu.prototype.error=function(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var v=""+this.key+s.map(function(x){return"["+x+"]"}).join("");this.errors.push(new Hr(v,i))},Gu.prototype.checkSubtype=function(i,s){var l=Ii(i,s);return l&&this.error(l),l};var Oo=function(i,s,l){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(var v=0,x=l;v<x.length;v+=1){var C=x[v],T=C[1];this.labels.push(C[0]),this.outputs.push(T)}};function fa(i,s,l){return i*(1-l)+s*l}Oo.parse=function(i,s){if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(i[1],1,ar);if(!l)return null;var v=[],x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(var C=1;C<i.length;C+=2){var T=C===1?-1/0:i[C],R=i[C+1],U=C,X=C+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(v.length&&v[v.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);var $=s.parse(R,X,x);if(!$)return null;x=x||$.type,v.push([T,$])}return new Oo(x,l,v)},Oo.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var v=this.input.evaluate(i);if(v<=s[0])return l[0].evaluate(i);var x=s.length;return v>=s[x-1]?l[x-1].evaluate(i):l[xu(s,v)].evaluate(i)},Oo.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},Oo.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Oo.prototype.serialize=function(){for(var i=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i};var Cs=Object.freeze({__proto__:null,number:fa,color:function(i,s,l){return new Dr(fa(i.r,s.r,l),fa(i.g,s.g,l),fa(i.b,s.b,l),fa(i.a,s.a,l))},array:function(i,s,l){return i.map(function(v,x){return fa(v,s[x],l)})}}),Ch=6/29*3*(6/29),el=Math.PI/180,mf=180/Math.PI;function qf(i){return i>.008856451679035631?Math.pow(i,1/3):i/Ch+4/29}function yl(i){return i>6/29?i*i*i:Ch*(i-4/29)}function wc(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function _l(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function gf(i){var s=_l(i.r),l=_l(i.g),v=_l(i.b),x=qf((.4124564*s+.3575761*l+.1804375*v)/.95047),C=qf((.2126729*s+.7151522*l+.072175*v)/1);return{l:116*C-16,a:500*(x-C),b:200*(C-qf((.0193339*s+.119192*l+.9503041*v)/1.08883)),alpha:i.a}}function E(i){var s=(i.l+16)/116,l=isNaN(i.a)?s:s+i.a/500,v=isNaN(i.b)?s:s-i.b/200;return s=1*yl(s),l=.95047*yl(l),v=1.08883*yl(v),new Dr(wc(3.2404542*l-1.5371385*s-.4985314*v),wc(-.969266*l+1.8760108*s+.041556*v),wc(.0556434*l-.2040259*s+1.0572252*v),i.alpha)}function k(i,s,l){var v=s-i;return i+l*(v>180||v<-180?v-360*Math.round(v/360):v)}var H={forward:gf,reverse:E,interpolate:function(i,s,l){return{l:fa(i.l,s.l,l),a:fa(i.a,s.a,l),b:fa(i.b,s.b,l),alpha:fa(i.alpha,s.alpha,l)}}},F={forward:function(i){var s=gf(i),l=s.l,v=s.a,x=s.b,C=Math.atan2(x,v)*mf;return{h:C<0?C+360:C,c:Math.sqrt(v*v+x*x),l,alpha:i.a}},reverse:function(i){var s=i.h*el,l=i.c;return E({l:i.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:i.alpha})},interpolate:function(i,s,l){return{h:k(i.h,s.h,l),c:fa(i.c,s.c,l),l:fa(i.l,s.l,l),alpha:fa(i.alpha,s.alpha,l)}}},le=Object.freeze({__proto__:null,lab:H,hcl:F}),Ue=function(i,s,l,v,x){this.type=i,this.operator=s,this.interpolation=l,this.input=v,this.labels=[],this.outputs=[];for(var C=0,T=x;C<T.length;C+=1){var R=T[C],U=R[1];this.labels.push(R[0]),this.outputs.push(U)}};function yt(i,s,l,v){var x=v-l,C=i-l;return x===0?0:s===1?C/x:(Math.pow(s,C)-1)/(Math.pow(s,x)-1)}Ue.interpolationFactor=function(i,s,l,v){var x=0;if(i.name==="exponential")x=yt(s,i.base,l,v);else if(i.name==="linear")x=yt(s,1,l,v);else if(i.name==="cubic-bezier"){var C=i.controlPoints;x=new K(C[0],C[1],C[2],C[3]).solve(yt(s,1,l,v))}return x},Ue.parse=function(i,s){var l=i[0],v=i[1],x=i[2],C=i.slice(3);if(!Array.isArray(v)||v.length===0)return s.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){var T=v[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:T}}else{if(v[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(v[0]),1,0);var R=v.slice(1);if(R.length!==4||R.some(function(_t){return typeof _t!="number"||_t<0||_t>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:R}}if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(x=s.parse(x,2,ar)))return null;var U=[],X=null;l==="interpolate-hcl"||l==="interpolate-lab"?X=gn:s.expectedType&&s.expectedType.kind!=="value"&&(X=s.expectedType);for(var $=0;$<C.length;$+=2){var ne=C[$],me=C[$+1],Ae=$+3,Qe=$+4;if(typeof ne!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ae);if(U.length&&U[U.length-1][0]>=ne)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ae);var et=s.parse(me,Qe,X);if(!et)return null;X=X||et.type,U.push([ne,et])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new Ue(X,l,v,x,U):s.error("Type "+aa(X)+" is not interpolatable.")},Ue.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var v=this.input.evaluate(i);if(v<=s[0])return l[0].evaluate(i);var x=s.length;if(v>=s[x-1])return l[x-1].evaluate(i);var C=xu(s,v),T=Ue.interpolationFactor(this.interpolation,v,s[C],s[C+1]),R=l[C].evaluate(i),U=l[C+1].evaluate(i);return this.operator==="interpolate"?Cs[this.type.kind.toLowerCase()](R,U,T):this.operator==="interpolate-hcl"?F.reverse(F.interpolate(F.forward(R),F.forward(U),T)):H.reverse(H.interpolate(H.forward(R),H.forward(U),T))},Ue.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},Ue.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Ue.prototype.serialize=function(){var i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,i,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var Ot=function(i,s){this.type=i,this.args=s};Ot.parse=function(i,s){if(i.length<2)return s.error("Expectected at least one argument.");var l=null,v=s.expectedType;v&&v.kind!=="value"&&(l=v);for(var x=[],C=0,T=i.slice(1);C<T.length;C+=1){var R=s.parse(T[C],1+x.length,l,void 0,{typeAnnotation:"omit"});if(!R)return null;l=l||R.type,x.push(R)}var U=v&&x.some(function(X){return Ii(v,X.type)});return new Ot(U?Vn:l,x)},Ot.prototype.evaluate=function(i){for(var s,l=null,v=0,x=0,C=this.args;x<C.length&&(v++,(l=C[x].evaluate(i))&&l instanceof ao&&!l.available&&(s||(s=l.name),l=null,v===this.args.length&&(l=s)),l===null);x+=1);return l},Ot.prototype.eachChild=function(i){this.args.forEach(i)},Ot.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Ot.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(s){i.push(s.serialize())}),i};var Nt=function(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s};Nt.prototype.evaluate=function(i){return this.result.evaluate(i)},Nt.prototype.eachChild=function(i){for(var s=0,l=this.bindings;s<l.length;s+=1)i(l[s][1]);i(this.result)},Nt.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var l=[],v=1;v<i.length-1;v+=2){var x=i[v];if(typeof x!="string")return s.error("Expected string, but found "+typeof x+" instead.",v);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",v);var C=s.parse(i[v+1],v+1);if(!C)return null;l.push([x,C])}var T=s.parse(i[i.length-1],i.length-1,s.expectedType,l);return T?new Nt(l,T):null},Nt.prototype.outputDefined=function(){return this.result.outputDefined()},Nt.prototype.serialize=function(){for(var i=["let"],s=0,l=this.bindings;s<l.length;s+=1){var v=l[s];i.push(v[0],v[1].serialize())}return i.push(this.result.serialize()),i};var Br=function(i,s,l){this.type=i,this.index=s,this.input=l};Br.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,ar),v=s.parse(i[2],2,da(s.expectedType||Vn));return l&&v?new Br(v.type.itemType,l,v):null},Br.prototype.evaluate=function(i){var s=this.index.evaluate(i),l=this.input.evaluate(i);if(s<0)throw new Lo("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Lo("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Lo("Array index must be an integer, but found "+s+" instead.");return l[s]},Br.prototype.eachChild=function(i){i(this.index),i(this.input)},Br.prototype.outputDefined=function(){return!1},Br.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Xr=function(i,s){this.type=Pr,this.needle=i,this.haystack=s};Xr.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Vn),v=s.parse(i[2],2,Vn);return l&&v?_o(l.type,[Pr,Yn,ar,Mn,Vn])?new Xr(l,v):s.error("Expected first argument to be of type boolean, string, number or null, but found "+aa(l.type)+" instead"):null},Xr.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!l)return!1;if(!Na(s,["boolean","string","number","null"]))throw new Lo("Expected first argument to be of type boolean, string, number or null, but found "+aa(Bi(s))+" instead.");if(!Na(l,["string","array"]))throw new Lo("Expected second argument to be of type array or string, but found "+aa(Bi(l))+" instead.");return l.indexOf(s)>=0},Xr.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},Xr.prototype.outputDefined=function(){return!0},Xr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Jn=function(i,s,l){this.type=ar,this.needle=i,this.haystack=s,this.fromIndex=l};Jn.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Vn),v=s.parse(i[2],2,Vn);if(!l||!v)return null;if(!_o(l.type,[Pr,Yn,ar,Mn,Vn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+aa(l.type)+" instead");if(i.length===4){var x=s.parse(i[3],3,ar);return x?new Jn(l,v,x):null}return new Jn(l,v)},Jn.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!Na(s,["boolean","string","number","null"]))throw new Lo("Expected first argument to be of type boolean, string, number or null, but found "+aa(Bi(s))+" instead.");if(!Na(l,["string","array"]))throw new Lo("Expected second argument to be of type array or string, but found "+aa(Bi(l))+" instead.");if(this.fromIndex){var v=this.fromIndex.evaluate(i);return l.indexOf(s,v)}return l.indexOf(s)},Jn.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},Jn.prototype.outputDefined=function(){return!1},Jn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ki=function(i,s,l,v,x,C){this.inputType=i,this.type=s,this.input=l,this.cases=v,this.outputs=x,this.otherwise=C};Ki.parse=function(i,s){if(i.length<5)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!=1)return s.error("Expected an even number of arguments.");var l,v;s.expectedType&&s.expectedType.kind!=="value"&&(v=s.expectedType);for(var x={},C=[],T=2;T<i.length-1;T+=2){var R=i[T],U=i[T+1];Array.isArray(R)||(R=[R]);var X=s.concat(T);if(R.length===0)return X.error("Expected at least one branch label.");for(var $=0,ne=R;$<ne.length;$+=1){var me=ne[$];if(typeof me!="number"&&typeof me!="string")return X.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof me=="number"&&Math.floor(me)!==me)return X.error("Numeric branch labels must be integer values.");if(l){if(X.checkSubtype(l,Bi(me)))return null}else l=Bi(me);if(x[String(me)]!==void 0)return X.error("Branch labels must be unique.");x[String(me)]=C.length}var Ae=s.parse(U,T,v);if(!Ae)return null;v=v||Ae.type,C.push(Ae)}var Qe=s.parse(i[1],1,Vn);if(!Qe)return null;var et=s.parse(i[i.length-1],i.length-1,v);return et?Qe.type.kind!=="value"&&s.concat(1).checkSubtype(l,Qe.type)?null:new Ki(l,v,Qe,x,C,et):null},Ki.prototype.evaluate=function(i){var s=this.input.evaluate(i);return(Bi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)},Ki.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},Ki.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},Ki.prototype.serialize=function(){for(var i=this,s=["match",this.input.serialize()],l=[],v={},x=0,C=Object.keys(this.cases).sort();x<C.length;x+=1){var T=C[x];(ne=v[this.cases[T]])===void 0?(v[this.cases[T]]=l.length,l.push([this.cases[T],[T]])):l[ne][1].push(T)}for(var R=function(Ae){return i.inputType.kind==="number"?Number(Ae):Ae},U=0,X=l;U<X.length;U+=1){var $=X[U],ne=$[0],me=$[1];s.push(me.length===1?R(me[0]):me.map(R)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var ji=function(i,s,l){this.type=i,this.branches=s,this.otherwise=l};ji.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var v=[],x=1;x<i.length-1;x+=2){var C=s.parse(i[x],x,Pr);if(!C)return null;var T=s.parse(i[x+1],x+1,l);if(!T)return null;v.push([C,T]),l=l||T.type}var R=s.parse(i[i.length-1],i.length-1,l);return R?new ji(l,v,R):null},ji.prototype.evaluate=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var v=l[s],x=v[1];if(v[0].evaluate(i))return x.evaluate(i)}return this.otherwise.evaluate(i)},ji.prototype.eachChild=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var v=l[s],x=v[1];i(v[0]),i(x)}i(this.otherwise)},ji.prototype.outputDefined=function(){return this.branches.every(function(i){return i[1].outputDefined()})&&this.otherwise.outputDefined()},ji.prototype.serialize=function(){var i=["case"];return this.eachChild(function(s){i.push(s.serialize())}),i};var ha=function(i,s,l,v){this.type=i,this.input=s,this.beginIndex=l,this.endIndex=v};function Ka(i,s){return i==="=="||i==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function xo(i,s,l,v){return v.compare(s,l)===0}function Ta(i,s,l){var v=i!=="=="&&i!=="!=";return function(){function x(C,T,R){this.type=Pr,this.lhs=C,this.rhs=T,this.collator=R,this.hasUntypedArgument=C.type.kind==="value"||T.type.kind==="value"}return x.parse=function(C,T){if(C.length!==3&&C.length!==4)return T.error("Expected two or three arguments.");var R=C[0],U=T.parse(C[1],1,Vn);if(!U)return null;if(!Ka(R,U.type))return T.concat(1).error('"'+R+`" comparisons are not supported for type '`+aa(U.type)+"'.");var X=T.parse(C[2],2,Vn);if(!X)return null;if(!Ka(R,X.type))return T.concat(2).error('"'+R+`" comparisons are not supported for type '`+aa(X.type)+"'.");if(U.type.kind!==X.type.kind&&U.type.kind!=="value"&&X.type.kind!=="value")return T.error("Cannot compare types '"+aa(U.type)+"' and '"+aa(X.type)+"'.");v&&(U.type.kind==="value"&&X.type.kind!=="value"?U=new Ea(X.type,[U]):U.type.kind!=="value"&&X.type.kind==="value"&&(X=new Ea(U.type,[X])));var $=null;if(C.length===4){if(U.type.kind!=="string"&&X.type.kind!=="string"&&U.type.kind!=="value"&&X.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(C[3],3,na)))return null}return new x(U,X,$)},x.prototype.evaluate=function(C){var T=this.lhs.evaluate(C),R=this.rhs.evaluate(C);if(v&&this.hasUntypedArgument){var U=Bi(T),X=Bi(R);if(U.kind!==X.kind||U.kind!=="string"&&U.kind!=="number")throw new Lo('Expected arguments for "'+i+'" to be (string, string) or (number, number), but found ('+U.kind+", "+X.kind+") instead.")}if(this.collator&&!v&&this.hasUntypedArgument){var $=Bi(T),ne=Bi(R);if($.kind!=="string"||ne.kind!=="string")return s(C,T,R)}return this.collator?l(C,T,R,this.collator.evaluate(C)):s(C,T,R)},x.prototype.eachChild=function(C){C(this.lhs),C(this.rhs),this.collator&&C(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var C=[i];return this.eachChild(function(T){C.push(T.serialize())}),C},x}()}ha.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Vn),v=s.parse(i[2],2,ar);if(!l||!v)return null;if(!_o(l.type,[da(Vn),Yn,Vn]))return s.error("Expected first argument to be of type array or string, but found "+aa(l.type)+" instead");if(i.length===4){var x=s.parse(i[3],3,ar);return x?new ha(l.type,l,v,x):null}return new ha(l.type,l,v)},ha.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=this.beginIndex.evaluate(i);if(!Na(s,["string","array"]))throw new Lo("Expected first argument to be of type array or string, but found "+aa(Bi(s))+" instead.");if(this.endIndex){var v=this.endIndex.evaluate(i);return s.slice(l,v)}return s.slice(l)},ha.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Hs=Ta("==",function(i,s,l){return s===l},xo),Bl=Ta("!=",function(i,s,l){return s!==l},function(i,s,l,v){return!xo(0,s,l,v)}),Kc=Ta("<",function(i,s,l){return s<l},function(i,s,l,v){return v.compare(s,l)<0}),Qc=Ta(">",function(i,s,l){return s>l},function(i,s,l,v){return v.compare(s,l)>0}),Tc=Ta("<=",function(i,s,l){return s<=l},function(i,s,l,v){return v.compare(s,l)<=0}),Mc=Ta(">=",function(i,s,l){return s>=l},function(i,s,l,v){return v.compare(s,l)>=0}),Pu=function(i,s,l,v,x){this.type=Yn,this.number=i,this.locale=s,this.currency=l,this.minFractionDigits=v,this.maxFractionDigits=x};Pu.parse=function(i,s){if(i.length!==3)return s.error("Expected two arguments.");var l=s.parse(i[1],1,ar);if(!l)return null;var v=i[2];if(typeof v!="object"||Array.isArray(v))return s.error("NumberFormat options argument must be an object.");var x=null;if(v.locale&&!(x=s.parse(v.locale,1,Yn)))return null;var C=null;if(v.currency&&!(C=s.parse(v.currency,1,Yn)))return null;var T=null;if(v["min-fraction-digits"]&&!(T=s.parse(v["min-fraction-digits"],1,ar)))return null;var R=null;return v["max-fraction-digits"]&&!(R=s.parse(v["max-fraction-digits"],1,ar))?null:new Pu(l,x,C,T,R)},Pu.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},Pu.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},Pu.prototype.outputDefined=function(){return!1},Pu.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var Nl=function(i){this.type=ar,this.input=i};Nl.parse=function(i,s){if(i.length!==2)return s.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+aa(l.type)+" instead."):new Nl(l):null},Nl.prototype.evaluate=function(i){var s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Lo("Expected value to be of type string or array, but found "+aa(Bi(s))+" instead.")},Nl.prototype.eachChild=function(i){i(this.input)},Nl.prototype.outputDefined=function(){return!1},Nl.prototype.serialize=function(){var i=["length"];return this.eachChild(function(s){i.push(s.serialize())}),i};var xl={"==":Hs,"!=":Bl,">":Qc,"<":Kc,">=":Mc,"<=":Tc,array:Ea,at:Br,boolean:Ea,case:ji,coalesce:Ot,collator:vs,format:Ps,image:ks,in:Xr,"index-of":Jn,interpolate:Ue,"interpolate-hcl":Ue,"interpolate-lab":Ue,length:Nl,let:Nt,literal:Ra,match:Ki,number:Ea,"number-format":Pu,object:Ea,slice:ha,step:Oo,string:Ea,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:_u,within:oo};function Ho(i,s){var l=s[0],v=s[1],x=s[2],C=s[3];l=l.evaluate(i),v=v.evaluate(i),x=x.evaluate(i);var T=C?C.evaluate(i):1,R=yu(l,v,x,T);if(R)throw new Lo(R);return new Dr(l/255*T,v/255*T,x/255*T,T)}function Sh(i,s){return i in s}function Ah(i,s){var l=s[i];return l===void 0?null:l}function bu(i){return{type:i}}function Xh(i){return{result:"success",value:i}}function zl(i){return{result:"error",value:i}}function tl(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ul(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function bl(i){return!!i.expression&&i.expression.interpolated}function lo(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function rl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function $f(i){return i}function Hu(i,s,l){return i!==void 0?i:s!==void 0?s:l!==void 0?l:void 0}function yp(i,s,l,v,x){return Hu(typeof l===x?v[l]:void 0,i.default,s.default)}function Qd(i,s,l){if(lo(l)!=="number")return Hu(i.default,s.default);var v=i.stops.length;if(v===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[v-1][0])return i.stops[v-1][1];var x=xu(i.stops.map(function(C){return C[0]}),l);return i.stops[x][1]}function jp(i,s,l){var v=i.base!==void 0?i.base:1;if(lo(l)!=="number")return Hu(i.default,s.default);var x=i.stops.length;if(x===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[x-1][0])return i.stops[x-1][1];var C=xu(i.stops.map(function(ne){return ne[0]}),l),T=function(ne,me,Ae,Qe){var et=Qe-Ae,_t=ne-Ae;return et===0?0:me===1?_t/et:(Math.pow(me,_t)-1)/(Math.pow(me,et)-1)}(l,v,i.stops[C][0],i.stops[C+1][0]),R=i.stops[C][1],U=i.stops[C+1][1],X=Cs[s.type]||$f;if(i.colorSpace&&i.colorSpace!=="rgb"){var $=le[i.colorSpace];X=function(ne,me){return $.reverse($.interpolate($.forward(ne),$.forward(me),T))}}return typeof R.evaluate=="function"?{evaluate:function(){for(var ne=[],me=arguments.length;me--;)ne[me]=arguments[me];var Ae=R.evaluate.apply(void 0,ne),Qe=U.evaluate.apply(void 0,ne);if(Ae!==void 0&&Qe!==void 0)return X(Ae,Qe,T)}}:X(R,U,T)}function wh(i,s,l){return s.type==="color"?l=Dr.parse(l):s.type==="formatted"?l=At.fromString(l.toString()):s.type==="resolvedImage"?l=ao.fromString(l.toString()):lo(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),Hu(l,i.default,s.default)}Fo.register(xl,{error:[{kind:"error"},[Yn],function(i,s){throw new Lo(s[0].evaluate(i))}],typeof:[Yn,[Vn],function(i,s){return aa(Bi(s[0].evaluate(i)))}],"to-rgba":[da(ar,4),[gn],function(i,s){return s[0].evaluate(i).toArray()}],rgb:[gn,[ar,ar,ar],Ho],rgba:[gn,[ar,ar,ar,ar],Ho],has:{type:Pr,overloads:[[[Yn],function(i,s){return Sh(s[0].evaluate(i),i.properties())}],[[Yn,ea],function(i,s){var l=s[1];return Sh(s[0].evaluate(i),l.evaluate(i))}]]},get:{type:Vn,overloads:[[[Yn],function(i,s){return Ah(s[0].evaluate(i),i.properties())}],[[Yn,ea],function(i,s){var l=s[1];return Ah(s[0].evaluate(i),l.evaluate(i))}]]},"feature-state":[Vn,[Yn],function(i,s){return Ah(s[0].evaluate(i),i.featureState||{})}],properties:[ea,[],function(i){return i.properties()}],"geometry-type":[Yn,[],function(i){return i.geometryType()}],id:[Vn,[],function(i){return i.id()}],zoom:[ar,[],function(i){return i.globals.zoom}],"heatmap-density":[ar,[],function(i){return i.globals.heatmapDensity||0}],"line-progress":[ar,[],function(i){return i.globals.lineProgress||0}],accumulated:[Vn,[],function(i){return i.globals.accumulated===void 0?null:i.globals.accumulated}],"+":[ar,bu(ar),function(i,s){for(var l=0,v=0,x=s;v<x.length;v+=1)l+=x[v].evaluate(i);return l}],"*":[ar,bu(ar),function(i,s){for(var l=1,v=0,x=s;v<x.length;v+=1)l*=x[v].evaluate(i);return l}],"-":{type:ar,overloads:[[[ar,ar],function(i,s){var l=s[1];return s[0].evaluate(i)-l.evaluate(i)}],[[ar],function(i,s){return-s[0].evaluate(i)}]]},"/":[ar,[ar,ar],function(i,s){var l=s[1];return s[0].evaluate(i)/l.evaluate(i)}],"%":[ar,[ar,ar],function(i,s){var l=s[1];return s[0].evaluate(i)%l.evaluate(i)}],ln2:[ar,[],function(){return Math.LN2}],pi:[ar,[],function(){return Math.PI}],e:[ar,[],function(){return Math.E}],"^":[ar,[ar,ar],function(i,s){var l=s[1];return Math.pow(s[0].evaluate(i),l.evaluate(i))}],sqrt:[ar,[ar],function(i,s){return Math.sqrt(s[0].evaluate(i))}],log10:[ar,[ar],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN10}],ln:[ar,[ar],function(i,s){return Math.log(s[0].evaluate(i))}],log2:[ar,[ar],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN2}],sin:[ar,[ar],function(i,s){return Math.sin(s[0].evaluate(i))}],cos:[ar,[ar],function(i,s){return Math.cos(s[0].evaluate(i))}],tan:[ar,[ar],function(i,s){return Math.tan(s[0].evaluate(i))}],asin:[ar,[ar],function(i,s){return Math.asin(s[0].evaluate(i))}],acos:[ar,[ar],function(i,s){return Math.acos(s[0].evaluate(i))}],atan:[ar,[ar],function(i,s){return Math.atan(s[0].evaluate(i))}],min:[ar,bu(ar),function(i,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(i)}))}],max:[ar,bu(ar),function(i,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(i)}))}],abs:[ar,[ar],function(i,s){return Math.abs(s[0].evaluate(i))}],round:[ar,[ar],function(i,s){var l=s[0].evaluate(i);return l<0?-Math.round(-l):Math.round(l)}],floor:[ar,[ar],function(i,s){return Math.floor(s[0].evaluate(i))}],ceil:[ar,[ar],function(i,s){return Math.ceil(s[0].evaluate(i))}],"filter-==":[Pr,[Yn,Vn],function(i,s){var l=s[0],v=s[1];return i.properties()[l.value]===v.value}],"filter-id-==":[Pr,[Vn],function(i,s){var l=s[0];return i.id()===l.value}],"filter-type-==":[Pr,[Yn],function(i,s){var l=s[0];return i.geometryType()===l.value}],"filter-<":[Pr,[Yn,Vn],function(i,s){var l=s[0],v=s[1],x=i.properties()[l.value],C=v.value;return typeof x==typeof C&&x<C}],"filter-id-<":[Pr,[Vn],function(i,s){var l=s[0],v=i.id(),x=l.value;return typeof v==typeof x&&v<x}],"filter->":[Pr,[Yn,Vn],function(i,s){var l=s[0],v=s[1],x=i.properties()[l.value],C=v.value;return typeof x==typeof C&&x>C}],"filter-id->":[Pr,[Vn],function(i,s){var l=s[0],v=i.id(),x=l.value;return typeof v==typeof x&&v>x}],"filter-<=":[Pr,[Yn,Vn],function(i,s){var l=s[0],v=s[1],x=i.properties()[l.value],C=v.value;return typeof x==typeof C&&x<=C}],"filter-id-<=":[Pr,[Vn],function(i,s){var l=s[0],v=i.id(),x=l.value;return typeof v==typeof x&&v<=x}],"filter->=":[Pr,[Yn,Vn],function(i,s){var l=s[0],v=s[1],x=i.properties()[l.value],C=v.value;return typeof x==typeof C&&x>=C}],"filter-id->=":[Pr,[Vn],function(i,s){var l=s[0],v=i.id(),x=l.value;return typeof v==typeof x&&v>=x}],"filter-has":[Pr,[Vn],function(i,s){return s[0].value in i.properties()}],"filter-has-id":[Pr,[],function(i){return i.id()!==null&&i.id()!==void 0}],"filter-type-in":[Pr,[da(Yn)],function(i,s){return s[0].value.indexOf(i.geometryType())>=0}],"filter-id-in":[Pr,[da(Vn)],function(i,s){return s[0].value.indexOf(i.id())>=0}],"filter-in-small":[Pr,[Yn,da(Vn)],function(i,s){var l=s[0];return s[1].value.indexOf(i.properties()[l.value])>=0}],"filter-in-large":[Pr,[Yn,da(Vn)],function(i,s){var l=s[0],v=s[1];return function(x,C,T,R){for(;T<=R;){var U=T+R>>1;if(C[U]===x)return!0;C[U]>x?R=U-1:T=U+1}return!1}(i.properties()[l.value],v.value,0,v.value.length-1)}],all:{type:Pr,overloads:[[[Pr,Pr],function(i,s){var l=s[1];return s[0].evaluate(i)&&l.evaluate(i)}],[bu(Pr),function(i,s){for(var l=0,v=s;l<v.length;l+=1)if(!v[l].evaluate(i))return!1;return!0}]]},any:{type:Pr,overloads:[[[Pr,Pr],function(i,s){var l=s[1];return s[0].evaluate(i)||l.evaluate(i)}],[bu(Pr),function(i,s){for(var l=0,v=s;l<v.length;l+=1)if(v[l].evaluate(i))return!0;return!1}]]},"!":[Pr,[Pr],function(i,s){return!s[0].evaluate(i)}],"is-supported-script":[Pr,[Yn],function(i,s){var l=i.globals&&i.globals.isSupportedScript;return!l||l(s[0].evaluate(i))}],upcase:[Yn,[Yn],function(i,s){return s[0].evaluate(i).toUpperCase()}],downcase:[Yn,[Yn],function(i,s){return s[0].evaluate(i).toLowerCase()}],concat:[Yn,bu(Vn),function(i,s){return s.map(function(l){return gl(l.evaluate(i))}).join("")}],"resolved-locale":[Yn,[na],function(i,s){return s[0].evaluate(i).resolvedLocale()}]});var yf=function(i,s){this.expression=i,this._warningHistory={},this._evaluator=new ja,this._defaultValue=s?function(l){return l.type==="color"&&rl(l.default)?new Dr(0,0,0,0):l.type==="color"?Dr.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function _f(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in xl}function Ic(i,s){var l=new Gu(xl,[],s?function(x){var C={color:gn,string:Yn,number:ar,enum:Yn,boolean:Pr,formatted:Ht,resolvedImage:Rt};return x.type==="array"?da(C[x.value]||Vn,x.length):C[x.type]}(s):void 0),v=l.parse(i,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Xh(new yf(v,s)):zl(l.errors)}yf.prototype.evaluateWithoutErrorHandling=function(i,s,l,v,x,C){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=v,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)},yf.prototype.evaluate=function(i,s,l,v,x,C){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=v,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Lo("Expected value to be one of "+Object.keys(this._enumValues).map(function(R){return JSON.stringify(R)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console!="undefined"&&console.warn(R.message)),this._defaultValue}};var xf=function(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent=i!=="constant"&&!Qs(s.expression)};xf.prototype.evaluateWithoutErrorHandling=function(i,s,l,v,x,C){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,v,x,C)},xf.prototype.evaluate=function(i,s,l,v,x,C){return this._styleExpression.evaluate(i,s,l,v,x,C)};var ec=function(i,s,l,v){this.kind=i,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!Qs(s.expression),this.interpolationType=v};function bf(i,s){if((i=Ic(i,s)).result==="error")return i;var l=i.value.expression,v=Ls(l);if(!v&&!tl(s))return zl([new Hr("","data expressions not supported")]);var x=uu(l,["zoom"]);if(!x&&!Ul(s))return zl([new Hr("","zoom expressions not supported")]);var C=function T(R){var U=null;if(R instanceof Nt)U=T(R.result);else if(R instanceof Ot)for(var X=0,$=R.args;X<$.length&&!(U=T($[X]));X+=1);else(R instanceof Oo||R instanceof Ue)&&R.input instanceof Fo&&R.input.name==="zoom"&&(U=R);return U instanceof Hr||R.eachChild(function(ne){var me=T(ne);me instanceof Hr?U=me:!U&&me?U=new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):U&&me&&U!==me&&(U=new Hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),U}(l);return C||x?C instanceof Hr?zl([C]):C instanceof Ue&&!bl(s)?zl([new Hr("",'"interpolate" expressions cannot be used with this property')]):Xh(C?new ec(v?"camera":"composite",i.value,C.labels,C instanceof Ue?C.interpolation:void 0):new xf(v?"constant":"source",i.value)):zl([new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ec.prototype.evaluateWithoutErrorHandling=function(i,s,l,v,x,C){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,v,x,C)},ec.prototype.evaluate=function(i,s,l,v,x,C){return this._styleExpression.evaluate(i,s,l,v,x,C)},ec.prototype.interpolationFactor=function(i,s,l){return this.interpolationType?Ue.interpolationFactor(this.interpolationType,i,s,l):0};var tc=function(i,s){this._parameters=i,this._specification=s,jr(this,function l(v,x){var C,T,R,U=x.type==="color",X=v.stops&&typeof v.stops[0][0]=="object",$=X||!(X||v.property!==void 0),ne=v.type||(bl(x)?"exponential":"interval");if(U&&((v=jr({},v)).stops&&(v.stops=v.stops.map(function(ti){return[ti[0],Dr.parse(ti[1])]})),v.default=Dr.parse(v.default?v.default:x.default)),v.colorSpace&&v.colorSpace!=="rgb"&&!le[v.colorSpace])throw new Error("Unknown color space: "+v.colorSpace);if(ne==="exponential")C=jp;else if(ne==="interval")C=Qd;else if(ne==="categorical"){C=yp,T=Object.create(null);for(var me=0,Ae=v.stops;me<Ae.length;me+=1){var Qe=Ae[me];T[Qe[0]]=Qe[1]}R=typeof v.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');C=wh}if(X){for(var et={},_t=[],ft=0;ft<v.stops.length;ft++){var zt=v.stops[ft],tr=zt[0].zoom;et[tr]===void 0&&(et[tr]={zoom:tr,type:v.type,property:v.property,default:v.default,stops:[]},_t.push(tr)),et[tr].stops.push([zt[0].value,zt[1]])}for(var xr=[],br=0,Zr=_t;br<Zr.length;br+=1){var pn=Zr[br];xr.push([et[pn].zoom,l(et[pn],x)])}var Un={name:"linear"};return{kind:"composite",interpolationType:Un,interpolationFactor:Ue.interpolationFactor.bind(void 0,Un),zoomStops:xr.map(function(ti){return ti[0]}),evaluate:function(ti,Pi){var Xn=ti.zoom;return jp({stops:xr,base:v.base},x,Xn).evaluate(Xn,Pi)}}}if($){var Ai=ne==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:Ai,interpolationFactor:Ue.interpolationFactor.bind(void 0,Ai),zoomStops:v.stops.map(function(ti){return ti[0]}),evaluate:function(ti){return C(v,x,ti.zoom,T,R)}}}return{kind:"source",evaluate:function(ti,Pi){var Xn=Pi&&Pi.properties?Pi.properties[v.property]:void 0;return Xn===void 0?Hu(v.default,x.default):C(v,x,Xn,T,R)}}}(this._parameters,this._specification))};function lu(i){var s=i.key,l=i.value,v=i.valueSpec||{},x=i.objectElementValidators||{},C=i.style,T=i.styleSpec,R=[],U=lo(l);if(U!=="object")return[new it(s,l,"object expected, "+U+" found")];for(var X in l){var $=X.split(".")[0],ne=v[$]||v["*"],me=void 0;if(x[$])me=x[$];else if(v[$])me=Aa;else if(x["*"])me=x["*"];else{if(!v["*"]){R.push(new it(s,l[X],'unknown property "'+X+'"'));continue}me=Aa}R=R.concat(me({key:(s&&s+".")+X,value:l[X],valueSpec:ne,style:C,styleSpec:T,object:l,objectKey:X},l))}for(var Ae in v)x[Ae]||v[Ae].required&&v[Ae].default===void 0&&l[Ae]===void 0&&R.push(new it(s,l,'missing required property "'+Ae+'"'));return R}function Kf(i){var s=i.value,l=i.valueSpec,v=i.style,x=i.styleSpec,C=i.key,T=i.arrayElementValidator||Aa;if(lo(s)!=="array")return[new it(C,s,"array expected, "+lo(s)+" found")];if(l.length&&s.length!==l.length)return[new it(C,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new it(C,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var R={type:l.value,values:l.values};x.$version<7&&(R.function=l.function),lo(l.value)==="object"&&(R=l.value);for(var U=[],X=0;X<s.length;X++)U=U.concat(T({array:s,arrayIndex:X,value:s[X],valueSpec:R,style:v,styleSpec:x,key:C+"["+X+"]"}));return U}function rc(i){var s=i.key,l=i.value,v=i.valueSpec,x=lo(l);return x==="number"&&l!=l&&(x="NaN"),x!=="number"?[new it(s,l,"number expected, "+x+" found")]:"minimum"in v&&l<v.minimum?[new it(s,l,l+" is less than the minimum value "+v.minimum)]:"maximum"in v&&l>v.maximum?[new it(s,l,l+" is greater than the maximum value "+v.maximum)]:[]}function Yh(i){var s,l,v,x=i.valueSpec,C=or(i.value.type),T={},R=C!=="categorical"&&i.value.property===void 0,U=!R,X=lo(i.value.stops)==="array"&&lo(i.value.stops[0])==="array"&&lo(i.value.stops[0][0])==="object",$=lu({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Ae){if(C==="identity")return[new it(Ae.key,Ae.value,'identity function may not have a "stops" property')];var Qe=[],et=Ae.value;return Qe=Qe.concat(Kf({key:Ae.key,value:et,valueSpec:Ae.valueSpec,style:Ae.style,styleSpec:Ae.styleSpec,arrayElementValidator:ne})),lo(et)==="array"&&et.length===0&&Qe.push(new it(Ae.key,et,"array must have at least one stop")),Qe},default:function(Ae){return Aa({key:Ae.key,value:Ae.value,valueSpec:x,style:Ae.style,styleSpec:Ae.styleSpec})}}});return C==="identity"&&R&&$.push(new it(i.key,i.value,'missing required property "property"')),C==="identity"||i.value.stops||$.push(new it(i.key,i.value,'missing required property "stops"')),C==="exponential"&&i.valueSpec.expression&&!bl(i.valueSpec)&&$.push(new it(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(U&&!tl(i.valueSpec)?$.push(new it(i.key,i.value,"property functions not supported")):R&&!Ul(i.valueSpec)&&$.push(new it(i.key,i.value,"zoom functions not supported"))),C!=="categorical"&&!X||i.value.property!==void 0||$.push(new it(i.key,i.value,'"property" property is required')),$;function ne(Ae){var Qe=[],et=Ae.value,_t=Ae.key;if(lo(et)!=="array")return[new it(_t,et,"array expected, "+lo(et)+" found")];if(et.length!==2)return[new it(_t,et,"array length 2 expected, length "+et.length+" found")];if(X){if(lo(et[0])!=="object")return[new it(_t,et,"object expected, "+lo(et[0])+" found")];if(et[0].zoom===void 0)return[new it(_t,et,"object stop key must have zoom")];if(et[0].value===void 0)return[new it(_t,et,"object stop key must have value")];if(v&&v>or(et[0].zoom))return[new it(_t,et[0].zoom,"stop zoom values must appear in ascending order")];or(et[0].zoom)!==v&&(v=or(et[0].zoom),l=void 0,T={}),Qe=Qe.concat(lu({key:_t+"[0]",value:et[0],valueSpec:{zoom:{}},style:Ae.style,styleSpec:Ae.styleSpec,objectElementValidators:{zoom:rc,value:me}}))}else Qe=Qe.concat(me({key:_t+"[0]",value:et[0],valueSpec:{},style:Ae.style,styleSpec:Ae.styleSpec},et));return _f(mr(et[1]))?Qe.concat([new it(_t+"[1]",et[1],"expressions are not allowed in function stops.")]):Qe.concat(Aa({key:_t+"[1]",value:et[1],valueSpec:x,style:Ae.style,styleSpec:Ae.styleSpec}))}function me(Ae,Qe){var et=lo(Ae.value),_t=or(Ae.value),ft=Ae.value!==null?Ae.value:Qe;if(s){if(et!==s)return[new it(Ae.key,ft,et+" stop domain type must match previous stop domain type "+s)]}else s=et;if(et!=="number"&&et!=="string"&&et!=="boolean")return[new it(Ae.key,ft,"stop domain value must be a number, string, or boolean")];if(et!=="number"&&C!=="categorical"){var zt="number expected, "+et+" found";return tl(x)&&C===void 0&&(zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(Ae.key,ft,zt)]}return C!=="categorical"||et!=="number"||isFinite(_t)&&Math.floor(_t)===_t?C!=="categorical"&&et==="number"&&l!==void 0&&_t<l?[new it(Ae.key,ft,"stop domain values must appear in ascending order")]:(l=_t,C==="categorical"&&_t in T?[new it(Ae.key,ft,"stop domain values must be unique")]:(T[_t]=!0,[])):[new it(Ae.key,ft,"integer expected, found "+_t)]}}function Pc(i){var s=(i.expressionContext==="property"?bf:Ic)(mr(i.value),i.valueSpec);if(s.result==="error")return s.value.map(function(v){return new it(""+i.key+v.key,i.value,v.message)});var l=s.value.expression||s.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!l.outputDefined())return[new it(i.key,i.value,'Invalid data expression for "'+i.propertyKey+'". Output values must be contained as literals within the expression.')];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Qs(l))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Qs(l))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!uu(l,["zoom","feature-state"]))return[new it(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ls(l))return[new it(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nc(i){var s=i.key,l=i.value,v=i.valueSpec,x=[];return Array.isArray(v.values)?v.values.indexOf(or(l))===-1&&x.push(new it(s,l,"expected one of ["+v.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(v.values).indexOf(or(l))===-1&&x.push(new it(s,l,"expected one of ["+Object.keys(v.values).join(", ")+"], "+JSON.stringify(l)+" found")),x}function nl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(var s=0,l=i.slice(1);s<l.length;s+=1){var v=l[s];if(!nl(v)&&typeof v!="boolean")return!1}return!0;default:return!0}}tc.deserialize=function(i){return new tc(i._parameters,i._specification)},tc.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};var Ef={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kc(i){if(i==null)return{filter:function(){return!0},needGeometry:!1};nl(i)||(i=Cf(i));var s=Ic(i,Ef);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,v,x){return s.value.evaluate(l,v,{},x)},needGeometry:function l(v){if(!Array.isArray(v))return!1;if(v[0]==="within")return!0;for(var x=1;x<v.length;x++)if(l(v[x]))return!0;return!1}(i)}}function _p(i,s){return i<s?-1:i>s?1:0}function Cf(i){if(!i)return!0;var s,l=i[0];return i.length<=1?l!=="any":l==="=="?ic(i[1],i[2],"=="):l==="!="?Af(ic(i[1],i[2],"==")):l==="<"||l===">"||l==="<="||l===">="?ic(i[1],i[2],l):l==="any"?(s=i.slice(1),["any"].concat(s.map(Cf))):l==="all"?["all"].concat(i.slice(1).map(Cf)):l==="none"?["all"].concat(i.slice(1).map(Cf).map(Af)):l==="in"?qh(i[1],i.slice(2)):l==="!in"?Af(qh(i[1],i.slice(2))):l==="has"?Sf(i[1]):l==="!has"?Af(Sf(i[1])):l!=="within"||i}function ic(i,s,l){switch(i){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,i,s]}}function qh(i,s){if(s.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",i,["literal",s.sort(_p)]]:["filter-in-small",i,["literal",s]]}}function Sf(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Af(i){return["!",i]}function Gp(i){return nl(mr(i.value))?Pc(jr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var v=l.value,x=l.key;if(lo(v)!=="array")return[new it(x,v,"array expected, "+lo(v)+" found")];var C,T=l.styleSpec,R=[];if(v.length<1)return[new it(x,v,"filter array must have at least 1 element")];switch(R=R.concat(nc({key:x+"[0]",value:v[0],valueSpec:T.filter_operator,style:l.style,styleSpec:l.styleSpec})),or(v[0])){case"<":case"<=":case">":case">=":v.length>=2&&or(v[1])==="$type"&&R.push(new it(x,v,'"$type" cannot be use with operator "'+v[0]+'"'));case"==":case"!=":v.length!==3&&R.push(new it(x,v,'filter array for operator "'+v[0]+'" must have 3 elements'));case"in":case"!in":v.length>=2&&(C=lo(v[1]))!=="string"&&R.push(new it(x+"[1]",v[1],"string expected, "+C+" found"));for(var U=2;U<v.length;U++)C=lo(v[U]),or(v[1])==="$type"?R=R.concat(nc({key:x+"["+U+"]",value:v[U],valueSpec:T.geometry_type,style:l.style,styleSpec:l.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&R.push(new it(x+"["+U+"]",v[U],"string, number, or boolean expected, "+C+" found"));break;case"any":case"all":case"none":for(var X=1;X<v.length;X++)R=R.concat(s({key:x+"["+X+"]",value:v[X],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":C=lo(v[1]),v.length!==2?R.push(new it(x,v,'filter array for "'+v[0]+'" operator must have 2 elements')):C!=="string"&&R.push(new it(x+"[1]",v[1],"string expected, "+C+" found"));break;case"within":C=lo(v[1]),v.length!==2?R.push(new it(x,v,'filter array for "'+v[0]+'" operator must have 2 elements')):C!=="object"&&R.push(new it(x+"[1]",v[1],"object expected, "+C+" found"))}return R}(i)}function Hp(i,s){var l=i.key,v=i.style,x=i.styleSpec,C=i.value,T=i.objectKey,R=x[s+"_"+i.layerType];if(!R)return[];var U=T.match(/^(.*)-transition$/);if(s==="paint"&&U&&R[U[1]]&&R[U[1]].transition)return Aa({key:l,value:C,valueSpec:x.transition,style:v,styleSpec:x});var X,$=i.valueSpec||R[T];if(!$)return[new it(l,C,'unknown property "'+T+'"')];if(lo(C)==="string"&&tl($)&&!$.tokens&&(X=/^{([^}]+)}$/.exec(C)))return[new it(l,C,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var ne=[];return i.layerType==="symbol"&&(T==="text-field"&&v&&!v.glyphs&&ne.push(new it(l,C,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&rl(mr(C))&&or(C.type)==="identity"&&ne.push(new it(l,C,'"text-font" does not support identity functions'))),ne.concat(Aa({key:i.key,value:C,valueSpec:$,style:v,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function Th(i){return Hp(i,"paint")}function Jc(i){return Hp(i,"layout")}function Eu(i){var s=[],l=i.value,v=i.key,x=i.style,C=i.styleSpec;l.type||l.ref||s.push(new it(v,l,'either "type" or "ref" is required'));var T,R=or(l.type),U=or(l.ref);if(l.id)for(var X=or(l.id),$=0;$<i.arrayIndex;$++){var ne=x.layers[$];or(ne.id)===X&&s.push(new it(v,l.id,'duplicate layer id "'+l.id+'", previously used at line '+ne.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(Qe){Qe in l&&s.push(new it(v,l[Qe],'"'+Qe+'" is prohibited for ref layers'))}),x.layers.forEach(function(Qe){or(Qe.id)===U&&(T=Qe)}),T?T.ref?s.push(new it(v,l.ref,"ref cannot reference another ref layer")):R=or(T.type):s.push(new it(v,l.ref,'ref layer "'+U+'" not found'));else if(R!=="background")if(l.source){var me=x.sources&&x.sources[l.source],Ae=me&&or(me.type);me?Ae==="vector"&&R==="raster"?s.push(new it(v,l.source,'layer "'+l.id+'" requires a raster source')):Ae==="raster"&&R!=="raster"?s.push(new it(v,l.source,'layer "'+l.id+'" requires a vector source')):Ae!=="vector"||l["source-layer"]?Ae==="raster-dem"&&R!=="hillshade"?s.push(new it(v,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!l.paint||!l.paint["line-gradient"]||Ae==="geojson"&&me.lineMetrics||s.push(new it(v,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new it(v,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new it(v,l.source,'source "'+l.source+'" not found'))}else s.push(new it(v,l,'missing required property "source"'));return s=s.concat(lu({key:v,value:l,valueSpec:C.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Aa({key:v+".type",value:l.type,valueSpec:C.layer.type,style:i.style,styleSpec:i.styleSpec,object:l,objectKey:"type"})},filter:Gp,layout:function(Qe){return lu({layer:l,key:Qe.key,value:Qe.value,style:Qe.style,styleSpec:Qe.styleSpec,objectElementValidators:{"*":function(et){return Jc(jr({layerType:R},et))}}})},paint:function(Qe){return lu({layer:l,key:Qe.key,value:Qe.value,style:Qe.style,styleSpec:Qe.styleSpec,objectElementValidators:{"*":function(et){return Th(jr({layerType:R},et))}}})}}}))}function ef(i){var s=i.value,l=i.key,v=lo(s);return v!=="string"?[new it(l,s,"string expected, "+v+" found")]:[]}var Ui={promoteId:function(i){var s=i.key,l=i.value;if(lo(l)==="string")return ef({key:s,value:l});var v=[];for(var x in l)v.push.apply(v,ef({key:s+"."+x,value:l[x]}));return v}};function wf(i){var s=i.value,l=i.key,v=i.styleSpec,x=i.style;if(!s.type)return[new it(l,s,'"type" is required')];var C,T=or(s.type);switch(T){case"vector":case"raster":case"raster-dem":return lu({key:l,value:s,valueSpec:v["source_"+T.replace("-","_")],style:i.style,styleSpec:v,objectElementValidators:Ui});case"geojson":if(C=lu({key:l,value:s,valueSpec:v.source_geojson,style:x,styleSpec:v,objectElementValidators:Ui}),s.cluster)for(var R in s.clusterProperties){var U=s.clusterProperties[R],X=U[0],$=typeof X=="string"?[X,["accumulated"],["get",R]]:X;C.push.apply(C,Pc({key:l+"."+R+".map",value:U[1],expressionContext:"cluster-map"})),C.push.apply(C,Pc({key:l+"."+R+".reduce",value:$,expressionContext:"cluster-reduce"}))}return C;case"video":return lu({key:l,value:s,valueSpec:v.source_video,style:x,styleSpec:v});case"image":return lu({key:l,value:s,valueSpec:v.source_image,style:x,styleSpec:v});case"canvas":return[new it(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nc({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:v})}}function Tf(i){var s=i.value,l=i.styleSpec,v=l.light,x=i.style,C=[],T=lo(s);if(s===void 0)return C;if(T!=="object")return C.concat([new it("light",s,"object expected, "+T+" found")]);for(var R in s){var U=R.match(/^(.*)-transition$/);C=C.concat(U&&v[U[1]]&&v[U[1]].transition?Aa({key:R,value:s[R],valueSpec:l.transition,style:x,styleSpec:l}):v[R]?Aa({key:R,value:s[R],valueSpec:v[R],style:x,styleSpec:l}):[new it(R,s[R],'unknown property "'+R+'"')])}return C}var El={"*":function(){return[]},array:Kf,boolean:function(i){var s=i.value,l=i.key,v=lo(s);return v!=="boolean"?[new it(l,s,"boolean expected, "+v+" found")]:[]},number:rc,color:function(i){var s=i.key,l=i.value,v=lo(l);return v!=="string"?[new it(s,l,"color expected, "+v+" found")]:Or(l)===null?[new it(s,l,'color expected, "'+l+'" found')]:[]},constants:Yt,enum:nc,filter:Gp,function:Yh,layer:Eu,object:lu,source:wf,light:Tf,string:ef,formatted:function(i){return ef(i).length===0?[]:Pc(i)},resolvedImage:function(i){return ef(i).length===0?[]:Pc(i)}};function Aa(i){var s=i.value,l=i.valueSpec,v=i.styleSpec;return l.expression&&rl(or(s))?Yh(i):l.expression&&_f(mr(s))?Pc(i):l.type&&El[l.type]?El[l.type](i):lu(jr({},i,{valueSpec:l.type?v[l.type]:l}))}function bo(i){var s=i.value,l=i.key,v=ef(i);return v.length||(s.indexOf("{fontstack}")===-1&&v.push(new it(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&v.push(new it(l,s,'"glyphs" url must include a "{range}" token'))),v}function cu(i,s){s===void 0&&(s=ke);var l=[];return l=l.concat(Aa({key:"",value:i,valueSpec:s.$root,styleSpec:s,style:i,objectElementValidators:{glyphs:bo,"*":function(){return[]}}})),i.constants&&(l=l.concat(Yt({key:"constants",value:i.constants,style:i,styleSpec:s}))),Mo(l)}function Mo(i){return[].concat(i).sort(function(s,l){return s.line-l.line})}function ku(i){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return Mo(i.apply(this,s))}}cu.source=ku(wf),cu.light=ku(Tf),cu.layer=ku(Eu),cu.filter=ku(Gp),cu.paintProperty=ku(Th),cu.layoutProperty=ku(Jc);var Zl=cu,fu=Zl.light,Wp=Zl.paintProperty,Qf=Zl.layoutProperty;function Mf(i,s){var l=!1;if(s&&s.length)for(var v=0,x=s;v<x.length;v+=1)i.fire(new ct(new Error(x[v].message))),l=!0;return l}var Vl=ms;function ms(i,s,l){var v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(s=x[1])+2*(l=x[2]);for(var C=0;C<this.d*this.d;C++){var T=x[3+C],R=x[3+C+1];v.push(T===R?null:x.subarray(T,R))}var U=x[3+v.length+1];this.keys=x.subarray(x[3+v.length],U),this.bboxes=x.subarray(U),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var X=0;X<this.d*this.d;X++)v.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=l,this.scale=s/i,this.uid=0;var $=l/s*i;this.min=-$,this.max=i+$}ms.prototype.insert=function(i,s,l,v,x){this._forEachCell(s,l,v,x,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(v),this.bboxes.push(x)},ms.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ms.prototype._insertCell=function(i,s,l,v,x,C){this.cells[x].push(C)},ms.prototype.query=function(i,s,l,v,x){var C=this.min,T=this.max;if(i<=C&&s<=C&&T<=l&&T<=v&&!x)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(i,s,l,v,this._queryCell,R,{},x),R},ms.prototype._queryCell=function(i,s,l,v,x,C,T,R){var U=this.cells[x];if(U!==null)for(var X=this.keys,$=this.bboxes,ne=0;ne<U.length;ne++){var me=U[ne];if(T[me]===void 0){var Ae=4*me;(R?R($[Ae+0],$[Ae+1],$[Ae+2],$[Ae+3]):i<=$[Ae+2]&&s<=$[Ae+3]&&l>=$[Ae+0]&&v>=$[Ae+1])?(T[me]=!0,C.push(X[me])):T[me]=!1}}},ms.prototype._forEachCell=function(i,s,l,v,x,C,T,R){for(var U=this._convertToCellCoord(i),X=this._convertToCellCoord(s),$=this._convertToCellCoord(l),ne=this._convertToCellCoord(v),me=U;me<=$;me++)for(var Ae=X;Ae<=ne;Ae++){var Qe=this.d*Ae+me;if((!R||R(this._convertFromCellCoord(me),this._convertFromCellCoord(Ae),this._convertFromCellCoord(me+1),this._convertFromCellCoord(Ae+1)))&&x.call(this,i,s,l,v,Qe,C,T,R))return}},ms.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ms.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ms.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=3+this.cells.length+1+1,l=0,v=0;v<this.cells.length;v++)l+=this.cells[v].length;var x=new Int32Array(s+l+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var C=s,T=0;T<i.length;T++){var R=i[T];x[3+T]=C,x.set(R,C),C+=R.length}return x[3+i.length]=C,x.set(this.keys,C),x[3+i.length+1]=C+=this.keys.length,x.set(this.bboxes,C),C+=this.bboxes.length,x.buffer};var il=se.ImageData,Jf=se.ImageBitmap,Wo={};function ni(i,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),Wo[i]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var va in ni("Object",Object),Vl.serialize=function(i,s){var l=i.toArrayBuffer();return s&&s.push(l),{buffer:l}},Vl.deserialize=function(i){return new Vl(i.buffer)},ni("Grid",Vl),ni("Color",Dr),ni("Error",Error),ni("ResolvedImage",ao),ni("StylePropertyFunction",tc),ni("StyleExpression",yf,{omit:["_evaluator"]}),ni("ZoomDependentExpression",ec),ni("ZoomConstantExpression",xf),ni("CompoundExpression",Fo,{omit:["_evaluate"]}),xl)xl[va]._classRegistryKey||ni("Expression_"+va,xl[va]);function Lc(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function If(i){return Jf&&i instanceof Jf}function Lu(i,s){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Lc(i)||If(i))return s&&s.push(i),i;if(ArrayBuffer.isView(i)){var l=i;return s&&s.push(l.buffer),l}if(i instanceof il)return s&&s.push(i.data.buffer),i;if(Array.isArray(i)){for(var v=[],x=0,C=i;x<C.length;x+=1)v.push(Lu(C[x],s));return v}if(typeof i=="object"){var T=i.constructor,R=T._classRegistryKey;if(!R)throw new Error("can't serialize object of unregistered class");var U=T.serialize?T.serialize(i,s):{};if(!T.serialize){for(var X in i)if(i.hasOwnProperty(X)&&!(Wo[R].omit.indexOf(X)>=0)){var $=i[X];U[X]=Wo[R].shallow.indexOf(X)>=0?$:Lu($,s)}i instanceof Error&&(U.message=i.message)}if(U.$name)throw new Error("$name property is reserved for worker serialization logic.");return R!=="Object"&&(U.$name=R),U}throw new Error("can't serialize object of type "+typeof i)}function Ou(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Lc(i)||If(i)||ArrayBuffer.isView(i)||i instanceof il)return i;if(Array.isArray(i))return i.map(Ou);if(typeof i=="object"){var s=i.$name||"Object",l=Wo[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(i);for(var v=Object.create(l.prototype),x=0,C=Object.keys(i);x<C.length;x+=1){var T=C[x];if(T!=="$name"){var R=i[T];v[T]=Wo[s].shallow.indexOf(T)>=0?R:Ou(R)}}return v}throw new Error("can't deserialize object of type "+typeof i)}var Oc=function(){this.first=!0};Oc.prototype.update=function(i,s){var l=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=l,!0))};var In={"Latin-1 Supplement":function(i){return i>=128&&i<=255},Arabic:function(i){return i>=1536&&i<=1791},"Arabic Supplement":function(i){return i>=1872&&i<=1919},"Arabic Extended-A":function(i){return i>=2208&&i<=2303},"Hangul Jamo":function(i){return i>=4352&&i<=4607},"Unified Canadian Aboriginal Syllabics":function(i){return i>=5120&&i<=5759},Khmer:function(i){return i>=6016&&i<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(i){return i>=6320&&i<=6399},"General Punctuation":function(i){return i>=8192&&i<=8303},"Letterlike Symbols":function(i){return i>=8448&&i<=8527},"Number Forms":function(i){return i>=8528&&i<=8591},"Miscellaneous Technical":function(i){return i>=8960&&i<=9215},"Control Pictures":function(i){return i>=9216&&i<=9279},"Optical Character Recognition":function(i){return i>=9280&&i<=9311},"Enclosed Alphanumerics":function(i){return i>=9312&&i<=9471},"Geometric Shapes":function(i){return i>=9632&&i<=9727},"Miscellaneous Symbols":function(i){return i>=9728&&i<=9983},"Miscellaneous Symbols and Arrows":function(i){return i>=11008&&i<=11263},"CJK Radicals Supplement":function(i){return i>=11904&&i<=12031},"Kangxi Radicals":function(i){return i>=12032&&i<=12255},"Ideographic Description Characters":function(i){return i>=12272&&i<=12287},"CJK Symbols and Punctuation":function(i){return i>=12288&&i<=12351},Hiragana:function(i){return i>=12352&&i<=12447},Katakana:function(i){return i>=12448&&i<=12543},Bopomofo:function(i){return i>=12544&&i<=12591},"Hangul Compatibility Jamo":function(i){return i>=12592&&i<=12687},Kanbun:function(i){return i>=12688&&i<=12703},"Bopomofo Extended":function(i){return i>=12704&&i<=12735},"CJK Strokes":function(i){return i>=12736&&i<=12783},"Katakana Phonetic Extensions":function(i){return i>=12784&&i<=12799},"Enclosed CJK Letters and Months":function(i){return i>=12800&&i<=13055},"CJK Compatibility":function(i){return i>=13056&&i<=13311},"CJK Unified Ideographs Extension A":function(i){return i>=13312&&i<=19903},"Yijing Hexagram Symbols":function(i){return i>=19904&&i<=19967},"CJK Unified Ideographs":function(i){return i>=19968&&i<=40959},"Yi Syllables":function(i){return i>=40960&&i<=42127},"Yi Radicals":function(i){return i>=42128&&i<=42191},"Hangul Jamo Extended-A":function(i){return i>=43360&&i<=43391},"Hangul Syllables":function(i){return i>=44032&&i<=55215},"Hangul Jamo Extended-B":function(i){return i>=55216&&i<=55295},"Private Use Area":function(i){return i>=57344&&i<=63743},"CJK Compatibility Ideographs":function(i){return i>=63744&&i<=64255},"Arabic Presentation Forms-A":function(i){return i>=64336&&i<=65023},"Vertical Forms":function(i){return i>=65040&&i<=65055},"CJK Compatibility Forms":function(i){return i>=65072&&i<=65103},"Small Form Variants":function(i){return i>=65104&&i<=65135},"Arabic Presentation Forms-B":function(i){return i>=65136&&i<=65279},"Halfwidth and Fullwidth Forms":function(i){return i>=65280&&i<=65519}};function Rc(i){for(var s=0,l=i;s<l.length;s+=1)if(Mh(l[s].charCodeAt(0)))return!0;return!1}function Mh(i){return!(i!==746&&i!==747&&(i<4352||!(In["Bopomofo Extended"](i)||In.Bopomofo(i)||In["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||In["CJK Compatibility Ideographs"](i)||In["CJK Compatibility"](i)||In["CJK Radicals Supplement"](i)||In["CJK Strokes"](i)||!(!In["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||In["CJK Unified Ideographs Extension A"](i)||In["CJK Unified Ideographs"](i)||In["Enclosed CJK Letters and Months"](i)||In["Hangul Compatibility Jamo"](i)||In["Hangul Jamo Extended-A"](i)||In["Hangul Jamo Extended-B"](i)||In["Hangul Jamo"](i)||In["Hangul Syllables"](i)||In.Hiragana(i)||In["Ideographic Description Characters"](i)||In.Kanbun(i)||In["Kangxi Radicals"](i)||In["Katakana Phonetic Extensions"](i)||In.Katakana(i)&&i!==12540||!(!In["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!In["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||In["Unified Canadian Aboriginal Syllabics"](i)||In["Unified Canadian Aboriginal Syllabics Extended"](i)||In["Vertical Forms"](i)||In["Yijing Hexagram Symbols"](i)||In["Yi Syllables"](i)||In["Yi Radicals"](i))))}function xa(i){return!(Mh(i)||function(s){return!!(In["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||In["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||In["Letterlike Symbols"](s)||In["Number Forms"](s)||In["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||In["Control Pictures"](s)&&s!==9251||In["Optical Character Recognition"](s)||In["Enclosed Alphanumerics"](s)||In["Geometric Shapes"](s)||In["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||In["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||In["CJK Symbols and Punctuation"](s)||In.Katakana(s)||In["Private Use Area"](s)||In["CJK Compatibility Forms"](s)||In["Small Form Variants"](s)||In["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(i))}function ho(i){return i>=1424&&i<=2303||In["Arabic Presentation Forms-A"](i)||In["Arabic Presentation Forms-B"](i)}function hu(i,s){return!(!s&&ho(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||In.Khmer(i))}function Ih(i){for(var s=0,l=i;s<l.length;s+=1)if(ho(l[s].charCodeAt(0)))return!0;return!1}var al=null,Js="unavailable",jl=null,di=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Js="error"),al&&al(i)};function eh(){xp.fire(new qe("pluginStateChange",{pluginStatus:Js,pluginURL:jl}))}var xp=new St,bp=function(){return Js},ol=function(){if(Js!=="deferred"||!jl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Js="loading",eh(),jl&&Ci({url:jl},function(i){i?di(i):(Js="loaded",eh())})},Ws={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Js==="loaded"||Ws.applyArabicShaping!=null},isLoading:function(){return Js==="loading"},setState:function(i){Js=i.pluginStatus,jl=i.pluginURL},isParsed:function(){return Ws.applyArabicShaping!=null&&Ws.processBidirectionalText!=null&&Ws.processStyledBidirectionalText!=null},getPluginURL:function(){return jl}},ua=function(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Oc,this.transition={})};ua.prototype.isSupportedScript=function(i){return function(s,l){for(var v=0,x=s;v<x.length;v+=1)if(!hu(x[v].charCodeAt(0),l))return!1;return!0}(i,Ws.isLoaded())},ua.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ua.prototype.getCrossfadeParameters=function(){var i=this.zoom,s=i-Math.floor(i),l=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var Cl=function(i,s){this.property=i,this.value=s,this.expression=function(l,v){if(rl(l))return new tc(l,v);if(_f(l)){var x=bf(l,v);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var C=l;return typeof l=="string"&&v.type==="color"&&(C=Dr.parse(l)),{kind:"constant",evaluate:function(){return C}}}(s===void 0?i.specification.default:s,i.specification)};Cl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Cl.prototype.possiblyEvaluate=function(i,s,l){return this.property.possiblyEvaluate(this,i,s,l)};var pu=function(i){this.property=i,this.value=new Cl(i,void 0)};pu.prototype.transitioned=function(i,s){return new Pf(this.property,this.value,s,Ut({},i.transition,this.transition),i.now)},pu.prototype.untransitioned=function(){return new Pf(this.property,this.value,null,{},0)};var Ss=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};Ss.prototype.getValue=function(i){return xt(this._values[i].value.value)},Ss.prototype.setValue=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new pu(this._values[i].property)),this._values[i].value=new Cl(this._values[i].property,s===null?void 0:xt(s))},Ss.prototype.getTransition=function(i){return xt(this._values[i].transition)},Ss.prototype.setTransition=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new pu(this._values[i].property)),this._values[i].transition=xt(s)||void 0},Ss.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s],x=this.getValue(v);x!==void 0&&(i[v]=x);var C=this.getTransition(v);C!==void 0&&(i[v+"-transition"]=C)}return i},Ss.prototype.transitioned=function(i,s){for(var l=new Gl(this._properties),v=0,x=Object.keys(this._values);v<x.length;v+=1){var C=x[v];l._values[C]=this._values[C].transitioned(i,s._values[C])}return l},Ss.prototype.untransitioned=function(){for(var i=new Gl(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s];i._values[v]=this._values[v].untransitioned()}return i};var Pf=function(i,s,l,v,x){this.property=i,this.value=s,this.begin=x+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=l)};Pf.prototype.possiblyEvaluate=function(i,s,l){var v=i.now||0,x=this.value.possiblyEvaluate(i,s,l),C=this.prior;if(C){if(v>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(v<this.begin)return C.possiblyEvaluate(i,s,l);var T=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(i,s,l),x,function(R){if(R<=0)return 0;if(R>=1)return 1;var U=R*R,X=U*R;return 4*(R<.5?X:3*(R-U)+X-.75)}(T))}return x};var Gl=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Gl.prototype.possiblyEvaluate=function(i,s,l){for(var v=new ul(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];v._values[T]=this._values[T].possiblyEvaluate(i,s,l)}return v},Gl.prototype.hasTransition=function(){for(var i=0,s=Object.keys(this._values);i<s.length;i+=1)if(this._values[s[i]].prior)return!0;return!1};var sl=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};sl.prototype.getValue=function(i){return xt(this._values[i].value)},sl.prototype.setValue=function(i,s){this._values[i]=new Cl(this._values[i].property,s===null?void 0:xt(s))},sl.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var v=l[s],x=this.getValue(v);x!==void 0&&(i[v]=x)}return i},sl.prototype.possiblyEvaluate=function(i,s,l){for(var v=new ul(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];v._values[T]=this._values[T].possiblyEvaluate(i,s,l)}return v};var du=function(i,s,l){this.property=i,this.value=s,this.parameters=l};du.prototype.isConstant=function(){return this.value.kind==="constant"},du.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},du.prototype.evaluate=function(i,s,l,v){return this.property.evaluate(this.value,this.parameters,i,s,l,v)};var ul=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};ul.prototype.get=function(i){return this._values[i]};var _i=function(i){this.specification=i};_i.prototype.possiblyEvaluate=function(i,s){return i.expression.evaluate(s)},_i.prototype.interpolate=function(i,s,l){var v=Cs[this.specification.type];return v?v(i,s,l):i};var pi=function(i,s){this.specification=i,this.overrides=s};pi.prototype.possiblyEvaluate=function(i,s,l,v){return new du(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},l,v)}:i.expression,s)},pi.prototype.interpolate=function(i,s,l){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new du(this,{kind:"constant",value:void 0},i.parameters);var v=Cs[this.specification.type];return v?new du(this,{kind:"constant",value:v(i.value.value,s.value.value,l)},i.parameters):i},pi.prototype.evaluate=function(i,s,l,v,x,C){return i.kind==="constant"?i.value:i.evaluate(s,l,v,x,C)};var kf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,v,x,C){if(l.value===void 0)return new du(this,{kind:"constant",value:void 0},v);if(l.expression.kind==="constant"){var T=l.expression.evaluate(v,null,{},x,C),R=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,U=this._calculate(R,R,R,v);return new du(this,{kind:"constant",value:U},v)}if(l.expression.kind==="camera"){var X=this._calculate(l.expression.evaluate({zoom:v.zoom-1}),l.expression.evaluate({zoom:v.zoom}),l.expression.evaluate({zoom:v.zoom+1}),v);return new du(this,{kind:"constant",value:X},v)}return new du(this,l.expression,v)},s.prototype.evaluate=function(l,v,x,C,T,R){if(l.kind==="source"){var U=l.evaluate(v,x,C,T,R);return this._calculate(U,U,U,v)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(v.zoom)-1},x,C),l.evaluate({zoom:Math.floor(v.zoom)},x,C),l.evaluate({zoom:Math.floor(v.zoom)+1},x,C),v):l.value},s.prototype._calculate=function(l,v,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:l,to:v}:{from:x,to:v}},s.prototype.interpolate=function(l){return l},s}(pi),Os=function(i){this.specification=i};Os.prototype.possiblyEvaluate=function(i,s,l,v){if(i.value!==void 0){if(i.expression.kind==="constant"){var x=i.expression.evaluate(s,null,{},l,v);return this._calculate(x,x,x,s)}return this._calculate(i.expression.evaluate(new ua(Math.floor(s.zoom-1),s)),i.expression.evaluate(new ua(Math.floor(s.zoom),s)),i.expression.evaluate(new ua(Math.floor(s.zoom+1),s)),s)}},Os.prototype._calculate=function(i,s,l,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:l,to:s}},Os.prototype.interpolate=function(i){return i};var ll=function(i){this.specification=i};ll.prototype.possiblyEvaluate=function(i,s,l,v){return!!i.expression.evaluate(s,null,{},l,v)},ll.prototype.interpolate=function(){return!1};var Yo=function(i){for(var s in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){var l=i[s];l.specification.overridable&&this.overridableProperties.push(s);var v=this.defaultPropertyValues[s]=new Cl(l,void 0),x=this.defaultTransitionablePropertyValues[s]=new pu(l);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=v.possiblyEvaluate({})}};ni("DataDrivenProperty",pi),ni("DataConstantProperty",_i),ni("CrossFadedDataDrivenProperty",kf),ni("CrossFadedProperty",Os),ni("ColorRampProperty",ll);var Ru=function(i){function s(l,v){if(i.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),v.layout&&(this._unevaluatedLayout=new sl(v.layout)),v.paint)){for(var x in this._transitionablePaint=new Ss(v.paint),l.paint)this.setPaintProperty(x,l.paint[x],{validate:!1});for(var C in l.layout)this.setLayoutProperty(C,l.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ul(v.paint)}}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,v,x){x===void 0&&(x={}),v!=null&&this._validate(Qf,"layers."+this.id+".layout."+l,l,v,x)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,v):this.visibility=v)},s.prototype.getPaintProperty=function(l){return ie(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,v,x){if(x===void 0&&(x={}),v!=null&&this._validate(Wp,"layers."+this.id+".paint."+l,l,v,x))return!1;if(ie(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),v||void 0),!1;var C=this._transitionablePaint._values[l],T=C.property.specification["property-type"]==="cross-faded-data-driven",R=C.value.isDataDriven(),U=C.value;this._transitionablePaint.setValue(l,v),this._handleSpecialPaintPropertyUpdate(l);var X=this._transitionablePaint._values[l].value;return X.isDataDriven()||R||T||this._handleOverridablePaintPropertyUpdate(l,U,X)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,v,x){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,v){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,v)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,v)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Dt(l,function(v,x){return!(v===void 0||x==="layout"&&!Object.keys(v).length||x==="paint"&&!Object.keys(v).length)})},s.prototype._validate=function(l,v,x,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Mf(this,l.call(Zl,{key:v,layerType:this.type,objectKey:x,value:C,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var v=this.paint.get(l);if(v instanceof du&&tl(v.property.specification)&&(v.value.kind==="source"||v.value.kind==="composite")&&v.value.isStateDependent)return!0}return!1},s}(St),Ph={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},th=function(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Qa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function po(i,s){s===void 0&&(s=1);var l=0,v=0;return{members:i.map(function(x){var C=Ph[x.type].BYTES_PER_ELEMENT,T=l=rh(l,Math.max(s,C)),R=x.components||1;return v=Math.max(v,C),l+=C*R,{name:x.name,type:x.type,components:R,offset:T}}),size:rh(l,Math.max(v,s)),alignment:s}}function rh(i,s){return Math.ceil(i/s)*s}Qa.serialize=function(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},Qa.deserialize=function(i){var s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Qa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Qa.prototype.clear=function(){this.length=0},Qa.prototype.resize=function(i){this.reserve(i),this.length=i},Qa.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Qa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var nh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var x=this.length;return this.resize(x+1),this.emplace(x,l,v)},s.prototype.emplace=function(l,v,x){var C=2*l;return this.int16[C+0]=v,this.int16[C+1]=x,l},s}(Qa);nh.prototype.bytesPerElement=4,ni("StructArrayLayout2i4",nh);var Sl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,v,x,C)},s.prototype.emplace=function(l,v,x,C,T){var R=4*l;return this.int16[R+0]=v,this.int16[R+1]=x,this.int16[R+2]=C,this.int16[R+3]=T,l},s}(Qa);Sl.prototype.bytesPerElement=8,ni("StructArrayLayout4i8",Sl);var Al=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R){var U=this.length;return this.resize(U+1),this.emplace(U,l,v,x,C,T,R)},s.prototype.emplace=function(l,v,x,C,T,R,U){var X=6*l;return this.int16[X+0]=v,this.int16[X+1]=x,this.int16[X+2]=C,this.int16[X+3]=T,this.int16[X+4]=R,this.int16[X+5]=U,l},s}(Qa);Al.prototype.bytesPerElement=12,ni("StructArrayLayout2i4i12",Al);var Rs=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R){var U=this.length;return this.resize(U+1),this.emplace(U,l,v,x,C,T,R)},s.prototype.emplace=function(l,v,x,C,T,R,U){var X=4*l,$=8*l;return this.int16[X+0]=v,this.int16[X+1]=x,this.uint8[$+4]=C,this.uint8[$+5]=T,this.uint8[$+6]=R,this.uint8[$+7]=U,l},s}(Qa);Rs.prototype.bytesPerElement=8,ni("StructArrayLayout2i4ub8",Rs);var Ao=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var x=this.length;return this.resize(x+1),this.emplace(x,l,v)},s.prototype.emplace=function(l,v,x){var C=2*l;return this.float32[C+0]=v,this.float32[C+1]=x,l},s}(Qa);Ao.prototype.bytesPerElement=8,ni("StructArrayLayout2f8",Ao);var ac=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R,U,X,$,ne){var me=this.length;return this.resize(me+1),this.emplace(me,l,v,x,C,T,R,U,X,$,ne)},s.prototype.emplace=function(l,v,x,C,T,R,U,X,$,ne,me){var Ae=10*l;return this.uint16[Ae+0]=v,this.uint16[Ae+1]=x,this.uint16[Ae+2]=C,this.uint16[Ae+3]=T,this.uint16[Ae+4]=R,this.uint16[Ae+5]=U,this.uint16[Ae+6]=X,this.uint16[Ae+7]=$,this.uint16[Ae+8]=ne,this.uint16[Ae+9]=me,l},s}(Qa);ac.prototype.bytesPerElement=20,ni("StructArrayLayout10ui20",ac);var $h=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R,U,X,$,ne,me,Ae){var Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,l,v,x,C,T,R,U,X,$,ne,me,Ae)},s.prototype.emplace=function(l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe){var et=12*l;return this.int16[et+0]=v,this.int16[et+1]=x,this.int16[et+2]=C,this.int16[et+3]=T,this.uint16[et+4]=R,this.uint16[et+5]=U,this.uint16[et+6]=X,this.uint16[et+7]=$,this.int16[et+8]=ne,this.int16[et+9]=me,this.int16[et+10]=Ae,this.int16[et+11]=Qe,l},s}(Qa);$h.prototype.bytesPerElement=24,ni("StructArrayLayout4i4ui4i24",$h);var tf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,v,x)},s.prototype.emplace=function(l,v,x,C){var T=3*l;return this.float32[T+0]=v,this.float32[T+1]=x,this.float32[T+2]=C,l},s}(Qa);tf.prototype.bytesPerElement=12,ni("StructArrayLayout3f12",tf);var ih=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.uint32[1*l+0]=v,l},s}(Qa);ih.prototype.bytesPerElement=4,ni("StructArrayLayout1ul4",ih);var Kh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R,U,X,$){var ne=this.length;return this.resize(ne+1),this.emplace(ne,l,v,x,C,T,R,U,X,$)},s.prototype.emplace=function(l,v,x,C,T,R,U,X,$,ne){var me=10*l,Ae=5*l;return this.int16[me+0]=v,this.int16[me+1]=x,this.int16[me+2]=C,this.int16[me+3]=T,this.int16[me+4]=R,this.int16[me+5]=U,this.uint32[Ae+3]=X,this.uint16[me+8]=$,this.uint16[me+9]=ne,l},s}(Qa);Kh.prototype.bytesPerElement=20,ni("StructArrayLayout6i1ul2ui20",Kh);var cl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R){var U=this.length;return this.resize(U+1),this.emplace(U,l,v,x,C,T,R)},s.prototype.emplace=function(l,v,x,C,T,R,U){var X=6*l;return this.int16[X+0]=v,this.int16[X+1]=x,this.int16[X+2]=C,this.int16[X+3]=T,this.int16[X+4]=R,this.int16[X+5]=U,l},s}(Qa);cl.prototype.bytesPerElement=12,ni("StructArrayLayout2i2i2i12",cl);var oc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T){var R=this.length;return this.resize(R+1),this.emplace(R,l,v,x,C,T)},s.prototype.emplace=function(l,v,x,C,T,R){var U=4*l,X=8*l;return this.float32[U+0]=v,this.float32[U+1]=x,this.float32[U+2]=C,this.int16[X+6]=T,this.int16[X+7]=R,l},s}(Qa);oc.prototype.bytesPerElement=16,ni("StructArrayLayout2f1f2i16",oc);var rf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,v,x,C)},s.prototype.emplace=function(l,v,x,C,T){var R=12*l,U=3*l;return this.uint8[R+0]=v,this.uint8[R+1]=x,this.float32[U+1]=C,this.float32[U+2]=T,l},s}(Qa);rf.prototype.bytesPerElement=12,ni("StructArrayLayout2ub2f12",rf);var sc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,v,x)},s.prototype.emplace=function(l,v,x,C){var T=3*l;return this.uint16[T+0]=v,this.uint16[T+1]=x,this.uint16[T+2]=C,l},s}(Qa);sc.prototype.bytesPerElement=6,ni("StructArrayLayout3ui6",sc);var Hl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt){var tr=this.length;return this.resize(tr+1),this.emplace(tr,l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt)},s.prototype.emplace=function(l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt,tr){var xr=24*l,br=12*l,Zr=48*l;return this.int16[xr+0]=v,this.int16[xr+1]=x,this.uint16[xr+2]=C,this.uint16[xr+3]=T,this.uint32[br+2]=R,this.uint32[br+3]=U,this.uint32[br+4]=X,this.uint16[xr+10]=$,this.uint16[xr+11]=ne,this.uint16[xr+12]=me,this.float32[br+7]=Ae,this.float32[br+8]=Qe,this.uint8[Zr+36]=et,this.uint8[Zr+37]=_t,this.uint8[Zr+38]=ft,this.uint32[br+10]=zt,this.int16[xr+22]=tr,l},s}(Qa);Hl.prototype.bytesPerElement=48,ni("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hl);var kh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt,tr,xr,br,Zr,pn,Un,Ai,ti,Pi,Xn,ma){var qi=this.length;return this.resize(qi+1),this.emplace(qi,l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt,tr,xr,br,Zr,pn,Un,Ai,ti,Pi,Xn,ma)},s.prototype.emplace=function(l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et,_t,ft,zt,tr,xr,br,Zr,pn,Un,Ai,ti,Pi,Xn,ma,qi){var gi=34*l,La=17*l;return this.int16[gi+0]=v,this.int16[gi+1]=x,this.int16[gi+2]=C,this.int16[gi+3]=T,this.int16[gi+4]=R,this.int16[gi+5]=U,this.int16[gi+6]=X,this.int16[gi+7]=$,this.uint16[gi+8]=ne,this.uint16[gi+9]=me,this.uint16[gi+10]=Ae,this.uint16[gi+11]=Qe,this.uint16[gi+12]=et,this.uint16[gi+13]=_t,this.uint16[gi+14]=ft,this.uint16[gi+15]=zt,this.uint16[gi+16]=tr,this.uint16[gi+17]=xr,this.uint16[gi+18]=br,this.uint16[gi+19]=Zr,this.uint16[gi+20]=pn,this.uint16[gi+21]=Un,this.uint16[gi+22]=Ai,this.uint32[La+12]=ti,this.float32[La+13]=Pi,this.float32[La+14]=Xn,this.float32[La+15]=ma,this.float32[La+16]=qi,l},s}(Qa);kh.prototype.bytesPerElement=68,ni("StructArrayLayout8i15ui1ul4f68",kh);var uc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.float32[1*l+0]=v,l},s}(Qa);uc.prototype.bytesPerElement=4,ni("StructArrayLayout1f4",uc);var wl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,v,x)},s.prototype.emplace=function(l,v,x,C){var T=3*l;return this.int16[T+0]=v,this.int16[T+1]=x,this.int16[T+2]=C,l},s}(Qa);wl.prototype.bytesPerElement=6,ni("StructArrayLayout3i6",wl);var Lf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,v,x)},s.prototype.emplace=function(l,v,x,C){var T=4*l;return this.uint32[2*l+0]=v,this.uint16[T+2]=x,this.uint16[T+3]=C,l},s}(Qa);Lf.prototype.bytesPerElement=8,ni("StructArrayLayout1ul2ui8",Lf);var Lh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v){var x=this.length;return this.resize(x+1),this.emplace(x,l,v)},s.prototype.emplace=function(l,v,x){var C=2*l;return this.uint16[C+0]=v,this.uint16[C+1]=x,l},s}(Qa);Lh.prototype.bytesPerElement=4,ni("StructArrayLayout2ui4",Lh);var Wu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var v=this.length;return this.resize(v+1),this.emplace(v,l)},s.prototype.emplace=function(l,v){return this.uint16[1*l+0]=v,l},s}(Qa);Wu.prototype.bytesPerElement=2,ni("StructArrayLayout1ui2",Wu);var nf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,v,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,v,x,C)},s.prototype.emplace=function(l,v,x,C,T){var R=4*l;return this.float32[R+0]=v,this.float32[R+1]=x,this.float32[R+2]=C,this.float32[R+3]=T,l},s}(Qa);nf.prototype.bytesPerElement=16,ni("StructArrayLayout4f16",nf);var c=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new ve(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(th);c.prototype.size=20;var p=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new c(this,l)},s}(Kh);ni("CollisionBoxArray",p);var f=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(v){this._structArray.uint8[this._pos1+37]=v},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(v){this._structArray.uint8[this._pos1+38]=v},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(v){this._structArray.uint32[this._pos4+10]=v},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(th);f.prototype.size=48;var g=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(Hl);ni("PlacedSymbolArray",g);var S=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(v){this._structArray.uint32[this._pos4+12]=v},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(th);S.prototype.size=68;var I=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(kh);ni("SymbolInstanceArray",I);var O=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(uc);ni("GlyphOffsetArray",O);var z=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(wl);ni("SymbolLineVertexArray",z);var q=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(th);q.prototype.size=8;var oe=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new q(this,l)},s}(Lf);ni("FeatureIndexArray",oe);var Te=po([{name:"a_pos",components:2,type:"Int16"}],4).members,Pe=function(i){i===void 0&&(i=[]),this.segments=i};function _e(i,s){return 256*(i=Et(Math.floor(i),0,255))+Et(Math.floor(s),0,255)}Pe.prototype.prepareSegment=function(i,s,l,v){var x=this.segments[this.segments.length-1];return i>Pe.MAX_VERTEX_ARRAY_LENGTH&&je("Max vertices per segment is "+Pe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!x||x.vertexLength+i>Pe.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==v)&&(x={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},v!==void 0&&(x.sortKey=v),this.segments.push(x)),x},Pe.prototype.get=function(){return this.segments},Pe.prototype.destroy=function(){for(var i=0,s=this.segments;i<s.length;i+=1){var l=s[i];for(var v in l.vaos)l.vaos[v].destroy()}},Pe.simpleSegment=function(i,s,l,v){return new Pe([{vertexOffset:i,primitiveOffset:s,vertexLength:l,primitiveLength:v,vaos:{},sortKey:0}])},Pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ni("SegmentVector",Pe);var Je=po([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),$e=Fe(function(i){i.exports=function(s,l){var v,x,C,T,R,U,X,$;for(x=s.length-(v=3&s.length),C=l,R=3432918353,U=461845907,$=0;$<x;)X=255&s.charCodeAt($)|(255&s.charCodeAt(++$))<<8|(255&s.charCodeAt(++$))<<16|(255&s.charCodeAt(++$))<<24,++$,C=27492+(65535&(T=5*(65535&(C=(C^=X=(65535&(X=(X=(65535&X)*R+(((X>>>16)*R&65535)<<16)&4294967295)<<15|X>>>17))*U+(((X>>>16)*U&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(X=0,v){case 3:X^=(255&s.charCodeAt($+2))<<16;case 2:X^=(255&s.charCodeAt($+1))<<8;case 1:C^=X=(65535&(X=(X=(65535&(X^=255&s.charCodeAt($)))*R+(((X>>>16)*R&65535)<<16)&4294967295)<<15|X>>>17))*U+(((X>>>16)*U&65535)<<16)&4294967295}return C^=s.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}}),mt=Fe(function(i){i.exports=function(s,l){for(var v,x=s.length,C=l^x,T=0;x>=4;)v=1540483477*(65535&(v=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24))+((1540483477*(v>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:C^=(255&s.charCodeAt(T+2))<<16;case 2:C^=(255&s.charCodeAt(T+1))<<8;case 1:C=1540483477*(65535&(C^=255&s.charCodeAt(T)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}}),Ye=$e,gt=mt;Ye.murmur3=$e,Ye.murmur2=gt;var Pt=function(){this.ids=[],this.positions=[],this.indexed=!1};Pt.prototype.add=function(i,s,l,v){this.ids.push(_r(i)),this.positions.push(s,l,v)},Pt.prototype.getPositions=function(i){for(var s=_r(i),l=0,v=this.ids.length-1;l<v;){var x=l+v>>1;this.ids[x]>=s?v=x:l=x+1}for(var C=[];this.ids[l]===s;)C.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return C},Pt.serialize=function(i,s){var l=new Float64Array(i.ids),v=new Uint32Array(i.positions);return function x(C,T,R,U){for(;R<U;){for(var X=C[R+U>>1],$=R-1,ne=U+1;;){do $++;while(C[$]<X);do ne--;while(C[ne]>X);if($>=ne)break;ir(C,$,ne),ir(T,3*$,3*ne),ir(T,3*$+1,3*ne+1),ir(T,3*$+2,3*ne+2)}ne-R<U-ne?(x(C,T,R,ne),R=ne+1):(x(C,T,ne+1,U),U=ne)}}(l,v,0,l.length-1),s&&s.push(l.buffer,v.buffer),{ids:l,positions:v}},Pt.deserialize=function(i){var s=new Pt;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s};var qt=Math.pow(2,53)-1;function _r(i){var s=+i;return!isNaN(s)&&s<=qt?s:Ye(String(i))}function ir(i,s,l){var v=i[s];i[s]=i[l],i[l]=v}ni("FeaturePositionMap",Pt);var Mr=function(i,s){this.gl=i.gl,this.location=s},Wr=function(i){function s(l,v){i.call(this,l,v),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(Mr),Cn=function(i){function s(l,v){i.call(this,l,v),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(Mr),yn=function(i){function s(l,v){i.call(this,l,v),this.current=[0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(Mr),Hn=function(i){function s(l,v){i.call(this,l,v),this.current=[0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(Mr),xi=function(i){function s(l,v){i.call(this,l,v),this.current=[0,0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(Mr),Si=function(i){function s(l,v){i.call(this,l,v),this.current=Dr.transparent}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(Mr),bi=new Float32Array(16),Ca=function(i){function s(l,v){i.call(this,l,v),this.current=bi}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var v=1;v<16;v++)if(l[v]!==this.current[v]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(Mr);function qn(i){return[_e(255*i.r,255*i.g),_e(255*i.b,255*i.a)]}var Hi=function(i,s,l){this.value=i,this.uniformNames=s.map(function(v){return"u_"+v}),this.type=l};Hi.prototype.setUniform=function(i,s,l){i.set(l.constantOr(this.value))},Hi.prototype.getBinding=function(i,s,l){return this.type==="color"?new Si(i,s):new Cn(i,s)};var Qi=function(i,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Qi.prototype.setConstantPatternPositions=function(i,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=i.tlbr},Qi.prototype.setUniform=function(i,s,l,v){var x=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&i.set(x)},Qi.prototype.getBinding=function(i,s,l){return l.substr(0,9)==="u_pattern"?new xi(i,s):new Cn(i,s)};var Wi=function(i,s,l,v){this.expression=i,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(x){return{name:"a_"+x,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new v};Wi.prototype.populatePaintArray=function(i,s,l,v,x){var C=this.paintVertexArray.length,T=this.expression.evaluate(new ua(0),s,{},v,[],x);this.paintVertexArray.resize(i),this._setPaintValue(C,i,T)},Wi.prototype.updatePaintArray=function(i,s,l,v){var x=this.expression.evaluate({zoom:0},l,v);this._setPaintValue(i,s,x)},Wi.prototype._setPaintValue=function(i,s,l){if(this.type==="color")for(var v=qn(l),x=i;x<s;x++)this.paintVertexArray.emplace(x,v[0],v[1]);else{for(var C=i;C<s;C++)this.paintVertexArray.emplace(C,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},Wi.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Oi=function(i,s,l,v,x,C){this.expression=i,this.uniformNames=s.map(function(T){return"u_"+T+"_t"}),this.type=l,this.useIntegerZoom=v,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(function(T){return{name:"a_"+T,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new C};Oi.prototype.populatePaintArray=function(i,s,l,v,x){var C=this.expression.evaluate(new ua(this.zoom),s,{},v,[],x),T=this.expression.evaluate(new ua(this.zoom+1),s,{},v,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(R,i,C,T)},Oi.prototype.updatePaintArray=function(i,s,l,v){var x=this.expression.evaluate({zoom:this.zoom},l,v),C=this.expression.evaluate({zoom:this.zoom+1},l,v);this._setPaintValue(i,s,x,C)},Oi.prototype._setPaintValue=function(i,s,l,v){if(this.type==="color")for(var x=qn(l),C=qn(v),T=i;T<s;T++)this.paintVertexArray.emplace(T,x[0],x[1],C[0],C[1]);else{for(var R=i;R<s;R++)this.paintVertexArray.emplace(R,l,v);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(v))}},Oi.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Oi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Oi.prototype.setUniform=function(i,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=Et(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);i.set(v)},Oi.prototype.getBinding=function(i,s,l){return new Cn(i,s)};var oa=function(i,s,l,v,x,C){this.expression=i,this.type=s,this.useIntegerZoom=l,this.zoom=v,this.layerId=C,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};oa.prototype.populatePaintArray=function(i,s,l){var v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,s.patterns&&s.patterns[this.layerId],l)},oa.prototype.updatePaintArray=function(i,s,l,v,x){this._setPaintValues(i,s,l.patterns&&l.patterns[this.layerId],x)},oa.prototype._setPaintValues=function(i,s,l,v){if(v&&l){var x=v[l.min],C=v[l.mid],T=v[l.max];if(x&&C&&T)for(var R=i;R<s;R++)this.zoomInPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],C.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio)}},oa.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Je.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Je.members,this.expression.isStateDependent))},oa.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Zi=function(i,s,l){this.binders={},this._buffers=[];var v=[];for(var x in i.paint._values)if(l(x)){var C=i.paint.get(x);if(C instanceof du&&tl(C.property.specification)){var T=ls(x,i.type),R=C.value,U=C.property.specification.type,X=C.property.useIntegerZoom,$=C.property.specification["property-type"],ne=$==="cross-faded"||$==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=ne?new Qi(R.value,T):new Hi(R.value,T,U),v.push("/u_"+x);else if(R.kind==="source"||ne){var me=Xo(x,U,"source");this.binders[x]=ne?new oa(R,U,X,s,me,i.id):new Wi(R,T,U,me),v.push("/a_"+x)}else{var Ae=Xo(x,U,"composite");this.binders[x]=new Oi(R,T,U,X,s,Ae),v.push("/z_"+x)}}}this.cacheKey=v.sort().join("")};Zi.prototype.getMaxValue=function(i){var s=this.binders[i];return s instanceof Wi||s instanceof Oi?s.maxValue:0},Zi.prototype.populatePaintArrays=function(i,s,l,v,x){for(var C in this.binders){var T=this.binders[C];(T instanceof Wi||T instanceof Oi||T instanceof oa)&&T.populatePaintArray(i,s,l,v,x)}},Zi.prototype.setConstantPatternPositions=function(i,s){for(var l in this.binders){var v=this.binders[l];v instanceof Qi&&v.setConstantPatternPositions(i,s)}},Zi.prototype.updatePaintArrays=function(i,s,l,v,x){var C=!1;for(var T in i)for(var R=0,U=s.getPositions(T);R<U.length;R+=1){var X=U[R],$=l.feature(X.index);for(var ne in this.binders){var me=this.binders[ne];if((me instanceof Wi||me instanceof Oi||me instanceof oa)&&me.expression.isStateDependent===!0){var Ae=v.paint.get(ne);me.expression=Ae.value,me.updatePaintArray(X.start,X.end,$,i[T],x),C=!0}}}return C},Zi.prototype.defines=function(){var i=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Hi||l instanceof Qi)&&i.push.apply(i,l.uniformNames.map(function(v){return"#define HAS_UNIFORM_"+v}))}return i},Zi.prototype.getBinderAttributes=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Wi||l instanceof Oi)for(var v=0;v<l.paintVertexAttributes.length;v++)i.push(l.paintVertexAttributes[v].name);else if(l instanceof oa)for(var x=0;x<Je.members.length;x++)i.push(Je.members[x].name)}return i},Zi.prototype.getBinderUniforms=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Hi||l instanceof Qi||l instanceof Oi)for(var v=0,x=l.uniformNames;v<x.length;v+=1)i.push(x[v])}return i},Zi.prototype.getPaintVertexBuffers=function(){return this._buffers},Zi.prototype.getUniforms=function(i,s){var l=[];for(var v in this.binders){var x=this.binders[v];if(x instanceof Hi||x instanceof Qi||x instanceof Oi)for(var C=0,T=x.uniformNames;C<T.length;C+=1){var R=T[C];if(s[R]){var U=x.getBinding(i,s[R],R);l.push({name:R,property:v,binding:U})}}}return l},Zi.prototype.setUniforms=function(i,s,l,v){for(var x=0,C=s;x<C.length;x+=1){var T=C[x],R=T.name,U=T.property;this.binders[U].setUniform(T.binding,v,l.get(U),R)}},Zi.prototype.updatePaintBuffers=function(i){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(i&&l instanceof oa){var v=i.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(l instanceof Wi||l instanceof Oi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},Zi.prototype.upload=function(i){for(var s in this.binders){var l=this.binders[s];(l instanceof Wi||l instanceof Oi||l instanceof oa)&&l.upload(i)}this.updatePaintBuffers()},Zi.prototype.destroy=function(){for(var i in this.binders){var s=this.binders[i];(s instanceof Wi||s instanceof Oi||s instanceof oa)&&s.destroy()}};var wi=function(i,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var v=0,x=i;v<x.length;v+=1){var C=x[v];this.programConfigurations[C.id]=new Zi(C,s,l)}this.needsUpload=!1,this._featureMap=new Pt,this._bufferOffset=0};function ls(i,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(s+"-","").replace(/-/g,"_")]}function Xo(i,s,l){var v={color:{source:Ao,composite:nf},number:{source:uc,composite:Ao}},x=function(C){return{"line-pattern":{source:ac,composite:ac},"fill-pattern":{source:ac,composite:ac},"fill-extrusion-pattern":{source:ac,composite:ac}}[C]}(i);return x&&x[l]||v[s][l]}wi.prototype.populatePaintArrays=function(i,s,l,v,x,C){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,v,x,C);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},wi.prototype.updatePaintArrays=function(i,s,l,v){for(var x=0,C=l;x<C.length;x+=1){var T=C[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(i,this._featureMap,s,T,v)||this.needsUpload}},wi.prototype.get=function(i){return this.programConfigurations[i]},wi.prototype.upload=function(i){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}},wi.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()},ni("ConstantBinder",Hi),ni("CrossFadedConstantBinder",Qi),ni("SourceExpressionBinder",Wi),ni("CrossFadedCompositeBinder",oa),ni("CompositeExpressionBinder",Oi),ni("ProgramConfiguration",Zi,{omit:["_buffers"]}),ni("ProgramConfigurationSet",wi);var Ds=Math.pow(2,14)-1,cs=-Ds-1;function co(i){for(var s=8192/i.extent,l=i.loadGeometry(),v=0;v<l.length;v++)for(var x=l[v],C=0;C<x.length;C++){var T=x[C],R=Math.round(T.x*s),U=Math.round(T.y*s);T.x=Et(R,cs,Ds),T.y=Et(U,cs,Ds),(R<T.x||R>T.x+1||U<T.y||U>T.y+1)&&je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function es(i,s){return{type:i.type,id:i.id,properties:i.properties,geometry:s?co(i):[]}}function ts(i,s,l,v,x){i.emplaceBack(2*s+(v+1)/2,2*l+(x+1)/2)}var Fs=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new nh,this.indexArray=new sc,this.segments=new Pe,this.programConfigurations=new wi(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function lc(i,s){for(var l=0;l<i.length;l++)if(fl(s,i[l]))return!0;for(var v=0;v<s.length;v++)if(fl(i,s[v]))return!0;return!!Of(i,s)}function eu(i,s,l){return!!fl(i,s)||!!Wl(s,i,l)}function Xu(i,s){if(i.length===1)return Rf(s,i[0]);for(var l=0;l<s.length;l++)for(var v=s[l],x=0;x<v.length;x++)if(fl(i,v[x]))return!0;for(var C=0;C<i.length;C++)if(Rf(s,i[C]))return!0;for(var T=0;T<s.length;T++)if(Of(i,s[T]))return!0;return!1}function Cu(i,s,l){if(i.length>1){if(Of(i,s))return!0;for(var v=0;v<s.length;v++)if(Wl(s[v],i,l))return!0}for(var x=0;x<i.length;x++)if(Wl(i[x],s,l))return!0;return!1}function Of(i,s){if(i.length===0||s.length===0)return!1;for(var l=0;l<i.length-1;l++)for(var v=i[l],x=i[l+1],C=0;C<s.length-1;C++)if(cc(v,x,s[C],s[C+1]))return!0;return!1}function cc(i,s,l,v){return Sr(i,l,v)!==Sr(s,l,v)&&Sr(i,s,l)!==Sr(i,s,v)}function Wl(i,s,l){var v=l*l;if(s.length===1)return i.distSqr(s[0])<v;for(var x=1;x<s.length;x++)if(Tl(i,s[x-1],s[x])<v)return!0;return!1}function Tl(i,s,l){var v=s.distSqr(l);if(v===0)return i.distSqr(s);var x=((i.x-s.x)*(l.x-s.x)+(i.y-s.y)*(l.y-s.y))/v;return i.distSqr(x<0?s:x>1?l:l.sub(s)._mult(x)._add(s))}function Rf(i,s){for(var l,v,x,C=!1,T=0;T<i.length;T++)for(var R=0,U=(l=i[T]).length-1;R<l.length;U=R++)(v=l[R]).y>s.y!=(x=l[U]).y>s.y&&s.x<(x.x-v.x)*(s.y-v.y)/(x.y-v.y)+v.x&&(C=!C);return C}function fl(i,s){for(var l=!1,v=0,x=i.length-1;v<i.length;x=v++){var C=i[v],T=i[x];C.y>s.y!=T.y>s.y&&s.x<(T.x-C.x)*(s.y-C.y)/(T.y-C.y)+C.x&&(l=!l)}return l}function fc(i,s,l){var v=l[0],x=l[2];if(i.x<v.x&&s.x<v.x||i.x>x.x&&s.x>x.x||i.y<v.y&&s.y<v.y||i.y>x.y&&s.y>x.y)return!1;var C=Sr(i,s,l[0]);return C!==Sr(i,s,l[1])||C!==Sr(i,s,l[2])||C!==Sr(i,s,l[3])}function Xl(i,s,l){var v=s.paint.get(i).value;return v.kind==="constant"?v.value:l.programConfigurations.get(s.id).getMaxValue(i)}function fs(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ml(i,s,l,v,x){if(!s[0]&&!s[1])return i;var C=ve.convert(s)._mult(x);l==="viewport"&&C._rotate(-v);for(var T=[],R=0;R<i.length;R++)T.push(i[R].sub(C));return T}Fs.prototype.populate=function(i,s,l){var v=this.layers[0],x=[],C=null;v.type==="circle"&&(C=v.layout.get("circle-sort-key"));for(var T=0,R=i;T<R.length;T+=1){var U=R[T],X=U.feature,$=U.id,ne=U.index,me=U.sourceLayerIndex,Ae=this.layers[0]._featureFilter.needGeometry,Qe=es(X,Ae);if(this.layers[0]._featureFilter.filter(new ua(this.zoom),Qe,l)){var et=C?C.evaluate(Qe,{},l):void 0,_t={id:$,properties:X.properties,type:X.type,sourceLayerIndex:me,index:ne,geometry:Ae?Qe.geometry:co(X),patterns:{},sortKey:et};x.push(_t)}}C&&x.sort(function(Un,Ai){return Un.sortKey-Ai.sortKey});for(var ft=0,zt=x;ft<zt.length;ft+=1){var tr=zt[ft],xr=tr.geometry,br=tr.index,Zr=tr.sourceLayerIndex,pn=i[br].feature;this.addFeature(tr,xr,br,l),s.featureIndex.insert(pn,xr,br,Zr,this.index)}},Fs.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},Fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fs.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Te),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fs.prototype.addFeature=function(i,s,l,v){for(var x=0,C=s;x<C.length;x+=1)for(var T=0,R=C[x];T<R.length;T+=1){var U=R[T],X=U.x,$=U.y;if(!(X<0||X>=8192||$<0||$>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),me=ne.vertexLength;ts(this.layoutVertexArray,X,$,-1,-1),ts(this.layoutVertexArray,X,$,1,-1),ts(this.layoutVertexArray,X,$,1,1),ts(this.layoutVertexArray,X,$,-1,1),this.indexArray.emplaceBack(me,me+1,me+2),this.indexArray.emplaceBack(me,me+3,me+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,{},v)},ni("CircleBucket",Fs,{omit:["layers"]});var Dc=new Yo({"circle-sort-key":new pi(ke.layout_circle["circle-sort-key"])}),Bs={paint:new Yo({"circle-radius":new pi(ke.paint_circle["circle-radius"]),"circle-color":new pi(ke.paint_circle["circle-color"]),"circle-blur":new pi(ke.paint_circle["circle-blur"]),"circle-opacity":new pi(ke.paint_circle["circle-opacity"]),"circle-translate":new _i(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new _i(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _i(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _i(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pi(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pi(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pi(ke.paint_circle["circle-stroke-opacity"])}),layout:Dc},za=typeof Float32Array!="undefined"?Float32Array:Array;function Du(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Xs(i,s,l){var v=s[0],x=s[1],C=s[2],T=s[3],R=s[4],U=s[5],X=s[6],$=s[7],ne=s[8],me=s[9],Ae=s[10],Qe=s[11],et=s[12],_t=s[13],ft=s[14],zt=s[15],tr=l[0],xr=l[1],br=l[2],Zr=l[3];return i[0]=tr*v+xr*R+br*ne+Zr*et,i[1]=tr*x+xr*U+br*me+Zr*_t,i[2]=tr*C+xr*X+br*Ae+Zr*ft,i[3]=tr*T+xr*$+br*Qe+Zr*zt,i[4]=(tr=l[4])*v+(xr=l[5])*R+(br=l[6])*ne+(Zr=l[7])*et,i[5]=tr*x+xr*U+br*me+Zr*_t,i[6]=tr*C+xr*X+br*Ae+Zr*ft,i[7]=tr*T+xr*$+br*Qe+Zr*zt,i[8]=(tr=l[8])*v+(xr=l[9])*R+(br=l[10])*ne+(Zr=l[11])*et,i[9]=tr*x+xr*U+br*me+Zr*_t,i[10]=tr*C+xr*X+br*Ae+Zr*ft,i[11]=tr*T+xr*$+br*Qe+Zr*zt,i[12]=(tr=l[12])*v+(xr=l[13])*R+(br=l[14])*ne+(Zr=l[15])*et,i[13]=tr*x+xr*U+br*me+Zr*_t,i[14]=tr*C+xr*X+br*Ae+Zr*ft,i[15]=tr*T+xr*$+br*Qe+Zr*zt,i}Math.hypot||(Math.hypot=function(){for(var i=arguments,s=0,l=arguments.length;l--;)s+=i[l]*i[l];return Math.sqrt(s)});var hc,ah=Xs;function Df(i,s,l){var v=s[0],x=s[1],C=s[2],T=s[3];return i[0]=l[0]*v+l[4]*x+l[8]*C+l[12]*T,i[1]=l[1]*v+l[5]*x+l[9]*C+l[13]*T,i[2]=l[2]*v+l[6]*x+l[10]*C+l[14]*T,i[3]=l[3]*v+l[7]*x+l[11]*C+l[15]*T,i}hc=new za(3),za!=Float32Array&&(hc[0]=0,hc[1]=0,hc[2]=0),function(){var i=new za(4);za!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0)}();var Ep=(function(){var i=new za(2);za!=Float32Array&&(i[0]=0,i[1]=0)}(),function(i){function s(l){i.call(this,l,Bs)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Fs(l)},s.prototype.queryRadius=function(l){var v=l;return Xl("circle-radius",this,v)+Xl("circle-stroke-width",this,v)+fs(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,v,x,C,T,R,U,X){for(var $=Ml(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,U),ne=this.paint.get("circle-radius").evaluate(v,x)+this.paint.get("circle-stroke-width").evaluate(v,x),me=this.paint.get("circle-pitch-alignment")==="map",Ae=me?$:function(pn,Un){return pn.map(function(Ai){return Yu(Ai,Un)})}($,X),Qe=me?ne*U:ne,et=0,_t=C;et<_t.length;et+=1)for(var ft=0,zt=_t[et];ft<zt.length;ft+=1){var tr=zt[ft],xr=me?tr:Yu(tr,X),br=Qe,Zr=Df([],[tr.x,tr.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?br*=Zr[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(br*=R.cameraToCenterDistance/Zr[3]),eu(Ae,xr,br))return!0}return!1},s}(Ru));function Yu(i,s){var l=Df([],[i.x,i.y,0,1],s);return new ve(l[0]/l[3],l[1]/l[3])}var Fc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Fs);function Su(i,s,l,v){var x=s.width,C=s.height;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==x*C*l)throw new RangeError("mismatched image size")}else v=new Uint8Array(x*C*l);return i.width=x,i.height=C,i.data=v,i}function Ff(i,s,l){var v=s.width,x=s.height;if(v!==i.width||x!==i.height){var C=Su({},{width:v,height:x},l);oh(i,C,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,v),height:Math.min(i.height,x)},l),i.width=v,i.height=x,i.data=C.data}}function oh(i,s,l,v,x,C){if(x.width===0||x.height===0)return s;if(x.width>i.width||x.height>i.height||l.x>i.width-x.width||l.y>i.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>s.width||x.height>s.height||v.x>s.width-x.width||v.y>s.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=i.data,R=s.data,U=0;U<x.height;U++)for(var X=((l.y+U)*i.width+l.x)*C,$=((v.y+U)*s.width+v.x)*C,ne=0;ne<x.width*C;ne++)R[$+ne]=T[X+ne];return s}ni("HeatmapBucket",Fc,{omit:["layers"]});var Yl=function(i,s){Su(this,i,1,s)};Yl.prototype.resize=function(i){Ff(this,i,1)},Yl.prototype.clone=function(){return new Yl({width:this.width,height:this.height},new Uint8Array(this.data))},Yl.copy=function(i,s,l,v,x){oh(i,s,l,v,x,1)};var Ns=function(i,s){Su(this,i,4,s)};Ns.prototype.resize=function(i){Ff(this,i,4)},Ns.prototype.replace=function(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i},Ns.prototype.clone=function(){return new Ns({width:this.width,height:this.height},new Uint8Array(this.data))},Ns.copy=function(i,s,l,v,x){oh(i,s,l,v,x,4)},ni("AlphaImage",Yl),ni("RGBAImage",Ns);var Bf={paint:new Yo({"heatmap-radius":new pi(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pi(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _i(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ll(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _i(ke.paint_heatmap["heatmap-opacity"])})};function Il(i){var s={},l=i.resolution||256,v=i.clips?i.clips.length:1,x=i.image||new Ns({width:l,height:v}),C=function(Qe,et,_t){s[i.evaluationKey]=_t;var ft=i.expression.evaluate(s);x.data[Qe+et+0]=Math.floor(255*ft.r/ft.a),x.data[Qe+et+1]=Math.floor(255*ft.g/ft.a),x.data[Qe+et+2]=Math.floor(255*ft.b/ft.a),x.data[Qe+et+3]=Math.floor(255*ft.a)};if(i.clips)for(var T=0,R=0;T<v;++T,R+=4*l)for(var U=0,X=0;U<l;U++,X+=4){var $=U/(l-1),ne=i.clips[T];C(R,X,ne.start*(1-$)+ne.end*$)}else for(var me=0,Ae=0;me<l;me++,Ae+=4)C(0,Ae,me/(l-1));return x}var Oh=function(i){function s(l){i.call(this,l,Bf),this._updateColorRamp()}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Fc(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Il({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Ru),tu={paint:new Yo({"hillshade-illumination-direction":new _i(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _i(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _i(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _i(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _i(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _i(ke.paint_hillshade["hillshade-accent-color"])})},sh=function(i){function s(l){i.call(this,l,tu)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Ru),Fu=po([{name:"a_pos",components:2,type:"Int16"}],4).members,ae=uh,cn=uh;function uh(i,s,l){l=l||2;var v,x,C,T,R,U,X,$=s&&s.length,ne=$?s[0]*l:i.length,me=kv(i,0,ne,l,!0),Ae=[];if(!me||me.next===me.prev)return Ae;if($&&(me=function(et,_t,ft,zt){var tr,xr,br,Zr=[];for(tr=0,xr=_t.length;tr<xr;tr++)(br=kv(et,_t[tr]*zt,tr<xr-1?_t[tr+1]*zt:et.length,zt,!1))===br.next&&(br.steiner=!0),Zr.push(pc(br));for(Zr.sort(Cd),tr=0;tr<Zr.length;tr++)Jd(Zr[tr],ft),ft=Io(ft,ft.next);return ft}(i,s,me,l)),i.length>80*l){v=C=i[0],x=T=i[1];for(var Qe=l;Qe<ne;Qe+=l)(R=i[Qe])<v&&(v=R),(U=i[Qe+1])<x&&(x=U),R>C&&(C=R),U>T&&(T=U);X=(X=Math.max(C-v,T-x))!==0?1/X:0}return hl(me,Ae,l,v,x,X),Ae}function kv(i,s,l,v,x){var C,T;if(x===of(i,s,l,v)>0)for(C=s;C<l;C+=v)T=Sp(C,i[C],i[C+1],T);else for(C=l-v;C>=s;C-=v)T=Sp(C,i[C],i[C+1],T);return T&&Cp(T,T.next)&&(Pl(T),T=T.next),T}function Io(i,s){if(!i)return i;s||(s=i);var l,v=i;do if(l=!1,v.steiner||!Cp(v,v.next)&&hs(v.prev,v,v.next)!==0)v=v.next;else{if(Pl(v),(v=s=v.prev)===v.next)break;l=!0}while(l||v!==s);return s}function hl(i,s,l,v,x,C,T){if(i){!T&&C&&function($,ne,me,Ae){var Qe=$;do Qe.z===null&&(Qe.z=Rh(Qe.x,Qe.y,ne,me,Ae)),Qe.prevZ=Qe.prev,Qe.nextZ=Qe.next,Qe=Qe.next;while(Qe!==$);Qe.prevZ.nextZ=null,Qe.prevZ=null,function(et){var _t,ft,zt,tr,xr,br,Zr,pn,Un=1;do{for(ft=et,et=null,xr=null,br=0;ft;){for(br++,zt=ft,Zr=0,_t=0;_t<Un&&(Zr++,zt=zt.nextZ);_t++);for(pn=Un;Zr>0||pn>0&&zt;)Zr!==0&&(pn===0||!zt||ft.z<=zt.z)?(tr=ft,ft=ft.nextZ,Zr--):(tr=zt,zt=zt.nextZ,pn--),xr?xr.nextZ=tr:et=tr,tr.prevZ=xr,xr=tr;ft=zt}xr.nextZ=null,Un*=2}while(br>1)}(Qe)}(i,v,x,C);for(var R,U,X=i;i.prev!==i.next;)if(R=i.prev,U=i.next,C?Xp(i,v,x,C):lh(i))s.push(R.i/l),s.push(i.i/l),s.push(U.i/l),Pl(i),i=U.next,X=U.next;else if((i=U)===X){T?T===1?hl(i=zs(Io(i),s,l),s,l,v,x,C,2):T===2&&Au(i,s,l,v,x,C):hl(Io(i),s,l,v,x,C,1);break}}}function lh(i){var s=i.prev,l=i,v=i.next;if(hs(s,l,v)>=0)return!1;for(var x=i.next.next;x!==i.prev;){if(ch(s.x,s.y,l.x,l.y,v.x,v.y,x.x,x.y)&&hs(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Xp(i,s,l,v){var x=i.prev,C=i,T=i.next;if(hs(x,C,T)>=0)return!1;for(var R=x.x>C.x?x.x>T.x?x.x:T.x:C.x>T.x?C.x:T.x,U=x.y>C.y?x.y>T.y?x.y:T.y:C.y>T.y?C.y:T.y,X=Rh(x.x<C.x?x.x<T.x?x.x:T.x:C.x<T.x?C.x:T.x,x.y<C.y?x.y<T.y?x.y:T.y:C.y<T.y?C.y:T.y,s,l,v),$=Rh(R,U,s,l,v),ne=i.prevZ,me=i.nextZ;ne&&ne.z>=X&&me&&me.z<=$;){if(ne!==i.prev&&ne!==i.next&&ch(x.x,x.y,C.x,C.y,T.x,T.y,ne.x,ne.y)&&hs(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,me!==i.prev&&me!==i.next&&ch(x.x,x.y,C.x,C.y,T.x,T.y,me.x,me.y)&&hs(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ne&&ne.z>=X;){if(ne!==i.prev&&ne!==i.next&&ch(x.x,x.y,C.x,C.y,T.x,T.y,ne.x,ne.y)&&hs(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;me&&me.z<=$;){if(me!==i.prev&&me!==i.next&&ch(x.x,x.y,C.x,C.y,T.x,T.y,me.x,me.y)&&hs(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function zs(i,s,l){var v=i;do{var x=v.prev,C=v.next.next;!Cp(x,C)&&Yp(x,v,v.next,C)&&Dh(x,C)&&Dh(C,x)&&(s.push(x.i/l),s.push(v.i/l),s.push(C.i/l),Pl(v),Pl(v.next),v=i=C),v=v.next}while(v!==i);return Io(v)}function Au(i,s,l,v,x,C){var T=i;do{for(var R=T.next.next;R!==T.prev;){if(T.i!==R.i&&Nf(T,R)){var U=Bc(T,R);return T=Io(T,T.next),U=Io(U,U.next),hl(T,s,l,v,x,C),void hl(U,s,l,v,x,C)}R=R.next}T=T.next}while(T!==i)}function Cd(i,s){return i.x-s.x}function Jd(i,s){if(s=function(v,x){var C,T=x,R=v.x,U=v.y,X=-1/0;do{if(U<=T.y&&U>=T.next.y&&T.next.y!==T.y){var $=T.x+(U-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=R&&$>X){if(X=$,$===R){if(U===T.y)return T;if(U===T.next.y)return T.next}C=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!C)return null;if(R===X)return C;var ne,me=C,Ae=C.x,Qe=C.y,et=1/0;T=C;do R>=T.x&&T.x>=Ae&&R!==T.x&&ch(U<Qe?R:X,U,Ae,Qe,U<Qe?X:R,U,T.x,T.y)&&(ne=Math.abs(U-T.y)/(R-T.x),Dh(T,v)&&(ne<et||ne===et&&(T.x>C.x||T.x===C.x&&Sd(C,T)))&&(C=T,et=ne)),T=T.next;while(T!==me);return C}(i,s)){var l=Bc(s,i);Io(s,s.next),Io(l,l.next)}}function Sd(i,s){return hs(i.prev,i,s.prev)<0&&hs(s.next,i,i.next)<0}function Rh(i,s,l,v,x){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-l)*x)|i<<8))|i<<4))|i<<2))|i<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-v)*x)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function pc(i){var s=i,l=i;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==i);return l}function ch(i,s,l,v,x,C,T,R){return(x-T)*(s-R)-(i-T)*(C-R)>=0&&(i-T)*(v-R)-(l-T)*(s-R)>=0&&(l-T)*(C-R)-(x-T)*(v-R)>=0}function Nf(i,s){return i.next.i!==s.i&&i.prev.i!==s.i&&!function(l,v){var x=l;do{if(x.i!==l.i&&x.next.i!==l.i&&x.i!==v.i&&x.next.i!==v.i&&Yp(x,x.next,l,v))return!0;x=x.next}while(x!==l);return!1}(i,s)&&(Dh(i,s)&&Dh(s,i)&&function(l,v){var x=l,C=!1,T=(l.x+v.x)/2,R=(l.y+v.y)/2;do x.y>R!=x.next.y>R&&x.next.y!==x.y&&T<(x.next.x-x.x)*(R-x.y)/(x.next.y-x.y)+x.x&&(C=!C),x=x.next;while(x!==l);return C}(i,s)&&(hs(i.prev,i,s.prev)||hs(i,s.prev,s))||Cp(i,s)&&hs(i.prev,i,i.next)>0&&hs(s.prev,s,s.next)>0)}function hs(i,s,l){return(s.y-i.y)*(l.x-s.x)-(s.x-i.x)*(l.y-s.y)}function Cp(i,s){return i.x===s.x&&i.y===s.y}function Yp(i,s,l,v){var x=qp(hs(i,s,l)),C=qp(hs(i,s,v)),T=qp(hs(l,v,i)),R=qp(hs(l,v,s));return x!==C&&T!==R||!(x!==0||!Xi(i,l,s))||!(C!==0||!Xi(i,v,s))||!(T!==0||!Xi(l,i,v))||!(R!==0||!Xi(l,s,v))}function Xi(i,s,l){return s.x<=Math.max(i.x,l.x)&&s.x>=Math.min(i.x,l.x)&&s.y<=Math.max(i.y,l.y)&&s.y>=Math.min(i.y,l.y)}function qp(i){return i>0?1:i<0?-1:0}function Dh(i,s){return hs(i.prev,i,i.next)<0?hs(i,s,i.next)>=0&&hs(i,i.prev,s)>=0:hs(i,s,i.prev)<0||hs(i,i.next,s)<0}function Bc(i,s){var l=new af(i.i,i.x,i.y),v=new af(s.i,s.x,s.y),x=i.next,C=s.prev;return i.next=s,s.prev=i,l.next=x,x.prev=l,v.next=l,l.prev=v,C.next=v,v.prev=C,v}function Sp(i,s,l,v){var x=new af(i,s,l);return v?(x.next=v.next,x.prev=v,v.next.prev=x,v.next=x):(x.prev=x,x.next=x),x}function Pl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function af(i,s,l){this.i=i,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(i,s,l,v){for(var x=0,C=s,T=l-v;C<l;C+=v)x+=(i[T]-i[C])*(i[C+1]+i[T+1]),T=C;return x}function $p(i,s,l,v,x){(function C(T,R,U,X,$){for(;X>U;){if(X-U>600){var ne=X-U+1,me=R-U+1,Ae=Math.log(ne),Qe=.5*Math.exp(2*Ae/3),et=.5*Math.sqrt(Ae*Qe*(ne-Qe)/ne)*(me-ne/2<0?-1:1);C(T,R,Math.max(U,Math.floor(R-me*Qe/ne+et)),Math.min(X,Math.floor(R+(ne-me)*Qe/ne+et)),$)}var _t=T[R],ft=U,zt=X;for(fh(T,U,R),$(T[X],_t)>0&&fh(T,U,X);ft<zt;){for(fh(T,ft,zt),ft++,zt--;$(T[ft],_t)<0;)ft++;for(;$(T[zt],_t)>0;)zt--}$(T[U],_t)===0?fh(T,U,zt):fh(T,++zt,X),zt<=R&&(U=zt+1),R<=zt&&(X=zt-1)}})(i,s,l||0,v||i.length-1,x||dc)}function fh(i,s,l){var v=i[s];i[s]=i[l],i[l]=v}function dc(i,s){return i<s?-1:i>s?1:0}function Ap(i,s){var l=i.length;if(l<=1)return[i];for(var v,x,C=[],T=0;T<l;T++){var R=tn(i[T]);R!==0&&(i[T].area=Math.abs(R),x===void 0&&(x=R<0),x===R<0?(v&&C.push(v),v=[i[T]]):v.push(i[T]))}if(v&&C.push(v),s>1)for(var U=0;U<C.length;U++)C[U].length<=s||($p(C[U],s,1,C[U].length-1,Qh),C[U]=C[U].slice(0,s));return C}function Qh(i,s){return s.area-i.area}function vc(i,s,l){for(var v=l.patternDependencies,x=!1,C=0,T=s;C<T.length;C+=1){var R=T[C].paint.get(i+"-pattern");R.isConstant()||(x=!0);var U=R.constantOr(null);U&&(x=!0,v[U.to]=!0,v[U.from]=!0)}return x}function sf(i,s,l,v,x){for(var C=x.patternDependencies,T=0,R=s;T<R.length;T+=1){var U=R[T],X=U.paint.get(i+"-pattern").value;if(X.kind!=="constant"){var $=X.evaluate({zoom:v-1},l,{},x.availableImages),ne=X.evaluate({zoom:v},l,{},x.availableImages),me=X.evaluate({zoom:v+1},l,{},x.availableImages);ne=ne&&ne.name?ne.name:ne,me=me&&me.name?me.name:me,C[$=$&&$.name?$.name:$]=!0,C[ne]=!0,C[me]=!0,l.patterns[U.id]={min:$,mid:ne,max:me}}}return l}uh.deviation=function(i,s,l,v){var x=s&&s.length,C=Math.abs(of(i,0,x?s[0]*l:i.length,l));if(x)for(var T=0,R=s.length;T<R;T++)C-=Math.abs(of(i,s[T]*l,T<R-1?s[T+1]*l:i.length,l));var U=0;for(T=0;T<v.length;T+=3){var X=v[T]*l,$=v[T+1]*l,ne=v[T+2]*l;U+=Math.abs((i[X]-i[ne])*(i[$+1]-i[X+1])-(i[X]-i[$])*(i[ne+1]-i[X+1]))}return C===0&&U===0?0:Math.abs((U-C)/C)},uh.flatten=function(i){for(var s=i[0][0].length,l={vertices:[],holes:[],dimensions:s},v=0,x=0;x<i.length;x++){for(var C=0;C<i[x].length;C++)for(var T=0;T<s;T++)l.vertices.push(i[x][C][T]);x>0&&l.holes.push(v+=i[x-1].length)}return l},ae.default=cn;var kl=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new nh,this.indexArray=new sc,this.indexArray2=new Lh,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Pe,this.segments2=new Pe,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};kl.prototype.populate=function(i,s,l){this.hasPattern=vc("fill",this.layers,s);for(var v=this.layers[0].layout.get("fill-sort-key"),x=[],C=0,T=i;C<T.length;C+=1){var R=T[C],U=R.feature,X=R.id,$=R.index,ne=R.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,Ae=es(U,me);if(this.layers[0]._featureFilter.filter(new ua(this.zoom),Ae,l)){var Qe=v?v.evaluate(Ae,{},l,s.availableImages):void 0,et={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ne,index:$,geometry:me?Ae.geometry:co(U),patterns:{},sortKey:Qe};x.push(et)}}v&&x.sort(function(pn,Un){return pn.sortKey-Un.sortKey});for(var _t=0,ft=x;_t<ft.length;_t+=1){var zt=ft[_t],tr=zt.geometry,xr=zt.index,br=zt.sourceLayerIndex;if(this.hasPattern){var Zr=sf("fill",this.layers,zt,this.zoom,s);this.patternFeatures.push(Zr)}else this.addFeature(zt,tr,xr,l,{});s.featureIndex.insert(i[xr].feature,tr,xr,br,this.index)}},kl.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},kl.prototype.addFeatures=function(i,s,l){for(var v=0,x=this.patternFeatures;v<x.length;v+=1){var C=x[v];this.addFeature(C,C.geometry,C.index,s,l)}},kl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},kl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},kl.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Fu),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},kl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},kl.prototype.addFeature=function(i,s,l,v,x){for(var C=0,T=Ap(s,500);C<T.length;C+=1){for(var R=T[C],U=0,X=0,$=R;X<$.length;X+=1)U+=$[X].length;for(var ne=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray),me=ne.vertexLength,Ae=[],Qe=[],et=0,_t=R;et<_t.length;et+=1){var ft=_t[et];if(ft.length!==0){ft!==R[0]&&Qe.push(Ae.length/2);var zt=this.segments2.prepareSegment(ft.length,this.layoutVertexArray,this.indexArray2),tr=zt.vertexLength;this.layoutVertexArray.emplaceBack(ft[0].x,ft[0].y),this.indexArray2.emplaceBack(tr+ft.length-1,tr),Ae.push(ft[0].x),Ae.push(ft[0].y);for(var xr=1;xr<ft.length;xr++)this.layoutVertexArray.emplaceBack(ft[xr].x,ft[xr].y),this.indexArray2.emplaceBack(tr+xr-1,tr+xr),Ae.push(ft[xr].x),Ae.push(ft[xr].y);zt.vertexLength+=ft.length,zt.primitiveLength+=ft.length}}for(var br=ae(Ae,Qe),Zr=0;Zr<br.length;Zr+=3)this.indexArray.emplaceBack(me+br[Zr],me+br[Zr+1],me+br[Zr+2]);ne.vertexLength+=U,ne.primitiveLength+=br.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,v)},ni("FillBucket",kl,{omit:["layers","patternFeatures"]});var hh=new Yo({"fill-sort-key":new pi(ke.layout_fill["fill-sort-key"])}),uf={paint:new Yo({"fill-antialias":new _i(ke.paint_fill["fill-antialias"]),"fill-opacity":new pi(ke.paint_fill["fill-opacity"]),"fill-color":new pi(ke.paint_fill["fill-color"]),"fill-outline-color":new pi(ke.paint_fill["fill-outline-color"]),"fill-translate":new _i(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new _i(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new kf(ke.paint_fill["fill-pattern"])}),layout:hh},Bu=function(i){function s(l){i.call(this,l,uf)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,v){i.prototype.recalculate.call(this,l,v);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new kl(l)},s.prototype.queryRadius=function(){return fs(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,v,x,C,T,R,U){return Xu(Ml(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,U),C)},s.prototype.isTileClipped=function(){return!0},s}(Ru),ph=po([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,wp=Nc;function Nc(i,s,l,v,x){this.properties={},this.extent=l,this.type=0,this._pbf=i,this._geometry=-1,this._keys=v,this._values=x,i.readFields(lf,this,s)}function lf(i,s,l){i==1?s.id=l.readVarint():i==2?function(v,x){for(var C=v.readVarint()+v.pos;v.pos<C;){var T=x._keys[v.readVarint()],R=x._values[v.readVarint()];x.properties[T]=R}}(l,s):i==3?s.type=l.readVarint():i==4&&(s._geometry=l.pos)}function Ad(i){for(var s,l,v=0,x=0,C=i.length,T=C-1;x<C;T=x++)v+=((l=i[T]).x-(s=i[x]).x)*(s.y+l.y);return v}Nc.types=["Unknown","Point","LineString","Polygon"],Nc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var s,l=i.readVarint()+i.pos,v=1,x=0,C=0,T=0,R=[];i.pos<l;){if(x<=0){var U=i.readVarint();v=7&U,x=U>>3}if(x--,v===1||v===2)C+=i.readSVarint(),T+=i.readSVarint(),v===1&&(s&&R.push(s),s=[]),s.push(new ve(C,T));else{if(v!==7)throw new Error("unknown command "+v);s&&s.push(s[0].clone())}}return s&&R.push(s),R},Nc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var s=i.readVarint()+i.pos,l=1,v=0,x=0,C=0,T=1/0,R=-1/0,U=1/0,X=-1/0;i.pos<s;){if(v<=0){var $=i.readVarint();l=7&$,v=$>>3}if(v--,l===1||l===2)(x+=i.readSVarint())<T&&(T=x),x>R&&(R=x),(C+=i.readSVarint())<U&&(U=C),C>X&&(X=C);else if(l!==7)throw new Error("unknown command "+l)}return[T,U,R,X]},Nc.prototype.toGeoJSON=function(i,s,l){var v,x,C=this.extent*Math.pow(2,l),T=this.extent*i,R=this.extent*s,U=this.loadGeometry(),X=Nc.types[this.type];function $(Ae){for(var Qe=0;Qe<Ae.length;Qe++){var et=Ae[Qe];Ae[Qe]=[360*(et.x+T)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(et.y+R)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(v=0;v<U.length;v++)ne[v]=U[v][0];$(U=ne);break;case 2:for(v=0;v<U.length;v++)$(U[v]);break;case 3:for(U=function(Ae){var Qe=Ae.length;if(Qe<=1)return[Ae];for(var et,_t,ft=[],zt=0;zt<Qe;zt++){var tr=Ad(Ae[zt]);tr!==0&&(_t===void 0&&(_t=tr<0),_t===tr<0?(et&&ft.push(et),et=[Ae[zt]]):et.push(Ae[zt]))}return et&&ft.push(et),ft}(U),v=0;v<U.length;v++)for(x=0;x<U[v].length;x++)$(U[v][x])}U.length===1?U=U[0]:X="Multi"+X;var me={type:"Feature",geometry:{type:X,coordinates:U},properties:this.properties};return"id"in this&&(me.id=this.id),me};var zf=wd;function wd(i,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(mc,this,s),this.length=this._features.length}function mc(i,s,l){i===15?s.version=l.readVarint():i===1?s.name=l.readString():i===5?s.extent=l.readVarint():i===2?s._features.push(l.pos):i===3?s._keys.push(l.readString()):i===4&&s._values.push(function(v){for(var x=null,C=v.readVarint()+v.pos;v.pos<C;){var T=v.readVarint()>>3;x=T===1?v.readString():T===2?v.readFloat():T===3?v.readDouble():T===4?v.readVarint64():T===5?v.readVarint():T===6?v.readSVarint():T===7?v.readBoolean():null}return x}(l))}function ql(i,s,l){if(i===3){var v=new zf(l,l.readVarint()+l.pos);v.length&&(s[v.name]=v)}}wd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var s=this._pbf.readVarint()+this._pbf.pos;return new wp(this._pbf,s,this.extent,this._keys,this._values)};var Us={VectorTile:function(i,s){this.layers=i.readFields(ql,{},s)},VectorTileFeature:wp,VectorTileLayer:zf},Uf=Us.VectorTileFeature.types,zc=Math.pow(2,13);function Fh(i,s,l,v,x,C,T,R){i.emplaceBack(s,l,2*Math.floor(v*zc)+T,x*zc*2,C*zc*2,Math.round(R))}var Uc=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Al,this.indexArray=new sc,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Pe,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Tp(i,s){return i.x===s.x&&(i.x<0||i.x>8192)||i.y===s.y&&(i.y<0||i.y>8192)}Uc.prototype.populate=function(i,s,l){this.features=[],this.hasPattern=vc("fill-extrusion",this.layers,s);for(var v=0,x=i;v<x.length;v+=1){var C=x[v],T=C.feature,R=C.id,U=C.index,X=C.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ne=es(T,$);if(this.layers[0]._featureFilter.filter(new ua(this.zoom),ne,l)){var me={id:R,sourceLayerIndex:X,index:U,geometry:$?ne.geometry:co(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(sf("fill-extrusion",this.layers,me,this.zoom,s)):this.addFeature(me,me.geometry,U,l,{}),s.featureIndex.insert(T,me.geometry,U,X,this.index,!0)}}},Uc.prototype.addFeatures=function(i,s,l){for(var v=0,x=this.features;v<x.length;v+=1){var C=x[v];this.addFeature(C,C.geometry,C.index,s,l)}},Uc.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},Uc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uc.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ph),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Uc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uc.prototype.addFeature=function(i,s,l,v,x){for(var C=0,T=Ap(s,500);C<T.length;C+=1){for(var R=T[C],U=0,X=0,$=R;X<$.length;X+=1)U+=$[X].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),me=0,Ae=R;me<Ae.length;me+=1){var Qe=Ae[me];if(Qe.length!==0&&!((La=Qe).every(function(ca){return ca.x<0})||La.every(function(ca){return ca.x>8192})||La.every(function(ca){return ca.y<0})||La.every(function(ca){return ca.y>8192})))for(var et=0,_t=0;_t<Qe.length;_t++){var ft=Qe[_t];if(_t>=1){var zt=Qe[_t-1];if(!Tp(ft,zt)){ne.vertexLength+4>Pe.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var tr=ft.sub(zt)._perp()._unit(),xr=zt.dist(ft);et+xr>32768&&(et=0),Fh(this.layoutVertexArray,ft.x,ft.y,tr.x,tr.y,0,0,et),Fh(this.layoutVertexArray,ft.x,ft.y,tr.x,tr.y,0,1,et),Fh(this.layoutVertexArray,zt.x,zt.y,tr.x,tr.y,0,0,et+=xr),Fh(this.layoutVertexArray,zt.x,zt.y,tr.x,tr.y,0,1,et);var br=ne.vertexLength;this.indexArray.emplaceBack(br,br+2,br+1),this.indexArray.emplaceBack(br+1,br+2,br+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+U>Pe.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray)),Uf[i.type]==="Polygon"){for(var Zr=[],pn=[],Un=ne.vertexLength,Ai=0,ti=R;Ai<ti.length;Ai+=1){var Pi=ti[Ai];if(Pi.length!==0){Pi!==R[0]&&pn.push(Zr.length/2);for(var Xn=0;Xn<Pi.length;Xn++){var ma=Pi[Xn];Fh(this.layoutVertexArray,ma.x,ma.y,0,0,1,1,0),Zr.push(ma.x),Zr.push(ma.y)}}}for(var qi=ae(Zr,pn),gi=0;gi<qi.length;gi+=3)this.indexArray.emplaceBack(Un+qi[gi],Un+qi[gi+2],Un+qi[gi+1]);ne.primitiveLength+=qi.length/3,ne.vertexLength+=U}}var La;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,v)},ni("FillExtrusionBucket",Uc,{omit:["layers","features"]});var Lv={paint:new Yo({"fill-extrusion-opacity":new _i(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pi(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _i(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _i(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kf(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pi(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pi(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _i(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},gc=function(i){function s(l){i.call(this,l,Lv)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Uc(l)},s.prototype.queryRadius=function(){return fs(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,v,x,C,T,R,U,X){var $=Ml(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,U),ne=this.paint.get("fill-extrusion-height").evaluate(v,x),me=this.paint.get("fill-extrusion-base").evaluate(v,x),Ae=function(et,_t,ft,zt){for(var tr=[],xr=0,br=et;xr<br.length;xr+=1){var Zr=br[xr],pn=[Zr.x,Zr.y,0,1];Df(pn,pn,_t),tr.push(new ve(pn[0]/pn[3],pn[1]/pn[3]))}return tr}($,X),Qe=function(et,_t,ft,zt){for(var tr=[],xr=[],br=zt[8]*_t,Zr=zt[9]*_t,pn=zt[10]*_t,Un=zt[11]*_t,Ai=zt[8]*ft,ti=zt[9]*ft,Pi=zt[10]*ft,Xn=zt[11]*ft,ma=0,qi=et;ma<qi.length;ma+=1){for(var gi=[],La=[],ca=0,Va=qi[ma];ca<Va.length;ca+=1){var ki=Va[ca],to=ki.x,To=ki.y,_s=zt[0]*to+zt[4]*To+zt[12],$r=zt[1]*to+zt[5]*To+zt[13],Uo=zt[2]*to+zt[6]*To+zt[14],rr=zt[3]*to+zt[7]*To+zt[15],nu=Uo+pn,iu=rr+Un,zu=_s+Ai,xs=$r+ti,wu=Uo+Pi,Ko=rr+Xn,au=new ve((_s+br)/iu,($r+Zr)/iu);au.z=nu/iu,gi.push(au);var Fa=new ve(zu/Ko,xs/Ko);Fa.z=wu/Ko,La.push(Fa)}tr.push(gi),xr.push(La)}return[tr,xr]}(C,me,ne,X);return function(et,_t,ft){var zt=1/0;Xu(ft,_t)&&(zt=vh(ft,_t[0]));for(var tr=0;tr<_t.length;tr++)for(var xr=_t[tr],br=et[tr],Zr=0;Zr<xr.length-1;Zr++){var pn=xr[Zr],Un=[pn,xr[Zr+1],br[Zr+1],br[Zr],pn];lc(ft,Un)&&(zt=Math.min(zt,vh(ft,Un)))}return zt!==1/0&&zt}(Qe[0],Qe[1],Ae)},s}(Ru);function dh(i,s){return i.x*s.x+i.y*s.y}function vh(i,s){if(i.length===1){for(var l,v=0,x=s[v++];!l||x.equals(l);)if(!(l=s[v++]))return 1/0;for(;v<s.length;v++){var C=s[v],T=i[0],R=l.sub(x),U=C.sub(x),X=T.sub(x),$=dh(R,R),ne=dh(R,U),me=dh(U,U),Ae=dh(X,R),Qe=dh(X,U),et=$*me-ne*ne,_t=(me*Ae-ne*Qe)/et,ft=($*Qe-ne*Ae)/et,zt=x.z*(1-_t-ft)+l.z*_t+C.z*ft;if(isFinite(zt))return zt}return 1/0}for(var tr=1/0,xr=0,br=s;xr<br.length;xr+=1)tr=Math.min(tr,br[xr].z);return tr}var Zf=po([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Td=po([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Kp=Us.VectorTileFeature.types,qu=Math.cos(Math.PI/180*37.5),Mp=Math.pow(2,14)/.5,so=function(i){var s=this;this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new Rs,this.layoutVertexArray2=new Ao,this.indexArray=new sc,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};so.prototype.populate=function(i,s,l){this.hasPattern=vc("line",this.layers,s);for(var v=this.layers[0].layout.get("line-sort-key"),x=[],C=0,T=i;C<T.length;C+=1){var R=T[C],U=R.feature,X=R.id,$=R.index,ne=R.sourceLayerIndex,me=this.layers[0]._featureFilter.needGeometry,Ae=es(U,me);if(this.layers[0]._featureFilter.filter(new ua(this.zoom),Ae,l)){var Qe=v?v.evaluate(Ae,{},l):void 0,et={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ne,index:$,geometry:me?Ae.geometry:co(U),patterns:{},sortKey:Qe};x.push(et)}}v&&x.sort(function(pn,Un){return pn.sortKey-Un.sortKey});for(var _t=0,ft=x;_t<ft.length;_t+=1){var zt=ft[_t],tr=zt.geometry,xr=zt.index,br=zt.sourceLayerIndex;if(this.hasPattern){var Zr=sf("line",this.layers,zt,this.zoom,s);this.patternFeatures.push(Zr)}else this.addFeature(zt,tr,xr,l,{});s.featureIndex.insert(i[xr].feature,tr,xr,br,this.index)}},so.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},so.prototype.addFeatures=function(i,s,l){for(var v=0,x=this.patternFeatures;v<x.length;v+=1){var C=x[v];this.addFeature(C,C.geometry,C.index,s,l)}},so.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},so.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},so.prototype.upload=function(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Td)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Zf),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},so.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},so.prototype.lineFeatureClips=function(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}},so.prototype.addFeature=function(i,s,l,v,x){var C=this.layers[0].layout,T=C.get("line-join").evaluate(i,{}),R=C.get("line-cap"),U=C.get("line-miter-limit"),X=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(var $=0,ne=s;$<ne.length;$+=1)this.addLine(ne[$],i,T,R,U,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,v)},so.prototype.addLine=function(i,s,l,v,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<i.length-1;T++)this.totalDistance+=i[T].dist(i[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var R=Kp[s.type]==="Polygon",U=i.length;U>=2&&i[U-1].equals(i[U-2]);)U--;for(var X=0;X<U-1&&i[X].equals(i[X+1]);)X++;if(!(U<(R?3:2))){l==="bevel"&&(x=1.05);var $,ne=this.overscaling<=16?122880/(512*this.overscaling):0,me=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray),Ae=void 0,Qe=void 0,et=void 0,_t=void 0;this.e1=this.e2=-1,R&&(_t=i[X].sub($=i[U-2])._unit()._perp());for(var ft=X;ft<U;ft++)if(!(Qe=ft===U-1?R?i[X+1]:void 0:i[ft+1])||!i[ft].equals(Qe)){_t&&(et=_t),$&&(Ae=$),$=i[ft],_t=Qe?Qe.sub($)._unit()._perp():et;var zt=(et=et||_t).add(_t);zt.x===0&&zt.y===0||zt._unit();var tr=et.x*_t.x+et.y*_t.y,xr=zt.x*_t.x+zt.y*_t.y,br=xr!==0?1/xr:1/0,Zr=2*Math.sqrt(2-2*xr),pn=xr<qu&&Ae&&Qe,Un=et.x*_t.y-et.y*_t.x>0;if(pn&&ft>X){var Ai=$.dist(Ae);if(Ai>2*ne){var ti=$.sub($.sub(Ae)._mult(ne/Ai)._round());this.updateDistance(Ae,ti),this.addCurrentVertex(ti,et,0,0,me),Ae=ti}}var Pi=Ae&&Qe,Xn=Pi?l:R?"butt":v;if(Pi&&Xn==="round"&&(br<C?Xn="miter":br<=2&&(Xn="fakeround")),Xn==="miter"&&br>x&&(Xn="bevel"),Xn==="bevel"&&(br>2&&(Xn="flipbevel"),br<x&&(Xn="miter")),Ae&&this.updateDistance(Ae,$),Xn==="miter")zt._mult(br),this.addCurrentVertex($,zt,0,0,me);else if(Xn==="flipbevel"){if(br>100)zt=_t.mult(-1);else{var ma=br*et.add(_t).mag()/et.sub(_t).mag();zt._perp()._mult(ma*(Un?-1:1))}this.addCurrentVertex($,zt,0,0,me),this.addCurrentVertex($,zt.mult(-1),0,0,me)}else if(Xn==="bevel"||Xn==="fakeround"){var qi=-Math.sqrt(br*br-1),gi=Un?qi:0,La=Un?0:qi;if(Ae&&this.addCurrentVertex($,et,gi,La,me),Xn==="fakeround")for(var ca=Math.round(180*Zr/Math.PI/20),Va=1;Va<ca;Va++){var ki=Va/ca;if(ki!==.5){var to=ki-.5;ki+=ki*to*(ki-1)*((1.0904+tr*(tr*(3.55645-1.43519*tr)-3.2452))*to*to+(.848013+tr*(.215638*tr-1.06021)))}var To=_t.sub(et)._mult(ki)._add(et)._unit()._mult(Un?-1:1);this.addHalfVertex($,To.x,To.y,!1,Un,0,me)}Qe&&this.addCurrentVertex($,_t,-gi,-La,me)}else if(Xn==="butt")this.addCurrentVertex($,zt,0,0,me);else if(Xn==="square"){var _s=Ae?1:-1;this.addCurrentVertex($,zt,_s,_s,me)}else Xn==="round"&&(Ae&&(this.addCurrentVertex($,et,0,0,me),this.addCurrentVertex($,et,1,1,me,!0)),Qe&&(this.addCurrentVertex($,_t,-1,-1,me,!0),this.addCurrentVertex($,_t,0,0,me)));if(pn&&ft<U-1){var $r=$.dist(Qe);if($r>2*ne){var Uo=$.add(Qe.sub($)._mult(ne/$r)._round());this.updateDistance($,Uo),this.addCurrentVertex(Uo,_t,0,0,me),$=Uo}}}}},so.prototype.addCurrentVertex=function(i,s,l,v,x,C){C===void 0&&(C=!1);var T=s.y*v-s.x,R=-s.y-s.x*v;this.addHalfVertex(i,s.x+s.y*l,s.y-s.x*l,C,!1,l,x),this.addHalfVertex(i,T,R,C,!0,-v,x),this.distance>Mp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,s,l,v,x,C))},so.prototype.addHalfVertex=function(i,s,l,v,x,C,T){var R=.5*(this.lineClips?this.scaledDistance*(Mp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i.x<<1)+(v?1:0),(i.y<<1)+(x?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(C===0?0:C<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var U=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),T.primitiveLength++),x?this.e2=U:this.e1=U},so.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},so.prototype.updateDistance=function(i,s){this.distance+=i.dist(s),this.updateScaledDistance()},ni("LineBucket",so,{omit:["layers","patternFeatures"]});var Zc=new Yo({"line-cap":new _i(ke.layout_line["line-cap"]),"line-join":new pi(ke.layout_line["line-join"]),"line-miter-limit":new _i(ke.layout_line["line-miter-limit"]),"line-round-limit":new _i(ke.layout_line["line-round-limit"]),"line-sort-key":new pi(ke.layout_line["line-sort-key"])}),Ja={paint:new Yo({"line-opacity":new pi(ke.paint_line["line-opacity"]),"line-color":new pi(ke.paint_line["line-color"]),"line-translate":new _i(ke.paint_line["line-translate"]),"line-translate-anchor":new _i(ke.paint_line["line-translate-anchor"]),"line-width":new pi(ke.paint_line["line-width"]),"line-gap-width":new pi(ke.paint_line["line-gap-width"]),"line-offset":new pi(ke.paint_line["line-offset"]),"line-blur":new pi(ke.paint_line["line-blur"]),"line-dasharray":new Os(ke.paint_line["line-dasharray"]),"line-pattern":new kf(ke.paint_line["line-pattern"]),"line-gradient":new ll(ke.paint_line["line-gradient"])}),layout:Zc},Zs=new(function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,v){return v=new ua(Math.floor(v.zoom),{now:v.now,fadeDuration:v.fadeDuration,zoomHistory:v.zoomHistory,transition:v.transition}),i.prototype.possiblyEvaluate.call(this,l,v)},s.prototype.evaluate=function(l,v,x,C){return v=Ut({},v,{zoom:Math.floor(v.zoom)}),i.prototype.evaluate.call(this,l,v,x,C)},s}(pi))(Ja.paint.properties["line-width"].specification);Zs.useIntegerZoom=!0;var Qp=function(i){function s(l){i.call(this,l,Ja),this.gradientVersion=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%Be)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,v){i.prototype.recalculate.call(this,l,v),this.paint._values["line-floorwidth"]=Zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new so(l)},s.prototype.queryRadius=function(l){var v=l,x=Jp(Xl("line-width",this,v),Xl("line-gap-width",this,v)),C=Xl("line-offset",this,v);return x/2+Math.abs(C)+fs(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,v,x,C,T,R,U){var X=Ml(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,U),$=U/2*Jp(this.paint.get("line-width").evaluate(v,x),this.paint.get("line-gap-width").evaluate(v,x)),ne=this.paint.get("line-offset").evaluate(v,x);return ne&&(C=function(me,Ae){for(var Qe=[],et=new ve(0,0),_t=0;_t<me.length;_t++){for(var ft=me[_t],zt=[],tr=0;tr<ft.length;tr++){var xr=ft[tr],br=ft[tr+1],Zr=tr===0?et:xr.sub(ft[tr-1])._unit()._perp(),pn=tr===ft.length-1?et:br.sub(xr)._unit()._perp(),Un=Zr._add(pn)._unit();Un._mult(1/(Un.x*pn.x+Un.y*pn.y)),zt.push(Un._mult(Ae)._add(xr))}Qe.push(zt)}return Qe}(C,ne*U)),function(me,Ae,Qe){for(var et=0;et<Ae.length;et++){var _t=Ae[et];if(me.length>=3){for(var ft=0;ft<_t.length;ft++)if(fl(me,_t[ft]))return!0}if(Cu(me,_t,Qe))return!0}return!1}(X,C,$)},s.prototype.isTileClipped=function(){return!0},s}(Ru);function Jp(i,s){return s>0?s+2*i:i}var ev=po([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tv=po([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ip=(po([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),po([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Md=(po([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),po([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Pp=po([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ov(i,s,l){return i.sections.forEach(function(v){v.text=function(x,C,T){var R=C.layout.get("text-transform").evaluate(T,{});return R==="uppercase"?x=x.toLocaleUpperCase():R==="lowercase"&&(x=x.toLocaleLowerCase()),Ws.applyArabicShaping&&(x=Ws.applyArabicShaping(x)),x}(v.text,s,l)}),i}po([{name:"triangle",components:3,type:"Uint16"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),po([{type:"Float32",name:"offsetX"}]),po([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Jh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Id=function(i,s,l,v,x){var C,T,R=8*x-v-1,U=(1<<R)-1,X=U>>1,$=-7,ne=l?x-1:0,me=l?-1:1,Ae=i[s+ne];for(ne+=me,C=Ae&(1<<-$)-1,Ae>>=-$,$+=R;$>0;C=256*C+i[s+ne],ne+=me,$-=8);for(T=C&(1<<-$)-1,C>>=-$,$+=v;$>0;T=256*T+i[s+ne],ne+=me,$-=8);if(C===0)C=1-X;else{if(C===U)return T?NaN:1/0*(Ae?-1:1);T+=Math.pow(2,v),C-=X}return(Ae?-1:1)*T*Math.pow(2,C-v)},Rv=function(i,s,l,v,x,C){var T,R,U,X=8*C-x-1,$=(1<<X)-1,ne=$>>1,me=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ae=v?0:C-1,Qe=v?1:-1,et=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(R=isNaN(s)?1:0,T=$):(T=Math.floor(Math.log(s)/Math.LN2),s*(U=Math.pow(2,-T))<1&&(T--,U*=2),(s+=T+ne>=1?me/U:me*Math.pow(2,1-ne))*U>=2&&(T++,U/=2),T+ne>=$?(R=0,T=$):T+ne>=1?(R=(s*U-1)*Math.pow(2,x),T+=ne):(R=s*Math.pow(2,ne-1)*Math.pow(2,x),T=0));x>=8;i[l+Ae]=255&R,Ae+=Qe,R/=256,x-=8);for(T=T<<x|R,X+=x;X>0;i[l+Ae]=255&T,Ae+=Qe,T/=256,X-=8);i[l+Ae-Qe]|=128*et},mh=Eo;function Eo(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Eo.Varint=0,Eo.Fixed64=1,Eo.Bytes=2,Eo.Fixed32=5;var ed=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Vc(i){return i.type===Eo.Bytes?i.readVarint()+i.pos:i.pos+1}function ep(i,s,l){return l?4294967296*s+(i>>>0):4294967296*(s>>>0)+(i>>>0)}function Pd(i,s,l){var v=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(v);for(var x=l.pos-1;x>=i;x--)l.buf[x+v]=l.buf[x]}function td(i,s){for(var l=0;l<i.length;l++)s.writeVarint(i[l])}function W(i,s){for(var l=0;l<i.length;l++)s.writeSVarint(i[l])}function De(i,s){for(var l=0;l<i.length;l++)s.writeFloat(i[l])}function ut(i,s){for(var l=0;l<i.length;l++)s.writeDouble(i[l])}function dr(i,s){for(var l=0;l<i.length;l++)s.writeBoolean(i[l])}function zr(i,s){for(var l=0;l<i.length;l++)s.writeFixed32(i[l])}function pr(i,s){for(var l=0;l<i.length;l++)s.writeSFixed32(i[l])}function Lr(i,s){for(var l=0;l<i.length;l++)s.writeFixed64(i[l])}function Gr(i,s){for(var l=0;l<i.length;l++)s.writeSFixed64(i[l])}function qr(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+16777216*i[s+3]}function nn(i,s,l){i[l]=s,i[l+1]=s>>>8,i[l+2]=s>>>16,i[l+3]=s>>>24}function dn(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+(i[s+3]<<24)}function vn(i,s,l){i===1&&l.readMessage(kn,s)}function kn(i,s,l){if(i===3){var v=l.readMessage(an,{}),x=v.width,C=v.height,T=v.left,R=v.top,U=v.advance;s.push({id:v.id,bitmap:new Yl({width:x+6,height:C+6},v.bitmap),metrics:{width:x,height:C,left:T,top:R,advance:U}})}}function an(i,s,l){i===1?s.id=l.readVarint():i===2?s.bitmap=l.readBytes():i===3?s.width=l.readVarint():i===4?s.height=l.readVarint():i===5?s.left=l.readSVarint():i===6?s.top=l.readSVarint():i===7&&(s.advance=l.readVarint())}function hn(i){for(var s=0,l=0,v=0,x=i;v<x.length;v+=1){var C=x[v];s+=C.w*C.h,l=Math.max(l,C.w)}i.sort(function(et,_t){return _t.h-et.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],R=0,U=0,X=0,$=i;X<$.length;X+=1)for(var ne=$[X],me=T.length-1;me>=0;me--){var Ae=T[me];if(!(ne.w>Ae.w||ne.h>Ae.h)){if(ne.x=Ae.x,ne.y=Ae.y,U=Math.max(U,ne.y+ne.h),R=Math.max(R,ne.x+ne.w),ne.w===Ae.w&&ne.h===Ae.h){var Qe=T.pop();me<T.length&&(T[me]=Qe)}else ne.h===Ae.h?(Ae.x+=ne.w,Ae.w-=ne.w):ne.w===Ae.w?(Ae.y+=ne.h,Ae.h-=ne.h):(T.push({x:Ae.x+ne.w,y:Ae.y,w:Ae.w-ne.w,h:ne.h}),Ae.y+=ne.h,Ae.h-=ne.h);break}}return{w:R,h:U,fill:s/(R*U)||0}}Eo.prototype={destroy:function(){this.buf=null},readFields:function(i,s,l){for(l=l||this.length;this.pos<l;){var v=this.readVarint(),x=v>>3,C=this.pos;this.type=7&v,i(x,s,this),this.pos===C&&this.skip(v)}return s},readMessage:function(i,s){return this.readFields(i,s,this.readVarint()+this.pos)},readFixed32:function(){var i=qr(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=dn(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=qr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=qr(this.buf,this.pos)+4294967296*dn(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=Id(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Id(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var s,l,v=this.buf;return s=127&(l=v[this.pos++]),l<128?s:(s|=(127&(l=v[this.pos++]))<<7,l<128?s:(s|=(127&(l=v[this.pos++]))<<14,l<128?s:(s|=(127&(l=v[this.pos++]))<<21,l<128?s:function(x,C,T){var R,U,X=T.buf;if(R=(112&(U=X[T.pos++]))>>4,U<128||(R|=(127&(U=X[T.pos++]))<<3,U<128)||(R|=(127&(U=X[T.pos++]))<<10,U<128)||(R|=(127&(U=X[T.pos++]))<<17,U<128)||(R|=(127&(U=X[T.pos++]))<<24,U<128)||(R|=(1&(U=X[T.pos++]))<<31,U<128))return ep(x,R,C);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=v[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,s=this.pos;return this.pos=i,i-s>=12&&ed?function(l,v,x){return ed.decode(l.subarray(v,x))}(this.buf,s,i):function(l,v,x){for(var C="",T=v;T<x;){var R,U,X,$=l[T],ne=null,me=$>239?4:$>223?3:$>191?2:1;if(T+me>x)break;me===1?$<128&&(ne=$):me===2?(192&(R=l[T+1]))==128&&(ne=(31&$)<<6|63&R)<=127&&(ne=null):me===3?(U=l[T+2],(192&(R=l[T+1]))==128&&(192&U)==128&&((ne=(15&$)<<12|(63&R)<<6|63&U)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):me===4&&(U=l[T+2],X=l[T+3],(192&(R=l[T+1]))==128&&(192&U)==128&&(192&X)==128&&((ne=(15&$)<<18|(63&R)<<12|(63&U)<<6|63&X)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,me=1):ne>65535&&(ne-=65536,C+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),C+=String.fromCharCode(ne),T+=me}return C}(this.buf,s,i)},readBytes:function(){var i=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,i);return this.pos=i,s},readPackedVarint:function(i,s){if(this.type!==Eo.Bytes)return i.push(this.readVarint(s));var l=Vc(this);for(i=i||[];this.pos<l;)i.push(this.readVarint(s));return i},readPackedSVarint:function(i){if(this.type!==Eo.Bytes)return i.push(this.readSVarint());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Eo.Bytes)return i.push(this.readBoolean());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Eo.Bytes)return i.push(this.readFloat());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Eo.Bytes)return i.push(this.readDouble());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Eo.Bytes)return i.push(this.readFixed32());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Eo.Bytes)return i.push(this.readSFixed32());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Eo.Bytes)return i.push(this.readFixed64());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Eo.Bytes)return i.push(this.readSFixed64());var s=Vc(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed64());return i},skip:function(i){var s=7&i;if(s===Eo.Varint)for(;this.buf[this.pos++]>127;);else if(s===Eo.Bytes)this.pos=this.readVarint()+this.pos;else if(s===Eo.Fixed32)this.pos+=4;else{if(s!==Eo.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(i,s){this.writeVarint(i<<3|s)},realloc:function(i){for(var s=this.length||16;s<this.pos+i;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),nn(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),nn(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),nn(this.buf,-1&i,this.pos),nn(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),nn(this.buf,-1&i,this.pos),nn(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(s,l){var v,x;if(s>=0?(v=s%4294967296|0,x=s/4294967296|0):(x=~(-s/4294967296),4294967295^(v=~(-s%4294967296))?v=v+1|0:(v=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(C,T,R){R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,C>>>=7,R.buf[R.pos++]=127&C|128,R.buf[R.pos]=127&(C>>>=7)}(v,0,l),function(C,T){var R=(7&C)<<4;T.buf[T.pos++]|=R|((C>>>=3)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C)))))}(x,l)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var s=this.pos;this.pos=function(v,x,C){for(var T,R,U=0;U<x.length;U++){if((T=x.charCodeAt(U))>55295&&T<57344){if(!R){T>56319||U+1===x.length?(v[C++]=239,v[C++]=191,v[C++]=189):R=T;continue}if(T<56320){v[C++]=239,v[C++]=191,v[C++]=189,R=T;continue}T=R-55296<<10|T-56320|65536,R=null}else R&&(v[C++]=239,v[C++]=191,v[C++]=189,R=null);T<128?v[C++]=T:(T<2048?v[C++]=T>>6|192:(T<65536?v[C++]=T>>12|224:(v[C++]=T>>18|240,v[C++]=T>>12&63|128),v[C++]=T>>6&63|128),v[C++]=63&T|128)}return C}(this.buf,i,this.pos);var l=this.pos-s;l>=128&&Pd(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(i){this.realloc(4),Rv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Rv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var s=i.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=i[l]},writeRawMessage:function(i,s){this.pos++;var l=this.pos;i(s,this);var v=this.pos-l;v>=128&&Pd(l,v,this),this.pos=l-1,this.writeVarint(v),this.pos+=v},writeMessage:function(i,s,l){this.writeTag(i,Eo.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(i,s){s.length&&this.writeMessage(i,td,s)},writePackedSVarint:function(i,s){s.length&&this.writeMessage(i,W,s)},writePackedBoolean:function(i,s){s.length&&this.writeMessage(i,dr,s)},writePackedFloat:function(i,s){s.length&&this.writeMessage(i,De,s)},writePackedDouble:function(i,s){s.length&&this.writeMessage(i,ut,s)},writePackedFixed32:function(i,s){s.length&&this.writeMessage(i,zr,s)},writePackedSFixed32:function(i,s){s.length&&this.writeMessage(i,pr,s)},writePackedFixed64:function(i,s){s.length&&this.writeMessage(i,Lr,s)},writePackedSFixed64:function(i,s){s.length&&this.writeMessage(i,Gr,s)},writeBytesField:function(i,s){this.writeTag(i,Eo.Bytes),this.writeBytes(s)},writeFixed32Field:function(i,s){this.writeTag(i,Eo.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(i,s){this.writeTag(i,Eo.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(i,s){this.writeTag(i,Eo.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(i,s){this.writeTag(i,Eo.Fixed64),this.writeSFixed64(s)},writeVarintField:function(i,s){this.writeTag(i,Eo.Varint),this.writeVarint(s)},writeSVarintField:function(i,s){this.writeTag(i,Eo.Varint),this.writeSVarint(s)},writeStringField:function(i,s){this.writeTag(i,Eo.Bytes),this.writeString(s)},writeFloatField:function(i,s){this.writeTag(i,Eo.Fixed32),this.writeFloat(s)},writeDoubleField:function(i,s){this.writeTag(i,Eo.Fixed64),this.writeDouble(s)},writeBooleanField:function(i,s){this.writeVarintField(i,Boolean(s))}};var Zt=function(i,s){var l=s.pixelRatio,v=s.version,x=s.stretchX,C=s.stretchY,T=s.content;this.paddedRect=i,this.pixelRatio=l,this.stretchX=x,this.stretchY=C,this.content=T,this.version=v},Cr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Cr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Cr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Cr.tlbr.get=function(){return this.tl.concat(this.br)},Cr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Zt.prototype,Cr);var rn=function(i,s){var l={},v={};this.haveRenderCallbacks=[];var x=[];this.addImages(i,l,x),this.addImages(s,v,x);var C=hn(x),T=new Ns({width:C.w||1,height:C.h||1});for(var R in i){var U=i[R],X=l[R].paddedRect;Ns.copy(U.data,T,{x:0,y:0},{x:X.x+1,y:X.y+1},U.data)}for(var $ in s){var ne=s[$],me=v[$].paddedRect,Ae=me.x+1,Qe=me.y+1,et=ne.data.width,_t=ne.data.height;Ns.copy(ne.data,T,{x:0,y:0},{x:Ae,y:Qe},ne.data),Ns.copy(ne.data,T,{x:0,y:_t-1},{x:Ae,y:Qe-1},{width:et,height:1}),Ns.copy(ne.data,T,{x:0,y:0},{x:Ae,y:Qe+_t},{width:et,height:1}),Ns.copy(ne.data,T,{x:et-1,y:0},{x:Ae-1,y:Qe},{width:1,height:_t}),Ns.copy(ne.data,T,{x:0,y:0},{x:Ae+et,y:Qe},{width:1,height:_t})}this.image=T,this.iconPositions=l,this.patternPositions=v};rn.prototype.addImages=function(i,s,l){for(var v in i){var x=i[v],C={x:0,y:0,w:x.data.width+2,h:x.data.height+2};l.push(C),s[v]=new Zt(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(v)}},rn.prototype.patchUpdatedImages=function(i,s){for(var l in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[l],i.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],i.getImage(l),s)},rn.prototype.patchUpdatedImage=function(i,s,l){if(i&&s&&i.version!==s.version){i.version=s.version;var v=i.tl;l.update(s.data,void 0,{x:v[0],y:v[1]})}},ni("ImagePosition",Zt),ni("ImageAtlas",rn);var On={horizontal:1,vertical:2,horizontalOnly:3},Ur=function(){this.scale=1,this.fontStack="",this.imageName=null};Ur.forText=function(i,s){var l=new Ur;return l.scale=i||1,l.fontStack=s,l},Ur.forImage=function(i){var s=new Ur;return s.imageName=i,s};var _n=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Nn(i,s,l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et){var _t,ft=_n.fromFeature(i,x);ne===On.vertical&&ft.verticalizePunctuation();var zt=Ws.processBidirectionalText,tr=Ws.processStyledBidirectionalText;if(zt&&ft.sections.length===1){_t=[];for(var xr=0,br=zt(ft.toString(),zn(ft,X,C,s,v,Ae,Qe));xr<br.length;xr+=1){var Zr=br[xr],pn=new _n;pn.text=Zr,pn.sections=ft.sections;for(var Un=0;Un<Zr.length;Un++)pn.sectionIndex.push(0);_t.push(pn)}}else if(tr){_t=[];for(var Ai=0,ti=tr(ft.text,ft.sectionIndex,zn(ft,X,C,s,v,Ae,Qe));Ai<ti.length;Ai+=1){var Pi=ti[Ai],Xn=new _n;Xn.text=Pi[0],Xn.sectionIndex=Pi[1],Xn.sections=ft.sections,_t.push(Xn)}}else _t=function(gi,La){for(var ca=[],Va=gi.text,ki=0,to=0,To=La;to<To.length;to+=1){var _s=To[to];ca.push(gi.substring(ki,_s)),ki=_s}return ki<Va.length&&ca.push(gi.substring(ki,Va.length)),ca}(ft,zn(ft,X,C,s,v,Ae,Qe));var ma=[],qi={positionedLines:ma,text:ft.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return function(gi,La,ca,Va,ki,to,To,_s,$r,Uo,rr,nu){for(var iu=0,zu=-17,xs=0,wu=0,Ko=_s==="right"?1:_s==="left"?0:.5,au=0,Fa=0,Co=ki;Fa<Co.length;Fa+=1){var vo=Co[Fa];vo.trim();var Ga=vo.getMaxScale(),$u=24*(Ga-1),mu={positionedGlyphs:[],lineOffset:0};gi.positionedLines[au]=mu;var Zo=mu.positionedGlyphs,Ms=0;if(vo.length()){for(var Tu=0;Tu<vo.length();Tu++){var Ha=vo.getSection(Tu),Ll=vo.getSectionIndex(Tu),bc=vo.getCharCode(Tu),dl=0,bs=null,Hc=null,Wc=null,rd=24,ip=!($r===On.horizontal||!rr&&!Mh(bc)||rr&&(Ti[bc]||(ff=bc,In.Arabic(ff)||In["Arabic Supplement"](ff)||In["Arabic Extended-A"](ff)||In["Arabic Presentation Forms-A"](ff)||In["Arabic Presentation Forms-B"](ff))));if(Ha.imageName){var nd=Va[Ha.imageName];if(!nd)continue;Wc=Ha.imageName,gi.iconsInText=gi.iconsInText||!0,Hc=nd.paddedRect;var ap=nd.displaySize;Ha.scale=24*Ha.scale/nu,dl=$u+(24-ap[1]*Ha.scale),rd=(bs={width:ap[0],height:ap[1],left:1,top:-3,advance:ip?ap[1]:ap[0]}).advance;var id=ip?ap[0]*Ha.scale-24*Ga:ap[1]*Ha.scale-24*Ga;id>0&&id>Ms&&(Ms=id)}else{var op=ca[Ha.fontStack],sp=op&&op[bc];if(sp&&sp.rect)Hc=sp.rect,bs=sp.metrics;else{var kp=La[Ha.fontStack],Bh=kp&&kp[bc];if(!Bh)continue;bs=Bh.metrics}dl=24*(Ga-Ha.scale)}ip?(gi.verticalizable=!0,Zo.push({glyph:bc,imageName:Wc,x:iu,y:zu+dl,vertical:ip,scale:Ha.scale,fontStack:Ha.fontStack,sectionIndex:Ll,metrics:bs,rect:Hc}),iu+=rd*Ha.scale+Uo):(Zo.push({glyph:bc,imageName:Wc,x:iu,y:zu+dl,vertical:ip,scale:Ha.scale,fontStack:Ha.fontStack,sectionIndex:Ll,metrics:bs,rect:Hc}),iu+=bs.advance*Ha.scale+Uo)}Zo.length!==0&&(xs=Math.max(iu-Uo,xs),la(Zo,0,Zo.length-1,Ko,Ms)),iu=0;var ad=to*Ga+Ms;mu.lineOffset=Math.max(Ms,$u),zu+=ad,wu=Math.max(ad,wu),++au}else zu+=to,++au}var ff,Od=zu- -17,Lp=Pn(To),Nh=Lp.horizontalAlign,Ec=Lp.verticalAlign;(function(Rd,mo,Xc,od,sd,Op,Rp,Dp,ud){var jf,ld=(mo-Xc)*sd;jf=Op!==Rp?-Dp*od- -17:(-od*ud+.5)*Rp;for(var up=0,Ol=Rd;up<Ol.length;up+=1)for(var Ql=0,_h=Ol[up].positionedGlyphs;Ql<_h.length;Ql+=1){var cd=_h[Ql];cd.x+=ld,cd.y+=jf}})(gi.positionedLines,Ko,Nh,Ec,xs,wu,to,Od,ki.length),gi.top+=-Ec*Od,gi.bottom=gi.top+Od,gi.left+=-Nh*xs,gi.right=gi.left+xs}(qi,s,l,v,_t,T,R,U,ne,X,me,et),!function(gi){for(var La=0,ca=gi;La<ca.length;La+=1)if(ca[La].positionedGlyphs.length!==0)return!1;return!0}(ma)&&qi}_n.fromFeature=function(i,s){for(var l=new _n,v=0;v<i.sections.length;v++){var x=i.sections[v];x.image?l.addImageSection(x):l.addTextSection(x,s)}return l},_n.prototype.length=function(){return this.text.length},_n.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},_n.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},_n.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},_n.prototype.verticalizePunctuation=function(){this.text=function(i){for(var s="",l=0;l<i.length;l++){var v=i.charCodeAt(l+1)||null,x=i.charCodeAt(l-1)||null;s+=v&&xa(v)&&!Jh[i[l+1]]||x&&xa(x)&&!Jh[i[l-1]]||!Jh[i[l]]?i[l]:Jh[i[l]]}return s}(this.text)},_n.prototype.trim=function(){for(var i=0,s=0;s<this.text.length&&Ti[this.text.charCodeAt(s)];s++)i++;for(var l=this.text.length,v=this.text.length-1;v>=0&&v>=i&&Ti[this.text.charCodeAt(v)];v--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)},_n.prototype.substring=function(i,s){var l=new _n;return l.text=this.text.substring(i,s),l.sectionIndex=this.sectionIndex.slice(i,s),l.sections=this.sections,l},_n.prototype.toString=function(){return this.text},_n.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,i.sections[l].scale)},0)},_n.prototype.addTextSection=function(i,s){this.text+=i.text,this.sections.push(Ur.forText(i.scale,i.fontStack||s));for(var l=this.sections.length-1,v=0;v<i.text.length;++v)this.sectionIndex.push(l)},_n.prototype.addImageSection=function(i){var s=i.image?i.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ur.forImage(s)),this.sectionIndex.push(this.sections.length-1)):je("Reached maximum number of images 6401")}else je("Can't add FormattedSection with an empty image.")},_n.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ti={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kr={};function Fr(i,s,l,v,x,C){if(s.imageName){var T=v[s.imageName];return T?T.displaySize[0]*s.scale*24/C+x:0}var R=l[s.fontStack],U=R&&R[i];return U?U.metrics.advance*s.scale+x:0}function oi(i,s,l,v){var x=Math.pow(i-s,2);return v?i<s?x/2:2*x:x+Math.abs(l)*l}function Rn(i,s,l){var v=0;return i===10&&(v-=1e4),l&&(v+=150),i!==40&&i!==65288||(v+=50),s!==41&&s!==65289||(v+=50),v}function on(i,s,l,v,x,C){for(var T=null,R=oi(s,l,x,C),U=0,X=v;U<X.length;U+=1){var $=X[U],ne=oi(s-$.x,l,x,C)+$.badness;ne<=R&&(T=$,R=ne)}return{index:i,x:s,priorBreak:T,badness:R}}function zn(i,s,l,v,x,C,T){if(C!=="point")return[];if(!i)return[];for(var R,U=[],X=function(_t,ft,zt,tr,xr,br){for(var Zr=0,pn=0;pn<_t.length();pn++){var Un=_t.getSection(pn);Zr+=Fr(_t.getCharCode(pn),Un,tr,xr,ft,br)}return Zr/Math.max(1,Math.ceil(Zr/zt))}(i,s,l,v,x,T),$=i.text.indexOf("\u200B")>=0,ne=0,me=0;me<i.length();me++){var Ae=i.getSection(me),Qe=i.getCharCode(me);if(Ti[Qe]||(ne+=Fr(Qe,Ae,v,x,s,T)),me<i.length()-1){var et=!((R=Qe)<11904||!(In["Bopomofo Extended"](R)||In.Bopomofo(R)||In["CJK Compatibility Forms"](R)||In["CJK Compatibility Ideographs"](R)||In["CJK Compatibility"](R)||In["CJK Radicals Supplement"](R)||In["CJK Strokes"](R)||In["CJK Symbols and Punctuation"](R)||In["CJK Unified Ideographs Extension A"](R)||In["CJK Unified Ideographs"](R)||In["Enclosed CJK Letters and Months"](R)||In["Halfwidth and Fullwidth Forms"](R)||In.Hiragana(R)||In["Ideographic Description Characters"](R)||In["Kangxi Radicals"](R)||In["Katakana Phonetic Extensions"](R)||In.Katakana(R)||In["Vertical Forms"](R)||In["Yi Radicals"](R)||In["Yi Syllables"](R)));(kr[Qe]||et||Ae.imageName)&&U.push(on(me+1,ne,X,U,Rn(Qe,i.getCharCode(me+1),et&&$),!1))}}return function _t(ft){return ft?_t(ft.priorBreak).concat(ft.index):[]}(on(i.length(),ne,X,U,0,!0))}function Pn(i){var s=.5,l=.5;switch(i){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function la(i,s,l,v,x){if(v||x)for(var C=i[l],T=(i[l].x+C.metrics.advance*C.scale)*v,R=s;R<=l;R++)i[R].x-=T,i[R].y+=x}function Gi(i,s,l,v,x,C){var T,R=i.image;if(R.content){var U=R.content,X=R.pixelRatio||1;T=[U[0]/X,U[1]/X,R.displaySize[0]-U[2]/X,R.displaySize[1]-U[3]/X]}var $,ne,me,Ae,Qe=s.left*C,et=s.right*C;l==="width"||l==="both"?(Ae=x[0]+Qe-v[3],ne=x[0]+et+v[1]):ne=(Ae=x[0]+(Qe+et-R.displaySize[0])/2)+R.displaySize[0];var _t=s.top*C,ft=s.bottom*C;return l==="height"||l==="both"?($=x[1]+_t-v[0],me=x[1]+ft+v[2]):me=($=x[1]+(_t+ft-R.displaySize[1])/2)+R.displaySize[1],{image:R,top:$,right:ne,bottom:me,left:Ae,collisionPadding:T}}kr[10]=!0,kr[32]=!0,kr[38]=!0,kr[40]=!0,kr[41]=!0,kr[43]=!0,kr[45]=!0,kr[47]=!0,kr[173]=!0,kr[183]=!0,kr[8203]=!0,kr[8208]=!0,kr[8211]=!0,kr[8231]=!0;var Dn=function(i){function s(l,v,x,C){i.call(this,l,v),this.angle=x,C!==void 0&&(this.segment=C)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ve);function Bn(i,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ua(i+1))};if(l.kind==="source")return{kind:"source"};for(var v=l.zoomStops,x=l.interpolationType,C=0;C<v.length&&v[C]<=i;)C++;for(var T=C=Math.max(0,C-1);T<v.length&&v[T]<i+1;)T++;T=Math.min(v.length-1,T);var R=v[C],U=v[T];return l.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:U,interpolationType:x}:{kind:"camera",minZoom:R,maxZoom:U,minSize:l.evaluate(new ua(R)),maxSize:l.evaluate(new ua(U)),interpolationType:x}}function Li(i,s,l){var v=s.uSize,x=l.lowerSize;return i.kind==="source"?x/128:i.kind==="composite"?fa(x/128,l.upperSize/128,s.uSizeT):v}function ta(i,s){var l=0,v=0;if(i.kind==="constant")v=i.layoutSize;else if(i.kind!=="source"){var x=i.interpolationType,C=x?Et(Ue.interpolationFactor(x,s,i.minZoom,i.maxZoom),0,1):0;i.kind==="camera"?v=fa(i.minSize,i.maxSize,C):l=C}return{uSizeT:l,uSize:v}}ni("Anchor",Dn);var Ma=Object.freeze({__proto__:null,getSizeData:Bn,evaluateSizeForFeature:Li,evaluateSizeForZoom:ta,SIZE_PACK_FACTOR:128});function qo(i,s,l,v,x){if(s.segment===void 0)return!0;for(var C=s,T=s.segment+1,R=0;R>-l/2;){if(--T<0)return!1;R-=i[T].dist(C),C=i[T]}R+=i[T].dist(i[T+1]),T++;for(var U=[],X=0;R<l/2;){var $=i[T],ne=i[T+1];if(!ne)return!1;var me=i[T-1].angleTo($)-$.angleTo(ne);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:R,angleDelta:me}),X+=me;R-U[0].distance>v;)X-=U.shift().angleDelta;if(X>x)return!1;T++,R+=$.dist(ne)}return!0}function $o(i){for(var s=0,l=0;l<i.length-1;l++)s+=i[l].dist(i[l+1]);return s}function Sa(i,s,l){return i?.6*s*l:0}function Ys(i,s){return Math.max(i?i.right-i.left:0,s?s.right-s.left:0)}function wo(i,s,l,v,x,C){for(var T=Sa(l,x,C),R=Ys(l,v)*C,U=0,X=$o(i)/2,$=0;$<i.length-1;$++){var ne=i[$],me=i[$+1],Ae=ne.dist(me);if(U+Ae>X){var Qe=(X-U)/Ae,et=fa(ne.x,me.x,Qe),_t=fa(ne.y,me.y,Qe),ft=new Dn(et,_t,me.angleTo(ne),$);return ft._round(),!T||qo(i,ft,R,T,s)?ft:void 0}U+=Ae}}function Vs(i,s,l,v,x,C,T,R,U){var X=Sa(v,C,T),$=Ys(v,x),ne=$*T,me=i[0].x===0||i[0].x===U||i[0].y===0||i[0].y===U;return s-ne<s/4&&(s=ne+s/4),function Ae(Qe,et,_t,ft,zt,tr,xr,br,Zr){for(var pn=tr/2,Un=$o(Qe),Ai=0,ti=et-_t,Pi=[],Xn=0;Xn<Qe.length-1;Xn++){for(var ma=Qe[Xn],qi=Qe[Xn+1],gi=ma.dist(qi),La=qi.angleTo(ma);ti+_t<Ai+gi;){var ca=((ti+=_t)-Ai)/gi,Va=fa(ma.x,qi.x,ca),ki=fa(ma.y,qi.y,ca);if(Va>=0&&Va<Zr&&ki>=0&&ki<Zr&&ti-pn>=0&&ti+pn<=Un){var to=new Dn(Va,ki,La,Xn);to._round(),ft&&!qo(Qe,to,tr,ft,zt)||Pi.push(to)}}Ai+=gi}return br||Pi.length||xr||(Pi=Ae(Qe,Ai/2,_t,ft,zt,tr,xr,!0,Zr)),Pi}(i,me?s/2*R%s:($/2+2*C)*T*R%s,s,X,l,ne,me,!1,U)}function gs(i,s,l,v,x){for(var C=[],T=0;T<i.length;T++)for(var R=i[T],U=void 0,X=0;X<R.length-1;X++){var $=R[X],ne=R[X+1];$.x<s&&ne.x<s||($.x<s?$=new ve(s,$.y+(s-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x<s&&(ne=new ve(s,$.y+(s-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y<l&&ne.y<l||($.y<l?$=new ve($.x+(l-$.y)/(ne.y-$.y)*(ne.x-$.x),l)._round():ne.y<l&&(ne=new ve($.x+(l-$.y)/(ne.y-$.y)*(ne.x-$.x),l)._round()),$.x>=v&&ne.x>=v||($.x>=v?$=new ve(v,$.y+(v-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x>=v&&(ne=new ve(v,$.y+(v-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y>=x&&ne.y>=x||($.y>=x?$=new ve($.x+(x-$.y)/(ne.y-$.y)*(ne.x-$.x),x)._round():ne.y>=x&&(ne=new ve($.x+(x-$.y)/(ne.y-$.y)*(ne.x-$.x),x)._round()),U&&$.equals(U[U.length-1])||C.push(U=[$]),U.push(ne)))))}return C}function As(i,s,l,v){var x=[],C=i.image,T=C.pixelRatio,R=C.paddedRect.w-2,U=C.paddedRect.h-2,X=i.right-i.left,$=i.bottom-i.top,ne=C.stretchX||[[0,R]],me=C.stretchY||[[0,U]],Ae=function(Va,ki){return Va+ki[1]-ki[0]},Qe=ne.reduce(Ae,0),et=me.reduce(Ae,0),_t=R-Qe,ft=U-et,zt=0,tr=Qe,xr=0,br=et,Zr=0,pn=_t,Un=0,Ai=ft;if(C.content&&v){var ti=C.content;zt=js(ne,0,ti[0]),xr=js(me,0,ti[1]),tr=js(ne,ti[0],ti[2]),br=js(me,ti[1],ti[3]),Zr=ti[0]-zt,Un=ti[1]-xr,pn=ti[2]-ti[0]-tr,Ai=ti[3]-ti[1]-br}var Pi=function(Va,ki,to,To){var _s=zo(Va.stretch-zt,tr,X,i.left),$r=sa(Va.fixed-Zr,pn,Va.stretch,Qe),Uo=zo(ki.stretch-xr,br,$,i.top),rr=sa(ki.fixed-Un,Ai,ki.stretch,et),nu=zo(to.stretch-zt,tr,X,i.left),iu=sa(to.fixed-Zr,pn,to.stretch,Qe),zu=zo(To.stretch-xr,br,$,i.top),xs=sa(To.fixed-Un,Ai,To.stretch,et),wu=new ve(_s,Uo),Ko=new ve(nu,Uo),au=new ve(nu,zu),Fa=new ve(_s,zu),Co=new ve($r/T,rr/T),vo=new ve(iu/T,xs/T),Ga=s*Math.PI/180;if(Ga){var $u=Math.sin(Ga),mu=Math.cos(Ga),Zo=[mu,-$u,$u,mu];wu._matMult(Zo),Ko._matMult(Zo),Fa._matMult(Zo),au._matMult(Zo)}var Ms=Va.stretch+Va.fixed,Tu=ki.stretch+ki.fixed;return{tl:wu,tr:Ko,bl:Fa,br:au,tex:{x:C.paddedRect.x+1+Ms,y:C.paddedRect.y+1+Tu,w:to.stretch+to.fixed-Ms,h:To.stretch+To.fixed-Tu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Co,pixelOffsetBR:vo,minFontScaleX:pn/T/X,minFontScaleY:Ai/T/$,isSDF:l}};if(v&&(C.stretchX||C.stretchY))for(var Xn=vu(ne,_t,Qe),ma=vu(me,ft,et),qi=0;qi<Xn.length-1;qi++)for(var gi=Xn[qi],La=Xn[qi+1],ca=0;ca<ma.length-1;ca++)x.push(Pi(gi,ma[ca],La,ma[ca+1]));else x.push(Pi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:U+1}));return x}function js(i,s,l){for(var v=0,x=0,C=i;x<C.length;x+=1){var T=C[x];v+=Math.max(s,Math.min(l,T[1]))-Math.max(s,Math.min(l,T[0]))}return v}function vu(i,s,l){for(var v=[{fixed:-1,stretch:0}],x=0,C=i;x<C.length;x+=1){var T=C[x],R=T[0],U=T[1],X=v[v.length-1];v.push({fixed:R-X.stretch,stretch:X.stretch}),v.push({fixed:R-X.stretch,stretch:X.stretch+(U-R)})}return v.push({fixed:s+1,stretch:l}),v}function zo(i,s,l,v){return i/s*l+v}function sa(i,s,l,v){return i-s*l/v}var ws=function(i,s,l,v,x,C,T,R,U,X){if(this.boxStartIndex=i.length,U){var $=C.top,ne=C.bottom,me=C.collisionPadding;me&&($-=me[1],ne+=me[3]);var Ae=ne-$;Ae>0&&(Ae=Math.max(10,Ae),this.circleDiameter=Ae)}else{var Qe=C.top*T-R,et=C.bottom*T+R,_t=C.left*T-R,ft=C.right*T+R,zt=C.collisionPadding;if(zt&&(_t-=zt[0]*T,Qe-=zt[1]*T,ft+=zt[2]*T,et+=zt[3]*T),X){var tr=new ve(_t,Qe),xr=new ve(ft,Qe),br=new ve(_t,et),Zr=new ve(ft,et),pn=X*Math.PI/180;tr._rotate(pn),xr._rotate(pn),br._rotate(pn),Zr._rotate(pn),_t=Math.min(tr.x,xr.x,br.x,Zr.x),ft=Math.max(tr.x,xr.x,br.x,Zr.x),Qe=Math.min(tr.y,xr.y,br.y,Zr.y),et=Math.max(tr.y,xr.y,br.y,Zr.y)}i.emplaceBack(s.x,s.y,_t,Qe,ft,et,l,v,x)}this.boxEndIndex=i.length},Za=function(i,s){if(i===void 0&&(i=[]),s===void 0&&(s=ru),this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function ru(i,s){return i<s?-1:i>s?1:0}function Yi(i,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var v=1/0,x=1/0,C=-1/0,T=-1/0,R=i[0],U=0;U<R.length;U++){var X=R[U];(!U||X.x<v)&&(v=X.x),(!U||X.y<x)&&(x=X.y),(!U||X.x>C)&&(C=X.x),(!U||X.y>T)&&(T=X.y)}var $=Math.min(C-v,T-x),ne=$/2,me=new Za([],Ia);if($===0)return new ve(v,x);for(var Ae=v;Ae<C;Ae+=$)for(var Qe=x;Qe<T;Qe+=$)me.push(new eo(Ae+ne,Qe+ne,ne,i));for(var et=function(zt){for(var tr=0,xr=0,br=0,Zr=zt[0],pn=0,Un=Zr.length,Ai=Un-1;pn<Un;Ai=pn++){var ti=Zr[pn],Pi=Zr[Ai],Xn=ti.x*Pi.y-Pi.x*ti.y;xr+=(ti.x+Pi.x)*Xn,br+=(ti.y+Pi.y)*Xn,tr+=3*Xn}return new eo(xr/tr,br/tr,0,zt)}(i),_t=me.length;me.length;){var ft=me.pop();(ft.d>et.d||!et.d)&&(et=ft,l&&console.log("found best %d after %d probes",Math.round(1e4*ft.d)/1e4,_t)),ft.max-et.d<=s||(me.push(new eo(ft.p.x-(ne=ft.h/2),ft.p.y-ne,ne,i)),me.push(new eo(ft.p.x+ne,ft.p.y-ne,ne,i)),me.push(new eo(ft.p.x-ne,ft.p.y+ne,ne,i)),me.push(new eo(ft.p.x+ne,ft.p.y+ne,ne,i)),_t+=4)}return l&&(console.log("num probes: "+_t),console.log("best distance: "+et.d)),et.p}function Ia(i,s){return s.max-i.max}function eo(i,s,l,v){this.p=new ve(i,s),this.h=l,this.d=function(x,C){for(var T=!1,R=1/0,U=0;U<C.length;U++)for(var X=C[U],$=0,ne=X.length,me=ne-1;$<ne;me=$++){var Ae=X[$],Qe=X[me];Ae.y>x.y!=Qe.y>x.y&&x.x<(Qe.x-Ae.x)*(x.y-Ae.y)/(Qe.y-Ae.y)+Ae.x&&(T=!T),R=Math.min(R,Tl(x,Ae,Qe))}return(T?1:-1)*Math.sqrt(R)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}Za.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},Za.prototype.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}},Za.prototype.peek=function(){return this.data[0]},Za.prototype._up=function(i){for(var s=this.data,l=this.compare,v=s[i];i>0;){var x=i-1>>1,C=s[x];if(l(v,C)>=0)break;s[i]=C,i=x}s[i]=v},Za.prototype._down=function(i){for(var s=this.data,l=this.compare,v=this.length>>1,x=s[i];i<v;){var C=1+(i<<1),T=s[C],R=C+1;if(R<this.length&&l(s[R],T)<0&&(C=R,T=s[R]),l(T,x)>=0)break;s[i]=T,i=C}s[i]=x};var ys=Number.POSITIVE_INFINITY;function cf(i,s){return s[1]!==ys?function(l,v,x){var C=0,T=0;switch(v=Math.abs(v),x=Math.abs(x),l){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(l){case"top-right":case"bottom-right":case"right":C=-v;break;case"top-left":case"bottom-left":case"left":C=v}return[C,T]}(i,s[0],s[1]):function(l,v){var x=0,C=0;v<0&&(v=0);var T=v/Math.sqrt(2);switch(l){case"top-right":case"top-left":C=T-7;break;case"bottom-right":case"bottom-left":C=7-T;break;case"bottom":C=7-v;break;case"top":C=v-7}switch(l){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=v;break;case"right":x=-v}return[x,C]}(i,s[0])}function Ke(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gr(i,s,l,v,x,C,T,R,U,X,$,ne,me,Ae,Qe){var et=function(xr,br,Zr,pn,Un,Ai,ti,Pi){for(var Xn=pn.layout.get("text-rotate").evaluate(Ai,{})*Math.PI/180,ma=[],qi=0,gi=br.positionedLines;qi<gi.length;qi+=1)for(var La=gi[qi],ca=0,Va=La.positionedGlyphs;ca<Va.length;ca+=1){var ki=Va[ca];if(ki.rect){var to=ki.rect||{},To=4,_s=!0,$r=1,Uo=0,rr=(Un||Pi)&&ki.vertical,nu=ki.metrics.advance*ki.scale/2;if(Pi&&br.verticalizable&&(Uo=La.lineOffset/2-(ki.imageName?-(24-ki.metrics.width*ki.scale)/2:24*(ki.scale-1))),ki.imageName){var iu=ti[ki.imageName];_s=iu.sdf,To=1/($r=iu.pixelRatio)}var zu=Un?[ki.x+nu,ki.y]:[0,0],xs=Un?[0,0]:[ki.x+nu+Zr[0],ki.y+Zr[1]-Uo],wu=[0,0];rr&&(wu=xs,xs=[0,0]);var Ko=(ki.metrics.left-To)*ki.scale-nu+xs[0],au=(-ki.metrics.top-To)*ki.scale+xs[1],Fa=Ko+to.w*ki.scale/$r,Co=au+to.h*ki.scale/$r,vo=new ve(Ko,au),Ga=new ve(Fa,au),$u=new ve(Ko,Co),mu=new ve(Fa,Co);if(rr){var Zo=new ve(-nu,nu- -17),Ms=-Math.PI/2,Tu=12-nu,Ha=new ve(22-Tu,-(ki.imageName?Tu:0)),Ll=new(Function.prototype.bind.apply(ve,[null].concat(wu)));vo._rotateAround(Ms,Zo)._add(Ha)._add(Ll),Ga._rotateAround(Ms,Zo)._add(Ha)._add(Ll),$u._rotateAround(Ms,Zo)._add(Ha)._add(Ll),mu._rotateAround(Ms,Zo)._add(Ha)._add(Ll)}if(Xn){var bc=Math.sin(Xn),dl=Math.cos(Xn),bs=[dl,-bc,bc,dl];vo._matMult(bs),Ga._matMult(bs),$u._matMult(bs),mu._matMult(bs)}var Hc=new ve(0,0),Wc=new ve(0,0);ma.push({tl:vo,tr:Ga,bl:$u,br:mu,tex:to,writingMode:br.writingMode,glyphOffset:zu,sectionIndex:ki.sectionIndex,isSDF:_s,pixelOffsetTL:Hc,pixelOffsetBR:Wc,minFontScaleX:0,minFontScaleY:0})}}return ma}(0,l,R,x,C,T,v,i.allowVerticalPlacement),_t=i.textSizeData,ft=null;_t.kind==="source"?(ft=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&je(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):_t.kind==="composite"&&((ft=[128*Ae.compositeTextSizes[0].evaluate(T,{},Qe),128*Ae.compositeTextSizes[1].evaluate(T,{},Qe)])[0]>32640||ft[1]>32640)&&je(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),i.addSymbols(i.text,et,ft,R,C,T,X,s,U.lineStartIndex,U.lineLength,me,Qe);for(var zt=0,tr=$;zt<tr.length;zt+=1)ne[tr[zt]]=i.text.placedSymbolArray.length-1;return 4*et.length}function $t(i){for(var s in i)return i[s];return null}function ei(i,s,l,v){var x=i.compareText;if(s in x){for(var C=x[s],T=C.length-1;T>=0;T--)if(v.dist(C[T])<l)return!0}else x[s]=[];return x[s].push(v),!1}var Pa=Us.VectorTileFeature.types,Ge=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function we(i,s,l,v,x,C,T,R,U,X,$,ne,me){var Ae=R?Math.min(32640,Math.round(R[0])):0,Qe=R?Math.min(32640,Math.round(R[1])):0;i.emplaceBack(s,l,Math.round(32*v),Math.round(32*x),C,T,(Ae<<1)+(U?1:0),Qe,16*X,16*$,256*ne,256*me)}function vt(i,s,l){i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l)}function Wt(i){for(var s=0,l=i.sections;s<l.length;s+=1)if(Ih(l[s].text))return!0;return!1}var ur=function(i){this.layoutVertexArray=new $h,this.indexArray=new sc,this.programConfigurations=i,this.segments=new Pe,this.dynamicLayoutVertexArray=new tf,this.opacityVertexArray=new ih,this.placedSymbolArray=new g};ur.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},ur.prototype.upload=function(i,s,l,v){this.isEmpty()||(l&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ev.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,tv.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ge,!0),this.opacityVertexBuffer.itemSize=1),(l||v)&&this.programConfigurations.upload(i))},ur.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ni("SymbolBuffers",ur);var bt=function(i,s,l){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Pe,this.collisionVertexArray=new rf};bt.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Ip.members,!0)},bt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ni("CollisionBuffers",bt);var ot=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(C){return C.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Du([]),this.placementViewportMatrix=Du([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bn(this.zoom,s["text-size"]),this.iconSizeData=Bn(this.zoom,s["icon-size"]);var l=this.layers[0].layout,v=l.get("symbol-sort-key"),x=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(C){return On[C]})),this.stateDependentLayerIds=this.layers.filter(function(C){return C.isStateDependent()}).map(function(C){return C.id}),this.sourceID=i.sourceID};ot.prototype.createArrays=function(){this.text=new ur(new wi(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new ur(new wi(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new O,this.lineVertexArray=new z,this.symbolInstances=new I},ot.prototype.calculateGlyphDependencies=function(i,s,l,v,x){for(var C=0;C<i.length;C++)if(s[i.charCodeAt(C)]=!0,(l||v)&&x){var T=Jh[i.charAt(C)];T&&(s[T.charCodeAt(0)]=!0)}},ot.prototype.populate=function(i,s,l){var v=this.layers[0],x=v.layout,C=x.get("text-font"),T=x.get("text-field"),R=x.get("icon-image"),U=(T.value.kind!=="constant"||T.value.value instanceof At&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),X=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],U||X){for(var ne=s.iconDependencies,me=s.glyphDependencies,Ae=s.availableImages,Qe=new ua(this.zoom),et=0,_t=i;et<_t.length;et+=1){var ft=_t[et],zt=ft.feature,tr=ft.id,xr=ft.index,br=ft.sourceLayerIndex,Zr=v._featureFilter.needGeometry,pn=es(zt,Zr);if(v._featureFilter.filter(Qe,pn,l)){Zr||(pn.geometry=co(zt));var Un=void 0;if(U){var Ai=v.getValueAndResolveTokens("text-field",pn,l,Ae),ti=At.factory(Ai);Wt(ti)&&(this.hasRTLText=!0),(!this.hasRTLText||bp()==="unavailable"||this.hasRTLText&&Ws.isParsed())&&(Un=Ov(ti,v,pn))}var Pi=void 0;if(X){var Xn=v.getValueAndResolveTokens("icon-image",pn,l,Ae);Pi=Xn instanceof ao?Xn:ao.fromString(Xn)}if(Un||Pi){var ma=this.sortFeaturesByKey?$.evaluate(pn,{},l):void 0;if(this.features.push({id:tr,text:Un,icon:Pi,index:xr,sourceLayerIndex:br,geometry:pn.geometry,properties:zt.properties,type:Pa[zt.type],sortKey:ma}),Pi&&(ne[Pi.name]=!0),Un){var qi=C.evaluate(pn,{},l).join(","),gi=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(On.vertical)>=0;for(var La=0,ca=Un.sections;La<ca.length;La+=1){var Va=ca[La];if(Va.image)ne[Va.image.name]=!0;else{var ki=Rc(Un.toString()),to=Va.fontStack||qi,To=me[to]=me[to]||{};this.calculateGlyphDependencies(Va.text,To,gi,this.allowVerticalPlacement,ki)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(_s){var $r={},Uo={},rr=[],nu=0;function iu(Zo){rr.push(_s[Zo]),nu++}function zu(Zo,Ms,Tu){var Ha=Uo[Zo];return delete Uo[Zo],Uo[Ms]=Ha,rr[Ha].geometry[0].pop(),rr[Ha].geometry[0]=rr[Ha].geometry[0].concat(Tu[0]),Ha}function xs(Zo,Ms,Tu){var Ha=$r[Ms];return delete $r[Ms],$r[Zo]=Ha,rr[Ha].geometry[0].shift(),rr[Ha].geometry[0]=Tu[0].concat(rr[Ha].geometry[0]),Ha}function wu(Zo,Ms,Tu){var Ha=Tu?Ms[0][Ms[0].length-1]:Ms[0][0];return Zo+":"+Ha.x+":"+Ha.y}for(var Ko=0;Ko<_s.length;Ko++){var au=_s[Ko],Fa=au.geometry,Co=au.text?au.text.toString():null;if(Co){var vo=wu(Co,Fa),Ga=wu(Co,Fa,!0);if(vo in Uo&&Ga in $r&&Uo[vo]!==$r[Ga]){var $u=xs(vo,Ga,Fa),mu=zu(vo,Ga,rr[$u].geometry);delete $r[vo],delete Uo[Ga],Uo[wu(Co,rr[mu].geometry,!0)]=mu,rr[$u].geometry=null}else vo in Uo?zu(vo,Ga,Fa):Ga in $r?xs(vo,Ga,Fa):(iu(Ko),$r[vo]=nu-1,Uo[Ga]=nu-1)}else iu(Ko)}return rr.filter(function(Zo){return Zo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_s,$r){return _s.sortKey-$r.sortKey})}},ot.prototype.update=function(i,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,l))},ot.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},ot.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ot.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ot.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},ot.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ot.prototype.addToLineVertexArray=function(i,s){var l=this.lineVertexArray.length;if(i.segment!==void 0){for(var v=i.dist(s[i.segment+1]),x=i.dist(s[i.segment]),C={},T=i.segment+1;T<s.length;T++)C[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:v},T<s.length-1&&(v+=s[T+1].dist(s[T]));for(var R=i.segment||0;R>=0;R--)C[R]={x:s[R].x,y:s[R].y,tileUnitDistanceFromAnchor:x},R>0&&(x+=s[R-1].dist(s[R]));for(var U=0;U<s.length;U++){var X=C[U];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},ot.prototype.addSymbols=function(i,s,l,v,x,C,T,R,U,X,$,ne){for(var me=i.indexArray,Ae=i.layoutVertexArray,Qe=i.segments.prepareSegment(4*s.length,Ae,me,this.canOverlap?C.sortKey:void 0),et=this.glyphOffsetArray.length,_t=Qe.vertexLength,ft=this.allowVerticalPlacement&&T===On.vertical?Math.PI/2:0,zt=C.text&&C.text.sections,tr=0;tr<s.length;tr++){var xr=s[tr],br=xr.tl,Zr=xr.tr,pn=xr.bl,Un=xr.br,Ai=xr.tex,ti=xr.pixelOffsetTL,Pi=xr.pixelOffsetBR,Xn=xr.minFontScaleX,ma=xr.minFontScaleY,qi=xr.glyphOffset,gi=xr.isSDF,La=xr.sectionIndex,ca=Qe.vertexLength,Va=qi[1];we(Ae,R.x,R.y,br.x,Va+br.y,Ai.x,Ai.y,l,gi,ti.x,ti.y,Xn,ma),we(Ae,R.x,R.y,Zr.x,Va+Zr.y,Ai.x+Ai.w,Ai.y,l,gi,Pi.x,ti.y,Xn,ma),we(Ae,R.x,R.y,pn.x,Va+pn.y,Ai.x,Ai.y+Ai.h,l,gi,ti.x,Pi.y,Xn,ma),we(Ae,R.x,R.y,Un.x,Va+Un.y,Ai.x+Ai.w,Ai.y+Ai.h,l,gi,Pi.x,Pi.y,Xn,ma),vt(i.dynamicLayoutVertexArray,R,ft),me.emplaceBack(ca,ca+1,ca+2),me.emplaceBack(ca+1,ca+2,ca+3),Qe.vertexLength+=4,Qe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qi[0]),tr!==s.length-1&&La===s[tr+1].sectionIndex||i.programConfigurations.populatePaintArrays(Ae.length,C,C.index,{},ne,zt&&zt[La])}i.placedSymbolArray.emplaceBack(R.x,R.y,et,this.glyphOffsetArray.length-et,_t,U,X,R.segment,l?l[0]:0,l?l[1]:0,v[0],v[1],T,0,!1,0,$)},ot.prototype._addCollisionDebugVertex=function(i,s,l,v,x,C){return s.emplaceBack(0,0),i.emplaceBack(l.x,l.y,v,x,Math.round(C.x),Math.round(C.y))},ot.prototype.addCollisionDebugVertices=function(i,s,l,v,x,C,T){var R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),U=R.vertexLength,X=x.layoutVertexArray,$=x.collisionVertexArray,ne=T.anchorX,me=T.anchorY;this._addCollisionDebugVertex(X,$,C,ne,me,new ve(i,s)),this._addCollisionDebugVertex(X,$,C,ne,me,new ve(l,s)),this._addCollisionDebugVertex(X,$,C,ne,me,new ve(l,v)),this._addCollisionDebugVertex(X,$,C,ne,me,new ve(i,v)),R.vertexLength+=4;var Ae=x.indexArray;Ae.emplaceBack(U,U+1),Ae.emplaceBack(U+1,U+2),Ae.emplaceBack(U+2,U+3),Ae.emplaceBack(U+3,U),R.primitiveLength+=4},ot.prototype.addDebugCollisionBoxes=function(i,s,l,v){for(var x=i;x<s;x++){var C=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,v?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,l)}},ot.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bt(cl,Md.members,Lh),this.iconCollisionBox=new bt(cl,Md.members,Lh);for(var i=0;i<this.symbolInstances.length;i++){var s=this.symbolInstances.get(i);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},ot.prototype._deserializeCollisionBoxesForSymbol=function(i,s,l,v,x,C,T,R,U){for(var X={},$=s;$<l;$++){var ne=i.get($);X.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},X.textFeatureIndex=ne.featureIndex;break}for(var me=v;me<x;me++){var Ae=i.get(me);X.verticalTextBox={x1:Ae.x1,y1:Ae.y1,x2:Ae.x2,y2:Ae.y2,anchorPointX:Ae.anchorPointX,anchorPointY:Ae.anchorPointY},X.verticalTextFeatureIndex=Ae.featureIndex;break}for(var Qe=C;Qe<T;Qe++){var et=i.get(Qe);X.iconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.iconFeatureIndex=et.featureIndex;break}for(var _t=R;_t<U;_t++){var ft=i.get(_t);X.verticalIconBox={x1:ft.x1,y1:ft.y1,x2:ft.x2,y2:ft.y2,anchorPointX:ft.anchorPointX,anchorPointY:ft.anchorPointY},X.verticalIconFeatureIndex=ft.featureIndex;break}return X},ot.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},ot.prototype.hasTextData=function(){return this.text.segments.get().length>0},ot.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ot.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},ot.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},ot.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},ot.prototype.addIndicesForPlacedSymbol=function(i,s){for(var l=i.placedSymbolArray.get(s),v=l.vertexStartIndex+4*l.numGlyphs,x=l.vertexStartIndex;x<v;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)},ot.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(i),l=Math.cos(i),v=[],x=[],C=[],T=0;T<this.symbolInstances.length;++T){C.push(T);var R=this.symbolInstances.get(T);v.push(0|Math.round(s*R.anchorX+l*R.anchorY)),x.push(R.featureIndex)}return C.sort(function(U,X){return v[U]-v[X]||x[X]-x[U]}),C},ot.prototype.addToSortKeyRanges=function(i,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})},ot.prototype.sortFeatures=function(i){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,v=this.symbolInstanceIndexes;l<v.length;l+=1){var x=this.symbolInstances.get(v[l]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(C,T,R){C>=0&&R.indexOf(C)===T&&s.addIndicesForPlacedSymbol(s.text,C)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ni("SymbolBucket",ot,{omit:["layers","collisionBoxArray","features","compareText"]}),ot.MAX_GLYPHS=65535,ot.addDynamicAttributes=vt;var kt=new Yo({"symbol-placement":new _i(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new _i(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _i(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pi(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _i(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _i(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _i(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new _i(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _i(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new pi(ke.layout_symbol["icon-size"]),"icon-text-fit":new _i(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _i(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new pi(ke.layout_symbol["icon-image"]),"icon-rotate":new pi(ke.layout_symbol["icon-rotate"]),"icon-padding":new _i(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new _i(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new pi(ke.layout_symbol["icon-offset"]),"icon-anchor":new pi(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _i(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _i(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _i(ke.layout_symbol["text-rotation-alignment"]),"text-field":new pi(ke.layout_symbol["text-field"]),"text-font":new pi(ke.layout_symbol["text-font"]),"text-size":new pi(ke.layout_symbol["text-size"]),"text-max-width":new pi(ke.layout_symbol["text-max-width"]),"text-line-height":new _i(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new pi(ke.layout_symbol["text-letter-spacing"]),"text-justify":new pi(ke.layout_symbol["text-justify"]),"text-radial-offset":new pi(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _i(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new pi(ke.layout_symbol["text-anchor"]),"text-max-angle":new _i(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new _i(ke.layout_symbol["text-writing-mode"]),"text-rotate":new pi(ke.layout_symbol["text-rotate"]),"text-padding":new _i(ke.layout_symbol["text-padding"]),"text-keep-upright":new _i(ke.layout_symbol["text-keep-upright"]),"text-transform":new pi(ke.layout_symbol["text-transform"]),"text-offset":new pi(ke.layout_symbol["text-offset"]),"text-allow-overlap":new _i(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _i(ke.layout_symbol["text-ignore-placement"]),"text-optional":new _i(ke.layout_symbol["text-optional"])}),Ne={paint:new Yo({"icon-opacity":new pi(ke.paint_symbol["icon-opacity"]),"icon-color":new pi(ke.paint_symbol["icon-color"]),"icon-halo-color":new pi(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new pi(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pi(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new _i(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new _i(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new pi(ke.paint_symbol["text-opacity"]),"text-color":new pi(ke.paint_symbol["text-color"],{runtimeType:gn,getOverride:function(i){return i.textColor},hasOverride:function(i){return!!i.textColor}}),"text-halo-color":new pi(ke.paint_symbol["text-halo-color"]),"text-halo-width":new pi(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new pi(ke.paint_symbol["text-halo-blur"]),"text-translate":new _i(ke.paint_symbol["text-translate"]),"text-translate-anchor":new _i(ke.paint_symbol["text-translate-anchor"])}),layout:kt},pt=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Mn,this.defaultValue=i};pt.prototype.evaluate=function(i){if(i.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},pt.prototype.eachChild=function(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)},pt.prototype.outputDefined=function(){return!1},pt.prototype.serialize=function(){return null},ni("FormatSectionOverride",pt,{omit:["defaultValue"]});var We=function(i){function s(l){i.call(this,l,Ne)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,v){if(i.prototype.recalculate.call(this,l,v),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var C=[],T=0,R=x;T<R.length;T+=1){var U=R[T];C.indexOf(U)<0&&C.push(U)}this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,v,x,C){var T=this.layout.get(l).evaluate(v,{},x,C),R=this._unevaluatedLayout._values[l];return R.isDataDriven()||_f(R.value)||!T?T:function(U,X){return X.replace(/{([^{}]+)}/g,function($,ne){return ne in U?String(U[ne]):""})}(v.properties,T)},s.prototype.createBucket=function(l){return new ot(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,v=Ne.paint.overridableProperties;l<v.length;l+=1){var x=v[l];if(s.hasPaintOverride(this.layout,x)){var C,T=this.paint.get(x),R=new pt(T),U=new yf(R,T.property.specification);C=T.value.kind==="constant"||T.value.kind==="source"?new xf("source",U):new ec("composite",U,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new du(T.property,C,T.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,v,x){return!(!this.layout||v.isDataDriven()||x.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,v){var x=l.get("text-field"),C=Ne.paint.properties[v],T=!1,R=function($){for(var ne=0,me=$;ne<me.length;ne+=1)if(C.overrides&&C.overrides.hasOverride(me[ne]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof At)R(x.value.value.sections);else if(x.value.kind==="source"){var U=function($){T||($ instanceof Ra&&Bi($.value)===Ht?R($.value.sections):$ instanceof Ps?R($.sections):$.eachChild(U))},X=x.value;X._styleExpression&&U(X._styleExpression.expression)}return T},s}(Ru),jt={paint:new Yo({"background-color":new _i(ke.paint_background["background-color"]),"background-pattern":new Os(ke.paint_background["background-pattern"]),"background-opacity":new _i(ke.paint_background["background-opacity"])})},Kt=function(i){function s(l){i.call(this,l,jt)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Ru),Vr={paint:new Yo({"raster-opacity":new _i(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new _i(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _i(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _i(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new _i(ke.paint_raster["raster-saturation"]),"raster-contrast":new _i(ke.paint_raster["raster-contrast"]),"raster-resampling":new _i(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new _i(ke.paint_raster["raster-fade-duration"])})},An=function(i){function s(l){i.call(this,l,Vr)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Ru),un=function(i){function s(l){i.call(this,l,{}),this.implementation=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(Ru),Gn={circle:Ep,heatmap:Oh,hillshade:sh,fill:Bu,"fill-extrusion":gc,line:Qp,symbol:We,background:Kt,raster:An},xn=se.HTMLImageElement,$n=se.HTMLCanvasElement,Wn=se.HTMLVideoElement,Kn=se.ImageData,ui=se.ImageBitmap,Qn=function(i,s,l,v){this.context=i,this.format=l,this.texture=i.gl.createTexture(),this.update(s,v)};Qn.prototype.update=function(i,s,l){var v=i.width,x=i.height,C=!(this.size&&this.size[0]===v&&this.size[1]===x||l),T=this.context,R=T.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!s||s.premultiply!==!1)),C)this.size=[v,x],i instanceof xn||i instanceof $n||i instanceof Wn||i instanceof Kn||ui&&i instanceof ui?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,i):R.texImage2D(R.TEXTURE_2D,0,this.format,v,x,0,this.format,R.UNSIGNED_BYTE,i.data);else{var U=l||{x:0,y:0},X=U.x,$=U.y;i instanceof xn||i instanceof $n||i instanceof Wn||i instanceof Kn||ui&&i instanceof ui?R.texSubImage2D(R.TEXTURE_2D,0,X,$,R.RGBA,R.UNSIGNED_BYTE,i):R.texSubImage2D(R.TEXTURE_2D,0,X,$,v,x,R.RGBA,R.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)},Qn.prototype.bind=function(i,s,l){var v=this.context.gl;v.bindTexture(v.TEXTURE_2D,this.texture),l!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=v.LINEAR),i!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,l||i),this.filter=i),s!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,s),this.wrap=s)},Qn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Qn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ni=function(i){var s=this;this._callback=i,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Ni.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},Ni.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ua=function(i,s,l){this.target=i,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},fr(["receive","process"],this),this.invoker=new Ni(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=re()?i:se};function qs(i,s,l){var v=2*Math.PI*6378137/256/Math.pow(2,l);return[i*v-2*Math.PI*6378137/2,s*v-2*Math.PI*6378137/2]}Ua.prototype.send=function(i,s,l,v,x){var C=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[T]=l);var R=Q(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:i,hasCallback:!!l,targetMapId:v,mustQueue:x,sourceMapId:this.mapId,data:Lu(s,R)},R),{cancel:function(){l&&delete C.callbacks[T],C.target.postMessage({id:T,type:"<cancel>",targetMapId:v,sourceMapId:C.mapId})}}},Ua.prototype.receive=function(i){var s=i.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var v=this.cancelCallbacks[l];delete this.cancelCallbacks[l],v&&v()}else re()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},Ua.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),s=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(i,s)}},Ua.prototype.processTask=function(i,s){var l=this;if(s.type==="<response>"){var v=this.callbacks[i];delete this.callbacks[i],v&&(s.error?v(Ou(s.error)):v(null,Ou(s.data)))}else{var x=!1,C=Q(this.globalScope)?void 0:[],T=s.hasCallback?function($,ne){x=!0,delete l.cancelCallbacks[i],l.target.postMessage({id:i,type:"<response>",sourceMapId:l.mapId,error:$?Lu($):null,data:Lu(ne,C)},C)}:function($){x=!0},R=null,U=Ou(s.data);if(this.parent[s.type])R=this.parent[s.type](s.sourceMapId,U,T);else if(this.parent.getWorkerSource){var X=s.type.split(".");R=this.parent.getWorkerSource(s.sourceMapId,X[0],U.source)[X[1]](U,T)}else T(new Error("Could not find function "+s.type));!x&&R&&R.cancel&&(this.cancelCallbacks[i]=R.cancel)}},Ua.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Po=function(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};Po.prototype.setNorthEast=function(i){return this._ne=i instanceof $a?new $a(i.lng,i.lat):$a.convert(i),this},Po.prototype.setSouthWest=function(i){return this._sw=i instanceof $a?new $a(i.lng,i.lat):$a.convert(i),this},Po.prototype.extend=function(i){var s,l,v=this._sw,x=this._ne;if(i instanceof $a)s=i,l=i;else{if(!(i instanceof Po))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Po.convert(i)):this.extend($a.convert(i)):this;if(l=i._ne,!(s=i._sw)||!l)return this}return v||x?(v.lng=Math.min(s.lng,v.lng),v.lat=Math.min(s.lat,v.lat),x.lng=Math.max(l.lng,x.lng),x.lat=Math.max(l.lat,x.lat)):(this._sw=new $a(s.lng,s.lat),this._ne=new $a(l.lng,l.lat)),this},Po.prototype.getCenter=function(){return new $a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Po.prototype.getSouthWest=function(){return this._sw},Po.prototype.getNorthEast=function(){return this._ne},Po.prototype.getNorthWest=function(){return new $a(this.getWest(),this.getNorth())},Po.prototype.getSouthEast=function(){return new $a(this.getEast(),this.getSouth())},Po.prototype.getWest=function(){return this._sw.lng},Po.prototype.getSouth=function(){return this._sw.lat},Po.prototype.getEast=function(){return this._ne.lng},Po.prototype.getNorth=function(){return this._ne.lat},Po.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Po.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Po.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Po.prototype.contains=function(i){var s=$a.convert(i),l=s.lng,v=s.lat,x=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&x},Po.convert=function(i){return!i||i instanceof Po?i:new Po(i)};var $a=function(i,s){if(isNaN(i)||isNaN(s))throw new Error("Invalid LngLat object: ("+i+", "+s+")");if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};$a.prototype.wrap=function(){return new $a(Vt(this.lng,-180,180),this.lat)},$a.prototype.toArray=function(){return[this.lng,this.lat]},$a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},$a.prototype.distanceTo=function(i){var s=Math.PI/180,l=this.lat*s,v=i.lat*s,x=Math.sin(l)*Math.sin(v)+Math.cos(l)*Math.cos(v)*Math.cos((i.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(x,1))},$a.prototype.toBounds=function(i){i===void 0&&(i=0);var s=360*i/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Po(new $a(this.lng-l,this.lat-s),new $a(this.lng+l,this.lat+s))},$a.convert=function(i){if(i instanceof $a)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new $a(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new $a(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var jc=2*Math.PI*63710088e-1;function Nu(i){return jc*Math.cos(i*Math.PI/180)}function yc(i){return(180+i)/360}function $l(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function _c(i,s){return i/Nu(s)}function pl(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}var Gc=function(i,s,l){l===void 0&&(l=0),this.x=+i,this.y=+s,this.z=+l};Gc.fromLngLat=function(i,s){s===void 0&&(s=0);var l=$a.convert(i);return new Gc(yc(l.lng),$l(l.lat),_c(s,l.lat))},Gc.prototype.toLngLat=function(){return new $a(360*this.x-180,pl(this.y))},Gc.prototype.toAltitude=function(){return this.z*Nu(pl(this.y))},Gc.prototype.meterInMercatorCoordinateUnits=function(){return 1/jc*(i=pl(this.y),1/Math.cos(i*Math.PI/180));var i};var gh=function(i,s,l){this.z=i,this.x=s,this.y=l,this.key=Gs(0,i,i,s,l)};gh.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},gh.prototype.url=function(i,s){var l,v,x,C,T,R=(v=this.y,x=this.z,C=qs(256*(l=this.x),256*(v=Math.pow(2,x)-v-1),x),T=qs(256*(l+1),256*(v+1),x),C[0]+","+C[1]+","+T[0]+","+T[1]),U=function(X,$,ne){for(var me,Ae="",Qe=X;Qe>0;Qe--)Ae+=($&(me=1<<Qe-1)?1:0)+(ne&me?2:0);return Ae}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",U).replace("{bbox-epsg-3857}",R)},gh.prototype.getTilePoint=function(i){var s=Math.pow(2,this.z);return new ve(8192*(i.x*s-this.x),8192*(i.y*s-this.y))},gh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var tp=function(i,s){this.wrap=i,this.canonical=s,this.key=Gs(i,s.z,s.z,s.x,s.y)},Ts=function(i,s,l,v,x){this.overscaledZ=i,this.wrap=s,this.canonical=new gh(l,+v,+x),this.key=Gs(s,i,l,v,x)};function Gs(i,s,l,v,x){(i*=2)<0&&(i=-1*i-1);var C=1<<l;return(C*C*i+C*x+v).toString(36)+l.toString(36)+s.toString(36)}Ts.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},Ts.prototype.scaledTo=function(i){var s=this.canonical.z-i;return i>this.canonical.z?new Ts(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ts(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)},Ts.prototype.calculateScaledKey=function(i,s){var l=this.canonical.z-i;return i>this.canonical.z?Gs(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y):Gs(this.wrap*+s,i,i,this.canonical.x>>l,this.canonical.y>>l)},Ts.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s},Ts.prototype.children=function(i){if(this.overscaledZ>=i)return[new Ts(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,v=2*this.canonical.y;return[new Ts(s,this.wrap,s,l,v),new Ts(s,this.wrap,s,l+1,v),new Ts(s,this.wrap,s,l,v+1),new Ts(s,this.wrap,s,l+1,v+1)]},Ts.prototype.isLessThan=function(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))},Ts.prototype.wrapped=function(){return new Ts(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ts.prototype.unwrapTo=function(i){return new Ts(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},Ts.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ts.prototype.toUnwrapped=function(){return new tp(this.wrap,this.canonical)},Ts.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ts.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new Gc(i.x-this.wrap,i.y))},ni("CanonicalTileID",gh),ni("OverscaledTileID",Ts,{omit:["posMatrix"]});var xc=function(i,s,l){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return je('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var v=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var x=0;x<v;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(v,x)]=this.data[this._idx(v-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,v)]=this.data[this._idx(x,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]};xc.prototype.get=function(i,s){var l=new Uint8Array(this.data.buffer),v=4*this._idx(i,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[v],l[v+1],l[v+2])},xc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},xc.prototype._idx=function(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)},xc.prototype._unpackMapbox=function(i,s,l){return(256*i*256+256*s+l)/10-1e4},xc.prototype._unpackTerrarium=function(i,s,l){return 256*i+s+l/256-32768},xc.prototype.getPixels=function(){return new Ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},xc.prototype.backfillBorder=function(i,s,l){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var v=s*this.dim,x=s*this.dim+this.dim,C=l*this.dim,T=l*this.dim+this.dim;switch(s){case-1:v=x-1;break;case 1:x=v+1}switch(l){case-1:C=T-1;break;case 1:T=C+1}for(var R=-s*this.dim,U=-l*this.dim,X=C;X<T;X++)for(var $=v;$<x;$++)this.data[this._idx($,X)]=i.data[this._idx($+R,X+U)]},ni("DEMData",xc);var rp=function(i){this._stringToNumber={},this._numberToString=[];for(var s=0;s<i.length;s++){var l=i[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};rp.prototype.encode=function(i){return this._stringToNumber[i]},rp.prototype.decode=function(i){return this._numberToString[i]};var yh=function(i,s,l,v,x){this.type="Feature",this._vectorTileFeature=i,i._z=s,i._x=l,i._y=v,this.properties=i.properties,this.id=x},kd={geometry:{configurable:!0}};kd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},kd.geometry.set=function(i){this._geometry=i},yh.prototype.toJSON=function(){var i={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(i[s]=this[s]);return i},Object.defineProperties(yh.prototype,kd);var Kl=function(){this.state={},this.stateChanges={},this.deletedStates={}};Kl.prototype.updateState=function(i,s,l){var v=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][v]=this.stateChanges[i][v]||{},Ut(this.stateChanges[i][v],l),this.deletedStates[i]===null)for(var x in this.deletedStates[i]={},this.state[i])x!==v&&(this.deletedStates[i][x]=null);else if(this.deletedStates[i]&&this.deletedStates[i][v]===null)for(var C in this.deletedStates[i][v]={},this.state[i][v])l[C]||(this.deletedStates[i][v][C]=null);else for(var T in l)this.deletedStates[i]&&this.deletedStates[i][v]&&this.deletedStates[i][v][T]===null&&delete this.deletedStates[i][v][T]},Kl.prototype.removeFeatureState=function(i,s,l){if(this.deletedStates[i]!==null){var v=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},l&&s!==void 0)this.deletedStates[i][v]!==null&&(this.deletedStates[i][v]=this.deletedStates[i][v]||{},this.deletedStates[i][v][l]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][v])for(l in this.deletedStates[i][v]={},this.stateChanges[i][v])this.deletedStates[i][v][l]=null;else this.deletedStates[i][v]=null;else this.deletedStates[i]=null}},Kl.prototype.getState=function(i,s){var l=String(s),v=Ut({},(this.state[i]||{})[l],(this.stateChanges[i]||{})[l]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var x=this.deletedStates[i][s];if(x===null)return{};for(var C in x)delete v[C]}return v},Kl.prototype.initializeTileState=function(i,s){i.setFeatureState(this.state,s)},Kl.prototype.coalesceChanges=function(i,s){var l={};for(var v in this.stateChanges){this.state[v]=this.state[v]||{};var x={};for(var C in this.stateChanges[v])this.state[v][C]||(this.state[v][C]={}),Ut(this.state[v][C],this.stateChanges[v][C]),x[C]=this.state[v][C];l[v]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var R={};if(this.deletedStates[T]===null)for(var U in this.state[T])R[U]={},this.state[T][U]={};else for(var X in this.deletedStates[T]){if(this.deletedStates[T][X]===null)this.state[T][X]={};else for(var $=0,ne=Object.keys(this.deletedStates[T][X]);$<ne.length;$+=1)delete this.state[T][X][ne[$]];R[X]=this.state[T][X]}l[T]=l[T]||{},Ut(l[T],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var me in i)i[me].setFeatureState(l,s)};var Vf=function(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Vl(8192,16,0),this.grid3D=new Vl(8192,16,0),this.featureIndexArray=new oe,this.promoteId=s};function rv(i,s,l,v,x){return yr(i,function(C,T){var R=s instanceof ul?s.get(T):null;return R&&R.evaluate?R.evaluate(l,v,x):R})}function o0(i){for(var s=1/0,l=1/0,v=-1/0,x=-1/0,C=0,T=i;C<T.length;C+=1){var R=T[C];s=Math.min(s,R.x),l=Math.min(l,R.y),v=Math.max(v,R.x),x=Math.max(x,R.y)}return{minX:s,minY:l,maxX:v,maxY:x}}function j0(i,s){return s-i}Vf.prototype.insert=function(i,s,l,v,x,C){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,v,x);for(var R=C?this.grid3D:this.grid,U=0;U<s.length;U++){for(var X=s[U],$=[1/0,1/0,-1/0,-1/0],ne=0;ne<X.length;ne++){var me=X[ne];$[0]=Math.min($[0],me.x),$[1]=Math.min($[1],me.y),$[2]=Math.max($[2],me.x),$[3]=Math.max($[3],me.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&R.insert(T,$[0],$[1],$[2],$[3])}},Vf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Us.VectorTile(new mh(this.rawTileData)).layers,this.sourceLayerCoder=new rp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Vf.prototype.query=function(i,s,l,v){var x=this;this.loadVTLayers();for(var C=i.params||{},T=8192/i.tileSize/i.scale,R=kc(C.filter),U=i.queryGeometry,X=i.queryPadding*T,$=o0(U),ne=this.grid.query($.minX-X,$.minY-X,$.maxX+X,$.maxY+X),me=o0(i.cameraQueryGeometry),Ae=this.grid3D.query(me.minX-X,me.minY-X,me.maxX+X,me.maxY+X,function(xr,br,Zr,pn){return function(Un,Ai,ti,Pi,Xn){for(var ma=0,qi=Un;ma<qi.length;ma+=1){var gi=qi[ma];if(Ai<=gi.x&&ti<=gi.y&&Pi>=gi.x&&Xn>=gi.y)return!0}var La=[new ve(Ai,ti),new ve(Ai,Xn),new ve(Pi,Xn),new ve(Pi,ti)];if(Un.length>2){for(var ca=0,Va=La;ca<Va.length;ca+=1)if(fl(Un,Va[ca]))return!0}for(var ki=0;ki<Un.length-1;ki++)if(fc(Un[ki],Un[ki+1],La))return!0;return!1}(i.cameraQueryGeometry,xr-X,br-X,Zr+X,pn+X)}),Qe=0,et=Ae;Qe<et.length;Qe+=1)ne.push(et[Qe]);ne.sort(j0);for(var _t,ft={},zt=function(xr){var br=ne[xr];if(br!==_t){_t=br;var Zr=x.featureIndexArray.get(br),pn=null;x.loadMatchingFeature(ft,Zr.bucketIndex,Zr.sourceLayerIndex,Zr.featureIndex,R,C.layers,C.availableImages,s,l,v,function(Un,Ai,ti){return pn||(pn=co(Un)),Ai.queryIntersectsFeature(U,Un,ti,pn,x.z,i.transform,T,i.pixelPosMatrix)})}},tr=0;tr<ne.length;tr++)zt(tr);return ft},Vf.prototype.loadMatchingFeature=function(i,s,l,v,x,C,T,R,U,X,$){var ne=this.bucketLayerIDs[s];if(!C||function(Un,Ai){for(var ti=0;ti<Un.length;ti++)if(Ai.indexOf(Un[ti])>=0)return!0;return!1}(C,ne)){var me=this.sourceLayerCoder.decode(l),Ae=this.vtLayers[me].feature(v);if(x.needGeometry){var Qe=es(Ae,!0);if(!x.filter(new ua(this.tileID.overscaledZ),Qe,this.tileID.canonical))return}else if(!x.filter(new ua(this.tileID.overscaledZ),Ae))return;for(var et=this.getId(Ae,me),_t=0;_t<ne.length;_t++){var ft=ne[_t];if(!(C&&C.indexOf(ft)<0)){var zt=R[ft];if(zt){var tr={};et!==void 0&&X&&(tr=X.getState(zt.sourceLayer||"_geojsonTileLayer",et));var xr=Ut({},U[ft]);xr.paint=rv(xr.paint,zt.paint,Ae,tr,T),xr.layout=rv(xr.layout,zt.layout,Ae,tr,T);var br=!$||$(Ae,zt,tr);if(br){var Zr=new yh(Ae,this.z,this.x,this.y,et);Zr.layer=xr;var pn=i[ft];pn===void 0&&(pn=i[ft]=[]),pn.push({featureIndex:v,feature:Zr,intersectionZ:br})}}}}}},Vf.prototype.lookupSymbolFeatures=function(i,s,l,v,x,C,T,R){var U={};this.loadVTLayers();for(var X=kc(x),$=0,ne=i;$<ne.length;$+=1)this.loadMatchingFeature(U,l,v,ne[$],X,C,T,R,s);return U},Vf.prototype.hasLayer=function(i){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var v=0,x=l[s];v<x.length;v+=1)if(i===x[v])return!0;return!1},Vf.prototype.getId=function(i,s){var l=i.id;return this.promoteId&&typeof(l=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},ni("FeatureIndex",Vf,{omit:["rawTileData","sourceLayerCoder"]});var $s=function(i,s){this.tileID=i,this.uid=Qt(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};$s.prototype.registerFadeDuration=function(i){var s=i+this.timeAdded;s<Mi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},$s.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},$s.prototype.loadVectorData=function(i,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(var v in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(X,$){var ne={};if(!$)return ne;for(var me=function(){var et=Qe[Ae],_t=et.layerIds.map(function(tr){return $.getLayer(tr)}).filter(Boolean);if(_t.length!==0){et.layers=_t,et.stateDependentLayerIds&&(et.stateDependentLayers=et.stateDependentLayerIds.map(function(tr){return _t.filter(function(xr){return xr.id===tr})[0]}));for(var ft=0,zt=_t;ft<zt.length;ft+=1)ne[zt[ft].id]=et}},Ae=0,Qe=X;Ae<Qe.length;Ae+=1)me();return ne}(i.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[v];if(x instanceof ot){if(this.hasSymbolBuckets=!0,!l)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var C in this.buckets){var T=this.buckets[C];if(T instanceof ot&&T.hasRTLText){this.hasRTLText=!0,Ws.isLoading()||Ws.isLoaded()||bp()!=="deferred"||ol();break}}for(var R in this.queryPadding=0,this.buckets){var U=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(R).queryRadius(U))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new p},$s.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},$s.prototype.getBucket=function(i){return this.buckets[i.id]},$s.prototype.upload=function(i){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(i)}var v=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qn(i,this.imageAtlas.image,v.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qn(i,this.glyphAtlasImage,v.ALPHA),this.glyphAtlasImage=null)},$s.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},$s.prototype.queryRenderedFeatures=function(i,s,l,v,x,C,T,R,U,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:X,transform:R,params:T,queryPadding:this.queryPadding*U},i,s,l):{}},$s.prototype.querySourceFeatures=function(i,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var v=l.loadVTLayers(),x=s?s.sourceLayer:"",C=v._geojsonTileLayer||v[x];if(C)for(var T=kc(s&&s.filter),R=this.tileID.canonical,U=R.z,X=R.x,$=R.y,ne={z:U,x:X,y:$},me=0;me<C.length;me++){var Ae=C.feature(me);if(T.needGeometry){var Qe=es(Ae,!0);if(!T.filter(new ua(this.tileID.overscaledZ),Qe,this.tileID.canonical))continue}else if(!T.filter(new ua(this.tileID.overscaledZ),Ae))continue;var et=l.getId(Ae,x),_t=new yh(Ae,U,X,$,et);_t.tile=ne,i.push(_t)}}},$s.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},$s.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},$s.prototype.setExpiryData=function(i){var s=this.expirationTime;if(i.cacheControl){var l=Se(i.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var v=Date.now(),x=!1;if(this.expirationTime>v)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{var C=this.expirationTime-s;C?this.expirationTime=v+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},$s.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},$s.prototype.setFeatureState=function(i,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var v in this.buckets)if(s.style.hasLayer(v)){var x=this.buckets[v],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=l[C],R=i[C];if(T&&R&&Object.keys(R).length!==0){x.update(R,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var U=s&&s.style&&s.style.getLayer(v);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(x)))}}}},$s.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},$s.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mi.now()},$s.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},$s.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=Mi.now()+i},$s.prototype.setDependencies=function(i,s){for(var l={},v=0,x=s;v<x.length;v+=1)l[x[v]]=!0;this.dependencies[i]=l},$s.prototype.hasDependency=function(i,s){for(var l=0,v=i;l<v.length;l+=1){var x=this.dependencies[v[l]];if(x){for(var C=0,T=s;C<T.length;C+=1)if(x[T[C]])return!0}}return!1};var np=se.performance,Ld=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},np.mark(this._marks.start)};Ld.prototype.finish=function(){np.mark(this._marks.end);var i=np.getEntriesByName(this._marks.measure);return i.length===0&&(np.measure(this._marks.measure,this._marks.start,this._marks.end),i=np.getEntriesByName(this._marks.measure),np.clearMarks(this._marks.start),np.clearMarks(this._marks.end),np.clearMeasures(this._marks.measure)),i},y.Actor=Ua,y.AlphaImage=Yl,y.CanonicalTileID=gh,y.CollisionBoxArray=p,y.Color=Dr,y.DEMData=xc,y.DataConstantProperty=_i,y.DictionaryCoder=rp,y.EXTENT=8192,y.ErrorEvent=ct,y.EvaluationParameters=ua,y.Event=qe,y.Evented=St,y.FeatureIndex=Vf,y.FillBucket=kl,y.FillExtrusionBucket=Uc,y.ImageAtlas=rn,y.ImagePosition=Zt,y.LineBucket=so,y.LngLat=$a,y.LngLatBounds=Po,y.MercatorCoordinate=Gc,y.ONE_EM=24,y.OverscaledTileID=Ts,y.Point=ve,y.Point$1=ve,y.Properties=Yo,y.Protobuf=mh,y.RGBAImage=Ns,y.RequestManager=fi,y.RequestPerformance=Ld,y.ResourceType=Tn,y.SegmentVector=Pe,y.SourceFeatureState=Kl,y.StructArrayLayout1ui2=Wu,y.StructArrayLayout2f1f2i16=oc,y.StructArrayLayout2i4=nh,y.StructArrayLayout3ui6=sc,y.StructArrayLayout4i8=Sl,y.SymbolBucket=ot,y.Texture=Qn,y.Tile=$s,y.Transitionable=Ss,y.Uniform1f=Cn,y.Uniform1i=Wr,y.Uniform2f=yn,y.Uniform3f=Hn,y.Uniform4f=xi,y.UniformColor=Si,y.UniformMatrix4f=Ca,y.UnwrappedTileID=tp,y.ValidationError=it,y.WritingMode=On,y.ZoomHistory=Oc,y.add=function(i,s,l){return i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},y.addDynamicAttributes=vt,y.asyncAll=function(i,s,l){if(!i.length)return l(null,[]);var v=i.length,x=new Array(i.length),C=null;i.forEach(function(T,R){s(T,function(U,X){U&&(C=U),x[R]=X,--v==0&&l(C,x)})})},y.bezier=dt,y.bindAll=fr,y.browser=Mi,y.cacheEntryPossiblyAdded=function(i){++mi>Ar&&(i.getActor().send("enforceCacheSizeLimit",Gt),mi=0)},y.clamp=Et,y.clearTileCache=function(i){var s=se.caches.delete("mapbox-tiles");i&&s.catch(i).then(function(){return i()})},y.clipLine=gs,y.clone=function(i){var s=new za(16);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},y.clone$1=xt,y.clone$2=function(i){var s=new za(3);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s},y.collisionCircleLayout=Pp,y.config=vi,y.create=function(){var i=new za(16);return za!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},y.create$1=function(){var i=new za(9);return za!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},y.create$2=function(){var i=new za(4);return za!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},y.createCommonjsModule=Fe,y.createExpression=Ic,y.createLayout=po,y.createStyleLayer=function(i){return i.type==="custom"?new un(i):new Gn[i.type](i)},y.cross=function(i,s,l){var v=s[0],x=s[1],C=s[2],T=l[0],R=l[1],U=l[2];return i[0]=x*U-C*R,i[1]=C*T-v*U,i[2]=v*R-x*T,i},y.deepEqual=function i(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var v=0;v<s.length;v++)if(!i(s[v],l[v]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var x in s)if(!i(s[x],l[x]))return!1;return!0}return s===l},y.dot=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]},y.dot$1=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]},y.ease=rt,y.emitValidationErrors=Mf,y.endsWith=ie,y.enforceCacheSizeLimit=function(i){Tr(),he&&he.then(function(s){s.keys().then(function(l){for(var v=0;v<l.length-i;v++)s.delete(l[v])})})},y.evaluateSizeForFeature=Li,y.evaluateSizeForZoom=ta,y.evaluateVariableOffset=cf,y.evented=xp,y.extend=Ut,y.featureFilter=kc,y.filterObject=Dt,y.fromRotation=function(i,s){var l=Math.sin(s),v=Math.cos(s);return i[0]=v,i[1]=l,i[2]=0,i[3]=-l,i[4]=v,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},y.getAnchorAlignment=Pn,y.getAnchorJustification=Ke,y.getArrayBuffer=Ci,y.getImage=ce,y.getJSON=function(i,s){return io(Ut(i,{type:"json"}),s)},y.getRTLTextPluginStatus=bp,y.getReferrer=zi,y.getVideo=function(i,s){var l,v,x=se.document.createElement("video");x.muted=!0,x.onloadstart=function(){s(null,x)};for(var C=0;C<i.length;C++){var T=se.document.createElement("source");l=i[C],v=void 0,(v=se.document.createElement("a")).href=l,(v.protocol!==se.document.location.protocol||v.host!==se.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=i[C],x.appendChild(T)}return{cancel:function(){}}},y.identity=Du,y.invert=function(i,s){var l=s[0],v=s[1],x=s[2],C=s[3],T=s[4],R=s[5],U=s[6],X=s[7],$=s[8],ne=s[9],me=s[10],Ae=s[11],Qe=s[12],et=s[13],_t=s[14],ft=s[15],zt=l*R-v*T,tr=l*U-x*T,xr=l*X-C*T,br=v*U-x*R,Zr=v*X-C*R,pn=x*X-C*U,Un=$*et-ne*Qe,Ai=$*_t-me*Qe,ti=$*ft-Ae*Qe,Pi=ne*_t-me*et,Xn=ne*ft-Ae*et,ma=me*ft-Ae*_t,qi=zt*ma-tr*Xn+xr*Pi+br*ti-Zr*Ai+pn*Un;return qi?(i[0]=(R*ma-U*Xn+X*Pi)*(qi=1/qi),i[1]=(x*Xn-v*ma-C*Pi)*qi,i[2]=(et*pn-_t*Zr+ft*br)*qi,i[3]=(me*Zr-ne*pn-Ae*br)*qi,i[4]=(U*ti-T*ma-X*Ai)*qi,i[5]=(l*ma-x*ti+C*Ai)*qi,i[6]=(_t*xr-Qe*pn-ft*tr)*qi,i[7]=($*pn-me*xr+Ae*tr)*qi,i[8]=(T*Xn-R*ti+X*Un)*qi,i[9]=(v*ti-l*Xn-C*Un)*qi,i[10]=(Qe*Zr-et*xr+ft*zt)*qi,i[11]=(ne*xr-$*Zr-Ae*zt)*qi,i[12]=(R*Ai-T*Pi-U*Un)*qi,i[13]=(l*Pi-v*Ai+x*Un)*qi,i[14]=(et*tr-Qe*br-_t*zt)*qi,i[15]=($*br-ne*tr+me*zt)*qi,i):null},y.isChar=In,y.isMapboxURL=$i,y.keysDifference=function(i,s){var l=[];for(var v in i)v in s||l.push(v);return l},y.makeRequest=io,y.mapObject=yr,y.mercatorXfromLng=yc,y.mercatorYfromLat=$l,y.mercatorZfromAltitude=_c,y.mul=ah,y.multiply=Xs,y.mvt=Us,y.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},y.normalize=function(i,s){var l=s[0],v=s[1],x=s[2],C=l*l+v*v+x*x;return C>0&&(C=1/Math.sqrt(C)),i[0]=s[0]*C,i[1]=s[1]*C,i[2]=s[2]*C,i},y.number=fa,y.offscreenCanvasSupported=ai,y.ortho=function(i,s,l,v,x,C,T){var R=1/(s-l),U=1/(v-x),X=1/(C-T);return i[0]=-2*R,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*U,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*X,i[11]=0,i[12]=(s+l)*R,i[13]=(x+v)*U,i[14]=(T+C)*X,i[15]=1,i},y.parseGlyphPBF=function(i){return new mh(i).readFields(vn,[])},y.pbf=mh,y.performSymbolLayout=function(i,s,l,v,x,C,T){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;var R=i.layers[0].layout,U=i.layers[0]._unevaluatedLayout._values,X={};if(i.textSizeData.kind==="composite"){var $=i.textSizeData,ne=$.maxZoom;X.compositeTextSizes=[U["text-size"].possiblyEvaluate(new ua($.minZoom),T),U["text-size"].possiblyEvaluate(new ua(ne),T)]}if(i.iconSizeData.kind==="composite"){var me=i.iconSizeData,Ae=me.maxZoom;X.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new ua(me.minZoom),T),U["icon-size"].possiblyEvaluate(new ua(Ae),T)]}X.layoutTextSize=U["text-size"].possiblyEvaluate(new ua(i.zoom+1),T),X.layoutIconSize=U["icon-size"].possiblyEvaluate(new ua(i.zoom+1),T),X.textMaxSize=U["text-size"].possiblyEvaluate(new ua(18));for(var Qe=24*R.get("text-line-height"),et=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",_t=R.get("text-keep-upright"),ft=R.get("text-size"),zt=function(){var br=xr[tr],Zr=R.get("text-font").evaluate(br,{},T).join(","),pn=ft.evaluate(br,{},T),Un=X.layoutTextSize.evaluate(br,{},T),Ai=X.layoutIconSize.evaluate(br,{},T),ti={horizontal:{},vertical:void 0},Pi=br.text,Xn=[0,0];if(Pi){var ma=Pi.toString(),qi=24*R.get("text-letter-spacing").evaluate(br,{},T),gi=function(Fa){for(var Co=0,vo=Fa;Co<vo.length;Co+=1)if(Ga=vo[Co].charCodeAt(0),In.Arabic(Ga)||In["Arabic Supplement"](Ga)||In["Arabic Extended-A"](Ga)||In["Arabic Presentation Forms-A"](Ga)||In["Arabic Presentation Forms-B"](Ga))return!1;var Ga;return!0}(ma)?qi:0,La=R.get("text-anchor").evaluate(br,{},T),ca=R.get("text-variable-anchor");if(!ca){var Va=R.get("text-radial-offset").evaluate(br,{},T);Xn=Va?cf(La,[24*Va,ys]):R.get("text-offset").evaluate(br,{},T).map(function(Fa){return 24*Fa})}var ki=et?"center":R.get("text-justify").evaluate(br,{},T),to=R.get("symbol-placement"),To=to==="point"?24*R.get("text-max-width").evaluate(br,{},T):0,_s=function(){i.allowVerticalPlacement&&Rc(ma)&&(ti.vertical=Nn(Pi,s,l,x,Zr,To,Qe,La,"left",gi,Xn,On.vertical,!0,to,Un,pn))};if(!et&&ca){for(var $r=ki==="auto"?ca.map(function(Fa){return Ke(Fa)}):[ki],Uo=!1,rr=0;rr<$r.length;rr++){var nu=$r[rr];if(!ti.horizontal[nu])if(Uo)ti.horizontal[nu]=ti.horizontal[0];else{var iu=Nn(Pi,s,l,x,Zr,To,Qe,"center",nu,gi,Xn,On.horizontal,!1,to,Un,pn);iu&&(ti.horizontal[nu]=iu,Uo=iu.positionedLines.length===1)}}_s()}else{ki==="auto"&&(ki=Ke(La));var zu=Nn(Pi,s,l,x,Zr,To,Qe,La,ki,gi,Xn,On.horizontal,!1,to,Un,pn);zu&&(ti.horizontal[ki]=zu),_s(),Rc(ma)&&et&&_t&&(ti.vertical=Nn(Pi,s,l,x,Zr,To,Qe,La,ki,gi,Xn,On.vertical,!1,to,Un,pn))}}var xs=void 0,wu=!1;if(br.icon&&br.icon.name){var Ko=v[br.icon.name];Ko&&(xs=function(Fa,Co,vo){var Ga=Pn(vo),$u=Co[0]-Fa.displaySize[0]*Ga.horizontalAlign,mu=Co[1]-Fa.displaySize[1]*Ga.verticalAlign;return{image:Fa,top:mu,bottom:mu+Fa.displaySize[1],left:$u,right:$u+Fa.displaySize[0]}}(x[br.icon.name],R.get("icon-offset").evaluate(br,{},T),R.get("icon-anchor").evaluate(br,{},T)),wu=Ko.sdf,i.sdfIcons===void 0?i.sdfIcons=Ko.sdf:i.sdfIcons!==Ko.sdf&&je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ko.pixelRatio!==i.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}var au=$t(ti.horizontal)||ti.vertical;i.iconsInText=!!au&&au.iconsInText,(au||xs)&&function(Fa,Co,vo,Ga,$u,mu,Zo,Ms,Tu,Ha,Ll){var bc=mu.textMaxSize.evaluate(Co,{});bc===void 0&&(bc=Zo);var dl,bs=Fa.layers[0].layout,Hc=bs.get("icon-offset").evaluate(Co,{},Ll),Wc=$t(vo.horizontal),rd=Zo/24,ip=Fa.tilePixelRatio*rd,nd=Fa.tilePixelRatio*bc/24,ap=Fa.tilePixelRatio*Ms,id=Fa.tilePixelRatio*bs.get("symbol-spacing"),op=bs.get("text-padding")*Fa.tilePixelRatio,sp=bs.get("icon-padding")*Fa.tilePixelRatio,kp=bs.get("text-max-angle")/180*Math.PI,Bh=bs.get("text-rotation-alignment")==="map"&&bs.get("symbol-placement")!=="point",ad=bs.get("icon-rotation-alignment")==="map"&&bs.get("symbol-placement")!=="point",ff=bs.get("symbol-placement"),Od=id/2,Lp=bs.get("icon-text-fit");Ga&&Lp!=="none"&&(Fa.allowVerticalPlacement&&vo.vertical&&(dl=Gi(Ga,vo.vertical,Lp,bs.get("icon-text-fit-padding"),Hc,rd)),Wc&&(Ga=Gi(Ga,Wc,Lp,bs.get("icon-text-fit-padding"),Hc,rd)));var Nh=function(iv,pd){pd.x<0||pd.x>=8192||pd.y<0||pd.y>=8192||function(Es,Gf,s0,lp,Dv,av,Uh,Cc,ov,Fd,sv,Bd,uv,u0,Nd,Fp,lv,cv,Rl,Fv,Sc,fv,l0,Yc,qc){var c0,cp,Zh,fp,dd,Bp=Es.addToLineVertexArray(Gf,s0),Bv=0,f0=0,zd=0,hv=0,Nv=-1,hf=-1,xh={},h0=Ye(""),Ud=0,vd=0;if(Cc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ud=(c0=Cc.layout.get("text-offset").evaluate(Sc,{},Yc).map(function(mv){return 24*mv}))[0],vd=c0[1]):(Ud=24*Cc.layout.get("text-radial-offset").evaluate(Sc,{},Yc),vd=ys),Es.allowVerticalPlacement&&lp.vertical){var p0=Cc.layout.get("text-rotate").evaluate(Sc,{},Yc)+90;fp=new ws(ov,Gf,Fd,sv,Bd,lp.vertical,uv,u0,Nd,p0),Uh&&(dd=new ws(ov,Gf,Fd,sv,Bd,Uh,lv,cv,Nd,p0))}if(Dv){var pv=Cc.layout.get("icon-rotate").evaluate(Sc,{}),Zd=Cc.layout.get("icon-text-fit")!=="none",dv=As(Dv,pv,l0,Zd),Vd=Uh?As(Uh,pv,l0,Zd):void 0;Zh=new ws(ov,Gf,Fd,sv,Bd,Dv,lv,cv,!1,pv),Bv=4*dv.length;var vv=Es.iconSizeData,hp=null;vv.kind==="source"?(hp=[128*Cc.layout.get("icon-size").evaluate(Sc,{})])[0]>32640&&je(Es.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):vv.kind==="composite"&&((hp=[128*fv.compositeIconSizes[0].evaluate(Sc,{},Yc),128*fv.compositeIconSizes[1].evaluate(Sc,{},Yc)])[0]>32640||hp[1]>32640)&&je(Es.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Es.addSymbols(Es.icon,dv,hp,Fv,Rl,Sc,!1,Gf,Bp.lineStartIndex,Bp.lineLength,-1,Yc),Nv=Es.icon.placedSymbolArray.length-1,Vd&&(f0=4*Vd.length,Es.addSymbols(Es.icon,Vd,hp,Fv,Rl,Sc,On.vertical,Gf,Bp.lineStartIndex,Bp.lineLength,-1,Yc),hf=Es.icon.placedSymbolArray.length-1)}for(var zv in lp.horizontal){var Np=lp.horizontal[zv];if(!cp){h0=Ye(Np.text);var d0=Cc.layout.get("text-rotate").evaluate(Sc,{},Yc);cp=new ws(ov,Gf,Fd,sv,Bd,Np,uv,u0,Nd,d0)}var pp=Np.positionedLines.length===1;if(zd+=gr(Es,Gf,Np,av,Cc,Nd,Sc,Fp,Bp,lp.vertical?On.horizontal:On.horizontalOnly,pp?Object.keys(lp.horizontal):[zv],xh,Nv,fv,Yc),pp)break}lp.vertical&&(hv+=gr(Es,Gf,lp.vertical,av,Cc,Nd,Sc,Fp,Bp,On.vertical,["vertical"],xh,hf,fv,Yc));var ga=cp?cp.boxStartIndex:Es.collisionBoxArray.length,wa=cp?cp.boxEndIndex:Es.collisionBoxArray.length,v0=fp?fp.boxStartIndex:Es.collisionBoxArray.length,Tm=fp?fp.boxEndIndex:Es.collisionBoxArray.length,G0=Zh?Zh.boxStartIndex:Es.collisionBoxArray.length,Mm=Zh?Zh.boxEndIndex:Es.collisionBoxArray.length,Im=dd?dd.boxStartIndex:Es.collisionBoxArray.length,Pm=dd?dd.boxEndIndex:Es.collisionBoxArray.length,Hf=-1,Uv=function(mv,Ks){return mv&&mv.circleDiameter?Math.max(mv.circleDiameter,Ks):Ks};Hf=Uv(cp,Hf),Hf=Uv(fp,Hf),Hf=Uv(Zh,Hf);var md=(Hf=Uv(dd,Hf))>-1?1:0;md&&(Hf*=qc/24),Es.glyphOffsetArray.length>=ot.MAX_GLYPHS&&je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sc.sortKey!==void 0&&Es.addToSortKeyRanges(Es.symbolInstances.length,Sc.sortKey),Es.symbolInstances.emplaceBack(Gf.x,Gf.y,xh.right>=0?xh.right:-1,xh.center>=0?xh.center:-1,xh.left>=0?xh.left:-1,xh.vertical||-1,Nv,hf,h0,ga,wa,v0,Tm,G0,Mm,Im,Pm,Fd,zd,hv,Bv,f0,md,0,uv,Ud,vd,Hf)}(Fa,pd,iv,vo,Ga,$u,dl,Fa.layers[0],Fa.collisionBoxArray,Co.index,Co.sourceLayerIndex,Fa.index,ip,op,Bh,Tu,ap,sp,ad,Hc,Co,mu,Ha,Ll,Zo)};if(ff==="line")for(var Ec=0,Rd=gs(Co.geometry,0,0,8192,8192);Ec<Rd.length;Ec+=1)for(var mo=Rd[Ec],Xc=0,od=Vs(mo,id,kp,vo.vertical||Wc,Ga,24,nd,Fa.overscaling,8192);Xc<od.length;Xc+=1){var sd=od[Xc];Wc&&ei(Fa,Wc.text,Od,sd)||Nh(mo,sd)}else if(ff==="line-center")for(var Op=0,Rp=Co.geometry;Op<Rp.length;Op+=1){var Dp=Rp[Op];if(Dp.length>1){var ud=wo(Dp,kp,vo.vertical||Wc,Ga,24,nd);ud&&Nh(Dp,ud)}}else if(Co.type==="Polygon")for(var jf=0,ld=Ap(Co.geometry,0);jf<ld.length;jf+=1){var up=ld[jf],Ol=Yi(up,16);Nh(up[0],new Dn(Ol.x,Ol.y,0))}else if(Co.type==="LineString")for(var Ql=0,_h=Co.geometry;Ql<_h.length;Ql+=1){var cd=_h[Ql];Nh(cd,new Dn(cd[0].x,cd[0].y,0))}else if(Co.type==="Point")for(var zh=0,Dd=Co.geometry;zh<Dd.length;zh+=1)for(var fd=0,nv=Dd[zh];fd<nv.length;fd+=1){var hd=nv[fd];Nh([hd],new Dn(hd.x,hd.y,0))}}(i,br,ti,xs,v,X,Un,Ai,Xn,wu,T)},tr=0,xr=i.features;tr<xr.length;tr+=1)zt();C&&i.generateCollisionDebugBuffers()},y.perspective=function(i,s,l,v,x){var C,T=1/Math.tan(s/2);return i[0]=T/l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,x!=null&&x!==1/0?(i[10]=(x+v)*(C=1/(v-x)),i[14]=2*x*v*C):(i[10]=-1,i[14]=-2*v),i},y.pick=function(i,s){for(var l={},v=0;v<s.length;v++){var x=s[v];x in i&&(l[x]=i[x])}return l},y.plugin=Ws,y.polygonIntersectsPolygon=lc,y.postMapLoadEvent=nt,y.postTurnstileEvent=sr,y.potpack=hn,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=ni,y.registerForPluginStateChange=function(i){return i({pluginStatus:Js,pluginURL:jl}),xp.on("pluginStateChange",i),i},y.renderColorRamp=Il,y.rotate=function(i,s,l){var v=s[0],x=s[1],C=s[2],T=s[3],R=Math.sin(l),U=Math.cos(l);return i[0]=v*U+C*R,i[1]=x*U+T*R,i[2]=v*-R+C*U,i[3]=x*-R+T*U,i},y.rotateX=function(i,s,l){var v=Math.sin(l),x=Math.cos(l),C=s[4],T=s[5],R=s[6],U=s[7],X=s[8],$=s[9],ne=s[10],me=s[11];return s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=C*x+X*v,i[5]=T*x+$*v,i[6]=R*x+ne*v,i[7]=U*x+me*v,i[8]=X*x-C*v,i[9]=$*x-T*v,i[10]=ne*x-R*v,i[11]=me*x-U*v,i},y.rotateZ=function(i,s,l){var v=Math.sin(l),x=Math.cos(l),C=s[0],T=s[1],R=s[2],U=s[3],X=s[4],$=s[5],ne=s[6],me=s[7];return s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=C*x+X*v,i[1]=T*x+$*v,i[2]=R*x+ne*v,i[3]=U*x+me*v,i[4]=X*x-C*v,i[5]=$*x-T*v,i[6]=ne*x-R*v,i[7]=me*x-U*v,i},y.scale=function(i,s,l){var v=l[0],x=l[1],C=l[2];return i[0]=s[0]*v,i[1]=s[1]*v,i[2]=s[2]*v,i[3]=s[3]*v,i[4]=s[4]*x,i[5]=s[5]*x,i[6]=s[6]*x,i[7]=s[7]*x,i[8]=s[8]*C,i[9]=s[9]*C,i[10]=s[10]*C,i[11]=s[11]*C,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},y.scale$1=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i[3]=s[3]*l,i},y.scale$2=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i},y.setCacheLimits=function(i,s){Gt=i,Ar=s},y.setRTLTextPlugin=function(i,s,l){if(l===void 0&&(l=!1),Js==="deferred"||Js==="loading"||Js==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");jl=Mi.resolveURL(i),Js="deferred",al=s,eh(),l||ol()},y.sphericalToCartesian=function(i){var s=i[0],l=i[1],v=i[2];return l+=90,l*=Math.PI/180,v*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(v),y:s*Math.sin(l)*Math.sin(v),z:s*Math.cos(v)}},y.sqrLen=function(i){var s=i[0],l=i[1];return s*s+l*l},y.styleSpec=ke,y.sub=function(i,s,l){return i[0]=s[0]-l[0],i[1]=s[1]-l[1],i[2]=s[2]-l[2],i},y.symbolSize=Ma,y.transformMat3=function(i,s,l){var v=s[0],x=s[1],C=s[2];return i[0]=v*l[0]+x*l[3]+C*l[6],i[1]=v*l[1]+x*l[4]+C*l[7],i[2]=v*l[2]+x*l[5]+C*l[8],i},y.transformMat4=Df,y.translate=function(i,s,l){var v,x,C,T,R,U,X,$,ne,me,Ae,Qe,et=l[0],_t=l[1],ft=l[2];return s===i?(i[12]=s[0]*et+s[4]*_t+s[8]*ft+s[12],i[13]=s[1]*et+s[5]*_t+s[9]*ft+s[13],i[14]=s[2]*et+s[6]*_t+s[10]*ft+s[14],i[15]=s[3]*et+s[7]*_t+s[11]*ft+s[15]):(x=s[1],C=s[2],T=s[3],R=s[4],U=s[5],X=s[6],$=s[7],ne=s[8],me=s[9],Ae=s[10],Qe=s[11],i[0]=v=s[0],i[1]=x,i[2]=C,i[3]=T,i[4]=R,i[5]=U,i[6]=X,i[7]=$,i[8]=ne,i[9]=me,i[10]=Ae,i[11]=Qe,i[12]=v*et+R*_t+ne*ft+s[12],i[13]=x*et+U*_t+me*ft+s[13],i[14]=C*et+X*_t+Ae*ft+s[14],i[15]=T*et+$*_t+Qe*ft+s[15]),i},y.triggerPluginCompletionEvent=di,y.uniqueId=Qt,y.validateCustomStyleLayer=function(i){var s=[],l=i.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),i.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=fu,y.validateStyle=Zl,y.values=function(i){var s=[];for(var l in i)s.push(i[l]);return s},y.vectorTile=Us,y.version="1.13.2",y.warnOnce=je,y.webpSupported=en,y.window=se,y.wrap=Vt}),ge(["./shared"],function(y){"use strict";function Fe(ee){var ce=typeof ee;if(ce==="number"||ce==="boolean"||ce==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){for(var xe="[",Oe=0,qe=ee;Oe<qe.length;Oe+=1)xe+=Fe(qe[Oe])+",";return xe+"]"}for(var ct=Object.keys(ee).sort(),St="{",ke=0;ke<ct.length;ke++)St+=JSON.stringify(ct[ke])+":"+Fe(ee[ct[ke]])+",";return St+"}"}function K(ee){for(var ce="",xe=0,Oe=y.refProperties;xe<Oe.length;xe+=1)ce+="/"+Fe(ee[Oe[xe]]);return ce}var Me=function(ee){this.keyCache={},ee&&this.replace(ee)};Me.prototype.replace=function(ee){this._layerConfigs={},this._layers={},this.update(ee,[])},Me.prototype.update=function(ee,ce){for(var xe=this,Oe=0,qe=ee;Oe<qe.length;Oe+=1){var ct=qe[Oe];this._layerConfigs[ct.id]=ct;var St=this._layers[ct.id]=y.createStyleLayer(ct);St._featureFilter=y.featureFilter(St.filter),this.keyCache[ct.id]&&delete this.keyCache[ct.id]}for(var ke=0,it=ce;ke<it.length;ke+=1){var Yt=it[ke];delete this.keyCache[Yt],delete this._layerConfigs[Yt],delete this._layers[Yt]}this.familiesBySource={};for(var jr=0,or=function(Pr,gn){for(var ea={},Vn=0;Vn<Pr.length;Vn++){var na=gn&&gn[Pr[Vn].id]||K(Pr[Vn]);gn&&(gn[Pr[Vn].id]=na);var Ht=ea[na];Ht||(Ht=ea[na]=[]),Ht.push(Pr[Vn])}var Rt=[];for(var da in ea)Rt.push(ea[da]);return Rt}(y.values(this._layerConfigs),this.keyCache);jr<or.length;jr+=1){var mr=or[jr].map(function(Pr){return xe._layers[Pr.id]}),Hr=mr[0];if(Hr.visibility!=="none"){var si=Hr.source||"",Mn=this.familiesBySource[si];Mn||(Mn=this.familiesBySource[si]={});var ar=Hr.sourceLayer||"_geojsonTileLayer",Yn=Mn[ar];Yn||(Yn=Mn[ar]=[]),Yn.push(mr)}}};var ve=function(ee){var ce={},xe=[];for(var Oe in ee){var qe=ee[Oe],ct=ce[Oe]={};for(var St in qe){var ke=qe[+St];if(ke&&ke.bitmap.width!==0&&ke.bitmap.height!==0){var it={x:0,y:0,w:ke.bitmap.width+2,h:ke.bitmap.height+2};xe.push(it),ct[St]={rect:it,metrics:ke.metrics}}}}var Yt=y.potpack(xe),jr=new y.AlphaImage({width:Yt.w||1,height:Yt.h||1});for(var or in ee){var mr=ee[or];for(var Hr in mr){var si=mr[+Hr];if(si&&si.bitmap.width!==0&&si.bitmap.height!==0){var Mn=ce[or][Hr].rect;y.AlphaImage.copy(si.bitmap,jr,{x:0,y:0},{x:Mn.x+1,y:Mn.y+1},si.bitmap)}}}this.image=jr,this.positions=ce};y.register("GlyphAtlas",ve);var at=function(ee){this.tileID=new y.OverscaledTileID(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId};function se(ee,ce,xe){for(var Oe=new y.EvaluationParameters(ce),qe=0,ct=ee;qe<ct.length;qe+=1)ct[qe].recalculate(Oe,xe)}function Be(ee,ce){var xe=y.getArrayBuffer(ee.request,function(Oe,qe,ct,St){Oe?ce(Oe):qe&&ce(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(qe)),rawData:qe,cacheControl:ct,expires:St})});return function(){xe.cancel(),ce()}}at.prototype.parse=function(ee,ce,xe,Oe,qe){var ct=this;this.status="parsing",this.data=ee,this.collisionBoxArray=new y.CollisionBoxArray;var St=new y.DictionaryCoder(Object.keys(ee.layers).sort()),ke=new y.FeatureIndex(this.tileID,this.promoteId);ke.bucketLayerIDs=[];var it,Yt,jr,or,mr={},Hr={featureIndex:ke,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:xe},si=ce.familiesBySource[this.source];for(var Mn in si){var ar=ee.layers[Mn];if(ar){ar.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+Mn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Yn=St.encode(Mn),Pr=[],gn=0;gn<ar.length;gn++){var ea=ar.feature(gn),Vn=ke.getId(ea,Mn);Pr.push({feature:ea,id:Vn,index:gn,sourceLayerIndex:Yn})}for(var na=0,Ht=si[Mn];na<Ht.length;na+=1){var Rt=Ht[na],da=Rt[0];da.minzoom&&this.zoom<Math.floor(da.minzoom)||da.maxzoom&&this.zoom>=da.maxzoom||da.visibility!=="none"&&(se(Rt,this.zoom,xe),(mr[da.id]=da.createBucket({index:ke.bucketLayerIDs.length,layers:Rt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yn,sourceID:this.source})).populate(Pr,Hr,this.tileID.canonical),ke.bucketLayerIDs.push(Rt.map(function(Na){return Na.id})))}}}var aa=y.mapObject(Hr.glyphDependencies,function(Na){return Object.keys(Na).map(Number)});Object.keys(aa).length?Oe.send("getGlyphs",{uid:this.uid,stacks:aa},function(Na,Or){it||(it=Na,Yt=Or,_o.call(ct))}):Yt={};var Di=Object.keys(Hr.iconDependencies);Di.length?Oe.send("getImages",{icons:Di,source:this.source,tileID:this.tileID,type:"icons"},function(Na,Or){it||(it=Na,jr=Or,_o.call(ct))}):jr={};var Ii=Object.keys(Hr.patternDependencies);function _o(){if(it)return qe(it);if(Yt&&jr&&or){var Na=new ve(Yt),Or=new y.ImageAtlas(jr,or);for(var Dr in mr){var Mt=mr[Dr];Mt instanceof y.SymbolBucket?(se(Mt.layers,this.zoom,xe),y.performSymbolLayout(Mt,Yt,Na.positions,jr,Or.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Mt.hasPattern&&(Mt instanceof y.LineBucket||Mt instanceof y.FillBucket||Mt instanceof y.FillExtrusionBucket)&&(se(Mt.layers,this.zoom,xe),Mt.addFeatures(Hr,this.tileID.canonical,Or.patternPositions))}this.status="done",qe(null,{buckets:y.values(mr).filter(function(us){return!us.isEmpty()}),featureIndex:ke,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Na.image,imageAtlas:Or,glyphMap:this.returnDependencies?Yt:null,iconMap:this.returnDependencies?jr:null,glyphPositions:this.returnDependencies?Na.positions:null})}}Ii.length?Oe.send("getImages",{icons:Ii,source:this.source,tileID:this.tileID,type:"patterns"},function(Na,Or){it||(it=Na,or=Or,_o.call(ct))}):or={},_o.call(this)};var dt=function(ee,ce,xe,Oe){this.actor=ee,this.layerIndex=ce,this.availableImages=xe,this.loadVectorData=Oe||Be,this.loading={},this.loaded={}};dt.prototype.loadTile=function(ee,ce){var xe=this,Oe=ee.uid;this.loading||(this.loading={});var qe=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new y.RequestPerformance(ee.request),ct=this.loading[Oe]=new at(ee);ct.abort=this.loadVectorData(ee,function(St,ke){if(delete xe.loading[Oe],St||!ke)return ct.status="done",xe.loaded[Oe]=ct,ce(St);var it=ke.rawData,Yt={};ke.expires&&(Yt.expires=ke.expires),ke.cacheControl&&(Yt.cacheControl=ke.cacheControl);var jr={};if(qe){var or=qe.finish();or&&(jr.resourceTiming=JSON.parse(JSON.stringify(or)))}ct.vectorTile=ke.vectorTile,ct.parse(ke.vectorTile,xe.layerIndex,xe.availableImages,xe.actor,function(mr,Hr){if(mr||!Hr)return ce(mr);ce(null,y.extend({rawTileData:it.slice(0)},Hr,Yt,jr))}),xe.loaded=xe.loaded||{},xe.loaded[Oe]=ct})},dt.prototype.reloadTile=function(ee,ce){var xe=this,Oe=this.loaded,qe=ee.uid,ct=this;if(Oe&&Oe[qe]){var St=Oe[qe];St.showCollisionBoxes=ee.showCollisionBoxes;var ke=function(it,Yt){var jr=St.reloadCallback;jr&&(delete St.reloadCallback,St.parse(St.vectorTile,ct.layerIndex,xe.availableImages,ct.actor,jr)),ce(it,Yt)};St.status==="parsing"?St.reloadCallback=ke:St.status==="done"&&(St.vectorTile?St.parse(St.vectorTile,this.layerIndex,this.availableImages,this.actor,ke):ke())}},dt.prototype.abortTile=function(ee,ce){var xe=this.loading,Oe=ee.uid;xe&&xe[Oe]&&xe[Oe].abort&&(xe[Oe].abort(),delete xe[Oe]),ce()},dt.prototype.removeTile=function(ee,ce){var xe=this.loaded,Oe=ee.uid;xe&&xe[Oe]&&delete xe[Oe],ce()};var rt=y.window.ImageBitmap,Et=function(){this.loaded={}};function Vt(ee,ce){if(ee.length!==0){Ut(ee[0],ce);for(var xe=1;xe<ee.length;xe++)Ut(ee[xe],!ce)}}function Ut(ee,ce){for(var xe=0,Oe=0,qe=ee.length,ct=qe-1;Oe<qe;ct=Oe++)xe+=(ee[Oe][0]-ee[ct][0])*(ee[ct][1]+ee[Oe][1]);xe>=0!=!!ce&&ee.reverse()}Et.prototype.loadTile=function(ee,ce){var xe=ee.uid,Oe=ee.encoding,qe=ee.rawImageData,ct=rt&&qe instanceof rt?this.getImageData(qe):qe,St=new y.DEMData(xe,ct,Oe);this.loaded=this.loaded||{},this.loaded[xe]=St,ce(null,St)},Et.prototype.getImageData=function(ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,ee.width+2,ee.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ce.width,height:ce.height},ce.data)},Et.prototype.removeTile=function(ee){var ce=this.loaded,xe=ee.uid;ce&&ce[xe]&&delete ce[xe]};var lr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,Qt=function(ee){this._feature=ee,this.extent=y.EXTENT,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))};Qt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var ee=[],ce=0,xe=this._feature.geometry;ce<xe.length;ce+=1){var Oe=xe[ce];ee.push([new y.Point$1(Oe[0],Oe[1])])}return ee}for(var qe=[],ct=0,St=this._feature.geometry;ct<St.length;ct+=1){for(var ke=[],it=0,Yt=St[ct];it<Yt.length;it+=1){var jr=Yt[it];ke.push(new y.Point$1(jr[0],jr[1]))}qe.push(ke)}return qe},Qt.prototype.toGeoJSON=function(ee,ce,xe){return lr.call(this,ee,ce,xe)};var It=function(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=ee.length,this._features=ee};It.prototype.feature=function(ee){return new Qt(this._features[ee])};var Lt=y.vectorTile.VectorTileFeature,fr=ie;function ie(ee,ce){this.options=ce||{},this.features=ee,this.length=ee.length}function yr(ee,ce){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=ce||4096}ie.prototype.feature=function(ee){return new yr(this.features[ee],this.options.extent)},yr.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var ce=0;ce<ee.length;ce++){for(var xe=ee[ce],Oe=[],qe=0;qe<xe.length;qe++)Oe.push(new y.Point$1(xe[qe][0],xe[qe][1]));this.geometry.push(Oe)}return this.geometry},yr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,ce=1/0,xe=-1/0,Oe=1/0,qe=-1/0,ct=0;ct<ee.length;ct++)for(var St=ee[ct],ke=0;ke<St.length;ke++){var it=St[ke];ce=Math.min(ce,it.x),xe=Math.max(xe,it.x),Oe=Math.min(Oe,it.y),qe=Math.max(qe,it.y)}return[ce,Oe,xe,qe]},yr.prototype.toGeoJSON=Lt.prototype.toGeoJSON;var Dt=Jt,xt=fr;function Jt(ee){var ce=new y.pbf;return function(xe,Oe){for(var qe in xe.layers)Oe.writeMessage(3,je,xe.layers[qe])}(ee,ce),ce.finish()}function je(ee,ce){var xe;ce.writeVarintField(15,ee.version||1),ce.writeStringField(1,ee.name||""),ce.writeVarintField(5,ee.extent||4096);var Oe={keys:[],values:[],keycache:{},valuecache:{}};for(xe=0;xe<ee.length;xe++)Oe.feature=ee.feature(xe),ce.writeMessage(2,Sr,Oe);var qe=Oe.keys;for(xe=0;xe<qe.length;xe++)ce.writeStringField(3,qe[xe]);var ct=Oe.values;for(xe=0;xe<ct.length;xe++)ce.writeMessage(4,Q,ct[xe])}function Sr(ee,ce){var xe=ee.feature;xe.id!==void 0&&ce.writeVarintField(1,xe.id),ce.writeMessage(2,tn,ee),ce.writeVarintField(3,xe.type),ce.writeMessage(4,V,xe)}function tn(ee,ce){var xe=ee.feature,Oe=ee.keys,qe=ee.values,ct=ee.keycache,St=ee.valuecache;for(var ke in xe.properties){var it=ct[ke];it===void 0&&(Oe.push(ke),ct[ke]=it=Oe.length-1),ce.writeVarint(it);var Yt=xe.properties[ke],jr=typeof Yt;jr!=="string"&&jr!=="boolean"&&jr!=="number"&&(Yt=JSON.stringify(Yt));var or=jr+":"+Yt,mr=St[or];mr===void 0&&(qe.push(Yt),St[or]=mr=qe.length-1),ce.writeVarint(mr)}}function re(ee,ce){return(ce<<3)+(7&ee)}function Se(ee){return ee<<1^ee>>31}function V(ee,ce){for(var xe=ee.loadGeometry(),Oe=ee.type,qe=0,ct=0,St=xe.length,ke=0;ke<St;ke++){var it=xe[ke],Yt=1;Oe===1&&(Yt=it.length),ce.writeVarint(re(1,Yt));for(var jr=Oe===3?it.length-1:it.length,or=0;or<jr;or++){or===1&&Oe!==1&&ce.writeVarint(re(2,jr-1));var mr=it[or].x-qe,Hr=it[or].y-ct;ce.writeVarint(Se(mr)),ce.writeVarint(Se(Hr)),qe+=mr,ct+=Hr}Oe===3&&ce.writeVarint(re(7,1))}}function Q(ee,ce){var xe=typeof ee;xe==="string"?ce.writeStringField(1,ee):xe==="boolean"?ce.writeBooleanField(7,ee):xe==="number"&&(ee%1!=0?ce.writeDoubleField(3,ee):ee<0?ce.writeSVarintField(6,ee):ce.writeVarintField(5,ee))}function Le(ee,ce,xe,Oe){ht(ee,xe,Oe),ht(ce,2*xe,2*Oe),ht(ce,2*xe+1,2*Oe+1)}function ht(ee,ce,xe){var Oe=ee[ce];ee[ce]=ee[xe],ee[xe]=Oe}function wt(ee,ce,xe,Oe){var qe=ee-xe,ct=ce-Oe;return qe*qe+ct*ct}Dt.fromVectorTileJs=Jt,Dt.fromGeojsonVt=function(ee,ce){ce=ce||{};var xe={};for(var Oe in ee)xe[Oe]=new fr(ee[Oe].features,ce),xe[Oe].name=Oe,xe[Oe].version=ce.version,xe[Oe].extent=ce.extent;return Jt({layers:xe})},Dt.GeoJSONWrapper=xt;var er=function(ee){return ee[0]},Tt=function(ee){return ee[1]},vr=function(ee,ce,xe,Oe,qe){ce===void 0&&(ce=er),xe===void 0&&(xe=Tt),Oe===void 0&&(Oe=64),qe===void 0&&(qe=Float64Array),this.nodeSize=Oe,this.points=ee;for(var ct=ee.length<65536?Uint16Array:Uint32Array,St=this.ids=new ct(ee.length),ke=this.coords=new qe(2*ee.length),it=0;it<ee.length;it++)St[it]=it,ke[2*it]=ce(ee[it]),ke[2*it+1]=xe(ee[it]);(function Yt(jr,or,mr,Hr,si,Mn){if(!(si-Hr<=mr)){var ar=Hr+si>>1;(function Yn(Pr,gn,ea,Vn,na,Ht){for(;na>Vn;){if(na-Vn>600){var Rt=na-Vn+1,da=ea-Vn+1,aa=Math.log(Rt),Di=.5*Math.exp(2*aa/3),Ii=.5*Math.sqrt(aa*Di*(Rt-Di)/Rt)*(da-Rt/2<0?-1:1);Yn(Pr,gn,ea,Math.max(Vn,Math.floor(ea-da*Di/Rt+Ii)),Math.min(na,Math.floor(ea+(Rt-da)*Di/Rt+Ii)),Ht)}var _o=gn[2*ea+Ht],Na=Vn,Or=na;for(Le(Pr,gn,Vn,ea),gn[2*na+Ht]>_o&&Le(Pr,gn,Vn,na);Na<Or;){for(Le(Pr,gn,Na,Or),Na++,Or--;gn[2*Na+Ht]<_o;)Na++;for(;gn[2*Or+Ht]>_o;)Or--}gn[2*Vn+Ht]===_o?Le(Pr,gn,Vn,Or):Le(Pr,gn,++Or,na),Or<=ea&&(Vn=Or+1),ea<=Or&&(na=Or-1)}})(jr,or,ar,Hr,si,Mn%2),Yt(jr,or,mr,Hr,ar-1,Mn+1),Yt(jr,or,mr,ar+1,si,Mn+1)}})(St,ke,Oe,0,St.length-1,0)};vr.prototype.range=function(ee,ce,xe,Oe){return function(qe,ct,St,ke,it,Yt,jr){for(var or,mr,Hr=[0,qe.length-1,0],si=[];Hr.length;){var Mn=Hr.pop(),ar=Hr.pop(),Yn=Hr.pop();if(ar-Yn<=jr)for(var Pr=Yn;Pr<=ar;Pr++)mr=ct[2*Pr+1],(or=ct[2*Pr])>=St&&or<=it&&mr>=ke&&mr<=Yt&&si.push(qe[Pr]);else{var gn=Math.floor((Yn+ar)/2);mr=ct[2*gn+1],(or=ct[2*gn])>=St&&or<=it&&mr>=ke&&mr<=Yt&&si.push(qe[gn]);var ea=(Mn+1)%2;(Mn===0?St<=or:ke<=mr)&&(Hr.push(Yn),Hr.push(gn-1),Hr.push(ea)),(Mn===0?it>=or:Yt>=mr)&&(Hr.push(gn+1),Hr.push(ar),Hr.push(ea))}}return si}(this.ids,this.coords,ee,ce,xe,Oe,this.nodeSize)},vr.prototype.within=function(ee,ce,xe){return function(Oe,qe,ct,St,ke,it){for(var Yt=[0,Oe.length-1,0],jr=[],or=ke*ke;Yt.length;){var mr=Yt.pop(),Hr=Yt.pop(),si=Yt.pop();if(Hr-si<=it)for(var Mn=si;Mn<=Hr;Mn++)wt(qe[2*Mn],qe[2*Mn+1],ct,St)<=or&&jr.push(Oe[Mn]);else{var ar=Math.floor((si+Hr)/2),Yn=qe[2*ar],Pr=qe[2*ar+1];wt(Yn,Pr,ct,St)<=or&&jr.push(Oe[ar]);var gn=(mr+1)%2;(mr===0?ct-ke<=Yn:St-ke<=Pr)&&(Yt.push(si),Yt.push(ar-1),Yt.push(gn)),(mr===0?ct+ke>=Yn:St+ke>=Pr)&&(Yt.push(ar+1),Yt.push(Hr),Yt.push(gn))}}return jr}(this.ids,this.coords,ee,ce,xe,this.nodeSize)};var ln={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ee){return ee}},sn=function(ee){this.options=ya(Object.create(ln),ee),this.trees=new Array(this.options.maxZoom+1)};function Mi(ee,ce,xe,Oe,qe){return{x:ee,y:ce,zoom:1/0,id:xe,parentId:-1,numPoints:Oe,properties:qe}}function vi(ee,ce){var xe=ee.geometry.coordinates,Oe=xe[1];return{x:ra(xe[0]),y:Vi(Oe),zoom:1/0,index:ce,parentId:-1}}function en(ee){return{type:"Feature",id:ee.id,properties:Oa(ee),geometry:{type:"Point",coordinates:[(Oe=ee.x,360*(Oe-.5)),(ce=ee.y,xe=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(xe))/Math.PI-90)]}};var ce,xe,Oe}function Oa(ee){var ce=ee.numPoints,xe=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return ya(ya({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:ce,point_count_abbreviated:xe})}function ra(ee){return ee/360+.5}function Vi(ee){var ce=Math.sin(ee*Math.PI/180),xe=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return xe<0?0:xe>1?1:xe}function ya(ee,ce){for(var xe in ce)ee[xe]=ce[xe];return ee}function fi(ee){return ee.x}function $i(ee){return ee.y}function hi(ee,ce,xe,Oe,qe,ct){var St=qe-xe,ke=ct-Oe;if(St!==0||ke!==0){var it=((ee-xe)*St+(ce-Oe)*ke)/(St*St+ke*ke);it>1?(xe=qe,Oe=ct):it>0&&(xe+=St*it,Oe+=ke*it)}return(St=ee-xe)*St+(ke=ce-Oe)*ke}function yi(ee,ce,xe,Oe){var qe={id:ee===void 0?null:ee,type:ce,geometry:xe,tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ct){var St=ct.geometry,ke=ct.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")ss(ct,St);else if(ke==="Polygon"||ke==="MultiLineString")for(var it=0;it<St.length;it++)ss(ct,St[it]);else if(ke==="MultiPolygon")for(it=0;it<St.length;it++)for(var Yt=0;Yt<St[it].length;Yt++)ss(ct,St[it][Yt])}(qe),qe}function ss(ee,ce){for(var xe=0;xe<ce.length;xe+=3)ee.minX=Math.min(ee.minX,ce[xe]),ee.minY=Math.min(ee.minY,ce[xe+1]),ee.maxX=Math.max(ee.maxX,ce[xe]),ee.maxY=Math.max(ee.maxY,ce[xe+1])}function yo(ee,ce,xe,Oe){if(ce.geometry){var qe=ce.geometry.coordinates,ct=ce.geometry.type,St=Math.pow(xe.tolerance/((1<<xe.maxZoom)*xe.extent),2),ke=[],it=ce.id;if(xe.promoteId?it=ce.properties[xe.promoteId]:xe.generateId&&(it=Oe||0),ct==="Point")qa(qe,ke);else if(ct==="MultiPoint")for(var Yt=0;Yt<qe.length;Yt++)qa(qe[Yt],ke);else if(ct==="LineString")Ft(qe,ke,St,!1);else if(ct==="MultiLineString"){if(xe.lineMetrics){for(Yt=0;Yt<qe.length;Yt++)Ft(qe[Yt],ke=[],St,!1),ee.push(yi(it,"LineString",ke,ce.properties));return}be(qe,ke,St,!1)}else if(ct==="Polygon")be(qe,ke,St,!0);else{if(ct!=="MultiPolygon"){if(ct==="GeometryCollection"){for(Yt=0;Yt<ce.geometry.geometries.length;Yt++)yo(ee,{id:it,geometry:ce.geometry.geometries[Yt],properties:ce.properties},xe,Oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Yt=0;Yt<qe.length;Yt++){var jr=[];be(qe[Yt],jr,St,!0),ke.push(jr)}}ee.push(yi(it,ct,ke,ce.properties))}}function qa(ee,ce){ce.push(he(ee[0])),ce.push(Ie(ee[1])),ce.push(0)}function Ft(ee,ce,xe,Oe){for(var qe,ct,St=0,ke=0;ke<ee.length;ke++){var it=he(ee[ke][0]),Yt=Ie(ee[ke][1]);ce.push(it),ce.push(Yt),ce.push(0),ke>0&&(St+=Oe?(qe*Yt-it*ct)/2:Math.sqrt(Math.pow(it-qe,2)+Math.pow(Yt-ct,2))),qe=it,ct=Yt}var jr=ce.length-3;ce[2]=1,function or(mr,Hr,si,Mn){for(var ar,Yn=Mn,Pr=si-Hr>>1,gn=si-Hr,ea=mr[Hr],Vn=mr[Hr+1],na=mr[si],Ht=mr[si+1],Rt=Hr+3;Rt<si;Rt+=3){var da=hi(mr[Rt],mr[Rt+1],ea,Vn,na,Ht);if(da>Yn)ar=Rt,Yn=da;else if(da===Yn){var aa=Math.abs(Rt-Pr);aa<gn&&(ar=Rt,gn=aa)}}Yn>Mn&&(ar-Hr>3&&or(mr,Hr,ar,Mn),mr[ar+2]=Yn,si-ar>3&&or(mr,ar,si,Mn))}(ce,0,jr,xe),ce[jr+2]=1,ce.size=Math.abs(St),ce.start=0,ce.end=ce.size}function be(ee,ce,xe,Oe){for(var qe=0;qe<ee.length;qe++){var ct=[];Ft(ee[qe],ct,xe,Oe),ce.push(ct)}}function he(ee){return ee/360+.5}function Ie(ee){var ce=Math.sin(ee*Math.PI/180),xe=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return xe<0?0:xe>1?1:xe}function G(ee,ce,xe,Oe,qe,ct,St,ke){if(Oe/=ce,ct>=(xe/=ce)&&St<Oe)return ee;if(St<xe||ct>=Oe)return null;for(var it=[],Yt=0;Yt<ee.length;Yt++){var jr=ee[Yt],or=jr.geometry,mr=jr.type,Hr=qe===0?jr.minX:jr.minY,si=qe===0?jr.maxX:jr.maxY;if(Hr>=xe&&si<Oe)it.push(jr);else if(!(si<xe||Hr>=Oe)){var Mn=[];if(mr==="Point"||mr==="MultiPoint")lt(or,Mn,xe,Oe,qe);else if(mr==="LineString")sr(or,Mn,xe,Oe,qe,!1,ke.lineMetrics);else if(mr==="MultiLineString")nt(or,Mn,xe,Oe,qe,!1);else if(mr==="Polygon")nt(or,Mn,xe,Oe,qe,!0);else if(mr==="MultiPolygon")for(var ar=0;ar<or.length;ar++){var Yn=[];nt(or[ar],Yn,xe,Oe,qe,!0),Yn.length&&Mn.push(Yn)}if(Mn.length){if(ke.lineMetrics&&mr==="LineString"){for(ar=0;ar<Mn.length;ar++)it.push(yi(jr.id,mr,Mn[ar],jr.tags));continue}mr!=="LineString"&&mr!=="MultiLineString"||(Mn.length===1?(mr="LineString",Mn=Mn[0]):mr="MultiLineString"),mr!=="Point"&&mr!=="MultiPoint"||(mr=Mn.length===3?"Point":"MultiPoint"),it.push(yi(jr.id,mr,Mn,jr.tags))}}}return it.length?it:null}function lt(ee,ce,xe,Oe,qe){for(var ct=0;ct<ee.length;ct+=3){var St=ee[ct+qe];St>=xe&&St<=Oe&&(ce.push(ee[ct]),ce.push(ee[ct+1]),ce.push(ee[ct+2]))}}function sr(ee,ce,xe,Oe,qe,ct,St){for(var ke,it,Yt=Jr(ee),jr=qe===0?Ar:Tr,or=ee.start,mr=0;mr<ee.length-3;mr+=3){var Hr=ee[mr],si=ee[mr+1],Mn=ee[mr+2],ar=ee[mr+3],Yn=ee[mr+4],Pr=qe===0?Hr:si,gn=qe===0?ar:Yn,ea=!1;St&&(ke=Math.sqrt(Math.pow(Hr-ar,2)+Math.pow(si-Yn,2))),Pr<xe?gn>xe&&(it=jr(Yt,Hr,si,ar,Yn,xe),St&&(Yt.start=or+ke*it)):Pr>Oe?gn<Oe&&(it=jr(Yt,Hr,si,ar,Yn,Oe),St&&(Yt.start=or+ke*it)):Gt(Yt,Hr,si,Mn),gn<xe&&Pr>=xe&&(it=jr(Yt,Hr,si,ar,Yn,xe),ea=!0),gn>Oe&&Pr<=Oe&&(it=jr(Yt,Hr,si,ar,Yn,Oe),ea=!0),!ct&&ea&&(St&&(Yt.end=or+ke*it),ce.push(Yt),Yt=Jr(ee)),St&&(or+=ke)}var Vn=ee.length-3;Hr=ee[Vn],si=ee[Vn+1],Mn=ee[Vn+2],(Pr=qe===0?Hr:si)>=xe&&Pr<=Oe&&Gt(Yt,Hr,si,Mn),Vn=Yt.length-3,ct&&Vn>=3&&(Yt[Vn]!==Yt[0]||Yt[Vn+1]!==Yt[1])&&Gt(Yt,Yt[0],Yt[1],Yt[2]),Yt.length&&ce.push(Yt)}function Jr(ee){var ce=[];return ce.size=ee.size,ce.start=ee.start,ce.end=ee.end,ce}function nt(ee,ce,xe,Oe,qe,ct){for(var St=0;St<ee.length;St++)sr(ee[St],ce,xe,Oe,qe,ct,!1)}function Gt(ee,ce,xe,Oe){ee.push(ce),ee.push(xe),ee.push(Oe)}function Ar(ee,ce,xe,Oe,qe,ct){var St=(ct-ce)/(Oe-ce);return ee.push(ct),ee.push(xe+(qe-xe)*St),ee.push(1),St}function Tr(ee,ce,xe,Oe,qe,ct){var St=(ct-xe)/(qe-xe);return ee.push(ce+(Oe-ce)*St),ee.push(ct),ee.push(1),St}function Rr(ee,ce){for(var xe=[],Oe=0;Oe<ee.length;Oe++){var qe,ct=ee[Oe],St=ct.type;if(St==="Point"||St==="MultiPoint"||St==="LineString")qe=mn(ct.geometry,ce);else if(St==="MultiLineString"||St==="Polygon"){qe=[];for(var ke=0;ke<ct.geometry.length;ke++)qe.push(mn(ct.geometry[ke],ce))}else if(St==="MultiPolygon")for(qe=[],ke=0;ke<ct.geometry.length;ke++){for(var it=[],Yt=0;Yt<ct.geometry[ke].length;Yt++)it.push(mn(ct.geometry[ke][Yt],ce));qe.push(it)}xe.push(yi(ct.id,St,qe,ct.tags))}return xe}function mn(ee,ce){var xe=[];xe.size=ee.size,ee.start!==void 0&&(xe.start=ee.start,xe.end=ee.end);for(var Oe=0;Oe<ee.length;Oe+=3)xe.push(ee[Oe]+ce,ee[Oe+1],ee[Oe+2]);return xe}function mi(ee,ce){if(ee.transformed)return ee;var xe,Oe,qe,ct=1<<ee.z,St=ee.x,ke=ee.y;for(xe=0;xe<ee.features.length;xe++){var it=ee.features[xe],Yt=it.geometry,jr=it.type;if(it.geometry=[],jr===1)for(Oe=0;Oe<Yt.length;Oe+=2)it.geometry.push(ai(Yt[Oe],Yt[Oe+1],ce,ct,St,ke));else for(Oe=0;Oe<Yt.length;Oe++){var or=[];for(qe=0;qe<Yt[Oe].length;qe+=2)or.push(ai(Yt[Oe][qe],Yt[Oe][qe+1],ce,ct,St,ke));it.geometry.push(or)}}return ee.transformed=!0,ee}function ai(ee,ce,xe,Oe,qe,ct){return[Math.round(xe*(ee*Oe-qe)),Math.round(xe*(ce*Oe-ct))]}function Tn(ee,ce,xe,Oe,qe){for(var ct=ce===qe.maxZoom?0:qe.tolerance/((1<<ce)*qe.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:xe,y:Oe,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<ee.length;ke++){St.numFeatures++,Ri(St,ee[ke],ct,qe);var it=ee[ke].minX,Yt=ee[ke].minY,jr=ee[ke].maxX,or=ee[ke].maxY;it<St.minX&&(St.minX=it),Yt<St.minY&&(St.minY=Yt),jr>St.maxX&&(St.maxX=jr),or>St.maxY&&(St.maxY=or)}return St}function Ri(ee,ce,xe,Oe){var qe=ce.geometry,ct=ce.type,St=[];if(ct==="Point"||ct==="MultiPoint")for(var ke=0;ke<qe.length;ke+=3)St.push(qe[ke]),St.push(qe[ke+1]),ee.numPoints++,ee.numSimplified++;else if(ct==="LineString")zi(St,qe,ee,xe,!1,!1);else if(ct==="MultiLineString"||ct==="Polygon")for(ke=0;ke<qe.length;ke++)zi(St,qe[ke],ee,xe,ct==="Polygon",ke===0);else if(ct==="MultiPolygon")for(var it=0;it<qe.length;it++){var Yt=qe[it];for(ke=0;ke<Yt.length;ke++)zi(St,Yt[ke],ee,xe,!0,ke===0)}if(St.length){var jr=ce.tags||null;if(ct==="LineString"&&Oe.lineMetrics){for(var or in jr={},ce.tags)jr[or]=ce.tags[or];jr.mapbox_clip_start=qe.start/qe.size,jr.mapbox_clip_end=qe.end/qe.size}var mr={geometry:St,type:ct==="Polygon"||ct==="MultiPolygon"?3:ct==="LineString"||ct==="MultiLineString"?2:1,tags:jr};ce.id!==null&&(mr.id=ce.id),ee.features.push(mr)}}function zi(ee,ce,xe,Oe,qe,ct){var St=Oe*Oe;if(Oe>0&&ce.size<(qe?St:Oe))xe.numPoints+=ce.length/3;else{for(var ke=[],it=0;it<ce.length;it+=3)(Oe===0||ce[it+2]>St)&&(xe.numSimplified++,ke.push(ce[it]),ke.push(ce[it+1])),xe.numPoints++;qe&&function(Yt,jr){for(var or=0,mr=0,Hr=Yt.length,si=Hr-2;mr<Hr;si=mr,mr+=2)or+=(Yt[mr]-Yt[si])*(Yt[mr+1]+Yt[si+1]);if(or>0===jr)for(mr=0,Hr=Yt.length;mr<Hr/2;mr+=2){var Mn=Yt[mr],ar=Yt[mr+1];Yt[mr]=Yt[Hr-2-mr],Yt[mr+1]=Yt[Hr-1-mr],Yt[Hr-2-mr]=Mn,Yt[Hr-1-mr]=ar}}(ke,ct),ee.push(ke)}}function ka(ee,ce){var xe=(ce=this.options=function(qe,ct){for(var St in ct)qe[St]=ct[St];return qe}(Object.create(this.options),ce)).debug;if(xe&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var Oe=function(qe,ct){var St=[];if(qe.type==="FeatureCollection")for(var ke=0;ke<qe.features.length;ke++)yo(St,qe.features[ke],ct,ke);else yo(St,qe.type==="Feature"?qe:{geometry:qe},ct);return St}(ee,ce);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Oe=function(qe,ct){var St=ct.buffer/ct.extent,ke=qe,it=G(qe,1,-1-St,St,0,-1,2,ct),Yt=G(qe,1,1-St,2+St,0,-1,2,ct);return(it||Yt)&&(ke=G(qe,1,-St,1+St,0,-1,2,ct)||[],it&&(ke=Rr(it,1).concat(ke)),Yt&&(ke=ke.concat(Rr(Yt,-1)))),ke}(Oe,ce)).length&&this.splitTile(Oe,0,0,0),xe&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ia(ee,ce,xe){return 32*((1<<ee)*xe+ce)+ee}function io(ee,ce){var xe=ee.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var Oe=this._geoJSONIndex.getTile(xe.z,xe.x,xe.y);if(!Oe)return ce(null,null);var qe=new It(Oe.features),ct=Dt(qe);ct.byteOffset===0&&ct.byteLength===ct.buffer.byteLength||(ct=new Uint8Array(ct)),ce(null,{vectorTile:qe,rawData:ct.buffer})}sn.prototype.load=function(ee){var ce=this.options,xe=ce.log,Oe=ce.minZoom,qe=ce.maxZoom,ct=ce.nodeSize;xe&&console.time("total time");var St="prepare "+ee.length+" points";xe&&console.time(St),this.points=ee;for(var ke=[],it=0;it<ee.length;it++)ee[it].geometry&&ke.push(vi(ee[it],it));this.trees[qe+1]=new vr(ke,fi,$i,ct,Float32Array),xe&&console.timeEnd(St);for(var Yt=qe;Yt>=Oe;Yt--){var jr=+Date.now();ke=this._cluster(ke,Yt),this.trees[Yt]=new vr(ke,fi,$i,ct,Float32Array),xe&&console.log("z%d: %d clusters in %dms",Yt,ke.length,+Date.now()-jr)}return xe&&console.timeEnd("total time"),this},sn.prototype.getClusters=function(ee,ce){var xe=((ee[0]+180)%360+360)%360-180,Oe=Math.max(-90,Math.min(90,ee[1])),qe=ee[2]===180?180:((ee[2]+180)%360+360)%360-180,ct=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)xe=-180,qe=180;else if(xe>qe){var St=this.getClusters([xe,Oe,180,ct],ce),ke=this.getClusters([-180,Oe,qe,ct],ce);return St.concat(ke)}for(var it=this.trees[this._limitZoom(ce)],Yt=[],jr=0,or=it.range(ra(xe),Vi(ct),ra(qe),Vi(Oe));jr<or.length;jr+=1){var mr=it.points[or[jr]];Yt.push(mr.numPoints?en(mr):this.points[mr.index])}return Yt},sn.prototype.getChildren=function(ee){var ce=this._getOriginId(ee),xe=this._getOriginZoom(ee),Oe="No cluster with the specified id.",qe=this.trees[xe];if(!qe)throw new Error(Oe);var ct=qe.points[ce];if(!ct)throw new Error(Oe);for(var St=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),ke=[],it=0,Yt=qe.within(ct.x,ct.y,St);it<Yt.length;it+=1){var jr=qe.points[Yt[it]];jr.parentId===ee&&ke.push(jr.numPoints?en(jr):this.points[jr.index])}if(ke.length===0)throw new Error(Oe);return ke},sn.prototype.getLeaves=function(ee,ce,xe){var Oe=[];return this._appendLeaves(Oe,ee,ce=ce||10,xe=xe||0,0),Oe},sn.prototype.getTile=function(ee,ce,xe){var Oe=this.trees[this._limitZoom(ee)],qe=Math.pow(2,ee),ct=this.options,St=ct.radius/ct.extent,ke=(xe-St)/qe,it=(xe+1+St)/qe,Yt={features:[]};return this._addTileFeatures(Oe.range((ce-St)/qe,ke,(ce+1+St)/qe,it),Oe.points,ce,xe,qe,Yt),ce===0&&this._addTileFeatures(Oe.range(1-St/qe,ke,1,it),Oe.points,qe,xe,qe,Yt),ce===qe-1&&this._addTileFeatures(Oe.range(0,ke,St/qe,it),Oe.points,-1,xe,qe,Yt),Yt.features.length?Yt:null},sn.prototype.getClusterExpansionZoom=function(ee){for(var ce=this._getOriginZoom(ee)-1;ce<=this.options.maxZoom;){var xe=this.getChildren(ee);if(ce++,xe.length!==1)break;ee=xe[0].properties.cluster_id}return ce},sn.prototype._appendLeaves=function(ee,ce,xe,Oe,qe){for(var ct=0,St=this.getChildren(ce);ct<St.length;ct+=1){var ke=St[ct],it=ke.properties;if(it&&it.cluster?qe+it.point_count<=Oe?qe+=it.point_count:qe=this._appendLeaves(ee,it.cluster_id,xe,Oe,qe):qe<Oe?qe++:ee.push(ke),ee.length===xe)break}return qe},sn.prototype._addTileFeatures=function(ee,ce,xe,Oe,qe,ct){for(var St=0,ke=ee;St<ke.length;St+=1){var it=ce[ke[St]],Yt=it.numPoints,jr={type:1,geometry:[[Math.round(this.options.extent*(it.x*qe-xe)),Math.round(this.options.extent*(it.y*qe-Oe))]],tags:Yt?Oa(it):this.points[it.index].properties},or=void 0;Yt?or=it.id:this.options.generateId?or=it.index:this.points[it.index].id&&(or=this.points[it.index].id),or!==void 0&&(jr.id=or),ct.features.push(jr)}},sn.prototype._limitZoom=function(ee){return Math.max(this.options.minZoom,Math.min(+ee,this.options.maxZoom+1))},sn.prototype._cluster=function(ee,ce){for(var xe=[],Oe=this.options,qe=Oe.reduce,ct=Oe.minPoints,St=Oe.radius/(Oe.extent*Math.pow(2,ce)),ke=0;ke<ee.length;ke++){var it=ee[ke];if(!(it.zoom<=ce)){it.zoom=ce;for(var Yt=this.trees[ce+1],jr=Yt.within(it.x,it.y,St),or=it.numPoints||1,mr=or,Hr=0,si=jr;Hr<si.length;Hr+=1){var Mn=Yt.points[si[Hr]];Mn.zoom>ce&&(mr+=Mn.numPoints||1)}if(mr>=ct){for(var ar=it.x*or,Yn=it.y*or,Pr=qe&&or>1?this._map(it,!0):null,gn=(ke<<5)+(ce+1)+this.points.length,ea=0,Vn=jr;ea<Vn.length;ea+=1){var na=Yt.points[Vn[ea]];if(!(na.zoom<=ce)){na.zoom=ce;var Ht=na.numPoints||1;ar+=na.x*Ht,Yn+=na.y*Ht,na.parentId=gn,qe&&(Pr||(Pr=this._map(it,!0)),qe(Pr,this._map(na)))}}it.parentId=gn,xe.push(Mi(ar/mr,Yn/mr,gn,mr,Pr))}else if(xe.push(it),mr>1)for(var Rt=0,da=jr;Rt<da.length;Rt+=1){var aa=Yt.points[da[Rt]];aa.zoom<=ce||(aa.zoom=ce,xe.push(aa))}}}return xe},sn.prototype._getOriginId=function(ee){return ee-this.points.length>>5},sn.prototype._getOriginZoom=function(ee){return(ee-this.points.length)%32},sn.prototype._map=function(ee,ce){if(ee.numPoints)return ce?ya({},ee.properties):ee.properties;var xe=this.points[ee.index].properties,Oe=this.options.map(xe);return ce&&Oe===xe?ya({},Oe):Oe},ka.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ka.prototype.splitTile=function(ee,ce,xe,Oe,qe,ct,St){for(var ke=[ee,ce,xe,Oe],it=this.options,Yt=it.debug;ke.length;){Oe=ke.pop(),xe=ke.pop(),ce=ke.pop(),ee=ke.pop();var jr=1<<ce,or=ia(ce,xe,Oe),mr=this.tiles[or];if(!mr&&(Yt>1&&console.time("creation"),mr=this.tiles[or]=Tn(ee,ce,xe,Oe,it),this.tileCoords.push({z:ce,x:xe,y:Oe}),Yt)){Yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,xe,Oe,mr.numFeatures,mr.numPoints,mr.numSimplified),console.timeEnd("creation"));var Hr="z"+ce;this.stats[Hr]=(this.stats[Hr]||0)+1,this.total++}if(mr.source=ee,qe){if(ce===it.maxZoom||ce===qe)continue;var si=1<<qe-ce;if(xe!==Math.floor(ct/si)||Oe!==Math.floor(St/si))continue}else if(ce===it.indexMaxZoom||mr.numPoints<=it.indexMaxPoints)continue;if(mr.source=null,ee.length!==0){Yt>1&&console.time("clipping");var Mn,ar,Yn,Pr,gn,ea,Vn=.5*it.buffer/it.extent,na=.5-Vn,Ht=.5+Vn,Rt=1+Vn;Mn=ar=Yn=Pr=null,gn=G(ee,jr,xe-Vn,xe+Ht,0,mr.minX,mr.maxX,it),ea=G(ee,jr,xe+na,xe+Rt,0,mr.minX,mr.maxX,it),ee=null,gn&&(Mn=G(gn,jr,Oe-Vn,Oe+Ht,1,mr.minY,mr.maxY,it),ar=G(gn,jr,Oe+na,Oe+Rt,1,mr.minY,mr.maxY,it),gn=null),ea&&(Yn=G(ea,jr,Oe-Vn,Oe+Ht,1,mr.minY,mr.maxY,it),Pr=G(ea,jr,Oe+na,Oe+Rt,1,mr.minY,mr.maxY,it),ea=null),Yt>1&&console.timeEnd("clipping"),ke.push(Mn||[],ce+1,2*xe,2*Oe),ke.push(ar||[],ce+1,2*xe,2*Oe+1),ke.push(Yn||[],ce+1,2*xe+1,2*Oe),ke.push(Pr||[],ce+1,2*xe+1,2*Oe+1)}}},ka.prototype.getTile=function(ee,ce,xe){var Oe=this.options,qe=Oe.extent,ct=Oe.debug;if(ee<0||ee>24)return null;var St=1<<ee,ke=ia(ee,ce=(ce%St+St)%St,xe);if(this.tiles[ke])return mi(this.tiles[ke],qe);ct>1&&console.log("drilling down to z%d-%d-%d",ee,ce,xe);for(var it,Yt=ee,jr=ce,or=xe;!it&&Yt>0;)Yt--,jr=Math.floor(jr/2),or=Math.floor(or/2),it=this.tiles[ia(Yt,jr,or)];return it&&it.source?(ct>1&&console.log("found parent tile z%d-%d-%d",Yt,jr,or),ct>1&&console.time("drilling down"),this.splitTile(it.source,Yt,jr,or,ee,ce,xe),ct>1&&console.timeEnd("drilling down"),this.tiles[ke]?mi(this.tiles[ke],qe):null):null};var Ci=function(ee){function ce(xe,Oe,qe,ct){ee.call(this,xe,Oe,qe,io),ct&&(this.loadGeoJSON=ct)}return ee&&(ce.__proto__=ee),(ce.prototype=Object.create(ee&&ee.prototype)).constructor=ce,ce.prototype.loadData=function(xe,Oe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Oe,this._pendingLoadDataParams=xe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var xe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Oe=this._pendingCallback,qe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ct=!!(qe&&qe.request&&qe.request.collectResourceTiming)&&new y.RequestPerformance(qe.request);this.loadGeoJSON(qe,function(St,ke){if(St||!ke)return Oe(St);if(typeof ke!="object")return Oe(new Error("Input data given to '"+qe.source+"' is not a valid GeoJSON object."));(function mr(Hr,si){var Mn,ar=Hr&&Hr.type;if(ar==="FeatureCollection")for(Mn=0;Mn<Hr.features.length;Mn++)mr(Hr.features[Mn],si);else if(ar==="GeometryCollection")for(Mn=0;Mn<Hr.geometries.length;Mn++)mr(Hr.geometries[Mn],si);else if(ar==="Feature")mr(Hr.geometry,si);else if(ar==="Polygon")Vt(Hr.coordinates,si);else if(ar==="MultiPolygon")for(Mn=0;Mn<Hr.coordinates.length;Mn++)Vt(Hr.coordinates[Mn],si);return Hr})(ke,!0);try{if(qe.filter){var it=y.createExpression(qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(function(mr){return mr.key+": "+mr.message}).join(", "));var Yt=ke.features.filter(function(mr){return it.value.evaluate({zoom:0},mr)});ke={type:"FeatureCollection",features:Yt}}xe._geoJSONIndex=qe.cluster?new sn(function(mr){var Hr=mr.superclusterOptions,si=mr.clusterProperties;if(!si||!Hr)return Hr;for(var Mn={},ar={},Yn={accumulated:null,zoom:0},Pr={properties:null},gn=Object.keys(si),ea=0,Vn=gn;ea<Vn.length;ea+=1){var na=Vn[ea],Ht=si[na],Rt=Ht[0],da=y.createExpression(Ht[1]),aa=y.createExpression(typeof Rt=="string"?[Rt,["accumulated"],["get",na]]:Rt);Mn[na]=da.value,ar[na]=aa.value}return Hr.map=function(Di){Pr.properties=Di;for(var Ii={},_o=0,Na=gn;_o<Na.length;_o+=1){var Or=Na[_o];Ii[Or]=Mn[Or].evaluate(Yn,Pr)}return Ii},Hr.reduce=function(Di,Ii){Pr.properties=Ii;for(var _o=0,Na=gn;_o<Na.length;_o+=1){var Or=Na[_o];Yn.accumulated=Di[Or],Di[Or]=ar[Or].evaluate(Yn,Pr)}},Hr}(qe)).load(ke.features):function(mr,Hr){return new ka(mr,Hr)}(ke,qe.geojsonVtOptions)}catch(mr){return Oe(mr)}xe.loaded={};var jr={};if(ct){var or=ct.finish();or&&(jr.resourceTiming={},jr.resourceTiming[qe.source]=JSON.parse(JSON.stringify(or)))}Oe(null,jr)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(xe,Oe){var qe=this.loaded;return qe&&qe[xe.uid]?ee.prototype.reloadTile.call(this,xe,Oe):this.loadTile(xe,Oe)},ce.prototype.loadGeoJSON=function(xe,Oe){if(xe.request)y.getJSON(xe.request,Oe);else{if(typeof xe.data!="string")return Oe(new Error("Input data given to '"+xe.source+"' is not a valid GeoJSON object."));try{return Oe(null,JSON.parse(xe.data))}catch(qe){return Oe(new Error("Input data given to '"+xe.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(xe,Oe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Oe()},ce.prototype.getClusterExpansionZoom=function(xe,Oe){try{Oe(null,this._geoJSONIndex.getClusterExpansionZoom(xe.clusterId))}catch(qe){Oe(qe)}},ce.prototype.getClusterChildren=function(xe,Oe){try{Oe(null,this._geoJSONIndex.getChildren(xe.clusterId))}catch(qe){Oe(qe)}},ce.prototype.getClusterLeaves=function(xe,Oe){try{Oe(null,this._geoJSONIndex.getLeaves(xe.clusterId,xe.limit,xe.offset))}catch(qe){Oe(qe)}},ce}(dt),pa=function(ee){var ce=this;this.self=ee,this.actor=new y.Actor(ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:dt,geojson:Ci},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(xe,Oe){if(ce.workerSourceTypes[xe])throw new Error('Worker source with name "'+xe+'" already registered.');ce.workerSourceTypes[xe]=Oe},this.self.registerRTLTextPlugin=function(xe){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=xe.applyArabicShaping,y.plugin.processBidirectionalText=xe.processBidirectionalText,y.plugin.processStyledBidirectionalText=xe.processStyledBidirectionalText}};return pa.prototype.setReferrer=function(ee,ce){this.referrer=ce},pa.prototype.setImages=function(ee,ce,xe){for(var Oe in this.availableImages[ee]=ce,this.workerSources[ee]){var qe=this.workerSources[ee][Oe];for(var ct in qe)qe[ct].availableImages=ce}xe()},pa.prototype.setLayers=function(ee,ce,xe){this.getLayerIndex(ee).replace(ce),xe()},pa.prototype.updateLayers=function(ee,ce,xe){this.getLayerIndex(ee).update(ce.layers,ce.removedIds),xe()},pa.prototype.loadTile=function(ee,ce,xe){this.getWorkerSource(ee,ce.type,ce.source).loadTile(ce,xe)},pa.prototype.loadDEMTile=function(ee,ce,xe){this.getDEMWorkerSource(ee,ce.source).loadTile(ce,xe)},pa.prototype.reloadTile=function(ee,ce,xe){this.getWorkerSource(ee,ce.type,ce.source).reloadTile(ce,xe)},pa.prototype.abortTile=function(ee,ce,xe){this.getWorkerSource(ee,ce.type,ce.source).abortTile(ce,xe)},pa.prototype.removeTile=function(ee,ce,xe){this.getWorkerSource(ee,ce.type,ce.source).removeTile(ce,xe)},pa.prototype.removeDEMTile=function(ee,ce){this.getDEMWorkerSource(ee,ce.source).removeTile(ce)},pa.prototype.removeSource=function(ee,ce,xe){if(this.workerSources[ee]&&this.workerSources[ee][ce.type]&&this.workerSources[ee][ce.type][ce.source]){var Oe=this.workerSources[ee][ce.type][ce.source];delete this.workerSources[ee][ce.type][ce.source],Oe.removeSource!==void 0?Oe.removeSource(ce,xe):xe()}},pa.prototype.loadWorkerSource=function(ee,ce,xe){try{this.self.importScripts(ce.url),xe()}catch(Oe){xe(Oe.toString())}},pa.prototype.syncRTLPluginState=function(ee,ce,xe){try{y.plugin.setState(ce);var Oe=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&Oe!=null){this.self.importScripts(Oe);var qe=y.plugin.isParsed();xe(qe?void 0:new Error("RTL Text Plugin failed to import scripts from "+Oe),qe)}}catch(ct){xe(ct.toString())}},pa.prototype.getAvailableImages=function(ee){var ce=this.availableImages[ee];return ce||(ce=[]),ce},pa.prototype.getLayerIndex=function(ee){var ce=this.layerIndexes[ee];return ce||(ce=this.layerIndexes[ee]=new Me),ce},pa.prototype.getWorkerSource=function(ee,ce,xe){var Oe=this;return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][ce]||(this.workerSources[ee][ce]={}),this.workerSources[ee][ce][xe]||(this.workerSources[ee][ce][xe]=new this.workerSourceTypes[ce]({send:function(qe,ct,St){Oe.actor.send(qe,ct,St,ee)}},this.getLayerIndex(ee),this.getAvailableImages(ee))),this.workerSources[ee][ce][xe]},pa.prototype.getDEMWorkerSource=function(ee,ce){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][ce]||(this.demWorkerSources[ee][ce]=new Et),this.demWorkerSources[ee][ce]},pa.prototype.enforceCacheSizeLimit=function(ee,ce){y.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new pa(self)),pa}),ge(["./shared"],function(y){"use strict";var Fe=y.createCommonjsModule(function(c){function p(S){return!f(S)}function f(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var O,z,q=new Blob([""],{type:"text/javascript"}),oe=URL.createObjectURL(q);try{z=new Worker(oe),O=!0}catch(Te){O=!1}return z&&z.terminate(),URL.revokeObjectURL(oe),O}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var O=document.createElement("canvas");O.width=O.height=1;var z=O.getContext("2d");if(!z)return!1;var q=z.getImageData(0,0,1,1);return q&&q.width===O.width}()?(g[I=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[I]=function(O){var z=function(oe){var Te=document.createElement("canvas"),Pe=Object.create(p.webGLContextAttributes);return Pe.failIfMajorPerformanceCaveat=oe,Te.probablySupportsContext?Te.probablySupportsContext("webgl",Pe)||Te.probablySupportsContext("experimental-webgl",Pe):Te.supportsContext?Te.supportsContext("webgl",Pe)||Te.supportsContext("experimental-webgl",Pe):Te.getContext("webgl",Pe)||Te.getContext("experimental-webgl",Pe)}(O);if(!z)return!1;var q=z.createShader(z.VERTEX_SHADER);return!(!q||z.isContextLost())&&(z.shaderSource(q,"void main() {}"),z.compileShader(q),z.getShaderParameter(q,z.COMPILE_STATUS)===!0)}(I)),g[I]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var I}c.exports?c.exports=p:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=p,window.mapboxgl.notSupportedReason=f);var g={};p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),K={create:function(c,p,f){var g=y.window.document.createElement(c);return p!==void 0&&(g.className=p),f&&f.appendChild(g),g},createNS:function(c,p){return y.window.document.createElementNS(c,p)}},Me=y.window.document&&y.window.document.documentElement.style;function ve(c){if(!Me)return c[0];for(var p=0;p<c.length;p++)if(c[p]in Me)return c[p];return c[0]}var at,se=ve(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);K.disableDrag=function(){Me&&se&&(at=Me[se],Me[se]="none")},K.enableDrag=function(){Me&&se&&(Me[se]=at)};var Be=ve(["transform","WebkitTransform"]);K.setTransform=function(c,p){c.style[Be]=p};var dt=!1;try{var rt=Object.defineProperty({},"passive",{get:function(){dt=!0}});y.window.addEventListener("test",rt,rt),y.window.removeEventListener("test",rt,rt)}catch(c){dt=!1}K.addEventListener=function(c,p,f,g){g===void 0&&(g={}),c.addEventListener(p,f,"passive"in g&&dt?g:g.capture)},K.removeEventListener=function(c,p,f,g){g===void 0&&(g={}),c.removeEventListener(p,f,"passive"in g&&dt?g:g.capture)};var Et=function(c){c.preventDefault(),c.stopPropagation(),y.window.removeEventListener("click",Et,!0)};function Vt(c){var p=c.userImage;return!!(p&&p.render&&p.render())&&(c.data.replace(new Uint8Array(p.data.buffer)),!0)}K.suppressClick=function(){y.window.addEventListener("click",Et,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",Et,!0)},0)},K.mousePos=function(c,p){var f=c.getBoundingClientRect();return new y.Point(p.clientX-f.left-c.clientLeft,p.clientY-f.top-c.clientTop)},K.touchPos=function(c,p){for(var f=c.getBoundingClientRect(),g=[],S=0;S<p.length;S++)g.push(new y.Point(p[S].clientX-f.left-c.clientLeft,p[S].clientY-f.top-c.clientTop));return g},K.mouseButton=function(c){return y.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},K.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Ut=function(c){function p(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.isLoaded=function(){return this.loaded},p.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var g=0,S=this.requestors;g<S.length;g+=1){var I=S[g];this._notify(I.ids,I.callback)}this.requestors=[]}},p.prototype.getImage=function(f){return this.images[f]},p.prototype.addImage=function(f,g){this._validate(f,g)&&(this.images[f]=g)},p.prototype._validate=function(f,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},p.prototype._validateStretch=function(f,g){if(!f)return!0;for(var S=0,I=0,O=f;I<O.length;I+=1){var z=O[I];if(z[0]<S||z[1]<z[0]||g<z[1])return!1;S=z[1]}return!0},p.prototype._validateContent=function(f,g){return!(f&&(f.length!==4||f[0]<0||g.data.width<f[0]||f[1]<0||g.data.height<f[1]||f[2]<0||g.data.width<f[2]||f[3]<0||g.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},p.prototype.updateImage=function(f,g){g.version=this.images[f].version+1,this.images[f]=g,this.updatedImages[f]=!0},p.prototype.removeImage=function(f){var g=this.images[f];delete this.images[f],delete this.patterns[f],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},p.prototype.listImages=function(){return Object.keys(this.images)},p.prototype.getImages=function(f,g){var S=!0;if(!this.isLoaded())for(var I=0,O=f;I<O.length;I+=1)this.images[O[I]]||(S=!1);this.isLoaded()||S?this._notify(f,g):this.requestors.push({ids:f,callback:g})},p.prototype._notify=function(f,g){for(var S={},I=0,O=f;I<O.length;I+=1){var z=O[I];this.images[z]||this.fire(new y.Event("styleimagemissing",{id:z}));var q=this.images[z];q?S[z]={data:q.data.clone(),pixelRatio:q.pixelRatio,sdf:q.sdf,version:q.version,stretchX:q.stretchX,stretchY:q.stretchY,content:q.content,hasRenderCallback:Boolean(q.userImage&&q.userImage.render)}:y.warnOnce('Image "'+z+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},p.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},p.prototype.getPattern=function(f){var g=this.patterns[f],S=this.getImage(f);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},O=new y.ImagePosition(I,S);this.patterns[f]={bin:I,position:O}}return this._updatePatternAtlas(),this.patterns[f].position},p.prototype.bind=function(f){var g=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(f,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},p.prototype._updatePatternAtlas=function(){var f=[];for(var g in this.patterns)f.push(this.patterns[g].bin);var S=y.potpack(f),I=S.w,O=S.h,z=this.atlasImage;for(var q in z.resize({width:I||1,height:O||1}),this.patterns){var oe=this.patterns[q].bin,Te=oe.x+1,Pe=oe.y+1,_e=this.images[q].data,Je=_e.width,$e=_e.height;y.RGBAImage.copy(_e,z,{x:0,y:0},{x:Te,y:Pe},{width:Je,height:$e}),y.RGBAImage.copy(_e,z,{x:0,y:$e-1},{x:Te,y:Pe-1},{width:Je,height:1}),y.RGBAImage.copy(_e,z,{x:0,y:0},{x:Te,y:Pe+$e},{width:Je,height:1}),y.RGBAImage.copy(_e,z,{x:Je-1,y:0},{x:Te-1,y:Pe},{width:1,height:$e}),y.RGBAImage.copy(_e,z,{x:0,y:0},{x:Te+Je,y:Pe},{width:1,height:$e})}this.dirty=!0},p.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},p.prototype.dispatchRenderCallbacks=function(f){for(var g=0,S=f;g<S.length;g+=1){var I=S[g];if(!this.callbackDispatchedThisFrame[I]){this.callbackDispatchedThisFrame[I]=!0;var O=this.images[I];Vt(O)&&this.updateImage(I,O)}}},p}(y.Evented),lr=Lt,Qt=Lt,It=1e20;function Lt(c,p,f,g,S,I){this.fontSize=c||24,this.buffer=p===void 0?3:p,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=I||"normal",this.radius=f||8;var O=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=O,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.d=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Int16Array(O),this.middle=Math.round(O/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function fr(c,p,f,g,S,I,O){for(var z=0;z<p;z++){for(var q=0;q<f;q++)g[q]=c[q*p+z];for(ie(g,S,I,O,f),q=0;q<f;q++)c[q*p+z]=S[q]}for(q=0;q<f;q++){for(z=0;z<p;z++)g[z]=c[q*p+z];for(ie(g,S,I,O,p),z=0;z<p;z++)c[q*p+z]=Math.sqrt(S[z])}}function ie(c,p,f,g,S){f[0]=0,g[0]=-It,g[1]=+It;for(var I=1,O=0;I<S;I++){for(var z=(c[I]+I*I-(c[f[O]]+f[O]*f[O]))/(2*I-2*f[O]);z<=g[O];)O--,z=(c[I]+I*I-(c[f[O]]+f[O]*f[O]))/(2*I-2*f[O]);f[++O]=I,g[O]=z,g[O+1]=+It}for(I=0,O=0;I<S;I++){for(;g[O+1]<I;)O++;p[I]=(I-f[O])*(I-f[O])+c[f[O]]}}Lt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var p=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=p.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?It:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?It:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(fr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),fr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)f[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return f},lr.default=Qt;var yr=function(c,p){this.requestManager=c,this.localIdeographFontFamily=p,this.entries={}};yr.prototype.setURL=function(c){this.url=c},yr.prototype.getGlyphs=function(c,p){var f=this,g=[];for(var S in c)for(var I=0,O=c[S];I<O.length;I+=1)g.push({stack:S,id:O[I]});y.asyncAll(g,function(z,q){var oe=z.stack,Te=z.id,Pe=f.entries[oe];Pe||(Pe=f.entries[oe]={glyphs:{},requests:{},ranges:{}});var _e=Pe.glyphs[Te];if(_e===void 0){if(_e=f._tinySDF(Pe,oe,Te))return Pe.glyphs[Te]=_e,void q(null,{stack:oe,id:Te,glyph:_e});var Je=Math.floor(Te/256);if(256*Je>65535)q(new Error("glyphs > 65535 not supported"));else if(Pe.ranges[Je])q(null,{stack:oe,id:Te,glyph:_e});else{var $e=Pe.requests[Je];$e||($e=Pe.requests[Je]=[],yr.loadGlyphRange(oe,Je,f.url,f.requestManager,function(mt,Ye){if(Ye){for(var gt in Ye)f._doesCharSupportLocalGlyph(+gt)||(Pe.glyphs[+gt]=Ye[+gt]);Pe.ranges[Je]=!0}for(var Pt=0,qt=$e;Pt<qt.length;Pt+=1)(0,qt[Pt])(mt,Ye);delete Pe.requests[Je]})),$e.push(function(mt,Ye){mt?q(mt):Ye&&q(null,{stack:oe,id:Te,glyph:Ye[Te]||null})})}}else q(null,{stack:oe,id:Te,glyph:_e})},function(z,q){if(z)p(z);else if(q){for(var oe={},Te=0,Pe=q;Te<Pe.length;Te+=1){var _e=Pe[Te],Je=_e.stack,$e=_e.id,mt=_e.glyph;(oe[Je]||(oe[Je]={}))[$e]=mt&&{id:mt.id,bitmap:mt.bitmap.clone(),metrics:mt.metrics}}p(null,oe)}})},yr.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](c)||y.isChar["Hangul Syllables"](c)||y.isChar.Hiragana(c)||y.isChar.Katakana(c))},yr.prototype._tinySDF=function(c,p,f){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var I="400";/bold/i.test(p)?I="900":/medium/i.test(p)?I="500":/light/i.test(p)&&(I="200"),S=c.tinySDF=new yr.TinySDF(24,3,8,.25,g,I)}return{id:f,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},yr.loadGlyphRange=function(c,p,f,g,S){var I=256*p,O=I+255,z=g.transformRequest(g.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",I+"-"+O),y.ResourceType.Glyphs);y.getArrayBuffer(z,function(q,oe){if(q)S(q);else if(oe){for(var Te={},Pe=0,_e=y.parseGlyphPBF(oe);Pe<_e.length;Pe+=1){var Je=_e[Pe];Te[Je.id]=Je}S(null,Te)}})},yr.TinySDF=lr;var Dt=function(){this.specification=y.styleSpec.light.position};Dt.prototype.possiblyEvaluate=function(c,p){return y.sphericalToCartesian(c.expression.evaluate(p))},Dt.prototype.interpolate=function(c,p,f){return{x:y.number(c.x,p.x,f),y:y.number(c.y,p.y,f),z:y.number(c.z,p.z,f)}};var xt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Dt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Jt=function(c){function p(f){c.call(this),this._transitionable=new y.Transitionable(xt),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getLight=function(){return this._transitionable.serialize()},p.prototype.setLight=function(f,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,f,g))for(var S in f){var I=f[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),I):this._transitionable.setValue(S,I)}},p.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},p.prototype.hasTransition=function(){return this._transitioning.hasTransition()},p.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},p.prototype._validate=function(f,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,f.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},p}(y.Evented),je=function(c,p){this.width=c,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};je.prototype.getDash=function(c,p){var f=c.join(",")+String(p);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,p)),this.dashEntry[f]},je.prototype.getDashRanges=function(c,p,f){var g=[],S=c.length%2==1?-c[c.length-1]*f:0,I=c[0]*f,O=!0;g.push({left:S,right:I,isDash:O,zeroLength:c[0]===0});for(var z=c[0],q=1;q<c.length;q++){var oe=c[q];g.push({left:S=z*f,right:I=(z+=oe)*f,isDash:O=!O,zeroLength:oe===0})}return g},je.prototype.addRoundDash=function(c,p,f){for(var g=p/2,S=-f;S<=f;S++)for(var I=this.width*(this.nextRow+f+S),O=0,z=c[O],q=0;q<this.width;q++){q/z.right>1&&(z=c[++O]);var oe=Math.abs(q-z.left),Te=Math.abs(q-z.right),Pe=Math.min(oe,Te),_e=void 0,Je=S/f*(g+1);if(z.isDash){var $e=g-Math.abs(Je);_e=Math.sqrt(Pe*Pe+$e*$e)}else _e=g-Math.sqrt(Pe*Pe+Je*Je);this.data[I+q]=Math.max(0,Math.min(255,_e+128))}},je.prototype.addRegularDash=function(c){for(var p=c.length-1;p>=0;--p){var f=c[p],g=c[p+1];f.zeroLength?c.splice(p,1):g&&g.isDash===f.isDash&&(g.left=f.left,c.splice(p,1))}var S=c[0],I=c[c.length-1];S.isDash===I.isDash&&(S.left=I.left-this.width,I.right=S.right+this.width);for(var O=this.width*this.nextRow,z=0,q=c[z],oe=0;oe<this.width;oe++){oe/q.right>1&&(q=c[++z]);var Te=Math.abs(oe-q.left),Pe=Math.abs(oe-q.right),_e=Math.min(Te,Pe);this.data[O+oe]=Math.max(0,Math.min(255,(q.isDash?_e:-_e)+128))}},je.prototype.addDash=function(c,p){var f=p?7:0,g=2*f+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,I=0;I<c.length;I++)S+=c[I];if(S!==0){var O=this.width/S,z=this.getDashRanges(c,this.width,O);p?this.addRoundDash(z,O,f):this.addRegularDash(z)}var q={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=g,this.dirty=!0,q},je.prototype.bind=function(c){var p=c.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))};var Sr=function c(p,f){this.workerPool=p,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var I=new c.Actor(g[S],f,this.id);I.name="Worker "+S,this.actors.push(I)}};function tn(c,p,f){var g=function(S,I){if(S)return f(S);if(I){var O=y.pick(y.extend(I,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(O.vectorLayers=I.vector_layers,O.vectorLayerIds=O.vectorLayers.map(function(z){return z.id})),O.tiles=p.canonicalizeTileset(O,c.url),f(null,O)}};return c.url?y.getJSON(p.transformRequest(p.normalizeSourceURL(c.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,c)})}Sr.prototype.broadcast=function(c,p,f){y.asyncAll(this.actors,function(g,S){g.send(c,p,S)},f=f||function(){})},Sr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Sr.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Sr.Actor=y.Actor;var re=function(c,p,f){this.bounds=y.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=f||24};re.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},re.prototype.contains=function(c){var p=Math.pow(2,c.z),f=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*p),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*p),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*p),I=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*p);return c.x>=f&&c.x<S&&c.y>=g&&c.y<I};var Se=function(c){function p(f,g,S,I){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=tn(this._options,this.map._requestManager,function(g,S){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new y.ErrorEvent(g)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new re(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},p.prototype.setTiles=function(f){var g=this;return this.setSourceProperty(function(){g._options.tiles=f}),this},p.prototype.setUrl=function(f){var g=this;return this.setSourceProperty(function(){g.url=f,g._options.url=f}),this},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return y.extend({},this._options)},p.prototype.loadTile=function(f,g){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function O(z,q){return delete f.request,f.aborted?g(null):z&&z.status!==404?g(z):(q&&q.resourceTiming&&(f.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&f.setExpiryData(q),f.loadVectorData(q,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=g:f.request=f.actor.send("reloadTile",I,O.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",I,O.bind(this)))},p.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},p.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},p.prototype.hasTransition=function(){return!1},p}(y.Evented),V=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=tn(this._options,this.map._requestManager,function(g,S){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new y.ErrorEvent(g)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new re(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return y.extend({},this._options)},p.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},p.prototype.loadTile=function(f,g){var S=this,I=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=y.getImage(this.map._requestManager.transformRequest(I,y.ResourceType.Tile),function(O,z){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(O)f.state="errored",g(O);else if(z){S.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var q=S.map.painter.context,oe=q.gl;f.texture=S.map.painter.getTileTexture(z.width),f.texture?f.texture.update(z,{useMipmap:!0}):(f.texture=new y.Texture(q,z,oe.RGBA,{useMipmap:!0}),f.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST),q.extTextureFilterAnisotropic&&oe.texParameterf(oe.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax)),f.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},p.prototype.abortTile=function(f,g){f.request&&(f.request.cancel(),delete f.request),g()},p.prototype.unloadTile=function(f,g){f.texture&&this.map.painter.saveTileTexture(f.texture),g()},p.prototype.hasTransition=function(){return!1},p}(y.Evented),Q=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},p.prototype.loadTile=function(f,g){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function I(O,z){O&&(f.state="errored",g(O)),z&&(f.dem=z,f.needsHillshadePrepare=!0,f.state="loaded",g(null))}f.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(O,z){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(O)f.state="errored",g(O);else if(z){this.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var q=y.window.ImageBitmap&&z instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?z:y.browser.getImageData(z,1),oe={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:q,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",oe,I.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},p.prototype._getNeighboringTiles=function(f){var g=f.canonical,S=Math.pow(2,g.z),I=(g.x-1+S)%S,O=g.x===0?f.wrap-1:f.wrap,z=(g.x+1+S)%S,q=g.x+1===S?f.wrap+1:f.wrap,oe={};return oe[new y.OverscaledTileID(f.overscaledZ,O,g.z,I,g.y).key]={backfilled:!1},oe[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y).key]={backfilled:!1},g.y>0&&(oe[new y.OverscaledTileID(f.overscaledZ,O,g.z,I,g.y-1).key]={backfilled:!1},oe[new y.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},oe[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y-1).key]={backfilled:!1}),g.y+1<S&&(oe[new y.OverscaledTileID(f.overscaledZ,O,g.z,I,g.y+1).key]={backfilled:!1},oe[new y.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},oe[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y+1).key]={backfilled:!1}),oe},p.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},p}(V),Le=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(I),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var O=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*O,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*O,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*O,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)f.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",S))}})},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setData=function(f){var g=this;return this._data=f,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var I={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(I.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",I))}}),this},p.prototype.getClusterExpansionZoom=function(f,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},g),this},p.prototype.getClusterChildren=function(f,g){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},g),this},p.prototype.getClusterLeaves=function(f,g,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:g,offset:S},I),this},p.prototype._updateWorkerData=function(f){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),I=this._data;typeof I=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(I),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(I),this.actor.send(this.type+".loadData",S,function(O,z){g._removed||z&&z.abandoned||(g._loaded=!0,z&&z.resourceTiming&&z.resourceTiming[g.id]&&(g._resourceTiming=z.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),f(O))})},p.prototype.loaded=function(){return this._loaded},p.prototype.loadTile=function(f,g){var S=this,I=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(I,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(O,z){return delete f.request,f.unloadVectorData(),f.aborted?g(null):O?g(O):(f.loadVectorData(z,S.map.painter,I==="reloadTile"),g(null))})},p.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},p.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},p.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},p.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},p.prototype.hasTransition=function(){return!1},p}(y.Evented),ht=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),wt=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(f,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(I,O){S._loaded=!0,I?S.fire(new y.ErrorEvent(I)):O&&(S.image=O,f&&(S.coordinates=f),g&&g(),S._finishLoading())})},p.prototype.loaded=function(){return this._loaded},p.prototype.updateImage=function(f){var g=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){g.texture=null}),this):this},p.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setCoordinates=function(f){var g=this;this.coordinates=f;var S=f.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(O){for(var z=1/0,q=1/0,oe=-1/0,Te=-1/0,Pe=0,_e=O;Pe<_e.length;Pe+=1){var Je=_e[Pe];z=Math.min(z,Je.x),q=Math.min(q,Je.y),oe=Math.max(oe,Je.x),Te=Math.max(Te,Je.y)}var $e=Math.max(oe-z,Te-q),mt=Math.max(0,Math.floor(-Math.log($e)/Math.LN2)),Ye=Math.pow(2,mt);return new y.CanonicalTileID(mt,Math.floor((z+oe)/2*Ye),Math.floor((q+Te)/2*Ye))}(S),this.minzoom=this.maxzoom=this.tileID.z;var I=S.map(function(O){return g.tileID.getTilePoint(O)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(I[2].x,I[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},p.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,g=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(f,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},p.prototype.loadTile=function(f,g){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},g(null)):(f.state="errored",g(null))},p.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return!1},p}(y.Evented),er=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),this.roundZoom=!0,this.type="video",this.options=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,I=g.urls;S<I.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(I[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(O,z){f._loaded=!0,O?f.fire(new y.ErrorEvent(O)):z&&(f.video=z,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},p.prototype.pause=function(){this.video&&this.video.pause()},p.prototype.play=function(){this.video&&this.video.play()},p.prototype.seek=function(f){if(this.video){var g=this.video.seekable;f<g.start(0)||f>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=f}},p.prototype.getVideo=function(){return this.video},p.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},p.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,g=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(f,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this.video&&!this.video.paused},p}(wt),Tt=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(O){return!Array.isArray(O)||O.length!==2||O.some(function(z){return typeof z!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},p.prototype.getCanvas=function(){return this.canvas},p.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},p.prototype.onRemove=function(){this.pause()},p.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,ht.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var O=this.tiles[I];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this._playing},p.prototype._hasInvalidDimensions=function(){for(var f=0,g=[this.canvas.width,this.canvas.height];f<g.length;f+=1){var S=g[f];if(isNaN(S)||S<=0)return!0}return!1},p}(wt),vr={vector:Se,raster:V,"raster-dem":Q,geojson:Le,video:er,image:wt,canvas:Tt};function ln(c,p){var f=y.identity([]);return y.translate(f,f,[1,1,0]),y.scale(f,f,[.5*c.width,.5*c.height,1]),y.multiply(f,f,c.calculatePosMatrix(p.toUnwrapped()))}function sn(c,p,f,g,S,I){var O=function(mt,Ye,gt){if(mt)for(var Pt=0,qt=mt;Pt<qt.length;Pt+=1){var _r=Ye[qt[Pt]];if(_r&&_r.source===gt&&_r.type==="fill-extrusion")return!0}else for(var ir in Ye){var Mr=Ye[ir];if(Mr.source===gt&&Mr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,p,c.id),z=I.maxPitchScaleFactor(),q=c.tilesIn(g,z,O);q.sort(Mi);for(var oe=[],Te=0,Pe=q;Te<Pe.length;Te+=1){var _e=Pe[Te];oe.push({wrappedTileID:_e.tileID.wrapped().key,queryResults:_e.tile.queryRenderedFeatures(p,f,c._state,_e.queryGeometry,_e.cameraQueryGeometry,_e.scale,S,I,z,ln(c.transform,_e.tileID))})}var Je=function(mt){for(var Ye={},gt={},Pt=0,qt=mt;Pt<qt.length;Pt+=1){var _r=qt[Pt],ir=_r.queryResults,Mr=_r.wrappedTileID,Wr=gt[Mr]=gt[Mr]||{};for(var Cn in ir)for(var yn=ir[Cn],Hn=Wr[Cn]=Wr[Cn]||{},xi=Ye[Cn]=Ye[Cn]||[],Si=0,bi=yn;Si<bi.length;Si+=1){var Ca=bi[Si];Hn[Ca.featureIndex]||(Hn[Ca.featureIndex]=!0,xi.push(Ca))}}return Ye}(oe);for(var $e in Je)Je[$e].forEach(function(mt){var Ye=mt.feature,gt=c.getFeatureState(Ye.layer["source-layer"],Ye.id);Ye.source=Ye.layer.source,Ye.layer["source-layer"]&&(Ye.sourceLayer=Ye.layer["source-layer"]),Ye.state=gt});return Je}function Mi(c,p){var f=c.tileID,g=p.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}var vi=function(c,p){this.max=c,this.onRemove=p,this.reset()};vi.prototype.reset=function(){for(var c in this.data)for(var p=0,f=this.data[c];p<f.length;p+=1){var g=f[p];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},vi.prototype.add=function(c,p,f){var g=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var I={value:p,timeout:void 0};if(f!==void 0&&(I.timeout=setTimeout(function(){g.remove(c,I)},f)),this.data[S].push(I),this.order.push(S),this.order.length>this.max){var O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this},vi.prototype.has=function(c){return c.wrapped().key in this.data},vi.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},vi.prototype._getAndRemoveByKey=function(c){var p=this.data[c].shift();return p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),p.value},vi.prototype.getByKey=function(c){var p=this.data[c];return p?p[0].value:null},vi.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},vi.prototype.remove=function(c,p){if(!this.has(c))return this;var f=c.wrapped().key,g=p===void 0?0:this.data[f].indexOf(p),S=this.data[f][g];return this.data[f].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},vi.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this},vi.prototype.filter=function(c){var p=[];for(var f in this.data)for(var g=0,S=this.data[f];g<S.length;g+=1){var I=S[g];c(I.value)||p.push(I)}for(var O=0,z=p;O<z.length;O+=1){var q=z[O];this.remove(q.value.tileID,q)}};var en=function(c,p,f){this.context=c;var g=c.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};en.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},en.prototype.updateData=function(c){var p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},en.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Oa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ra=function(c,p,f,g){this.length=p.length,this.attributes=f,this.itemSize=p.bytesPerElement,this.dynamicDraw=g,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};ra.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ra.prototype.updateData=function(c){var p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)},ra.prototype.enableAttributes=function(c,p){for(var f=0;f<this.attributes.length;f++){var g=p.attributes[this.attributes[f].name];g!==void 0&&c.enableVertexAttribArray(g)}},ra.prototype.setVertexAttribPointers=function(c,p,f){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],I=p.attributes[S.name];I!==void 0&&c.vertexAttribPointer(I,S.components,c[Oa[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},ra.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Vi=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Vi.prototype.get=function(){return this.current},Vi.prototype.set=function(c){},Vi.prototype.getDefault=function(){return this.default},Vi.prototype.setDefault=function(){this.set(this.default)};var ya=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return y.Color.transparent},p.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},p}(Vi),fi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 1},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},p}(Vi),$i=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},p}(Vi),hi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return[!0,!0,!0,!0]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},p}(Vi),yi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},p}(Vi),ss=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 255},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},p}(Vi),yo=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},p.prototype.set=function(f){var g=this.current;(f.func!==g.func||f.ref!==g.ref||f.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},p}(Vi),qa=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},p}(Vi),Ft=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=f,this.dirty=!1}},p}(Vi),be=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return[0,1]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},p}(Vi),he=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=f,this.dirty=!1}},p}(Vi),Ie=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.LESS},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},p}(Vi),G=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.BLEND):g.disable(g.BLEND),this.current=f,this.dirty=!1}},p}(Vi),lt=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},p}(Vi),sr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return y.Color.transparent},p.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},p}(Vi),Jr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.FUNC_ADD},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},p}(Vi),nt=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=f,this.dirty=!1}},p}(Vi),Gt=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.BACK},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},p}(Vi),Ar=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.CCW},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},p}(Vi),Tr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},p}(Vi),Rr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.TEXTURE0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},p}(Vi),mn=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},p}(Vi),mi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),ai=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),Tn=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,f),this.current=f,this.dirty=!1}},p}(Vi),Ri=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),zi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},p}(Vi),ka=function(c){function p(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},p}(Vi),ia=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 4},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},p}(Vi),io=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},p}(Vi),Ci=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},p}(Vi),pa=function(c){function p(f,g){c.call(this,f),this.context=f,this.parent=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p}(Vi),ee=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.setDirty=function(){this.dirty=!0},p.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},p}(pa),ce=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},p}(pa),xe=function(c,p,f,g){this.context=c,this.width=p,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new ee(c,S),g&&(this.depthAttachment=new ce(c,S))};xe.prototype.destroy=function(){var c=this.context.gl,p=this.colorAttachment.get();if(p&&c.deleteTexture(p),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var Oe=function(c,p,f){this.func=c,this.mask=p,this.range=f};Oe.ReadOnly=!1,Oe.ReadWrite=!0,Oe.disabled=new Oe(519,Oe.ReadOnly,[0,1]);var qe=function(c,p,f,g,S,I){this.test=c,this.ref=p,this.mask=f,this.fail=g,this.depthFail=S,this.pass=I};qe.disabled=new qe({func:519,mask:0},0,0,7680,7680,7680);var ct=function(c,p,f){this.blendFunction=c,this.blendColor=p,this.mask=f};ct.disabled=new ct(ct.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),ct.unblended=new ct(ct.Replace,y.Color.transparent,[!0,!0,!0,!0]),ct.alphaBlended=new ct([1,771],y.Color.transparent,[!0,!0,!0,!0]);var St=function(c,p,f){this.enable=c,this.mode=p,this.frontFace=f};St.disabled=new St(!1,1029,2305),St.backCCW=new St(!0,1029,2305);var ke=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ya(this),this.clearDepth=new fi(this),this.clearStencil=new $i(this),this.colorMask=new hi(this),this.depthMask=new yi(this),this.stencilMask=new ss(this),this.stencilFunc=new yo(this),this.stencilOp=new qa(this),this.stencilTest=new Ft(this),this.depthRange=new be(this),this.depthTest=new he(this),this.depthFunc=new Ie(this),this.blend=new G(this),this.blendFunc=new lt(this),this.blendColor=new sr(this),this.blendEquation=new Jr(this),this.cullFace=new nt(this),this.cullFaceSide=new Gt(this),this.frontFace=new Ar(this),this.program=new Tr(this),this.activeTexture=new Rr(this),this.viewport=new mn(this),this.bindFramebuffer=new mi(this),this.bindRenderbuffer=new ai(this),this.bindTexture=new Tn(this),this.bindVertexBuffer=new Ri(this),this.bindElementBuffer=new zi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ka(this),this.pixelStoreUnpack=new ia(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new Ci(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};ke.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ke.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ke.prototype.createIndexBuffer=function(c,p){return new en(this,c,p)},ke.prototype.createVertexBuffer=function(c,p,f){return new ra(this,c,p,f)},ke.prototype.createRenderbuffer=function(c,p,f){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,c,p,f),this.bindRenderbuffer.set(null),S},ke.prototype.createFramebuffer=function(c,p,f){return new xe(this,c,p,f)},ke.prototype.clear=function(c){var p=c.color,f=c.depth,g=this.gl,S=0;p&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g.clear(S)},ke.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},ke.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},ke.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},ke.prototype.setColorMode=function(c){y.deepEqual(c.blendFunction,ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},ke.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var it=function(c){function p(f,g,S){var I=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(O){O.dataType==="source"&&O.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=function(O,z,q,oe){var Te=new vr[z.type](O,z,q,oe);if(Te.id!==O)throw new Error("Expected Source id to be "+O+" instead of "+Te.id);return y.bindAll(["load","abort","unload","serialize","prepare"],Te),Te}(f,g,S,this),this._tiles={},this._cache=new vi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},p.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},p.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var g=this._tiles[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},p.prototype.getSource=function(){return this._source},p.prototype.pause=function(){this._paused=!0},p.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},p.prototype._loadTile=function(f,g){return this._source.loadTile(f,g)},p.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},p.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},p.prototype.serialize=function(){return this._source.serialize()},p.prototype.prepare=function(f){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(f),S.prepare(this.map.style.imageManager)}},p.prototype.getIds=function(){return y.values(this._tiles).map(function(f){return f.tileID}).sort(Yt).map(function(f){return f.key})},p.prototype.getRenderableIds=function(f){var g=this,S=[];for(var I in this._tiles)this._isIdRenderable(I,f)&&S.push(this._tiles[I]);return f?S.sort(function(O,z){var q=O.tileID,oe=z.tileID,Te=new y.Point(q.canonical.x,q.canonical.y)._rotate(g.transform.angle),Pe=new y.Point(oe.canonical.x,oe.canonical.y)._rotate(g.transform.angle);return q.overscaledZ-oe.overscaledZ||Pe.y-Te.y||Pe.x-Te.x}).map(function(O){return O.tileID.key}):S.map(function(O){return O.tileID}).sort(Yt).map(function(O){return O.key})},p.prototype.hasRenderableParent=function(f){var g=this.findLoadedParent(f,0);return!!g&&this._isIdRenderable(g.tileID.key)},p.prototype._isIdRenderable=function(f,g){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(g||!this._tiles[f].holdingForFade())},p.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},p.prototype._reloadTile=function(f,g){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,f,g)))},p.prototype._tileLoaded=function(f,g,S,I){if(I)return f.state="errored",void(I.status!==404?this._source.fire(new y.ErrorEvent(I,{tile:f})):this.update(this.transform));f.timeAdded=y.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(g,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},p.prototype._backfillDEM=function(f){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var I=g[S];if(f.neighboringTiles&&f.neighboringTiles[I]){var O=this.getTileByID(I);z(f,O),z(O,f)}}function z(q,oe){q.needsHillshadePrepare=!0;var Te=oe.tileID.canonical.x-q.tileID.canonical.x,Pe=oe.tileID.canonical.y-q.tileID.canonical.y,_e=Math.pow(2,q.tileID.canonical.z),Je=oe.tileID.key;Te===0&&Pe===0||Math.abs(Pe)>1||(Math.abs(Te)>1&&(Math.abs(Te+_e)===1?Te+=_e:Math.abs(Te-_e)===1&&(Te-=_e)),oe.dem&&q.dem&&(q.dem.backfillBorder(oe.dem,Te,Pe),q.neighboringTiles&&q.neighboringTiles[Je]&&(q.neighboringTiles[Je].backfilled=!0)))}},p.prototype.getTile=function(f){return this.getTileByID(f.key)},p.prototype.getTileByID=function(f){return this._tiles[f]},p.prototype._retainLoadedChildren=function(f,g,S,I){for(var O in this._tiles){var z=this._tiles[O];if(!(I[O]||!z.hasData()||z.tileID.overscaledZ<=g||z.tileID.overscaledZ>S)){for(var q=z.tileID;z&&z.tileID.overscaledZ>g+1;){var oe=z.tileID.scaledTo(z.tileID.overscaledZ-1);(z=this._tiles[oe.key])&&z.hasData()&&(q=oe)}for(var Te=q;Te.overscaledZ>g;)if(f[(Te=Te.scaledTo(Te.overscaledZ-1)).key]){I[q.key]=q;break}}}},p.prototype.findLoadedParent=function(f,g){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var I=f.overscaledZ-1;I>=g;I--){var O=f.scaledTo(I),z=this._getLoadedTile(O);if(z)return z}},p.prototype._getLoadedTile=function(f){var g=this._tiles[f.key];return g&&g.hasData()?g:this._cache.getByKey(f.wrapped().key)},p.prototype.updateCacheSize=function(f){var g=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,I=Math.floor(g*S*5),O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(O)},p.prototype.handleWrapJump=function(f){var g=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,g){var S={};for(var I in this._tiles){var O=this._tiles[I];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+g),S[O.tileID.key]=O}for(var z in this._tiles=S,this._timers)clearTimeout(this._timers[z]),delete this._timers[z];for(var q in this._tiles)this._setTileReloadTimer(q,this._tiles[q])}},p.prototype.update=function(f){var g=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Wr){return new y.OverscaledTileID(Wr.canonical.z,Wr.wrap,Wr.canonical.z,Wr.canonical.x,Wr.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Wr){return g._source.hasTile(Wr)}))):S=[];var I=f.coveringZoomLevel(this._source),O=Math.max(I-p.maxOverzooming,this._source.minzoom),z=Math.max(I+p.maxUnderzooming,this._source.minzoom),q=this._updateRetainedTiles(S,I);if(jr(this._source.type)){for(var oe={},Te={},Pe=0,_e=Object.keys(q);Pe<_e.length;Pe+=1){var Je=_e[Pe],$e=q[Je],mt=this._tiles[Je];if(mt&&!(mt.fadeEndTime&&mt.fadeEndTime<=y.browser.now())){var Ye=this.findLoadedParent($e,O);Ye&&(this._addTile(Ye.tileID),oe[Ye.tileID.key]=Ye.tileID),Te[Je]=$e}}for(var gt in this._retainLoadedChildren(Te,I,z,q),oe)q[gt]||(this._coveredTiles[gt]=!0,q[gt]=oe[gt])}for(var Pt in q)this._tiles[Pt].clearFadeHold();for(var qt=0,_r=y.keysDifference(this._tiles,q);qt<_r.length;qt+=1){var ir=_r[qt],Mr=this._tiles[ir];Mr.hasSymbolBuckets&&!Mr.holdingForFade()?Mr.setHoldDuration(this.map._fadeDuration):Mr.hasSymbolBuckets&&!Mr.symbolFadeFinished()||this._removeTile(ir)}this._updateLoadedParentTileCache()}},p.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},p.prototype._updateRetainedTiles=function(f,g){for(var S={},I={},O=Math.max(g-p.maxOverzooming,this._source.minzoom),z=Math.max(g+p.maxUnderzooming,this._source.minzoom),q={},oe=0,Te=f;oe<Te.length;oe+=1){var Pe=Te[oe],_e=this._addTile(Pe);S[Pe.key]=Pe,_e.hasData()||g<this._source.maxzoom&&(q[Pe.key]=Pe)}this._retainLoadedChildren(q,g,z,S);for(var Je=0,$e=f;Je<$e.length;Je+=1){var mt=$e[Je],Ye=this._tiles[mt.key];if(!Ye.hasData()){if(g+1>this._source.maxzoom){var gt=mt.children(this._source.maxzoom)[0],Pt=this.getTile(gt);if(Pt&&Pt.hasData()){S[gt.key]=gt;continue}}else{var qt=mt.children(this._source.maxzoom);if(S[qt[0].key]&&S[qt[1].key]&&S[qt[2].key]&&S[qt[3].key])continue}for(var _r=Ye.wasRequested(),ir=mt.overscaledZ-1;ir>=O;--ir){var Mr=mt.scaledTo(ir);if(I[Mr.key]||(I[Mr.key]=!0,!(Ye=this.getTile(Mr))&&_r&&(Ye=this._addTile(Mr)),Ye&&(S[Mr.key]=Mr,_r=Ye.wasRequested(),Ye.hasData())))break}}}return S},p.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,I=this._tiles[f].tileID;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}g.push(I.key);var O=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(O))break;I=O}for(var z=0,q=g;z<q.length;z+=1)this._loadedParentTiles[q[z]]=S}},p.prototype._addTile=function(f){var g=this._tiles[f.key];if(g)return g;(g=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,g),g.tileID=f,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,g)));var S=Boolean(g);return S||(g=new y.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,f.key,g.state))),g?(g.uses++,this._tiles[f.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},p.prototype._setTileReloadTimer=function(f,g){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var I=g.getExpiryTimeout();I&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},I))},p.prototype._removeTile=function(f){var g=this._tiles[f];g&&(g.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},p.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},p.prototype.tilesIn=function(f,g,S){var I=this,O=[],z=this.transform;if(!z)return O;for(var q=S?z.getCameraQueryGeometry(f):f,oe=f.map(function(ir){return z.pointCoordinate(ir)}),Te=q.map(function(ir){return z.pointCoordinate(ir)}),Pe=this.getIds(),_e=1/0,Je=1/0,$e=-1/0,mt=-1/0,Ye=0,gt=Te;Ye<gt.length;Ye+=1){var Pt=gt[Ye];_e=Math.min(_e,Pt.x),Je=Math.min(Je,Pt.y),$e=Math.max($e,Pt.x),mt=Math.max(mt,Pt.y)}for(var qt=function(ir){var Mr=I._tiles[Pe[ir]];if(!Mr.holdingForFade()){var Wr=Mr.tileID,Cn=Math.pow(2,z.zoom-Mr.tileID.overscaledZ),yn=g*Mr.queryPadding*y.EXTENT/Mr.tileSize/Cn,Hn=[Wr.getTilePoint(new y.MercatorCoordinate(_e,Je)),Wr.getTilePoint(new y.MercatorCoordinate($e,mt))];if(Hn[0].x-yn<y.EXTENT&&Hn[0].y-yn<y.EXTENT&&Hn[1].x+yn>=0&&Hn[1].y+yn>=0){var xi=oe.map(function(bi){return Wr.getTilePoint(bi)}),Si=Te.map(function(bi){return Wr.getTilePoint(bi)});O.push({tile:Mr,tileID:Wr,queryGeometry:xi,cameraQueryGeometry:Si,scale:Cn})}}},_r=0;_r<Pe.length;_r++)qt(_r);return O},p.prototype.getVisibleCoordinates=function(f){for(var g=this,S=this.getRenderableIds(f).map(function(q){return g._tiles[q].tileID}),I=0,O=S;I<O.length;I+=1){var z=O[I];z.posMatrix=this.transform.calculatePosMatrix(z.toUnwrapped())}return S},p.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(jr(this._source.type))for(var f in this._tiles){var g=this._tiles[f];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},p.prototype.setFeatureState=function(f,g,S){this._state.updateState(f=f||"_geojsonTileLayer",g,S)},p.prototype.removeFeatureState=function(f,g,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",g,S)},p.prototype.getFeatureState=function(f,g){return this._state.getState(f=f||"_geojsonTileLayer",g)},p.prototype.setDependencies=function(f,g,S){var I=this._tiles[f];I&&I.setDependencies(g,S)},p.prototype.reloadTilesForDependencies=function(f,g){for(var S in this._tiles)this._tiles[S].hasDependency(f,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(I){return!I.hasDependency(f,g)})},p}(y.Evented);function Yt(c,p){var f=Math.abs(2*c.wrap)-+(c.wrap<0),g=Math.abs(2*p.wrap)-+(p.wrap<0);return c.overscaledZ-p.overscaledZ||g-f||p.canonical.y-c.canonical.y||p.canonical.x-c.canonical.x}function jr(c){return c==="raster"||c==="image"||c==="video"}function or(){return new y.window.Worker(nf.workerUrl)}it.maxOverzooming=10,it.maxUnderzooming=3;var mr="mapboxgl_preloaded_worker_pool",Hr=function(){this.active={}};Hr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Hr.workerCount;)this.workers.push(new or);return this.active[c]=!0,this.workers.slice()},Hr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(p){p.terminate()}),this.workers=null)},Hr.prototype.isPreloaded=function(){return!!this.active[mr]},Hr.prototype.numActive=function(){return Object.keys(this.active).length};var si,Mn=Math.floor(y.browser.hardwareConcurrency/2);function ar(){return si||(si=new Hr),si}function Yn(c,p){var f={};for(var g in c)g!=="ref"&&(f[g]=c[g]);return y.refProperties.forEach(function(S){S in p&&(f[S]=p[S])}),f}function Pr(c){c=c.slice();for(var p=Object.create(null),f=0;f<c.length;f++)p[c[f].id]=c[f];for(var g=0;g<c.length;g++)"ref"in c[g]&&(c[g]=Yn(c[g],p[c[g].ref]));return c}Hr.workerCount=Math.max(Math.min(Mn,6),1);var gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ea(c,p,f){f.push({command:gn.addSource,args:[c,p[c]]})}function Vn(c,p,f){p.push({command:gn.removeSource,args:[c]}),f[c]=!0}function na(c,p,f,g){Vn(c,f,g),ea(c,p,f)}function Ht(c,p,f){var g;for(g in c[f])if(c[f].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(c[f][g],p[f][g]))return!1;for(g in p[f])if(p[f].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(c[f][g],p[f][g]))return!1;return!0}function Rt(c,p,f,g,S,I){var O;for(O in p=p||{},c=c||{})c.hasOwnProperty(O)&&(y.deepEqual(c[O],p[O])||f.push({command:I,args:[g,O,p[O],S]}));for(O in p)p.hasOwnProperty(O)&&!c.hasOwnProperty(O)&&(y.deepEqual(c[O],p[O])||f.push({command:I,args:[g,O,p[O],S]}))}function da(c){return c.id}function aa(c,p){return c[p.id]=p,c}var Di=function(c,p){this.reset(c,p)};Di.prototype.reset=function(c,p){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Di.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=y.clamp(c,0,1);for(var p=1,f=this._distances[p],g=c*this.paddedLength+this.padding;f<g&&p<this._distances.length;)f=this._distances[++p];var S=p-1,I=this._distances[S],O=f-I,z=O>0?(g-I)/O:0;return this.points[S].mult(1-z).add(this.points[p].mult(z))};var Ii=function(c,p,f){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(p/f);for(var I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0};function _o(c,p,f,g,S){var I=y.create();return p?(y.scale(I,I,[1/S,1/S,1]),f||y.rotateZ(I,I,g.angle)):y.multiply(I,g.labelPlaneMatrix,c),I}function Na(c,p,f,g,S){if(p){var I=y.clone(c);return y.scale(I,I,[S,S,1]),f||y.rotateZ(I,I,-g.angle),I}return g.glCoordMatrix}function Or(c,p){var f=[c.x,c.y,0,1];Lo(f,f,p);var g=f[3];return{point:new y.Point(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function Dr(c,p){return .5+c/p*.5}function Mt(c,p){var f=c[0]/c[3],g=c[1]/c[3];return f>=-p[0]&&f<=p[0]&&g>=-p[1]&&g<=p[1]}function us(c,p,f,g,S,I,O,z){var q=g?c.textSizeData:c.iconSizeData,oe=y.evaluateSizeForZoom(q,f.transform.zoom),Te=[256/f.width*2+1,256/f.height*2+1],Pe=g?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Pe.clear();for(var _e=c.lineVertexArray,Je=g?c.text.placedSymbolArray:c.icon.placedSymbolArray,$e=f.transform.width/f.transform.height,mt=!1,Ye=0;Ye<Je.length;Ye++){var gt=Je.get(Ye);if(gt.hidden||gt.writingMode===y.WritingMode.vertical&&!mt)Ra(gt.numGlyphs,Pe);else{mt=!1;var Pt=[gt.anchorX,gt.anchorY,0,1];if(y.transformMat4(Pt,Pt,p),Mt(Pt,Te)){var qt=Dr(f.transform.cameraToCenterDistance,Pt[3]),_r=y.evaluateSizeForFeature(q,oe,gt),ir=O?_r/qt:_r*qt,Mr=new y.Point(gt.anchorX,gt.anchorY),Wr=Or(Mr,S).point,Cn={},yn=yu(gt,ir,!1,z,p,S,I,c.glyphOffsetArray,_e,Pe,Wr,Mr,Cn,$e);mt=yn.useVertical,(yn.notEnoughRoom||mt||yn.needsFlipping&&yu(gt,ir,!0,z,p,S,I,c.glyphOffsetArray,_e,Pe,Wr,Mr,Cn,$e).notEnoughRoom)&&Ra(gt.numGlyphs,Pe)}else Ra(gt.numGlyphs,Pe)}}g?c.text.dynamicLayoutVertexBuffer.updateData(Pe):c.icon.dynamicLayoutVertexBuffer.updateData(Pe)}function At(c,p,f,g,S,I,O,z,q,oe,Te){var Pe=z.glyphStartIndex+z.numGlyphs,_e=z.lineStartIndex,Je=z.lineStartIndex+z.lineLength,$e=p.getoffsetX(z.glyphStartIndex),mt=p.getoffsetX(Pe-1),Ye=Bi(c*$e,f,g,S,I,O,z.segment,_e,Je,q,oe,Te);if(!Ye)return null;var gt=Bi(c*mt,f,g,S,I,O,z.segment,_e,Je,q,oe,Te);return gt?{first:Ye,last:gt}:null}function ao(c,p,f,g){return c===y.WritingMode.horizontal&&Math.abs(f.y-p.y)>Math.abs(f.x-p.x)*g?{useVertical:!0}:(c===y.WritingMode.vertical?p.y<f.y:p.x>f.x)?{needsFlipping:!0}:null}function yu(c,p,f,g,S,I,O,z,q,oe,Te,Pe,_e,Je){var $e,mt=p/24,Ye=c.lineOffsetX*mt,gt=c.lineOffsetY*mt;if(c.numGlyphs>1){var Pt=c.glyphStartIndex+c.numGlyphs,qt=c.lineStartIndex,_r=c.lineStartIndex+c.lineLength,ir=At(mt,z,Ye,gt,f,Te,Pe,c,q,I,_e);if(!ir)return{notEnoughRoom:!0};var Mr=Or(ir.first.point,O).point,Wr=Or(ir.last.point,O).point;if(g&&!f){var Cn=ao(c.writingMode,Mr,Wr,Je);if(Cn)return Cn}$e=[ir.first];for(var yn=c.glyphStartIndex+1;yn<Pt-1;yn++)$e.push(Bi(mt*z.getoffsetX(yn),Ye,gt,f,Te,Pe,c.segment,qt,_r,q,I,_e));$e.push(ir.last)}else{if(g&&!f){var Hn=Or(Pe,S).point,xi=c.lineStartIndex+c.segment+1,Si=new y.Point(q.getx(xi),q.gety(xi)),bi=Or(Si,S),Ca=bi.signedDistanceFromCamera>0?bi.point:Jo(Pe,Si,Hn,1,S),qn=ao(c.writingMode,Hn,Ca,Je);if(qn)return qn}var Hi=Bi(mt*z.getoffsetX(c.glyphStartIndex),Ye,gt,f,Te,Pe,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,q,I,_e);if(!Hi)return{notEnoughRoom:!0};$e=[Hi]}for(var Qi=0,Wi=$e;Qi<Wi.length;Qi+=1){var Oi=Wi[Qi];y.addDynamicAttributes(oe,Oi.point,Oi.angle)}return{}}function Jo(c,p,f,g,S){var I=Or(c.add(c.sub(p)._unit()),S).point,O=f.sub(I);return f.add(O._mult(g/O.mag()))}function Bi(c,p,f,g,S,I,O,z,q,oe,Te,Pe){var _e=g?c-p:c+p,Je=_e>0?1:-1,$e=0;g&&(Je*=-1,$e=Math.PI),Je<0&&($e+=Math.PI);for(var mt=Je>0?z+O:z+O+1,Ye=S,gt=S,Pt=0,qt=0,_r=Math.abs(_e),ir=[];Pt+qt<=_r;){if((mt+=Je)<z||mt>=q)return null;if(gt=Ye,ir.push(Ye),(Ye=Pe[mt])===void 0){var Mr=new y.Point(oe.getx(mt),oe.gety(mt)),Wr=Or(Mr,Te);if(Wr.signedDistanceFromCamera>0)Ye=Pe[mt]=Wr.point;else{var Cn=mt-Je;Ye=Jo(Pt===0?I:new y.Point(oe.getx(Cn),oe.gety(Cn)),Mr,gt,_r-Pt+1,Te)}}Pt+=qt,qt=gt.dist(Ye)}var yn=(_r-Pt)/qt,Hn=Ye.sub(gt),xi=Hn.mult(yn)._add(gt);xi._add(Hn._unit()._perp()._mult(f*Je));var Si=$e+Math.atan2(Ye.y-gt.y,Ye.x-gt.x);return ir.push(xi),{point:xi,angle:Si,path:ir}}Ii.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ii.prototype.insert=function(c,p,f,g,S){this._forEachCell(p,f,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(S)},Ii.prototype.insertCircle=function(c,p,f,g){this._forEachCell(p-g,f-g,p+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(f),this.circles.push(g)},Ii.prototype._insertBoxCell=function(c,p,f,g,S,I){this.boxCells[S].push(I)},Ii.prototype._insertCircleCell=function(c,p,f,g,S,I){this.circleCells[S].push(I)},Ii.prototype._query=function(c,p,f,g,S,I){if(f<0||c>this.width||g<0||p>this.height)return!S&&[];var O=[];if(c<=0&&p<=0&&this.width<=f&&this.height<=g){if(S)return!0;for(var z=0;z<this.boxKeys.length;z++)O.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(var q=0;q<this.circleKeys.length;q++){var oe=this.circles[3*q],Te=this.circles[3*q+1],Pe=this.circles[3*q+2];O.push({key:this.circleKeys[q],x1:oe-Pe,y1:Te-Pe,x2:oe+Pe,y2:Te+Pe})}return I?O.filter(I):O}return this._forEachCell(c,p,f,g,this._queryCell,O,{hitTest:S,seenUids:{box:{},circle:{}}},I),S?O.length>0:O},Ii.prototype._queryCircle=function(c,p,f,g,S){var I=c-f,O=c+f,z=p-f,q=p+f;if(O<0||I>this.width||q<0||z>this.height)return!g&&[];var oe=[];return this._forEachCell(I,z,O,q,this._queryCellCircle,oe,{hitTest:g,circle:{x:c,y:p,radius:f},seenUids:{box:{},circle:{}}},S),g?oe.length>0:oe},Ii.prototype.query=function(c,p,f,g,S){return this._query(c,p,f,g,!1,S)},Ii.prototype.hitTest=function(c,p,f,g,S){return this._query(c,p,f,g,!0,S)},Ii.prototype.hitTestCircle=function(c,p,f,g){return this._queryCircle(c,p,f,!0,g)},Ii.prototype._queryCell=function(c,p,f,g,S,I,O,z){var q=O.seenUids,oe=this.boxCells[S];if(oe!==null)for(var Te=this.bboxes,Pe=0,_e=oe;Pe<_e.length;Pe+=1){var Je=_e[Pe];if(!q.box[Je]){q.box[Je]=!0;var $e=4*Je;if(c<=Te[$e+2]&&p<=Te[$e+3]&&f>=Te[$e+0]&&g>=Te[$e+1]&&(!z||z(this.boxKeys[Je]))){if(O.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Je],x1:Te[$e],y1:Te[$e+1],x2:Te[$e+2],y2:Te[$e+3]})}}}var mt=this.circleCells[S];if(mt!==null)for(var Ye=this.circles,gt=0,Pt=mt;gt<Pt.length;gt+=1){var qt=Pt[gt];if(!q.circle[qt]){q.circle[qt]=!0;var _r=3*qt;if(this._circleAndRectCollide(Ye[_r],Ye[_r+1],Ye[_r+2],c,p,f,g)&&(!z||z(this.circleKeys[qt]))){if(O.hitTest)return I.push(!0),!0;var ir=Ye[_r],Mr=Ye[_r+1],Wr=Ye[_r+2];I.push({key:this.circleKeys[qt],x1:ir-Wr,y1:Mr-Wr,x2:ir+Wr,y2:Mr+Wr})}}}},Ii.prototype._queryCellCircle=function(c,p,f,g,S,I,O,z){var q=O.circle,oe=O.seenUids,Te=this.boxCells[S];if(Te!==null)for(var Pe=this.bboxes,_e=0,Je=Te;_e<Je.length;_e+=1){var $e=Je[_e];if(!oe.box[$e]){oe.box[$e]=!0;var mt=4*$e;if(this._circleAndRectCollide(q.x,q.y,q.radius,Pe[mt+0],Pe[mt+1],Pe[mt+2],Pe[mt+3])&&(!z||z(this.boxKeys[$e])))return I.push(!0),!0}}var Ye=this.circleCells[S];if(Ye!==null)for(var gt=this.circles,Pt=0,qt=Ye;Pt<qt.length;Pt+=1){var _r=qt[Pt];if(!oe.circle[_r]){oe.circle[_r]=!0;var ir=3*_r;if(this._circlesCollide(gt[ir],gt[ir+1],gt[ir+2],q.x,q.y,q.radius)&&(!z||z(this.circleKeys[_r])))return I.push(!0),!0}}},Ii.prototype._forEachCell=function(c,p,f,g,S,I,O,z){for(var q=this._convertToXCellCoord(c),oe=this._convertToYCellCoord(p),Te=this._convertToXCellCoord(f),Pe=this._convertToYCellCoord(g),_e=q;_e<=Te;_e++)for(var Je=oe;Je<=Pe;Je++)if(S.call(this,c,p,f,g,this.xCellCount*Je+_e,I,O,z))return},Ii.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Ii.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Ii.prototype._circlesCollide=function(c,p,f,g,S,I){var O=g-c,z=S-p,q=f+I;return q*q>O*O+z*z},Ii.prototype._circleAndRectCollide=function(c,p,f,g,S,I,O){var z=(I-g)/2,q=Math.abs(c-(g+z));if(q>z+f)return!1;var oe=(O-S)/2,Te=Math.abs(p-(S+oe));if(Te>oe+f)return!1;if(q<=z||Te<=oe)return!0;var Pe=q-z,_e=Te-oe;return Pe*Pe+_e*_e<=f*f};var gl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ra(c,p){for(var f=0;f<c;f++){var g=p.length;p.resize(g+4),p.float32.set(gl,3*g)}}function Lo(c,p,f){var g=p[0],S=p[1];return c[0]=f[0]*g+f[4]*S+f[12],c[1]=f[1]*g+f[5]*S+f[13],c[3]=f[3]*g+f[7]*S+f[15],c}var Do=function(c,p,f){p===void 0&&(p=new Ii(c.width+200,c.height+200,25)),f===void 0&&(f=new Ii(c.width+200,c.height+200,25)),this.transform=c,this.grid=p,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function Ea(c,p,f){return p*(y.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Do.prototype.placeCollisionBox=function(c,p,f,g,S){var I=this.projectAndGetPerspectiveRatio(g,c.anchorPointX,c.anchorPointY),O=f*I.perspectiveRatio,z=c.x1*O+I.point.x,q=c.y1*O+I.point.y,oe=c.x2*O+I.point.x,Te=c.y2*O+I.point.y;return!this.isInsideGrid(z,q,oe,Te)||!p&&this.grid.hitTest(z,q,oe,Te,S)?{box:[],offscreen:!1}:{box:[z,q,oe,Te],offscreen:this.isOffscreen(z,q,oe,Te)}},Do.prototype.placeCollisionCircles=function(c,p,f,g,S,I,O,z,q,oe,Te,Pe,_e){var Je=[],$e=new y.Point(p.anchorX,p.anchorY),mt=Or($e,I),Ye=Dr(this.transform.cameraToCenterDistance,mt.signedDistanceFromCamera),gt=(oe?S/Ye:S*Ye)/y.ONE_EM,Pt=Or($e,O).point,qt=At(gt,g,p.lineOffsetX*gt,p.lineOffsetY*gt,!1,Pt,$e,p,f,O,{}),_r=!1,ir=!1,Mr=!0;if(qt){for(var Wr=.5*Pe*Ye+_e,Cn=new y.Point(-100,-100),yn=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Hn=new Di,xi=qt.first,Si=qt.last,bi=[],Ca=xi.path.length-1;Ca>=1;Ca--)bi.push(xi.path[Ca]);for(var qn=1;qn<Si.path.length;qn++)bi.push(Si.path[qn]);var Hi=2.5*Wr;if(z){var Qi=bi.map(function(Cu){return Or(Cu,z)});bi=Qi.some(function(Cu){return Cu.signedDistanceFromCamera<=0})?[]:Qi.map(function(Cu){return Cu.point})}var Wi=[];if(bi.length>0){for(var Oi=bi[0].clone(),oa=bi[0].clone(),Zi=1;Zi<bi.length;Zi++)Oi.x=Math.min(Oi.x,bi[Zi].x),Oi.y=Math.min(Oi.y,bi[Zi].y),oa.x=Math.max(oa.x,bi[Zi].x),oa.y=Math.max(oa.y,bi[Zi].y);Wi=Oi.x>=Cn.x&&oa.x<=yn.x&&Oi.y>=Cn.y&&oa.y<=yn.y?[bi]:oa.x<Cn.x||Oi.x>yn.x||oa.y<Cn.y||Oi.y>yn.y?[]:y.clipLine([bi],Cn.x,Cn.y,yn.x,yn.y)}for(var wi=0,ls=Wi;wi<ls.length;wi+=1){var Xo;Hn.reset(ls[wi],.25*Wr),Xo=Hn.length<=.5*Wr?1:Math.ceil(Hn.paddedLength/Hi)+1;for(var Ds=0;Ds<Xo;Ds++){var cs=Ds/Math.max(Xo-1,1),co=Hn.lerp(cs),es=co.x+100,ts=co.y+100;Je.push(es,ts,Wr,0);var Fs=es-Wr,lc=ts-Wr,eu=es+Wr,Xu=ts+Wr;if(Mr=Mr&&this.isOffscreen(Fs,lc,eu,Xu),ir=ir||this.isInsideGrid(Fs,lc,eu,Xu),!c&&this.grid.hitTestCircle(es,ts,Wr,Te)&&(_r=!0,!q))return{circles:[],offscreen:!1,collisionDetected:_r}}}}return{circles:!q&&_r||!ir?[]:Je,offscreen:Mr,collisionDetected:_r}},Do.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var p=[],f=1/0,g=1/0,S=-1/0,I=-1/0,O=0,z=c;O<z.length;O+=1){var q=z[O],oe=new y.Point(q.x+100,q.y+100);f=Math.min(f,oe.x),g=Math.min(g,oe.y),S=Math.max(S,oe.x),I=Math.max(I,oe.y),p.push(oe)}for(var Te={},Pe={},_e=0,Je=this.grid.query(f,g,S,I).concat(this.ignoredGrid.query(f,g,S,I));_e<Je.length;_e+=1){var $e=Je[_e],mt=$e.key;if(Te[mt.bucketInstanceId]===void 0&&(Te[mt.bucketInstanceId]={}),!Te[mt.bucketInstanceId][mt.featureIndex]){var Ye=[new y.Point($e.x1,$e.y1),new y.Point($e.x2,$e.y1),new y.Point($e.x2,$e.y2),new y.Point($e.x1,$e.y2)];y.polygonIntersectsPolygon(p,Ye)&&(Te[mt.bucketInstanceId][mt.featureIndex]=!0,Pe[mt.bucketInstanceId]===void 0&&(Pe[mt.bucketInstanceId]=[]),Pe[mt.bucketInstanceId].push(mt.featureIndex))}}return Pe},Do.prototype.insertCollisionBox=function(c,p,f,g,S){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:S},c[0],c[1],c[2],c[3])},Do.prototype.insertCollisionCircles=function(c,p,f,g,S){for(var I=p?this.ignoredGrid:this.grid,O={bucketInstanceId:f,featureIndex:g,collisionGroupID:S},z=0;z<c.length;z+=4)I.insertCircle(O,c[z],c[z+1],c[z+2])},Do.prototype.projectAndGetPerspectiveRatio=function(c,p,f){var g=[p,f,0,1];return Lo(g,g,c),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Do.prototype.isOffscreen=function(c,p,f,g){return f<100||c>=this.screenRightBoundary||g<100||p>this.screenBottomBoundary},Do.prototype.isInsideGrid=function(c,p,f,g){return f>=0&&c<this.gridRightBoundary&&g>=0&&p<this.gridBottomBoundary},Do.prototype.getViewportMatrix=function(){var c=y.identity([]);return y.translate(c,c,[-100,-100,0]),c};var Ps=function(c,p,f,g){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):g&&f?1:0,this.placed=f};Ps.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ks=function(c,p,f,g,S){this.text=new Ps(c?c.text:null,p,f,S),this.icon=new Ps(c?c.icon:null,p,g,S)};ks.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Jl=function(c,p,f){this.text=c,this.icon=p,this.skipFade=f},fo=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},ds=function(c,p,f,g,S){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=S},ja=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Fo(c,p,f,g,S){var I=y.getAnchorAlignment(c),O=-(I.horizontalAlign-.5)*p,z=-(I.verticalAlign-.5)*f,q=y.evaluateVariableOffset(c,g);return new y.Point(O+q[0]*S,z+q[1]*S)}function vs(c,p,f,g,S,I){var O=c.x1,z=c.x2,q=c.y1,oe=c.y2,Te=c.anchorPointX,Pe=c.anchorPointY,_e=new y.Point(p,f);return g&&_e._rotate(S?I:-I),{x1:O+_e.x,y1:q+_e.y,x2:z+_e.x,y2:oe+_e.y,anchorPointX:Te,anchorPointY:Pe}}ja.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:function(f){return f.collisionGroupID===p}}}return this.collisionGroups[c]};var Bo=function(c,p,f,g){this.transform=c.clone(),this.collisionIndex=new Do(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ja(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Ju(c,p,f,g,S){c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0)}Bo.prototype.getBucketParts=function(c,p,f,g){var S=f.getBucket(p),I=f.latestFeatureIndex;if(S&&I&&p.id===S.layerIds[0]){var O=f.collisionBoxArray,z=S.layers[0].layout,q=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),oe=f.tileSize/y.EXTENT,Te=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Pe=z.get("text-pitch-alignment")==="map",_e=z.get("text-rotation-alignment")==="map",Je=Ea(f,1,this.transform.zoom),$e=_o(Te,Pe,_e,this.transform,Je),mt=null;if(Pe){var Ye=Na(Te,Pe,_e,this.transform,Je);mt=y.multiply([],this.transform.labelPlaneMatrix,Ye)}this.retainedQueryData[S.bucketInstanceId]=new ds(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,f.tileID);var gt={bucket:S,layout:z,posMatrix:Te,textLabelPlaneMatrix:$e,labelToScreenMatrix:mt,scale:q,textPixelRatio:oe,holdingForFade:f.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var Pt=0,qt=S.sortKeyRanges;Pt<qt.length;Pt+=1){var _r=qt[Pt];c.push({sortKey:_r.sortKey,symbolInstanceStart:_r.symbolInstanceStart,symbolInstanceEnd:_r.symbolInstanceEnd,parameters:gt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:gt})}},Bo.prototype.attemptAnchorPlacement=function(c,p,f,g,S,I,O,z,q,oe,Te,Pe,_e,Je,$e){var mt,Ye=[Pe.textOffset0,Pe.textOffset1],gt=Fo(c,f,g,Ye,S),Pt=this.collisionIndex.placeCollisionBox(vs(p,gt.x,gt.y,I,O,this.transform.angle),Te,z,q,oe.predicate);if(!$e||this.collisionIndex.placeCollisionBox(vs($e,gt.x,gt.y,I,O,this.transform.angle),Te,z,q,oe.predicate).box.length!==0)return Pt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Pe.crossTileID]&&this.prevPlacement.placements[Pe.crossTileID]&&this.prevPlacement.placements[Pe.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[Pe.crossTileID].anchor),this.variableOffsets[Pe.crossTileID]={textOffset:Ye,width:f,height:g,anchor:c,textBoxScale:S,prevAnchor:mt},this.markUsedJustification(_e,c,Pe,Je),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,Je,Pe),this.placedOrientations[Pe.crossTileID]=Je),{shift:gt,placedGlyphBoxes:Pt}):void 0},Bo.prototype.placeLayerBucketPart=function(c,p,f){var g=this,S=c.parameters,I=S.bucket,O=S.layout,z=S.posMatrix,q=S.textLabelPlaneMatrix,oe=S.labelToScreenMatrix,Te=S.textPixelRatio,Pe=S.holdingForFade,_e=S.collisionBoxArray,Je=S.partiallyEvaluatedTextSize,$e=S.collisionGroup,mt=O.get("text-optional"),Ye=O.get("icon-optional"),gt=O.get("text-allow-overlap"),Pt=O.get("icon-allow-overlap"),qt=O.get("text-rotation-alignment")==="map",_r=O.get("text-pitch-alignment")==="map",ir=O.get("icon-text-fit")!=="none",Mr=O.get("symbol-z-order")==="viewport-y",Wr=gt&&(Pt||!I.hasIconData()||Ye),Cn=Pt&&(gt||!I.hasTextData()||mt);!I.collisionArrays&&_e&&I.deserializeCollisionBoxes(_e);var yn=function(qn,Hi){if(!p[qn.crossTileID])if(Pe)g.placements[qn.crossTileID]=new Jl(!1,!1,!1);else{var Qi,Wi=!1,Oi=!1,oa=!0,Zi=null,wi={box:null,offscreen:null},ls={box:null,offscreen:null},Xo=null,Ds=null,cs=0,co=0,es=0;Hi.textFeatureIndex?cs=Hi.textFeatureIndex:qn.useRuntimeCollisionCircles&&(cs=qn.featureIndex),Hi.verticalTextFeatureIndex&&(co=Hi.verticalTextFeatureIndex);var ts=Hi.textBox;if(ts){var Fs=function(za){var Du=y.WritingMode.horizontal;if(I.allowVerticalPlacement&&!za&&g.prevPlacement){var Xs=g.prevPlacement.placedOrientations[qn.crossTileID];Xs&&(g.placedOrientations[qn.crossTileID]=Xs,g.markUsedOrientation(I,Du=Xs,qn))}return Du},lc=function(za,Du){if(I.allowVerticalPlacement&&qn.numVerticalGlyphVertices>0&&Hi.verticalTextBox)for(var Xs=0,hc=I.writingModes;Xs<hc.length&&(hc[Xs]===y.WritingMode.vertical?(wi=Du(),ls=wi):wi=za(),!(wi&&wi.box&&wi.box.length));Xs+=1);else wi=za()};if(O.get("text-variable-anchor")){var eu=O.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[qn.crossTileID]){var Xu=g.prevPlacement.variableOffsets[qn.crossTileID];eu.indexOf(Xu.anchor)>0&&(eu=eu.filter(function(za){return za!==Xu.anchor})).unshift(Xu.anchor)}var Cu=function(za,Du,Xs){for(var hc=za.x2-za.x1,ah=za.y2-za.y1,Df=qn.textBoxScale,Ep=ir&&!Pt?Du:null,Yu={box:[],offscreen:!1},Fc=gt?2*eu.length:eu.length,Su=0;Su<Fc;++Su){var Ff=g.attemptAnchorPlacement(eu[Su%eu.length],za,hc,ah,Df,qt,_r,Te,z,$e,Su>=eu.length,qn,I,Xs,Ep);if(Ff&&(Yu=Ff.placedGlyphBoxes)&&Yu.box&&Yu.box.length){Wi=!0,Zi=Ff.shift;break}}return Yu};lc(function(){return Cu(ts,Hi.iconBox,y.WritingMode.horizontal)},function(){var za=Hi.verticalTextBox;return I.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&qn.numVerticalGlyphVertices>0&&za?Cu(za,Hi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),wi&&(Wi=wi.box,oa=wi.offscreen);var Of=Fs(wi&&wi.box);if(!Wi&&g.prevPlacement){var cc=g.prevPlacement.variableOffsets[qn.crossTileID];cc&&(g.variableOffsets[qn.crossTileID]=cc,g.markUsedJustification(I,cc.anchor,qn,Of))}}else{var Wl=function(za,Du){var Xs=g.collisionIndex.placeCollisionBox(za,gt,Te,z,$e.predicate);return Xs&&Xs.box&&Xs.box.length&&(g.markUsedOrientation(I,Du,qn),g.placedOrientations[qn.crossTileID]=Du),Xs};lc(function(){return Wl(ts,y.WritingMode.horizontal)},function(){var za=Hi.verticalTextBox;return I.allowVerticalPlacement&&qn.numVerticalGlyphVertices>0&&za?Wl(za,y.WritingMode.vertical):{box:null,offscreen:null}}),Fs(wi&&wi.box&&wi.box.length)}}if(Wi=(Qi=wi)&&Qi.box&&Qi.box.length>0,oa=Qi&&Qi.offscreen,qn.useRuntimeCollisionCircles){var Tl=I.text.placedSymbolArray.get(qn.centerJustifiedTextSymbolIndex),Rf=y.evaluateSizeForFeature(I.textSizeData,Je,Tl),fl=O.get("text-padding");Xo=g.collisionIndex.placeCollisionCircles(gt,Tl,I.lineVertexArray,I.glyphOffsetArray,Rf,z,q,oe,f,_r,$e.predicate,qn.collisionCircleDiameter,fl),Wi=gt||Xo.circles.length>0&&!Xo.collisionDetected,oa=oa&&Xo.offscreen}if(Hi.iconFeatureIndex&&(es=Hi.iconFeatureIndex),Hi.iconBox){var fc=function(za){var Du=ir&&Zi?vs(za,Zi.x,Zi.y,qt,_r,g.transform.angle):za;return g.collisionIndex.placeCollisionBox(Du,Pt,Te,z,$e.predicate)};Oi=ls&&ls.box&&ls.box.length&&Hi.verticalIconBox?(Ds=fc(Hi.verticalIconBox)).box.length>0:(Ds=fc(Hi.iconBox)).box.length>0,oa=oa&&Ds.offscreen}var Xl=mt||qn.numHorizontalGlyphVertices===0&&qn.numVerticalGlyphVertices===0,fs=Ye||qn.numIconVertices===0;if(Xl||fs?fs?Xl||(Oi=Oi&&Wi):Wi=Oi&&Wi:Oi=Wi=Oi&&Wi,Wi&&Qi&&Qi.box&&g.collisionIndex.insertCollisionBox(Qi.box,O.get("text-ignore-placement"),I.bucketInstanceId,ls&&ls.box&&co?co:cs,$e.ID),Oi&&Ds&&g.collisionIndex.insertCollisionBox(Ds.box,O.get("icon-ignore-placement"),I.bucketInstanceId,es,$e.ID),Xo&&(Wi&&g.collisionIndex.insertCollisionCircles(Xo.circles,O.get("text-ignore-placement"),I.bucketInstanceId,cs,$e.ID),f)){var Ml=I.bucketInstanceId,Dc=g.collisionCircleArrays[Ml];Dc===void 0&&(Dc=g.collisionCircleArrays[Ml]=new fo);for(var Bs=0;Bs<Xo.circles.length;Bs+=4)Dc.circles.push(Xo.circles[Bs+0]),Dc.circles.push(Xo.circles[Bs+1]),Dc.circles.push(Xo.circles[Bs+2]),Dc.circles.push(Xo.collisionDetected?1:0)}g.placements[qn.crossTileID]=new Jl(Wi||Wr,Oi||Cn,oa||I.justReloaded),p[qn.crossTileID]=!0}};if(Mr)for(var Hn=I.getSortedSymbolIndexes(this.transform.angle),xi=Hn.length-1;xi>=0;--xi){var Si=Hn[xi];yn(I.symbolInstances.get(Si),I.collisionArrays[Si])}else for(var bi=c.symbolInstanceStart;bi<c.symbolInstanceEnd;bi++)yn(I.symbolInstances.get(bi),I.collisionArrays[bi]);if(f&&I.bucketInstanceId in this.collisionCircleArrays){var Ca=this.collisionCircleArrays[I.bucketInstanceId];y.invert(Ca.invProjMatrix,z),Ca.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1},Bo.prototype.markUsedJustification=function(c,p,f,g){var S;S=g===y.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(p)];for(var I=0,O=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];I<O.length;I+=1){var z=O[I];z>=0&&(c.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:f.crossTileID)}},Bo.prototype.markUsedOrientation=function(c,p,f){for(var g=p===y.WritingMode.horizontal||p===y.WritingMode.horizontalOnly?p:0,S=p===y.WritingMode.vertical?p:0,I=0,O=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];I<O.length;I+=1)c.text.placedSymbolArray.get(O[I]).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},Bo.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var p=this.prevPlacement,f=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;var g=p?p.symbolFadeChange(c):1,S=p?p.opacities:{},I=p?p.variableOffsets:{},O=p?p.placedOrientations:{};for(var z in this.placements){var q=this.placements[z],oe=S[z];oe?(this.opacities[z]=new ks(oe,g,q.text,q.icon),f=f||q.text!==oe.text.placed||q.icon!==oe.icon.placed):(this.opacities[z]=new ks(null,g,q.text,q.icon,q.skipFade),f=f||q.text||q.icon)}for(var Te in S){var Pe=S[Te];if(!this.opacities[Te]){var _e=new ks(Pe,g,!1,!1);_e.isHidden()||(this.opacities[Te]=_e,f=f||Pe.text.placed||Pe.icon.placed)}}for(var Je in I)this.variableOffsets[Je]||!this.opacities[Je]||this.opacities[Je].isHidden()||(this.variableOffsets[Je]=I[Je]);for(var $e in O)this.placedOrientations[$e]||!this.opacities[$e]||this.opacities[$e].isHidden()||(this.placedOrientations[$e]=O[$e]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)},Bo.prototype.updateLayerOpacities=function(c,p){for(var f={},g=0,S=p;g<S.length;g+=1){var I=S[g],O=I.getBucket(c);O&&I.latestFeatureIndex&&c.id===O.layerIds[0]&&this.updateBucketOpacities(O,f,I.collisionBoxArray)}},Bo.prototype.updateBucketOpacities=function(c,p,f){var g=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,I=new ks(null,0,!1,!1,!0),O=S.get("text-allow-overlap"),z=S.get("icon-allow-overlap"),q=S.get("text-variable-anchor"),oe=S.get("text-rotation-alignment")==="map",Te=S.get("text-pitch-alignment")==="map",Pe=S.get("icon-text-fit")!=="none",_e=new ks(null,0,O&&(z||!c.hasIconData()||S.get("icon-optional")),z&&(O||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var Je=function(gt,Pt,qt){for(var _r=0;_r<Pt/4;_r++)gt.opacityVertexArray.emplaceBack(qt)},$e=function(gt){var Pt=c.symbolInstances.get(gt),qt=Pt.numHorizontalGlyphVertices,_r=Pt.numVerticalGlyphVertices,ir=Pt.crossTileID,Mr=g.opacities[ir];p[ir]?Mr=I:Mr||(g.opacities[ir]=Mr=_e),p[ir]=!0;var Wr=Pt.numIconVertices>0,Cn=g.placedOrientations[Pt.crossTileID],yn=Cn===y.WritingMode.vertical,Hn=Cn===y.WritingMode.horizontal||Cn===y.WritingMode.horizontalOnly;if(qt>0||_r>0){var xi=ri(Mr.text);Je(c.text,qt,yn?_a:xi),Je(c.text,_r,Hn?_a:xi);var Si=Mr.text.isHidden();[Pt.rightJustifiedTextSymbolIndex,Pt.centerJustifiedTextSymbolIndex,Pt.leftJustifiedTextSymbolIndex].forEach(function(wi){wi>=0&&(c.text.placedSymbolArray.get(wi).hidden=Si||yn?1:0)}),Pt.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Pt.verticalPlacedTextSymbolIndex).hidden=Si||Hn?1:0);var bi=g.variableOffsets[Pt.crossTileID];bi&&g.markUsedJustification(c,bi.anchor,Pt,Cn);var Ca=g.placedOrientations[Pt.crossTileID];Ca&&(g.markUsedJustification(c,"left",Pt,Ca),g.markUsedOrientation(c,Ca,Pt))}if(Wr){var qn=ri(Mr.icon),Hi=!(Pe&&Pt.verticalPlacedIconSymbolIndex&&yn);Pt.placedIconSymbolIndex>=0&&(Je(c.icon,Pt.numIconVertices,Hi?qn:_a),c.icon.placedSymbolArray.get(Pt.placedIconSymbolIndex).hidden=Mr.icon.isHidden()),Pt.verticalPlacedIconSymbolIndex>=0&&(Je(c.icon,Pt.numVerticalIconVertices,Hi?_a:qn),c.icon.placedSymbolArray.get(Pt.verticalPlacedIconSymbolIndex).hidden=Mr.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Qi=c.collisionArrays[gt];if(Qi){var Wi=new y.Point(0,0);if(Qi.textBox||Qi.verticalTextBox){var Oi=!0;if(q){var oa=g.variableOffsets[ir];oa?(Wi=Fo(oa.anchor,oa.width,oa.height,oa.textOffset,oa.textBoxScale),oe&&Wi._rotate(Te?g.transform.angle:-g.transform.angle)):Oi=!1}Qi.textBox&&Ju(c.textCollisionBox.collisionVertexArray,Mr.text.placed,!Oi||yn,Wi.x,Wi.y),Qi.verticalTextBox&&Ju(c.textCollisionBox.collisionVertexArray,Mr.text.placed,!Oi||Hn,Wi.x,Wi.y)}var Zi=Boolean(!Hn&&Qi.verticalIconBox);Qi.iconBox&&Ju(c.iconCollisionBox.collisionVertexArray,Mr.icon.placed,Zi,Pe?Wi.x:0,Pe?Wi.y:0),Qi.verticalIconBox&&Ju(c.iconCollisionBox.collisionVertexArray,Mr.icon.placed,!Zi,Pe?Wi.x:0,Pe?Wi.y:0)}}},mt=0;mt<c.symbolInstances.length;mt++)$e(mt);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var Ye=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Ye.invProjMatrix,c.placementViewportMatrix=Ye.viewportMatrix,c.collisionCircleArray=Ye.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},Bo.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Bo.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},Bo.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},Bo.prototype.stillRecent=function(c,p){var f=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*f>c},Bo.prototype.setStale=function(){this.stale=!0};var ju=Math.pow(2,25),jo=Math.pow(2,24),ye=Math.pow(2,17),Ze=Math.pow(2,16),Ct=Math.pow(2,9),hr=Math.pow(2,8),En=Math.pow(2,1);function ri(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var p=c.placed?1:0,f=Math.floor(127*c.opacity);return f*ju+p*jo+f*ye+p*Ze+f*Ct+p*hr+f*En+p}var _a=0,Go=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Go.prototype.continuePlacement=function(c,p,f,g,S){for(var I=this._bucketParts;this._currentTileIndex<c.length;)if(p.getBucketParts(I,g,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(function(O,z){return O.sortKey-z.sortKey}));this._currentPartIndex<I.length;)if(p.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Da=function(c,p,f,g,S,I,O){this.placement=new Bo(c,S,I,O),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1};Da.prototype.isDone=function(){return this._done},Da.prototype.continuePlacement=function(c,p,f){for(var g=this,S=y.browser.now(),I=function(){var q=y.browser.now()-S;return!g._forceFullPlacement&&q>2};this._currentPlacementIndex>=0;){var O=p[c[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Go(O)),this._inProgressLayer.continuePlacement(f[O.source],this.placement,this._showCollisionBoxes,O,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Da.prototype.commit=function(c){return this.placement.commit(c),this.placement};var No=512/y.EXTENT/2,So=function(c,p,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var g=0;g<p.length;g++){var S=p.get(g),I=S.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};So.prototype.getScaledCoordinates=function(c,p){var f=No/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*y.EXTENT+c.anchorX)*f),y:Math.floor((p.canonical.y*y.EXTENT+c.anchorY)*f)}},So.prototype.findMatches=function(c,p,f){for(var g=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),S=0;S<c.length;S++){var I=c.get(S);if(!I.crossTileID){var O=this.indexedSymbolInstances[I.key];if(O)for(var z=this.getScaledCoordinates(I,p),q=0,oe=O;q<oe.length;q+=1){var Te=oe[q];if(Math.abs(Te.coord.x-z.x)<=g&&Math.abs(Te.coord.y-z.y)<=g&&!f[Te.crossTileID]){f[Te.crossTileID]=!0,I.crossTileID=Te.crossTileID;break}}}}};var oo=function(){this.maxCrossTileID=0};oo.prototype.generate=function(){return++this.maxCrossTileID};var Ls=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ls.prototype.handleWrapJump=function(c){var p=Math.round((c-this.lng)/360);if(p!==0)for(var f in this.indexes){var g=this.indexes[f],S={};for(var I in g){var O=g[I];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+p),S[O.tileID.key]=O}this.indexes[f]=S}this.lng=c},Ls.prototype.addBucket=function(c,p,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var g=0;g<p.symbolInstances.length;g++)p.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var I in this.indexes){var O=this.indexes[I];if(Number(I)>c.overscaledZ)for(var z in O){var q=O[z];q.tileID.isChildOf(c)&&q.findMatches(p.symbolInstances,c,S)}else{var oe=O[c.scaledTo(Number(I)).key];oe&&oe.findMatches(p.symbolInstances,c,S)}}for(var Te=0;Te<p.symbolInstances.length;Te++){var Pe=p.symbolInstances.get(Te);Pe.crossTileID||(Pe.crossTileID=f.generate(),S[Pe.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new So(c,p.symbolInstances,p.bucketInstanceId),!0},Ls.prototype.removeBucketCrossTileIDs=function(c,p){for(var f in p.indexedSymbolInstances)for(var g=0,S=p.indexedSymbolInstances[f];g<S.length;g+=1)delete this.usedCrossTileIDs[c][S[g].crossTileID]},Ls.prototype.removeStaleBuckets=function(c){var p=!1;for(var f in this.indexes){var g=this.indexes[f];for(var S in g)c[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[S]),delete g[S],p=!0)}return p};var Qs=function(){this.layerIndexes={},this.crossTileIDs=new oo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Qs.prototype.addLayer=function(c,p,f){var g=this.layerIndexes[c.id];g===void 0&&(g=this.layerIndexes[c.id]=new Ls);var S=!1,I={};g.handleWrapJump(f);for(var O=0,z=p;O<z.length;O+=1){var q=z[O],oe=q.getBucket(c);oe&&c.id===oe.layerIds[0]&&(oe.bucketInstanceId||(oe.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(q.tileID,oe,this.crossTileIDs)&&(S=!0),I[oe.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(S=!0),S},Qs.prototype.pruneUnusedLayers=function(c){var p={};for(var f in c.forEach(function(g){p[g]=!0}),this.layerIndexes)p[f]||delete this.layerIndexes[f]};var uu=function(c,p){return y.emitValidationErrors(c,p&&p.filter(function(f){return f.identifier!=="source.canvas"}))},_u=y.pick(gn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Gu=y.pick(gn,["setCenter","setZoom","setBearing","setPitch"]),xu=function(){var c={},p=y.styleSpec.$version;for(var f in y.styleSpec.$root){var g,S=y.styleSpec.$root[f];S.required&&(g=f==="version"?p:S.type==="array"?[]:{})!=null&&(c[f]=g)}return c}(),Oo=function(c){function p(f,g){var S=this;g===void 0&&(g={}),c.call(this),this.map=f,this.dispatcher=new Sr(ar(),this),this.imageManager=new Ut,this.imageManager.setEventedParent(this),this.glyphManager=new yr(f._requestManager,g.localIdeographFontFamily),this.lineAtlas=new je(256,512),this.crossTileSymbolIndex=new Qs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var I=this;this._rtlTextPluginCallback=p.registerForPluginStateChange(function(O){I.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},function(z,q){if(y.triggerPluginCompletionEvent(z),q&&q.every(function(Te){return Te}))for(var oe in I.sourceCaches)I.sourceCaches[oe].reload()})}),this.on("data",function(O){if(O.dataType==="source"&&O.sourceDataType==="metadata"){var z=S.sourceCaches[O.sourceId];if(z){var q=z.getSource();if(q&&q.vectorLayerIds)for(var oe in S._layers){var Te=S._layers[oe];Te.source===q.id&&S._validateLayer(Te)}}}})}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.loadURL=function(f,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var I=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,g.accessToken);var O=this.map._requestManager.transformRequest(f,y.ResourceType.Style);this._request=y.getJSON(O,function(z,q){S._request=null,z?S.fire(new y.ErrorEvent(z)):q&&S._load(q,I)})},p.prototype.loadJSON=function(f,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(f,g.validate!==!1)})},p.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(xu,!1)},p.prototype._load=function(f,g){if(!g||!uu(this,y.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var I=Pr(this.stylesheet.layers);this._order=I.map(function(oe){return oe.id}),this._layers={},this._serializedLayers={};for(var O=0,z=I;O<z.length;O+=1){var q=z[O];(q=y.createStyleLayer(q)).setEventedParent(this,{layer:{id:q.id}}),this._layers[q.id]=q,this._serializedLayers[q.id]=q.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Jt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},p.prototype._loadSprite=function(f){var g=this;this._spriteRequest=function(S,I,O){var z,q,oe,Te=y.browser.devicePixelRatio>1?"@2x":"",Pe=y.getJSON(I.transformRequest(I.normalizeSpriteURL(S,Te,".json"),y.ResourceType.SpriteJSON),function($e,mt){Pe=null,oe||(oe=$e,z=mt,Je())}),_e=y.getImage(I.transformRequest(I.normalizeSpriteURL(S,Te,".png"),y.ResourceType.SpriteImage),function($e,mt){_e=null,oe||(oe=$e,q=mt,Je())});function Je(){if(oe)O(oe);else if(z&&q){var $e=y.browser.getImageData(q),mt={};for(var Ye in z){var gt=z[Ye],Pt=gt.width,qt=gt.height,_r=gt.x,ir=gt.y,Mr=gt.sdf,Wr=gt.pixelRatio,Cn=gt.stretchX,yn=gt.stretchY,Hn=gt.content,xi=new y.RGBAImage({width:Pt,height:qt});y.RGBAImage.copy($e,xi,{x:_r,y:ir},{x:0,y:0},{width:Pt,height:qt}),mt[Ye]={data:xi,pixelRatio:Wr,sdf:Mr,stretchX:Cn,stretchY:yn,content:Hn}}O(null,mt)}}return{cancel:function(){Pe&&(Pe.cancel(),Pe=null),_e&&(_e.cancel(),_e=null)}}}(f,this.map._requestManager,function(S,I){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(I)for(var O in I)g.imageManager.addImage(O,I[O]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},p.prototype._validateLayer=function(f){var g=this.sourceCaches[f.source];if(g){var S=f.sourceLayer;if(S){var I=g.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+I.id+'" as specified by style layer "'+f.id+'"')))}}},p.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},p.prototype._serializeLayers=function(f){for(var g=[],S=0,I=f;S<I.length;S+=1){var O=this._layers[I[S]];O.type!=="custom"&&g.push(O.serialize())}return g},p.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},p.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},p.prototype.update=function(f){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);for(var O in(S.length||I.length)&&this._updateWorkerLayers(S,I),this._updatedSources){var z=this._updatedSources[O];z==="reload"?this._reloadSource(O):z==="clear"&&this._clearSource(O)}for(var q in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[q].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var oe={};for(var Te in this.sourceCaches){var Pe=this.sourceCaches[Te];oe[Te]=Pe.used,Pe.used=!1}for(var _e=0,Je=this._order;_e<Je.length;_e+=1){var $e=this._layers[Je[_e]];$e.recalculate(f,this._availableImages),!$e.isHidden(f.zoom)&&$e.source&&(this.sourceCaches[$e.source].used=!0)}for(var mt in oe){var Ye=this.sourceCaches[mt];oe[mt]!==Ye.used&&Ye.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:mt}))}this.light.recalculate(f),this.z=f.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},p.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},p.prototype._updateWorkerLayers=function(f,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:g})},p.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},p.prototype.setState=function(f){var g=this;if(this._checkLoaded(),uu(this,y.validateStyle(f)))return!1;(f=y.clone$1(f)).layers=Pr(f.layers);var S=function(O,z){if(!O)return[{command:gn.setStyle,args:[z]}];var q=[];try{if(!y.deepEqual(O.version,z.version))return[{command:gn.setStyle,args:[z]}];y.deepEqual(O.center,z.center)||q.push({command:gn.setCenter,args:[z.center]}),y.deepEqual(O.zoom,z.zoom)||q.push({command:gn.setZoom,args:[z.zoom]}),y.deepEqual(O.bearing,z.bearing)||q.push({command:gn.setBearing,args:[z.bearing]}),y.deepEqual(O.pitch,z.pitch)||q.push({command:gn.setPitch,args:[z.pitch]}),y.deepEqual(O.sprite,z.sprite)||q.push({command:gn.setSprite,args:[z.sprite]}),y.deepEqual(O.glyphs,z.glyphs)||q.push({command:gn.setGlyphs,args:[z.glyphs]}),y.deepEqual(O.transition,z.transition)||q.push({command:gn.setTransition,args:[z.transition]}),y.deepEqual(O.light,z.light)||q.push({command:gn.setLight,args:[z.light]});var oe={},Te=[];(function(_e,Je,$e,mt){var Ye;for(Ye in Je=Je||{},_e=_e||{})_e.hasOwnProperty(Ye)&&(Je.hasOwnProperty(Ye)||Vn(Ye,$e,mt));for(Ye in Je)Je.hasOwnProperty(Ye)&&(_e.hasOwnProperty(Ye)?y.deepEqual(_e[Ye],Je[Ye])||(_e[Ye].type==="geojson"&&Je[Ye].type==="geojson"&&Ht(_e,Je,Ye)?$e.push({command:gn.setGeoJSONSourceData,args:[Ye,Je[Ye].data]}):na(Ye,Je,$e,mt)):ea(Ye,Je,$e))})(O.sources,z.sources,Te,oe);var Pe=[];O.layers&&O.layers.forEach(function(_e){oe[_e.source]?q.push({command:gn.removeLayer,args:[_e.id]}):Pe.push(_e)}),q=q.concat(Te),function(_e,Je,$e){Je=Je||[];var mt,Ye,gt,Pt,qt,_r,ir,Mr=(_e=_e||[]).map(da),Wr=Je.map(da),Cn=_e.reduce(aa,{}),yn=Je.reduce(aa,{}),Hn=Mr.slice(),xi=Object.create(null);for(mt=0,Ye=0;mt<Mr.length;mt++)yn.hasOwnProperty(gt=Mr[mt])?Ye++:($e.push({command:gn.removeLayer,args:[gt]}),Hn.splice(Hn.indexOf(gt,Ye),1));for(mt=0,Ye=0;mt<Wr.length;mt++)Hn[Hn.length-1-mt]!==(gt=Wr[Wr.length-1-mt])&&(Cn.hasOwnProperty(gt)?($e.push({command:gn.removeLayer,args:[gt]}),Hn.splice(Hn.lastIndexOf(gt,Hn.length-Ye),1)):Ye++,$e.push({command:gn.addLayer,args:[yn[gt],_r=Hn[Hn.length-mt]]}),Hn.splice(Hn.length-mt,0,gt),xi[gt]=!0);for(mt=0;mt<Wr.length;mt++)if(Pt=Cn[gt=Wr[mt]],qt=yn[gt],!xi[gt]&&!y.deepEqual(Pt,qt))if(y.deepEqual(Pt.source,qt.source)&&y.deepEqual(Pt["source-layer"],qt["source-layer"])&&y.deepEqual(Pt.type,qt.type)){for(ir in Rt(Pt.layout,qt.layout,$e,gt,null,gn.setLayoutProperty),Rt(Pt.paint,qt.paint,$e,gt,null,gn.setPaintProperty),y.deepEqual(Pt.filter,qt.filter)||$e.push({command:gn.setFilter,args:[gt,qt.filter]}),y.deepEqual(Pt.minzoom,qt.minzoom)&&y.deepEqual(Pt.maxzoom,qt.maxzoom)||$e.push({command:gn.setLayerZoomRange,args:[gt,qt.minzoom,qt.maxzoom]}),Pt)Pt.hasOwnProperty(ir)&&ir!=="layout"&&ir!=="paint"&&ir!=="filter"&&ir!=="metadata"&&ir!=="minzoom"&&ir!=="maxzoom"&&(ir.indexOf("paint.")===0?Rt(Pt[ir],qt[ir],$e,gt,ir.slice(6),gn.setPaintProperty):y.deepEqual(Pt[ir],qt[ir])||$e.push({command:gn.setLayerProperty,args:[gt,ir,qt[ir]]}));for(ir in qt)qt.hasOwnProperty(ir)&&!Pt.hasOwnProperty(ir)&&ir!=="layout"&&ir!=="paint"&&ir!=="filter"&&ir!=="metadata"&&ir!=="minzoom"&&ir!=="maxzoom"&&(ir.indexOf("paint.")===0?Rt(Pt[ir],qt[ir],$e,gt,ir.slice(6),gn.setPaintProperty):y.deepEqual(Pt[ir],qt[ir])||$e.push({command:gn.setLayerProperty,args:[gt,ir,qt[ir]]}))}else $e.push({command:gn.removeLayer,args:[gt]}),_r=Hn[Hn.lastIndexOf(gt)+1],$e.push({command:gn.addLayer,args:[qt,_r]})}(Pe,z.layers,q)}catch(_e){console.warn("Unable to compute style diff:",_e),q=[{command:gn.setStyle,args:[z]}]}return q}(this.serialize(),f).filter(function(O){return!(O.command in Gu)});if(S.length===0)return!1;var I=S.filter(function(O){return!(O.command in _u)});if(I.length>0)throw new Error("Unimplemented: "+I.map(function(O){return O.command}).join(", ")+".");return S.forEach(function(O){O.command!=="setTransition"&&g[O.command].apply(g,O.args)}),this.stylesheet=f,!0},p.prototype.addImage=function(f,g){if(this.getImage(f))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,g),this._afterImageUpdated(f)},p.prototype.updateImage=function(f,g){this.imageManager.updateImage(f,g)},p.prototype.getImage=function(f){return this.imageManager.getImage(f)},p.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},p.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},p.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},p.prototype.addSource=function(f,g,S){var I=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+f,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var O=this.sourceCaches[f]=new it(f,g,this.dispatcher);O.style=this,O.setEventedParent(this,function(){return{isSourceLoaded:I.loaded(),source:O.serialize(),sourceId:f}}),O.onAdd(this.map),this._changed=!0}},p.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===f)return this.fire(new y.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},p.prototype.setGeoJSONSourceData=function(f,g){this._checkLoaded(),this.sourceCaches[f].getSource().setData(g),this._changed=!0},p.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},p.prototype.addLayer=function(f,g,S){S===void 0&&(S={}),this._checkLoaded();var I=f.id;if(this.getLayer(I))this.fire(new y.ErrorEvent(new Error('Layer with id "'+I+'" already exists on this map')));else{var O;if(f.type==="custom"){if(uu(this,y.validateCustomStyleLayer(f)))return;O=y.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(I,f.source),f=y.clone$1(f),f=y.extend(f,{source:I})),this._validate(y.validateStyle.layer,"layers."+I,f,{arrayIndex:-1},S))return;O=y.createStyleLayer(f),this._validateLayer(O),O.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[O.id]=O.serialize()}var z=g?this._order.indexOf(g):this._order.length;if(g&&z===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(z,0,I),this._layerOrderChanged=!0,this._layers[I]=O,this._removedLayers[I]&&O.source&&O.type!=="custom"){var q=this._removedLayers[I];delete this._removedLayers[I],q.type!==O.type?this._updatedSources[O.source]="clear":(this._updatedSources[O.source]="reload",this.sourceCaches[O.source].pause())}this._updateLayer(O),O.onAdd&&O.onAdd(this.map)}}},p.prototype.moveLayer=function(f,g){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==g){var S=this._order.indexOf(f);this._order.splice(S,1);var I=g?this._order.indexOf(g):this._order.length;g&&I===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(I,0,f),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},p.prototype.removeLayer=function(f){this._checkLoaded();var g=this._layers[f];if(g){g.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=g,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},p.prototype.getLayer=function(f){return this._layers[f]},p.prototype.hasLayer=function(f){return f in this._layers},p.prototype.setLayerZoomRange=function(f,g,S){this._checkLoaded();var I=this.getLayer(f);I?I.minzoom===g&&I.maxzoom===S||(g!=null&&(I.minzoom=g),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},p.prototype.setFilter=function(f,g,S){S===void 0&&(S={}),this._checkLoaded();var I=this.getLayer(f);if(I){if(!y.deepEqual(I.filter,g))return g==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(y.validateStyle.filter,"layers."+I.id+".filter",g,null,S)||(I.filter=y.clone$1(g),this._updateLayer(I)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},p.prototype.getFilter=function(f){return y.clone$1(this.getLayer(f).filter)},p.prototype.setLayoutProperty=function(f,g,S,I){I===void 0&&(I={}),this._checkLoaded();var O=this.getLayer(f);O?y.deepEqual(O.getLayoutProperty(g),S)||(O.setLayoutProperty(g,S,I),this._updateLayer(O)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getLayoutProperty=function(f,g){var S=this.getLayer(f);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},p.prototype.setPaintProperty=function(f,g,S,I){I===void 0&&(I={}),this._checkLoaded();var O=this.getLayer(f);O?y.deepEqual(O.getPaintProperty(g),S)||(O.setPaintProperty(g,S,I)&&this._updateLayer(O),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getPaintProperty=function(f,g){return this.getLayer(f).getPaintProperty(g)},p.prototype.setFeatureState=function(f,g){this._checkLoaded();var S=f.source,I=f.sourceLayer,O=this.sourceCaches[S];if(O!==void 0){var z=O.getSource().type;z==="geojson"&&I?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):z!=="vector"||I?(f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),O.setFeatureState(I,f.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},p.prototype.removeFeatureState=function(f,g){this._checkLoaded();var S=f.source,I=this.sourceCaches[S];if(I!==void 0){var O=I.getSource().type,z=O==="vector"?f.sourceLayer:void 0;O!=="vector"||z?g&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(z,f.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},p.prototype.getFeatureState=function(f){this._checkLoaded();var g=f.source,S=f.sourceLayer,I=this.sourceCaches[g];if(I!==void 0){if(I.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,f.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},p.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},p.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},p.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},p.prototype._flattenAndSortRenderedFeatures=function(f){for(var g=this,S=function(Cn){return g._layers[Cn].type==="fill-extrusion"},I={},O=[],z=this._order.length-1;z>=0;z--){var q=this._order[z];if(S(q)){I[q]=z;for(var oe=0,Te=f;oe<Te.length;oe+=1){var Pe=Te[oe][q];if(Pe)for(var _e=0,Je=Pe;_e<Je.length;_e+=1)O.push(Je[_e])}}}O.sort(function(Cn,yn){return yn.intersectionZ-Cn.intersectionZ});for(var $e=[],mt=this._order.length-1;mt>=0;mt--){var Ye=this._order[mt];if(S(Ye))for(var gt=O.length-1;gt>=0;gt--){var Pt=O[gt].feature;if(I[Pt.layer.id]<mt)break;$e.push(Pt),O.pop()}else for(var qt=0,_r=f;qt<_r.length;qt+=1){var ir=_r[qt][Ye];if(ir)for(var Mr=0,Wr=ir;Mr<Wr.length;Mr+=1)$e.push(Wr[Mr].feature)}}return $e},p.prototype.queryRenderedFeatures=function(f,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var I={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var O=0,z=g.layers;O<z.length;O+=1){var q=z[O],oe=this._layers[q];if(!oe)return this.fire(new y.ErrorEvent(new Error("The layer '"+q+"' does not exist in the map's style and cannot be queried for features."))),[];I[oe.source]=!0}}var Te=[];for(var Pe in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!I[Pe]||Te.push(sn(this.sourceCaches[Pe],this._layers,this._serializedLayers,f,g,S));return this.placement&&Te.push(function(_e,Je,$e,mt,Ye,gt,Pt){for(var qt={},_r=gt.queryRenderedSymbols(mt),ir=[],Mr=0,Wr=Object.keys(_r).map(Number);Mr<Wr.length;Mr+=1)ir.push(Pt[Wr[Mr]]);ir.sort(Mi);for(var Cn=function(){var bi=Hn[yn],Ca=bi.featureIndex.lookupSymbolFeatures(_r[bi.bucketInstanceId],Je,bi.bucketIndex,bi.sourceLayerIndex,Ye.filter,Ye.layers,Ye.availableImages,_e);for(var qn in Ca){var Hi=qt[qn]=qt[qn]||[],Qi=Ca[qn];Qi.sort(function(oa,Zi){var wi=bi.featureSortOrder;if(wi){var ls=wi.indexOf(oa.featureIndex);return wi.indexOf(Zi.featureIndex)-ls}return Zi.featureIndex-oa.featureIndex});for(var Wi=0,Oi=Qi;Wi<Oi.length;Wi+=1)Hi.push(Oi[Wi])}},yn=0,Hn=ir;yn<Hn.length;yn+=1)Cn();var xi=function(bi){qt[bi].forEach(function(Ca){var qn=Ca.feature,Hi=$e[_e[bi].source].getFeatureState(qn.layer["source-layer"],qn.id);qn.source=qn.layer.source,qn.layer["source-layer"]&&(qn.sourceLayer=qn.layer["source-layer"]),qn.state=Hi})};for(var Si in qt)xi(Si);return qt}(this._layers,this._serializedLayers,this.sourceCaches,f,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Te)},p.prototype.querySourceFeatures=function(f,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[f];return S?function(I,O){for(var z=I.getRenderableIds().map(function(Je){return I.getTileByID(Je)}),q=[],oe={},Te=0;Te<z.length;Te++){var Pe=z[Te],_e=Pe.tileID.canonical.key;oe[_e]||(oe[_e]=!0,Pe.querySourceFeatures(q,O))}return q}(S,g):[]},p.prototype.addSourceType=function(f,g,S){return p.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(p.setSourceType(f,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:g.workerSourceURL},S):S(null,null))},p.prototype.getLight=function(){return this.light.getLight()},p.prototype.setLight=function(f,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),I=!1;for(var O in f)if(!y.deepEqual(f[O],S[O])){I=!0;break}if(I){var z={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,g),this.light.updateTransitions(z)}},p.prototype._validate=function(f,g,S,I,O){return O===void 0&&(O={}),(!O||O.validate!==!1)&&uu(this,f.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},I)))},p.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},p.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},p.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},p.prototype._updateSources=function(f){for(var g in this.sourceCaches)this.sourceCaches[g].update(f)},p.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},p.prototype._updatePlacement=function(f,g,S,I,O){O===void 0&&(O=!1);for(var z=!1,q=!1,oe={},Te=0,Pe=this._order;Te<Pe.length;Te+=1){var _e=this._layers[Pe[Te]];if(_e.type==="symbol"){if(!oe[_e.source]){var Je=this.sourceCaches[_e.source];oe[_e.source]=Je.getRenderableIds(!0).map(function(Pt){return Je.getTileByID(Pt)}).sort(function(Pt,qt){return qt.tileID.overscaledZ-Pt.tileID.overscaledZ||(Pt.tileID.isLessThan(qt.tileID)?-1:1)})}var $e=this.crossTileSymbolIndex.addLayer(_e,oe[_e.source],f.center.lng);z=z||$e}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((O=O||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),f.zoom))&&(this.pauseablePlacement=new Da(f,this._order,O,g,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,oe),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),q=!0),z&&this.pauseablePlacement.placement.setStale()),q||z)for(var mt=0,Ye=this._order;mt<Ye.length;mt+=1){var gt=this._layers[Ye[mt]];gt.type==="symbol"&&this.placement.updateLayerOpacities(gt,oe[gt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},p.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},p.prototype.getImages=function(f,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var I=this.sourceCaches[g.source];I&&I.setDependencies(g.tileID.key,g.type,g.icons)},p.prototype.getGlyphs=function(f,g,S){this.glyphManager.getGlyphs(g.stacks,S)},p.prototype.getResource=function(f,g,S){return y.makeRequest(g,S)},p}(y.Evented);Oo.getSourceType=function(c){return vr[c]},Oo.setSourceType=function(c,p){vr[c]=p},Oo.registerForPluginStateChange=y.registerForPluginStateChange;var fa=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),Cs=Ta(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ch=Ta(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),el=Ta(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),mf=Ta(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),qf=Ta("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yl=Ta(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),wc=Ta(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),_l=Ta("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),gf=Ta("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),E=Ta("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=Ta(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),H=Ta(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),F=Ta(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),le=Ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ue=Ta(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),yt=Ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ot=Ta(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Nt=Ta(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Br=Ta(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Xr=Ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Jn=Ta(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ki=Ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ji=Ta(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ha=Ta(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ka=Ta(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),xo=Ta(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ta(c,p){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=p.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=I?I.concat(S):S,z={};return{fragmentSource:c=c.replace(f,function(q,oe,Te,Pe,_e){return z[_e]=!0,oe==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
varying `+Te+" "+Pe+" "+_e+`;
#else
uniform `+Te+" "+Pe+" u_"+_e+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+_e+`
    `+Te+" "+Pe+" "+_e+" = u_"+_e+`;
#endif
`}),vertexSource:p=p.replace(f,function(q,oe,Te,Pe,_e){var Je=Pe==="float"?"vec2":"vec4",$e=_e.match(/color/)?"color":Je;return z[_e]?oe==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
uniform lowp float u_`+_e+`_t;
attribute `+Te+" "+Je+" a_"+_e+`;
varying `+Te+" "+Pe+" "+_e+`;
#else
uniform `+Te+" "+Pe+" u_"+_e+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+_e+" = a_"+_e+`;
#else
    `+Te+" "+Pe+" "+_e+" = u_"+_e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+_e+" = unpack_mix_"+$e+"(a_"+_e+", u_"+_e+`_t);
#else
    `+Te+" "+Pe+" "+_e+" = u_"+_e+`;
#endif
`:oe==="define"?`
#ifndef HAS_UNIFORM_u_`+_e+`
uniform lowp float u_`+_e+`_t;
attribute `+Te+" "+Je+" a_"+_e+`;
#else
uniform `+Te+" "+Pe+" u_"+_e+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+Te+" "+Pe+" "+_e+" = a_"+_e+`;
#else
    `+Te+" "+Pe+" "+_e+" = u_"+_e+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+_e+`
    `+Te+" "+Pe+" "+_e+" = unpack_mix_"+$e+"(a_"+_e+", u_"+_e+`_t);
#else
    `+Te+" "+Pe+" "+_e+" = u_"+_e+`;
#endif
`}),staticAttributes:g,staticUniforms:O}}var Hs=Object.freeze({__proto__:null,prelude:Cs,background:Ch,backgroundPattern:el,circle:mf,clippingMask:qf,heatmap:yl,heatmapTexture:wc,collisionBox:_l,collisionCircle:gf,debug:E,fill:k,fillOutline:H,fillOutlinePattern:F,fillPattern:le,fillExtrusion:Ue,fillExtrusionPattern:yt,hillshadePrepare:Ot,hillshade:Nt,line:Br,lineGradient:Xr,linePattern:Jn,lineSDF:Ki,raster:ji,symbolIcon:ha,symbolSDF:Ka,symbolTextAndIcon:xo}),Bl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Kc(c){for(var p=[],f=0;f<c.length;f++)if(c[f]!==null){var g=c[f].split(" ");p.push(g.pop())}return p}Bl.prototype.bind=function(c,p,f,g,S,I,O,z){this.context=c;for(var q=this.boundPaintVertexBuffers.length!==g.length,oe=0;!q&&oe<g.length;oe++)this.boundPaintVertexBuffers[oe]!==g[oe]&&(q=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===p&&this.boundLayoutVertexBuffer===f&&!q&&this.boundIndexBuffer===S&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===O&&this.boundDynamicVertexBuffer2===z?(c.bindVertexArrayOES.set(this.vao),O&&O.bind(),S&&S.dynamicDraw&&S.bind(),z&&z.bind()):this.freshBind(p,f,g,S,I,O,z)},Bl.prototype.freshBind=function(c,p,f,g,S,I,O){var z,q=c.numAttributes,oe=this.context,Te=oe.gl;if(oe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=oe.extVertexArrayObject.createVertexArrayOES(),oe.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=O;else{z=oe.currentNumAttributes||0;for(var Pe=q;Pe<z;Pe++)Te.disableVertexAttribArray(Pe)}p.enableAttributes(Te,c);for(var _e=0,Je=f;_e<Je.length;_e+=1)Je[_e].enableAttributes(Te,c);I&&I.enableAttributes(Te,c),O&&O.enableAttributes(Te,c),p.bind(),p.setVertexAttribPointers(Te,c,S);for(var $e=0,mt=f;$e<mt.length;$e+=1){var Ye=mt[$e];Ye.bind(),Ye.setVertexAttribPointers(Te,c,S)}I&&(I.bind(),I.setVertexAttribPointers(Te,c,S)),g&&g.bind(),O&&(O.bind(),O.setVertexAttribPointers(Te,c,S)),oe.currentNumAttributes=q},Bl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Qc=function(c,p,f,g,S,I){var O=c.gl;this.program=O.createProgram();for(var z=Kc(f.staticAttributes),q=g?g.getBinderAttributes():[],oe=z.concat(q),Te=f.staticUniforms?Kc(f.staticUniforms):[],Pe=g?g.getBinderUniforms():[],_e=[],Je=0,$e=Te.concat(Pe);Je<$e.length;Je+=1){var mt=$e[Je];_e.indexOf(mt)<0&&_e.push(mt)}var Ye=g?g.defines():[];I&&Ye.push("#define OVERDRAW_INSPECTOR;");var gt=Ye.concat(Cs.fragmentSource,f.fragmentSource).join(`
`),Pt=Ye.concat(Cs.vertexSource,f.vertexSource).join(`
`),qt=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(qt,gt),O.compileShader(qt),O.attachShader(this.program,qt);var _r=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(_r,Pt),O.compileShader(_r),O.attachShader(this.program,_r),this.attributes={};var ir={};this.numAttributes=oe.length;for(var Mr=0;Mr<this.numAttributes;Mr++)oe[Mr]&&(O.bindAttribLocation(this.program,Mr,oe[Mr]),this.attributes[oe[Mr]]=Mr);O.linkProgram(this.program),O.deleteShader(_r),O.deleteShader(qt);for(var Wr=0;Wr<_e.length;Wr++){var Cn=_e[Wr];if(Cn&&!ir[Cn]){var yn=O.getUniformLocation(this.program,Cn);yn&&(ir[Cn]=yn)}}this.fixedUniforms=S(c,ir),this.binderUniforms=g?g.getUniforms(c,ir):[]}}};function Tc(c,p,f){var g=1/Ea(f,1,p.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),I=f.tileSize*Math.pow(2,p.transform.tileZoom)/S,O=I*(f.tileID.canonical.x+f.tileID.wrap*S),z=I*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[O>>16,z>>16],u_pixel_coord_lower:[65535&O,65535&z]}}Qc.prototype.draw=function(c,p,f,g,S,I,O,z,q,oe,Te,Pe,_e,Je,$e,mt){var Ye,gt=c.gl;if(!this.failedToCreate){for(var Pt in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(g),c.setColorMode(S),c.setCullFace(I),this.fixedUniforms)this.fixedUniforms[Pt].set(O[Pt]);Je&&Je.setUniforms(c,this.binderUniforms,Pe,{zoom:_e});for(var qt=(Ye={},Ye[gt.LINES]=2,Ye[gt.TRIANGLES]=3,Ye[gt.LINE_STRIP]=1,Ye)[p],_r=0,ir=Te.get();_r<ir.length;_r+=1){var Mr=ir[_r],Wr=Mr.vaos||(Mr.vaos={});(Wr[z]||(Wr[z]=new Bl)).bind(c,this,q,Je?Je.getPaintVertexBuffers():[],oe,Mr.vertexOffset,$e,mt),gt.drawElements(p,Mr.primitiveLength*qt,gt.UNSIGNED_SHORT,Mr.primitiveOffset*qt*2)}}};var Mc=function(c,p,f,g){var S=p.style.light,I=S.properties.get("position"),O=[I.x,I.y,I.z],z=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(z,-p.transform.angle),y.transformMat3(O,O,z);var q=S.properties.get("color");return{u_matrix:c,u_lightpos:O,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+f,u_opacity:g}},Pu=function(c,p,f,g,S,I,O){return y.extend(Mc(c,p,f,g),Tc(I,p,O),{u_height_factor:-Math.pow(2,S.overscaledZ)/O.tileSize/8})},Nl=function(c){return{u_matrix:c}},xl=function(c,p,f,g){return y.extend(Nl(c),Tc(f,p,g))},Ho=function(c,p){return{u_matrix:c,u_world:p}},Sh=function(c,p,f,g,S){return y.extend(xl(c,p,f,g),{u_world:S})},Ah=function(c,p,f,g){var S,I,O=c.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var z=Ea(f,1,O.zoom);S=!0,I=[z,z]}else S=!1,I=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(p.posMatrix,f,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:I}},bu=function(c,p,f){var g=Ea(f,1,p.zoom),S=Math.pow(2,p.zoom-f.tileID.overscaledZ),I=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:p.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[p.pixelsToGLUnits[0]/(g*S),p.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:I}},Xh=function(c,p,f){return{u_matrix:c,u_inv_matrix:p,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},zl=function(c,p,f){return f===void 0&&(f=1),{u_matrix:c,u_color:p,u_overlay:0,u_overlay_scale:f}},tl=function(c){return{u_matrix:c}},Ul=function(c,p,f,g){return{u_matrix:c,u_extrude_scale:Ea(p,1,f),u_intensity:g}},bl=function(c,p,f){var g=c.transform;return{u_matrix:yp(c,p,f),u_ratio:1/Ea(p,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},lo=function(c,p,f,g){return y.extend(bl(c,p,f),{u_image:0,u_image_height:g})},rl=function(c,p,f,g){var S=c.transform,I=Hu(p,S);return{u_matrix:yp(c,p,f),u_texsize:p.imageAtlasTexture.size,u_ratio:1/Ea(p,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[I,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},$f=function(c,p,f,g,S){var I=c.lineAtlas,O=Hu(p,c.transform),z=f.layout.get("line-cap")==="round",q=I.getDash(g.from,z),oe=I.getDash(g.to,z),Te=q.width*S.fromScale,Pe=oe.width*S.toScale;return y.extend(bl(c,p,f),{u_patternscale_a:[O/Te,-q.height/2],u_patternscale_b:[O/Pe,-oe.height/2],u_sdfgamma:I.width/(256*Math.min(Te,Pe)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:oe.y,u_mix:S.t})};function Hu(c,p){return 1/Ea(c,1,p.tileZoom)}function yp(c,p,f){return c.translatePosMatrix(p.tileID.posMatrix,p,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var Qd=function(c,p,f,g,S){return{u_matrix:c,u_tl_parent:p,u_scale_parent:f,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(O=S.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(I=S.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:jp(S.paint.get("raster-hue-rotate"))};var I,O};function jp(c){c*=Math.PI/180;var p=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*p-f+1)/3,(Math.sqrt(3)*p-f+1)/3]}var wh,yf=function(c,p,f,g,S,I,O,z,q,oe){var Te=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:p?p.uSizeT:0,u_size:p?p.uSize:0,u_camera_to_center_distance:Te.cameraToCenterDistance,u_pitch:Te.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Te.width/Te.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:O,u_coord_matrix:z,u_is_text:+q,u_pitch_with_map:+g,u_texsize:oe,u_texture:0}},_f=function(c,p,f,g,S,I,O,z,q,oe,Te){var Pe=S.transform;return y.extend(yf(c,p,f,g,S,I,O,z,q,oe),{u_gamma_scale:g?Math.cos(Pe._pitch)*Pe.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+Te})},Ic=function(c,p,f,g,S,I,O,z,q,oe){return y.extend(_f(c,p,f,g,S,I,O,z,!0,q,!0),{u_texsize_icon:oe,u_texture_icon:1})},xf=function(c,p,f){return{u_matrix:c,u_opacity:p,u_color:f}},ec=function(c,p,f,g,S,I){return y.extend(function(O,z,q,oe){var Te=q.imageManager.getPattern(O.from.toString()),Pe=q.imageManager.getPattern(O.to.toString()),_e=q.imageManager.getPixelSize(),Je=_e.width,$e=_e.height,mt=Math.pow(2,oe.tileID.overscaledZ),Ye=oe.tileSize*Math.pow(2,q.transform.tileZoom)/mt,gt=Ye*(oe.tileID.canonical.x+oe.tileID.wrap*mt),Pt=Ye*oe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Te.tl,u_pattern_br_a:Te.br,u_pattern_tl_b:Pe.tl,u_pattern_br_b:Pe.br,u_texsize:[Je,$e],u_mix:z.t,u_pattern_size_a:Te.displaySize,u_pattern_size_b:Pe.displaySize,u_scale_a:z.fromScale,u_scale_b:z.toScale,u_tile_units_to_pixels:1/Ea(oe,1,q.transform.tileZoom),u_pixel_coord_upper:[gt>>16,Pt>>16],u_pixel_coord_lower:[65535&gt,65535&Pt]}}(g,I,f,S),{u_matrix:c,u_opacity:p})},bf={fillExtrusion:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_lightpos:new y.Uniform3f(c,p.u_lightpos),u_lightintensity:new y.Uniform1f(c,p.u_lightintensity),u_lightcolor:new y.Uniform3f(c,p.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,p.u_vertical_gradient),u_opacity:new y.Uniform1f(c,p.u_opacity)}},fillExtrusionPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_lightpos:new y.Uniform3f(c,p.u_lightpos),u_lightintensity:new y.Uniform1f(c,p.u_lightintensity),u_lightcolor:new y.Uniform3f(c,p.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,p.u_vertical_gradient),u_height_factor:new y.Uniform1f(c,p.u_height_factor),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade),u_opacity:new y.Uniform1f(c,p.u_opacity)}},fill:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},fillPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},fillOutline:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world)}},fillOutlinePattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},circle:function(c,p){return{u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(c,p.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(c,p.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},collisionBox:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(c,p.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(c,p.u_extrude_scale),u_overscale_factor:new y.Uniform1f(c,p.u_overscale_factor)}},collisionCircle:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_inv_matrix:new y.UniformMatrix4f(c,p.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(c,p.u_viewport_size)}},debug:function(c,p){return{u_color:new y.UniformColor(c,p.u_color),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_overlay:new y.Uniform1i(c,p.u_overlay),u_overlay_scale:new y.Uniform1f(c,p.u_overlay_scale)}},clippingMask:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},heatmap:function(c,p){return{u_extrude_scale:new y.Uniform1f(c,p.u_extrude_scale),u_intensity:new y.Uniform1f(c,p.u_intensity),u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},heatmapTexture:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world),u_image:new y.Uniform1i(c,p.u_image),u_color_ramp:new y.Uniform1i(c,p.u_color_ramp),u_opacity:new y.Uniform1f(c,p.u_opacity)}},hillshade:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_latrange:new y.Uniform2f(c,p.u_latrange),u_light:new y.Uniform2f(c,p.u_light),u_shadow:new y.UniformColor(c,p.u_shadow),u_highlight:new y.UniformColor(c,p.u_highlight),u_accent:new y.UniformColor(c,p.u_accent)}},hillshadePrepare:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_dimension:new y.Uniform2f(c,p.u_dimension),u_zoom:new y.Uniform1f(c,p.u_zoom),u_unpack:new y.Uniform4f(c,p.u_unpack)}},line:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels)}},lineGradient:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_image:new y.Uniform1i(c,p.u_image),u_image_height:new y.Uniform1f(c,p.u_image_height)}},linePattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_texsize:new y.Uniform2f(c,p.u_texsize),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_image:new y.Uniform1i(c,p.u_image),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},lineSDF:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(c,p.u_patternscale_a),u_patternscale_b:new y.Uniform2f(c,p.u_patternscale_b),u_sdfgamma:new y.Uniform1f(c,p.u_sdfgamma),u_image:new y.Uniform1i(c,p.u_image),u_tex_y_a:new y.Uniform1f(c,p.u_tex_y_a),u_tex_y_b:new y.Uniform1f(c,p.u_tex_y_b),u_mix:new y.Uniform1f(c,p.u_mix)}},raster:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_tl_parent:new y.Uniform2f(c,p.u_tl_parent),u_scale_parent:new y.Uniform1f(c,p.u_scale_parent),u_buffer_scale:new y.Uniform1f(c,p.u_buffer_scale),u_fade_t:new y.Uniform1f(c,p.u_fade_t),u_opacity:new y.Uniform1f(c,p.u_opacity),u_image0:new y.Uniform1i(c,p.u_image0),u_image1:new y.Uniform1i(c,p.u_image1),u_brightness_low:new y.Uniform1f(c,p.u_brightness_low),u_brightness_high:new y.Uniform1f(c,p.u_brightness_high),u_saturation_factor:new y.Uniform1f(c,p.u_saturation_factor),u_contrast_factor:new y.Uniform1f(c,p.u_contrast_factor),u_spin_weights:new y.Uniform3f(c,p.u_spin_weights)}},symbolIcon:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texture:new y.Uniform1i(c,p.u_texture)}},symbolSDF:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texture:new y.Uniform1i(c,p.u_texture),u_gamma_scale:new y.Uniform1f(c,p.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,p.u_is_halo)}},symbolTextAndIcon:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texsize_icon:new y.Uniform2f(c,p.u_texsize_icon),u_texture:new y.Uniform1i(c,p.u_texture),u_texture_icon:new y.Uniform1i(c,p.u_texture_icon),u_gamma_scale:new y.Uniform1f(c,p.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,p.u_is_halo)}},background:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_opacity:new y.Uniform1f(c,p.u_opacity),u_color:new y.UniformColor(c,p.u_color)}},backgroundPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_opacity:new y.Uniform1f(c,p.u_opacity),u_image:new y.Uniform1i(c,p.u_image),u_pattern_tl_a:new y.Uniform2f(c,p.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(c,p.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(c,p.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(c,p.u_pattern_br_b),u_texsize:new y.Uniform2f(c,p.u_texsize),u_mix:new y.Uniform1f(c,p.u_mix),u_pattern_size_a:new y.Uniform2f(c,p.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(c,p.u_pattern_size_b),u_scale_a:new y.Uniform1f(c,p.u_scale_a),u_scale_b:new y.Uniform1f(c,p.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(c,p.u_tile_units_to_pixels)}}};function tc(c,p,f,g,S,I,O){for(var z=c.context,q=z.gl,oe=c.useProgram("collisionBox"),Te=[],Pe=0,_e=0,Je=0;Je<g.length;Je++){var $e=g[Je],mt=p.getTile($e),Ye=mt.getBucket(f);if(Ye){var gt=$e.posMatrix;S[0]===0&&S[1]===0||(gt=c.translatePosMatrix($e.posMatrix,mt,S,I));var Pt=O?Ye.textCollisionBox:Ye.iconCollisionBox,qt=Ye.collisionCircleArray;if(qt.length>0){var _r=y.create(),ir=gt;y.mul(_r,Ye.placementInvProjMatrix,c.transform.glCoordMatrix),y.mul(_r,_r,Ye.placementViewportMatrix),Te.push({circleArray:qt,circleOffset:_e,transform:ir,invTransform:_r}),_e=Pe+=qt.length/4}Pt&&oe.draw(z,q.LINES,Oe.disabled,qe.disabled,c.colorModeForRenderPass(),St.disabled,bu(gt,c.transform,mt),f.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,null,c.transform.zoom,null,null,Pt.collisionVertexBuffer)}}if(O&&Te.length){var Mr=c.useProgram("collisionCircle"),Wr=new y.StructArrayLayout2f1f2i16;Wr.resize(4*Pe),Wr._trim();for(var Cn=0,yn=0,Hn=Te;yn<Hn.length;yn+=1)for(var xi=Hn[yn],Si=0;Si<xi.circleArray.length/4;Si++){var bi=4*Si,Ca=xi.circleArray[bi+0],qn=xi.circleArray[bi+1],Hi=xi.circleArray[bi+2],Qi=xi.circleArray[bi+3];Wr.emplace(Cn++,Ca,qn,Hi,Qi,0),Wr.emplace(Cn++,Ca,qn,Hi,Qi,1),Wr.emplace(Cn++,Ca,qn,Hi,Qi,2),Wr.emplace(Cn++,Ca,qn,Hi,Qi,3)}(!wh||wh.length<2*Pe)&&(wh=function(Xo){var Ds=2*Xo,cs=new y.StructArrayLayout3ui6;cs.resize(Ds),cs._trim();for(var co=0;co<Ds;co++){var es=6*co;cs.uint16[es+0]=4*co+0,cs.uint16[es+1]=4*co+1,cs.uint16[es+2]=4*co+2,cs.uint16[es+3]=4*co+2,cs.uint16[es+4]=4*co+3,cs.uint16[es+5]=4*co+0}return cs}(Pe));for(var Wi=z.createIndexBuffer(wh,!0),Oi=z.createVertexBuffer(Wr,y.collisionCircleLayout.members,!0),oa=0,Zi=Te;oa<Zi.length;oa+=1){var wi=Zi[oa],ls=Xh(wi.transform,wi.invTransform,c.transform);Mr.draw(z,q.TRIANGLES,Oe.disabled,qe.disabled,c.colorModeForRenderPass(),St.disabled,ls,f.id,Oi,Wi,y.SegmentVector.simpleSegment(0,2*wi.circleOffset,wi.circleArray.length,wi.circleArray.length/2),null,c.transform.zoom,null,null,null)}Oi.destroy(),Wi.destroy()}}var lu=y.identity(new Float32Array(16));function Kf(c,p,f,g,S,I){var O=y.getAnchorAlignment(c),z=-(O.horizontalAlign-.5)*p,q=-(O.verticalAlign-.5)*f,oe=y.evaluateVariableOffset(c,g);return new y.Point((z/S+oe[0])*I,(q/S+oe[1])*I)}function rc(c,p,f,g,S,I,O,z,q,oe,Te){var Pe=c.text.placedSymbolArray,_e=c.text.dynamicLayoutVertexArray,Je=c.icon.dynamicLayoutVertexArray,$e={};_e.clear();for(var mt=0;mt<Pe.length;mt++){var Ye=Pe.get(mt),gt=Ye.hidden||!Ye.crossTileID||c.allowVerticalPlacement&&!Ye.placedOrientation?null:g[Ye.crossTileID];if(gt){var Pt=new y.Point(Ye.anchorX,Ye.anchorY),qt=Or(Pt,f?z:O),_r=Dr(I.cameraToCenterDistance,qt.signedDistanceFromCamera),ir=S.evaluateSizeForFeature(c.textSizeData,oe,Ye)*_r/y.ONE_EM;f&&(ir*=c.tilePixelRatio/q);for(var Mr=Kf(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textBoxScale,ir),Wr=f?Or(Pt.add(Mr),O).point:qt.point.add(p?Mr.rotate(-I.angle):Mr),Cn=c.allowVerticalPlacement&&Ye.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,yn=0;yn<Ye.numGlyphs;yn++)y.addDynamicAttributes(_e,Wr,Cn);Te&&Ye.associatedIconIndex>=0&&($e[Ye.associatedIconIndex]={shiftedAnchor:Wr,angle:Cn})}else Ra(Ye.numGlyphs,_e)}if(Te){Je.clear();for(var Hn=c.icon.placedSymbolArray,xi=0;xi<Hn.length;xi++){var Si=Hn.get(xi);if(Si.hidden)Ra(Si.numGlyphs,Je);else{var bi=$e[xi];if(bi)for(var Ca=0;Ca<Si.numGlyphs;Ca++)y.addDynamicAttributes(Je,bi.shiftedAnchor,bi.angle);else Ra(Si.numGlyphs,Je)}}c.icon.dynamicLayoutVertexBuffer.updateData(Je)}c.text.dynamicLayoutVertexBuffer.updateData(_e)}function Yh(c,p,f){return f.iconsInText&&p?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Pc(c,p,f,g,S,I,O,z,q,oe,Te,Pe){for(var _e=c.context,Je=_e.gl,$e=c.transform,mt=z==="map",Ye=q==="map",gt=mt&&f.layout.get("symbol-placement")!=="point",Pt=mt&&!Ye&&!gt,qt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,_r=!1,ir=c.depthModeForSublayer(0,Oe.ReadOnly),Mr=f.layout.get("text-variable-anchor"),Wr=[],Cn=0,yn=g;Cn<yn.length;Cn+=1){var Hn=yn[Cn],xi=p.getTile(Hn),Si=xi.getBucket(f);if(Si){var bi=S?Si.text:Si.icon;if(bi&&bi.segments.get().length){var Ca=bi.programConfigurations.get(f.id),qn=S||Si.sdfIcons,Hi=S?Si.textSizeData:Si.iconSizeData,Qi=Ye||$e.pitch!==0,Wi=c.useProgram(Yh(qn,S,Si),Ca),Oi=y.evaluateSizeForZoom(Hi,$e.zoom),oa=void 0,Zi=[0,0],wi=void 0,ls=void 0,Xo=null,Ds=void 0;if(S)wi=xi.glyphAtlasTexture,ls=Je.LINEAR,oa=xi.glyphAtlasTexture.size,Si.iconsInText&&(Zi=xi.imageAtlasTexture.size,Xo=xi.imageAtlasTexture,Ds=Qi||c.options.rotating||c.options.zooming||Hi.kind==="composite"||Hi.kind==="camera"?Je.LINEAR:Je.NEAREST);else{var cs=f.layout.get("icon-size").constantOr(0)!==1||Si.iconsNeedLinear;wi=xi.imageAtlasTexture,ls=qn||c.options.rotating||c.options.zooming||cs||Qi?Je.LINEAR:Je.NEAREST,oa=xi.imageAtlasTexture.size}var co=Ea(xi,1,c.transform.zoom),es=_o(Hn.posMatrix,Ye,mt,c.transform,co),ts=Na(Hn.posMatrix,Ye,mt,c.transform,co),Fs=Mr&&Si.hasTextData(),lc=f.layout.get("icon-text-fit")!=="none"&&Fs&&Si.hasIconData();gt&&us(Si,Hn.posMatrix,c,S,es,ts,Ye,oe);var eu=c.translatePosMatrix(Hn.posMatrix,xi,I,O),Xu=gt||S&&Mr||lc?lu:es,Cu=c.translatePosMatrix(ts,xi,I,O,!0),Of=qn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,cc={program:Wi,buffers:bi,uniformValues:qn?Si.iconsInText?Ic(Hi.kind,Oi,Pt,Ye,c,eu,Xu,Cu,oa,Zi):_f(Hi.kind,Oi,Pt,Ye,c,eu,Xu,Cu,S,oa,!0):yf(Hi.kind,Oi,Pt,Ye,c,eu,Xu,Cu,S,oa),atlasTexture:wi,atlasTextureIcon:Xo,atlasInterpolation:ls,atlasInterpolationIcon:Ds,isSDF:qn,hasHalo:Of};if(qt&&Si.canOverlap){_r=!0;for(var Wl=0,Tl=bi.segments.get();Wl<Tl.length;Wl+=1){var Rf=Tl[Wl];Wr.push({segments:new y.SegmentVector([Rf]),sortKey:Rf.sortKey,state:cc})}}else Wr.push({segments:bi.segments,sortKey:0,state:cc})}}}_r&&Wr.sort(function(Dc,Bs){return Dc.sortKey-Bs.sortKey});for(var fl=0,fc=Wr;fl<fc.length;fl+=1){var Xl=fc[fl],fs=Xl.state;if(_e.activeTexture.set(Je.TEXTURE0),fs.atlasTexture.bind(fs.atlasInterpolation,Je.CLAMP_TO_EDGE),fs.atlasTextureIcon&&(_e.activeTexture.set(Je.TEXTURE1),fs.atlasTextureIcon&&fs.atlasTextureIcon.bind(fs.atlasInterpolationIcon,Je.CLAMP_TO_EDGE)),fs.isSDF){var Ml=fs.uniformValues;fs.hasHalo&&(Ml.u_is_halo=1,nc(fs.buffers,Xl.segments,f,c,fs.program,ir,Te,Pe,Ml)),Ml.u_is_halo=0}nc(fs.buffers,Xl.segments,f,c,fs.program,ir,Te,Pe,fs.uniformValues)}}function nc(c,p,f,g,S,I,O,z,q){var oe=g.context;S.draw(oe,oe.gl.TRIANGLES,I,O,z,St.disabled,q,f.id,c.layoutVertexBuffer,c.indexBuffer,p,f.paint,g.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function nl(c,p,f,g,S,I,O){var z,q,oe,Te,Pe,_e=c.context.gl,Je=f.paint.get("fill-pattern"),$e=Je&&Je.constantOr(1),mt=f.getCrossfadeParameters();O?(q=$e&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=_e.LINES):(q=$e?"fillPattern":"fill",z=_e.TRIANGLES);for(var Ye=0,gt=g;Ye<gt.length;Ye+=1){var Pt=gt[Ye],qt=p.getTile(Pt);if(!$e||qt.patternsLoaded()){var _r=qt.getBucket(f);if(_r){var ir=_r.programConfigurations.get(f.id),Mr=c.useProgram(q,ir);$e&&(c.context.activeTexture.set(_e.TEXTURE0),qt.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ir.updatePaintBuffers(mt));var Wr=Je.constantOr(null);if(Wr&&qt.imageAtlas){var Cn=qt.imageAtlas,yn=Cn.patternPositions[Wr.to.toString()],Hn=Cn.patternPositions[Wr.from.toString()];yn&&Hn&&ir.setConstantPatternPositions(yn,Hn)}var xi=c.translatePosMatrix(Pt.posMatrix,qt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(O){Te=_r.indexBuffer2,Pe=_r.segments2;var Si=[_e.drawingBufferWidth,_e.drawingBufferHeight];oe=q==="fillOutlinePattern"&&$e?Sh(xi,c,mt,qt,Si):Ho(xi,Si)}else Te=_r.indexBuffer,Pe=_r.segments,oe=$e?xl(xi,c,mt,qt):Nl(xi);Mr.draw(c.context,z,S,c.stencilModeForClipping(Pt),I,St.disabled,oe,f.id,_r.layoutVertexBuffer,Te,Pe,f.paint,c.transform.zoom,ir)}}}}function Ef(c,p,f,g,S,I,O){for(var z=c.context,q=z.gl,oe=f.paint.get("fill-extrusion-pattern"),Te=oe.constantOr(1),Pe=f.getCrossfadeParameters(),_e=f.paint.get("fill-extrusion-opacity"),Je=0,$e=g;Je<$e.length;Je+=1){var mt=$e[Je],Ye=p.getTile(mt),gt=Ye.getBucket(f);if(gt){var Pt=gt.programConfigurations.get(f.id),qt=c.useProgram(Te?"fillExtrusionPattern":"fillExtrusion",Pt);Te&&(c.context.activeTexture.set(q.TEXTURE0),Ye.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Pt.updatePaintBuffers(Pe));var _r=oe.constantOr(null);if(_r&&Ye.imageAtlas){var ir=Ye.imageAtlas,Mr=ir.patternPositions[_r.to.toString()],Wr=ir.patternPositions[_r.from.toString()];Mr&&Wr&&Pt.setConstantPatternPositions(Mr,Wr)}var Cn=c.translatePosMatrix(mt.posMatrix,Ye,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),yn=f.paint.get("fill-extrusion-vertical-gradient"),Hn=Te?Pu(Cn,c,yn,_e,mt,Pe,Ye):Mc(Cn,c,yn,_e);qt.draw(z,z.gl.TRIANGLES,S,I,O,St.backCCW,Hn,f.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,f.paint,c.transform.zoom,Pt)}}}function kc(c,p,f,g,S,I){var O=c.context,z=O.gl,q=p.fbo;if(q){var oe=c.useProgram("hillshade");O.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get());var Te=function(Pe,_e,Je){var $e=Je.paint.get("hillshade-shadow-color"),mt=Je.paint.get("hillshade-highlight-color"),Ye=Je.paint.get("hillshade-accent-color"),gt=Je.paint.get("hillshade-illumination-direction")*(Math.PI/180);Je.paint.get("hillshade-illumination-anchor")==="viewport"&&(gt-=Pe.transform.angle);var Pt,qt,_r,ir=!Pe.options.moving;return{u_matrix:Pe.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),ir),u_image:0,u_latrange:(Pt=_e.tileID,qt=Math.pow(2,Pt.canonical.z),_r=Pt.canonical.y,[new y.MercatorCoordinate(0,_r/qt).toLngLat().lat,new y.MercatorCoordinate(0,(_r+1)/qt).toLngLat().lat]),u_light:[Je.paint.get("hillshade-exaggeration"),gt],u_shadow:$e,u_highlight:mt,u_accent:Ye}}(c,p,f);oe.draw(O,z.TRIANGLES,g,S,I,St.disabled,Te,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function _p(c,p,f,g,S,I){var O=c.context,z=O.gl,q=p.dem;if(q&&q.data){var oe=q.dim,Te=q.stride,Pe=q.getPixels();if(O.activeTexture.set(z.TEXTURE1),O.pixelStoreUnpackPremultiplyAlpha.set(!1),p.demTexture=p.demTexture||c.getTileTexture(Te),p.demTexture){var _e=p.demTexture;_e.update(Pe,{premultiply:!1}),_e.bind(z.NEAREST,z.CLAMP_TO_EDGE)}else p.demTexture=new y.Texture(O,Pe,z.RGBA,{premultiply:!1}),p.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);O.activeTexture.set(z.TEXTURE0);var Je=p.fbo;if(!Je){var $e=new y.Texture(O,{width:oe,height:oe,data:null},z.RGBA);$e.bind(z.LINEAR,z.CLAMP_TO_EDGE),(Je=p.fbo=O.createFramebuffer(oe,oe,!0)).colorAttachment.set($e.texture)}O.bindFramebuffer.set(Je.framebuffer),O.viewport.set([0,0,oe,oe]),c.useProgram("hillshadePrepare").draw(O,z.TRIANGLES,g,S,I,St.disabled,function(mt,Ye){var gt=Ye.stride,Pt=y.create();return y.ortho(Pt,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Pt,Pt,[0,-y.EXTENT,0]),{u_matrix:Pt,u_image:1,u_dimension:[gt,gt],u_zoom:mt.overscaledZ,u_unpack:Ye.getUnpackVector()}}(p.tileID,q),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),p.needsHillshadePrepare=!1}}function Cf(c,p,f,g,S){var I=g.paint.get("raster-fade-duration");if(I>0){var O=y.browser.now(),z=(O-c.timeAdded)/I,q=p?(O-p.timeAdded)/I:-1,oe=f.getSource(),Te=S.coveringZoomLevel({tileSize:oe.tileSize,roundZoom:oe.roundZoom}),Pe=!p||Math.abs(p.tileID.overscaledZ-Te)>Math.abs(c.tileID.overscaledZ-Te),_e=Pe&&c.refreshedUponExpiration?1:y.clamp(Pe?z:1-q,0,1);return c.refreshedUponExpiration&&z>=1&&(c.refreshedUponExpiration=!1),p?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}var ic=new y.Color(1,0,0,1),qh=new y.Color(0,1,0,1),Sf=new y.Color(0,0,1,1),Af=new y.Color(1,0,1,1),Gp=new y.Color(0,1,1,1);function Hp(c,p,f,g){Jc(c,0,p+f/2,c.transform.width,f,g)}function Th(c,p,f,g){Jc(c,p-f/2,0,f,c.transform.height,g)}function Jc(c,p,f,g,S,I){var O=c.context,z=O.gl;z.enable(z.SCISSOR_TEST),z.scissor(p*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),O.clear({color:I}),z.disable(z.SCISSOR_TEST)}function Eu(c,p,f){var g=c.context,S=g.gl,I=f.posMatrix,O=c.useProgram("debug"),z=Oe.disabled,q=qe.disabled,oe=c.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),O.draw(g,S.LINE_STRIP,z,q,oe,St.disabled,zl(I,y.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var Te=p.getTileByID(f.key).latestRawTileData,Pe=Math.floor((Te&&Te.byteLength||0)/1024),_e=p.getTile(f).tileSize,Je=512/Math.min(_e,512)*(f.overscaledZ/c.transform.zoom)*.5,$e=f.canonical.toString();f.overscaledZ!==f.canonical.z&&($e+=" => "+f.overscaledZ),function(mt,Ye){mt.initDebugOverlayCanvas();var gt=mt.debugOverlayCanvas,Pt=mt.context.gl,qt=mt.debugOverlayCanvas.getContext("2d");qt.clearRect(0,0,gt.width,gt.height),qt.shadowColor="white",qt.shadowBlur=2,qt.lineWidth=1.5,qt.strokeStyle="white",qt.textBaseline="top",qt.font="bold 36px Open Sans, sans-serif",qt.fillText(Ye,5,5),qt.strokeText(Ye,5,5),mt.debugOverlayTexture.update(gt),mt.debugOverlayTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE)}(c,$e+" "+Pe+"kb"),O.draw(g,S.TRIANGLES,z,q,ct.alphaBlended,St.disabled,zl(I,y.Color.transparent,Je),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var ef={symbol:function(c,p,f,g,S){if(c.renderPass==="translucent"){var I=qe.disabled,O=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(z,q,oe,Te,Pe,_e,Je){for(var $e=q.transform,mt=Pe==="map",Ye=_e==="map",gt=0,Pt=z;gt<Pt.length;gt+=1){var qt=Pt[gt],_r=Te.getTile(qt),ir=_r.getBucket(oe);if(ir&&ir.text&&ir.text.segments.get().length){var Mr=y.evaluateSizeForZoom(ir.textSizeData,$e.zoom),Wr=Ea(_r,1,q.transform.zoom),Cn=_o(qt.posMatrix,Ye,mt,q.transform,Wr),yn=oe.layout.get("icon-text-fit")!=="none"&&ir.hasIconData();if(Mr){var Hn=Math.pow(2,$e.zoom-_r.tileID.overscaledZ);rc(ir,mt,Ye,Je,y.symbolSize,$e,Cn,qt.posMatrix,Hn,Mr,yn)}}}}(g,c,f,p,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&Pc(c,p,f,g,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),I,O),f.paint.get("text-opacity").constantOr(1)!==0&&Pc(c,p,f,g,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),I,O),p.map.showCollisionBoxes&&(tc(c,p,f,g,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),tc(c,p,f,g,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,p,f,g){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),I=f.paint.get("circle-stroke-width"),O=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||I.constantOr(1)!==0&&O.constantOr(1)!==0){for(var q=c.context,oe=q.gl,Te=c.depthModeForSublayer(0,Oe.ReadOnly),Pe=qe.disabled,_e=c.colorModeForRenderPass(),Je=[],$e=0;$e<g.length;$e++){var mt=g[$e],Ye=p.getTile(mt),gt=Ye.getBucket(f);if(gt){var Pt=gt.programConfigurations.get(f.id),qt={programConfiguration:Pt,program:c.useProgram("circle",Pt),layoutVertexBuffer:gt.layoutVertexBuffer,indexBuffer:gt.indexBuffer,uniformValues:Ah(c,mt,Ye,f)};if(z)for(var _r=0,ir=gt.segments.get();_r<ir.length;_r+=1){var Mr=ir[_r];Je.push({segments:new y.SegmentVector([Mr]),sortKey:Mr.sortKey,state:qt})}else Je.push({segments:gt.segments,sortKey:0,state:qt})}}z&&Je.sort(function(xi,Si){return xi.sortKey-Si.sortKey});for(var Wr=0,Cn=Je;Wr<Cn.length;Wr+=1){var yn=Cn[Wr],Hn=yn.state;Hn.program.draw(q,oe.TRIANGLES,Te,Pe,_e,St.disabled,Hn.uniformValues,f.id,Hn.layoutVertexBuffer,Hn.indexBuffer,yn.segments,f.paint,c.transform.zoom,Hn.programConfiguration)}}}},heatmap:function(c,p,f,g){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,I=S.gl,O=qe.disabled,z=new ct([I.ONE,I.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Je,$e,mt){var Ye=Je.gl;Je.activeTexture.set(Ye.TEXTURE1),Je.viewport.set([0,0,$e.width/4,$e.height/4]);var gt=mt.heatmapFbo;if(gt)Ye.bindTexture(Ye.TEXTURE_2D,gt.colorAttachment.get()),Je.bindFramebuffer.set(gt.framebuffer);else{var Pt=Ye.createTexture();Ye.bindTexture(Ye.TEXTURE_2D,Pt),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_S,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_WRAP_T,Ye.CLAMP_TO_EDGE),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MIN_FILTER,Ye.LINEAR),Ye.texParameteri(Ye.TEXTURE_2D,Ye.TEXTURE_MAG_FILTER,Ye.LINEAR),gt=mt.heatmapFbo=Je.createFramebuffer($e.width/4,$e.height/4,!1),function(qt,_r,ir,Mr){var Wr=qt.gl;Wr.texImage2D(Wr.TEXTURE_2D,0,Wr.RGBA,_r.width/4,_r.height/4,0,Wr.RGBA,qt.extRenderToTextureHalfFloat?qt.extTextureHalfFloat.HALF_FLOAT_OES:Wr.UNSIGNED_BYTE,null),Mr.colorAttachment.set(ir)}(Je,$e,Pt,gt)}})(S,c,f),S.clear({color:y.Color.transparent});for(var q=0;q<g.length;q++){var oe=g[q];if(!p.hasRenderableParent(oe)){var Te=p.getTile(oe),Pe=Te.getBucket(f);if(Pe){var _e=Pe.programConfigurations.get(f.id);c.useProgram("heatmap",_e).draw(S,I.TRIANGLES,Oe.disabled,O,z,St.disabled,Ul(oe.posMatrix,Te,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,f.paint,c.transform.zoom,_e)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(Je,$e){var mt=Je.context,Ye=mt.gl,gt=$e.heatmapFbo;if(gt){mt.activeTexture.set(Ye.TEXTURE0),Ye.bindTexture(Ye.TEXTURE_2D,gt.colorAttachment.get()),mt.activeTexture.set(Ye.TEXTURE1);var Pt=$e.colorRampTexture;Pt||(Pt=$e.colorRampTexture=new y.Texture(mt,$e.colorRamp,Ye.RGBA)),Pt.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),Je.useProgram("heatmapTexture").draw(mt,Ye.TRIANGLES,Oe.disabled,qe.disabled,Je.colorModeForRenderPass(),St.disabled,function(qt,_r,ir,Mr){var Wr=y.create();y.ortho(Wr,0,qt.width,qt.height,0,0,1);var Cn=qt.context.gl;return{u_matrix:Wr,u_world:[Cn.drawingBufferWidth,Cn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:_r.paint.get("heatmap-opacity")}}(Je,$e),$e.id,Je.viewportBuffer,Je.quadTriangleIndexBuffer,Je.viewportSegments,$e.paint,Je.transform.zoom)}}(c,f))},line:function(c,p,f,g){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),I=f.paint.get("line-width");if(S.constantOr(1)!==0&&I.constantOr(1)!==0)for(var O=c.depthModeForSublayer(0,Oe.ReadOnly),z=c.colorModeForRenderPass(),q=f.paint.get("line-dasharray"),oe=f.paint.get("line-pattern"),Te=oe.constantOr(1),Pe=f.paint.get("line-gradient"),_e=f.getCrossfadeParameters(),Je=Te?"linePattern":q?"lineSDF":Pe?"lineGradient":"line",$e=c.context,mt=$e.gl,Ye=!0,gt=0,Pt=g;gt<Pt.length;gt+=1){var qt=Pt[gt],_r=p.getTile(qt);if(!Te||_r.patternsLoaded()){var ir=_r.getBucket(f);if(ir){var Mr=ir.programConfigurations.get(f.id),Wr=c.context.program.get(),Cn=c.useProgram(Je,Mr),yn=Ye||Cn.program!==Wr,Hn=oe.constantOr(null);if(Hn&&_r.imageAtlas){var xi=_r.imageAtlas,Si=xi.patternPositions[Hn.to.toString()],bi=xi.patternPositions[Hn.from.toString()];Si&&bi&&Mr.setConstantPatternPositions(Si,bi)}var Ca=Te?rl(c,_r,f,_e):q?$f(c,_r,f,q,_e):Pe?lo(c,_r,f,ir.lineClipsArray.length):bl(c,_r,f);if(Te)$e.activeTexture.set(mt.TEXTURE0),_r.imageAtlasTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),Mr.updatePaintBuffers(_e);else if(q&&(yn||c.lineAtlas.dirty))$e.activeTexture.set(mt.TEXTURE0),c.lineAtlas.bind($e);else if(Pe){var qn=ir.gradients[f.id],Hi=qn.texture;if(f.gradientVersion!==qn.version){var Qi=256;if(f.stepInterpolant){var Wi=p.getSource().maxzoom,Oi=qt.canonical.z===Wi?Math.ceil(1<<c.transform.maxZoom-qt.canonical.z):1;Qi=y.clamp(y.nextPowerOfTwo(ir.maxLineLength/y.EXTENT*1024*Oi),256,$e.maxTextureSize)}qn.gradient=y.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Qi,image:qn.gradient||void 0,clips:ir.lineClipsArray}),qn.texture?qn.texture.update(qn.gradient):qn.texture=new y.Texture($e,qn.gradient,mt.RGBA),qn.version=f.gradientVersion,Hi=qn.texture}$e.activeTexture.set(mt.TEXTURE0),Hi.bind(f.stepInterpolant?mt.NEAREST:mt.LINEAR,mt.CLAMP_TO_EDGE)}Cn.draw($e,mt.TRIANGLES,O,c.stencilModeForClipping(qt),z,St.disabled,Ca,f.id,ir.layoutVertexBuffer,ir.indexBuffer,ir.segments,f.paint,c.transform.zoom,Mr,ir.layoutVertexBuffer2),Ye=!1}}}}},fill:function(c,p,f,g){var S=f.paint.get("fill-color"),I=f.paint.get("fill-opacity");if(I.constantOr(1)!==0){var O=c.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),q=c.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===q){var oe=c.depthModeForSublayer(1,c.renderPass==="opaque"?Oe.ReadWrite:Oe.ReadOnly);nl(c,p,f,g,oe,O,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var Te=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,Oe.ReadOnly);nl(c,p,f,g,Te,O,!0)}}},"fill-extrusion":function(c,p,f,g){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var I=new Oe(c.context.gl.LEQUAL,Oe.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Ef(c,p,f,g,I,qe.disabled,ct.disabled),Ef(c,p,f,g,I,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var O=c.colorModeForRenderPass();Ef(c,p,f,g,I,qe.disabled,O)}}},hillshade:function(c,p,f,g){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,I=c.depthModeForSublayer(0,Oe.ReadOnly),O=c.colorModeForRenderPass(),z=c.renderPass==="translucent"?c.stencilConfigForOverlap(g):[{},g],q=z[0],oe=0,Te=z[1];oe<Te.length;oe+=1){var Pe=Te[oe],_e=p.getTile(Pe);_e.needsHillshadePrepare&&c.renderPass==="offscreen"?_p(c,_e,f,I,qe.disabled,O):c.renderPass==="translucent"&&kc(c,_e,f,I,q[Pe.overscaledZ],O)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,p,f,g){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&g.length)for(var S=c.context,I=S.gl,O=p.getSource(),z=c.useProgram("raster"),q=c.colorModeForRenderPass(),oe=O instanceof wt?[{},g]:c.stencilConfigForOverlap(g),Te=oe[0],Pe=oe[1],_e=Pe[Pe.length-1].overscaledZ,Je=!c.options.moving,$e=0,mt=Pe;$e<mt.length;$e+=1){var Ye=mt[$e],gt=c.depthModeForSublayer(Ye.overscaledZ-_e,f.paint.get("raster-opacity")===1?Oe.ReadWrite:Oe.ReadOnly,I.LESS),Pt=p.getTile(Ye),qt=c.transform.calculatePosMatrix(Ye.toUnwrapped(),Je);Pt.registerFadeDuration(f.paint.get("raster-fade-duration"));var _r=p.findLoadedParent(Ye,0),ir=Cf(Pt,_r,p,f,c.transform),Mr=void 0,Wr=void 0,Cn=f.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;S.activeTexture.set(I.TEXTURE0),Pt.texture.bind(Cn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(I.TEXTURE1),_r?(_r.texture.bind(Cn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),Mr=Math.pow(2,_r.tileID.overscaledZ-Pt.tileID.overscaledZ),Wr=[Pt.tileID.canonical.x*Mr%1,Pt.tileID.canonical.y*Mr%1]):Pt.texture.bind(Cn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var yn=Qd(qt,Wr||[0,0],Mr||1,ir,f);O instanceof wt?z.draw(S,I.TRIANGLES,gt,qe.disabled,q,St.disabled,yn,f.id,O.boundsBuffer,c.quadTriangleIndexBuffer,O.boundsSegments):z.draw(S,I.TRIANGLES,gt,Te[Ye.overscaledZ],q,St.disabled,yn,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,p,f){var g=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var I=c.context,O=I.gl,z=c.transform,q=z.tileSize,oe=f.paint.get("background-pattern");if(!c.isPatternMissing(oe)){var Te=!oe&&g.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===Te){var Pe=qe.disabled,_e=c.depthModeForSublayer(0,Te==="opaque"?Oe.ReadWrite:Oe.ReadOnly),Je=c.colorModeForRenderPass(),$e=c.useProgram(oe?"backgroundPattern":"background"),mt=z.coveringTiles({tileSize:q});oe&&(I.activeTexture.set(O.TEXTURE0),c.imageManager.bind(c.context));for(var Ye=f.getCrossfadeParameters(),gt=0,Pt=mt;gt<Pt.length;gt+=1){var qt=Pt[gt],_r=c.transform.calculatePosMatrix(qt.toUnwrapped()),ir=oe?ec(_r,S,c,oe,{tileID:qt,tileSize:q},Ye):xf(_r,S,g);$e.draw(I,O.TRIANGLES,_e,Pe,Je,St.disabled,ir,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,p,f){for(var g=0;g<f.length;g++)Eu(c,p,f[g])},custom:function(c,p,f){var g=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var I=S.prerender;I&&(c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),I.call(S,g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),g.setStencilMode(qe.disabled);var O=S.renderingMode==="3d"?new Oe(c.context.gl.LEQUAL,Oe.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Oe.ReadOnly);g.setDepthMode(O),S.render(g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState(),g.bindFramebuffer.set(null)}}},Ui=function(c,p){this.context=new ke(c),this.transform=p,this._tileTextures={},this.setup(),this.numSublayers=it.maxUnderzooming+it.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qs,this.gpuTimers={}};Ui.prototype.resize=function(c,p){if(this.width=c*y.browser.devicePixelRatio,this.height=p*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,g=this.style._order;f<g.length;f+=1)this.style._layers[g[f]].resize()},Ui.prototype.setup=function(){var c=this.context,p=new y.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(p,fa.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var f=new y.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(y.EXTENT,0),f.emplaceBack(0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=c.createVertexBuffer(f,fa.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(g,ht.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,fa.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var I=new y.StructArrayLayout1ui2;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(I);var O=new y.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(O),this.emptyTexture=new y.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var z=this.context.gl;this.stencilClearMode=new qe({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)},Ui.prototype.clearStencil=function(){var c=this.context,p=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=y.create();y.ortho(f,0,this.width,this.height,0,0,1),y.scale(f,f,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,p.TRIANGLES,Oe.disabled,this.stencilClearMode,ct.disabled,St.disabled,tl(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ui.prototype._renderTileClippingMasks=function(c,p){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&p&&p.length){this.currentStencilSource=c.source;var f=this.context,g=f.gl;this.nextStencilID+p.length>256&&this.clearStencil(),f.setColorMode(ct.disabled),f.setDepthMode(Oe.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var I=0,O=p;I<O.length;I+=1){var z=O[I],q=this._tileClippingMaskIDs[z.key]=this.nextStencilID++;S.draw(f,g.TRIANGLES,Oe.disabled,new qe({func:g.ALWAYS,mask:0},q,255,g.KEEP,g.KEEP,g.REPLACE),ct.disabled,St.disabled,tl(z.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ui.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,p=this.context.gl;return new qe({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)},Ui.prototype.stencilModeForClipping=function(c){var p=this.context.gl;return new qe({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)},Ui.prototype.stencilConfigForOverlap=function(c){var p,f=this.context.gl,g=c.sort(function(q,oe){return oe.overscaledZ-q.overscaledZ}),S=g[g.length-1].overscaledZ,I=g[0].overscaledZ-S+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();for(var O={},z=0;z<I;z++)O[z+S]=new qe({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=I,[O,g]}return[(p={},p[S]=qe.disabled,p),g]},Ui.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new ct([c.CONSTANT_COLOR,c.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ct.unblended:ct.alphaBlended},Ui.prototype.depthModeForSublayer=function(c,p,f){if(!this.opaquePassEnabledForLayer())return Oe.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Oe(f||this.context.gl.LEQUAL,p,[g,g])},Ui.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ui.prototype.render=function(c,p){var f=this;this.style=c,this.options=p,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var I in S){var O=S[I];O.used&&O.prepare(this.context)}var z,q,oe={},Te={},Pe={};for(var _e in S){var Je=S[_e];oe[_e]=Je.getVisibleCoordinates(),Te[_e]=oe[_e].slice().reverse(),Pe[_e]=Je.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var $e=0;$e<g.length;$e++)if(this.style._layers[g[$e]].is3D()){this.opaquePassCutoff=$e;break}this.renderPass="offscreen";for(var mt=0,Ye=g;mt<Ye.length;mt+=1){var gt=this.style._layers[Ye[mt]];if(gt.hasOffscreenPass()&&!gt.isHidden(this.transform.zoom)){var Pt=Te[gt.source];(gt.type==="custom"||Pt.length)&&this.renderLayer(this,S[gt.source],gt,Pt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var qt=this.style._layers[g[this.currentLayer]],_r=S[qt.source],ir=oe[qt.source];this._renderTileClippingMasks(qt,ir),this.renderLayer(this,_r,qt,ir)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var Mr=this.style._layers[g[this.currentLayer]],Wr=S[Mr.source],Cn=(Mr.type==="symbol"?Pe:Te)[Mr.source];this._renderTileClippingMasks(Mr,oe[Mr.source]),this.renderLayer(this,Wr,Mr,Cn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(yn){yn.source&&!yn.isHidden(f.transform.zoom)&&(yn.source!==(q&&q.id)&&(q=f.style.sourceCaches[yn.source]),(!z||z.getSource().maxzoom<q.getSource().maxzoom)&&(z=q))}),z&&ef.debug(this,z,z.getVisibleCoordinates())),this.options.showPadding&&function(yn){var Hn=yn.transform.padding;Hp(yn,yn.transform.height-(Hn.top||0),3,ic),Hp(yn,Hn.bottom||0,3,qh),Th(yn,Hn.left||0,3,Sf),Th(yn,yn.transform.width-(Hn.right||0),3,Af);var xi=yn.transform.centerPoint;(function(Si,bi,Ca,qn){Jc(Si,bi-1,Ca-10,2,20,qn),Jc(Si,bi-10,Ca-1,20,2,qn)})(yn,xi.x,yn.transform.height-xi.y,Gp)}(this),this.context.setDefault()},Ui.prototype.renderLayer=function(c,p,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||g.length)&&(this.id=f.id,this.gpuTimingStart(f),ef[f.type](c,p,f,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ui.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var p=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),f.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,f.query)}},Ui.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ui.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ui.prototype.queryGpuTimers=function(c){var p={};for(var f in c){var g=c[f],S=this.context.extTimerQuery,I=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),p[f]=I}return p},Ui.prototype.translatePosMatrix=function(c,p,f,g,S){if(!f[0]&&!f[1])return c;var I=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(I){var O=Math.sin(I),z=Math.cos(I);f=[f[0]*z-f[1]*O,f[0]*O+f[1]*z]}var q=[S?f[0]:Ea(p,f[0],this.transform.zoom),S?f[1]:Ea(p,f[1],this.transform.zoom),0],oe=new Float32Array(16);return y.translate(oe,c,q),oe},Ui.prototype.saveTileTexture=function(c){var p=this._tileTextures[c.size[0]];p?p.push(c):this._tileTextures[c.size[0]]=[c]},Ui.prototype.getTileTexture=function(c){var p=this._tileTextures[c];return p&&p.length>0?p.pop():null},Ui.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var p=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!p||!f},Ui.prototype.useProgram=function(c,p){this.cache=this.cache||{};var f=""+c+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Qc(this.context,c,Hs[c],p,bf[c],this._showOverdrawInspector)),this.cache[f]},Ui.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ui.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ui.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ui.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var wf=function(c,p){this.points=c,this.planes=p};wf.fromInvProjectionMatrix=function(c,p,f){var g=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(O){return y.transformMat4([],O,c)}).map(function(O){return y.scale$1([],O,1/O[3]/p*g)}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(O){var z=y.sub([],S[O[0]],S[O[1]]),q=y.sub([],S[O[2]],S[O[1]]),oe=y.normalize([],y.cross([],z,q)),Te=-y.dot(oe,S[O[1]]);return oe.concat(Te)});return new wf(S,I)};var Tf=function(c,p){this.min=c,this.max=p,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Tf.prototype.quadrant=function(c){for(var p=[c%2==0,c<2],f=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<p.length;S++)f[S]=p[S]?this.min[S]:this.center[S],g[S]=p[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Tf(f,g)},Tf.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Tf.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Tf.prototype.intersects=function(c){for(var p=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,g=0;g<c.planes.length;g++){for(var S=c.planes[g],I=0,O=0;O<p.length;O++)I+=y.dot$1(S,p[O])>=0;if(I===0)return 0;I!==p.length&&(f=!1)}if(f)return 2;for(var z=0;z<3;z++){for(var q=Number.MAX_VALUE,oe=-Number.MAX_VALUE,Te=0;Te<c.points.length;Te++){var Pe=c.points[Te][z]-this.min[z];q=Math.min(q,Pe),oe=Math.max(oe,Pe)}if(oe<0||q>this.max[z]-this.min[z])return 0}return 1};var El=function(c,p,f,g){if(c===void 0&&(c=0),p===void 0&&(p=0),f===void 0&&(f=0),g===void 0&&(g=0),isNaN(c)||c<0||isNaN(p)||p<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=f,this.right=g};El.prototype.interpolate=function(c,p,f){return p.top!=null&&c.top!=null&&(this.top=y.number(c.top,p.top,f)),p.bottom!=null&&c.bottom!=null&&(this.bottom=y.number(c.bottom,p.bottom,f)),p.left!=null&&c.left!=null&&(this.left=y.number(c.left,p.left,f)),p.right!=null&&c.right!=null&&(this.right=y.number(c.right,p.right,f)),this},El.prototype.getCenter=function(c,p){var f=y.clamp((this.left+c-this.right)/2,0,c),g=y.clamp((this.top+p-this.bottom)/2,0,p);return new y.Point(f,g)},El.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},El.prototype.clone=function(){return new El(this.top,this.bottom,this.left,this.right)},El.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Aa=function(c,p,f,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=f==null?0:f,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new El,this._posMatrixCache={},this._alignedPosMatrixCache={}},bo={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Aa.prototype.clone=function(){var c=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},bo.minZoom.get=function(){return this._minZoom},bo.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},bo.maxZoom.get=function(){return this._maxZoom},bo.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},bo.minPitch.get=function(){return this._minPitch},bo.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},bo.maxPitch.get=function(){return this._maxPitch},bo.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},bo.renderWorldCopies.get=function(){return this._renderWorldCopies},bo.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},bo.worldSize.get=function(){return this.tileSize*this.scale},bo.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},bo.size.get=function(){return new y.Point(this.width,this.height)},bo.bearing.get=function(){return-this.angle/Math.PI*180},bo.bearing.set=function(c){var p=-y.wrap(c,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},bo.pitch.get=function(){return this._pitch/Math.PI*180},bo.pitch.set=function(c){var p=y.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())},bo.fov.get=function(){return this._fov/Math.PI*180},bo.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},bo.zoom.get=function(){return this._zoom},bo.zoom.set=function(c){var p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.scale=this.zoomScale(p),this.tileZoom=Math.floor(p),this.zoomFraction=p-this.tileZoom,this._constrain(),this._calcMatrices())},bo.center.get=function(){return this._center},bo.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},bo.padding.get=function(){return this._edgeInsets.toJSON()},bo.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},bo.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Aa.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Aa.prototype.interpolatePadding=function(c,p,f){this._unmodified=!1,this._edgeInsets.interpolate(c,p,f),this._constrain(),this._calcMatrices()},Aa.prototype.coveringZoomLevel=function(c){var p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)},Aa.prototype.getVisibleUnwrappedCoordinates=function(c){var p=[new y.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),I=this.pointCoordinate(new y.Point(0,this.height)),O=Math.floor(Math.min(f.x,g.x,S.x,I.x)),z=Math.floor(Math.max(f.x,g.x,S.x,I.x)),q=O-1;q<=z+1;q++)q!==0&&p.push(new y.UnwrappedTileID(q,c));return p},Aa.prototype.coveringTiles=function(c){var p=this.coveringZoomLevel(c),f=p;if(c.minzoom!==void 0&&p<c.minzoom)return[];c.maxzoom!==void 0&&p>c.maxzoom&&(p=c.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,p),I=[S*g.x,S*g.y,0],O=wf.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p),z=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(z=p);var q=function(yn){return{aabb:new Tf([yn*S,0,0],[(yn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:yn,fullyVisible:!1}},oe=[],Te=[],Pe=p,_e=c.reparseOverscaled?f:p;if(this._renderWorldCopies)for(var Je=1;Je<=3;Je++)oe.push(q(-Je)),oe.push(q(Je));for(oe.push(q(0));oe.length>0;){var $e=oe.pop(),mt=$e.x,Ye=$e.y,gt=$e.fullyVisible;if(!gt){var Pt=$e.aabb.intersects(O);if(Pt===0)continue;gt=Pt===2}var qt=$e.aabb.distanceX(I),_r=$e.aabb.distanceY(I),ir=Math.max(Math.abs(qt),Math.abs(_r));if($e.zoom===Pe||ir>3+(1<<Pe-$e.zoom)-2&&$e.zoom>=z)Te.push({tileID:new y.OverscaledTileID($e.zoom===Pe?_e:$e.zoom,$e.wrap,$e.zoom,mt,Ye),distanceSq:y.sqrLen([I[0]-.5-mt,I[1]-.5-Ye])});else for(var Mr=0;Mr<4;Mr++){var Wr=(mt<<1)+Mr%2,Cn=(Ye<<1)+(Mr>>1);oe.push({aabb:$e.aabb.quadrant(Mr),zoom:$e.zoom+1,x:Wr,y:Cn,wrap:$e.wrap,fullyVisible:gt})}}return Te.sort(function(yn,Hn){return yn.distanceSq-Hn.distanceSq}).map(function(yn){return yn.tileID})},Aa.prototype.resize=function(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()},bo.unmodified.get=function(){return this._unmodified},Aa.prototype.zoomScale=function(c){return Math.pow(2,c)},Aa.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Aa.prototype.project=function(c){var p=y.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(c.lng)*this.worldSize,y.mercatorYfromLat(p)*this.worldSize)},Aa.prototype.unproject=function(c){return new y.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},bo.point.get=function(){return this.project(this.center)},Aa.prototype.setLocationAtPoint=function(c,p){var f=this.pointCoordinate(p),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),I=new y.MercatorCoordinate(S.x-(f.x-g.x),S.y-(f.y-g.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())},Aa.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Aa.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Aa.prototype.locationCoordinate=function(c){return y.MercatorCoordinate.fromLngLat(c)},Aa.prototype.coordinateLocation=function(c){return c.toLngLat()},Aa.prototype.pointCoordinate=function(c){var p=[c.x,c.y,0,1],f=[c.x,c.y,1,1];y.transformMat4(p,p,this.pixelMatrixInverse),y.transformMat4(f,f,this.pixelMatrixInverse);var g=p[3],S=f[3],I=p[1]/g,O=f[1]/S,z=p[2]/g,q=f[2]/S,oe=z===q?0:(0-z)/(q-z);return new y.MercatorCoordinate(y.number(p[0]/g,f[0]/S,oe)/this.worldSize,y.number(I,O,oe)/this.worldSize)},Aa.prototype.coordinatePoint=function(c){var p=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(p,p,this.pixelMatrix),new y.Point(p[0]/p[3],p[1]/p[3])},Aa.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Aa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Aa.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Aa.prototype.calculatePosMatrix=function(c,p){p===void 0&&(p=!1);var f=c.key,g=p?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];var S=c.canonical,I=this.worldSize/this.zoomScale(S.z),O=S.x+Math.pow(2,S.z)*c.wrap,z=y.identity(new Float64Array(16));return y.translate(z,z,[O*I,S.y*I,0]),y.scale(z,z,[I/y.EXTENT,I/y.EXTENT,1]),y.multiply(z,p?this.alignedProjMatrix:this.projMatrix,z),g[f]=new Float32Array(z),g[f]},Aa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Aa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,p,f,g,S=-90,I=90,O=-180,z=180,q=this.size,oe=this._unmodified;if(this.latRange){var Te=this.latRange;S=y.mercatorYfromLat(Te[1])*this.worldSize,c=(I=y.mercatorYfromLat(Te[0])*this.worldSize)-S<q.y?q.y/(I-S):0}if(this.lngRange){var Pe=this.lngRange;O=y.mercatorXfromLng(Pe[0])*this.worldSize,p=(z=y.mercatorXfromLng(Pe[1])*this.worldSize)-O<q.x?q.x/(z-O):0}var _e=this.point,Je=Math.max(p||0,c||0);if(Je)return this.center=this.unproject(new y.Point(p?(z+O)/2:_e.x,c?(I+S)/2:_e.y)),this.zoom+=this.scaleZoom(Je),this._unmodified=oe,void(this._constraining=!1);if(this.latRange){var $e=_e.y,mt=q.y/2;$e-mt<S&&(g=S+mt),$e+mt>I&&(g=I-mt)}if(this.lngRange){var Ye=_e.x,gt=q.x/2;Ye-gt<O&&(f=O+gt),Ye+gt>z&&(f=z-gt)}f===void 0&&g===void 0||(this.center=this.unproject(new y.Point(f!==void 0?f:_e.x,g!==void 0?g:_e.y))),this._unmodified=oe,this._constraining=!1}},Aa.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var p=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),g=Math.sin(f)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-p-f,.01,Math.PI-.01)),S=this.point,I=S.x,O=S.y,z=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),q=this.height/50,oe=new Float64Array(16);y.perspective(oe,this._fov,this.width/this.height,q,z),oe[8]=2*-c.x/this.width,oe[9]=2*c.y/this.height,y.scale(oe,oe,[1,-1,1]),y.translate(oe,oe,[0,0,-this.cameraToCenterDistance]),y.rotateX(oe,oe,this._pitch),y.rotateZ(oe,oe,this.angle),y.translate(oe,oe,[-I,-O,0]),this.mercatorMatrix=y.scale([],oe,[this.worldSize,this.worldSize,this.worldSize]),y.scale(oe,oe,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=oe,this.invProjMatrix=y.invert([],this.projMatrix);var Te=this.width%2/2,Pe=this.height%2/2,_e=Math.cos(this.angle),Je=Math.sin(this.angle),$e=I-Math.round(I)+_e*Te+Je*Pe,mt=O-Math.round(O)+_e*Pe+Je*Te,Ye=new Float64Array(oe);if(y.translate(Ye,Ye,[$e>.5?$e-1:$e,mt>.5?mt-1:mt,0]),this.alignedProjMatrix=Ye,oe=y.create(),y.scale(oe,oe,[this.width/2,-this.height/2,1]),y.translate(oe,oe,[1,-1,0]),this.labelPlaneMatrix=oe,oe=y.create(),y.scale(oe,oe,[1,-1,1]),y.translate(oe,oe,[-1,-1,0]),y.scale(oe,oe,[2/this.width,2/this.height,1]),this.glCoordMatrix=oe,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(oe=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=oe,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Aa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new y.Point(0,0)),p=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance},Aa.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,c))},Aa.prototype.getCameraQueryGeometry=function(c){var p=this.getCameraPoint();if(c.length===1)return[c[0],p];for(var f=p.x,g=p.y,S=p.x,I=p.y,O=0,z=c;O<z.length;O+=1){var q=z[O];f=Math.min(f,q.x),g=Math.min(g,q.y),S=Math.max(S,q.x),I=Math.max(I,q.y)}return[new y.Point(f,g),new y.Point(S,g),new y.Point(S,I),new y.Point(f,I),new y.Point(f,g)]},Object.defineProperties(Aa.prototype,bo);var cu=function(c){var p,f,g,S;this._hashName=c&&encodeURIComponent(c),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(p=this._updateHashUnthrottled.bind(this),f=!1,g=null,S=function(){g=null,f&&(p(),g=setTimeout(S,300),f=!1)},function(){return f=!0,g||S(),g})};cu.prototype.addTo=function(c){return this._map=c,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},cu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},cu.prototype.getHashString=function(c){var p=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),I=Math.round(p.lng*S)/S,O=Math.round(p.lat*S)/S,z=this._map.getBearing(),q=this._map.getPitch(),oe="";if(oe+=c?"/"+I+"/"+O+"/"+f:f+"/"+O+"/"+I,(z||q)&&(oe+="/"+Math.round(10*z)/10),q&&(oe+="/"+Math.round(q)),this._hashName){var Te=this._hashName,Pe=!1,_e=y.window.location.hash.slice(1).split("&").map(function(Je){var $e=Je.split("=")[0];return $e===Te?(Pe=!0,$e+"="+oe):Je}).filter(function(Je){return Je});return Pe||_e.push(Te+"="+oe),"#"+_e.join("&")}return"#"+oe},cu.prototype._getCurrentHash=function(){var c,p=this,f=y.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===p._hashName&&(c=g)}),(c&&c[1]||"").split("/")):f.split("/")},cu.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1},cu.prototype._updateHashUnthrottled=function(){var c=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,c)}catch(p){}};var Mo={linearity:.3,easing:y.bezier(0,0,.3,1)},ku=y.extend({deceleration:2500,maxSpeed:1400},Mo),Zl=y.extend({deceleration:20,maxSpeed:1400},Mo),fu=y.extend({deceleration:1e3,maxSpeed:360},Mo),Wp=y.extend({deceleration:1e3,maxSpeed:90},Mo),Qf=function(c){this._map=c,this.clear()};function Mf(c,p){(!c.duration||c.duration<p.duration)&&(c.duration=p.duration,c.easing=p.easing)}function Vl(c,p,f){var g=f.maxSpeed,S=f.linearity,I=f.deceleration,O=y.clamp(c*S/(p/1e3),-g,g),z=Math.abs(O)/(I*S);return{easing:f.easing,duration:1e3*z,amount:O*(z/2)}}Qf.prototype.clear=function(){this._inertiaBuffer=[]},Qf.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:c})},Qf.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,p=y.browser.now();c.length>0&&p-c[0].time>160;)c.shift()},Qf.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var p={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},f=0,g=this._inertiaBuffer;f<g.length;f+=1){var S=g[f].settings;p.zoom+=S.zoomDelta||0,p.bearing+=S.bearingDelta||0,p.pitch+=S.pitchDelta||0,S.panDelta&&p.pan._add(S.panDelta),S.around&&(p.around=S.around),S.pinchAround&&(p.pinchAround=S.pinchAround)}var I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(p.pan.mag()){var z=Vl(p.pan.mag(),I,y.extend({},ku,c||{}));O.offset=p.pan.mult(z.amount/p.pan.mag()),O.center=this._map.transform.center,Mf(O,z)}if(p.zoom){var q=Vl(p.zoom,I,Zl);O.zoom=this._map.transform.zoom+q.amount,Mf(O,q)}if(p.bearing){var oe=Vl(p.bearing,I,fu);O.bearing=this._map.transform.bearing+y.clamp(oe.amount,-179,179),Mf(O,oe)}if(p.pitch){var Te=Vl(p.pitch,I,Wp);O.pitch=this._map.transform.pitch+Te.amount,Mf(O,Te)}if(O.zoom||O.bearing){var Pe=p.pinchAround===void 0?p.around:p.pinchAround;O.around=Pe?this._map.unproject(Pe):this._map.getCenter()}return this.clear(),y.extend(O,{noMoveStart:!0})}};var ms=function(c){function p(g,S,I,O){O===void 0&&(O={});var z=K.mousePos(S.getCanvasContainer(),I),q=S.unproject(z);c.call(this,g,y.extend({point:z,lngLat:q,originalEvent:I},O)),this._defaultPrevented=!1,this.target=S}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),il=function(c){function p(g,S,I){var O=g==="touchend"?I.changedTouches:I.touches,z=K.touchPos(S.getCanvasContainer(),O),q=z.map(function(Pe){return S.unproject(Pe)}),oe=z.reduce(function(Pe,_e,Je,$e){return Pe.add(_e.div($e.length))},new y.Point(0,0)),Te=S.unproject(oe);c.call(this,g,{points:z,point:oe,lngLats:q,lngLat:Te,originalEvent:I}),this._defaultPrevented=!1}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),Jf=function(c){function p(g,S,I){c.call(this,g,{originalEvent:I}),this._defaultPrevented=!1}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),Wo=function(c,p){this._map=c,this._clickTolerance=p.clickTolerance};Wo.prototype.reset=function(){delete this._mousedownPos},Wo.prototype.wheel=function(c){return this._firePreventable(new Jf(c.type,this._map,c))},Wo.prototype.mousedown=function(c,p){return this._mousedownPos=p,this._firePreventable(new ms(c.type,this._map,c))},Wo.prototype.mouseup=function(c){this._map.fire(new ms(c.type,this._map,c))},Wo.prototype.click=function(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ms(c.type,this._map,c))},Wo.prototype.dblclick=function(c){return this._firePreventable(new ms(c.type,this._map,c))},Wo.prototype.mouseover=function(c){this._map.fire(new ms(c.type,this._map,c))},Wo.prototype.mouseout=function(c){this._map.fire(new ms(c.type,this._map,c))},Wo.prototype.touchstart=function(c){return this._firePreventable(new il(c.type,this._map,c))},Wo.prototype.touchmove=function(c){this._map.fire(new il(c.type,this._map,c))},Wo.prototype.touchend=function(c){this._map.fire(new il(c.type,this._map,c))},Wo.prototype.touchcancel=function(c){this._map.fire(new il(c.type,this._map,c))},Wo.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Wo.prototype.isEnabled=function(){return!0},Wo.prototype.isActive=function(){return!1},Wo.prototype.enable=function(){},Wo.prototype.disable=function(){};var ni=function(c){this._map=c};ni.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ni.prototype.mousemove=function(c){this._map.fire(new ms(c.type,this._map,c))},ni.prototype.mousedown=function(){this._delayContextMenu=!0},ni.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ni.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ms(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},ni.prototype.isEnabled=function(){return!0},ni.prototype.isActive=function(){return!1},ni.prototype.enable=function(){},ni.prototype.disable=function(){};var va=function(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1};function Lc(c,p){for(var f={},g=0;g<c.length;g++)f[c[g].identifier]=p[g];return f}va.prototype.isEnabled=function(){return!!this._enabled},va.prototype.isActive=function(){return!!this._active},va.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},va.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},va.prototype.mousedown=function(c,p){this.isEnabled()&&c.shiftKey&&c.button===0&&(K.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)},va.prototype.mousemoveWindow=function(c,p){if(this._active){var f=p;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=f,this._box||(this._box=K.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(g.x,f.x),I=Math.max(g.x,f.x),O=Math.min(g.y,f.y),z=Math.max(g.y,f.y);K.setTransform(this._box,"translate("+S+"px,"+O+"px)"),this._box.style.width=I-S+"px",this._box.style.height=z-O+"px"}}},va.prototype.mouseupWindow=function(c,p){var f=this;if(this._active&&c.button===0){var g=this._startPos,S=p;if(this.reset(),K.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(I){return I.fitScreenCoordinates(g,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},va.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},va.prototype.blur=function(){this.reset()},va.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos},va.prototype._fireEvent=function(c,p){return this._map.fire(new y.Event(c,{originalEvent:p}))};var If=function(c){this.reset(),this.numTouches=c.numTouches};If.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},If.prototype.touchstart=function(c,p,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),I=0,O=g;I<O.length;I+=1)S._add(O[I]);return S.div(g.length)}(p),this.touches=Lc(f,p)))},If.prototype.touchmove=function(c,p,f){if(!this.aborted&&this.centroid){var g=Lc(f,p);for(var S in this.touches){var I=g[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}},If.prototype.touchend=function(c,p,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var Lu=function(c){this.singleTap=new If(c),this.numTaps=c.numTaps,this.reset()};Lu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Lu.prototype.touchstart=function(c,p,f){this.singleTap.touchstart(c,p,f)},Lu.prototype.touchmove=function(c,p,f){this.singleTap.touchmove(c,p,f)},Lu.prototype.touchend=function(c,p,f){var g=this.singleTap.touchend(c,p,f);if(g){var S=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(S&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var Ou=function(){this._zoomIn=new Lu({numTouches:1,numTaps:2}),this._zoomOut=new Lu({numTouches:2,numTaps:1}),this.reset()};Ou.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ou.prototype.touchstart=function(c,p,f){this._zoomIn.touchstart(c,p,f),this._zoomOut.touchstart(c,p,f)},Ou.prototype.touchmove=function(c,p,f){this._zoomIn.touchmove(c,p,f),this._zoomOut.touchmove(c,p,f)},Ou.prototype.touchend=function(c,p,f){var g=this,S=this._zoomIn.touchend(c,p,f),I=this._zoomOut.touchend(c,p,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(S)},{originalEvent:c})}}):I?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(I)},{originalEvent:c})}}):void 0},Ou.prototype.touchcancel=function(){this.reset()},Ou.prototype.enable=function(){this._enabled=!0},Ou.prototype.disable=function(){this._enabled=!1,this.reset()},Ou.prototype.isEnabled=function(){return this._enabled},Ou.prototype.isActive=function(){return this._active};var Oc={0:1,2:2},In=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};In.prototype.blur=function(){this.reset()},In.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},In.prototype._correctButton=function(c,p){return!1},In.prototype._move=function(c,p){return{}},In.prototype.mousedown=function(c,p){if(!this._lastPoint){var f=K.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=p,this._eventButton=f)}},In.prototype.mousemoveWindow=function(c,p){var f=this._lastPoint;if(f){if(c.preventDefault(),function(g,S){var I=Oc[S];return g.buttons===void 0||(g.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(f,p)}},In.prototype.mouseupWindow=function(c){this._lastPoint&&K.mouseButton(c)===this._eventButton&&(this._moved&&K.suppressClick(),this.reset())},In.prototype.enable=function(){this._enabled=!0},In.prototype.disable=function(){this._enabled=!1,this.reset()},In.prototype.isEnabled=function(){return this._enabled},In.prototype.isActive=function(){return this._active};var Rc=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.mousedown=function(f,g){c.prototype.mousedown.call(this,f,g),this._lastPoint&&(this._active=!0)},p.prototype._correctButton=function(f,g){return g===0&&!f.ctrlKey},p.prototype._move=function(f,g){return{around:g,panDelta:g.sub(f)}},p}(In),Mh=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},p.prototype._move=function(f,g){var S=.8*(g.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},p.prototype.contextmenu=function(f){f.preventDefault()},p}(In),xa=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},p.prototype._move=function(f,g){var S=-.5*(g.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},p.prototype.contextmenu=function(f){f.preventDefault()},p}(In),ho=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};ho.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},ho.prototype.touchstart=function(c,p,f){return this._calculateTransform(c,p,f)},ho.prototype.touchmove=function(c,p,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,p,f)},ho.prototype.touchend=function(c,p,f){this._calculateTransform(c,p,f),this._active&&f.length<this._minTouches&&this.reset()},ho.prototype.touchcancel=function(){this.reset()},ho.prototype._calculateTransform=function(c,p,f){f.length>0&&(this._active=!0);var g=Lc(f,p),S=new y.Point(0,0),I=new y.Point(0,0),O=0;for(var z in g){var q=g[z],oe=this._touches[z];oe&&(S._add(q),I._add(q.sub(oe)),O++,g[z]=q)}if(this._touches=g,!(O<this._minTouches)&&I.mag()){var Te=I.div(O);if(this._sum._add(Te),!(this._sum.mag()<this._clickTolerance))return{around:S.div(O),panDelta:Te}}},ho.prototype.enable=function(){this._enabled=!0},ho.prototype.disable=function(){this._enabled=!1,this.reset()},ho.prototype.isEnabled=function(){return this._enabled},ho.prototype.isActive=function(){return this._active};var hu=function(){this.reset()};function Ih(c,p,f){for(var g=0;g<c.length;g++)if(c[g].identifier===f)return p[g]}function al(c,p){return Math.log(c/p)/Math.LN2}hu.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},hu.prototype._start=function(c){},hu.prototype._move=function(c,p,f){return{}},hu.prototype.touchstart=function(c,p,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([p[0],p[1]]))},hu.prototype.touchmove=function(c,p,f){if(this._firstTwoTouches){c.preventDefault();var g=this._firstTwoTouches,S=g[1],I=Ih(f,p,g[0]),O=Ih(f,p,S);if(I&&O){var z=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],z,c)}}},hu.prototype.touchend=function(c,p,f){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],I=Ih(f,p,g[0]),O=Ih(f,p,S);I&&O||(this._active&&K.suppressClick(),this.reset())}},hu.prototype.touchcancel=function(){this.reset()},hu.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Js=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},p.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},p.prototype._move=function(f,g){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(al(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:al(this._distance,S),pinchAround:g}},p}(hu);function jl(c,p){return 180*c.angleWith(p)/Math.PI}var di=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},p.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},p.prototype._move=function(f,g){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jl(this._vector,S),pinchAround:g}},p.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var g=25/(Math.PI*this._minDiameter)*360,S=jl(f,this._startVector);return Math.abs(S)<g},p}(hu);function eh(c){return Math.abs(c.y)>Math.abs(c.x)}var xp=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},p.prototype._start=function(f){this._lastPoints=f,eh(f[0].sub(f[1]))&&(this._valid=!1)},p.prototype._move=function(f,g,S){var I=f[0].sub(this._lastPoints[0]),O=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(I,O,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(I.y+O.y)/2*-.5}},p.prototype.gestureBeginsVertically=function(f,g,S){if(this._valid!==void 0)return this._valid;var I=f.mag()>=2,O=g.mag()>=2;if(I||O){if(!I||!O)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var z=f.y>0==g.y>0;return eh(f)&&eh(g)&&z}},p}(hu),bp={panStep:100,bearingStep:15,pitchStep:10},ol=function(){var c=bp;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Ws(c){return c*(2-c)}ol.prototype.blur=function(){this.reset()},ol.prototype.reset=function(){this._active=!1},ol.prototype.keydown=function(c){var p=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,g=0,S=0,I=0,O=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?g=-1:(c.preventDefault(),I=-1);break;case 39:c.shiftKey?g=1:(c.preventDefault(),I=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),O=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(z){var q=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:Ws,zoom:f?Math.round(q)+f*(c.shiftKey?2:1):q,bearing:z.getBearing()+g*p._bearingStep,pitch:z.getPitch()+S*p._pitchStep,offset:[-I*p._panStep,-O*p._panStep],center:z.getCenter()},{originalEvent:c})}}}},ol.prototype.enable=function(){this._enabled=!0},ol.prototype.disable=function(){this._enabled=!1,this.reset()},ol.prototype.isEnabled=function(){return this._enabled},ol.prototype.isActive=function(){return this._active},ol.prototype.disableRotation=function(){this._rotationDisabled=!0},ol.prototype.enableRotation=function(){this._rotationDisabled=!1};var ua=function(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};ua.prototype.setZoomRate=function(c){this._defaultZoomRate=c},ua.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},ua.prototype.isEnabled=function(){return!!this._enabled},ua.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ua.prototype.isZooming=function(){return!!this._zooming},ua.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},ua.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ua.prototype.wheel=function(c){if(this.isEnabled()){var p=c.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=y.browser.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,p!==0&&p%4.000244140625==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(g*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}},ua.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},ua.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var p=K.mousePos(this._el,c);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(p)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ua.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var p=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?p.zoomScale(this._targetZoom):p.scale;this._targetZoom=Math.min(p.maxZoom,Math.max(p.minZoom,p.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=p.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var I,O=typeof this._targetZoom=="number"?this._targetZoom:p.zoom,z=this._startZoom,q=this._easing,oe=!1;if(this._type==="wheel"&&z&&q){var Te=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Pe=q(Te);I=y.number(z,O,Pe),Te<1?this._frameId||(this._frameId=!0):oe=!0}else I=O,oe=!0;return this._active=!0,oe&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!oe,zoomDelta:I-p.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ua.prototype._smoothOutEasing=function(c){var p=y.ease;if(this._prevEase){var f=this._prevEase,g=(y.browser.now()-f.start)/f.duration,S=f.easing(g+.01)-f.easing(g),I=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-I*I);p=y.bezier(I,O,.25,1)}return this._prevEase={start:y.browser.now(),duration:c,easing:p},p},ua.prototype.blur=function(){this.reset()},ua.prototype.reset=function(){this._active=!1};var Cl=function(c,p){this._clickZoom=c,this._tapZoom=p};Cl.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Cl.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Cl.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Cl.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pu=function(){this.reset()};pu.prototype.reset=function(){this._active=!1},pu.prototype.blur=function(){this.reset()},pu.prototype.dblclick=function(c,p){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(p)},{originalEvent:c})}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active};var Ss=function(){this._tap=new Lu({numTouches:1,numTaps:1}),this.reset()};Ss.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ss.prototype.touchstart=function(c,p,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=p[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,p,f))},Ss.prototype.touchmove=function(c,p,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var g=p[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,p,f)},Ss.prototype.touchend=function(c,p,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,p,f)&&(this._tapTime=c.timeStamp)},Ss.prototype.touchcancel=function(){this.reset()},Ss.prototype.enable=function(){this._enabled=!0},Ss.prototype.disable=function(){this._enabled=!1,this.reset()},Ss.prototype.isEnabled=function(){return this._enabled},Ss.prototype.isActive=function(){return this._active};var Pf=function(c,p,f){this._el=c,this._mousePan=p,this._touchPan=f};Pf.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Pf.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Pf.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Pf.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Gl=function(c,p,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=f};Gl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Gl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Gl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Gl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var sl=function(c,p,f,g){this._el=c,this._touchZoom=p,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};sl.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},sl.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},sl.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},sl.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},sl.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},sl.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var du=function(c){return c.zoom||c.drag||c.pitch||c.rotate},ul=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p}(y.Event);function _i(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var pi=function(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qf(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p),y.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var I=S[g],O=I[0];K.addEventListener(O,I[1],O===y.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};pi.prototype.destroy=function(){for(var c=0,p=this._listeners;c<p.length;c+=1){var f=p[c],g=f[0];K.removeEventListener(g,f[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},pi.prototype._addDefaultHandlers=function(c){var p=this._map,f=p.getCanvasContainer();this._add("mapEvent",new Wo(p,c));var g=p.boxZoom=new va(p,c);this._add("boxZoom",g);var S=new Ou,I=new pu;p.doubleClickZoom=new Cl(I,S),this._add("tapZoom",S),this._add("clickZoom",I);var O=new Ss;this._add("tapDragZoom",O);var z=p.touchPitch=new xp;this._add("touchPitch",z);var q=new Mh(c),oe=new xa(c);p.dragRotate=new Gl(c,q,oe),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",oe,["mouseRotate"]);var Te=new Rc(c),Pe=new ho(c);p.dragPan=new Pf(f,Te,Pe),this._add("mousePan",Te),this._add("touchPan",Pe,["touchZoom","touchRotate"]);var _e=new di,Je=new Js;p.touchZoomRotate=new sl(f,Je,_e,O),this._add("touchRotate",_e,["touchPan","touchZoom"]),this._add("touchZoom",Je,["touchPan","touchRotate"]);var $e=p.scrollZoom=new ua(p,this);this._add("scrollZoom",$e,["mousePan"]);var mt=p.keyboard=new ol;this._add("keyboard",mt),this._add("blockableMapEvent",new ni(p));for(var Ye=0,gt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ye<gt.length;Ye+=1){var Pt=gt[Ye];c.interactive&&c[Pt]&&p[Pt].enable(c[Pt])}},pi.prototype._add=function(c,p,f){this._handlers.push({handlerName:c,handler:p,allowed:f}),this._handlersById[c]=p},pi.prototype.stop=function(c){if(!this._updatingCamera){for(var p=0,f=this._handlers;p<f.length;p+=1)f[p].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},pi.prototype.isActive=function(){for(var c=0,p=this._handlers;c<p.length;c+=1)if(p[c].handler.isActive())return!0;return!1},pi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},pi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},pi.prototype.isMoving=function(){return Boolean(du(this._eventsInProgress))||this.isZooming()},pi.prototype._blockedByActive=function(c,p,f){for(var g in c)if(g!==f&&(!p||p.indexOf(g)<0))return!0;return!1},pi.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},pi.prototype._getMapTouches=function(c){for(var p=[],f=0,g=c;f<g.length;f+=1){var S=g[f];this._el.contains(S.target)&&p.push(S)}return p},pi.prototype.handleEvent=function(c,p){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,g={needsRenderFrame:!1},S={},I={},O=c.touches?this._getMapTouches(c.touches):void 0,z=O?K.touchPos(this._el,O):K.mousePos(this._el,c),q=0,oe=this._handlers;q<oe.length;q+=1){var Te=oe[q],Pe=Te.handlerName,_e=Te.handler,Je=Te.allowed;if(_e.isEnabled()){var $e=void 0;this._blockedByActive(I,Je,Pe)?_e.reset():_e[p||c.type]&&($e=_e[p||c.type](c,z,O),this.mergeHandlerResult(g,S,$e,Pe,f),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||_e.isActive())&&(I[Pe]=_e)}}var mt={};for(var Ye in this._previousActiveHandlers)I[Ye]||(mt[Ye]=f);this._previousActiveHandlers=I,(Object.keys(mt).length||_i(g))&&(this._changes.push([g,S,mt]),this._triggerRenderFrame()),(Object.keys(I).length||_i(g))&&this._map._stop(!0),this._updatingCamera=!1;var gt=g.cameraAnimation;gt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],gt(this._map))},pi.prototype.mergeHandlerResult=function(c,p,f,g,S){if(f){y.extend(c,f);var I={handlerName:g,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(p.zoom=I),f.panDelta!==void 0&&(p.drag=I),f.pitchDelta!==void 0&&(p.pitch=I),f.bearingDelta!==void 0&&(p.rotate=I)}},pi.prototype._applyChanges=function(){for(var c={},p={},f={},g=0,S=this._changes;g<S.length;g+=1){var I=S[g],O=I[0],z=I[1],q=I[2];O.panDelta&&(c.panDelta=(c.panDelta||new y.Point(0,0))._add(O.panDelta)),O.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(c.around=O.around),O.pinchAround!==void 0&&(c.pinchAround=O.pinchAround),O.noInertia&&(c.noInertia=O.noInertia),y.extend(p,z),y.extend(f,q)}this._updateMapTransform(c,p,f),this._changes=[]},pi.prototype._updateMapTransform=function(c,p,f){var g=this._map,S=g.transform;if(!_i(c))return this._fireEvents(p,f,!0);var I=c.panDelta,O=c.zoomDelta,z=c.bearingDelta,q=c.pitchDelta,oe=c.around,Te=c.pinchAround;Te!==void 0&&(oe=Te),g._stop(!0),oe=oe||g.transform.centerPoint;var Pe=S.pointLocation(I?oe.sub(I):oe);z&&(S.bearing+=z),q&&(S.pitch+=q),O&&(S.zoom+=O),S.setLocationAtPoint(Pe,oe),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,f,!0)},pi.prototype._fireEvents=function(c,p,f){var g=this,S=du(this._eventsInProgress),I=du(c),O={};for(var z in c)this._eventsInProgress[z]||(O[z+"start"]=c[z].originalEvent),this._eventsInProgress[z]=c[z];for(var q in!S&&I&&this._fireEvent("movestart",I.originalEvent),O)this._fireEvent(q,O[q]);for(var oe in I&&this._fireEvent("move",I.originalEvent),c)this._fireEvent(oe,c[oe].originalEvent);var Te,Pe={};for(var _e in this._eventsInProgress){var Je=this._eventsInProgress[_e],$e=Je.handlerName,mt=Je.originalEvent;this._handlersById[$e].isActive()||(delete this._eventsInProgress[_e],Pe[_e+"end"]=Te=p[$e]||mt)}for(var Ye in Pe)this._fireEvent(Ye,Pe[Ye]);var gt=du(this._eventsInProgress);if(f&&(S||I)&&!gt){this._updatingCamera=!0;var Pt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),qt=function(_r){return _r!==0&&-g._bearingSnap<_r&&_r<g._bearingSnap};Pt?(qt(Pt.bearing||this._map.getBearing())&&(Pt.bearing=0),this._map.easeTo(Pt,{originalEvent:Te})):(this._map.fire(new y.Event("moveend",{originalEvent:Te})),qt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},pi.prototype._fireEvent=function(c,p){this._map.fire(new y.Event(c,p?{originalEvent:p}:{}))},pi.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(p){delete c._frameId,c.handleEvent(new ul("renderFrame",{timeStamp:p})),c._applyChanges()})},pi.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var kf=function(c){function p(f,g){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},p.prototype.setCenter=function(f,g){return this.jumpTo({center:f},g)},p.prototype.panBy=function(f,g,S){return f=y.Point.convert(f).mult(-1),this.panTo(this.transform.center,y.extend({offset:f},g),S)},p.prototype.panTo=function(f,g,S){return this.easeTo(y.extend({center:f},g),S)},p.prototype.getZoom=function(){return this.transform.zoom},p.prototype.setZoom=function(f,g){return this.jumpTo({zoom:f},g),this},p.prototype.zoomTo=function(f,g,S){return this.easeTo(y.extend({zoom:f},g),S)},p.prototype.zoomIn=function(f,g){return this.zoomTo(this.getZoom()+1,f,g),this},p.prototype.zoomOut=function(f,g){return this.zoomTo(this.getZoom()-1,f,g),this},p.prototype.getBearing=function(){return this.transform.bearing},p.prototype.setBearing=function(f,g){return this.jumpTo({bearing:f},g),this},p.prototype.getPadding=function(){return this.transform.padding},p.prototype.setPadding=function(f,g){return this.jumpTo({padding:f},g),this},p.prototype.rotateTo=function(f,g,S){return this.easeTo(y.extend({bearing:f},g),S)},p.prototype.resetNorth=function(f,g){return this.rotateTo(0,y.extend({duration:1e3},f),g),this},p.prototype.resetNorthPitch=function(f,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},f),g),this},p.prototype.snapToNorth=function(f,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,g):this},p.prototype.getPitch=function(){return this.transform.pitch},p.prototype.setPitch=function(f,g){return this.jumpTo({pitch:f},g),this},p.prototype.cameraForBounds=function(f,g){f=y.LngLatBounds.convert(f);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,g)},p.prototype._cameraForBoxAndBearing=function(f,g,S,I){var O={top:0,bottom:0,right:0,left:0};if(typeof(I=y.extend({padding:O,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){var z=I.padding;I.padding={top:z,bottom:z,right:z,left:z}}I.padding=y.extend(O,I.padding);var q=this.transform,oe=q.padding,Te=q.project(y.LngLat.convert(f)),Pe=q.project(y.LngLat.convert(g)),_e=Te.rotate(-S*Math.PI/180),Je=Pe.rotate(-S*Math.PI/180),$e=new y.Point(Math.max(_e.x,Je.x),Math.max(_e.y,Je.y)),mt=new y.Point(Math.min(_e.x,Je.x),Math.min(_e.y,Je.y)),Ye=$e.sub(mt),gt=(q.width-(oe.left+oe.right+I.padding.left+I.padding.right))/Ye.x,Pt=(q.height-(oe.top+oe.bottom+I.padding.top+I.padding.bottom))/Ye.y;if(!(Pt<0||gt<0)){var qt=Math.min(q.scaleZoom(q.scale*Math.min(gt,Pt)),I.maxZoom),_r=typeof I.offset.x=="number"?new y.Point(I.offset.x,I.offset.y):y.Point.convert(I.offset),ir=new y.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),Mr=_r.add(ir).mult(q.scale/q.zoomScale(qt));return{center:q.unproject(Te.add(Pe).div(2).sub(Mr)),zoom:qt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},p.prototype.fitBounds=function(f,g,S){return this._fitInternal(this.cameraForBounds(f,g),g,S)},p.prototype.fitScreenCoordinates=function(f,g,S,I,O){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(f)),this.transform.pointLocation(y.Point.convert(g)),S,I),I,O)},p.prototype._fitInternal=function(f,g,S){return f?(delete(g=y.extend(f,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},p.prototype.jumpTo=function(f,g){this.stop();var S=this.transform,I=!1,O=!1,z=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(I=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=y.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(O=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(z=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),I&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),O&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),z&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},p.prototype.easeTo=function(f,g){var S=this;this._stop(!1,f.easeId),((f=y.extend({offset:[0,0],duration:500,easing:y.ease},f)).animate===!1||!f.essential&&y.browser.prefersReducedMotion)&&(f.duration=0);var I=this.transform,O=this.getZoom(),z=this.getBearing(),q=this.getPitch(),oe=this.getPadding(),Te="zoom"in f?+f.zoom:O,Pe="bearing"in f?this._normalizeBearing(f.bearing,z):z,_e="pitch"in f?+f.pitch:q,Je="padding"in f?f.padding:I.padding,$e=y.Point.convert(f.offset),mt=I.centerPoint.add($e),Ye=I.pointLocation(mt),gt=y.LngLat.convert(f.center||Ye);this._normalizeCenter(gt);var Pt,qt,_r=I.project(Ye),ir=I.project(gt).sub(_r),Mr=I.zoomScale(Te-O);f.around&&(Pt=y.LngLat.convert(f.around),qt=I.locationPoint(Pt));var Wr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Te!==O,this._rotating=this._rotating||z!==Pe,this._pitching=this._pitching||_e!==q,this._padding=!I.isPaddingEqual(Je),this._easeId=f.easeId,this._prepareEase(g,f.noMoveStart,Wr),this._ease(function(Cn){if(S._zooming&&(I.zoom=y.number(O,Te,Cn)),S._rotating&&(I.bearing=y.number(z,Pe,Cn)),S._pitching&&(I.pitch=y.number(q,_e,Cn)),S._padding&&(I.interpolatePadding(oe,Je,Cn),mt=I.centerPoint.add($e)),Pt)I.setLocationAtPoint(Pt,qt);else{var yn=I.zoomScale(I.zoom-O),Hn=Te>O?Math.min(2,Mr):Math.max(.5,Mr),xi=Math.pow(Hn,1-Cn),Si=I.unproject(_r.add(ir.mult(Cn*xi)).mult(yn));I.setLocationAtPoint(I.renderWorldCopies?Si.wrap():Si,mt)}S._fireMoveEvents(g)},function(Cn){S._afterEase(g,Cn)},f),this},p.prototype._prepareEase=function(f,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",f))},p.prototype._fireMoveEvents=function(f){this.fire(new y.Event("move",f)),this._zooming&&this.fire(new y.Event("zoom",f)),this._rotating&&this.fire(new y.Event("rotate",f)),this._pitching&&this.fire(new y.Event("pitch",f))},p.prototype._afterEase=function(f,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,I=this._rotating,O=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",f)),I&&this.fire(new y.Event("rotateend",f)),O&&this.fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))}},p.prototype.flyTo=function(f,g){var S=this;if(!f.essential&&y.browser.prefersReducedMotion){var I=y.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(I,g)}this.stop(),f=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},f);var O=this.transform,z=this.getZoom(),q=this.getBearing(),oe=this.getPitch(),Te=this.getPadding(),Pe="zoom"in f?y.clamp(+f.zoom,O.minZoom,O.maxZoom):z,_e="bearing"in f?this._normalizeBearing(f.bearing,q):q,Je="pitch"in f?+f.pitch:oe,$e="padding"in f?f.padding:O.padding,mt=O.zoomScale(Pe-z),Ye=y.Point.convert(f.offset),gt=O.centerPoint.add(Ye),Pt=O.pointLocation(gt),qt=y.LngLat.convert(f.center||Pt);this._normalizeCenter(qt);var _r=O.project(Pt),ir=O.project(qt).sub(_r),Mr=f.curve,Wr=Math.max(O.width,O.height),Cn=Wr/mt,yn=ir.mag();if("minZoom"in f){var Hn=y.clamp(Math.min(f.minZoom,z,Pe),O.minZoom,O.maxZoom),xi=Wr/O.zoomScale(Hn-z);Mr=Math.sqrt(xi/yn*2)}var Si=Mr*Mr;function bi(Zi){var wi=(Cn*Cn-Wr*Wr+(Zi?-1:1)*Si*Si*yn*yn)/(2*(Zi?Cn:Wr)*Si*yn);return Math.log(Math.sqrt(wi*wi+1)-wi)}function Ca(Zi){return(Math.exp(Zi)-Math.exp(-Zi))/2}function qn(Zi){return(Math.exp(Zi)+Math.exp(-Zi))/2}var Hi=bi(0),Qi=function(Zi){return qn(Hi)/qn(Hi+Mr*Zi)},Wi=function(Zi){return Wr*((qn(Hi)*(Ca(wi=Hi+Mr*Zi)/qn(wi))-Ca(Hi))/Si)/yn;var wi},Oi=(bi(1)-Hi)/Mr;if(Math.abs(yn)<1e-6||!isFinite(Oi)){if(Math.abs(Wr-Cn)<1e-6)return this.easeTo(f,g);var oa=Cn<Wr?-1:1;Oi=Math.abs(Math.log(Cn/Wr))/Mr,Wi=function(){return 0},Qi=function(Zi){return Math.exp(oa*Mr*Zi)}}return f.duration="duration"in f?+f.duration:1e3*Oi/("screenSpeed"in f?+f.screenSpeed/Mr:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=q!==_e,this._pitching=Je!==oe,this._padding=!O.isPaddingEqual($e),this._prepareEase(g,!1),this._ease(function(Zi){var wi=Zi*Oi,ls=1/Qi(wi);O.zoom=Zi===1?Pe:z+O.scaleZoom(ls),S._rotating&&(O.bearing=y.number(q,_e,Zi)),S._pitching&&(O.pitch=y.number(oe,Je,Zi)),S._padding&&(O.interpolatePadding(Te,$e,Zi),gt=O.centerPoint.add(Ye));var Xo=Zi===1?qt:O.unproject(_r.add(ir.mult(Wi(wi))).mult(ls));O.setLocationAtPoint(O.renderWorldCopies?Xo.wrap():Xo,gt),S._fireMoveEvents(g)},function(){return S._afterEase(g)},f),this},p.prototype.isEasing=function(){return!!this._easeFrameId},p.prototype.stop=function(){return this._stop()},p.prototype._stop=function(f,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!f){var I=this.handlers;I&&I.stop(!1)}return this},p.prototype._ease=function(f,g,S){S.animate===!1||S.duration===0?(f(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},p.prototype._renderFrameCallback=function(){var f=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},p.prototype._normalizeBearing=function(f,g){f=y.wrap(f,-180,180);var S=Math.abs(f-g);return Math.abs(f-360-g)<S&&(f-=360),Math.abs(f+360-g)<S&&(f+=360),f},p.prototype._normalizeCenter=function(f){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=f.lng-g.center.lng;f.lng+=S>180?-360:S<-180?360:0}},p}(y.Evented),Os=function(c){c===void 0&&(c={}),this.options=c,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Os.prototype.getDefaultPosition=function(){return"bottom-right"},Os.prototype.onAdd=function(c){var p=this.options&&this.options.compact;return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Os.prototype.onRemove=function(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Os.prototype._setElementTitle=function(c,p){var f=this._map._getUIString("AttributionControl."+p);c.title=f,c.setAttribute("aria-label",f)},Os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Os.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(c){var f=p.reduce(function(g,S,I){return S.value&&(g+=S.key+"="+S.value+(I<p.length-1?"&":"")),g},"?");c.href=y.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Os.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Os.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(z){return typeof z!="string"?"":z})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}var f=this._map.style.sourceCaches;for(var g in f){var S=f[g];if(S.used){var I=S.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort(function(z,q){return z.length-q.length});var O=(c=c.filter(function(z,q){for(var oe=q+1;oe<c.length;oe++)if(c[oe].indexOf(z)>=0)return!1;return!0})).join(" | ");O!==this._attribHTML&&(this._attribHTML=O,c.length?(this._innerContainer.innerHTML=O,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ll=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};ll.prototype.onAdd=function(c){this._map=c,this._container=K.create("div","mapboxgl-ctrl");var p=K.create("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ll.prototype.onRemove=function(){K.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ll.prototype.getDefaultPosition=function(){return"bottom-left"},ll.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ll.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var p in c)if(c[p].getSource().mapbox_logo)return!0;return!1}},ll.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}};var Yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yo.prototype.add=function(c){var p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p},Yo.prototype.remove=function(c){for(var p=this._currentlyRunning,f=0,g=p?this._queue.concat(p):this._queue;f<g.length;f+=1){var S=g[f];if(S.id===c)return void(S.cancelled=!0)}},Yo.prototype.run=function(c){c===void 0&&(c=0);var p=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,g=p;f<g.length;f+=1){var S=g[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ph=y.window.HTMLImageElement,th=y.window.HTMLElement,Qa=y.window.ImageBitmap,po={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},rh=function(c){function p(g){var S=this;if((g=y.extend({},po,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var I=new Aa(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(c.call(this,I,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Ru,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof th))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new pi(this,g),this._hash=g.hash&&new cu(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Os({customAttribution:g.customAttribution})),this.addControl(new ll,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(O){S._update(O.dataType==="style"),S.fire(new y.Event(O.dataType+"data",O))}),this.on("dataloading",function(O){S.fire(new y.Event(O.dataType+"dataloading",O))})}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return p.prototype._getMapId=function(){return this._mapId},p.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var I=g.onAdd(this);this._controls.push(g);var O=this._controlPositions[S];return S.indexOf("bottom")!==-1?O.insertBefore(I,O.firstChild):O.appendChild(I),this},p.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},p.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},p.prototype.resize=function(g){var S=this._containerDimensions(),I=S[0],O=S[1];if(I===this.transform.width&&O===this.transform.height)return this;this._resizeCanvas(I,O),this.transform.resize(I,O),this.painter.resize(I,O);var z=!this._moving;return z&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),z&&this.fire(new y.Event("moveend",g)),this},p.prototype.getBounds=function(){return this.transform.getBounds()},p.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},p.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},p.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},p.prototype.getMinZoom=function(){return this.transform.minZoom},p.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},p.prototype.getMaxZoom=function(){return this.transform.maxZoom},p.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},p.prototype.getMinPitch=function(){return this.transform.minPitch},p.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},p.prototype.getMaxPitch=function(){return this.transform.maxPitch},p.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},p.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},p.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},p.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},p.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},p.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},p.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},p.prototype._createDelegatedListener=function(g,S,I){var O,z=this;if(g==="mouseenter"||g==="mouseover"){var q=!1;return{layer:S,listener:I,delegates:{mousemove:function(Te){var Pe=z.getLayer(S)?z.queryRenderedFeatures(Te.point,{layers:[S]}):[];Pe.length?q||(q=!0,I.call(z,new ms(g,z,Te.originalEvent,{features:Pe}))):q=!1},mouseout:function(){q=!1}}}}if(g==="mouseleave"||g==="mouseout"){var oe=!1;return{layer:S,listener:I,delegates:{mousemove:function(Te){(z.getLayer(S)?z.queryRenderedFeatures(Te.point,{layers:[S]}):[]).length?oe=!0:oe&&(oe=!1,I.call(z,new ms(g,z,Te.originalEvent)))},mouseout:function(Te){oe&&(oe=!1,I.call(z,new ms(g,z,Te.originalEvent)))}}}}return{layer:S,listener:I,delegates:(O={},O[g]=function(Te){var Pe=z.getLayer(S)?z.queryRenderedFeatures(Te.point,{layers:[S]}):[];Pe.length&&(Te.features=Pe,I.call(z,Te),delete Te.features)},O)}},p.prototype.on=function(g,S,I){if(I===void 0)return c.prototype.on.call(this,g,S);var O=this._createDelegatedListener(g,S,I);for(var z in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(O),O.delegates)this.on(z,O.delegates[z]);return this},p.prototype.once=function(g,S,I){if(I===void 0)return c.prototype.once.call(this,g,S);var O=this._createDelegatedListener(g,S,I);for(var z in O.delegates)this.once(z,O.delegates[z]);return this},p.prototype.off=function(g,S,I){var O=this;return I===void 0?c.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(z){for(var q=z[g],oe=0;oe<q.length;oe++){var Te=q[oe];if(Te.layer===S&&Te.listener===I){for(var Pe in Te.delegates)O.off(Pe,Te.delegates[Pe]);return q.splice(oe,1),O}}}(this._delegatedListeners),this)},p.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var I;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")I=[y.Point.convert(g)];else{var O=y.Point.convert(g[0]),z=y.Point.convert(g[1]);I=[O,new y.Point(z.x,O.y),z,new y.Point(O.x,z.y),O]}return this.style.queryRenderedFeatures(I,S,this.transform)},p.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},p.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},p.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},p.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Oo(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},p.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},p.prototype._diffStyle=function(g,S){var I=this;if(typeof g=="string"){var O=this._requestManager.normalizeStyleURL(g),z=this._requestManager.transformRequest(O,y.ResourceType.Style);y.getJSON(z,function(q,oe){q?I.fire(new y.ErrorEvent(q)):oe&&I._updateDiff(oe,S)})}else typeof g=="object"&&this._updateDiff(g,S)},p.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(I){y.warnOnce("Unable to perform style diff: "+(I.message||I.error||I)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},p.prototype.getStyle=function(){if(this.style)return this.style.serialize()},p.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},p.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},p.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},p.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var I=g[S]._tiles;for(var O in I){var z=I[O];if(z.state!=="loaded"&&z.state!=="errored")return!1}}return!0},p.prototype.addSourceType=function(g,S,I){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,I)},p.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},p.prototype.getSource=function(g){return this.style.getSource(g)},p.prototype.addImage=function(g,S,I){I===void 0&&(I={});var O=I.pixelRatio;O===void 0&&(O=1);var z=I.sdf;z===void 0&&(z=!1);var q=I.stretchX,oe=I.stretchY,Te=I.content;if(this._lazyInitEmptyStyle(),S instanceof Ph||Qa&&S instanceof Qa){var Pe=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:Pe.width,height:Pe.height},Pe.data),pixelRatio:O,stretchX:q,stretchY:oe,content:Te,sdf:z,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var _e=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:O,stretchX:q,stretchY:oe,content:Te,sdf:z,version:0,userImage:_e}),_e.onAdd&&_e.onAdd(this,g)}},p.prototype.updateImage=function(g,S){var I=this.style.getImage(g);if(!I)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var O=S instanceof Ph||Qa&&S instanceof Qa?y.browser.getImageData(S):S,z=O.width,q=O.height,oe=O.data;return z===void 0||q===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):z!==I.data.width||q!==I.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(I.data.replace(oe,!(S instanceof Ph||Qa&&S instanceof Qa)),void this.style.updateImage(g,I))},p.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},p.prototype.removeImage=function(g){this.style.removeImage(g)},p.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},p.prototype.listImages=function(){return this.style.listImages()},p.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},p.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},p.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},p.prototype.getLayer=function(g){return this.style.getLayer(g)},p.prototype.setLayerZoomRange=function(g,S,I){return this.style.setLayerZoomRange(g,S,I),this._update(!0)},p.prototype.setFilter=function(g,S,I){return I===void 0&&(I={}),this.style.setFilter(g,S,I),this._update(!0)},p.prototype.getFilter=function(g){return this.style.getFilter(g)},p.prototype.setPaintProperty=function(g,S,I,O){return O===void 0&&(O={}),this.style.setPaintProperty(g,S,I,O),this._update(!0)},p.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},p.prototype.setLayoutProperty=function(g,S,I,O){return O===void 0&&(O={}),this.style.setLayoutProperty(g,S,I,O),this._update(!0)},p.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},p.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},p.prototype.getLight=function(){return this.style.getLight()},p.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},p.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},p.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},p.prototype.getContainer=function(){return this._container},p.prototype.getCanvasContainer=function(){return this._canvasContainer},p.prototype.getCanvas=function(){return this._canvas},p.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},p.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},p.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=K.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=K.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=K.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var I=this._containerDimensions();this._resizeCanvas(I[0],I[1]);var O=this._controlContainer=K.create("div","mapboxgl-control-container",g),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(q){z[q]=K.create("div","mapboxgl-ctrl-"+q,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},p.prototype._resizeCanvas=function(g,S){var I=y.browser.devicePixelRatio||1;this._canvas.width=I*g,this._canvas.height=I*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},p.prototype._setupPainter=function(){var g=y.extend({},Fe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new Ui(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},p.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},p.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},p.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},p.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},p.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},p.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},p.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},p.prototype._render=function(g){var S,I=this,O=0,z=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=z.createQueryEXT(),z.beginQueryEXT(z.TIME_ELAPSED_EXT,S),O=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var q=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var oe=this.transform.zoom,Te=y.browser.now();this.style.zoomHistory.update(oe,Te);var Pe=new y.EvaluationParameters(oe,{now:Te,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_e=Pe.crossFadingFactor();_e===1&&_e===this._crossFadingFactor||(q=!0,this._crossFadingFactor=_e),this.style.update(Pe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||q)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Je=y.browser.now()-O;z.endQueryEXT(z.TIME_ELAPSED_EXT,S),setTimeout(function(){var Ye=z.getQueryObjectEXT(S,z.QUERY_RESULT_EXT)/1e6;z.deleteQueryEXT(S),I.fire(new y.Event("gpu-timing-frame",{cpuTime:Je,gpuTime:Ye}))},50)}if(this.listens("gpu-timing-layer")){var $e=this.painter.collectGpuTimers();setTimeout(function(){var Ye=I.painter.queryGpuTimers($e);I.fire(new y.Event("gpu-timing-layer",{layerTimes:Ye}))},50)}var mt=this._sourcesDirty||this._styleDirty||this._placementDirty;return mt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||mt||(this._fullyLoaded=!0),this}},p.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var I=this.painter.context.gl.getExtension("WEBGL_lose_context");I&&I.loseContext(),nh(this._canvasContainer),nh(this._controlContainer),nh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},p.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},p.prototype._onWindowOnline=function(){this._update()},p.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(g){this._vertices=g,this._update()},p.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},f.version.get=function(){return y.version},Object.defineProperties(p.prototype,f),p}(kf);function nh(c){c.parentNode&&c.parentNode.removeChild(c)}var Sl={showCompass:!0,showZoom:!0,visualizePitch:!1},Al=function(c){var p=this;this.options=y.extend({},Sl,c),this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return p._map.zoomIn({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return p._map.zoomOut({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){p.options.visualizePitch?p._map.resetNorthPitch({},{originalEvent:f}):p._map.resetNorth({},{originalEvent:f})}),this._compassIcon=K.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Al.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),p=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},Al.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Al.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rs(this._map,this._compass,this.options.visualizePitch)),this._container},Al.prototype.onRemove=function(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Al.prototype._createButton=function(c,p){var f=K.create("button",c,this._container);return f.type="button",f.addEventListener("click",p),f},Al.prototype._setButtonTitle=function(c,p){var f=this._map._getUIString("NavigationControl."+p);c.title=f,c.setAttribute("aria-label",f)};var Rs=function(c,p,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=p,this.mouseRotate=new Mh({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new xa({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),K.addEventListener(p,"mousedown",this.mousedown),K.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(p,"touchmove",this.touchmove),K.addEventListener(p,"touchend",this.touchend),K.addEventListener(p,"touchcancel",this.reset)};function Ao(c,p,f){if(c=new y.LngLat(c.lng,c.lat),p){var g=new y.LngLat(c.lng-360,c.lat),S=new y.LngLat(c.lng+360,c.lat),I=f.locationPoint(c).distSqr(p);f.locationPoint(g).distSqr(p)<I?c=g:f.locationPoint(S).distSqr(p)<I&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var O=f.locationPoint(c);if(O.x>=0&&O.y>=0&&O.x<=f.width&&O.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}Rs.prototype.down=function(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),K.disableDrag()},Rs.prototype.move=function(c,p){var f=this.map,g=this.mouseRotate.mousemoveWindow(c,p);if(g&&g.bearingDelta&&f.setBearing(f.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,p);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},Rs.prototype.off=function(){var c=this.element;K.removeEventListener(c,"mousedown",this.mousedown),K.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(c,"touchmove",this.touchmove),K.removeEventListener(c,"touchend",this.touchend),K.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Rs.prototype.offTemp=function(){K.enableDrag(),K.removeEventListener(y.window,"mousemove",this.mousemove),K.removeEventListener(y.window,"mouseup",this.mouseup)},Rs.prototype.mousedown=function(c){this.down(y.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),K.mousePos(this.element,c)),K.addEventListener(y.window,"mousemove",this.mousemove),K.addEventListener(y.window,"mouseup",this.mouseup)},Rs.prototype.mousemove=function(c){this.move(c,K.mousePos(this.element,c))},Rs.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Rs.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Rs.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Rs.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Rs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var ac={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $h(c,p,f){var g=c.classList;for(var S in ac)g.remove("mapboxgl-"+f+"-anchor-"+S);g.add("mapboxgl-"+f+"-anchor-"+p)}var tf,ih=function(c){function p(f,g){if(c.call(this),(f instanceof y.window.HTMLElement||g)&&(f=y.extend({element:f},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=y.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");var S=K.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");var O=K.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");var z=K.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");for(var q=0,oe=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];q<oe.length;q+=1){var Te=oe[q],Pe=K.createNS("http://www.w3.org/2000/svg","ellipse");Pe.setAttributeNS(null,"opacity","0.04"),Pe.setAttributeNS(null,"cx","10.5"),Pe.setAttributeNS(null,"cy","5.80029008"),Pe.setAttributeNS(null,"rx",Te.rx),Pe.setAttributeNS(null,"ry",Te.ry),z.appendChild(Pe)}var _e=K.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"fill",this._color);var Je=K.createNS("http://www.w3.org/2000/svg","path");Je.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),_e.appendChild(Je);var $e=K.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"fill","#000000");var mt=K.createNS("http://www.w3.org/2000/svg","path");mt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$e.appendChild(mt);var Ye=K.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ye.setAttributeNS(null,"fill","#FFFFFF");var gt=K.createNS("http://www.w3.org/2000/svg","g");gt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Pt=K.createNS("http://www.w3.org/2000/svg","circle");Pt.setAttributeNS(null,"fill","#000000"),Pt.setAttributeNS(null,"opacity","0.25"),Pt.setAttributeNS(null,"cx","5.5"),Pt.setAttributeNS(null,"cy","5.5"),Pt.setAttributeNS(null,"r","5.4999962");var qt=K.createNS("http://www.w3.org/2000/svg","circle");qt.setAttributeNS(null,"fill","#FFFFFF"),qt.setAttributeNS(null,"cx","5.5"),qt.setAttributeNS(null,"cy","5.5"),qt.setAttributeNS(null,"r","5.4999962"),gt.appendChild(Pt),gt.appendChild(qt),O.appendChild(z),O.appendChild(_e),O.appendChild($e),O.appendChild(Ye),O.appendChild(gt),S.appendChild(O),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(_r){_r.preventDefault()}),this._element.addEventListener("mousedown",function(_r){_r.preventDefault()}),$h(this._element,this._anchor,"marker"),this._popup=null}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},p.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},p.prototype.getElement=function(){return this._element},p.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},p.prototype._onKeyPress=function(f){var g=f.code,S=f.charCode||f.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},p.prototype._onMapClick=function(f){var g=f.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},p.prototype.getPopup=function(){return this._popup},p.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},p.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ao(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,ac[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},p.prototype.getOffset=function(){return this._offset},p.prototype.setOffset=function(f){return this._offset=y.Point.convert(f),this._update(),this},p.prototype._onMove=function(f){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},p.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},p.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},p.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},p.prototype.isDraggable=function(){return this._draggable},p.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},p.prototype.getRotation=function(){return this._rotation},p.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},p.prototype.getRotationAlignment=function(){return this._rotationAlignment},p.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},p.prototype.getPitchAlignment=function(){return this._pitchAlignment},p}(y.Evented),Kh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},cl=0,oc=!1,rf=function(c){function p(f){c.call(this),this.options=y.extend({},Kh,f),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.onAdd=function(f){var g;return this._map=f,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,tf!==void 0?g(tf):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(tf=S.state!=="denied")}):g(tf=!!y.window.navigator.geolocation),this._container},p.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,cl=0,oc=!1},p.prototype._isOutOfMapMaxBounds=function(f){var g=this._map.getMaxBounds(),S=f.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},p.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},p.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",f)),this._finish()}},p.prototype._updateCamera=function(f){var g=new y.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,I=this._map.getBearing(),O=y.extend({bearing:I},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),O,{geolocateSource:!0})},p.prototype._updateMarker=function(f){if(f){var g=new y.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},p.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,g=this._map.unproject([0,f]),S=this._map.unproject([1,f]),I=g.distanceTo(S),O=Math.ceil(2*this._accuracy/I);this._circleElement.style.width=O+"px",this._circleElement.style.height=O+"px"},p.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},p.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&oc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",f)),this._finish()}},p.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},p.prototype._setupUI=function(f){var g=this;if(this._container.addEventListener("contextmenu",function(O){return O.preventDefault()}),this._geolocateButton=K.create("button","mapboxgl-ctrl-geolocate",this._container),K.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var I=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ih(this._dotElement),this._circleElement=K.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ih({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(O){O.geolocateSource||g._watchState!=="ACTIVE_LOCK"||O.originalEvent&&O.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},p.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cl--,oc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++cl>1?(f={maximumAge:6e5,timeout:0},oc=!0):(f=this.options.positionOptions,oc=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},p.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},p}(y.Evented),sc={maxWidth:100,unit:"metric"},Hl=function(c){this.options=y.extend({},sc,c),y.bindAll(["_onMove","setUnit"],this)};function kh(c,p,f){var g=f&&f.maxWidth||100,S=c._container.clientHeight/2,I=c.unproject([0,S]),O=c.unproject([g,S]),z=I.distanceTo(O);if(f&&f.unit==="imperial"){var q=3.2808*z;q>5280?uc(p,g,q/5280,c._getUIString("ScaleControl.Miles")):uc(p,g,q,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?uc(p,g,z/1852,c._getUIString("ScaleControl.NauticalMiles")):z>=1e3?uc(p,g,z/1e3,c._getUIString("ScaleControl.Kilometers")):uc(p,g,z,c._getUIString("ScaleControl.Meters"))}function uc(c,p,f,g){var S,I,O,z=(S=f,(I=Math.pow(10,(""+Math.floor(S)).length-1))*(O=(O=S/I)>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(q){var oe=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*oe)/oe}(O)));c.style.width=p*(z/f)+"px",c.innerHTML=z+"&nbsp;"+g}Hl.prototype.getDefaultPosition=function(){return"bottom-left"},Hl.prototype._onMove=function(){kh(this._map,this._container,this.options)},Hl.prototype.onAdd=function(c){return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hl.prototype.onRemove=function(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hl.prototype.setUnit=function(c){this.options.unit=c,kh(this._map,this._container,this.options)};var wl=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof y.window.HTMLElement?this._container=c.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};wl.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},wl.prototype.onRemove=function(){K.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},wl.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},wl.prototype._setupUI=function(){var c=this._fullscreenButton=K.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},wl.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},wl.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},wl.prototype._isFullscreen=function(){return this._fullscreen},wl.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},wl.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Lf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Wu=function(c){function p(f){c.call(this),this.options=y.extend(Object.create(Lf),f),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},p.prototype.isOpen=function(){return!!this._map},p.prototype.remove=function(){return this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},p.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},p.prototype.getElement=function(){return this._container},p.prototype.setText=function(f){return this.setDOMContent(y.window.document.createTextNode(f))},p.prototype.setHTML=function(f){var g,S=y.window.document.createDocumentFragment(),I=y.window.document.createElement("body");for(I.innerHTML=f;g=I.firstChild;)S.appendChild(g);return this.setDOMContent(S)},p.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},p.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},p.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},p.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},p.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},p.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},p.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},p.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=K.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},p.prototype._onMouseUp=function(f){this._update(f.point)},p.prototype._onMouseMove=function(f){this._update(f.point)},p.prototype._onDrag=function(f){this._update(f.point)},p.prototype._update=function(f){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=K.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=K.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Pe){return g._container.classList.add(Pe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ao(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),I=this.options.anchor,O=function Pe(_e){if(_e){if(typeof _e=="number"){var Je=Math.round(Math.sqrt(.5*Math.pow(_e,2)));return{center:new y.Point(0,0),top:new y.Point(0,_e),"top-left":new y.Point(Je,Je),"top-right":new y.Point(-Je,Je),bottom:new y.Point(0,-_e),"bottom-left":new y.Point(Je,-Je),"bottom-right":new y.Point(-Je,-Je),left:new y.Point(_e,0),right:new y.Point(-_e,0)}}if(_e instanceof y.Point||Array.isArray(_e)){var $e=y.Point.convert(_e);return{center:$e,top:$e,"top-left":$e,"top-right":$e,bottom:$e,"bottom-left":$e,"bottom-right":$e,left:$e,right:$e}}return{center:y.Point.convert(_e.center||[0,0]),top:y.Point.convert(_e.top||[0,0]),"top-left":y.Point.convert(_e["top-left"]||[0,0]),"top-right":y.Point.convert(_e["top-right"]||[0,0]),bottom:y.Point.convert(_e.bottom||[0,0]),"bottom-left":y.Point.convert(_e["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(_e["bottom-right"]||[0,0]),left:y.Point.convert(_e.left||[0,0]),right:y.Point.convert(_e.right||[0,0])}}return Pe(new y.Point(0,0))}(this.options.offset);if(!I){var z,q=this._container.offsetWidth,oe=this._container.offsetHeight;z=S.y+O.bottom.y<oe?["top"]:S.y>this._map.transform.height-oe?["bottom"]:[],S.x<q/2?z.push("left"):S.x>this._map.transform.width-q/2&&z.push("right"),I=z.length===0?"bottom":z.join("-")}var Te=S.add(O[I]).round();K.setTransform(this._container,ac[I]+" translate("+Te.x+"px,"+Te.y+"px)"),$h(this._container,I,"popup")}},p.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(Lh);f&&f.focus()}},p.prototype._onClose=function(){this.remove()},p}(y.Evented),nf={version:y.version,supported:Fe,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:rh,NavigationControl:Al,GeolocateControl:rf,AttributionControl:Os,ScaleControl:Hl,FullscreenControl:wl,Popup:Wu,Marker:ih,Style:Oo,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){ar().acquire(mr)},clearPrewarmedResources:function(){var c=si;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(mr),si=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(c){y.config.ACCESS_TOKEN=c},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(c){y.config.API_URL=c},get workerCount(){return Hr.workerCount},set workerCount(c){Hr.workerCount=c},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){y.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){y.clearTileCache(c)},workerUrl:""};return nf}),Re})},3614:function(wn,Ee,ue){"use strict";wn.exports=ge;var Re=ue(80645);function ge(re){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(re)?re:new Uint8Array(re||0),this.pos=0,this.type=0,this.length=this.buf.length}ge.Varint=0,ge.Fixed64=1,ge.Bytes=2,ge.Fixed32=5;var y=(1<<16)*(1<<16),Fe=1/y,K=12,Me=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ge.prototype={destroy:function(){this.buf=null},readFields:function(re,Se,V){for(V=V||this.length;this.pos<V;){var Q=this.readVarint(),Le=Q>>3,ht=this.pos;this.type=Q&7,re(Le,Se,this),this.pos===ht&&this.skip(Q)}return Se},readMessage:function(re,Se){return this.readFields(re,Se,this.readVarint()+this.pos)},readFixed32:function(){var re=Dt(this.buf,this.pos);return this.pos+=4,re},readSFixed32:function(){var re=Jt(this.buf,this.pos);return this.pos+=4,re},readFixed64:function(){var re=Dt(this.buf,this.pos)+Dt(this.buf,this.pos+4)*y;return this.pos+=8,re},readSFixed64:function(){var re=Dt(this.buf,this.pos)+Jt(this.buf,this.pos+4)*y;return this.pos+=8,re},readFloat:function(){var re=Re.read(this.buf,this.pos,!0,23,4);return this.pos+=4,re},readDouble:function(){var re=Re.read(this.buf,this.pos,!0,52,8);return this.pos+=8,re},readVarint:function(re){var Se=this.buf,V,Q;return Q=Se[this.pos++],V=Q&127,Q<128||(Q=Se[this.pos++],V|=(Q&127)<<7,Q<128)||(Q=Se[this.pos++],V|=(Q&127)<<14,Q<128)||(Q=Se[this.pos++],V|=(Q&127)<<21,Q<128)?V:(Q=Se[this.pos],V|=(Q&15)<<28,ve(V,re,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var re=this.readVarint();return re%2==1?(re+1)/-2:re/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var re=this.readVarint()+this.pos,Se=this.pos;return this.pos=re,re-Se>=K&&Me?Sr(this.buf,Se,re):je(this.buf,Se,re)},readBytes:function(){var re=this.readVarint()+this.pos,Se=this.buf.subarray(this.pos,re);return this.pos=re,Se},readPackedVarint:function(re,Se){if(this.type!==ge.Bytes)return re.push(this.readVarint(Se));var V=at(this);for(re=re||[];this.pos<V;)re.push(this.readVarint(Se));return re},readPackedSVarint:function(re){if(this.type!==ge.Bytes)return re.push(this.readSVarint());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readSVarint());return re},readPackedBoolean:function(re){if(this.type!==ge.Bytes)return re.push(this.readBoolean());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readBoolean());return re},readPackedFloat:function(re){if(this.type!==ge.Bytes)return re.push(this.readFloat());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readFloat());return re},readPackedDouble:function(re){if(this.type!==ge.Bytes)return re.push(this.readDouble());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readDouble());return re},readPackedFixed32:function(re){if(this.type!==ge.Bytes)return re.push(this.readFixed32());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readFixed32());return re},readPackedSFixed32:function(re){if(this.type!==ge.Bytes)return re.push(this.readSFixed32());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readSFixed32());return re},readPackedFixed64:function(re){if(this.type!==ge.Bytes)return re.push(this.readFixed64());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readFixed64());return re},readPackedSFixed64:function(re){if(this.type!==ge.Bytes)return re.push(this.readSFixed64());var Se=at(this);for(re=re||[];this.pos<Se;)re.push(this.readSFixed64());return re},skip:function(re){var Se=re&7;if(Se===ge.Varint)for(;this.buf[this.pos++]>127;);else if(Se===ge.Bytes)this.pos=this.readVarint()+this.pos;else if(Se===ge.Fixed32)this.pos+=4;else if(Se===ge.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Se)},writeTag:function(re,Se){this.writeVarint(re<<3|Se)},realloc:function(re){for(var Se=this.length||16;Se<this.pos+re;)Se*=2;if(Se!==this.length){var V=new Uint8Array(Se);V.set(this.buf),this.buf=V,this.length=Se}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(re){this.realloc(4),xt(this.buf,re,this.pos),this.pos+=4},writeSFixed32:function(re){this.realloc(4),xt(this.buf,re,this.pos),this.pos+=4},writeFixed64:function(re){this.realloc(8),xt(this.buf,re&-1,this.pos),xt(this.buf,Math.floor(re*Fe),this.pos+4),this.pos+=8},writeSFixed64:function(re){this.realloc(8),xt(this.buf,re&-1,this.pos),xt(this.buf,Math.floor(re*Fe),this.pos+4),this.pos+=8},writeVarint:function(re){if(re=+re||0,re>268435455||re<0){Be(re,this);return}this.realloc(4),this.buf[this.pos++]=re&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=(re>>>=7)&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=(re>>>=7)&127|(re>127?128:0),!(re<=127)&&(this.buf[this.pos++]=re>>>7&127)))},writeSVarint:function(re){this.writeVarint(re<0?-re*2-1:re*2)},writeBoolean:function(re){this.writeVarint(Boolean(re))},writeString:function(re){re=String(re),this.realloc(re.length*4),this.pos++;var Se=this.pos;this.pos=tn(this.buf,re,this.pos);var V=this.pos-Se;V>=128&&Et(Se,V,this),this.pos=Se-1,this.writeVarint(V),this.pos+=V},writeFloat:function(re){this.realloc(4),Re.write(this.buf,re,this.pos,!0,23,4),this.pos+=4},writeDouble:function(re){this.realloc(8),Re.write(this.buf,re,this.pos,!0,52,8),this.pos+=8},writeBytes:function(re){var Se=re.length;this.writeVarint(Se),this.realloc(Se);for(var V=0;V<Se;V++)this.buf[this.pos++]=re[V]},writeRawMessage:function(re,Se){this.pos++;var V=this.pos;re(Se,this);var Q=this.pos-V;Q>=128&&Et(V,Q,this),this.pos=V-1,this.writeVarint(Q),this.pos+=Q},writeMessage:function(re,Se,V){this.writeTag(re,ge.Bytes),this.writeRawMessage(Se,V)},writePackedVarint:function(re,Se){Se.length&&this.writeMessage(re,Vt,Se)},writePackedSVarint:function(re,Se){Se.length&&this.writeMessage(re,Ut,Se)},writePackedBoolean:function(re,Se){Se.length&&this.writeMessage(re,It,Se)},writePackedFloat:function(re,Se){Se.length&&this.writeMessage(re,lr,Se)},writePackedDouble:function(re,Se){Se.length&&this.writeMessage(re,Qt,Se)},writePackedFixed32:function(re,Se){Se.length&&this.writeMessage(re,Lt,Se)},writePackedSFixed32:function(re,Se){Se.length&&this.writeMessage(re,fr,Se)},writePackedFixed64:function(re,Se){Se.length&&this.writeMessage(re,ie,Se)},writePackedSFixed64:function(re,Se){Se.length&&this.writeMessage(re,yr,Se)},writeBytesField:function(re,Se){this.writeTag(re,ge.Bytes),this.writeBytes(Se)},writeFixed32Field:function(re,Se){this.writeTag(re,ge.Fixed32),this.writeFixed32(Se)},writeSFixed32Field:function(re,Se){this.writeTag(re,ge.Fixed32),this.writeSFixed32(Se)},writeFixed64Field:function(re,Se){this.writeTag(re,ge.Fixed64),this.writeFixed64(Se)},writeSFixed64Field:function(re,Se){this.writeTag(re,ge.Fixed64),this.writeSFixed64(Se)},writeVarintField:function(re,Se){this.writeTag(re,ge.Varint),this.writeVarint(Se)},writeSVarintField:function(re,Se){this.writeTag(re,ge.Varint),this.writeSVarint(Se)},writeStringField:function(re,Se){this.writeTag(re,ge.Bytes),this.writeString(Se)},writeFloatField:function(re,Se){this.writeTag(re,ge.Fixed32),this.writeFloat(Se)},writeDoubleField:function(re,Se){this.writeTag(re,ge.Fixed64),this.writeDouble(Se)},writeBooleanField:function(re,Se){this.writeVarintField(re,Boolean(Se))}};function ve(re,Se,V){var Q=V.buf,Le,ht;if(ht=Q[V.pos++],Le=(ht&112)>>4,ht<128||(ht=Q[V.pos++],Le|=(ht&127)<<3,ht<128)||(ht=Q[V.pos++],Le|=(ht&127)<<10,ht<128)||(ht=Q[V.pos++],Le|=(ht&127)<<17,ht<128)||(ht=Q[V.pos++],Le|=(ht&127)<<24,ht<128)||(ht=Q[V.pos++],Le|=(ht&1)<<31,ht<128))return se(re,Le,Se);throw new Error("Expected varint not more than 10 bytes")}function at(re){return re.type===ge.Bytes?re.readVarint()+re.pos:re.pos+1}function se(re,Se,V){return V?Se*4294967296+(re>>>0):(Se>>>0)*4294967296+(re>>>0)}function Be(re,Se){var V,Q;if(re>=0?(V=re%4294967296|0,Q=re/4294967296|0):(V=~(-re%4294967296),Q=~(-re/4294967296),V^4294967295?V=V+1|0:(V=0,Q=Q+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Se.realloc(10),dt(V,Q,Se),rt(Q,Se)}function dt(re,Se,V){V.buf[V.pos++]=re&127|128,re>>>=7,V.buf[V.pos++]=re&127|128,re>>>=7,V.buf[V.pos++]=re&127|128,re>>>=7,V.buf[V.pos++]=re&127|128,re>>>=7,V.buf[V.pos]=re&127}function rt(re,Se){var V=(re&7)<<4;Se.buf[Se.pos++]|=V|((re>>>=3)?128:0),!!re&&(Se.buf[Se.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Se.buf[Se.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Se.buf[Se.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Se.buf[Se.pos++]=re&127|((re>>>=7)?128:0),!!re&&(Se.buf[Se.pos++]=re&127)))))}function Et(re,Se,V){var Q=Se<=16383?1:Se<=2097151?2:Se<=268435455?3:Math.floor(Math.log(Se)/(Math.LN2*7));V.realloc(Q);for(var Le=V.pos-1;Le>=re;Le--)V.buf[Le+Q]=V.buf[Le]}function Vt(re,Se){for(var V=0;V<re.length;V++)Se.writeVarint(re[V])}function Ut(re,Se){for(var V=0;V<re.length;V++)Se.writeSVarint(re[V])}function lr(re,Se){for(var V=0;V<re.length;V++)Se.writeFloat(re[V])}function Qt(re,Se){for(var V=0;V<re.length;V++)Se.writeDouble(re[V])}function It(re,Se){for(var V=0;V<re.length;V++)Se.writeBoolean(re[V])}function Lt(re,Se){for(var V=0;V<re.length;V++)Se.writeFixed32(re[V])}function fr(re,Se){for(var V=0;V<re.length;V++)Se.writeSFixed32(re[V])}function ie(re,Se){for(var V=0;V<re.length;V++)Se.writeFixed64(re[V])}function yr(re,Se){for(var V=0;V<re.length;V++)Se.writeSFixed64(re[V])}function Dt(re,Se){return(re[Se]|re[Se+1]<<8|re[Se+2]<<16)+re[Se+3]*16777216}function xt(re,Se,V){re[V]=Se,re[V+1]=Se>>>8,re[V+2]=Se>>>16,re[V+3]=Se>>>24}function Jt(re,Se){return(re[Se]|re[Se+1]<<8|re[Se+2]<<16)+(re[Se+3]<<24)}function je(re,Se,V){for(var Q="",Le=Se;Le<V;){var ht=re[Le],wt=null,er=ht>239?4:ht>223?3:ht>191?2:1;if(Le+er>V)break;var Tt,vr,ln;er===1?ht<128&&(wt=ht):er===2?(Tt=re[Le+1],(Tt&192)==128&&(wt=(ht&31)<<6|Tt&63,wt<=127&&(wt=null))):er===3?(Tt=re[Le+1],vr=re[Le+2],(Tt&192)==128&&(vr&192)==128&&(wt=(ht&15)<<12|(Tt&63)<<6|vr&63,(wt<=2047||wt>=55296&&wt<=57343)&&(wt=null))):er===4&&(Tt=re[Le+1],vr=re[Le+2],ln=re[Le+3],(Tt&192)==128&&(vr&192)==128&&(ln&192)==128&&(wt=(ht&15)<<18|(Tt&63)<<12|(vr&63)<<6|ln&63,(wt<=65535||wt>=1114112)&&(wt=null))),wt===null?(wt=65533,er=1):wt>65535&&(wt-=65536,Q+=String.fromCharCode(wt>>>10&1023|55296),wt=56320|wt&1023),Q+=String.fromCharCode(wt),Le+=er}return Q}function Sr(re,Se,V){return Me.decode(re.subarray(Se,V))}function tn(re,Se,V){for(var Q=0,Le,ht;Q<Se.length;Q++){if(Le=Se.charCodeAt(Q),Le>55295&&Le<57344)if(ht)if(Le<56320){re[V++]=239,re[V++]=191,re[V++]=189,ht=Le;continue}else Le=ht-55296<<10|Le-56320|65536,ht=null;else{Le>56319||Q+1===Se.length?(re[V++]=239,re[V++]=191,re[V++]=189):ht=Le;continue}else ht&&(re[V++]=239,re[V++]=191,re[V++]=189,ht=null);Le<128?re[V++]=Le:(Le<2048?re[V++]=Le>>6|192:(Le<65536?re[V++]=Le>>12|224:(re[V++]=Le>>18|240,re[V++]=Le>>12&63|128),re[V++]=Le>>6&63|128),re[V++]=Le&63|128)}return V}},32676:function(wn,Ee,ue){var Re=ue(34155);(function(ge,y){wn.exports=y()})(this,function(){"use strict";function ge(Ft,be){if(!(Ft instanceof be))throw new TypeError("Cannot call a class as a function")}function y(Ft,be){for(var he=0;he<be.length;he++){var Ie=be[he];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Ft,Ie.key,Ie)}}function Fe(Ft,be,he){return be&&y(Ft.prototype,be),he&&y(Ft,he),Ft}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var K=function(){function Ft(be,he){this.next=null,this.key=be,this.data=he,this.left=null,this.right=null}return Ft}();function Me(Ft,be){return Ft>be?1:Ft<be?-1:0}function ve(Ft,be,he){for(var Ie=new K(null,null),G=Ie,lt=Ie;;){var sr=he(Ft,be.key);if(sr<0){if(be.left===null)break;if(he(Ft,be.left.key)<0){var Jr=be.left;if(be.left=Jr.right,Jr.right=be,be=Jr,be.left===null)break}lt.left=be,lt=be,be=be.left}else if(sr>0){if(be.right===null)break;if(he(Ft,be.right.key)>0){var Jr=be.right;if(be.right=Jr.left,Jr.left=be,be=Jr,be.right===null)break}G.right=be,G=be,be=be.right}else break}return G.right=be.left,lt.left=be.right,be.left=Ie.right,be.right=Ie.left,be}function at(Ft,be,he,Ie){var G=new K(Ft,be);if(he===null)return G.left=G.right=null,G;he=ve(Ft,he,Ie);var lt=Ie(Ft,he.key);return lt<0?(G.left=he.left,G.right=he,he.left=null):lt>=0&&(G.right=he.right,G.left=he,he.right=null),G}function se(Ft,be,he){var Ie=null,G=null;if(be){be=ve(Ft,be,he);var lt=he(be.key,Ft);lt===0?(Ie=be.left,G=be.right):lt<0?(G=be.right,be.right=null,Ie=be):(Ie=be.left,be.left=null,G=be)}return{left:Ie,right:G}}function Be(Ft,be,he){return be===null?Ft:(Ft===null||(be=ve(Ft.key,be,he),be.left=Ft),be)}function dt(Ft,be,he,Ie,G){if(Ft){Ie(""+be+(he?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+G(Ft)+`
`);var lt=be+(he?"    ":"\u2502   ");Ft.left&&dt(Ft.left,lt,!1,Ie,G),Ft.right&&dt(Ft.right,lt,!0,Ie,G)}}var rt=function(){function Ft(be){be===void 0&&(be=Me),this._root=null,this._size=0,this._comparator=be}return Ft.prototype.insert=function(be,he){return this._size++,this._root=at(be,he,this._root,this._comparator)},Ft.prototype.add=function(be,he){var Ie=new K(be,he);this._root===null&&(Ie.left=Ie.right=null,this._size++,this._root=Ie);var G=this._comparator,lt=ve(be,this._root,G),sr=G(be,lt.key);return sr===0?this._root=lt:(sr<0?(Ie.left=lt.left,Ie.right=lt,lt.left=null):sr>0&&(Ie.right=lt.right,Ie.left=lt,lt.right=null),this._size++,this._root=Ie),this._root},Ft.prototype.remove=function(be){this._root=this._remove(be,this._root,this._comparator)},Ft.prototype._remove=function(be,he,Ie){var G;if(he===null)return null;he=ve(be,he,Ie);var lt=Ie(be,he.key);return lt===0?(he.left===null?G=he.right:(G=ve(be,he.left,Ie),G.right=he.right),this._size--,G):he},Ft.prototype.pop=function(){var be=this._root;if(be){for(;be.left;)be=be.left;return this._root=ve(be.key,this._root,this._comparator),this._root=this._remove(be.key,this._root,this._comparator),{key:be.key,data:be.data}}return null},Ft.prototype.findStatic=function(be){for(var he=this._root,Ie=this._comparator;he;){var G=Ie(be,he.key);if(G===0)return he;G<0?he=he.left:he=he.right}return null},Ft.prototype.find=function(be){return this._root&&(this._root=ve(be,this._root,this._comparator),this._comparator(be,this._root.key)!==0)?null:this._root},Ft.prototype.contains=function(be){for(var he=this._root,Ie=this._comparator;he;){var G=Ie(be,he.key);if(G===0)return!0;G<0?he=he.left:he=he.right}return!1},Ft.prototype.forEach=function(be,he){for(var Ie=this._root,G=[],lt=!1;!lt;)Ie!==null?(G.push(Ie),Ie=Ie.left):G.length!==0?(Ie=G.pop(),be.call(he,Ie),Ie=Ie.right):lt=!0;return this},Ft.prototype.range=function(be,he,Ie,G){for(var lt=[],sr=this._comparator,Jr=this._root,nt;lt.length!==0||Jr;)if(Jr)lt.push(Jr),Jr=Jr.left;else{if(Jr=lt.pop(),nt=sr(Jr.key,he),nt>0)break;if(sr(Jr.key,be)>=0&&Ie.call(G,Jr))return this;Jr=Jr.right}return this},Ft.prototype.keys=function(){var be=[];return this.forEach(function(he){var Ie=he.key;return be.push(Ie)}),be},Ft.prototype.values=function(){var be=[];return this.forEach(function(he){var Ie=he.data;return be.push(Ie)}),be},Ft.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Ft.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Ft.prototype.minNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.left;)be=be.left;return be},Ft.prototype.maxNode=function(be){if(be===void 0&&(be=this._root),be)for(;be.right;)be=be.right;return be},Ft.prototype.at=function(be){for(var he=this._root,Ie=!1,G=0,lt=[];!Ie;)if(he)lt.push(he),he=he.left;else if(lt.length>0){if(he=lt.pop(),G===be)return he;G++,he=he.right}else Ie=!0;return null},Ft.prototype.next=function(be){var he=this._root,Ie=null;if(be.right){for(Ie=be.right;Ie.left;)Ie=Ie.left;return Ie}for(var G=this._comparator;he;){var lt=G(be.key,he.key);if(lt===0)break;lt<0?(Ie=he,he=he.left):he=he.right}return Ie},Ft.prototype.prev=function(be){var he=this._root,Ie=null;if(be.left!==null){for(Ie=be.left;Ie.right;)Ie=Ie.right;return Ie}for(var G=this._comparator;he;){var lt=G(be.key,he.key);if(lt===0)break;lt<0?he=he.left:(Ie=he,he=he.right)}return Ie},Ft.prototype.clear=function(){return this._root=null,this._size=0,this},Ft.prototype.toList=function(){return Ut(this._root)},Ft.prototype.load=function(be,he,Ie){he===void 0&&(he=[]),Ie===void 0&&(Ie=!1);var G=be.length,lt=this._comparator;if(Ie&&It(be,he,0,G-1,lt),this._root===null)this._root=Et(be,he,0,G),this._size=G;else{var sr=Qt(this.toList(),Vt(be,he),lt);G=this._size+G,this._root=lr({head:sr},0,G)}return this},Ft.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Ft.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Ft.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Ft.prototype.toString=function(be){be===void 0&&(be=function(G){return String(G.key)});var he=[];return dt(this._root,"",!0,function(Ie){return he.push(Ie)},be),he.join("")},Ft.prototype.update=function(be,he,Ie){var G=this._comparator,lt=se(be,this._root,G),sr=lt.left,Jr=lt.right;G(be,he)<0?Jr=at(he,Ie,Jr,G):sr=at(he,Ie,sr,G),this._root=Be(sr,Jr,G)},Ft.prototype.split=function(be){return se(be,this._root,this._comparator)},Ft}();function Et(Ft,be,he,Ie){var G=Ie-he;if(G>0){var lt=he+Math.floor(G/2),sr=Ft[lt],Jr=be[lt],nt=new K(sr,Jr);return nt.left=Et(Ft,be,he,lt),nt.right=Et(Ft,be,lt+1,Ie),nt}return null}function Vt(Ft,be){for(var he=new K(null,null),Ie=he,G=0;G<Ft.length;G++)Ie=Ie.next=new K(Ft[G],be[G]);return Ie.next=null,he.next}function Ut(Ft){for(var be=Ft,he=[],Ie=!1,G=new K(null,null),lt=G;!Ie;)be?(he.push(be),be=be.left):he.length>0?(be=lt=lt.next=he.pop(),be=be.right):Ie=!0;return lt.next=null,G.next}function lr(Ft,be,he){var Ie=he-be;if(Ie>0){var G=be+Math.floor(Ie/2),lt=lr(Ft,be,G),sr=Ft.head;return sr.left=lt,Ft.head=Ft.head.next,sr.right=lr(Ft,G+1,he),sr}return null}function Qt(Ft,be,he){for(var Ie=new K(null,null),G=Ie,lt=Ft,sr=be;lt!==null&&sr!==null;)he(lt.key,sr.key)<0?(G.next=lt,lt=lt.next):(G.next=sr,sr=sr.next),G=G.next;return lt!==null?G.next=lt:sr!==null&&(G.next=sr),Ie.next}function It(Ft,be,he,Ie,G){if(!(he>=Ie)){for(var lt=Ft[he+Ie>>1],sr=he-1,Jr=Ie+1;;){do sr++;while(G(Ft[sr],lt)<0);do Jr--;while(G(Ft[Jr],lt)>0);if(sr>=Jr)break;var nt=Ft[sr];Ft[sr]=Ft[Jr],Ft[Jr]=nt,nt=be[sr],be[sr]=be[Jr],be[Jr]=nt}It(Ft,be,he,Jr,G),It(Ft,be,Jr+1,Ie,G)}}var Lt=function(be,he){return be.ll.x<=he.x&&he.x<=be.ur.x&&be.ll.y<=he.y&&he.y<=be.ur.y},fr=function(be,he){if(he.ur.x<be.ll.x||be.ur.x<he.ll.x||he.ur.y<be.ll.y||be.ur.y<he.ll.y)return null;var Ie=be.ll.x<he.ll.x?he.ll.x:be.ll.x,G=be.ur.x<he.ur.x?be.ur.x:he.ur.x,lt=be.ll.y<he.ll.y?he.ll.y:be.ll.y,sr=be.ur.y<he.ur.y?be.ur.y:he.ur.y;return{ll:{x:Ie,y:lt},ur:{x:G,y:sr}}},ie=Number.EPSILON;ie===void 0&&(ie=Math.pow(2,-52));var yr=ie*ie,Dt=function(be,he){if(-ie<be&&be<ie&&-ie<he&&he<ie)return 0;var Ie=be-he;return Ie*Ie<yr*be*he?0:be<he?-1:1},xt=function(){function Ft(){ge(this,Ft),this.reset()}return Fe(Ft,[{key:"reset",value:function(){this.xRounder=new Jt,this.yRounder=new Jt}},{key:"round",value:function(he,Ie){return{x:this.xRounder.round(he),y:this.yRounder.round(Ie)}}}]),Ft}(),Jt=function(){function Ft(){ge(this,Ft),this.tree=new rt,this.round(0)}return Fe(Ft,[{key:"round",value:function(he){var Ie=this.tree.add(he),G=this.tree.prev(Ie);if(G!==null&&Dt(Ie.key,G.key)===0)return this.tree.remove(he),G.key;var lt=this.tree.next(Ie);return lt!==null&&Dt(Ie.key,lt.key)===0?(this.tree.remove(he),lt.key):he}}]),Ft}(),je=new xt,Sr=function(be,he){return be.x*he.y-be.y*he.x},tn=function(be,he){return be.x*he.x+be.y*he.y},re=function(be,he,Ie){var G={x:he.x-be.x,y:he.y-be.y},lt={x:Ie.x-be.x,y:Ie.y-be.y},sr=Sr(G,lt);return Dt(sr,0)},Se=function(be){return Math.sqrt(tn(be,be))},V=function(be,he,Ie){var G={x:he.x-be.x,y:he.y-be.y},lt={x:Ie.x-be.x,y:Ie.y-be.y};return Sr(lt,G)/Se(lt)/Se(G)},Q=function(be,he,Ie){var G={x:he.x-be.x,y:he.y-be.y},lt={x:Ie.x-be.x,y:Ie.y-be.y};return tn(lt,G)/Se(lt)/Se(G)},Le=function(be,he,Ie){return he.y===0?null:{x:be.x+he.x/he.y*(Ie-be.y),y:Ie}},ht=function(be,he,Ie){return he.x===0?null:{x:Ie,y:be.y+he.y/he.x*(Ie-be.x)}},wt=function(be,he,Ie,G){if(he.x===0)return ht(Ie,G,be.x);if(G.x===0)return ht(be,he,Ie.x);if(he.y===0)return Le(Ie,G,be.y);if(G.y===0)return Le(be,he,Ie.y);var lt=Sr(he,G);if(lt==0)return null;var sr={x:Ie.x-be.x,y:Ie.y-be.y},Jr=Sr(sr,he)/lt,nt=Sr(sr,G)/lt,Gt=be.x+nt*he.x,Ar=Ie.x+Jr*G.x,Tr=be.y+nt*he.y,Rr=Ie.y+Jr*G.y,mn=(Gt+Ar)/2,mi=(Tr+Rr)/2;return{x:mn,y:mi}},er=function(){Fe(Ft,null,[{key:"compare",value:function(he,Ie){var G=Ft.comparePoints(he.point,Ie.point);return G!==0?G:(he.point!==Ie.point&&he.link(Ie),he.isLeft!==Ie.isLeft?he.isLeft?1:-1:vr.compare(he.segment,Ie.segment))}},{key:"comparePoints",value:function(he,Ie){return he.x<Ie.x?-1:he.x>Ie.x?1:he.y<Ie.y?-1:he.y>Ie.y?1:0}}]);function Ft(be,he){ge(this,Ft),be.events===void 0?be.events=[this]:be.events.push(this),this.point=be,this.isLeft=he}return Fe(Ft,[{key:"link",value:function(he){if(he.point===this.point)throw new Error("Tried to link already linked events");for(var Ie=he.point.events,G=0,lt=Ie.length;G<lt;G++){var sr=Ie[G];this.point.events.push(sr),sr.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var he=this.point.events.length,Ie=0;Ie<he;Ie++){var G=this.point.events[Ie];if(G.segment.consumedBy===void 0)for(var lt=Ie+1;lt<he;lt++){var sr=this.point.events[lt];sr.consumedBy===void 0&&G.otherSE.point.events===sr.otherSE.point.events&&G.segment.consume(sr.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var he=[],Ie=0,G=this.point.events.length;Ie<G;Ie++){var lt=this.point.events[Ie];lt!==this&&!lt.segment.ringOut&&lt.segment.isInResult()&&he.push(lt)}return he}},{key:"getLeftmostComparator",value:function(he){var Ie=this,G=new Map,lt=function(Jr){var nt=Jr.otherSE;G.set(Jr,{sine:V(Ie.point,he.point,nt.point),cosine:Q(Ie.point,he.point,nt.point)})};return function(sr,Jr){G.has(sr)||lt(sr),G.has(Jr)||lt(Jr);var nt=G.get(sr),Gt=nt.sine,Ar=nt.cosine,Tr=G.get(Jr),Rr=Tr.sine,mn=Tr.cosine;return Gt>=0&&Rr>=0?Ar<mn?1:Ar>mn?-1:0:Gt<0&&Rr<0?Ar<mn?-1:Ar>mn?1:0:Rr<Gt?-1:Rr>Gt?1:0}}}]),Ft}(),Tt=0,vr=function(){Fe(Ft,null,[{key:"compare",value:function(he,Ie){var G=he.leftSE.point.x,lt=Ie.leftSE.point.x,sr=he.rightSE.point.x,Jr=Ie.rightSE.point.x;if(Jr<G)return 1;if(sr<lt)return-1;var nt=he.leftSE.point.y,Gt=Ie.leftSE.point.y,Ar=he.rightSE.point.y,Tr=Ie.rightSE.point.y;if(G<lt){if(Gt<nt&&Gt<Ar)return 1;if(Gt>nt&&Gt>Ar)return-1;var Rr=he.comparePoint(Ie.leftSE.point);if(Rr<0)return 1;if(Rr>0)return-1;var mn=Ie.comparePoint(he.rightSE.point);return mn!==0?mn:-1}if(G>lt){if(nt<Gt&&nt<Tr)return-1;if(nt>Gt&&nt>Tr)return 1;var mi=Ie.comparePoint(he.leftSE.point);if(mi!==0)return mi;var ai=he.comparePoint(Ie.rightSE.point);return ai<0?1:ai>0?-1:1}if(nt<Gt)return-1;if(nt>Gt)return 1;if(sr<Jr){var Tn=Ie.comparePoint(he.rightSE.point);if(Tn!==0)return Tn}if(sr>Jr){var Ri=he.comparePoint(Ie.rightSE.point);if(Ri<0)return 1;if(Ri>0)return-1}if(sr!==Jr){var zi=Ar-nt,ka=sr-G,ia=Tr-Gt,io=Jr-lt;if(zi>ka&&ia<io)return 1;if(zi<ka&&ia>io)return-1}return sr>Jr?1:sr<Jr||Ar<Tr?-1:Ar>Tr?1:he.id<Ie.id?-1:he.id>Ie.id?1:0}}]);function Ft(be,he,Ie,G){ge(this,Ft),this.id=++Tt,this.leftSE=be,be.segment=this,be.otherSE=he,this.rightSE=he,he.segment=this,he.otherSE=be,this.rings=Ie,this.windings=G}return Fe(Ft,[{key:"replaceRightSE",value:function(he){this.rightSE=he,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var he=this.leftSE.point.y,Ie=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:he<Ie?he:Ie},ur:{x:this.rightSE.point.x,y:he>Ie?he:Ie}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(he){return he.x===this.leftSE.point.x&&he.y===this.leftSE.point.y||he.x===this.rightSE.point.x&&he.y===this.rightSE.point.y}},{key:"comparePoint",value:function(he){if(this.isAnEndpoint(he))return 0;var Ie=this.leftSE.point,G=this.rightSE.point,lt=this.vector();if(Ie.x===G.x)return he.x===Ie.x?0:he.x<Ie.x?1:-1;var sr=(he.y-Ie.y)/lt.y,Jr=Ie.x+sr*lt.x;if(he.x===Jr)return 0;var nt=(he.x-Ie.x)/lt.x,Gt=Ie.y+nt*lt.y;return he.y===Gt?0:he.y<Gt?-1:1}},{key:"getIntersection",value:function(he){var Ie=this.bbox(),G=he.bbox(),lt=fr(Ie,G);if(lt===null)return null;var sr=this.leftSE.point,Jr=this.rightSE.point,nt=he.leftSE.point,Gt=he.rightSE.point,Ar=Lt(Ie,nt)&&this.comparePoint(nt)===0,Tr=Lt(G,sr)&&he.comparePoint(sr)===0,Rr=Lt(Ie,Gt)&&this.comparePoint(Gt)===0,mn=Lt(G,Jr)&&he.comparePoint(Jr)===0;if(Tr&&Ar)return mn&&!Rr?Jr:!mn&&Rr?Gt:null;if(Tr)return Rr&&sr.x===Gt.x&&sr.y===Gt.y?null:sr;if(Ar)return mn&&Jr.x===nt.x&&Jr.y===nt.y?null:nt;if(mn&&Rr)return null;if(mn)return Jr;if(Rr)return Gt;var mi=wt(sr,this.vector(),nt,he.vector());return mi===null||!Lt(lt,mi)?null:je.round(mi.x,mi.y)}},{key:"split",value:function(he){var Ie=[],G=he.events!==void 0,lt=new er(he,!0),sr=new er(he,!1),Jr=this.rightSE;this.replaceRightSE(sr),Ie.push(sr),Ie.push(lt);var nt=new Ft(lt,Jr,this.rings.slice(),this.windings.slice());return er.comparePoints(nt.leftSE.point,nt.rightSE.point)>0&&nt.swapEvents(),er.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),G&&(lt.checkForConsuming(),sr.checkForConsuming()),Ie}},{key:"swapEvents",value:function(){var he=this.rightSE;this.rightSE=this.leftSE,this.leftSE=he,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Ie=0,G=this.windings.length;Ie<G;Ie++)this.windings[Ie]*=-1}},{key:"consume",value:function(he){for(var Ie=this,G=he;Ie.consumedBy;)Ie=Ie.consumedBy;for(;G.consumedBy;)G=G.consumedBy;var lt=Ft.compare(Ie,G);if(lt!==0){if(lt>0){var sr=Ie;Ie=G,G=sr}if(Ie.prev===G){var Jr=Ie;Ie=G,G=Jr}for(var nt=0,Gt=G.rings.length;nt<Gt;nt++){var Ar=G.rings[nt],Tr=G.windings[nt],Rr=Ie.rings.indexOf(Ar);Rr===-1?(Ie.rings.push(Ar),Ie.windings.push(Tr)):Ie.windings[Rr]+=Tr}G.rings=null,G.windings=null,G.consumedBy=Ie,G.leftSE.consumedBy=Ie.leftSE,G.rightSE.consumedBy=Ie.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var he=this.prev.consumedBy||this.prev;this._beforeState=he.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var he=this.beforeState();this._afterState={rings:he.rings.slice(0),windings:he.windings.slice(0),multiPolys:[]};for(var Ie=this._afterState.rings,G=this._afterState.windings,lt=this._afterState.multiPolys,sr=0,Jr=this.rings.length;sr<Jr;sr++){var nt=this.rings[sr],Gt=this.windings[sr],Ar=Ie.indexOf(nt);Ar===-1?(Ie.push(nt),G.push(Gt)):G[Ar]+=Gt}for(var Tr=[],Rr=[],mn=0,mi=Ie.length;mn<mi;mn++)if(G[mn]!==0){var ai=Ie[mn],Tn=ai.poly;if(Rr.indexOf(Tn)===-1)if(ai.isExterior)Tr.push(Tn);else{Rr.indexOf(Tn)===-1&&Rr.push(Tn);var Ri=Tr.indexOf(ai.poly);Ri!==-1&&Tr.splice(Ri,1)}}for(var zi=0,ka=Tr.length;zi<ka;zi++){var ia=Tr[zi].multiPoly;lt.indexOf(ia)===-1&&lt.push(ia)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var he=this.beforeState().multiPolys,Ie=this.afterState().multiPolys;switch($i.type){case"union":{var G=he.length===0,lt=Ie.length===0;this._isInResult=G!==lt;break}case"intersection":{var sr,Jr;he.length<Ie.length?(sr=he.length,Jr=Ie.length):(sr=Ie.length,Jr=he.length),this._isInResult=Jr===$i.numMultiPolys&&sr<Jr;break}case"xor":{var nt=Math.abs(he.length-Ie.length);this._isInResult=nt%2==1;break}case"difference":{var Gt=function(Tr){return Tr.length===1&&Tr[0].isSubject};this._isInResult=Gt(he)!==Gt(Ie);break}default:throw new Error("Unrecognized operation type found ".concat($i.type))}return this._isInResult}}],[{key:"fromRing",value:function(he,Ie,G){var lt,sr,Jr,nt=er.comparePoints(he,Ie);if(nt<0)lt=he,sr=Ie,Jr=1;else if(nt>0)lt=Ie,sr=he,Jr=-1;else throw new Error("Tried to create degenerate segment at [".concat(he.x,", ").concat(he.y,"]"));var Gt=new er(lt,!0),Ar=new er(sr,!1);return new Ft(Gt,Ar,[G],[Jr])}}]),Ft}(),ln=function(){function Ft(be,he,Ie){if(ge(this,Ft),!Array.isArray(be)||be.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=he,this.isExterior=Ie,this.segments=[],typeof be[0][0]!="number"||typeof be[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var G=je.round(be[0][0],be[0][1]);this.bbox={ll:{x:G.x,y:G.y},ur:{x:G.x,y:G.y}};for(var lt=G,sr=1,Jr=be.length;sr<Jr;sr++){if(typeof be[sr][0]!="number"||typeof be[sr][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var nt=je.round(be[sr][0],be[sr][1]);nt.x===lt.x&&nt.y===lt.y||(this.segments.push(vr.fromRing(lt,nt,this)),nt.x<this.bbox.ll.x&&(this.bbox.ll.x=nt.x),nt.y<this.bbox.ll.y&&(this.bbox.ll.y=nt.y),nt.x>this.bbox.ur.x&&(this.bbox.ur.x=nt.x),nt.y>this.bbox.ur.y&&(this.bbox.ur.y=nt.y),lt=nt)}(G.x!==lt.x||G.y!==lt.y)&&this.segments.push(vr.fromRing(lt,G,this))}return Fe(Ft,[{key:"getSweepEvents",value:function(){for(var he=[],Ie=0,G=this.segments.length;Ie<G;Ie++){var lt=this.segments[Ie];he.push(lt.leftSE),he.push(lt.rightSE)}return he}}]),Ft}(),sn=function(){function Ft(be,he){if(ge(this,Ft),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ln(be[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Ie=1,G=be.length;Ie<G;Ie++){var lt=new ln(be[Ie],this,!1);lt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=lt.bbox.ll.x),lt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=lt.bbox.ll.y),lt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=lt.bbox.ur.x),lt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=lt.bbox.ur.y),this.interiorRings.push(lt)}this.multiPoly=he}return Fe(Ft,[{key:"getSweepEvents",value:function(){for(var he=this.exteriorRing.getSweepEvents(),Ie=0,G=this.interiorRings.length;Ie<G;Ie++)for(var lt=this.interiorRings[Ie].getSweepEvents(),sr=0,Jr=lt.length;sr<Jr;sr++)he.push(lt[sr]);return he}}]),Ft}(),Mi=function(){function Ft(be,he){if(ge(this,Ft),!Array.isArray(be))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof be[0][0][0]=="number"&&(be=[be])}catch(sr){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Ie=0,G=be.length;Ie<G;Ie++){var lt=new sn(be[Ie],this);lt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=lt.bbox.ll.x),lt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=lt.bbox.ll.y),lt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=lt.bbox.ur.x),lt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=lt.bbox.ur.y),this.polys.push(lt)}this.isSubject=he}return Fe(Ft,[{key:"getSweepEvents",value:function(){for(var he=[],Ie=0,G=this.polys.length;Ie<G;Ie++)for(var lt=this.polys[Ie].getSweepEvents(),sr=0,Jr=lt.length;sr<Jr;sr++)he.push(lt[sr]);return he}}]),Ft}(),vi=function(){Fe(Ft,null,[{key:"factory",value:function(he){for(var Ie=[],G=0,lt=he.length;G<lt;G++){var sr=he[G];if(!(!sr.isInResult()||sr.ringOut)){for(var Jr=null,nt=sr.leftSE,Gt=sr.rightSE,Ar=[nt],Tr=nt.point,Rr=[];Jr=nt,nt=Gt,Ar.push(nt),nt.point!==Tr;)for(;;){var mn=nt.getAvailableLinkedEvents();if(mn.length===0){var mi=Ar[0].point,ai=Ar[Ar.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(mi.x,",")+" ".concat(mi.y,"]. Last matching segment found ends at")+" [".concat(ai.x,", ").concat(ai.y,"]."))}if(mn.length===1){Gt=mn[0].otherSE;break}for(var Tn=null,Ri=0,zi=Rr.length;Ri<zi;Ri++)if(Rr[Ri].point===nt.point){Tn=Ri;break}if(Tn!==null){var ka=Rr.splice(Tn)[0],ia=Ar.splice(ka.index);ia.unshift(ia[0].otherSE),Ie.push(new Ft(ia.reverse()));continue}Rr.push({index:Ar.length,point:nt.point});var io=nt.getLeftmostComparator(Jr);Gt=mn.sort(io)[0].otherSE;break}Ie.push(new Ft(Ar))}}return Ie}}]);function Ft(be){ge(this,Ft),this.events=be;for(var he=0,Ie=be.length;he<Ie;he++)be[he].segment.ringOut=this;this.poly=null}return Fe(Ft,[{key:"getGeom",value:function(){for(var he=this.events[0].point,Ie=[he],G=1,lt=this.events.length-1;G<lt;G++){var sr=this.events[G].point,Jr=this.events[G+1].point;re(sr,he,Jr)!==0&&(Ie.push(sr),he=sr)}if(Ie.length===1)return null;var nt=Ie[0],Gt=Ie[1];re(nt,he,Gt)===0&&Ie.shift(),Ie.push(Ie[0]);for(var Ar=this.isExteriorRing()?1:-1,Tr=this.isExteriorRing()?0:Ie.length-1,Rr=this.isExteriorRing()?Ie.length:-1,mn=[],mi=Tr;mi!=Rr;mi+=Ar)mn.push([Ie[mi].x,Ie[mi].y]);return mn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var he=this.enclosingRing();this._isExteriorRing=he?!he.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var he=this.events[0],Ie=1,G=this.events.length;Ie<G;Ie++){var lt=this.events[Ie];er.compare(he,lt)>0&&(he=lt)}for(var sr=he.segment.prevInResult(),Jr=sr?sr.prevInResult():null;;){if(!sr)return null;if(!Jr)return sr.ringOut;if(Jr.ringOut!==sr.ringOut)return Jr.ringOut.enclosingRing()!==sr.ringOut?sr.ringOut:sr.ringOut.enclosingRing();sr=Jr.prevInResult(),Jr=sr?sr.prevInResult():null}}}]),Ft}(),en=function(){function Ft(be){ge(this,Ft),this.exteriorRing=be,be.poly=this,this.interiorRings=[]}return Fe(Ft,[{key:"addInterior",value:function(he){this.interiorRings.push(he),he.poly=this}},{key:"getGeom",value:function(){var he=[this.exteriorRing.getGeom()];if(he[0]===null)return null;for(var Ie=0,G=this.interiorRings.length;Ie<G;Ie++){var lt=this.interiorRings[Ie].getGeom();lt!==null&&he.push(lt)}return he}}]),Ft}(),Oa=function(){function Ft(be){ge(this,Ft),this.rings=be,this.polys=this._composePolys(be)}return Fe(Ft,[{key:"getGeom",value:function(){for(var he=[],Ie=0,G=this.polys.length;Ie<G;Ie++){var lt=this.polys[Ie].getGeom();lt!==null&&he.push(lt)}return he}},{key:"_composePolys",value:function(he){for(var Ie=[],G=0,lt=he.length;G<lt;G++){var sr=he[G];if(!sr.poly)if(sr.isExteriorRing())Ie.push(new en(sr));else{var Jr=sr.enclosingRing();Jr.poly||Ie.push(new en(Jr)),Jr.poly.addInterior(sr)}}return Ie}}]),Ft}(),ra=function(){function Ft(be){var he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vr.compare;ge(this,Ft),this.queue=be,this.tree=new rt(he),this.segments=[]}return Fe(Ft,[{key:"process",value:function(he){var Ie=he.segment,G=[];if(he.consumedBy)return he.isLeft?this.queue.remove(he.otherSE):this.tree.remove(Ie),G;var lt=he.isLeft?this.tree.insert(Ie):this.tree.find(Ie);if(!lt)throw new Error("Unable to find segment #".concat(Ie.id," ")+"[".concat(Ie.leftSE.point.x,", ").concat(Ie.leftSE.point.y,"] -> ")+"[".concat(Ie.rightSE.point.x,", ").concat(Ie.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var sr=lt,Jr=lt,nt=void 0,Gt=void 0;nt===void 0;)sr=this.tree.prev(sr),sr===null?nt=null:sr.key.consumedBy===void 0&&(nt=sr.key);for(;Gt===void 0;)Jr=this.tree.next(Jr),Jr===null?Gt=null:Jr.key.consumedBy===void 0&&(Gt=Jr.key);if(he.isLeft){var Ar=null;if(nt){var Tr=nt.getIntersection(Ie);if(Tr!==null&&(Ie.isAnEndpoint(Tr)||(Ar=Tr),!nt.isAnEndpoint(Tr)))for(var Rr=this._splitSafely(nt,Tr),mn=0,mi=Rr.length;mn<mi;mn++)G.push(Rr[mn])}var ai=null;if(Gt){var Tn=Gt.getIntersection(Ie);if(Tn!==null&&(Ie.isAnEndpoint(Tn)||(ai=Tn),!Gt.isAnEndpoint(Tn)))for(var Ri=this._splitSafely(Gt,Tn),zi=0,ka=Ri.length;zi<ka;zi++)G.push(Ri[zi])}if(Ar!==null||ai!==null){var ia=null;if(Ar===null)ia=ai;else if(ai===null)ia=Ar;else{var io=er.comparePoints(Ar,ai);ia=io<=0?Ar:ai}this.queue.remove(Ie.rightSE),G.push(Ie.rightSE);for(var Ci=Ie.split(ia),pa=0,ee=Ci.length;pa<ee;pa++)G.push(Ci[pa])}G.length>0?(this.tree.remove(Ie),G.push(he)):(this.segments.push(Ie),Ie.prev=nt)}else{if(nt&&Gt){var ce=nt.getIntersection(Gt);if(ce!==null){if(!nt.isAnEndpoint(ce))for(var xe=this._splitSafely(nt,ce),Oe=0,qe=xe.length;Oe<qe;Oe++)G.push(xe[Oe]);if(!Gt.isAnEndpoint(ce))for(var ct=this._splitSafely(Gt,ce),St=0,ke=ct.length;St<ke;St++)G.push(ct[St])}}this.tree.remove(Ie)}return G}},{key:"_splitSafely",value:function(he,Ie){this.tree.remove(he);var G=he.rightSE;this.queue.remove(G);var lt=he.split(Ie);return lt.push(G),he.consumedBy===void 0&&this.tree.insert(he),lt}}]),Ft}(),Vi=typeof Re!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ya=typeof Re!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,fi=function(){function Ft(){ge(this,Ft)}return Fe(Ft,[{key:"run",value:function(he,Ie,G){$i.type=he,je.reset();for(var lt=[new Mi(Ie,!0)],sr=0,Jr=G.length;sr<Jr;sr++)lt.push(new Mi(G[sr],!1));if($i.numMultiPolys=lt.length,$i.type==="difference")for(var nt=lt[0],Gt=1;Gt<lt.length;)fr(lt[Gt].bbox,nt.bbox)!==null?Gt++:lt.splice(Gt,1);if($i.type==="intersection"){for(var Ar=0,Tr=lt.length;Ar<Tr;Ar++)for(var Rr=lt[Ar],mn=Ar+1,mi=lt.length;mn<mi;mn++)if(fr(Rr.bbox,lt[mn].bbox)===null)return[]}for(var ai=new rt(er.compare),Tn=0,Ri=lt.length;Tn<Ri;Tn++)for(var zi=lt[Tn].getSweepEvents(),ka=0,ia=zi.length;ka<ia;ka++)if(ai.insert(zi[ka]),ai.size>Vi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var io=new ra(ai),Ci=ai.size,pa=ai.pop();pa;){var ee=pa.key;if(ai.size===Ci){var ce=ee.segment;throw new Error("Unable to pop() ".concat(ee.isLeft?"left":"right"," SweepEvent ")+"[".concat(ee.point.x,", ").concat(ee.point.y,"] from segment #").concat(ce.id," ")+"[".concat(ce.leftSE.point.x,", ").concat(ce.leftSE.point.y,"] -> ")+"[".concat(ce.rightSE.point.x,", ").concat(ce.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ai.size>Vi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(io.segments.length>ya)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var xe=io.process(ee),Oe=0,qe=xe.length;Oe<qe;Oe++){var ct=xe[Oe];ct.consumedBy===void 0&&ai.insert(ct)}Ci=ai.size,pa=ai.pop()}je.reset();var St=vi.factory(io.segments),ke=new Oa(St);return ke.getGeom()}}]),Ft}(),$i=new fi,hi=function(be){for(var he=arguments.length,Ie=new Array(he>1?he-1:0),G=1;G<he;G++)Ie[G-1]=arguments[G];return $i.run("union",be,Ie)},yi=function(be){for(var he=arguments.length,Ie=new Array(he>1?he-1:0),G=1;G<he;G++)Ie[G-1]=arguments[G];return $i.run("intersection",be,Ie)},ss=function(be){for(var he=arguments.length,Ie=new Array(he>1?he-1:0),G=1;G<he;G++)Ie[G-1]=arguments[G];return $i.run("xor",be,Ie)},yo=function(be){for(var he=arguments.length,Ie=new Array(he>1?he-1:0),G=1;G<he;G++)Ie[G-1]=arguments[G];return $i.run("difference",be,Ie)},qa={union:hi,intersection:yi,xor:ss,difference:yo};return qa})},28660:function(wn,Ee,ue){var Re=ue(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ge;(function(y){(function(Fe){var K=typeof ue.g=="object"?ue.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Me=ve(y);typeof K.Reflect=="undefined"?K.Reflect=y:Me=ve(K.Reflect,Me),Fe(Me);function ve(at,se){return function(Be,dt){typeof at[Be]!="function"&&Object.defineProperty(at,Be,{configurable:!0,writable:!0,value:dt}),se&&se(Be,dt)}}})(function(Fe){var K=Object.prototype.hasOwnProperty,Me=typeof Symbol=="function",ve=Me&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",at=Me&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",se=typeof Object.create=="function",Be={__proto__:[]}instanceof Array,dt=!se&&!Be,rt={create:se?function(){return Jr(Object.create(null))}:Be?function(){return Jr({__proto__:null})}:function(){return Jr({})},has:dt?function(nt,Gt){return K.call(nt,Gt)}:function(nt,Gt){return Gt in nt},get:dt?function(nt,Gt){return K.call(nt,Gt)?nt[Gt]:void 0}:function(nt,Gt){return nt[Gt]}},Et=Object.getPrototypeOf(Function),Vt=typeof Re=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ut=!Vt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:G(),lr=!Vt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:lt(),Qt=!Vt&&typeof WeakMap=="function"?WeakMap:sr(),It=new Qt;function Lt(nt,Gt,Ar,Tr){if(sn(Ar)){if(!$i(nt))throw new TypeError;if(!yi(Gt))throw new TypeError;return re(nt,Gt)}else{if(!$i(nt))throw new TypeError;if(!en(Gt))throw new TypeError;if(!en(Tr)&&!sn(Tr)&&!Mi(Tr))throw new TypeError;return Mi(Tr)&&(Tr=void 0),Ar=fi(Ar),Se(nt,Gt,Ar,Tr)}}Fe("decorate",Lt);function fr(nt,Gt){function Ar(Tr,Rr){if(!en(Tr))throw new TypeError;if(!sn(Rr)&&!ss(Rr))throw new TypeError;er(nt,Gt,Tr,Rr)}return Ar}Fe("metadata",fr);function ie(nt,Gt,Ar,Tr){if(!en(Ar))throw new TypeError;return sn(Tr)||(Tr=fi(Tr)),er(nt,Gt,Ar,Tr)}Fe("defineMetadata",ie);function yr(nt,Gt,Ar){if(!en(Gt))throw new TypeError;return sn(Ar)||(Ar=fi(Ar)),Q(nt,Gt,Ar)}Fe("hasMetadata",yr);function Dt(nt,Gt,Ar){if(!en(Gt))throw new TypeError;return sn(Ar)||(Ar=fi(Ar)),Le(nt,Gt,Ar)}Fe("hasOwnMetadata",Dt);function xt(nt,Gt,Ar){if(!en(Gt))throw new TypeError;return sn(Ar)||(Ar=fi(Ar)),ht(nt,Gt,Ar)}Fe("getMetadata",xt);function Jt(nt,Gt,Ar){if(!en(Gt))throw new TypeError;return sn(Ar)||(Ar=fi(Ar)),wt(nt,Gt,Ar)}Fe("getOwnMetadata",Jt);function je(nt,Gt){if(!en(nt))throw new TypeError;return sn(Gt)||(Gt=fi(Gt)),Tt(nt,Gt)}Fe("getMetadataKeys",je);function Sr(nt,Gt){if(!en(nt))throw new TypeError;return sn(Gt)||(Gt=fi(Gt)),vr(nt,Gt)}Fe("getOwnMetadataKeys",Sr);function tn(nt,Gt,Ar){if(!en(Gt))throw new TypeError;sn(Ar)||(Ar=fi(Ar));var Tr=V(Gt,Ar,!1);if(sn(Tr)||!Tr.delete(nt))return!1;if(Tr.size>0)return!0;var Rr=It.get(Gt);return Rr.delete(Ar),Rr.size>0||It.delete(Gt),!0}Fe("deleteMetadata",tn);function re(nt,Gt){for(var Ar=nt.length-1;Ar>=0;--Ar){var Tr=nt[Ar],Rr=Tr(Gt);if(!sn(Rr)&&!Mi(Rr)){if(!yi(Rr))throw new TypeError;Gt=Rr}}return Gt}function Se(nt,Gt,Ar,Tr){for(var Rr=nt.length-1;Rr>=0;--Rr){var mn=nt[Rr],mi=mn(Gt,Ar,Tr);if(!sn(mi)&&!Mi(mi)){if(!en(mi))throw new TypeError;Tr=mi}}return Tr}function V(nt,Gt,Ar){var Tr=It.get(nt);if(sn(Tr)){if(!Ar)return;Tr=new Ut,It.set(nt,Tr)}var Rr=Tr.get(Gt);if(sn(Rr)){if(!Ar)return;Rr=new Ut,Tr.set(Gt,Rr)}return Rr}function Q(nt,Gt,Ar){var Tr=Le(nt,Gt,Ar);if(Tr)return!0;var Rr=Ie(Gt);return Mi(Rr)?!1:Q(nt,Rr,Ar)}function Le(nt,Gt,Ar){var Tr=V(Gt,Ar,!1);return sn(Tr)?!1:Vi(Tr.has(nt))}function ht(nt,Gt,Ar){var Tr=Le(nt,Gt,Ar);if(Tr)return wt(nt,Gt,Ar);var Rr=Ie(Gt);if(!Mi(Rr))return ht(nt,Rr,Ar)}function wt(nt,Gt,Ar){var Tr=V(Gt,Ar,!1);if(!sn(Tr))return Tr.get(nt)}function er(nt,Gt,Ar,Tr){var Rr=V(Ar,Tr,!0);Rr.set(nt,Gt)}function Tt(nt,Gt){var Ar=vr(nt,Gt),Tr=Ie(nt);if(Tr===null)return Ar;var Rr=Tt(Tr,Gt);if(Rr.length<=0)return Ar;if(Ar.length<=0)return Rr;for(var mn=new lr,mi=[],ai=0,Tn=Ar;ai<Tn.length;ai++){var Ri=Tn[ai],zi=mn.has(Ri);zi||(mn.add(Ri),mi.push(Ri))}for(var ka=0,ia=Rr;ka<ia.length;ka++){var Ri=ia[ka],zi=mn.has(Ri);zi||(mn.add(Ri),mi.push(Ri))}return mi}function vr(nt,Gt){var Ar=[],Tr=V(nt,Gt,!1);if(sn(Tr))return Ar;for(var Rr=Tr.keys(),mn=qa(Rr),mi=0;;){var ai=be(mn);if(!ai)return Ar.length=mi,Ar;var Tn=Ft(ai);try{Ar[mi]=Tn}catch(Ri){try{he(mn)}finally{throw Ri}}mi++}}function ln(nt){if(nt===null)return 1;switch(typeof nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return nt===null?1:6;default:return 6}}function sn(nt){return nt===void 0}function Mi(nt){return nt===null}function vi(nt){return typeof nt=="symbol"}function en(nt){return typeof nt=="object"?nt!==null:typeof nt=="function"}function Oa(nt,Gt){switch(ln(nt)){case 0:return nt;case 1:return nt;case 2:return nt;case 3:return nt;case 4:return nt;case 5:return nt}var Ar=Gt===3?"string":Gt===5?"number":"default",Tr=yo(nt,ve);if(Tr!==void 0){var Rr=Tr.call(nt,Ar);if(en(Rr))throw new TypeError;return Rr}return ra(nt,Ar==="default"?"number":Ar)}function ra(nt,Gt){if(Gt==="string"){var Ar=nt.toString;if(hi(Ar)){var Tr=Ar.call(nt);if(!en(Tr))return Tr}var Rr=nt.valueOf;if(hi(Rr)){var Tr=Rr.call(nt);if(!en(Tr))return Tr}}else{var Rr=nt.valueOf;if(hi(Rr)){var Tr=Rr.call(nt);if(!en(Tr))return Tr}var mn=nt.toString;if(hi(mn)){var Tr=mn.call(nt);if(!en(Tr))return Tr}}throw new TypeError}function Vi(nt){return!!nt}function ya(nt){return""+nt}function fi(nt){var Gt=Oa(nt,3);return vi(Gt)?Gt:ya(Gt)}function $i(nt){return Array.isArray?Array.isArray(nt):nt instanceof Object?nt instanceof Array:Object.prototype.toString.call(nt)==="[object Array]"}function hi(nt){return typeof nt=="function"}function yi(nt){return typeof nt=="function"}function ss(nt){switch(ln(nt)){case 3:return!0;case 4:return!0;default:return!1}}function yo(nt,Gt){var Ar=nt[Gt];if(Ar!=null){if(!hi(Ar))throw new TypeError;return Ar}}function qa(nt){var Gt=yo(nt,at);if(!hi(Gt))throw new TypeError;var Ar=Gt.call(nt);if(!en(Ar))throw new TypeError;return Ar}function Ft(nt){return nt.value}function be(nt){var Gt=nt.next();return Gt.done?!1:Gt}function he(nt){var Gt=nt.return;Gt&&Gt.call(nt)}function Ie(nt){var Gt=Object.getPrototypeOf(nt);if(typeof nt!="function"||nt===Et||Gt!==Et)return Gt;var Ar=nt.prototype,Tr=Ar&&Object.getPrototypeOf(Ar);if(Tr==null||Tr===Object.prototype)return Gt;var Rr=Tr.constructor;return typeof Rr!="function"||Rr===nt?Gt:Rr}function G(){var nt={},Gt=[],Ar=function(){function mi(ai,Tn,Ri){this._index=0,this._keys=ai,this._values=Tn,this._selector=Ri}return mi.prototype["@@iterator"]=function(){return this},mi.prototype[at]=function(){return this},mi.prototype.next=function(){var ai=this._index;if(ai>=0&&ai<this._keys.length){var Tn=this._selector(this._keys[ai],this._values[ai]);return ai+1>=this._keys.length?(this._index=-1,this._keys=Gt,this._values=Gt):this._index++,{value:Tn,done:!1}}return{value:void 0,done:!0}},mi.prototype.throw=function(ai){throw this._index>=0&&(this._index=-1,this._keys=Gt,this._values=Gt),ai},mi.prototype.return=function(ai){return this._index>=0&&(this._index=-1,this._keys=Gt,this._values=Gt),{value:ai,done:!0}},mi}();return function(){function mi(){this._keys=[],this._values=[],this._cacheKey=nt,this._cacheIndex=-2}return Object.defineProperty(mi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),mi.prototype.has=function(ai){return this._find(ai,!1)>=0},mi.prototype.get=function(ai){var Tn=this._find(ai,!1);return Tn>=0?this._values[Tn]:void 0},mi.prototype.set=function(ai,Tn){var Ri=this._find(ai,!0);return this._values[Ri]=Tn,this},mi.prototype.delete=function(ai){var Tn=this._find(ai,!1);if(Tn>=0){for(var Ri=this._keys.length,zi=Tn+1;zi<Ri;zi++)this._keys[zi-1]=this._keys[zi],this._values[zi-1]=this._values[zi];return this._keys.length--,this._values.length--,ai===this._cacheKey&&(this._cacheKey=nt,this._cacheIndex=-2),!0}return!1},mi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=nt,this._cacheIndex=-2},mi.prototype.keys=function(){return new Ar(this._keys,this._values,Tr)},mi.prototype.values=function(){return new Ar(this._keys,this._values,Rr)},mi.prototype.entries=function(){return new Ar(this._keys,this._values,mn)},mi.prototype["@@iterator"]=function(){return this.entries()},mi.prototype[at]=function(){return this.entries()},mi.prototype._find=function(ai,Tn){return this._cacheKey!==ai&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ai)),this._cacheIndex<0&&Tn&&(this._cacheIndex=this._keys.length,this._keys.push(ai),this._values.push(void 0)),this._cacheIndex},mi}();function Tr(mi,ai){return mi}function Rr(mi,ai){return ai}function mn(mi,ai){return[mi,ai]}}function lt(){return function(){function nt(){this._map=new Ut}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),nt.prototype.has=function(Gt){return this._map.has(Gt)},nt.prototype.add=function(Gt){return this._map.set(Gt,Gt),this},nt.prototype.delete=function(Gt){return this._map.delete(Gt)},nt.prototype.clear=function(){this._map.clear()},nt.prototype.keys=function(){return this._map.keys()},nt.prototype.values=function(){return this._map.values()},nt.prototype.entries=function(){return this._map.entries()},nt.prototype["@@iterator"]=function(){return this.keys()},nt.prototype[at]=function(){return this.keys()},nt}()}function sr(){var nt=16,Gt=rt.create(),Ar=Tr();return function(){function Tn(){this._key=Tr()}return Tn.prototype.has=function(Ri){var zi=Rr(Ri,!1);return zi!==void 0?rt.has(zi,this._key):!1},Tn.prototype.get=function(Ri){var zi=Rr(Ri,!1);return zi!==void 0?rt.get(zi,this._key):void 0},Tn.prototype.set=function(Ri,zi){var ka=Rr(Ri,!0);return ka[this._key]=zi,this},Tn.prototype.delete=function(Ri){var zi=Rr(Ri,!1);return zi!==void 0?delete zi[this._key]:!1},Tn.prototype.clear=function(){this._key=Tr()},Tn}();function Tr(){var Tn;do Tn="@@WeakMap@@"+ai();while(rt.has(Gt,Tn));return Gt[Tn]=!0,Tn}function Rr(Tn,Ri){if(!K.call(Tn,Ar)){if(!Ri)return;Object.defineProperty(Tn,Ar,{value:rt.create()})}return Tn[Ar]}function mn(Tn,Ri){for(var zi=0;zi<Ri;++zi)Tn[zi]=Math.random()*255|0;return Tn}function mi(Tn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Tn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Tn)):mn(new Uint8Array(Tn),Tn):mn(new Array(Tn),Tn)}function ai(){var Tn=mi(nt);Tn[6]=Tn[6]&79|64,Tn[8]=Tn[8]&191|128;for(var Ri="",zi=0;zi<nt;++zi){var ka=Tn[zi];(zi===4||zi===6||zi===8)&&(Ri+="-"),ka<16&&(Ri+="0"),Ri+=ka.toString(16).toLowerCase()}return Ri}}function Jr(nt){return nt.__=void 0,delete nt.__,nt}})})(ge||(ge={}))},69848:function(wn){(function(Ee,ue){wn.exports=ue()})(this,function(){"use strict";function Ee(Dt,xt,Jt,je,Sr,tn){if(!(Sr-je<=Jt)){var re=je+Sr>>1;ue(Dt,xt,re,je,Sr,tn%2),Ee(Dt,xt,Jt,je,re-1,tn+1),Ee(Dt,xt,Jt,re+1,Sr,tn+1)}}function ue(Dt,xt,Jt,je,Sr,tn){for(;Sr>je;){if(Sr-je>600){var re=Sr-je+1,Se=Jt-je+1,V=Math.log(re),Q=.5*Math.exp(2*V/3),Le=.5*Math.sqrt(V*Q*(re-Q)/re)*(Se-re/2<0?-1:1),ht=Math.max(je,Math.floor(Jt-Se*Q/re+Le)),wt=Math.min(Sr,Math.floor(Jt+(re-Se)*Q/re+Le));ue(Dt,xt,Jt,ht,wt,tn)}var er=xt[2*Jt+tn],Tt=je,vr=Sr;for(Re(Dt,xt,je,Jt),xt[2*Sr+tn]>er&&Re(Dt,xt,je,Sr);Tt<vr;){for(Re(Dt,xt,Tt,vr),Tt++,vr--;xt[2*Tt+tn]<er;)Tt++;for(;xt[2*vr+tn]>er;)vr--}xt[2*je+tn]===er?Re(Dt,xt,je,vr):(vr++,Re(Dt,xt,vr,Sr)),vr<=Jt&&(je=vr+1),Jt<=vr&&(Sr=vr-1)}}function Re(Dt,xt,Jt,je){ge(Dt,Jt,je),ge(xt,2*Jt,2*je),ge(xt,2*Jt+1,2*je+1)}function ge(Dt,xt,Jt){var je=Dt[xt];Dt[xt]=Dt[Jt],Dt[Jt]=je}function y(Dt,xt,Jt,je,Sr,tn,re){for(var Se=[0,Dt.length-1,0],V=[],Q,Le;Se.length;){var ht=Se.pop(),wt=Se.pop(),er=Se.pop();if(wt-er<=re){for(var Tt=er;Tt<=wt;Tt++)Q=xt[2*Tt],Le=xt[2*Tt+1],Q>=Jt&&Q<=Sr&&Le>=je&&Le<=tn&&V.push(Dt[Tt]);continue}var vr=Math.floor((er+wt)/2);Q=xt[2*vr],Le=xt[2*vr+1],Q>=Jt&&Q<=Sr&&Le>=je&&Le<=tn&&V.push(Dt[vr]);var ln=(ht+1)%2;(ht===0?Jt<=Q:je<=Le)&&(Se.push(er),Se.push(vr-1),Se.push(ln)),(ht===0?Sr>=Q:tn>=Le)&&(Se.push(vr+1),Se.push(wt),Se.push(ln))}return V}function Fe(Dt,xt,Jt,je,Sr,tn){for(var re=[0,Dt.length-1,0],Se=[],V=Sr*Sr;re.length;){var Q=re.pop(),Le=re.pop(),ht=re.pop();if(Le-ht<=tn){for(var wt=ht;wt<=Le;wt++)K(xt[2*wt],xt[2*wt+1],Jt,je)<=V&&Se.push(Dt[wt]);continue}var er=Math.floor((ht+Le)/2),Tt=xt[2*er],vr=xt[2*er+1];K(Tt,vr,Jt,je)<=V&&Se.push(Dt[er]);var ln=(Q+1)%2;(Q===0?Jt-Sr<=Tt:je-Sr<=vr)&&(re.push(ht),re.push(er-1),re.push(ln)),(Q===0?Jt+Sr>=Tt:je+Sr>=vr)&&(re.push(er+1),re.push(Le),re.push(ln))}return Se}function K(Dt,xt,Jt,je){var Sr=Dt-Jt,tn=xt-je;return Sr*Sr+tn*tn}var Me=function(Dt){return Dt[0]},ve=function(Dt){return Dt[1]},at=function(xt,Jt,je,Sr,tn){Jt===void 0&&(Jt=Me),je===void 0&&(je=ve),Sr===void 0&&(Sr=64),tn===void 0&&(tn=Float64Array),this.nodeSize=Sr,this.points=xt;for(var re=xt.length<65536?Uint16Array:Uint32Array,Se=this.ids=new re(xt.length),V=this.coords=new tn(xt.length*2),Q=0;Q<xt.length;Q++)Se[Q]=Q,V[2*Q]=Jt(xt[Q]),V[2*Q+1]=je(xt[Q]);Ee(Se,V,Sr,0,Se.length-1,0)};at.prototype.range=function(xt,Jt,je,Sr){return y(this.ids,this.coords,xt,Jt,je,Sr,this.nodeSize)},at.prototype.within=function(xt,Jt,je){return Fe(this.ids,this.coords,xt,Jt,je,this.nodeSize)};var se={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Dt){return Dt}},Be=Math.fround||function(Dt){return function(xt){return Dt[0]=+xt,Dt[0]}}(new Float32Array(1)),dt=function(xt){this.options=fr(Object.create(se),xt),this.trees=new Array(this.options.maxZoom+1)};dt.prototype.load=function(xt){var Jt=this.options,je=Jt.log,Sr=Jt.minZoom,tn=Jt.maxZoom,re=Jt.nodeSize;je&&console.time("total time");var Se="prepare "+xt.length+" points";je&&console.time(Se),this.points=xt;for(var V=[],Q=0;Q<xt.length;Q++)!xt[Q].geometry||V.push(Et(xt[Q],Q));this.trees[tn+1]=new at(V,ie,yr,re,Float32Array),je&&console.timeEnd(Se);for(var Le=tn;Le>=Sr;Le--){var ht=+Date.now();V=this._cluster(V,Le),this.trees[Le]=new at(V,ie,yr,re,Float32Array),je&&console.log("z%d: %d clusters in %dms",Le,V.length,+Date.now()-ht)}return je&&console.timeEnd("total time"),this},dt.prototype.getClusters=function(xt,Jt){var je=((xt[0]+180)%360+360)%360-180,Sr=Math.max(-90,Math.min(90,xt[1])),tn=xt[2]===180?180:((xt[2]+180)%360+360)%360-180,re=Math.max(-90,Math.min(90,xt[3]));if(xt[2]-xt[0]>=360)je=-180,tn=180;else if(je>tn){var Se=this.getClusters([je,Sr,180,re],Jt),V=this.getClusters([-180,Sr,tn,re],Jt);return Se.concat(V)}for(var Q=this.trees[this._limitZoom(Jt)],Le=Q.range(lr(je),Qt(re),lr(tn),Qt(Sr)),ht=[],wt=0,er=Le;wt<er.length;wt+=1){var Tt=er[wt],vr=Q.points[Tt];ht.push(vr.numPoints?Vt(vr):this.points[vr.index])}return ht},dt.prototype.getChildren=function(xt){var Jt=this._getOriginId(xt),je=this._getOriginZoom(xt),Sr="No cluster with the specified id.",tn=this.trees[je];if(!tn)throw new Error(Sr);var re=tn.points[Jt];if(!re)throw new Error(Sr);for(var Se=this.options.radius/(this.options.extent*Math.pow(2,je-1)),V=tn.within(re.x,re.y,Se),Q=[],Le=0,ht=V;Le<ht.length;Le+=1){var wt=ht[Le],er=tn.points[wt];er.parentId===xt&&Q.push(er.numPoints?Vt(er):this.points[er.index])}if(Q.length===0)throw new Error(Sr);return Q},dt.prototype.getLeaves=function(xt,Jt,je){Jt=Jt||10,je=je||0;var Sr=[];return this._appendLeaves(Sr,xt,Jt,je,0),Sr},dt.prototype.getTile=function(xt,Jt,je){var Sr=this.trees[this._limitZoom(xt)],tn=Math.pow(2,xt),re=this.options,Se=re.extent,V=re.radius,Q=V/Se,Le=(je-Q)/tn,ht=(je+1+Q)/tn,wt={features:[]};return this._addTileFeatures(Sr.range((Jt-Q)/tn,Le,(Jt+1+Q)/tn,ht),Sr.points,Jt,je,tn,wt),Jt===0&&this._addTileFeatures(Sr.range(1-Q/tn,Le,1,ht),Sr.points,tn,je,tn,wt),Jt===tn-1&&this._addTileFeatures(Sr.range(0,Le,Q/tn,ht),Sr.points,-1,je,tn,wt),wt.features.length?wt:null},dt.prototype.getClusterExpansionZoom=function(xt){for(var Jt=this._getOriginZoom(xt)-1;Jt<=this.options.maxZoom;){var je=this.getChildren(xt);if(Jt++,je.length!==1)break;xt=je[0].properties.cluster_id}return Jt},dt.prototype._appendLeaves=function(xt,Jt,je,Sr,tn){for(var re=this.getChildren(Jt),Se=0,V=re;Se<V.length;Se+=1){var Q=V[Se],Le=Q.properties;if(Le&&Le.cluster?tn+Le.point_count<=Sr?tn+=Le.point_count:tn=this._appendLeaves(xt,Le.cluster_id,je,Sr,tn):tn<Sr?tn++:xt.push(Q),xt.length===je)break}return tn},dt.prototype._addTileFeatures=function(xt,Jt,je,Sr,tn,re){for(var Se=0,V=xt;Se<V.length;Se+=1){var Q=V[Se],Le=Jt[Q],ht=Le.numPoints,wt=void 0,er=void 0,Tt=void 0;if(ht)wt=Ut(Le),er=Le.x,Tt=Le.y;else{var vr=this.points[Le.index];wt=vr.properties,er=lr(vr.geometry.coordinates[0]),Tt=Qt(vr.geometry.coordinates[1])}var ln={type:1,geometry:[[Math.round(this.options.extent*(er*tn-je)),Math.round(this.options.extent*(Tt*tn-Sr))]],tags:wt},sn=void 0;ht?sn=Le.id:this.options.generateId?sn=Le.index:this.points[Le.index].id&&(sn=this.points[Le.index].id),sn!==void 0&&(ln.id=sn),re.features.push(ln)}},dt.prototype._limitZoom=function(xt){return Math.max(this.options.minZoom,Math.min(Math.floor(+xt),this.options.maxZoom+1))},dt.prototype._cluster=function(xt,Jt){for(var je=[],Sr=this.options,tn=Sr.radius,re=Sr.extent,Se=Sr.reduce,V=Sr.minPoints,Q=tn/(re*Math.pow(2,Jt)),Le=0;Le<xt.length;Le++){var ht=xt[Le];if(!(ht.zoom<=Jt)){ht.zoom=Jt;for(var wt=this.trees[Jt+1],er=wt.within(ht.x,ht.y,Q),Tt=ht.numPoints||1,vr=Tt,ln=0,sn=er;ln<sn.length;ln+=1){var Mi=sn[ln],vi=wt.points[Mi];vi.zoom>Jt&&(vr+=vi.numPoints||1)}if(vr>Tt&&vr>=V){for(var en=ht.x*Tt,Oa=ht.y*Tt,ra=Se&&Tt>1?this._map(ht,!0):null,Vi=(Le<<5)+(Jt+1)+this.points.length,ya=0,fi=er;ya<fi.length;ya+=1){var $i=fi[ya],hi=wt.points[$i];if(!(hi.zoom<=Jt)){hi.zoom=Jt;var yi=hi.numPoints||1;en+=hi.x*yi,Oa+=hi.y*yi,hi.parentId=Vi,Se&&(ra||(ra=this._map(ht,!0)),Se(ra,this._map(hi)))}}ht.parentId=Vi,je.push(rt(en/vr,Oa/vr,Vi,vr,ra))}else if(je.push(ht),vr>1)for(var ss=0,yo=er;ss<yo.length;ss+=1){var qa=yo[ss],Ft=wt.points[qa];Ft.zoom<=Jt||(Ft.zoom=Jt,je.push(Ft))}}}return je},dt.prototype._getOriginId=function(xt){return xt-this.points.length>>5},dt.prototype._getOriginZoom=function(xt){return(xt-this.points.length)%32},dt.prototype._map=function(xt,Jt){if(xt.numPoints)return Jt?fr({},xt.properties):xt.properties;var je=this.points[xt.index].properties,Sr=this.options.map(je);return Jt&&Sr===je?fr({},Sr):Sr};function rt(Dt,xt,Jt,je,Sr){return{x:Be(Dt),y:Be(xt),zoom:Infinity,id:Jt,parentId:-1,numPoints:je,properties:Sr}}function Et(Dt,xt){var Jt=Dt.geometry.coordinates,je=Jt[0],Sr=Jt[1];return{x:Be(lr(je)),y:Be(Qt(Sr)),zoom:Infinity,index:xt,parentId:-1}}function Vt(Dt){return{type:"Feature",id:Dt.id,properties:Ut(Dt),geometry:{type:"Point",coordinates:[It(Dt.x),Lt(Dt.y)]}}}function Ut(Dt){var xt=Dt.numPoints,Jt=xt>=1e4?Math.round(xt/1e3)+"k":xt>=1e3?Math.round(xt/100)/10+"k":xt;return fr(fr({},Dt.properties),{cluster:!0,cluster_id:Dt.id,point_count:xt,point_count_abbreviated:Jt})}function lr(Dt){return Dt/360+.5}function Qt(Dt){var xt=Math.sin(Dt*Math.PI/180),Jt=.5-.25*Math.log((1+xt)/(1-xt))/Math.PI;return Jt<0?0:Jt>1?1:Jt}function It(Dt){return(Dt-.5)*360}function Lt(Dt){var xt=(180-Dt*360)*Math.PI/180;return 360*Math.atan(Math.exp(xt))/Math.PI-90}function fr(Dt,xt){for(var Jt in xt)Dt[Jt]=xt[Jt];return Dt}function ie(Dt){return Dt.x}function yr(Dt){return Dt.y}return dt})}}]);
